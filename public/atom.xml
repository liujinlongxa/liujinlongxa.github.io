<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>liujinlongxa的技术博客</title>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://liujinlongxa.com/"/>
  <updated>2016-10-07T03:38:39.000Z</updated>
  <id>http://liujinlongxa.com/</id>
  
  <author>
    <name>liujinlongxa</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>iOS多环境配置实践</title>
    <link href="http://liujinlongxa.com/2016/10/07/iOS%E5%A4%9A%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E5%AE%9E%E8%B7%B5/"/>
    <id>http://liujinlongxa.com/2016/10/07/iOS多环境配置实践/</id>
    <published>2016-10-07T02:04:43.000Z</published>
    <updated>2016-10-07T03:38:39.000Z</updated>
    
    <content type="html">&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;在移动客户端开发过程中，服务器一般都会提供多个环境的API接口，例如测试环境(TEST_ENV)，发布环境(RELEASE_ENV)，预发布环境(PRERELEASE_ENV)等，我们客户端在打包的时候需要在不同的阶段打不同环境的包，最简单的做法就是在代码里直接修改URL来切换不同的环境。但是这种做法太Low了，而且也不易于使用脚本自动打包。本文的主要内容就是介绍一种不修改代码达到配置不同环境的方法。&lt;/p&gt;
&lt;h2 id=&quot;明确需求&quot;&gt;&lt;a href=&quot;#明确需求&quot; class=&quot;headerlink&quot; title=&quot;明确需求&quot;&gt;&lt;/a&gt;明确需求&lt;/h2&gt;&lt;p&gt;在开始主要内容之前，先明确一下需求：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;服务器有三个环境，测试环境(TEST_ENV)，发布环境(RELEASE_ENV)，预发布环境(PRERELEASE_ENV)，要求要很方便的实现在三个不同环境之间自由切换&lt;/li&gt;
&lt;li&gt;代码中大量使用了DEBUG宏，因此要求每个环境都应该区分DEBUG和RELEASE，即在任一环境下都可能需要打DEBUG包或RELEASE包&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;为此，我编写了一份测试代码：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;#if TEST_ENV // 测试环境&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;#if DEBUG&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    NSLog(@&amp;quot;hello test env debug&amp;quot;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;#else&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    NSLog(@&amp;quot;hello test env release&amp;quot;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;#endif&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;#endif&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;#if RELEASE_ENV // 发布环境&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;#if DEBUG&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    NSLog(@&amp;quot;hello release env debug&amp;quot;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;#else&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    NSLog(@&amp;quot;hello release env release&amp;quot;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;#endif&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;#endif&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;#if PRERELEASE_ENV // 预发布环境&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;#if DEBUG&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    NSLog(@&amp;quot;hello pre-relase env debug&amp;quot;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;#else&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    NSLog(@&amp;quot;hello pre-relase env release&amp;quot;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;#endif&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;#endif&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;具体步骤&quot;&gt;&lt;a href=&quot;#具体步骤&quot; class=&quot;headerlink&quot; title=&quot;具体步骤&quot;&gt;&lt;/a&gt;具体步骤&lt;/h2&gt;&lt;h3 id=&quot;1-为每一个环境创建一个Target&quot;&gt;&lt;a href=&quot;#1-为每一个环境创建一个Target&quot; class=&quot;headerlink&quot; title=&quot;1. 为每一个环境创建一个Target&quot;&gt;&lt;/a&gt;1. 为每一个环境创建一个Target&lt;/h3&gt;&lt;p&gt;创建项目后，项目本身就会有一个Target（如果不了解Target的概念可以看一下&lt;a href=&quot;https://developer.apple.com/library/content/featuredarticles/XcodeConcepts/Concept-Targets.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;这篇官方文档&lt;/a&gt;）,我们可以把这个Target就作为某一个环境的Target，这里我们把它作为发布环境的Target，然后还需要创建测试环境和预发布环境的Target，方法如下：&lt;/p&gt;
&lt;p&gt;在项目配置界面左侧，选中Target，点击右键，选择”Duplicate”，复制一个新的Target，如下图：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/ec6ceac9d953c320c0cbf0bfe55ee361.png&quot; alt=&quot;1&quot;&gt;&lt;/p&gt;
&lt;p&gt;然后在弹出的菜单中点击”Duplicate Only”&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/463b4e2b32269ab485d9f160315e1d75.png&quot; alt=&quot;2&quot;&gt;&lt;/p&gt;
&lt;p&gt;这样就创建好了一个新的Target。新的Target的默认名称为”项目名称 copy”，即”Test1007 copy”，单击新创建的Target，修改Target名称为”Test1007_Test”，将这个Target作为测试环境的Target。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/4e99d383134b80176fedbe7853327b6f.png&quot; alt=&quot;3&quot;&gt;&lt;/p&gt;
&lt;p&gt;创建完Target后，XCode会自动为这个Target创建一个Scheme，为了方便起见，也将这个Scheme的名称修改为”Test1007_Test”，方法是在左上角点击”Manage Schemes…”，单机要修改名称的Scheme，即可修改Scheme的名称。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/32c4abd9100ed10efbebda4f876c5939.png&quot; alt=&quot;4&quot;&gt;&lt;/p&gt;
&lt;p&gt;同样的方法，在创建一个名为”Test1007_Prerelease”的Target作为预发布环境的Target。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/640b7eebdbb792330544b5211110f278.png&quot; alt=&quot;5&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;2-配置环境变量&quot;&gt;&lt;a href=&quot;#2-配置环境变量&quot; class=&quot;headerlink&quot; title=&quot;2. 配置环境变量&quot;&gt;&lt;/a&gt;2. 配置环境变量&lt;/h3&gt;&lt;p&gt;配置环境变量，就是添加TEST_ENV，RELEASE_ENV和PRERELEASE_ENV这三个宏，这一步在ObjectiveC下和Swift是不一样的，这里会分别讲解&lt;/p&gt;
&lt;h4 id=&quot;ObjectiveC下配置环境变量&quot;&gt;&lt;a href=&quot;#ObjectiveC下配置环境变量&quot; class=&quot;headerlink&quot; title=&quot;ObjectiveC下配置环境变量&quot;&gt;&lt;/a&gt;ObjectiveC下配置环境变量&lt;/h4&gt;&lt;p&gt;在项目配置界面选择发布环境的Target “Test1007”，点击Build Settings，找到Preprocessor Macros，在Debug和Release下都添加环境变量”RELEASE_ENV=1”，如图：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/e685c55dc756723ecd8a2d513efca11e.png&quot; alt=&quot;6&quot;&gt;&lt;/p&gt;
&lt;p&gt;添加完成后结果如图：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/60989466ad3f7b1b1e272210c2fafe8d.png&quot; alt=&quot;7&quot;&gt;&lt;/p&gt;
&lt;p&gt;这样就为发布环境添加好了”RELEASE_ENV”宏。&lt;/p&gt;
&lt;p&gt;同样的方法，分别在Target “Test1007_Test”和”Test1007_Prerelease”添加TEST_ENV和PRERELEASE_ENV这两个宏。&lt;/p&gt;
&lt;h4 id=&quot;Swift下配置环境变量&quot;&gt;&lt;a href=&quot;#Swift下配置环境变量&quot; class=&quot;headerlink&quot; title=&quot;Swift下配置环境变量&quot;&gt;&lt;/a&gt;Swift下配置环境变量&lt;/h4&gt;&lt;p&gt;在项目配置界面选择发布环境的Target “Test1007”，点击Build Settings，找到Other Swift Flags，在Debug和Release下都添加环境变量”-D RELEASE_ENV”，如图：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/d7ec2f7e6073166d15fc64d488b42fcb.png&quot; alt=&quot;8&quot;&gt;&lt;/p&gt;
&lt;p&gt;添加完成后如图：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/2697bee36a116092b03257cfca9bf774.png&quot; alt=&quot;9&quot;&gt;&lt;/p&gt;
&lt;p&gt;同样的方法，分别在Target “Test1007_Test”和”Test1007_Prerelease”下添加TEST_ENV和PRERELEASE_ENV这两个宏。&lt;/p&gt;
&lt;p&gt;这样就完成了环境变量的配置。&lt;/p&gt;
&lt;h3 id=&quot;3-为不同环境的包配置不同的名称，BundleId和图标&quot;&gt;&lt;a href=&quot;#3-为不同环境的包配置不同的名称，BundleId和图标&quot; class=&quot;headerlink&quot; title=&quot;3. 为不同环境的包配置不同的名称，BundleId和图标&quot;&gt;&lt;/a&gt;3. 为不同环境的包配置不同的名称，BundleId和图标&lt;/h3&gt;&lt;p&gt;其实到这一步就已经完成了不同环境的配置，要切换环境，只需要切换左上角的Scheme就可以了。为了更好的区分不同环境下的包，可以给每个环境配置不同的App名称，BundleId和App图标，方法如下：&lt;/p&gt;
&lt;p&gt;在项目配置界面选中一个Target，通过修改Display Name和Bundle Identifier可以为不同环境的包设置不同的App名称和BundleId。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/98681390ae672ce58b2a541c3068e4c6.png&quot; alt=&quot;10&quot;&gt;&lt;/p&gt;
&lt;p&gt;要设置不同的图标，需要在Build Settings里找到”Asset Calalog App Icon Set Name”，其默认值是AppIcon，可以为不同Target设置不同的Icon Set Name，然后在Assets.xcassets中添加对应的Image Set即可。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/a9fa6a0db2bccb6d5945fe5c3f4d8360.png&quot; alt=&quot;11&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;总结&quot;&gt;&lt;a href=&quot;#总结&quot; class=&quot;headerlink&quot; title=&quot;总结&quot;&gt;&lt;/a&gt;总结&lt;/h2&gt;&lt;p&gt;本文是通过多个Target来实现多环境配置的，其实除了本文介绍的方法，还有其他方法可以实现多环境配置，具体可以参考&lt;a href=&quot;http://www.jianshu.com/p/83b6e781eb51&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;这篇文章&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;有了多环境配置，就可以很方便的实现多环境自动打包，如果在加入持续集成系统（例如jenkins等），就可以非常优雅的打包。这个以后有时间会专门写一篇博客来介绍相关内容。&lt;/p&gt;
&lt;p&gt;参考资料：&lt;br&gt;&lt;a href=&quot;http://www.jianshu.com/p/83b6e781eb51&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;手把手教你给一个iOS app配置多个环境变量&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://www.cocoachina.com/ios/20151023/13869.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;iOS开发必备–环境变量配置(Debug &amp;amp; Release)&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://kevindelord.io/2016/06/08/project-configuration/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Xcode Project Configuration&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;在移动客户端开发过程中，服务器一般都会提供多个环境的API接口，例如测试环境(TEST_ENV)，发布环境(RELEASE_ENV)，预发布
    
    </summary>
    
      <category term="iOS开发" scheme="http://liujinlongxa.com/categories/iOS%E5%BC%80%E5%8F%91/"/>
    
    
      <category term="Target" scheme="http://liujinlongxa.com/tags/Target/"/>
    
      <category term="Scheme" scheme="http://liujinlongxa.com/tags/Scheme/"/>
    
  </entry>
  
  <entry>
    <title>使用xUnique遇到了的问题</title>
    <link href="http://liujinlongxa.com/2016/10/04/%E4%BD%BF%E7%94%A8xUnique%E9%81%87%E5%88%B0%E4%BA%86%E7%9A%84%E9%97%AE%E9%A2%98/"/>
    <id>http://liujinlongxa.com/2016/10/04/使用xUnique遇到了的问题/</id>
    <published>2016-10-04T14:24:27.000Z</published>
    <updated>2016-10-04T14:46:58.000Z</updated>
    
    <content type="html">&lt;p&gt;xUnique是一个用来对iOS向的&lt;em&gt;.xcodeproj文件进行排序的工具，它可以降低&lt;/em&gt;.xcodeproj文件冲突的概率。其实质是一个Git Hook脚本，在提交一个Commit时，如果*.xcodeproj文件有修改，则会对文件进行重新排序。&lt;/p&gt;
&lt;p&gt;最近在使用时发现了一个问题，当我执行“pod install”安装第三方库时，在进行提交时会报”File ‘project.pbxproj’ is broken. Cannot find PBXProject name.”，从字面意思看’project.pbxproj’文件损坏，但是进入*.xcodeproj文件夹，双击‘project.pbxproj’，发现是可以打开的，并没有问题。&lt;/p&gt;
&lt;p&gt;最后通过查找资料，找到了原因，具体原因是由于在执行‘pod install’后，CocoaPods会重写‘project.pbxproj’文件，并且改变了它的格式，导致xUnique无法正确读取’project.pbxproj’文件。&lt;/p&gt;
&lt;p&gt;解决方法是：让xcode重新生成‘project.pbxproj’，具体步骤如下：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;先关闭xUnique，然后提交代码。关闭xUnique的方法是打开“&amp;lt;项目仓库根目录&amp;gt;/.git/hooks/pre-commit”文件，注释掉xUnique有关的内容&lt;/li&gt;
&lt;li&gt;做出任意一个可以导致’project.pbxproj’修改的修改，例如修改版本号，创建文件等，这样xcode会重写’project.pbxproj’文件&lt;/li&gt;
&lt;li&gt;打开xUnique，提交代码，这时xUnique就可以识别’project.pbxproj’文件了&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;参看文档：&lt;br&gt;&lt;a href=&quot;https://github.com/truebit/xUnique/issues/34&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;File ‘project.pbxproj’ is broken. Cannot find PBXProject name.&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;xUnique是一个用来对iOS向的&lt;em&gt;.xcodeproj文件进行排序的工具，它可以降低&lt;/em&gt;.xcodeproj文件冲突的概率。其实质是一个Git Hook脚本，在提交一个Commit时，如果*.xcodeproj文件有修改，则会对文件进行重新排序。&lt;/p&gt;
&lt;
    
    </summary>
    
      <category term="iOS Tips" scheme="http://liujinlongxa.com/categories/iOS-Tips/"/>
    
    
      <category term="其他" scheme="http://liujinlongxa.com/tags/%E5%85%B6%E4%BB%96/"/>
    
  </entry>
  
  <entry>
    <title>使用代码删除约束要注意的地方</title>
    <link href="http://liujinlongxa.com/2016/09/12/%E4%BD%BF%E7%94%A8%E4%BB%A3%E7%A0%81%E5%88%A0%E9%99%A4%E7%BA%A6%E6%9D%9F%E8%A6%81%E6%B3%A8%E6%84%8F%E7%9A%84%E5%9C%B0%E6%96%B9/"/>
    <id>http://liujinlongxa.com/2016/09/12/使用代码删除约束要注意的地方/</id>
    <published>2016-09-12T15:17:44.000Z</published>
    <updated>2016-09-12T15:57:44.000Z</updated>
    
    <content type="html">&lt;p&gt;使用代码删除特定约束的正确姿势：&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (IOS8_OR_LATER) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// iOS8之后删除约束的方法&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.authorLabelRightConstraint.active = &lt;span class=&quot;literal&quot;&gt;NO&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// iOS8之前删除约束的方法&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; removeConstraint:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.authorLabelRightConstraint];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;注意删除约束的方法在iOS8之前和之后是不一样的。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;使用代码删除特定约束的正确姿势：&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2
    
    </summary>
    
      <category term="iOS Tips" scheme="http://liujinlongxa.com/categories/iOS-Tips/"/>
    
    
      <category term="Autolayout" scheme="http://liujinlongxa.com/tags/Autolayout/"/>
    
  </entry>
  
  <entry>
    <title>做模糊效果时遇到的问题</title>
    <link href="http://liujinlongxa.com/2016/08/30/%E5%81%9A%E6%A8%A1%E7%B3%8A%E6%95%88%E6%9E%9C%E6%97%B6%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98/"/>
    <id>http://liujinlongxa.com/2016/08/30/做模糊效果时遇到的问题/</id>
    <published>2016-08-30T14:51:53.000Z</published>
    <updated>2016-08-30T15:14:07.000Z</updated>
    
    <content type="html">&lt;p&gt;最近在做图片模糊效果时遇到了一个很奇怪的问题，在iPhone6/iPhone6s上显示的模糊效果如下：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/4661eedc0a33e9c4535d95a005bde5d2.png&quot; alt=&quot;1&quot;&gt;&lt;/p&gt;
&lt;p&gt;但是在iPhone6 plus和iPhone6s plus上的模糊效果就如下图：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/e31355553287234ae1b78b6ea88389ac.png&quot; alt=&quot;2&quot;&gt;&lt;/p&gt;
&lt;p&gt;这明显效果不对，好像没有模糊一样。于是Google一些资料，终于找到了解决方法，解决方法是，在6Plus上不能设置过大的模糊半径，如果模糊半径过大，就会出现上图的效果。这和我使用的”UIImage+ImageEffects.h”也有关。&lt;/p&gt;
&lt;p&gt;原先设置的模糊半径为52，现在改成了在6Plus和6sPlus上是45，在6和6s上还是52，这样就没问题了。&lt;/p&gt;
&lt;p&gt;参考资料：&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://stackoverflow.com/questions/26002970/applyblurwithradius-working-on-iphone-6-not-6-uiimageimageeffects&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;applyBlurWithRadius working on iPhone 6, not 6+ (UIImage+ImageEffects)&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;最近在做图片模糊效果时遇到了一个很奇怪的问题，在iPhone6/iPhone6s上显示的模糊效果如下：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/4661eedc0a33e9c4535d95a005bde5
    
    </summary>
    
      <category term="iOS Tips" scheme="http://liujinlongxa.com/categories/iOS-Tips/"/>
    
    
      <category term="其他" scheme="http://liujinlongxa.com/tags/%E5%85%B6%E4%BB%96/"/>
    
  </entry>
  
  <entry>
    <title>使用Safair调试JS</title>
    <link href="http://liujinlongxa.com/2016/08/30/%E4%BD%BF%E7%94%A8Safair%E8%B0%83%E8%AF%95JS/"/>
    <id>http://liujinlongxa.com/2016/08/30/使用Safair调试JS/</id>
    <published>2016-08-30T13:46:33.000Z</published>
    <updated>2016-08-30T14:49:04.000Z</updated>
    
    <content type="html">&lt;p&gt;iOS项目中经常会用到Native界面和H5界面互相调用的情况，方法就是使用JavaScriptCore框架直接在原生界面中调用JS代码。如果JS代码较长，调试起来就会比较麻烦，这里介绍一种方法，可以让你轻松调试JS。&lt;/p&gt;
&lt;p&gt;首先，打开Safari，打开偏好设置（快捷键Cmd+,），在Advanced中选中”Show Develop menu in menu bar”，如下图：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/500ac2228a67a84dd4c20e73f104a560.png&quot; alt=&quot;1&quot;&gt;&lt;/p&gt;
&lt;p&gt;这样菜单栏就会出现一个Develop菜单，点击菜单Develop-&amp;gt;Simulator-&amp;gt;Automatically Show Web Inspector For JSContexts&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/211795a2560cf0bc3973a5d778d96343.png&quot; alt=&quot;2&quot;&gt;&lt;/p&gt;
&lt;p&gt;然后使用模拟器运行项目，当运行到JS代码时，就会自动启动调试器，如图：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/19c6bf7d6bce0e9b54f289ccc9025ecc.png&quot; alt=&quot;3&quot;&gt;&lt;/p&gt;
&lt;p&gt;和XCode一样，你可以打断点，当JS运行到这一句时就会进入断点&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/f6b607a7a949df00b9f2e20f11e7b29a.png&quot; alt=&quot;4&quot;&gt;&lt;/p&gt;
&lt;p&gt;当进入断点后，还可以打印出相应的局部变量&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/993f4e504f25bc37a79cc1f6ffd1a9ca.png&quot; alt=&quot;5&quot;&gt;&lt;/p&gt;
&lt;p&gt;以上就是使用Safari调试JS的方法。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;iOS项目中经常会用到Native界面和H5界面互相调用的情况，方法就是使用JavaScriptCore框架直接在原生界面中调用JS代码。如果JS代码较长，调试起来就会比较麻烦，这里介绍一种方法，可以让你轻松调试JS。&lt;/p&gt;
&lt;p&gt;首先，打开Safari，打开偏好设置（快
    
    </summary>
    
      <category term="iOS Tips" scheme="http://liujinlongxa.com/categories/iOS-Tips/"/>
    
    
      <category term="其他" scheme="http://liujinlongxa.com/tags/%E5%85%B6%E4%BB%96/"/>
    
  </entry>
  
  <entry>
    <title>Mac下生成RSA密钥对要注意的问题</title>
    <link href="http://liujinlongxa.com/2016/08/25/Mac%E4%B8%8B%E7%94%9F%E6%88%90RSA%E5%AF%86%E9%92%A5%E5%AF%B9%E8%A6%81%E6%B3%A8%E6%84%8F%E7%9A%84%E9%97%AE%E9%A2%98/"/>
    <id>http://liujinlongxa.com/2016/08/25/Mac下生成RSA密钥对要注意的问题/</id>
    <published>2016-08-25T15:50:06.000Z</published>
    <updated>2016-08-25T16:24:15.000Z</updated>
    
    <content type="html">&lt;p&gt;生成RSA密钥一般使用的Openssl，方法如下：&lt;/p&gt;
&lt;p&gt;在终端输入命令openssl然后敲回车，进入openssl命令输入模式，如下：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/d0eff7b11f3bb040e28e46de5393d9d2.png&quot; alt=&quot;1&quot;&gt;&lt;/p&gt;
&lt;p&gt;然后输入一下三行命令：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;genrsa -out rsa_private_key.pem 1024&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;pkcs8 -topk8 -in rsa_private_key.pem -out pkcs8_rsa_private_key.pem -nocrypt&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;rsa -in rsa_private_key.pem -pubout -out rsa_public_key.pem&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;然后输入exit退出openssl命令输入模式，这样会在当前目录生成三个文件，如下：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/980dc450a7d1f4db0759d42ac882f54a.png&quot; alt=&quot;2&quot;&gt;&lt;/p&gt;
&lt;p&gt;其中：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;rsa_private_key.pem为私钥&lt;/li&gt;
&lt;li&gt;rsa_public_key.pem为公钥&lt;/li&gt;
&lt;li&gt;pkcs8_rsa_private_key.pem为PKCS#8编码的私钥&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;公钥没有问题，主要是私钥，私钥有两个，两个有什么区别，到底该用哪一个呢？&lt;/p&gt;
&lt;p&gt;主要区别在于：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;rsa_private_key.pem为PKCS#1编码，只包含RSA的密钥信息，是以”—–BEGIN RSA PRIVATE KEY—–”开头，以”—–END RSA PRIVATE KEY—–”结尾，如下图：&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/9927f538bea6e031960a0a908076ccdd.png&quot; alt=&quot;3&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;pkcs8_rsa_private_key.pem为PKCS#8编码，除了包含RSA密钥信息外，还包含一些附加信息，例如version和算法等，是以”—–BEGIN PRIVATE KEY—–”开头，以”—–END PRIVATE KEY—–”结尾的，如下图：&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/b98831c564629c062c9bfcb5f7868625.png&quot; alt=&quot;4&quot;&gt;&lt;/p&gt;
&lt;p&gt;Mac默认生成的是PKCS#1编码的私钥，而有的系统生成私钥是PKCS#8编码，具体用哪个这要看你的加密代码里是否对附加信息进行了校验判断，如果进行了校验，则应该使用PKCS#8编码的私钥，否则应该使用PKCS#1编码的私钥。&lt;/p&gt;
&lt;p&gt;我使用的是&lt;a href=&quot;https://github.com/ideawu/Objective-C-RSA&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;这个第三方库&lt;/a&gt;进行加密解密的，里面对附加信息进行了校验，所以应该使用PKCS#8编码的密钥。&lt;/p&gt;
&lt;h2 id=&quot;参考资料&quot;&gt;&lt;a href=&quot;#参考资料&quot; class=&quot;headerlink&quot; title=&quot;参考资料&quot;&gt;&lt;/a&gt;参考资料&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://github.com/ideawu/Objective-C-RSA&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Objective-C-RSA&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://github.com/ideawu/Objective-C-RSA/issues/15&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Objective-C-RSA Issuse #15&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://www.tuicool.com/articles/Rbu6zm&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;openssl生成RSA格式，并转为pkcs8格式&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;生成RSA密钥一般使用的Openssl，方法如下：&lt;/p&gt;
&lt;p&gt;在终端输入命令openssl然后敲回车，进入openssl命令输入模式，如下：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/d0eff7b11
    
    </summary>
    
      <category term="其他" scheme="http://liujinlongxa.com/categories/%E5%85%B6%E4%BB%96/"/>
    
    
      <category term="加密解密" scheme="http://liujinlongxa.com/tags/%E5%8A%A0%E5%AF%86%E8%A7%A3%E5%AF%86/"/>
    
  </entry>
  
  <entry>
    <title>使用ownCloud作为OmniFocus的云同步服务器</title>
    <link href="http://liujinlongxa.com/2016/08/24/%E4%BD%BF%E7%94%A8ownCloud%E4%BD%9C%E4%B8%BAOmniFocus%E7%9A%84%E4%BA%91%E5%90%8C%E6%AD%A5%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    <id>http://liujinlongxa.com/2016/08/24/使用ownCloud作为OmniFocus的云同步服务器/</id>
    <published>2016-08-24T14:47:22.000Z</published>
    <updated>2016-08-24T16:34:04.000Z</updated>
    
    <content type="html">&lt;p&gt;平时一直使用OmniFocus作为自己的时间管理工具，但是由于我使用的是破解版的（正版太贵，买不起啊），同步就变成了一件很麻烦的事。OmniFocus提供了两种同步方式，如下图：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/901f5c4cb502f3fc557e3c3cfa79ad2f.png&quot; alt=&quot;1&quot;&gt;&lt;/p&gt;
&lt;p&gt;一种是使用Omni官方的服务器同步，这种方式需要注册Omni官方账号，应该只有正版能用吧，我没有尝试；另一种方式是使用WebDAV进行同步，这里着重介绍第二种方式。&lt;/p&gt;
&lt;p&gt;本文主要分为以下几个部分：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;WebDAV简介&lt;/li&gt;
&lt;li&gt;ownCloud简介以及搭建方法&lt;/li&gt;
&lt;li&gt;使用ownCloud作为OmniFocus的同步服务器&lt;/li&gt;
&lt;li&gt;ownCloud的一些其他应用&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&quot;WebDAV简介&quot;&gt;&lt;a href=&quot;#WebDAV简介&quot; class=&quot;headerlink&quot; title=&quot;WebDAV简介&quot;&gt;&lt;/a&gt;WebDAV简介&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;http://baike.baidu.com/link?url=pXeqnwgtPiYSKdYGX9YjBH_XeAJsH-aRkQqEYPsbkQwf9hlbnF9RSuAHvCMLboSuENx55T8J9Pd27E6ybo7Aba&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;WebDAV&lt;/a&gt;是一种基于 HTTP 1.1协议的通讯协议，可以实现文件的同步。通俗来讲，我们可以利用WebDAV来实现类似百度云一样的网盘功能。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://blog.sina.com.cn/s/blog_4834fe810101fw17.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;这里&lt;/a&gt;有几个支持WebDAV协议的网盘，但是都是国外的，国内据我了解目前只有&lt;a href=&quot;http://www.jianguoyun.com/s/campaign/cpclanding/main?sch=bdcpc_nutstore_off&amp;amp;bdtj=1&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;坚果云&lt;/a&gt;一家支持WebDAV。至于国内的各大网盘为什么都不支持WebDAV，可以看&lt;a href=&quot;http://www.zhihu.com/question/21511143&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;这里&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;最初我也本来打算使用国外的网盘来实现WebDAV，但是担心速度不理想，而且国外网盘的免费空间都很小，所以就放弃了。至于坚果云，我也没有去尝试。&lt;/p&gt;
&lt;p&gt;进一步Google，于是就找到了ownCloud。&lt;/p&gt;
&lt;h2 id=&quot;ownCloud简介以及搭建方法&quot;&gt;&lt;a href=&quot;#ownCloud简介以及搭建方法&quot; class=&quot;headerlink&quot; title=&quot;ownCloud简介以及搭建方法&quot;&gt;&lt;/a&gt;ownCloud简介以及搭建方法&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://owncloud.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ownCloud&lt;/a&gt;是一个来自KDE社区开发的免费软件，提供私人的Web服务。当前主要功能包括文件管理（内建文件分享）、音乐、日历、联系人等等，可在PC和服务器上运行。简单来说就是一个基于Php的自建网盘。&lt;/p&gt;
&lt;p&gt;下面就跟着我使用ownCloud一步一步搭建自己的私人网盘。&lt;/p&gt;
&lt;h3 id=&quot;准备工作&quot;&gt;&lt;a href=&quot;#准备工作&quot; class=&quot;headerlink&quot; title=&quot;准备工作&quot;&gt;&lt;/a&gt;准备工作&lt;/h3&gt;&lt;p&gt;因为要把ownCloud搭建在服务器上，因此你需要有一个VPS，内存至少128M，越大越好，我这里使用的是&lt;a href=&quot;https://bandwagonhost.com/clientarea.php?action=products&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;搬运工VPS&lt;/a&gt;，如何购买VPS可以看我的&lt;a href=&quot;http://liujinlongxa.com/2016/06/11/%E6%89%93%E9%80%A0%E8%87%AA%E5%B7%B1%E7%9A%84%E7%BF%BB%E5%A2%99VPS:%E6%90%AC%E8%BF%90%E5%B7%A5VPS%E8%B4%AD%E4%B9%B0%E4%BD%BF%E7%94%A8%E6%B5%81%E7%A8%8B%E5%85%A8%E8%AE%B0%E5%BD%95/&quot;&gt;这篇博客&lt;/a&gt;。&lt;/p&gt;
&lt;h3 id=&quot;1-安装PHP和MySQL环境&quot;&gt;&lt;a href=&quot;#1-安装PHP和MySQL环境&quot; class=&quot;headerlink&quot; title=&quot;1. 安装PHP和MySQL环境&quot;&gt;&lt;/a&gt;1. 安装PHP和MySQL环境&lt;/h3&gt;&lt;p&gt;由于ownCloud使用php实现的，所以需要在你服务器上安装PHP和MySQL环境，这个网上有很多教程，也可以参考ownCloud给出的&lt;a href=&quot;https://doc.owncloud.org/server/9.1/admin_manual/installation/php_54_installation.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;官方教程&lt;/a&gt;。&lt;/p&gt;
&lt;h3 id=&quot;2-下载服务器源码&quot;&gt;&lt;a href=&quot;#2-下载服务器源码&quot; class=&quot;headerlink&quot; title=&quot;2. 下载服务器源码&quot;&gt;&lt;/a&gt;2. 下载服务器源码&lt;/h3&gt;&lt;p&gt;在任一文件夹下输入命令：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;wget https://download.owncloud.org/community/owncloud-9.1.0.tar.bz2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;tar xvf owncloud-9.1.0.tar.bz2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;然后改变owncloud这个文件的权限，命令如下：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;chmod 777 owncloud&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;3-添加管理员账号&quot;&gt;&lt;a href=&quot;#3-添加管理员账号&quot; class=&quot;headerlink&quot; title=&quot;3. 添加管理员账号&quot;&gt;&lt;/a&gt;3. 添加管理员账号&lt;/h3&gt;&lt;p&gt;使用浏览器访问地址&lt;a href=&quot;http://serveraddress/owncloud/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://serveraddress/owncloud/&lt;/a&gt; (serveraddress即你服务器的ip地址)就可以看到如下页面：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/5de5eb45600b86bae8e2c0cfdaadb319.png&quot; alt=&quot;2&quot;&gt;&lt;/p&gt;
&lt;p&gt;在这里自定义一个管理员的账号和密码，然后点击FinishSetup，这样一个ownCloud就搭建完成了。&lt;/p&gt;
&lt;h2 id=&quot;使用ownCloud作为OmniFocus的同步服务器&quot;&gt;&lt;a href=&quot;#使用ownCloud作为OmniFocus的同步服务器&quot; class=&quot;headerlink&quot; title=&quot;使用ownCloud作为OmniFocus的同步服务器&quot;&gt;&lt;/a&gt;使用ownCloud作为OmniFocus的同步服务器&lt;/h2&gt;&lt;p&gt;ownCloud搭建完成后，就可以把它作为Omni的同步服务器了，具体方法如下：&lt;/p&gt;
&lt;p&gt;打开OmniFocus的同步设置页面，选择WebDAV方式同步，然后在Address中填入如下地址：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;http://&lt;serveraddress&gt;/owncloud/remote.php/dav/files/&lt;adminname&gt;&lt;/adminname&gt;&lt;/serveraddress&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;serveraddress&gt;和&lt;adminname&gt;分别替换为你的服务器地址和刚才填的管理员用户名，如下图：&lt;/adminname&gt;&lt;/serveraddress&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/264b1ec833e6078643e9c2f40b2bf7aa.png&quot; alt=&quot;3&quot;&gt;&lt;/p&gt;
&lt;p&gt;然后点击“Sync Now”进行同步，会提示输入密码，输入刚才添加的管理员密码，然后就可以同步成功了。&lt;/p&gt;
&lt;p&gt;使用浏览器访问&lt;a href=&quot;http://serveraddress/owncloud/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://serveraddress/owncloud/&lt;/a&gt; ，就可以看到刚刚同步上去的文件了，如下图：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/0da7c4ef259b48e8f608540c27091cbd.png&quot; alt=&quot;4&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;ownCloud的一些其他应用&quot;&gt;&lt;a href=&quot;#ownCloud的一些其他应用&quot; class=&quot;headerlink&quot; title=&quot;ownCloud的一些其他应用&quot;&gt;&lt;/a&gt;ownCloud的一些其他应用&lt;/h2&gt;&lt;p&gt;ownCloud还提供了多平台的客户端，包括iOS，Android，Mac，Windows等，你可以下载一个Mac客户端，然后设置一个同步文件夹，凡是放在这个文件夹里的文件，都会被自动同步到服务器上。如下图：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/d7b6c828536bab1e8fa5a69a12332ebf.png&quot; alt=&quot;5&quot;&gt;&lt;/p&gt;
&lt;p&gt;我把Quiver的笔记数据也同步到了服务器上。&lt;/p&gt;
&lt;h2 id=&quot;结语&quot;&gt;&lt;a href=&quot;#结语&quot; class=&quot;headerlink&quot; title=&quot;结语&quot;&gt;&lt;/a&gt;结语&lt;/h2&gt;&lt;p&gt;其实ownCloud的功能还远不止这些，还有很多功能还待以后慢慢探索。&lt;/p&gt;
&lt;p&gt;类似ownCloud的还有一个叫&lt;a href=&quot;https://www.seafile.com/home/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;seafile&lt;/a&gt;的服务，两者的区别和优劣可以参考&lt;a href=&quot;http://www.zhihu.com/question/23929945&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;这里&lt;/a&gt;。&lt;/p&gt;
&lt;h2 id=&quot;参考资料&quot;&gt;&lt;a href=&quot;#参考资料&quot; class=&quot;headerlink&quot; title=&quot;参考资料&quot;&gt;&lt;/a&gt;参考资料&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://doc.owncloud.org/server/9.1/admin_manual/contents.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ownCloud官方文档&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://doc.owncloud.org/server/9.1/user_manual/files/access_webdav.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ownCloud关于WebDAV使用的文档&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://jjliu.blog.ustc.edu.cn/198/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;使用OwnCloud创建私有云&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;平时一直使用OmniFocus作为自己的时间管理工具，但是由于我使用的是破解版的（正版太贵，买不起啊），同步就变成了一件很麻烦的事。OmniFocus提供了两种同步方式，如下图：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clou
    
    </summary>
    
      <category term="其他" scheme="http://liujinlongxa.com/categories/%E5%85%B6%E4%BB%96/"/>
    
    
      <category term="其他" scheme="http://liujinlongxa.com/tags/%E5%85%B6%E4%BB%96/"/>
    
      <category term="WebDAV" scheme="http://liujinlongxa.com/tags/WebDAV/"/>
    
      <category term="ownCloud" scheme="http://liujinlongxa.com/tags/ownCloud/"/>
    
  </entry>
  
  <entry>
    <title>在VPS上搭建Git服务器</title>
    <link href="http://liujinlongxa.com/2016/08/07/%E5%9C%A8VPS%E4%B8%8A%E6%90%AD%E5%BB%BAGit%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    <id>http://liujinlongxa.com/2016/08/07/在VPS上搭建Git服务器/</id>
    <published>2016-08-07T07:27:52.000Z</published>
    <updated>2016-08-12T15:20:04.000Z</updated>
    
    <content type="html">&lt;p&gt;昨天尝试了在自己的VPS上搭建一个git服务器，中间踩了很多坑，下面是我整个搭建的过程。&lt;/p&gt;
&lt;h2 id=&quot;具体流程&quot;&gt;&lt;a href=&quot;#具体流程&quot; class=&quot;headerlink&quot; title=&quot;具体流程&quot;&gt;&lt;/a&gt;具体流程&lt;/h2&gt;&lt;h3 id=&quot;第一步：安装Git&quot;&gt;&lt;a href=&quot;#第一步：安装Git&quot; class=&quot;headerlink&quot; title=&quot;第一步：安装Git&quot;&gt;&lt;/a&gt;第一步：安装Git&lt;/h3&gt;&lt;p&gt;打开VPS(这里我用的是&lt;a href=&quot;https://bandwagonhost.com/index.php&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;搬运工&lt;/a&gt;，怎么购买VPS可以参考我的&lt;a href=&quot;http://liujinlongxa.com/2016/06/11/%E6%89%93%E9%80%A0%E8%87%AA%E5%B7%B1%E7%9A%84%E7%BF%BB%E5%A2%99VPS:%E6%90%AC%E8%BF%90%E5%B7%A5VPS%E8%B4%AD%E4%B9%B0%E4%BD%BF%E7%94%A8%E6%B5%81%E7%A8%8B%E5%85%A8%E8%AE%B0%E5%BD%95/&quot;&gt;这篇博客&lt;/a&gt;)的控制后台，进入Shell，然后输入命令：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;yum install -y git&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;执行完后如图：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/b9dd798ab599b9b53adebee98ebe5bbd.png&quot; alt=&quot;2&quot;&gt;&lt;/p&gt;
&lt;p&gt;查看Git版本，如果能显示Git版本，则说明安装成功。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/d7cdff1b7006e2c9b5f1e521319d903c.png&quot; alt=&quot;3&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;第二步：添加用户&quot;&gt;&lt;a href=&quot;#第二步：添加用户&quot; class=&quot;headerlink&quot; title=&quot;第二步：添加用户&quot;&gt;&lt;/a&gt;第二步：添加用户&lt;/h3&gt;&lt;p&gt;输入命令&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;adduser git&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;su git&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;添加一个名为git的用户，并且将当前用户切换到git&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/c5350088190cd59d220b4942b9d87eae.png&quot; alt=&quot;4&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;第三步：创建仓库&quot;&gt;&lt;a href=&quot;#第三步：创建仓库&quot; class=&quot;headerlink&quot; title=&quot;第三步：创建仓库&quot;&gt;&lt;/a&gt;第三步：创建仓库&lt;/h3&gt;&lt;p&gt;创建一个文件夹用来存放git仓库，然后输入命令&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;git init --bare mycode.git&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这样就可以创建一个裸仓库，因为服务器上的Git仓库纯粹是为了共享，所以不让用户直接登录到服务器上去改工作区，如下图：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/c58f27e2d859d984c844371a43a37ab8.png&quot; alt=&quot;5&quot;&gt;&lt;/p&gt;
&lt;p&gt;把服务器的git仓库的用户组改为git&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/26a614c08121e4b0f8783551208e2d19.png&quot; alt=&quot;6&quot;&gt;&lt;/p&gt;
&lt;p&gt;这样仓库就创建完了&lt;/p&gt;
&lt;h3 id=&quot;第四步：创建证书&quot;&gt;&lt;a href=&quot;#第四步：创建证书&quot; class=&quot;headerlink&quot; title=&quot;第四步：创建证书&quot;&gt;&lt;/a&gt;第四步：创建证书&lt;/h3&gt;&lt;p&gt;在服务器/homg/git目录下创建文件夹.ssh，然后在.ssh文件夹里创建authorized_keys&lt;/p&gt;
&lt;p&gt;&lt;strong&gt; 注意：一定要切换到git用户下再创建，否则使用root用户创建，会因为文件夹权限的问题而造成RSA校验失败，我就是在这里卡了半天 &lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;然后在客户端创建公钥，即~/.ssh/id_rsa.pub文件里的内容，然后把公钥填入服务器的authorized_keys文件中&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/9eca6530c312dc064c8901735ef9942e.png&quot; alt=&quot;7&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/7c38fa2c806440f162b83208038a8dc9.png&quot; alt=&quot;8&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;第五步：打开服务器RSA验证&quot;&gt;&lt;a href=&quot;#第五步：打开服务器RSA验证&quot; class=&quot;headerlink&quot; title=&quot;第五步：打开服务器RSA验证&quot;&gt;&lt;/a&gt;第五步：打开服务器RSA验证&lt;/h3&gt;&lt;p&gt;进入服务器/etc/ssh目录，使用vim打开sshd_config（建议先做一个备份），修改如下内容&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;RSAAuthentication yes     &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;PubkeyAuthentication yes     &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;AuthorizedKeysFile  .ssh/authorized_keys&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;大部分Linux系统的RSA认证默认就是开启的，如果已经开启，则可以忽略(在这里也卡了好久😭)&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/9d534724207d6319fcf654142e91ba24.png&quot; alt=&quot;9&quot;&gt;&lt;/p&gt;
&lt;p&gt;然后保存退出，重新启动sshd&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/74d02be9217b7ea806af5970560ac956.png&quot; alt=&quot;10&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;第六步：修改指定服务器的ssh端口&quot;&gt;&lt;a href=&quot;#第六步：修改指定服务器的ssh端口&quot; class=&quot;headerlink&quot; title=&quot;第六步：修改指定服务器的ssh端口&quot;&gt;&lt;/a&gt;第六步：修改指定服务器的ssh端口&lt;/h3&gt;&lt;p&gt;一般ssh访问默认的端口是22，但是搬运工VPS修改了ssh访问的端口，而Git访问还是用还是22端口，因此要修改Git使用ssh访问的端口(在这里也卡了好久😭)，要查看ssh端口可以在服务器的sshd_config文件中查看，如下：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/b2f7743ffae9917e88f0ace60e11637b.png&quot; alt=&quot;11&quot;&gt;&lt;/p&gt;
&lt;p&gt; 如果不想修改服务器端口配置，可以修改客户端访问端口。在客户端的/~/.ssh/config文件中添加如下两行，第一行是服务器的地址，第二行是服务器的端口&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/17e45daf40d28f1174387104a3daef40.png&quot; alt=&quot;12&quot;&gt;&lt;/p&gt;
&lt;p&gt;这样就修改了访问指定服务器时的ssh端口。&lt;/p&gt;
&lt;h3 id=&quot;第七步：创建本地仓库&quot;&gt;&lt;a href=&quot;#第七步：创建本地仓库&quot; class=&quot;headerlink&quot; title=&quot;第七步：创建本地仓库&quot;&gt;&lt;/a&gt;第七步：创建本地仓库&lt;/h3&gt;&lt;p&gt;经过以上六步，一个Git服务器就建立好了，现在你就可以把仓库clone下来，然后开始使用了。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/285c535aa2610ae916b1f964617a8d68.png&quot; alt=&quot;13&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;遇到的坑&quot;&gt;&lt;a href=&quot;#遇到的坑&quot; class=&quot;headerlink&quot; title=&quot;遇到的坑&quot;&gt;&lt;/a&gt;遇到的坑&lt;/h2&gt;&lt;p&gt;在整个搭建过程中，我也踩了很多坑，下面对这些坑做一个总结。&lt;/p&gt;
&lt;h3 id=&quot;服务器与客户端ssh端口不一致&quot;&gt;&lt;a href=&quot;#服务器与客户端ssh端口不一致&quot; class=&quot;headerlink&quot; title=&quot;服务器与客户端ssh端口不一致&quot;&gt;&lt;/a&gt;服务器与客户端ssh端口不一致&lt;/h3&gt;&lt;p&gt;在完成创建证书之后，按理说，应该已经可以clone仓库了，但是我尝试克隆会报如下错误：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/e5bc21bbdb55bcdf473e6addf69cf495.png&quot; alt=&quot;14&quot;&gt;&lt;/p&gt;
&lt;p&gt;网上找了很多方法，最后发现是因为客户端和服务器的ssh端口不一致导致，修改了客户端的ssh访问端口才解决了这个问题。&lt;/p&gt;
&lt;p&gt;相关参考：&lt;a href=&quot;http://zengrong.net/post/1544.htm&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;修改了SSH默认端口之后，如何配置git？&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;ssh验证失败&quot;&gt;&lt;a href=&quot;#ssh验证失败&quot; class=&quot;headerlink&quot; title=&quot;ssh验证失败&quot;&gt;&lt;/a&gt;ssh验证失败&lt;/h3&gt;&lt;p&gt;修改了ssh端口后，可以访问仓库了，但是每次访问都要输入密码，按理说我已经创建了证书，并且也把公钥放到了服务器，为什么还是不行呢？&lt;/p&gt;
&lt;p&gt;找了半天，发现服务器的RSA身份校验压根就没有开启，ssh在校验时是先使用RSA进行校验，如果校验失败再使用密码进行校验。修改sshd_config文件，打开身份校验，参照上面的第五步。&lt;/p&gt;
&lt;p&gt;打开身份校验之后，发现还是要输入密码。最初我的做法是关闭服务器的ssh密码校验，修改服务器/etc/ssh/sshd_config文件如下内容：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;PasswordAuthentication no&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/fadd0406c6a9e9c02402e170082c82c7.png&quot; alt=&quot;15&quot;&gt;&lt;/p&gt;
&lt;p&gt;然后重启sshd。&lt;/p&gt;
&lt;p&gt;这样修改了之后，由于禁止了密码验证的方式，而RSA验证又失败，所以压根验证失败，访问都访问不了了。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/2b0a4555687ea4fe8326f690ee35533e.png&quot; alt=&quot;16&quot;&gt;&lt;/p&gt;
&lt;p&gt;然后我尝试看Log，输入命令：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;ssh git@xxx.xxx.xxx.xxx -vvv&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;从Log上看，客户端已经把key传给了服务器，但是服务器在验证时失败了，所以八成可能是服务器的问题。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/8ec00cb79352b30a2f95a1b48410cdfe.png&quot; alt=&quot;20&quot;&gt;&lt;/p&gt;
&lt;p&gt;然后我又根据&lt;a href=&quot;http://www.androiddev.net/ssh-public-key-authentication-error/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;这篇博客&lt;/a&gt;修改了目录的权限，但是还是不行。&lt;/p&gt;
&lt;p&gt;根据&lt;a href=&quot;http://flysnowxf.iteye.com/blog/1567570&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;这篇博客&lt;/a&gt;关闭了SELinux也还是不行。&lt;/p&gt;
&lt;p&gt;然后我又根据&lt;a href=&quot;http://blog.csdn.net/lansesl2008/article/details/16113193&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;这篇博客&lt;/a&gt;打开了ssh的log，修改sshd_config如下内容：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/3dc7b3340f6b693b047ecbee93400564.png&quot; alt=&quot;17&quot;&gt;&lt;/p&gt;
&lt;p&gt;然后又重新登录和退出几次ssh，在/var/log/secure里看到了如下内容：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/4f320784c4d9d731d53b3792856ec4dd.png&quot; alt=&quot;18&quot;&gt;&lt;/p&gt;
&lt;p&gt;并没有什么有用的信息，不知道是不是我的Log配置的有问题。&lt;/p&gt;
&lt;p&gt;找了很多资料，有很多文章都提到了文件夹权限的问题，于是我又回到服务器git目录下看了一下文件夹的权限：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/c9be98241282c46c0111cb25e1be9aa4.png&quot; alt=&quot;19&quot;&gt;&lt;/p&gt;
&lt;p&gt;原来我在创建.ssh目录是用的是root账户，所有造成ssh在进行身份认证时没有权限方位.ssh目录，导致认证失败。输入命令&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;chown git .ssh&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;将.ssh文件夹的所属用户改为git，.ssh里的authorized_keys文件也做相同的处理，这样改了之后终于可以验证成功了，并且不用输入密码了。&lt;/p&gt;
&lt;h2 id=&quot;总结&quot;&gt;&lt;a href=&quot;#总结&quot; class=&quot;headerlink&quot; title=&quot;总结&quot;&gt;&lt;/a&gt;总结&lt;/h2&gt;&lt;p&gt;整个搭建过程用了将近一天的时间，虽然过程有些曲折，但是最终还是成功了，而且这个过程中我也学到了不少的东西，更加深入的了解了ssh服务。&lt;/p&gt;
&lt;p&gt;希望这篇文章能对大家在搭建git服务器时有所帮助。&lt;/p&gt;
&lt;h2 id=&quot;参考资料&quot;&gt;&lt;a href=&quot;#参考资料&quot; class=&quot;headerlink&quot; title=&quot;参考资料&quot;&gt;&lt;/a&gt;参考资料&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;http://blog.csdn.net/wave_1102/article/details/47779401&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;在CentOS下搭建自己的Git服务器&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://blog.csdn.net/jacky0922/article/details/17999271&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ssh无密码登录认证失败&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://blog.csdn.net/lansesl2008/article/details/16113193&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;sshd_config配置详解&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://www.androiddev.net/ssh-public-key-authentication-error/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;一个SSH 公钥登录失败的问题及解决经验&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://www.linuxquestions.org/questions/linux-newbie-8/permission-denied-publickey-gssapi-keyex-gssapi-with-mic-password-4175413607/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Permission denied (publickey, gssapi-keyex,gssapi-with-mic,password)&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://flysnowxf.iteye.com/blog/1567570&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ssh使用公钥授权不通过的问题解决&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://zengrong.net/post/1544.htm&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;修改了SSH默认端口之后，如何配置git？&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;昨天尝试了在自己的VPS上搭建一个git服务器，中间踩了很多坑，下面是我整个搭建的过程。&lt;/p&gt;
&lt;h2 id=&quot;具体流程&quot;&gt;&lt;a href=&quot;#具体流程&quot; class=&quot;headerlink&quot; title=&quot;具体流程&quot;&gt;&lt;/a&gt;具体流程&lt;/h2&gt;&lt;h3 id=&quot;第一步：安
    
    </summary>
    
      <category term="Git" scheme="http://liujinlongxa.com/categories/Git/"/>
    
    
      <category term="Git" scheme="http://liujinlongxa.com/tags/Git/"/>
    
  </entry>
  
  <entry>
    <title>使用HTTPS方法clone下来的Git仓库push时报错</title>
    <link href="http://liujinlongxa.com/2016/07/30/%E4%BD%BF%E7%94%A8HTTPS%E6%96%B9%E6%B3%95clone%E4%B8%8B%E6%9D%A5%E7%9A%84Git%E4%BB%93%E5%BA%93push%E6%97%B6%E6%8A%A5%E9%94%99/"/>
    <id>http://liujinlongxa.com/2016/07/30/使用HTTPS方法clone下来的Git仓库push时报错/</id>
    <published>2016-07-30T03:22:55.000Z</published>
    <updated>2016-08-14T07:42:31.000Z</updated>
    
    <content type="html">&lt;p&gt;昨天在使用Git时遇到了一个问题，今天记录一下。&lt;/p&gt;
&lt;p&gt;一般我在克隆Github的项目时都是使用ssh的方式进行的，这样只要你的ssh-key配置正确，就没有问题。昨天心血来潮试了一下https克隆了一个项目，修改完后，准备push的时候需要了问题，问题如下：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;remote: Permission to liujinlongxa/Spoon-Knife.git denied to xxxx.&lt;br&gt;fatal: unable to access ‘&lt;a href=&quot;https://github.com/liujinlongxa/Spoon-Knife.git/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/liujinlongxa/Spoon-Knife.git/&lt;/a&gt;‘: The requested URL returned error: 403&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;解决方案是修改git的配置文件，&lt;/p&gt;
&lt;p&gt;&lt;code&gt;vim .git/config&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;将&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;[remote “origin”]&lt;br&gt;        url = &lt;a href=&quot;https://github.com/liujinlongxa/Spoon-Knife.git&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/liujinlongxa/Spoon-Knife.git&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;改为&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;[remote “origin”]&lt;br&gt;        url = &lt;a href=&quot;https://liujinlongxa@github.com/liujinlongxa/Spoon-Knife.git&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://liujinlongxa@github.com/liujinlongxa/Spoon-Knife.git&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;即前面加上用户名，这样就可以正常的push，或者直接运行命令&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;git config --local remote.origin.url https://liujinlongxa@github.com/liujinlongxa/Spoon-Knife.git&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;也可以达到相同的效果。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;昨天在使用Git时遇到了一个问题，今天记录一下。&lt;/p&gt;
&lt;p&gt;一般我在克隆Github的项目时都是使用ssh的方式进行的，这样只要你的ssh-key配置正确，就没有问题。昨天心血来潮试了一下https克隆了一个项目，修改完后，准备push的时候需要了问题，问题如下：&lt;/p
    
    </summary>
    
      <category term="Git" scheme="http://liujinlongxa.com/categories/Git/"/>
    
    
      <category term="Git" scheme="http://liujinlongxa.com/tags/Git/"/>
    
  </entry>
  
  <entry>
    <title>UIButton设置标题无效</title>
    <link href="http://liujinlongxa.com/2016/07/26/UIButton%E8%AE%BE%E7%BD%AE%E6%A0%87%E9%A2%98%E6%97%A0%E6%95%88/"/>
    <id>http://liujinlongxa.com/2016/07/26/UIButton设置标题无效/</id>
    <published>2016-07-26T15:19:02.000Z</published>
    <updated>2016-08-12T15:20:04.000Z</updated>
    
    <content type="html">&lt;p&gt;UIButton在使用&lt;code&gt;setAttributedTitle:forState:&lt;/code&gt;设置了富文本标题后，是使用&lt;code&gt;setTitle:forState:&lt;/code&gt;设置标题是没有效果的，解决方案是先把富文本去掉，然后再使用&lt;code&gt;setTitle:forState:&lt;/code&gt;设置标题，或者直接使用&lt;code&gt;setAttributedTitle:forState:&lt;/code&gt;重新设置不带属性的富文本。代码如下：&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;[&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.payButton setAttributedTitle:&lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt; forState:&lt;span class=&quot;built_in&quot;&gt;UIControlStateNormal&lt;/span&gt;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.payButton setTitle:&lt;span class=&quot;string&quot;&gt;@&quot;余额不足，去充值&quot;&lt;/span&gt; forState:&lt;span class=&quot;built_in&quot;&gt;UIControlStateNormal&lt;/span&gt;];&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;UIButton在使用&lt;code&gt;setAttributedTitle:forState:&lt;/code&gt;设置了富文本标题后，是使用&lt;code&gt;setTitle:forState:&lt;/code&gt;设置标题是没有效果的，解决方案是先把富文本去掉，然后再使用&lt;code&gt;setTit
    
    </summary>
    
      <category term="iOS Tips" scheme="http://liujinlongxa.com/categories/iOS-Tips/"/>
    
    
      <category term="UIButton" scheme="http://liujinlongxa.com/tags/UIButton/"/>
    
  </entry>
  
  <entry>
    <title>深入理解CoreAnimation的fillMode和isRemovedOnCompletion</title>
    <link href="http://liujinlongxa.com/2016/07/10/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3CoreAnimation%E7%9A%84fillMode%E5%92%8CisRemovedOnCompletion/"/>
    <id>http://liujinlongxa.com/2016/07/10/深入理解CoreAnimation的fillMode和isRemovedOnCompletion/</id>
    <published>2016-07-10T06:34:06.000Z</published>
    <updated>2016-08-12T15:20:04.000Z</updated>
    
    <content type="html">&lt;p&gt;一般在使用CoreAnimation写动画是，在定义CAAnimation时，都要加入如下两句来防止动画完成后视图的位置又还原成了原来的位置。&lt;/p&gt;
&lt;figure class=&quot;highlight swift&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;animation.fillMode = kCAFillModeBoth&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;animation.isRemovedOnCompletion = &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;很少有文章能详细说明这两个属性的作用，今天我们就来深究一下这两个属性。&lt;/p&gt;
&lt;h2 id=&quot;fillMode&quot;&gt;&lt;a href=&quot;#fillMode&quot; class=&quot;headerlink&quot; title=&quot;fillMode&quot;&gt;&lt;/a&gt;fillMode&lt;/h2&gt;&lt;p&gt;fillMode是一个枚举值，用于表示动画在开始和结束时的状态，这样说可能不太好理解，直接看例子比较直观。&lt;/p&gt;
&lt;h3 id=&quot;kCAFillModeRemoved&quot;&gt;&lt;a href=&quot;#kCAFillModeRemoved&quot; class=&quot;headerlink&quot; title=&quot;kCAFillModeRemoved&quot;&gt;&lt;/a&gt;kCAFillModeRemoved&lt;/h3&gt;&lt;p&gt;这个是fillMode的默认值，表示在到达beginTime时才显示动画的第一帧，动画结束时，删除CALayer做的变化&lt;/p&gt;
&lt;p&gt;实例代码：&lt;/p&gt;
&lt;figure class=&quot;highlight swift&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;touchesBegan&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(touches: Set&amp;lt;UITouch&amp;gt;, withEvent event: UIEvent?)&lt;/span&gt;&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; move = &lt;span class=&quot;type&quot;&gt;CABasicAnimation&lt;/span&gt;(keyPath: &lt;span class=&quot;string&quot;&gt;&quot;position.y&quot;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    move.fromValue = &lt;span class=&quot;number&quot;&gt;100&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    move.toValue = &lt;span class=&quot;number&quot;&gt;500&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    move.duration = &lt;span class=&quot;number&quot;&gt;1.0&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    move.beginTime = &lt;span class=&quot;type&quot;&gt;CACurrentMediaTime&lt;/span&gt;() + &lt;span class=&quot;number&quot;&gt;2.0&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    move.fillMode = kCAFillModeRemoved&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.myView.layer.add(move, forKey: &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;代码中，我们将一个View的y坐标从100移动到500，历时1s，注意开始时间我设定为了&lt;code&gt;CACurrentMediaTime() + 2.0&lt;/code&gt;，即添加动画2s后才开始执行动画，这样才能看到效果。运行结果如下：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/kCAFillModeRemoved.gif&quot; alt=&quot;kCAFillModeRemoved&quot;&gt;&lt;/p&gt;
&lt;p&gt;可以看到，在鼠标点击触发后，2s之后myView才移动到了动画的初始位置100开始执行动画，并且在动画结束后视图又立刻恢复到原来的位置。&lt;/p&gt;
&lt;h3 id=&quot;kCAFillModeBackwards&quot;&gt;&lt;a href=&quot;#kCAFillModeBackwards&quot; class=&quot;headerlink&quot; title=&quot;kCAFillModeBackwards&quot;&gt;&lt;/a&gt;kCAFillModeBackwards&lt;/h3&gt;&lt;p&gt;这个值表示无论是否到达beginTime，动画开始后，立刻显示动画的第一帧，修改代码如下：&lt;/p&gt;
&lt;figure class=&quot;highlight swift&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;touchesBegan&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(touches: Set&amp;lt;UITouch&amp;gt;, withEvent event: UIEvent?)&lt;/span&gt;&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; move = &lt;span class=&quot;type&quot;&gt;CABasicAnimation&lt;/span&gt;(keyPath: &lt;span class=&quot;string&quot;&gt;&quot;position.y&quot;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    move.fromValue = &lt;span class=&quot;number&quot;&gt;100&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    move.toValue = &lt;span class=&quot;number&quot;&gt;500&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    move.duration = &lt;span class=&quot;number&quot;&gt;1.0&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    move.beginTime = &lt;span class=&quot;type&quot;&gt;CACurrentMediaTime&lt;/span&gt;() + &lt;span class=&quot;number&quot;&gt;2.0&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    move.fillMode = kCAFillModeBackwards&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.myView.layer.add(move, forKey: &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;运行效果如下：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/kCAFillModeBackwards.gif&quot; alt=&quot;kCAFillModeBackwards&quot;&gt;&lt;/p&gt;
&lt;p&gt;可以看到，鼠标点击后，myView立刻移动到了动画的初始位置100，然后2s后开始执行动画。&lt;/p&gt;
&lt;h3 id=&quot;kCAFillModeForwards&quot;&gt;&lt;a href=&quot;#kCAFillModeForwards&quot; class=&quot;headerlink&quot; title=&quot;kCAFillModeForwards&quot;&gt;&lt;/a&gt;kCAFillModeForwards&lt;/h3&gt;&lt;p&gt;这个值表示在到达beginTime时显示动画的第一帧，在动画结束时，保持动画最后一帧的状态，直到动画被删除，修改代码如下：&lt;/p&gt;
&lt;figure class=&quot;highlight swift&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;touchesBegan&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;number&quot;&gt;_&lt;/span&gt; touches: Set&amp;lt;UITouch&amp;gt;, with event: UIEvent?)&lt;/span&gt;&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; move = &lt;span class=&quot;type&quot;&gt;CABasicAnimation&lt;/span&gt;(keyPath: &lt;span class=&quot;string&quot;&gt;&quot;position.y&quot;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    move.fromValue = &lt;span class=&quot;number&quot;&gt;100&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    move.toValue = &lt;span class=&quot;number&quot;&gt;500&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    move.duration = &lt;span class=&quot;number&quot;&gt;1.0&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    move.beginTime = &lt;span class=&quot;type&quot;&gt;CACurrentMediaTime&lt;/span&gt;() + &lt;span class=&quot;number&quot;&gt;2.0&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    move.fillMode = kCAFillModeForwards;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    move.isRemovedOnCompletion = &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    move.delegate = &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.myView.layer.add(move, forKey: &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;animationDidStop&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;number&quot;&gt;_&lt;/span&gt; anim: CAAnimation, finished flag: Bool)&lt;/span&gt;&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;type&quot;&gt;DispatchQueue&lt;/span&gt;.main.after(when: .now() + &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.myView.layer.removeAllAnimations()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;代码中添加了&lt;code&gt;move.isRemovedOnCompletion = false&lt;/code&gt;，即动画执行完后不立刻删除动画，默认情况下，动画执行完后会立刻删除动画。&lt;code&gt;isRemovedOnCompletion&lt;/code&gt;属性设置为false后，就不会立刻删除。然后我们还添加了&lt;code&gt;animationDidStop&lt;/code&gt;方法，这个是&lt;code&gt;CABasicAnimation&lt;/code&gt;的代理方法，在动画执行结束时会被调用。我们在这个方法里延时3s删除动画。运行效果如下：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/kCAFillModeForwards.gif&quot; alt=&quot;kCAFillModeForwards&quot;&gt;&lt;/p&gt;
&lt;p&gt;可以看到，鼠标点击后，myView等了2s才移动到动画初始位置，动画结束后，等待了3s，myView才恢复到原来的位置。也就是动画结束后会保持最后一帧的状态，直到动画被删除掉。&lt;/p&gt;
&lt;h3 id=&quot;kCAFillModeBoth&quot;&gt;&lt;a href=&quot;#kCAFillModeBoth&quot; class=&quot;headerlink&quot; title=&quot;kCAFillModeBoth&quot;&gt;&lt;/a&gt;kCAFillModeBoth&lt;/h3&gt;&lt;p&gt;这个值相当于kCAFillModeBackwards与kCAFillModeForwards的共同合集，即无论是否到达beginTime，动画开始后，立刻显示动画的第一帧，并且在动画结束时保持最后一帧的状态，直到动画被删除。修改代码如下：&lt;/p&gt;
&lt;figure class=&quot;highlight swift&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;touchesBegan&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;number&quot;&gt;_&lt;/span&gt; touches: Set&amp;lt;UITouch&amp;gt;, with event: UIEvent?)&lt;/span&gt;&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; move = &lt;span class=&quot;type&quot;&gt;CABasicAnimation&lt;/span&gt;(keyPath: &lt;span class=&quot;string&quot;&gt;&quot;position.y&quot;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    move.fromValue = &lt;span class=&quot;number&quot;&gt;100&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    move.toValue = &lt;span class=&quot;number&quot;&gt;500&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    move.duration = &lt;span class=&quot;number&quot;&gt;1.0&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    move.beginTime = &lt;span class=&quot;type&quot;&gt;CACurrentMediaTime&lt;/span&gt;() + &lt;span class=&quot;number&quot;&gt;2.0&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    move.fillMode = kCAFillModeBoth;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    move.isRemovedOnCompletion = &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    move.delegate = &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.myView.layer.add(move, forKey: &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;animationDidStop&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;number&quot;&gt;_&lt;/span&gt; anim: CAAnimation, finished flag: Bool)&lt;/span&gt;&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;type&quot;&gt;DispatchQueue&lt;/span&gt;.main.after(when: .now() + &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.myView.layer.removeAllAnimations()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;运行效果如下：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/kCAFillModeBoth.gif&quot; alt=&quot;kCAFillModeBoth&quot;&gt;&lt;/p&gt;
&lt;p&gt;可以看到，鼠标点击后，myView立刻移动到了动画的初始位置，然后动画结束后，等待了3s，myView才恢复到原来的位置。&lt;/p&gt;
&lt;h2 id=&quot;更进一步的思考&quot;&gt;&lt;a href=&quot;#更进一步的思考&quot; class=&quot;headerlink&quot; title=&quot;更进一步的思考&quot;&gt;&lt;/a&gt;更进一步的思考&lt;/h2&gt;&lt;p&gt;以上就是我对fillMode的一个探究，下面再回到文章开头的那段代码&lt;/p&gt;
&lt;figure class=&quot;highlight swift&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;animation.fillMode = kCAFillModeBoth&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;animation.isRemovedOnCompletion = &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这时，就很明白了，设置fillMode为&lt;code&gt;kCAFillModeBoth&lt;/code&gt;，可以使视图在动画结束时，仍然停留在动画结束的位置，直到动画被删除。设置&lt;code&gt;isRemovedOnCompletion&lt;/code&gt;为false，可以使动画在结束后不被删除，这样视图就会永远停留在动画结束的位置。&lt;/p&gt;
&lt;p&gt;乍一看没什么问题，但仔细想想还是觉得有点奇怪，动画已经结束了为什么不删除，还占着内存。如果动画少还好，如果动画非常多，每个动画执行完了都不删除的话，那内存岂不是会爆掉，这是不能接受的。有没有办法能够既让视图停留在动画结束的位置，又能在动画结束后删除动画呢？&lt;/p&gt;
&lt;p&gt;当然有，直接上代码：&lt;/p&gt;
&lt;figure class=&quot;highlight swift&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;touchesBegan&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;number&quot;&gt;_&lt;/span&gt; touches: Set&amp;lt;UITouch&amp;gt;, with event: UIEvent?)&lt;/span&gt;&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; move = &lt;span class=&quot;type&quot;&gt;CABasicAnimation&lt;/span&gt;(keyPath: &lt;span class=&quot;string&quot;&gt;&quot;position.y&quot;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    move.fromValue = &lt;span class=&quot;number&quot;&gt;100&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    move.toValue = &lt;span class=&quot;number&quot;&gt;500&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    move.duration = &lt;span class=&quot;number&quot;&gt;1.0&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    move.beginTime = &lt;span class=&quot;type&quot;&gt;CACurrentMediaTime&lt;/span&gt;() + &lt;span class=&quot;number&quot;&gt;2.0&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    move.fillMode = kCAFillModeBoth;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    move.delegate = &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.myView.layer.add(move, forKey: &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.myView.layer.position.y = &lt;span class=&quot;number&quot;&gt;500&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;解决方法就是在视图添加动画后，手动修改视图的位置为动画结束后的最终位置，这样动画结束后，动画就会被删除并且视图会停留在动画结束时的位置。&lt;/p&gt;
&lt;p&gt;注意：这里应该使用layer的position，不能直接修改UIView的frame，否则动画效果会不正确。&lt;/p&gt;
&lt;h2 id=&quot;参考资料&quot;&gt;&lt;a href=&quot;#参考资料&quot; class=&quot;headerlink&quot; title=&quot;参考资料&quot;&gt;&lt;/a&gt;参考资料&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://www.raywenderlich.com/store/ios-animations-by-tutorials&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;iOS Animations by Tutorials&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;一般在使用CoreAnimation写动画是，在定义CAAnimation时，都要加入如下两句来防止动画完成后视图的位置又还原成了原来的位置。&lt;/p&gt;
&lt;figure class=&quot;highlight swift&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;
    
    </summary>
    
      <category term="iOS开发" scheme="http://liujinlongxa.com/categories/iOS%E5%BC%80%E5%8F%91/"/>
    
    
      <category term="CoreAnimation" scheme="http://liujinlongxa.com/tags/CoreAnimation/"/>
    
  </entry>
  
  <entry>
    <title>用XCode8打开Xib后项目不能在XCode7上运行</title>
    <link href="http://liujinlongxa.com/2016/07/03/%E7%94%A8XCode8%E6%89%93%E5%BC%80Xib%E5%90%8E%E9%A1%B9%E7%9B%AE%E4%B8%8D%E8%83%BD%E5%9C%A8XCode7%E4%B8%8A%E8%BF%90%E8%A1%8C/"/>
    <id>http://liujinlongxa.com/2016/07/03/用XCode8打开Xib后项目不能在XCode7上运行/</id>
    <published>2016-07-03T10:56:06.000Z</published>
    <updated>2016-08-12T15:20:04.000Z</updated>
    
    <content type="html">&lt;p&gt;可以设置xib以Xcode7.x的方法打开，参考如下&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://stackoverflow.com/questions/37851459/the-document-main-storyboard-requires-xcode-8-0-or-later&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;The document Main.storyboard requires Xcode 8.0 or later&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;可以设置xib以Xcode7.x的方法打开，参考如下&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://stackoverflow.com/questions/37851459/the-document-main-storyboard-requires-xcode-8-0-or
    
    </summary>
    
      <category term="iOS Tips" scheme="http://liujinlongxa.com/categories/iOS-Tips/"/>
    
    
      <category term="其他" scheme="http://liujinlongxa.com/tags/%E5%85%B6%E4%BB%96/"/>
    
  </entry>
  
  <entry>
    <title>Could not load the xxx image referenced from a nib in the bundle with identifier xxxx问题</title>
    <link href="http://liujinlongxa.com/2016/07/03/Could-not-load-the-xxx-image-referenced-from-a-nib-in-the-bundle-with-identifier-xxxx%E9%97%AE%E9%A2%98/"/>
    <id>http://liujinlongxa.com/2016/07/03/Could-not-load-the-xxx-image-referenced-from-a-nib-in-the-bundle-with-identifier-xxxx问题/</id>
    <published>2016-07-03T10:51:49.000Z</published>
    <updated>2016-08-12T15:20:04.000Z</updated>
    
    <content type="html">&lt;p&gt;出现在非retina的屏幕上，不能正确加载xib上的图片，只能通过代码重新设置图片。还没有找到其他解决办法。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;出现在非retina的屏幕上，不能正确加载xib上的图片，只能通过代码重新设置图片。还没有找到其他解决办法。&lt;/p&gt;

    
    </summary>
    
      <category term="iOS Tips" scheme="http://liujinlongxa.com/categories/iOS-Tips/"/>
    
    
      <category term="其他" scheme="http://liujinlongxa.com/tags/%E5%85%B6%E4%BB%96/"/>
    
  </entry>
  
  <entry>
    <title>设置富文本字间距，文字不能居中对齐</title>
    <link href="http://liujinlongxa.com/2016/07/03/%E8%AE%BE%E7%BD%AE%E5%AF%8C%E6%96%87%E6%9C%AC%E5%AD%97%E9%97%B4%E8%B7%9D%EF%BC%8C%E6%96%87%E5%AD%97%E4%B8%8D%E8%83%BD%E5%B1%85%E4%B8%AD%E5%AF%B9%E9%BD%90/"/>
    <id>http://liujinlongxa.com/2016/07/03/设置富文本字间距，文字不能居中对齐/</id>
    <published>2016-07-03T10:40:19.000Z</published>
    <updated>2016-08-12T15:20:04.000Z</updated>
    
    <content type="html">&lt;p&gt;最近有一个需求，需要设置一个UILabel的字间距，我马上就想到了富文本，于是就写了下面的代码&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *str = &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.label.text;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSDictionary&lt;/span&gt; *attribute = @&amp;#123;&lt;span class=&quot;built_in&quot;&gt;NSKernAttributeName&lt;/span&gt;:@(&lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;),&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                            &lt;span class=&quot;built_in&quot;&gt;NSFontAttributeName&lt;/span&gt;:[&lt;span class=&quot;built_in&quot;&gt;UIFont&lt;/span&gt; systemFontOfSize:&lt;span class=&quot;number&quot;&gt;15&lt;/span&gt;]&amp;#125;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSAttributedString&lt;/span&gt; *attStr = [[&lt;span class=&quot;built_in&quot;&gt;NSAttributedString&lt;/span&gt; alloc] initWithString:str attributes:attribute];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.label.attributedText = attStr;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;其中NSKernAttributeName属性就是设置文字的字间距。但是，现在就有一个问题，设置字间距后，原本居中显示的文字，不能居中显示了。&lt;/p&gt;
&lt;p&gt;这是我设置字间距之前的label&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/3cba47225e6b1a02cfad6885a67d83ed.png&quot; alt=&quot;1&quot;&gt;&lt;/p&gt;
&lt;p&gt;这是我设置了字间距后的label&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/424954a63f3e38514b84ab7277269336.png&quot; alt=&quot;2&quot;&gt;&lt;/p&gt;
&lt;p&gt;“你”字距左边距明显要比”鸿”字的右边距要大。&lt;/p&gt;
&lt;p&gt;经过一阵Google，在StackOverflow上找到了相同的问题，链接是&lt;a href=&quot;http://stackoverflow.com/questions/23741850/nsstring-drawinrectwithattributes-not-correctly-centered-when-using-nskernattr&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://stackoverflow.com/questions/23741850/nsstring-drawinrectwithattributes-not-correctly-centered-when-using-nskernattr&lt;/a&gt;，根据问题回答里的做法，我把代码做了修改，如下：&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *str = &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.label.text;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSMutableAttributedString&lt;/span&gt; *mutAttStr = [[&lt;span class=&quot;built_in&quot;&gt;NSMutableAttributedString&lt;/span&gt; alloc] initWithString:str];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[mutAttStr addAttribute:&lt;span class=&quot;built_in&quot;&gt;NSKernAttributeName&lt;/span&gt; value:@(&lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;) range:&lt;span class=&quot;built_in&quot;&gt;NSMakeRange&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, str.length - &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;)];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[mutAttStr addAttribute:&lt;span class=&quot;built_in&quot;&gt;NSFontAttributeName&lt;/span&gt; value:[&lt;span class=&quot;built_in&quot;&gt;UIFont&lt;/span&gt; systemFontOfSize:&lt;span class=&quot;number&quot;&gt;15&lt;/span&gt;] range:&lt;span class=&quot;built_in&quot;&gt;NSMakeRange&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, str.length)];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.label.attributedText = [mutAttStr &lt;span class=&quot;keyword&quot;&gt;copy&lt;/span&gt;];&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;修改后效果如下：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/35b1f58bf08aa3dc7b827edb1da01e80.png&quot; alt=&quot;3&quot;&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;最近有一个需求，需要设置一个UILabel的字间距，我马上就想到了富文本，于是就写了下面的代码&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;l
    
    </summary>
    
      <category term="iOS Tips" scheme="http://liujinlongxa.com/categories/iOS-Tips/"/>
    
    
      <category term="UILabel" scheme="http://liujinlongxa.com/tags/UILabel/"/>
    
      <category term="NSAttributedString" scheme="http://liujinlongxa.com/tags/NSAttributedString/"/>
    
  </entry>
  
  <entry>
    <title>UILabel设置lineBreakMode属性无效</title>
    <link href="http://liujinlongxa.com/2016/07/03/UILabel%E8%AE%BE%E7%BD%AElineBreakMode%E5%B1%9E%E6%80%A7%E6%97%A0%E6%95%88/"/>
    <id>http://liujinlongxa.com/2016/07/03/UILabel设置lineBreakMode属性无效/</id>
    <published>2016-07-03T10:09:30.000Z</published>
    <updated>2016-08-12T15:20:04.000Z</updated>
    
    <content type="html">&lt;p&gt;UILabel的lineBreakMode属性用于设置文字的截断方式，我在使用过程中，发现了一个问题，当我设置lineBreakMode为NSLineBreakByCharWrapping或NSLineBreakByWordWrapping时，有时会没有效果，它依然以NSLineBreakByClipping方式显示。&lt;/p&gt;
&lt;p&gt;经过一番Google，原来，要设置NSLineBreakByCharWrapping或NSLineBreakByWordWrapping，UILabel的numberOfLines必须是0，否则就会无效。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;UILabel的lineBreakMode属性用于设置文字的截断方式，我在使用过程中，发现了一个问题，当我设置lineBreakMode为NSLineBreakByCharWrapping或NSLineBreakByWordWrapping时，有时会没有效果，它依然以NSL
    
    </summary>
    
      <category term="iOS Tips" scheme="http://liujinlongxa.com/categories/iOS-Tips/"/>
    
    
      <category term="UILabel" scheme="http://liujinlongxa.com/tags/UILabel/"/>
    
  </entry>
  
  <entry>
    <title>从jekyll迁移到hexo</title>
    <link href="http://liujinlongxa.com/2016/07/01/%E4%BB%8Ejekyll%E8%BF%81%E7%A7%BB%E5%88%B0hexo/"/>
    <id>http://liujinlongxa.com/2016/07/01/从jekyll迁移到hexo/</id>
    <published>2016-07-01T13:24:50.000Z</published>
    <updated>2016-08-12T15:20:04.000Z</updated>
    
    <content type="html">&lt;p&gt;最近公司项目不是很忙，所以想把自己的博客好好整整，下面就是我从原先的jekyll迁移的hexo的整个过程的记录以及中间遇到的一些问题。&lt;/p&gt;
&lt;h2 id=&quot;安装Hexo&quot;&gt;&lt;a href=&quot;#安装Hexo&quot; class=&quot;headerlink&quot; title=&quot;安装Hexo&quot;&gt;&lt;/a&gt;安装Hexo&lt;/h2&gt;&lt;p&gt;打开终端，执行命令：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;$ npm install -g hexo-cli&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;然后随便找个文件夹，执行命令：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;$ hexo init .&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这个过程可能有些长，因为要安装很多依赖的包。&lt;/p&gt;
&lt;p&gt;执行完后，就会在这个文件中生成一些文件，如下图，这就是Hexo的主目录。然后执行命令&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;$ npm install&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这个命令一定要执行，否则后面在启动本地服务器预览是会出现“Get 404”错误。&lt;/p&gt;
&lt;p&gt;其他还要执行的命令有：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;$ npm install hexo-renderer-ejs --save&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;$ npm install hexo-renderer-stylus --save&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;$ npm install hexo-renderer-marked --save&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;$ npm install hexo-server --save&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这样就完成了安装，然后执行命令：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;hexo server&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;然后打开浏览器，输入&lt;a href=&quot;http://127.0.0.1:4000/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://127.0.0.1:4000/&lt;/a&gt;  ，就可以看到预览界面&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/5f8ddbc140ff9ec8ecbd1bb8bb119b4a.png&quot; alt=&quot;1&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;配置主题&quot;&gt;&lt;a href=&quot;#配置主题&quot; class=&quot;headerlink&quot; title=&quot;配置主题&quot;&gt;&lt;/a&gt;配置主题&lt;/h2&gt;&lt;p&gt;我选的是NexT主题，这个主题比较美观，而且最重要的是文档齐全，在&lt;a href=&quot;http://theme-next.iissnan.com/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;这里&lt;/a&gt;可以找到关于这个主题的所有内容。&lt;/p&gt;
&lt;p&gt;安装主题的方法很简单，在hexo主目录执行命令：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;git clone https://github.com/iissnan/hexo-theme-next themes/next&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;然后修改配置文件_config.yml，添加一下内容：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;theme: next&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;然后开启预览，就可以看到主题已经换成了新的主题&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/81a90b7504bc5d934c642d1395dd63ed.png&quot; alt=&quot;2&quot;&gt;&lt;/p&gt;
&lt;p&gt;更详细的配置可以参考这个主题的&lt;a href=&quot;http://theme-next.iissnan.com/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;文档&lt;/a&gt;。&lt;/p&gt;
&lt;h2 id=&quot;数据迁移&quot;&gt;&lt;a href=&quot;#数据迁移&quot; class=&quot;headerlink&quot; title=&quot;数据迁移&quot;&gt;&lt;/a&gt;数据迁移&lt;/h2&gt;&lt;p&gt;Hexo的数据迁移很简单，只要要以前jekyll主目录下的&lt;code&gt;_post&lt;/code&gt;文件夹里的所有文件拷贝到hexo目录下的&lt;code&gt;source/_posts&lt;/code&gt;,然后在配置文件_config.yml中添加如下内容：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;new_post_name: :year-:month-:day-:title.md&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这样就完成了数据迁移。其他框架的博客迁移到hexo可以参看&lt;a href=&quot;https://hexo.io/zh-cn/docs/migration.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;官方文档&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;这里要注意的是，之前在jekyll中，代码块是这样的格式：&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;% highlight objectiveC linenos %&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; * str = &lt;span class=&quot;string&quot;&gt;@&quot;I love coding!!&quot;&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;%@&quot;&lt;/span&gt;, str);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;% endhighlight %&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;但是在hexo不支持这样的格式，所以要全部替换成标准的Markdown代码块，这是比较蛋疼的地方。&lt;/p&gt;
&lt;p&gt;做完这些之后，再次打开预览，就可以看到原来的博客啦。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/d8627ec1356b590c21c2c6fba2cffd47.png&quot; alt=&quot;3&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;部署&quot;&gt;&lt;a href=&quot;#部署&quot; class=&quot;headerlink&quot; title=&quot;部署&quot;&gt;&lt;/a&gt;部署&lt;/h2&gt;&lt;p&gt;先安装hexo-deployer-git，执行命令：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;$ npm install hexo-deployer-git --save&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;然后在Github上创建一个仓库，然后开启Github Pages功能，可以参考&lt;a href=&quot;http://jingpin.jikexueyuan.com/article/33505.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;这篇文章&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;然后修改配置文件_config.yml,添加如下内容：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;deploy:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  type: git&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  repository: git@github.com:liujinlongxa/liujinlongxa.github.io.git&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  branch: master&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;然后执行命令&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;$ hexo deploy&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这样就把博客部署到了github上&lt;/p&gt;
&lt;h2 id=&quot;绑定独立域名&quot;&gt;&lt;a href=&quot;#绑定独立域名&quot; class=&quot;headerlink&quot; title=&quot;绑定独立域名&quot;&gt;&lt;/a&gt;绑定独立域名&lt;/h2&gt;&lt;p&gt;到万网购买了一个独立域名（后来才知道DNSPod的解析速度更快一些，后悔了），然后在hexo主目录下的source文件夹中创建一个名为CNAME的文件，里面填写你的独立域名，如下：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/307f1cb10cc4a3286cc1dd01b0d4f0ce.png&quot; alt=&quot;4&quot;&gt;&lt;/p&gt;
&lt;p&gt;然后重新部署一下，这样这个CNAME就会上传到Github仓库的根目录下。如下：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/69301b3770b43797bda6fbd110f08f87.png&quot; alt=&quot;5&quot;&gt;&lt;/p&gt;
&lt;p&gt;这里一定要注意，要把CNAME放在source文件夹里，如果直接从Github创建CNAME，重新部署博客后，会删掉添加的CNAME。&lt;/p&gt;
&lt;p&gt;然后就是添加域名解析，打开万网域名管理后台，添加如下解析&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/f696d7662bef60f14f045484df43f22e.png&quot; alt=&quot;6&quot;&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;192.30.252.153&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;192.30.252.154&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这两个IP是Github的IP，设置完后，过一会，就可以用独立域名访问了。&lt;/p&gt;
&lt;p&gt;这样一个Hexo博客就搭建完成了。&lt;/p&gt;
&lt;h2 id=&quot;写博客&quot;&gt;&lt;a href=&quot;#写博客&quot; class=&quot;headerlink&quot; title=&quot;写博客&quot;&gt;&lt;/a&gt;写博客&lt;/h2&gt;&lt;p&gt;Hexo自带命令可以生成生成一篇新的博客，如下：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;hexo new post &amp;quot;helloworld&amp;quot;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;然后就会生成一篇名为”helloworld”的博客。&lt;/p&gt;
&lt;p&gt;写完博客后，然后执行下面三条命令发布博客。&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;hexo clean&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;hexo generate&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;hexo deploy&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这里可以写一个脚本，一次性执行这三条命令。&lt;/p&gt;
&lt;h2 id=&quot;遇到的问题&quot;&gt;&lt;a href=&quot;#遇到的问题&quot; class=&quot;headerlink&quot; title=&quot;遇到的问题&quot;&gt;&lt;/a&gt;遇到的问题&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;执行hexo deploy后，CNAME和README.md文件消失&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;解决方法，把这两个文件放在source目录下，这样在部署时就会把这两个文件也放到github的根目录下&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/b371a047e69935cd2c92c11169483d00.png&quot; alt=&quot;7&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;执行hexo deploy后，README.md被渲染成了README.html&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;解决方法，在_config.yml中添加如下内容即可：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;skip_render: README.md&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;以上就是我从Jekyll迁移到Hexo的整个过程。&lt;/p&gt;
&lt;p&gt;参考资料：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://hexo.io/zh-cn/docs/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Hexo文档&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://theme-next.iissnan.com/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;NexT使用手册&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://blog.sunnyxx.com/2014/02/27/hexo_startup/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;hexo边搭边记&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;最近公司项目不是很忙，所以想把自己的博客好好整整，下面就是我从原先的jekyll迁移的hexo的整个过程的记录以及中间遇到的一些问题。&lt;/p&gt;
&lt;h2 id=&quot;安装Hexo&quot;&gt;&lt;a href=&quot;#安装Hexo&quot; class=&quot;headerlink&quot; title=&quot;安装Hex
    
    </summary>
    
      <category term="其他" scheme="http://liujinlongxa.com/categories/%E5%85%B6%E4%BB%96/"/>
    
    
      <category term="Hexo" scheme="http://liujinlongxa.com/tags/Hexo/"/>
    
  </entry>
  
  <entry>
    <title>GMTC全球移动技术大会见闻</title>
    <link href="http://liujinlongxa.com/2016/06/29/GMTC%E5%85%A8%E7%90%83%E7%A7%BB%E5%8A%A8%E6%8A%80%E6%9C%AF%E5%A4%A7%E4%BC%9A%E8%A7%81%E9%97%BB/"/>
    <id>http://liujinlongxa.com/2016/06/29/GMTC全球移动技术大会见闻/</id>
    <published>2016-06-28T16:00:00.000Z</published>
    <updated>2016-08-12T15:20:04.000Z</updated>
    
    <content type="html">&lt;p&gt;6月24日至6月25日，我有幸参加了“GMTC全球移动技术大会”，这篇博客就是我对参见会议的一个经历和感受。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/457acda7bd3dc65f172468c45dad4a8f.png&quot; alt=&quot;1&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;第一天上午&quot;&gt;&lt;a href=&quot;#第一天上午&quot; class=&quot;headerlink&quot; title=&quot;第一天上午&quot;&gt;&lt;/a&gt;第一天上午&lt;/h3&gt;&lt;p&gt;会议共分为两天，第一天上午是主会场，首先是主办方开场致辞，然后是京东，阿里和微信的三个技术负责人的演讲，主要讲了移动开发的现状以及未来的一些趋势，没有涉及到具体的技术。&lt;/p&gt;
&lt;p&gt;接下来是Facebook的一个前员工分享了”Facebook iOS App技术演化10年”，讲到了很多有意思的地方，这里令我印象比较深刻的是Facebook一共有1000+的iOS工程师，这个iOS App的代码行数超过1000万行，同时他也分享了Facebook App演化过程中走过的一些完了，例如H5，CoreData等。&lt;/p&gt;
&lt;p&gt;接下来也是一个硅谷的iOS开发者分享了“Mobile Growth 的方法和实践”，由于之前从来没有接触过Growth，所以听的也是一知半解，感觉与产品运营更相关。这就是第一天早上的整个会议。&lt;/p&gt;
&lt;h3 id=&quot;第一天下午&quot;&gt;&lt;a href=&quot;#第一天下午&quot; class=&quot;headerlink&quot; title=&quot;第一天下午&quot;&gt;&lt;/a&gt;第一天下午&lt;/h3&gt;&lt;p&gt;从第一天的下午开始，就开始分了几个分会场进行具体的技术分享。第一天下午有三个分会场，分别是动态化，Swift和新技术专场。&lt;/p&gt;
&lt;p&gt;我先是听了”函数式编程中的Swift与Swift中的函数式编程”，分享者是SwiftyJSON的作者，由于之前在使用RAC时已经接触过函数式编程，所以这个并不陌生，整个演讲主要是分享了函数式编程的一些思想。&lt;/p&gt;
&lt;p&gt;接下来我有听了“RN项目实战优化之路”，由于之前从来没接触过ReactNative，所有听得也是云里雾里，听到一半就跑去听”JSPatch成长之路”。&lt;/p&gt;
&lt;p&gt;JSPatch目前是当前比较热门的一种iOS热修复技术，演讲者就是JSPatch的作者，他分享了整个JSPatch发展过程中遇到的问题以及解决方案，很佩服作者为了推广JSPatch而做的各项工作，包括代码转换工具、XCode插件、JSPatch平台等等，这些工作极大地促进了JSPatch的推广使用，有机会我一定要尝试一下JSPatch。&lt;/p&gt;
&lt;p&gt;听完了JSPatch，我又去听了“当泛型遇上协议”，是猿题库的iOS负责人做的分享，之前看过他写的关于Swift的博客，演讲中，作者通过具体的代码分享自己在Swift的协议与泛型上的实践经验，如果能把泛型使用好确实能极大地简化自己的代码。&lt;/p&gt;
&lt;p&gt;最后我又听了”聚划算iOS平台动态化方案LuaView”，分享者是阿里聚划算的技术专家，LuaView提供了一种使用Lua脚本动态更新App的方案，演讲者讲解了LuaView的基本原理、使用以及对LuaView未来发展的一些规划。&lt;/p&gt;
&lt;p&gt;这样，第一天的会议就结束了。&lt;/p&gt;
&lt;h3 id=&quot;第二天上午&quot;&gt;&lt;a href=&quot;#第二天上午&quot; class=&quot;headerlink&quot; title=&quot;第二天上午&quot;&gt;&lt;/a&gt;第二天上午&lt;/h3&gt;&lt;p&gt;第二天上午也有三个分会场，分别是架构演进、VR/AR、移动解决方案。&lt;/p&gt;
&lt;p&gt;我先听了“360°全景视频播放器的实现原理”，演讲者是阿里的高级iOS工程师，分享了如何使用OpenGL实现全景视频播放，以前从来没有接触过这一块，所以听得也是迷迷糊糊。VR/AR目前是是一个很火的方向，但还处于发展的初期，不过有机会还是值得尝试尝试。&lt;/p&gt;
&lt;p&gt;接下来我又听了一段“手机天猫解耦之路”，我是中间进去的，会场挤满了人，分享者讲的东西也是干货满满。演讲嘉宾是天猫的无线技术专家，我听的那一块正好讲到了一种界面间解耦的思路，使用URL Server来实现界面间跳转。&lt;/p&gt;
&lt;p&gt;接下来又听了滴滴的iOS负责人分享的“滴滴的组件化实践与优化”，主要讲到了滴滴iOS端在发展中遇到的问题以及解决方案，重点讲了滴滴组件化的经历，也是干货满满。后面提到的灰度发布对我们目前的项目很有参考价值。&lt;/p&gt;
&lt;p&gt;后面又听了“iOS遗留系统上的架构重构”，是一名来自澳洲的iOS工程师分享的，主要分享了自己是如何在遗留的代码上，把数据存储从CoreData迁移到Realm并且没有影响正常迭代的经历，使用的是抽象分支+特性开关，也非常有参考价值。&lt;/p&gt;
&lt;h3 id=&quot;第二天下午&quot;&gt;&lt;a href=&quot;#第二天下午&quot; class=&quot;headerlink&quot; title=&quot;第二天下午&quot;&gt;&lt;/a&gt;第二天下午&lt;/h3&gt;&lt;p&gt;第二天下午有两个分会场，分别是性能优化专场和应用架构专场。&lt;/p&gt;
&lt;p&gt;我先听了“美团 iOS 客户端的构建思考与实践”，分享者是美团的高级工程师，主要讲了美团APP iOS客户端的架构，以及集成和发布中遇到的问题和一些实践经验。分享了一些持续集成的经验，目前我们项目中还没有用到持续集成，所有这一块也不是很了解，不过很多东西还是值得借鉴和尝试的。&lt;/p&gt;
&lt;p&gt;后面我又听了来自微博的美女架构师分享的“微博复杂信息流的架构之道”，分享中提到的隔周发版也是一种很好的实践方式。&lt;/p&gt;
&lt;h3 id=&quot;总结&quot;&gt;&lt;a href=&quot;#总结&quot; class=&quot;headerlink&quot; title=&quot;总结&quot;&gt;&lt;/a&gt;总结&lt;/h3&gt;&lt;p&gt;总体来说这次GMTC大会还是收获很多的，学习到了业界一些最新最热的技术和思想，非常感谢公司能给我这次机会。&lt;/p&gt;
&lt;p&gt;最后，由于第一次去北京，当然少不了要到处逛逛。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/9088bb3373fad1444a78921cb8c8172f.png&quot; alt=&quot;2&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/5a0e1b3dac94502a08f70de2f14bee22.png&quot; alt=&quot;3&quot;&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;6月24日至6月25日，我有幸参加了“GMTC全球移动技术大会”，这篇博客就是我对参见会议的一个经历和感受。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/457acda7bd3dc65f172468c45da
    
    </summary>
    
      <category term="其他" scheme="http://liujinlongxa.com/categories/%E5%85%B6%E4%BB%96/"/>
    
    
  </entry>
  
  <entry>
    <title>打造自己的翻墙VPS:搬运工VPS购买使用流程全记录</title>
    <link href="http://liujinlongxa.com/2016/06/11/%E6%89%93%E9%80%A0%E8%87%AA%E5%B7%B1%E7%9A%84%E7%BF%BB%E5%A2%99VPS:%E6%90%AC%E8%BF%90%E5%B7%A5VPS%E8%B4%AD%E4%B9%B0%E4%BD%BF%E7%94%A8%E6%B5%81%E7%A8%8B%E5%85%A8%E8%AE%B0%E5%BD%95/"/>
    <id>http://liujinlongxa.com/2016/06/11/打造自己的翻墙VPS:搬运工VPS购买使用流程全记录/</id>
    <published>2016-06-10T16:00:00.000Z</published>
    <updated>2016-08-12T15:20:04.000Z</updated>
    
    <content type="html">&lt;p&gt;端午节在家无聊，买了一个VPS，打算做翻墙用，下面是我购买和使用的一个流程全集了，主要以截图为主，文字为辅。&lt;/p&gt;
&lt;p&gt;我选的VPS是&lt;a href=&quot;https://bandwagonhost.com/index.php&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;搬运工&lt;/a&gt;，因为网上教程比较多，而且支持支付宝支付（实际证明支付宝支付就是个坑）。&lt;/p&gt;
&lt;h2 id=&quot;第一步：购买搬运工VPS&quot;&gt;&lt;a href=&quot;#第一步：购买搬运工VPS&quot; class=&quot;headerlink&quot; title=&quot;第一步：购买搬运工VPS&quot;&gt;&lt;/a&gt;第一步：购买搬运工VPS&lt;/h2&gt;&lt;p&gt;打开&lt;a href=&quot;https://bandwagonhost.com/index.php&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;搬运工&lt;/a&gt;官网，点击Home&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/bed44e502ad30c6337a757df1096eb42.png&quot; alt=&quot;1&quot;&gt;&lt;/p&gt;
&lt;p&gt;选择一个套餐，点击OrderNow，出现了一个错误界面，没关系，继续点击Please Check…&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/6521ec84ff41c1c28efcbaf55195b41b.png&quot; alt=&quot;2&quot;&gt;&lt;/p&gt;
&lt;p&gt;往下拉，选择一个套餐，显示out of stock是已经售罄的，选择一个没有售罄的，点击Order Now（便宜的都卖完了😭😭）&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/4d0c8ffde0ee4fabd1619a2f76cd142d.png&quot; alt=&quot;3&quot;&gt;&lt;/p&gt;
&lt;p&gt;我选的是4.99$每月的套餐，然后选择计费周期和机房地址，计费周期有每月，每季度，每半年，每年，机房地址如果开通后觉得速度慢可以换的，选择完成后，点击Add to Cart&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/df89863eb89691d23f8ede6df91474ac.png&quot; alt=&quot;4&quot;&gt;&lt;/p&gt;
&lt;p&gt;填写优惠码（如果有的话），然后点击CheckOut提交订单&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/22185a6765ad03c3c490039547b1a6f9.png&quot; alt=&quot;5&quot;&gt;&lt;/p&gt;
&lt;p&gt;填写支付信息，可以选择支付宝支付，然后点击Complete Order完成订单&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/c52d6ec41f2fe7306d95fe02c150ff3c.png&quot; alt=&quot;6&quot;&gt;&lt;/p&gt;
&lt;p&gt;然后，点击PayNow&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/8c5c7146ebeae385a78a0d2ff4f41d50.png&quot; alt=&quot;7&quot;&gt;&lt;/p&gt;
&lt;p&gt;点了好几遍，使用没反应，最后无奈，只能使用PayPal（坑！！）&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/5044a701d5863fb3df75cde054e40bf1.png&quot; alt=&quot;8&quot;&gt;&lt;/p&gt;
&lt;p&gt;然后登陆PayPal，确认订单，支付就可了。支付完成后，返回搬运工，可以看到一个订单号，这就说明订单已经完成了。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/b1919f5edb17005e107f2cda76ea6543.png&quot; alt=&quot;9&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;第二步：如何使用搬运工&quot;&gt;&lt;a href=&quot;#第二步：如何使用搬运工&quot; class=&quot;headerlink&quot; title=&quot;第二步：如何使用搬运工&quot;&gt;&lt;/a&gt;第二步：如何使用搬运工&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;查看主机&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/0d844d6592095394205b3ec705c27c07.png&quot; alt=&quot;10&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/519dd5c39986045804589fb1c2037bc1.png&quot; alt=&quot;11&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/32ba5f9b92493a7fae77e566ffeb1899.png&quot; alt=&quot;12&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;管理我的VPS，点击KiwiVM..进入管理界面，这里可以查看服务器的状态，以及进行各种管理操作，具体操作方法可以参考最后我的两篇博客链接。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/765e9238bfc53b4d7efcf7eddadc1713.png&quot; alt=&quot;13&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;第三步：一键安装shadowsocks（搬运工这个功能太赞啦）&quot;&gt;&lt;a href=&quot;#第三步：一键安装shadowsocks（搬运工这个功能太赞啦）&quot; class=&quot;headerlink&quot; title=&quot;第三步：一键安装shadowsocks（搬运工这个功能太赞啦）&quot;&gt;&lt;/a&gt;第三步：一键安装shadowsocks（搬运工这个功能太赞啦）&lt;/h2&gt;&lt;p&gt;进入管理界面，然后点击Shadowsocks Server，然后点击Install Sh…&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/6c277b288f658f0f46b49692ad44cd07.png&quot; alt=&quot;14&quot;&gt;&lt;/p&gt;
&lt;p&gt;安装完成后，点击返回，就可以看到你的SS的端口和密码&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/cf4d5ded8facbea9375c69e1736db8b7.png&quot; alt=&quot;15&quot;&gt;&lt;/p&gt;
&lt;p&gt;然后跟着上图的“What‘s Next”后面的内容，安装并配置Shadowsocks，就可以使用了。&lt;/p&gt;
&lt;p&gt;以上就是这个购买和使用VPS的流程，希望对大家有所帮助。&lt;/p&gt;
&lt;p&gt;Reference:&lt;br&gt;&lt;a href=&quot;https://blog.phpgao.com/vps.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://blog.phpgao.com/vps.html&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://www.jianshu.com/p/2f51144c35c9&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.jianshu.com/p/2f51144c35c9&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;端午节在家无聊，买了一个VPS，打算做翻墙用，下面是我购买和使用的一个流程全集了，主要以截图为主，文字为辅。&lt;/p&gt;
&lt;p&gt;我选的VPS是&lt;a href=&quot;https://bandwagonhost.com/index.php&quot; target=&quot;_blank&quot; rel=&quot;e
    
    </summary>
    
      <category term="其他" scheme="http://liujinlongxa.com/categories/%E5%85%B6%E4%BB%96/"/>
    
    
  </entry>
  
  <entry>
    <title>2016年6月开发问题记录</title>
    <link href="http://liujinlongxa.com/2016/06/05/2016%E5%B9%B46%E6%9C%88%E5%BC%80%E5%8F%91%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/"/>
    <id>http://liujinlongxa.com/2016/06/05/2016年6月开发问题记录/</id>
    <published>2016-06-04T16:00:00.000Z</published>
    <updated>2016-08-12T15:20:04.000Z</updated>
    
    <content type="html">&lt;p&gt;继续记录6月份开发中遇到的问题。&lt;/p&gt;
&lt;h2 id=&quot;UIBarButtonItem点击区域的问题&quot;&gt;&lt;a href=&quot;#UIBarButtonItem点击区域的问题&quot; class=&quot;headerlink&quot; title=&quot;UIBarButtonItem点击区域的问题&quot;&gt;&lt;/a&gt;UIBarButtonItem点击区域的问题&lt;/h2&gt;&lt;p&gt;今天在定制导航上的返回按钮遇到了一个问题，顺便记录一下。&lt;/p&gt;
&lt;p&gt;一般常规的定制导航栏返回按钮的方法如下：&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.navigationItem.leftBarButtonItem = [[&lt;span class=&quot;built_in&quot;&gt;UIBarButtonItem&lt;/span&gt; alloc] initWithImage:[&lt;span class=&quot;built_in&quot;&gt;UIImage&lt;/span&gt; imageNamed:&lt;span class=&quot;string&quot;&gt;@&quot;back&quot;&lt;/span&gt;] style:&lt;span class=&quot;built_in&quot;&gt;UIBarButtonItemStyleDone&lt;/span&gt; target:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; action:&lt;span class=&quot;keyword&quot;&gt;@selector&lt;/span&gt;(clickBackBtn:)];&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这样写有一个问题，运行代码后，返回按钮的可点击区域如下图所示：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/d869dc4bbc06c476771fc0cfe1b19d49.png&quot; alt=&quot;1&quot;&gt;&lt;/p&gt;
&lt;p&gt;这并不是我想要的，点击区域太大，完全没有点到返回按钮上都可以触发返回操作。于是换一种思路，用自定义View实现，代码如下：&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;UIButton&lt;/span&gt; *backBtn = [[&lt;span class=&quot;built_in&quot;&gt;UIButton&lt;/span&gt; alloc] initWithFrame:&lt;span class=&quot;built_in&quot;&gt;CGRectMake&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;30&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;44&lt;/span&gt;)];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[backBtn addTarget:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; action:&lt;span class=&quot;keyword&quot;&gt;@selector&lt;/span&gt;(clickBackBtn:) forControlEvents:&lt;span class=&quot;built_in&quot;&gt;UIControlEventTouchUpInside&lt;/span&gt;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[backBtn setImage:[&lt;span class=&quot;built_in&quot;&gt;UIImage&lt;/span&gt; imageNamed:&lt;span class=&quot;string&quot;&gt;@&quot;back&quot;&lt;/span&gt;] forState:&lt;span class=&quot;built_in&quot;&gt;UIControlStateNormal&lt;/span&gt;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.navigationItem.leftBarButtonItem = [[&lt;span class=&quot;built_in&quot;&gt;UIBarButtonItem&lt;/span&gt; alloc] initWithCustomView:backBtn];&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;编译运行，效果依然一样，点击区域还是太大，如下图：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/639a2d998265085ba8f03b4fb3cc6068.png&quot; alt=&quot;2&quot;&gt;&lt;/p&gt;
&lt;p&gt;这我就不明白了，于是一阵Google，找到了一个解决方案，代码如下：&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;UIButton&lt;/span&gt; *backBtn = [[&lt;span class=&quot;built_in&quot;&gt;UIButton&lt;/span&gt; alloc] initWithFrame:&lt;span class=&quot;built_in&quot;&gt;CGRectMake&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;30&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;44&lt;/span&gt;)];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[backBtn addTarget:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; action:&lt;span class=&quot;keyword&quot;&gt;@selector&lt;/span&gt;(clickBackBtn:) forControlEvents:&lt;span class=&quot;built_in&quot;&gt;UIControlEventTouchUpInside&lt;/span&gt;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[backBtn setImage:[&lt;span class=&quot;built_in&quot;&gt;UIImage&lt;/span&gt; imageNamed:&lt;span class=&quot;string&quot;&gt;@&quot;back&quot;&lt;/span&gt;] forState:&lt;span class=&quot;built_in&quot;&gt;UIControlStateNormal&lt;/span&gt;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;UIView&lt;/span&gt; *containerView = [[&lt;span class=&quot;built_in&quot;&gt;UIView&lt;/span&gt; alloc] initWithFrame:&lt;span class=&quot;built_in&quot;&gt;CGRectMake&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;30&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;44&lt;/span&gt;)];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[containerView addSubview:backBtn];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.navigationItem.leftBarButtonItem = [[&lt;span class=&quot;built_in&quot;&gt;UIBarButtonItem&lt;/span&gt; alloc] initWithCustomView:containerView];&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这样点击区域就正常了，如下图：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/0b15b63f3ddab728a7c593154f0083a2.png&quot; alt=&quot;3&quot;&gt;&lt;/p&gt;
&lt;p&gt;其实就是在Button外面又包了一层View，这样点击区域就只有Button那么大，我怀疑，可能是加载BarButtonItem上的自定义View都会被自动的拉长，暂时还没找到其他解决方案。&lt;/p&gt;
&lt;p&gt;Reference：&lt;a href=&quot;http://stackoverflow.com/questions/16858433/uibarbuttonitem-tap-area&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;UIBarButtonItem tap area&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;将自定义对象作为NSDictionary的Key&quot;&gt;&lt;a href=&quot;#将自定义对象作为NSDictionary的Key&quot; class=&quot;headerlink&quot; title=&quot;将自定义对象作为NSDictionary的Key&quot;&gt;&lt;/a&gt;将自定义对象作为NSDictionary的Key&lt;/h2&gt;&lt;p&gt;将自定义对象作为NSDictionary的Key，需要重写自定义isEqual方法和hash方法。isEqual方法比较简单，如下代码：&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt;)isEqual:(&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;)object &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    Student *st = (Student *)object;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([st.name isEqualToString:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.name] &amp;amp;&amp;amp; st.age == &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.age) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;NO&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;但是如果要把自定义的对象作为NSDictionary的Key，光重写isEqual方法是不够的，还需要重写hash方法，如果不重写hash方法就会导致字典不能正确的添加和删除。重写hash函数的方法很多，可以通过构建不同散列函数来实现，但是无论哪种方法，目的都是尽可能的确保相同的对象返回的hash值相同，一个简单的方法就是使用每一个属性的hash的异或的结果来作为这个对象的hash值。代码如下：&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;NSUInteger&lt;/span&gt;)hash &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.name hash] ^ &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.age;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这样构建的hash值冲突的概率很小。另外，要作为字典的Key，还必须实现&lt;code&gt;NSCopying&lt;/code&gt;协议。因为不需要做深拷贝，所以只需要简单的返回self即可，代码如下：&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;)copyWithZone:(&lt;span class=&quot;built_in&quot;&gt;NSZone&lt;/span&gt; *)zone &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这个构建的一个对象就可以作为NSDictionary的Key了。&lt;/p&gt;
&lt;p&gt;Reference：&lt;a href=&quot;http://nshipster.com/equality/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Equality&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;UITableViewCell的“no-index-path-for-table-cell-being-reused”问题&quot;&gt;&lt;a href=&quot;#UITableViewCell的“no-index-path-for-table-cell-being-reused”问题&quot; class=&quot;headerlink&quot; title=&quot;UITableViewCell的“no index path for table cell being reused”问题&quot;&gt;&lt;/a&gt;UITableViewCell的“no index path for table cell being reused”问题&lt;/h2&gt;&lt;p&gt;项目中有一个自定义的UITableViewCell，由于版本更新，要把这个Cell改为可以悬停的SectionHeader，为了图方便，我没有重新自定义一个View，而是直接在&lt;code&gt;viewForHeaderInSection:&lt;/code&gt;方法里返回了cell，代码如下：&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;LMBookWriteCommentCell *cell = (LMBookWriteCommentCell *)[&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; tableView:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.tableView writeCommentCellWithIndexPath:&lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; cell;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这样写有个问题，就是在reloadData时，这SectionHeader就消失了，变成了空白的一片，并且出现了“no index path for table cell being reused”错误，程序没有崩溃，但是就是看不见Cell上的内容。于是一阵Google，终于找到了答案，只要把上面的代码的&lt;code&gt;return cell;&lt;/code&gt;改为&lt;code&gt;return cell.contentView;&lt;/code&gt;就可以了。&lt;/p&gt;
&lt;p&gt;Reference：&lt;a href=&quot;http://stackoverflow.com/questions/12772197/what-is-the-meaning-of-the-no-index-path-for-table-cell-being-reused-message-i?lq=1&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;What is the meaning of the “no index path for table cell being reused” message in iOS 6/7?&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;Autolayout动画的正确姿势&quot;&gt;&lt;a href=&quot;#Autolayout动画的正确姿势&quot; class=&quot;headerlink&quot; title=&quot;Autolayout动画的正确姿势&quot;&gt;&lt;/a&gt;Autolayout动画的正确姿势&lt;/h2&gt;&lt;p&gt;做Autolayout动画的一般步骤是：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;修改约束，如果使用Masonry，使用&lt;code&gt;mas_updateConstraints&lt;/code&gt;方法修改约束，如果使用Xib，则直接把要修改的约束通过拉线链接到代码里进行修改即可。&lt;/li&gt;
&lt;li&gt;在动画的block中，调用View的&lt;code&gt;layoutIfNeed()&lt;/code&gt;方法。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;这里要注意的一点是第二步，如果直接调用&lt;code&gt;view.layoutIfNeed()&lt;/code&gt;，可能会导致动画不能进行，正确的方法应该是调用&lt;code&gt;view.superview.layoutIfNeed()&lt;/code&gt;，这样才能正确的进行动画。完整代码如下：&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; ViewController: &lt;span class=&quot;built_in&quot;&gt;UIViewController&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    @IBOutlet &lt;span class=&quot;keyword&quot;&gt;weak&lt;/span&gt; var myView: &lt;span class=&quot;built_in&quot;&gt;UIView&lt;/span&gt;!&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    @IBOutlet &lt;span class=&quot;keyword&quot;&gt;weak&lt;/span&gt; var topConstraint: &lt;span class=&quot;built_in&quot;&gt;NSLayoutConstraint&lt;/span&gt;!&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    override func viewDidLoad() &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt;.viewDidLoad()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    override func touchesBegan(touches: Set&amp;lt;&lt;span class=&quot;built_in&quot;&gt;UITouch&lt;/span&gt;&amp;gt;, withEvent event: &lt;span class=&quot;built_in&quot;&gt;UIEvent&lt;/span&gt;?) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        topConstraint.constant += &lt;span class=&quot;number&quot;&gt;100&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;UIView&lt;/span&gt;.animateWithDuration(&lt;span class=&quot;number&quot;&gt;2.0&lt;/span&gt;) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.myView.superview?.layoutIfNeeded()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;在iOS7上UILabel的省略点颜色不正确&quot;&gt;&lt;a href=&quot;#在iOS7上UILabel的省略点颜色不正确&quot; class=&quot;headerlink&quot; title=&quot;在iOS7上UILabel的省略点颜色不正确&quot;&gt;&lt;/a&gt;在iOS7上UILabel的省略点颜色不正确&lt;/h2&gt;&lt;p&gt;在iOS7上，有时UILabel的省略点的颜色与文字的颜色不同，如下图：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/90fa287185b4062e4c37dd86ac05436b.png&quot; alt=&quot;uilable color error&quot;&gt;&lt;/p&gt;
&lt;p&gt;网上查了一下，这应该是iOS7的一个Bug，解决方法就是不要使用textColor设置文字颜色，而使用attributeText，代码如下：&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSAttributedString&lt;/span&gt; *attStr = [[&lt;span class=&quot;built_in&quot;&gt;NSAttributedString&lt;/span&gt; alloc] initWithString:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.titleLabel.text attributes:@&amp;#123;&lt;span class=&quot;built_in&quot;&gt;NSForegroundColorAttributeName&lt;/span&gt;:style.fColor, &lt;span class=&quot;built_in&quot;&gt;NSFontAttributeName&lt;/span&gt;:style.font&amp;#125;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.titleLabel.attributedText = attStr;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;参考：&lt;a href=&quot;http://stackoverflow.com/questions/22718172/uilabel-dotted-line-color-bug-in-ios-7-1&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;UILabel dotted line color bug in iOS 7.1&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;iOS7上，给UICollectionViewCell添加长按手势的坑&quot;&gt;&lt;a href=&quot;#iOS7上，给UICollectionViewCell添加长按手势的坑&quot; class=&quot;headerlink&quot; title=&quot;iOS7上，给UICollectionViewCell添加长按手势的坑&quot;&gt;&lt;/a&gt;iOS7上，给UICollectionViewCell添加长按手势的坑&lt;/h2&gt;&lt;p&gt;项目中有一个需求，当长按任何一个UICollectionViewCell时，刷新UICollectionView，每一个Cell的右上角都出现一个选择按钮。效果如下：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn88v.com1.z0.glb.clouddn.com/88e710b25fdcd0403ba7fe2610bd1547.png&quot; alt=&quot;iOS7 UICollectionView longPress&quot;&gt;&lt;/p&gt;
&lt;p&gt;这是一个比较常见的需求，我的做法是在每一个Cell上添加一个长按手势，然后，在手势触发时，刷新这个UICollectionView，然每一个Cell都显示选择按钮。这样做在iOS8，iOS9上都没有问题，当时在iOS7上却出现了问题。在iOS7上，当触发某一个Cell的长按手势之后，这个Cell就不再响应UICollectionView的&lt;code&gt;collectionView:didSelectItemAtIndexPath:&lt;/code&gt;方法了。&lt;/p&gt;
&lt;p&gt;网上没有找到类似的情况，只能自己解决。最终找到了一种解决方案，代码如下：&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 必须重新放在主线程队列中，否则在iOS7上回出现Cell不触发didSelect的情况&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;dispatch_async&lt;/span&gt;(dispatch_get_main_queue(), ^&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.collectionView reloadData];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;);&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;要将reloadData重新放在主线程队列中，这样就不会出现这种情况。具体原因不是非常明白，但是，这样确实可以完美的解决这个问题。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;继续记录6月份开发中遇到的问题。&lt;/p&gt;
&lt;h2 id=&quot;UIBarButtonItem点击区域的问题&quot;&gt;&lt;a href=&quot;#UIBarButtonItem点击区域的问题&quot; class=&quot;headerlink&quot; title=&quot;UIBarButtonItem点击区域的问题&quot;&gt;
    
    </summary>
    
      <category term="iOS Tips" scheme="http://liujinlongxa.com/categories/iOS-Tips/"/>
    
    
  </entry>
  
  <entry>
    <title>自定义NSOperation的那些事</title>
    <link href="http://liujinlongxa.com/2016/05/29/%E8%87%AA%E5%AE%9A%E4%B9%89NSOperation%E7%9A%84%E9%82%A3%E4%BA%9B%E4%BA%8B/"/>
    <id>http://liujinlongxa.com/2016/05/29/自定义NSOperation的那些事/</id>
    <published>2016-05-28T16:00:00.000Z</published>
    <updated>2016-08-12T15:20:04.000Z</updated>
    
    <content type="html">&lt;p&gt;最近在项目中负责一个下载模块，使用的是NSOperation+NSOperationQueue实现的，以前总以为自己对NSOperation已经很熟悉了，也写过很多Demo，但是到真正使用的时候，才发现里面还有很多细节的东西自己没有注意到，这篇博客算是对NSOperation的用法的一个总结。比较简单的NSBlockOperation以及NSInvocationOperation就不介绍，本文主要讲解一下自定义NSOperation的方法以及注意事项。&lt;/p&gt;
&lt;p&gt;很多技术Blog在介绍自定NSOperation时，思路都是大同小异，大致可以分为一下几步：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;创建一个集成自NSOperation的类&lt;/li&gt;
&lt;li&gt;重写NSOperation的main()方法，在main()方法中实现耗时操作&lt;/li&gt;
&lt;li&gt;然后使用时创建自定义的NNSOperation对象，把它添加到NSOperationQueue中，这样就可以自动执行了&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;其实，这只是自定义NSOperation的一种方法，而且是比较简单的一种方法，不需要自己去控制NSOperation的完成，取消等。另外一种方式是重写NSOperation的start方法，这种方法就需要你自己去控制NSOperation的完成，取消，执行等，而且有许多需要注意的地方。下面着重介绍一些第二种方法。&lt;/p&gt;
&lt;p&gt;废话不多说，直接上代码：&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#import &lt;span class=&quot;meta-string&quot;&gt;&quot;CustomOperation.h&quot;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@implementation&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;CustomOperation&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)start &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    [&lt;span class=&quot;built_in&quot;&gt;NSThread&lt;/span&gt; sleepForTimeInterval:&lt;span class=&quot;number&quot;&gt;3.0&lt;/span&gt;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;NSInteger&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;这是一个耗时操作：%@&quot;&lt;/span&gt;, @(++i));&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; main(&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; argc, &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt; * argv[]) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;@autoreleasepool&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;NSOperationQueue&lt;/span&gt; *queue = [[&lt;span class=&quot;built_in&quot;&gt;NSOperationQueue&lt;/span&gt; alloc] init];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        queue.maxConcurrentOperationCount = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        CustomOperation *op1 = [[CustomOperation alloc] init];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        CustomOperation *op2 = [[CustomOperation alloc] init];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        CustomOperation *op3 = [[CustomOperation alloc] init];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        [queue addOperation:op1];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        [queue addOperation:op2];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        [queue addOperation:op3];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        [[&lt;span class=&quot;built_in&quot;&gt;NSRunLoop&lt;/span&gt; mainRunLoop] run];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;上述代码创建了一个NSOperation的子类CustomOperation，然后重写了start方法，在start方法中模拟了一个耗时操作，然后在main方法中创建一个NSOperationQueue并添加三个CustomOperation，执行结果是只有op1被执行，op2和op3一直没有被执行。这是因为，一个NSOperationQueue在判断一个Operation是否执行完成的标志是Operation的&lt;code&gt;- (BOOL)isFinished&lt;/code&gt;方法返回YES，所以这里需要有一个变量来记录当前Operation执行的状态，修改代码，如下：&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;33&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;34&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;35&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;36&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#import &lt;span class=&quot;meta-string&quot;&gt;&quot;CustomOperation.h&quot;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;typedef&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;NS_ENUM&lt;/span&gt;(&lt;span class=&quot;built_in&quot;&gt;NSUInteger&lt;/span&gt;, OperationState) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    OperationStateReady,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    OperationStateExecuting,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    OperationStateFinished,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@interface&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;CustomOperation&lt;/span&gt; ()&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;assign&lt;/span&gt;) OperationState state;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@implementation&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;CustomOperation&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;instancetype&lt;/span&gt;)init &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; = [&lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt; init]) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        _state = OperationStateReady;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt;)isFinished &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.state == OperationStateFinished;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)start &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.state = OperationStateExecuting;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    [&lt;span class=&quot;built_in&quot;&gt;NSThread&lt;/span&gt; sleepForTimeInterval:&lt;span class=&quot;number&quot;&gt;3.0&lt;/span&gt;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;NSInteger&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;这是一个耗时操作：%@&quot;&lt;/span&gt;, @(++i));&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.state = OperationStateFinished;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@end&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这里先定义个一个表示Operation状态的枚举，共有三种状态：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;OperationStateReady：准备状态，创建Operation后默认就是准备状态&lt;/li&gt;
&lt;li&gt;OperationStateExecuting：执行状态，Operation在执行过程中的状态&lt;/li&gt;
&lt;li&gt;OperationStateFinished：完成状态，Operation执行完成后的状态&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;然后在main方法中先将状态置为执行状态，然后在耗时操作执行完后，将状态置为完成状态。有了状态之后，重写NSOperation的&lt;code&gt;- (BOOL)isFinished&lt;/code&gt;方法，当状态为OperationStateFinished时返回YES，否则返回NO。这样，NSOperationQueue就可以知道操作已经执行完成。运行代码，现在三个Operation就可以按顺序执行了。&lt;/p&gt;
&lt;p&gt;继续完善代码&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;33&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;34&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;35&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;36&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;37&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;38&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;39&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;40&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;41&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;42&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;43&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;44&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;45&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@implementation&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;CustomOperation&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;instancetype&lt;/span&gt;)init &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; = [&lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt; init]) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        _state = OperationStateReady;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt;)isFinished &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.state == OperationStateFinished;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt;)isExecuting &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.state == OperationStateExecuting;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt;)isReady &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.state == OperationStateReady &amp;amp;&amp;amp; [&lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt; isReady];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)cancel &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (![&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; isExecuting] &amp;amp;&amp;amp; ![&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; isFinished]) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        [&lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt; cancel];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)start &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (![&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; isReady]) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; isCancelled]) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.state = OperationStateExecuting;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    [&lt;span class=&quot;built_in&quot;&gt;NSThread&lt;/span&gt; sleepForTimeInterval:&lt;span class=&quot;number&quot;&gt;3.0&lt;/span&gt;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;NSInteger&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;这是一个耗时操作：%@&quot;&lt;/span&gt;, @(++i));&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.state = OperationStateFinished;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@end&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这样，一个重写start方法的自定义NSOperation就完成了，这是CustomOperation支持Cancel操作，测试代码如下：&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; main(&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; argc, &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt; * argv[]) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;@autoreleasepool&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;NSOperationQueue&lt;/span&gt; *queue = [[&lt;span class=&quot;built_in&quot;&gt;NSOperationQueue&lt;/span&gt; alloc] init];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        queue.maxConcurrentOperationCount = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        CustomOperation *op1 = [[CustomOperation alloc] init];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        CustomOperation *op2 = [[CustomOperation alloc] init];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        CustomOperation *op3 = [[CustomOperation alloc] init];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        [queue addOperation:op1];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        [queue addOperation:op2];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        [queue addOperation:op3];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(&lt;span class=&quot;number&quot;&gt;2.0&lt;/span&gt; * &lt;span class=&quot;built_in&quot;&gt;NSEC_PER_SEC&lt;/span&gt;)), dispatch_get_main_queue(), ^&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            [op3 cancel];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        [[&lt;span class=&quot;built_in&quot;&gt;NSRunLoop&lt;/span&gt; mainRunLoop] run];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;运行代码，会发现只执行了op1和op2，达到了我们预期的效果。&lt;/p&gt;
&lt;p&gt;这就是一个完整的自定义NSOperation的方法，这里的关键点就是那几个状态。&lt;/p&gt;
&lt;p&gt;比较一下重写start函数的方法和重写main函数的方法，重写main函数实现起来更加简单，不需要自己控制Operation的状态，但是重写start函数更加灵活，可以根据自己的需求定制不同的状态。更加完善的实现可以参看&lt;a href=&quot;https://github.com/AFNetworking/AFNetworking&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;AFNetworking&lt;/a&gt;的AFURLConnectionOperation实现，里面有很多值得学习的东西。&lt;/p&gt;
&lt;p&gt;参考资料：&lt;br&gt;&lt;a href=&quot;http://nshipster.com/nsoperation/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;NSOperation&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;最近在项目中负责一个下载模块，使用的是NSOperation+NSOperationQueue实现的，以前总以为自己对NSOperation已经很熟悉了，也写过很多Demo，但是到真正使用的时候，才发现里面还有很多细节的东西自己没有注意到，这篇博客算是对NSOperatio
    
    </summary>
    
      <category term="iOS开发" scheme="http://liujinlongxa.com/categories/iOS%E5%BC%80%E5%8F%91/"/>
    
    
  </entry>
  
</feed>
