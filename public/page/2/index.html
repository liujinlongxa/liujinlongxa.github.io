<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="liujinlongxa的技术博客" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="生命永不息，Coding永不止">
<meta property="og:type" content="website">
<meta property="og:title" content="liujinlongxa的技术博客">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="liujinlongxa的技术博客">
<meta property="og:description" content="生命永不息，Coding永不止">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="liujinlongxa的技术博客">
<meta name="twitter:description" content="生命永不息，Coding永不止">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://yoursite.com/page/2/"/>

  <title> liujinlongxa的技术博客 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">liujinlongxa的技术博客</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/12/27/《ios核心动画高级技巧》阅读笔记(2)/" itemprop="url">
                  《ios核心动画高级技巧》阅读笔记(2)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-12-27T00:00:00+08:00" content="2015-12-27">
              2015-12-27
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/读书笔记/" itemprop="url" rel="index">
                    <span itemprop="name">读书笔记</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/12/27/《ios核心动画高级技巧》阅读笔记(2)/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/12/27/《ios核心动画高级技巧》阅读笔记(2)/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="第三章-图层集合学"><a href="#第三章-图层集合学" class="headerlink" title="第三章 图层集合学"></a>第三章 图层集合学</h2><h3 id="布局"><a href="#布局" class="headerlink" title="布局"></a>布局</h3><ul>
<li>frame：图层的相对于父图层的外部坐标</li>
<li>bounds：内部坐标</li>
<li>center和position：相对于父图层anchorPoint所在的位置</li>
<li>设置视图的frame，bounds和center，也就是相当于设置图层的frame，bounds和position</li>
<li>一般情况下，frame中的size与bounds中的size是相同的，但是当视图旋转时，frame的size和bounds的size就不一样了，如下图</li>
</ul>
<p><img src="http://7xn88v.com1.z0.glb.clouddn.com/a592d9f689fe8a2818583430f5a8211d.png" alt="frame&amp;bounds&amp;center"></p>
<h3 id="锚点"><a href="#锚点" class="headerlink" title="锚点"></a>锚点</h3><ul>
<li>锚点是相对于父图层anchorPoint所在的位置。</li>
<li>默认，锚点位于图层的中点，可以改变锚点的位置，描点改变，frame也会随之改变。</li>
</ul>
<p><img src="http://7xn88v.com1.z0.glb.clouddn.com/99c7a6ddc1d2b162816b2a9ef5ff568f.png" alt="anchorPoint"></p>
<ul>
<li>改变锚点，position不会改变，但是frame改变了。</li>
<li>anchorPoint是View在旋转是的轴点，如果想改变view的旋转轴点，改变anchorPoint即可</li>
</ul>
<h3 id="坐标系"><a href="#坐标系" class="headerlink" title="坐标系"></a>坐标系</h3><ul>
<li>与UIView一样，CALayer也提供了一套坐标变换的借口</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">CGPoint</span>)convertPoint:(<span class="built_in">CGPoint</span>)p fromLayer:(<span class="keyword">nullable</span> <span class="built_in">CALayer</span> *)l;</div><div class="line">- (<span class="built_in">CGPoint</span>)convertPoint:(<span class="built_in">CGPoint</span>)p toLayer:(<span class="keyword">nullable</span> <span class="built_in">CALayer</span> *)l;</div><div class="line">- (<span class="built_in">CGRect</span>)convertRect:(<span class="built_in">CGRect</span>)r fromLayer:(<span class="keyword">nullable</span> <span class="built_in">CALayer</span> *)l;</div><div class="line">- (<span class="built_in">CGRect</span>)convertRect:(<span class="built_in">CGRect</span>)r toLayer:(<span class="keyword">nullable</span> <span class="built_in">CALayer</span> *)l;</div></pre></td></tr></table></figure>
<h3 id="翻转的几何结构"><a href="#翻转的几何结构" class="headerlink" title="翻转的几何结构"></a>翻转的几何结构</h3><ul>
<li>ios上坐标系原点为左上角，macOS上坐标系原点为左下角。</li>
<li>CALayer的<code>geometryFlipped</code>属性决定了图层的坐标是否相对于父图层翻转。</li>
</ul>
<h3 id="z坐标轴"><a href="#z坐标轴" class="headerlink" title="z坐标轴"></a>z坐标轴</h3><ul>
<li>zPosition：表示图层空间z轴上的位置</li>
<li>zPosition除了可以改变z轴的位置，还可以用来改变图层的先后顺序，如图，如果设置了绿色view的zPosition，绿色View就可以覆盖在蓝色view之上。但是通过这种方法改变视图的层次，是不能改变视图的响应事件的顺序的。</li>
</ul>
<p><img src="http://7xn88v.com1.z0.glb.clouddn.com/d673bc31fdbe28367ad557ac739a60fd.png" alt="zPositon"></p>
<ul>
<li>anchorPointZ表示z轴上锚点的位置</li>
</ul>
<h3 id="Hit-Testing"><a href="#Hit-Testing" class="headerlink" title="Hit Testing"></a>Hit Testing</h3><ul>
<li>CALayer不能处理点击事件，但是他有一系列方法帮你处理事件。</li>
<li><code>- (BOOL)containsPoint:(CGPoint)p;</code>用于判断一个点是否属于一个图层</li>
<li><code>- (nullable CALayer *)hitTest:(CGPoint)p;</code>返回被点击的图层</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)touchesBegan:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="built_in">UIEvent</span> *)event &#123;</div><div class="line">    <span class="built_in">UITouch</span> *touch = [touches anyObject];</div><div class="line">    <span class="built_in">CGPoint</span> point = [touch locationInView:<span class="keyword">self</span>.view];</div><div class="line"></div><div class="line">    point = [<span class="keyword">self</span>.layerView convertPoint:point fromView:<span class="keyword">self</span>.view];</div><div class="line">    <span class="built_in">BOOL</span> ret = [<span class="keyword">self</span>.layerView.layer containsPoint:point];</div><div class="line">    <span class="keyword">if</span> (ret) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"green"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    point = [<span class="keyword">self</span>.buleView convertPoint:point fromView:<span class="keyword">self</span>.layerView];</div><div class="line">    ret = [<span class="keyword">self</span>.buleView.layer containsPoint:point];</div><div class="line">    <span class="keyword">if</span> (ret) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"blue"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="built_in">CALayer</span> *layer = [<span class="keyword">self</span>.view.layer hitTest:point];</div><div class="line">    <span class="keyword">if</span> (layer == <span class="keyword">self</span>.layerView.layer) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"green"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(layer == <span class="keyword">self</span>.buleView.layer) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"blue"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/12/27/《ios核心动画高级技巧》阅读笔记(3)/" itemprop="url">
                  《ios核心动画高级技巧》阅读笔记(3)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-12-27T00:00:00+08:00" content="2015-12-27">
              2015-12-27
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/读书笔记/" itemprop="url" rel="index">
                    <span itemprop="name">读书笔记</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/12/27/《ios核心动画高级技巧》阅读笔记(3)/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/12/27/《ios核心动画高级技巧》阅读笔记(3)/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="第四章-视觉效果"><a href="#第四章-视觉效果" class="headerlink" title="第四章 视觉效果"></a>第四章 视觉效果</h2><h3 id="圆角"><a href="#圆角" class="headerlink" title="圆角"></a>圆角</h3><ul>
<li>设置CALayer的cornerRadius属性来设置圆角，并且要把maskToBounds设置为YES</li>
</ul>
<h3 id="边框"><a href="#边框" class="headerlink" title="边框"></a>边框</h3><ul>
<li>设置CALayer的borderColor和borderWidth可以设置边框的颜色和宽度</li>
</ul>
<h3 id="阴影"><a href="#阴影" class="headerlink" title="阴影"></a>阴影</h3><ul>
<li>shadowColor:阴影的颜色</li>
<li>shadowOpacity:阴影的透明度</li>
<li>shadowOffset:阴影的偏移</li>
<li>shadowRadius:阴影的模糊度，即模糊半径</li>
<li>如果设置了maskToBounds，则阴影就不会显示了，因为阴影已经被裁减调了。要解决这个问题，可以再创建一个frame一样的View，给这个view设置阴影，而设置原本的view的maskToBounds，这样阴影就不会被裁减掉了。</li>
<li>shadowPath:指定阴影的路径。</li>
<li>设置ImageView,label等的阴影，并不是设置他们边界的阴影，而是设置里面内容的阴影，例如设置label的阴影，设置的是label中文字的阴影。</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)viewDidAppear:(<span class="built_in">BOOL</span>)animated &#123;</div><div class="line">    [<span class="keyword">super</span> viewDidAppear:animated];</div><div class="line">    <span class="keyword">self</span>.buleView.hidden = <span class="literal">YES</span>;</div><div class="line">    <span class="keyword">self</span>.layerView.layer.shadowColor = [<span class="built_in">UIColor</span> redColor].CGColor;</div><div class="line">    <span class="keyword">self</span>.layerView.layer.shadowOpacity = <span class="number">1</span>;</div><div class="line">    <span class="keyword">self</span>.layerView.layer.shadowRadius = <span class="number">10</span>;</div><div class="line"></div><div class="line">    <span class="built_in">CGMutablePathRef</span> path = <span class="built_in">CGPathCreateMutable</span>();</div><div class="line">    <span class="built_in">CGPathAddEllipseInRect</span>(path, <span class="literal">NULL</span>, <span class="keyword">self</span>.layerView.bounds);</div><div class="line">    <span class="keyword">self</span>.layerView.layer.shadowPath = path;</div><div class="line">    <span class="built_in">CGPathRelease</span>(path);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="图层蒙版"><a href="#图层蒙版" class="headerlink" title="图层蒙版"></a>图层蒙版</h3><ul>
<li>mask:CALayer的mask属性定义了父图层的部分可见区域，父图层与mask的关系如下图</li>
</ul>
<p><img src="http://7xn88v.com1.z0.glb.clouddn.com/87291a0061be6a254bd4937851ecf4d8.png" alt="mask"></p>
<ul>
<li>虽然设置了mask，但是视图的事件响应区域任然是原视图的区域</li>
<li>mask是可以动态设置的，只要改变mask的大小，就可以对视图的显示区域进行动画</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)viewDidAppear:(<span class="built_in">BOOL</span>)animated &#123;</div><div class="line">    [<span class="keyword">super</span> viewDidAppear:animated];</div><div class="line">    <span class="built_in">CAShapeLayer</span> *mask = [<span class="built_in">CAShapeLayer</span> layer];</div><div class="line">    <span class="built_in">UIBezierPath</span> *path = [<span class="built_in">UIBezierPath</span> bezierPathWithOvalInRect:<span class="keyword">self</span>.greenBtn.bounds];</div><div class="line">    mask.path = path.CGPath;</div><div class="line">    <span class="keyword">self</span>.greenBtn.layer.mask = mask;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)touchesBegan:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="built_in">UIEvent</span> *)event &#123;</div><div class="line"></div><div class="line">    <span class="built_in">UIBezierPath</span> *endPath = [<span class="built_in">UIBezierPath</span> bezierPathWithRect:<span class="keyword">self</span>.greenBtn.bounds];</div><div class="line">    <span class="built_in">CAShapeLayer</span> *layer = (<span class="built_in">CAShapeLayer</span> *)<span class="keyword">self</span>.greenBtn.layer.mask;</div><div class="line"></div><div class="line">    <span class="comment">// 动画</span></div><div class="line">    <span class="built_in">CABasicAnimation</span> *animation = [<span class="built_in">CABasicAnimation</span> animationWithKeyPath:<span class="string">@"path"</span>];</div><div class="line">    animation.duration = <span class="number">1</span>;</div><div class="line">    animation.fromValue = (<span class="keyword">id</span>)layer.path;</div><div class="line">    animation.toValue = (__bridge <span class="keyword">id</span> _Nullable)(endPath.CGPath);</div><div class="line">    animation.removedOnCompletion = <span class="literal">NO</span>;</div><div class="line">    animation.fillMode = kCAFillModeForwards;</div><div class="line">    [layer addAnimation:animation forKey:<span class="string">@"shapeLayerPath"</span>];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="拉伸过滤"><a href="#拉伸过滤" class="headerlink" title="拉伸过滤"></a>拉伸过滤</h3><ul>
<li>minificationFilter:缩小图片的拉伸算法</li>
<li>magnificationFilter:方法图片的拉伸算法</li>
<li>三个值：kCAFilterNearest，kCAFilterLinear，kCAFilterTrilinear</li>
</ul>
<h3 id="组透明"><a href="#组透明" class="headerlink" title="组透明"></a>组透明</h3><ul>
<li>改变视图或图层的透明度，其子视图或子图层的透明度也会跟着改变，但是经过叠加后，原本颜色相同的父子视图，变成了不同的视图，如下图：</li>
</ul>
<p><img src="http://7xn88v.com1.z0.glb.clouddn.com/dda57bde043a3358e1cbc03af4fcbcf1.png" alt="group-opacity"></p>
<ul>
<li>为了解决这种问题，可以在plist中添加”Renders with group opacity”为YES（目前ios9中默认就为YES），或者设置CALayer的shouldRasterize为YES也可以达到相同的效果。</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/12/27/《ios核心动画高级技巧》阅读笔记(1)/" itemprop="url">
                  《ios核心动画高级技巧》阅读笔记(1)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-12-27T00:00:00+08:00" content="2015-12-27">
              2015-12-27
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/读书笔记/" itemprop="url" rel="index">
                    <span itemprop="name">读书笔记</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/12/27/《ios核心动画高级技巧》阅读笔记(1)/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/12/27/《ios核心动画高级技巧》阅读笔记(1)/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="第一章-图层树"><a href="#第一章-图层树" class="headerlink" title="第一章 图层树"></a>第一章 图层树</h2><h3 id="CoreAnimation简介"><a href="#CoreAnimation简介" class="headerlink" title="CoreAnimation简介"></a>CoreAnimation简介</h3><ul>
<li>动画只是CoreAnimation特性的冰山一角</li>
<li>CoreAnimation是一个复合引擎，它的职责就是尽可能快地组合屏幕上不同的可视内容，这个内容被分解成独立的图层，存储在一个叫图层树的体系中。</li>
</ul>
<h3 id="图层与视图"><a href="#图层与视图" class="headerlink" title="图层与视图"></a>图层与视图</h3><ul>
<li>CALayer类在概念上和UIView类似，同样是一些被层级关系树管理的矩形块，同样可以含有一些内容。他有一些方法和属性用来做动画和变换。</li>
<li>和UIView最大的不同是，CALayer不处理用户的交互。CALayer并不清楚具体的响应链，因此它并不能响应时间。</li>
<li>每个UIView都有一个CALayer属性，即所谓的bakinglayer，视图的职责就是创建并管理这个图层。视图的层级关系与其图层的层级关系是相同的。</li>
<li>真正在界面上显示和进行动画的都是CALayer，UIView只是对CALayer的一个封装而已。</li>
<li>进行视图和图层的分类，是为了职责分离，避免重复的代码。ios中视图为UIView，MacOS中视图为NSView，但是他们的图层都是CALayer。</li>
</ul>
<h3 id="图层的能力"><a href="#图层的能力" class="headerlink" title="图层的能力"></a>图层的能力</h3><ul>
<li>CALayer能做但UIView不能做的东西：<ul>
<li>阴影，圆角，带颜色的边框</li>
<li>3D变换</li>
<li>非矩形范围</li>
<li>透明遮罩</li>
<li>多级非线性动画</li>
</ul>
</li>
</ul>
<h3 id="使用图层"><a href="#使用图层" class="headerlink" title="使用图层"></a>使用图层</h3><ul>
<li>可以直接在UIView的layer属性中添加图层，如下</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</div><div class="line">    [<span class="keyword">super</span> viewDidLoad];</div><div class="line"></div><div class="line">    <span class="built_in">CALayer</span> *blueLayer = [[<span class="built_in">CALayer</span> alloc] init];</div><div class="line">    blueLayer.frame = <span class="built_in">CGRectMake</span>(<span class="number">50</span>, <span class="number">50</span>, <span class="number">50</span>, <span class="number">50</span>);</div><div class="line">    blueLayer.backgroundColor = [<span class="built_in">UIColor</span> blueColor].CGColor;</div><div class="line">    [<span class="keyword">self</span>.layerView.layer addSublayer:blueLayer];</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>使用图层而不使用视图的情况<ul>
<li>开发可以在MacOS上运行的跨平台应用</li>
<li>使用多种CALayer的子类（特殊图层），并且不想创建单独的UIView去封装他们</li>
<li>做一些对性能特别挑剔的工作</li>
</ul>
</li>
</ul>
<h2 id="第二章-寄宿图"><a href="#第二章-寄宿图" class="headerlink" title="第二章 寄宿图"></a>第二章 寄宿图</h2><p>CALayer除了可以设置颜色，也可以设置一张图片，这张图片称为CALayer的寄宿图。</p>
<h3 id="contents属性"><a href="#contents属性" class="headerlink" title="contents属性"></a>contents属性</h3><ul>
<li>CALayer有一个contents的属性，它虽然是id类型，但是必须设置一个CGImage，才能显示出图片，设置为其他类型，都只会显示一个空白的区域。这种现象是有Mac OS的历史历史原因造成的。在Mac OS上，contents对CGImage和NSImage类型的值都起作用，但在ios中，不能给contents设置一个UIImage。</li>
<li>contentGravity属性：与UIView中的contentMode属性对应</li>
<li>contentScale属性：定义了寄宿图的像素尺寸和视图的比例，默认为1.0。UIView中与之对应的属性为contentScaleFactor。使用UIImage加载图片会自动根据屏幕加载2x或3x图片，但是使用CGImage则不会。这样我们就需要手动设置contentScale属性来修复这个问题。一般使用代码设置寄宿图，都会手动设置contentScale，如下：<code>blueLayer.contentsScale = [[UIScreen mainScreen] scale];</code></li>
<li>maskToBounds属性用来决定是否显示超出边界的内容</li>
</ul>
<h3 id="contentsRect属性"><a href="#contentsRect属性" class="headerlink" title="contentsRect属性"></a>contentsRect属性</h3><ul>
<li>contentRect属性允许我们在图层边框里显示寄宿图的一个子域，这要比contentGravity属性灵活许多。contentRect是一个单位坐标，长宽最大都为1。默认为{0，0，1，1}，当设置为{0，0，0.5，0.5}，则显示效果如下图：</li>
</ul>
<p><img src="http://7xn88v.com1.z0.glb.clouddn.com/004ddacd5a9506600889fc2c32686262.png" alt="contentsRect"></p>
<ul>
<li>contentRect的另外一个用途就是ImageSprites（图片拼合），把多张图片放在一张大的图片上，然后使用contentRect分别显示每一张图片，去掉不显示的部分，这就是图片拼合。在游戏编程中非常常见。加载一张大图要比加载多张小图效率要高。</li>
</ul>
<h3 id="contentsCenter属性"><a href="#contentsCenter属性" class="headerlink" title="contentsCenter属性"></a>contentsCenter属性</h3><ul>
<li>contentsCenter属性表示图层相对于寄宿图的位置与大小，可以用来定义图片的拉伸。</li>
<li>如下图，虚线框为图层的区域，灰色为内容的区域。</li>
</ul>
<p><img src="http://7xn88v.com1.z0.glb.clouddn.com/01278b2b759e5b3c5fc5ae2a961a71ee.png" alt="contentCenter"></p>
<ul>
<li>该属性相当于UIImage的<code>resizableImageWithCapInsets:</code>方法</li>
</ul>
<h3 id="customDrawing"><a href="#customDrawing" class="headerlink" title="customDrawing"></a>customDrawing</h3><ul>
<li>除了直接给contents属性设置CGImage，也可以通过CoreGraphics直接绘制寄宿图。使用UIVIew 的drawRect:方法来自定义绘制</li>
<li>除了重写drawRect:方法，也可以通过设置CALayer的代理，使用代理方法<code>(void)displayLayer:</code>来实现重绘，但是强烈建议使用前一种方法。</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/12/20/RAC学习笔记/" itemprop="url">
                  RAC学习笔记
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-12-20T00:00:00+08:00" content="2015-12-20">
              2015-12-20
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/iOS开发/" itemprop="url" rel="index">
                    <span itemprop="name">iOS开发</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/12/20/RAC学习笔记/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/12/20/RAC学习笔记/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="RAC简介"><a href="#RAC简介" class="headerlink" title="RAC简介"></a>RAC简介</h2><p>RAC要解决的问题是传统ios中事件，通知，回调的机制十分的繁琐。</p>
<h2 id="常规用法"><a href="#常规用法" class="headerlink" title="常规用法"></a>常规用法</h2><h3 id="target-action"><a href="#target-action" class="headerlink" title="target-action"></a>target-action</h3><ul>
<li>RAC可以替代一般的target-action操作，例如监测textField的文字的改变，不是用RAC的写法</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</div><div class="line">    [<span class="keyword">super</span> viewDidLoad];</div><div class="line"></div><div class="line">    <span class="built_in">UITextField</span> *text = (&#123;</div><div class="line">        <span class="built_in">UITextField</span> *text = [[<span class="built_in">UITextField</span> alloc] init];</div><div class="line">        [<span class="keyword">self</span>.view addSubview:text];</div><div class="line">        [text mas_makeConstraints:^(MASConstraintMaker *make) &#123;</div><div class="line">            make.center.equalTo(<span class="keyword">self</span>.view);</div><div class="line">            make.size.mas_equalTo(<span class="built_in">CGSizeMake</span>(<span class="number">200</span>, <span class="number">40</span>));</div><div class="line">        &#125;];</div><div class="line">        text.backgroundColor = [<span class="built_in">UIColor</span> redColor];</div><div class="line">        [text addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(textDidChange:) forControlEvents:<span class="built_in">UIControlEventEditingChanged</span>];</div><div class="line">        text;</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)textDidChange:(<span class="built_in">UITextField</span> *)sender &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"did change: %@"</span>, sender);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>使用RAC的写法：<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</div><div class="line">    [<span class="keyword">super</span> viewDidLoad];</div><div class="line"></div><div class="line">    <span class="built_in">UITextField</span> *text = (&#123;</div><div class="line">        <span class="built_in">UITextField</span> *text = [[<span class="built_in">UITextField</span> alloc] init];</div><div class="line">        [<span class="keyword">self</span>.view addSubview:text];</div><div class="line">        [text mas_makeConstraints:^(MASConstraintMaker *make) &#123;</div><div class="line">            make.center.equalTo(<span class="keyword">self</span>.view);</div><div class="line">            make.size.mas_equalTo(<span class="built_in">CGSizeMake</span>(<span class="number">200</span>, <span class="number">40</span>));</div><div class="line">        &#125;];</div><div class="line">        text.backgroundColor = [<span class="built_in">UIColor</span> redColor];</div><div class="line"></div><div class="line">        [[text rac_signalForControlEvents:<span class="built_in">UIControlEventEditingChanged</span>] subscribeNext:^(<span class="keyword">id</span> x) &#123;</div><div class="line">            <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, x);</div><div class="line">        &#125;];</div><div class="line"></div><div class="line">        <span class="comment">// 或者</span></div><div class="line">        <span class="comment">//[text.rac_textSignal subscribeNext:^(id x) &#123;</span></div><div class="line">        <span class="comment">//    NSLog(@"%@", x);</span></div><div class="line">        <span class="comment">//&#125;];</span></div><div class="line"></div><div class="line">        text;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="手势中使用RAC"><a href="#手势中使用RAC" class="headerlink" title="手势中使用RAC"></a>手势中使用RAC</h3><ul>
<li>RAC可以替换手势的方法，代码如下</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</div><div class="line">    [<span class="keyword">super</span> viewDidLoad];</div><div class="line"></div><div class="line">    <span class="keyword">self</span>.view.userInteractionEnabled = <span class="literal">YES</span>;</div><div class="line">    <span class="built_in">UITapGestureRecognizer</span> *tap = [[<span class="built_in">UITapGestureRecognizer</span> alloc] init];</div><div class="line">    [[tap rac_gestureSignal] subscribeNext:^(<span class="keyword">id</span> x) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, x);</div><div class="line">    &#125;];</div><div class="line">    [<span class="keyword">self</span>.view addGestureRecognizer:tap];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="通知"><a href="#通知" class="headerlink" title="通知"></a>通知</h3><ul>
<li>RAC可以代替通知，并且RAC的通知不用移出</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</div><div class="line">    [<span class="keyword">super</span> viewDidLoad];</div><div class="line">    [[[<span class="built_in">NSNotificationCenter</span> defaultCenter] rac_addObserverForName:<span class="built_in">UIApplicationDidBecomeActiveNotification</span> object:<span class="literal">nil</span>] subscribeNext:^(<span class="keyword">id</span> x) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, x);</div><div class="line">    &#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="定制器"><a href="#定制器" class="headerlink" title="定制器"></a>定制器</h3><ul>
<li>RAC可以代替定时器</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</div><div class="line">    [<span class="keyword">super</span> viewDidLoad];</div><div class="line"></div><div class="line">    <span class="comment">// 延迟2秒执行</span></div><div class="line">    [[RACScheduler mainThreadScheduler] afterDelay:<span class="number">2.0</span> schedule:^&#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"haha"</span>);</div><div class="line">    &#125;];</div><div class="line"></div><div class="line">    <span class="comment">// interval为间隔事件，scheduler为在那个线程上执行，leeway为多久之后开始执行。</span></div><div class="line">    [[RACSignal interval:<span class="number">2.0</span> onScheduler:[RACScheduler mainThreadScheduler] withLeeway:<span class="number">5.0</span>] subscribeNext:^(<span class="built_in">NSDate</span> x) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, x);</div><div class="line">    &#125;];</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="代理"><a href="#代理" class="headerlink" title="代理"></a>代理</h3><ul>
<li>RAC可以替换代理，但仅限没有返回值的代理</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()&lt;<span class="title">UITableViewDelegate</span>&gt;</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIAlertView</span> *alertView;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</div><div class="line">    [<span class="keyword">super</span> viewDidLoad];</div><div class="line"></div><div class="line">    <span class="keyword">self</span>.alertView = [[<span class="built_in">UIAlertView</span> alloc] initWithTitle:<span class="string">@"RAC"</span> message:<span class="string">@"test"</span> delegate:<span class="keyword">self</span> cancelButtonTitle:<span class="string">@"OK"</span> otherButtonTitles: <span class="literal">nil</span>];</div><div class="line">    [[<span class="keyword">self</span> rac_signalForSelector:<span class="keyword">@selector</span>(alertView:clickedButtonAtIndex:) fromProtocol:<span class="class"><span class="keyword">@protocol</span>(<span class="title">UIAlertViewDelegate</span>)]<span class="title">subscribeNext</span>:^(<span class="title">id</span> <span class="title">x</span>) </span>&#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,x);</div><div class="line">    &#125;];</div><div class="line">    <span class="comment">// 或者</span></div><div class="line">    <span class="comment">// [[self.alertView rac_buttonClickedSignal] subscribeNext:^(id x) &#123;</span></div><div class="line">    <span class="comment">//     NSLog(@"%@", x);</span></div><div class="line">    <span class="comment">// &#125;];</span></div><div class="line"></div><div class="line">    [<span class="keyword">self</span>.alertView show];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<h3 id="KVO"><a href="#KVO" class="headerlink" title="KVO"></a>KVO</h3><ul>
<li>RAC可以替换KVO</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></div><div class="line"></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">NSInteger</span> index;</div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</div><div class="line">    [<span class="keyword">super</span> viewDidLoad];</div><div class="line"></div><div class="line">    [RACObserve(<span class="keyword">self</span>, index) subscribeNext:^(<span class="keyword">id</span> x) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, x);</div><div class="line">    &#125;];</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)touchesBegan:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="built_in">UIEvent</span> *)event &#123;</div><div class="line">    <span class="keyword">self</span>.index++;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<h2 id="高级用法"><a href="#高级用法" class="headerlink" title="高级用法"></a>高级用法</h2><h3 id="创建信号"><a href="#创建信号" class="headerlink" title="创建信号"></a>创建信号</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</div><div class="line">    [<span class="keyword">super</span> viewDidLoad];</div><div class="line"></div><div class="line">    RACSignal *signal = [RACSignal createSignal:^RACDisposable *(<span class="keyword">id</span>&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">        <span class="built_in">NSURLRequest</span> *req = [<span class="built_in">NSURLRequest</span> requestWithURL:[<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://www.baidu.com"</span>]];</div><div class="line">        [<span class="built_in">NSURLConnection</span> sendAsynchronousRequest:req queue:[<span class="built_in">NSOperationQueue</span> mainQueue] completionHandler:^(<span class="built_in">NSURLResponse</span> * _Nullable response, <span class="built_in">NSData</span> * _Nullable data, <span class="built_in">NSError</span> * _Nullable connectionError) &#123;</div><div class="line">            <span class="keyword">if</span> (connectionError) &#123;</div><div class="line">                <span class="comment">// 请求失败</span></div><div class="line">                [subscriber sendError:connectionError];</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">else</span> &#123;</div><div class="line">                <span class="comment">// 请求成功</span></div><div class="line">                [subscriber sendNext:data];</div><div class="line">            &#125;</div><div class="line">            [subscriber sendCompleted];</div><div class="line">        &#125;];</div><div class="line">        <span class="keyword">return</span> [RACDisposable disposableWithBlock:^&#123;</div><div class="line">            <span class="comment">// 取消订阅</span></div><div class="line">            <span class="built_in">NSLog</span>(<span class="string">@"cancel"</span>);</div><div class="line">        &#125;];</div><div class="line">    &#125;];</div><div class="line"></div><div class="line">    RACDisposable *disposable = [signal subscribeNext:^(<span class="built_in">NSData</span> *responseData) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, responseData);</div><div class="line">    &#125; error:^(<span class="built_in">NSError</span> *error) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, error);</div><div class="line">    &#125; completed:^&#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"completed"</span>);</div><div class="line">    &#125;];</div><div class="line"></div><div class="line">    <span class="comment">// 订阅完就取消订阅，这样就不会执行订阅block了</span></div><div class="line">    [disposable dispose];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="信号处理"><a href="#信号处理" class="headerlink" title="信号处理"></a>信号处理</h3><ul>
<li>map:映射</li>
<li>filter:过滤</li>
<li>delay:延时</li>
<li>startWith:在接收到信号前，先接收到一个信号</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</div><div class="line">    [<span class="keyword">super</span> viewDidLoad];</div><div class="line"></div><div class="line">    <span class="built_in">UITextField</span> *textField = (&#123;</div><div class="line">        <span class="built_in">UITextField</span> *view = [[<span class="built_in">UITextField</span> alloc] init];</div><div class="line">        [<span class="keyword">self</span>.view addSubview:view];</div><div class="line">        [view mas_makeConstraints:^(MASConstraintMaker *make) &#123;</div><div class="line">            make.center.equalTo(<span class="keyword">self</span>.view);</div><div class="line">            make.size.mas_equalTo(<span class="built_in">CGSizeMake</span>(<span class="number">200</span>, <span class="number">40</span>));</div><div class="line">        &#125;];</div><div class="line">        view.backgroundColor = [<span class="built_in">UIColor</span> redColor];</div><div class="line">        view;</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    [[[[[[textField rac_textSignal] map:^<span class="keyword">id</span>(<span class="keyword">id</span> value) &#123;</div><div class="line">        <span class="built_in">NSString</span> *str = (<span class="built_in">NSString</span> *)value;</div><div class="line">        <span class="keyword">return</span> @([str length]);</div><div class="line">    &#125;] filter:^<span class="built_in">BOOL</span>(<span class="keyword">id</span> value) &#123;</div><div class="line">        <span class="keyword">return</span> [value integerValue] &gt; <span class="number">3</span>;</div><div class="line">    &#125;] delay:<span class="number">2</span>] startWith:<span class="string">@"haha"</span>] subscribeNext:^(<span class="keyword">id</span> x) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, x);</div><div class="line">    &#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>timeout:超时</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">RACSignal *signal = [[RACSignal createSignal:^RACDisposable *(<span class="keyword">id</span>&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line"></div><div class="line">    [[RACScheduler mainThreadScheduler] afterDelay:<span class="number">1.0</span> schedule:^&#123;</div><div class="line">        [subscriber sendNext:<span class="string">@"hello"</span>];</div><div class="line">        [subscriber sendCompleted];</div><div class="line">    &#125;];</div><div class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</div><div class="line"></div><div class="line">&#125;] timeout:<span class="number">2.0</span> onScheduler:[RACScheduler mainThreadScheduler]]; <span class="comment">// 如果请求没有在2秒内完成，则请求超时，会调用errorBlock</span></div><div class="line"></div><div class="line">[signal subscribeNext:^(<span class="built_in">NSData</span> *responseData) &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, responseData);</div><div class="line">&#125; error:^(<span class="built_in">NSError</span> *error) &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, error);</div><div class="line">&#125; completed:^&#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"completed"</span>);</div><div class="line">&#125;];</div></pre></td></tr></table></figure>
<ul>
<li>take:接收到多次信号，但只处理前几次信号</li>
<li>takeLast:只处理最后几次信号</li>
<li>skip:忽略几次</li>
<li>takeUntilBlock:返回YES可以表示不接收，返回NO表示接收该信号，与filter类似</li>
<li>takeWhileBlock:当返回一次YES后，就停止接收所有信号</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">RACSignal *signal = [[RACSignal createSignal:^RACDisposable *(<span class="keyword">id</span>&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line"></div><div class="line">    [subscriber sendNext:<span class="string">@"hello1"</span>];</div><div class="line">    [subscriber sendNext:<span class="string">@"hello2"</span>];</div><div class="line">    [subscriber sendNext:<span class="string">@"hello3"</span>];</div><div class="line">    [subscriber sendNext:<span class="string">@"hello4"</span>];</div><div class="line">    [subscriber sendNext:<span class="string">@"hello5"</span>];</div><div class="line">    [subscriber sendCompleted];</div><div class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</div><div class="line"></div><div class="line">&#125;] takeLast:<span class="number">2</span>];</div><div class="line"></div><div class="line">[signal subscribeNext:^(<span class="keyword">id</span> value) &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, value);</div><div class="line">&#125;];</div></pre></td></tr></table></figure>
<ul>
<li>throttle:节流，可以规定两个信号的间隔时间必须大于某个值</li>
<li>distinctUntilChanged:直到订阅的内容发生变化才会处理信号</li>
<li>ignore:忽略某些信号值</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">UITextField</span> *textField = (&#123;</div><div class="line">    <span class="built_in">UITextField</span> *view = [[<span class="built_in">UITextField</span> alloc] init];</div><div class="line">    [<span class="keyword">self</span>.view addSubview:view];</div><div class="line">    [view mas_makeConstraints:^(MASConstraintMaker *make) &#123;</div><div class="line">        make.center.equalTo(<span class="keyword">self</span>.view);</div><div class="line">        make.size.mas_equalTo(<span class="built_in">CGSizeMake</span>(<span class="number">200</span>, <span class="number">40</span>));</div><div class="line">    &#125;];</div><div class="line">    view.backgroundColor = [<span class="built_in">UIColor</span> redColor];</div><div class="line">    view;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// 如果文字的改变速度过快，则不处理，两次信号间隔时间必须大于0.3秒</span></div><div class="line">[[[[[textField rac_textSignal] throttle:<span class="number">0.3</span>] distinctUntilChanged] ignore:<span class="string">@""</span>] subscribeNext:^(<span class="keyword">id</span> x) &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, x);</div><div class="line">&#125;];</div></pre></td></tr></table></figure>
<ul>
<li>flattenMap:订阅的值为一个信号，将该信号转为订阅具体的值</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">UITextField</span> *textField = (&#123;</div><div class="line">    <span class="built_in">UITextField</span> *view = [[<span class="built_in">UITextField</span> alloc] init];</div><div class="line">    [<span class="keyword">self</span>.view addSubview:view];</div><div class="line">    [view mas_makeConstraints:^(MASConstraintMaker *make) &#123;</div><div class="line">        make.center.equalTo(<span class="keyword">self</span>.view);</div><div class="line">        make.size.mas_equalTo(<span class="built_in">CGSizeMake</span>(<span class="number">200</span>, <span class="number">40</span>));</div><div class="line">    &#125;];</div><div class="line">    view.backgroundColor = [<span class="built_in">UIColor</span> redColor];</div><div class="line">    view;</div><div class="line">&#125;);</div><div class="line"></div><div class="line">[[[textField.rac_textSignal throttle:<span class="number">0.3</span>] flattenMap:^<span class="keyword">id</span>(<span class="keyword">id</span> value) &#123;</div><div class="line">    <span class="keyword">return</span> [RACSignal createSignal:^RACDisposable *(<span class="keyword">id</span>&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">        [subscriber sendNext:<span class="string">@"aaa"</span>];</div><div class="line">        [subscriber sendCompleted];</div><div class="line">        <span class="keyword">return</span> [RACDisposable disposableWithBlock:^&#123;</div><div class="line"></div><div class="line">        &#125;];</div><div class="line">    &#125;];</div><div class="line">&#125;] subscribeNext:^(<span class="keyword">id</span> x) &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, x);</div><div class="line">&#125;];</div></pre></td></tr></table></figure>
<ul>
<li>repeat:重复发送某个信号</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">RACSignal *signal = [[RACSignal createSignal:^RACDisposable *(<span class="keyword">id</span>&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">        [subscriber sendNext:[<span class="built_in">NSDate</span> date]];</div><div class="line">        [subscriber sendCompleted];</div><div class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</div><div class="line">    &#125;] repeat];</div><div class="line"></div><div class="line">    [signal subscribeNext:^(<span class="keyword">id</span> x) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, x);</div><div class="line">    &#125;];</div></pre></td></tr></table></figure>
<ul>
<li>merge:同时订阅两个信号源，无论哪个发出信号，都会执行</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">RACSignal *signalA = [RACSignal createSignal:^RACDisposable *(<span class="keyword">id</span>&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">      dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class="number">2.0</span> * <span class="built_in">NSEC_PER_SEC</span>)), dispatch_get_main_queue(), ^&#123;</div><div class="line">          [subscriber sendNext:<span class="string">@"1"</span>];</div><div class="line">          [subscriber sendCompleted];</div><div class="line">      &#125;);</div><div class="line">      <span class="keyword">return</span> <span class="literal">nil</span>;</div><div class="line">  &#125;];</div><div class="line"></div><div class="line">  RACSignal *signalB = [RACSignal createSignal:^RACDisposable *(<span class="keyword">id</span>&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">      dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class="number">3.0</span> * <span class="built_in">NSEC_PER_SEC</span>)), dispatch_get_main_queue(), ^&#123;</div><div class="line">          [subscriber sendNext:<span class="string">@"2"</span>];</div><div class="line">          [subscriber sendCompleted];</div><div class="line">      &#125;);</div><div class="line">      <span class="keyword">return</span> <span class="literal">nil</span>;</div><div class="line">  &#125;];</div><div class="line"></div><div class="line">  [[signalA merge:signalB] subscribeNext:^(<span class="keyword">id</span> x) &#123;</div><div class="line">      <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, x);</div><div class="line">  &#125;];</div></pre></td></tr></table></figure>
<ul>
<li>combineLatest:reduce:这是一个RACSignal的类方法，表示同时聚合多个信号</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">RACSignal *signalA = [RACSignal createSignal:^RACDisposable *(<span class="keyword">id</span>&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">        dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class="number">2.0</span> * <span class="built_in">NSEC_PER_SEC</span>)), dispatch_get_main_queue(), ^&#123;</div><div class="line">            [subscriber sendNext:<span class="string">@"1"</span>];</div><div class="line">            [subscriber sendCompleted];</div><div class="line">        &#125;);</div><div class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</div><div class="line">    &#125;];</div><div class="line"></div><div class="line">    RACSignal *signalB = [RACSignal createSignal:^RACDisposable *(<span class="keyword">id</span>&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">        dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class="number">3.0</span> * <span class="built_in">NSEC_PER_SEC</span>)), dispatch_get_main_queue(), ^&#123;</div><div class="line">            [subscriber sendNext:<span class="string">@"2"</span>];</div><div class="line">            [subscriber sendCompleted];</div><div class="line">        &#125;);</div><div class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</div><div class="line">    &#125;];</div><div class="line"></div><div class="line">    [[RACSignal combineLatest:@[signalA, signalB] reduce:^<span class="keyword">id</span>(<span class="built_in">NSString</span> *s1, <span class="built_in">NSString</span> *s2)&#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"s1=%@, s2=%@"</span>, s1, s2);</div><div class="line">        <span class="keyword">return</span> [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%@%@"</span>, s1, s2];</div><div class="line">    &#125;] subscribeNext:^(<span class="keyword">id</span> x) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, x);</div><div class="line">    &#125;];</div></pre></td></tr></table></figure>
<ul>
<li>concat:先订阅信号A，A执行完成后再订阅信号B</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">RACSignal *signalA = [RACSignal createSignal:^RACDisposable *(<span class="keyword">id</span>&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class="number">2.0</span> * <span class="built_in">NSEC_PER_SEC</span>)), dispatch_get_main_queue(), ^&#123;</div><div class="line">        [subscriber sendNext:<span class="string">@"1"</span>];</div><div class="line">        [subscriber sendCompleted];</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</div><div class="line">&#125;];</div><div class="line"></div><div class="line">RACSignal *signalB = [RACSignal createSignal:^RACDisposable *(<span class="keyword">id</span>&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class="number">2.0</span> * <span class="built_in">NSEC_PER_SEC</span>)), dispatch_get_main_queue(), ^&#123;</div><div class="line">        [subscriber sendNext:<span class="string">@"2"</span>];</div><div class="line">        [subscriber sendCompleted];</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</div><div class="line">&#125;];</div><div class="line"></div><div class="line"><span class="comment">// 先订阅A，A执行完成后，再执行B，如果A失败了，不会再执行B</span></div><div class="line">[[signalA concat:signalB] subscribeNext:^(<span class="keyword">id</span> x) &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, x);</div><div class="line">&#125;];</div></pre></td></tr></table></figure>
<ul>
<li>zipWith:两个信号都发出后，再执行，也可以使用combineLatest:</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">RACSignal *signalA = [RACSignal createSignal:^RACDisposable *(<span class="keyword">id</span>&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class="number">2.0</span> * <span class="built_in">NSEC_PER_SEC</span>)), dispatch_get_main_queue(), ^&#123;</div><div class="line">        [subscriber sendNext:<span class="string">@"1"</span>];</div><div class="line">        [subscriber sendCompleted];</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</div><div class="line">&#125;];</div><div class="line"></div><div class="line">RACSignal *signalB = [RACSignal createSignal:^RACDisposable *(<span class="keyword">id</span>&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class="number">3.0</span> * <span class="built_in">NSEC_PER_SEC</span>)), dispatch_get_main_queue(), ^&#123;</div><div class="line">        [subscriber sendNext:<span class="string">@"2"</span>];</div><div class="line">        [subscriber sendCompleted];</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</div><div class="line">&#125;];</div><div class="line"></div><div class="line">[[signalA zipWith:signalB] subscribeNext:^(<span class="keyword">id</span> x) &#123;</div><div class="line">    <span class="comment">// x是一个RACTuple，包含了signalA和signalB的值</span></div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, x);</div><div class="line">&#125;];</div></pre></td></tr></table></figure>
<h3 id="RAC的坑"><a href="#RAC的坑" class="headerlink" title="RAC的坑"></a>RAC的坑</h3><ul>
<li>side effect: 一个信号源被多个订阅者订阅，每个订阅者收到的信号可能不一样。解决方法：使用reply</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">RACSignal *signalA = [[RACSignal createSignal:^RACDisposable *(<span class="keyword">id</span>&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">int</span> i = <span class="number">0</span>;</div><div class="line">    i++;</div><div class="line">    [subscriber sendNext:@(i)];</div><div class="line">    [subscriber sendCompleted];</div><div class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</div><div class="line">&#125;] replay];</div><div class="line"></div><div class="line">[signalA subscribeNext:^(<span class="keyword">id</span> x) &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, x);</div><div class="line">&#125;];</div><div class="line"></div><div class="line">[signalA subscribeNext:^(<span class="keyword">id</span> x) &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, x);</div><div class="line">&#125;];</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/12/13/CoreAnimation编程指南学习笔记(2)/" itemprop="url">
                  CoreAnimation编程指南学习笔记(2)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-12-13T00:00:00+08:00" content="2015-12-13">
              2015-12-13
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/读书笔记/" itemprop="url" rel="index">
                    <span itemprop="name">读书笔记</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/12/13/CoreAnimation编程指南学习笔记(2)/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/12/13/CoreAnimation编程指南学习笔记(2)/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="第六章-动画"><a href="#第六章-动画" class="headerlink" title="第六章 动画"></a>第六章 动画</h2><h3 id="动画类"><a href="#动画类" class="headerlink" title="动画类"></a>动画类</h3><ul>
<li>CABasicAnimation提供了在图层的属性值间简单的插入。</li>
<li>CAKeyframeAnimation提供支持关键帧动画。你指定动画的一个图层属性的关键路径，一个表示在动画的每个阶段的价值的数组，还有一个关键帧时间的数组和时间函数。</li>
<li>CATransition提供了一个影响整个图层的内容过渡效果。在动画显示过程中采用淡出（fade）、推出(push)、显露(reveal)图层的内容。 常用的过渡效果可以通过提供你自己定制的核心图像滤镜来扩展。</li>
</ul>
<h3 id="隐式动画"><a href="#隐式动画" class="headerlink" title="隐式动画"></a>隐式动画</h3><p>隐式动画指所有修改CALayer的可动画属性，默认会都会带有动画。例如<code>self.layer.position = CGPointMake(200, 200);</code>默认是带有动画效果的。注意一定是修改layer属性，修改UIView的属性，默认是不带有隐式动画的。而且UIView默认带有的layer属性也是不带隐式动画的。</p>
<h3 id="显示动画"><a href="#显示动画" class="headerlink" title="显示动画"></a>显示动画</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">CABasicAnimation</span> *anim = [<span class="built_in">CABasicAnimation</span> 	animationWithKeyPath:<span class="string">@"opacity"</span>];</div><div class="line">   anim.fromValue = @(<span class="number">1.0</span>);</div><div class="line">   anim.toValue = @(<span class="number">0.5</span>);</div><div class="line">   anim.autoreverses = <span class="literal">YES</span>;</div><div class="line">   anim.repeatCount = <span class="number">10</span>;</div><div class="line">   anim.duration = <span class="number">2</span>;</div><div class="line">   [<span class="keyword">self</span>.layer addAnimation:anim forKey:<span class="string">@"anim"</span>];</div></pre></td></tr></table></figure>
<h2 id="第七章-事务"><a href="#第七章-事务" class="headerlink" title="第七章 事务"></a>第七章 事务</h2><p>图层的每一个改变都是事务的一部分。隐式分为显示事务和隐式事务。隐式事务由系统自动创建和提交，在修改图层属性时，系统会自动创建一个事务，在下一次运行循环时自动提交。显示事务由用户程序控制创建和提交。一旦创建了显示事务，系统就不会再创建隐式事务。</p>
<h3 id="使用显式事务禁止隐式动画"><a href="#使用显式事务禁止隐式动画" class="headerlink" title="使用显式事务禁止隐式动画"></a>使用显式事务禁止隐式动画</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[<span class="built_in">CATransaction</span> begin];</div><div class="line">   [<span class="built_in">CATransaction</span> setDisableActions:<span class="literal">YES</span>];</div><div class="line">   <span class="keyword">self</span>.layer.position = <span class="built_in">CGPointMake</span>(<span class="number">200</span>, <span class="number">200</span>);</div><div class="line">   [<span class="built_in">CATransaction</span> commit];</div></pre></td></tr></table></figure>
<h3 id="修改隐式动画的动画时长"><a href="#修改隐式动画的动画时长" class="headerlink" title="修改隐式动画的动画时长"></a>修改隐式动画的动画时长</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[<span class="built_in">CATransaction</span> begin];</div><div class="line">   [<span class="built_in">CATransaction</span> setAnimationDuration:<span class="number">2.0</span>];</div><div class="line">   <span class="keyword">self</span>.layer.position = <span class="built_in">CGPointMake</span>(<span class="number">200</span>, <span class="number">200</span>);</div><div class="line">   [<span class="built_in">CATransaction</span> commit];</div></pre></td></tr></table></figure>
<h2 id="第八章-KVC"><a href="#第八章-KVC" class="headerlink" title="第八章 KVC"></a>第八章 KVC</h2><p>CoreAnimation是通过KVC来实现对不同字段或关键路径进行动画的，使用方法如下</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[theLayer setValue:[<span class="built_in">NSNumber</span> numberWithInteger:<span class="number">50</span>] forKey:<span class="string">@"someKey"</span>];</div></pre></td></tr></table></figure>
<p>使用<code>defaultValueForKey:</code>可以获取字段的默认值。</p>
<p>CAAnimation提供支持使用关键路径访问选择的结构字段。目前支持的字段如下</p>
<p><img src="http://7xn88v.com1.z0.glb.clouddn.com/2015-12-13_10-42-53.jpg" alt=""></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/12/06/CoreAnimation编程指南学习笔记(1)/" itemprop="url">
                  CoreAnimation编程指南学习笔记(1)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-12-06T00:00:00+08:00" content="2015-12-06">
              2015-12-06
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/读书笔记/" itemprop="url" rel="index">
                    <span itemprop="name">读书笔记</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/12/06/CoreAnimation编程指南学习笔记(1)/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/12/06/CoreAnimation编程指南学习笔记(1)/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="第一章：核心动画概念"><a href="#第一章：核心动画概念" class="headerlink" title="第一章：核心动画概念"></a>第一章：核心动画概念</h2><p>CoreAnimation框架中类的分类</p>
<ul>
<li>提供显示内容的图层类</li>
<li>动画和计时类</li>
<li>布局和约束类</li>
<li>事务类，在原子更新的时候组合图层类</li>
</ul>
<h3 id="图层类（Layer-Classes）"><a href="#图层类（Layer-Classes）" class="headerlink" title="图层类（Layer Classes）"></a>图层类（Layer Classes）</h3><p>CALayer是所有层类的父类，几个常见的图层子类：CAScrollLayer,CATextLayer,CATiledLayer等</p>
<h3 id="动画类和计时类"><a href="#动画类和计时类" class="headerlink" title="动画类和计时类"></a>动画类和计时类</h3><p>CAAnimation是动画类的基类，他实现了CAMediaTiming协议，提供了动画的持续时间，速度，和重复计数等。他也实现了CAAction协议，该协议为图层触发一个动画动作提供了标准化响应。</p>
<p>动画类同时定义了一个使用贝塞尔曲线来描述动画改变的时间函数。</p>
<ul>
<li>CATransition：提供了一个图层改变的过渡效果，他能影响图层的整个内容。</li>
<li>CAAnimationGroup:组动画</li>
<li>CAPropertyAnimation:属性动画</li>
<li>CABasicAnimation:基础动画</li>
<li>CAKeyframeAnimation:关键帧动画</li>
</ul>
<h3 id="布局管理类"><a href="#布局管理类" class="headerlink" title="布局管理类"></a>布局管理类</h3><p>CAConstraint类是一个布局管理类，他可以指定子图层类限制于你指定的约束集合。</p>
<h3 id="事务管理类"><a href="#事务管理类" class="headerlink" title="事务管理类"></a>事务管理类</h3><p>CATransaction是核心动画里面负责协调多个动画原子更新显示操作。事务支持嵌套使用。核心动画支持两种事务：隐式事务和显式事务。</p>
<h2 id="第二章：渲染架构"><a href="#第二章：渲染架构" class="headerlink" title="第二章：渲染架构"></a>第二章：渲染架构</h2><p>每个可见的图层树由两个相应的树组成，一个是呈现树，一个是渲染树。修改图层的一个属性，图层树里相应的值会被马上更新，但是呈现树里面的值在将要显示给用户的时候才会被更新为新值。</p>
<h2 id="第三章：几何变换"><a href="#第三章：几何变换" class="headerlink" title="第三章：几何变换"></a>第三章：几何变换</h2><p>anchorPoint:锚点，他指定了bounds相对于position的值，同时也作为变换时候的支点。在Autolayout设置约束时，锚点的值也会影响视图显示的位置。</p>
<p>几何变换：CATransform3D，可以使用变换函数进行变换，例如CATransform3DMakeTranslation，CATransform3DTranslate等，也可以通过键值路径修改变换。</p>
<h2 id="第四章：图层树结构"><a href="#第四章：图层树结构" class="headerlink" title="第四章：图层树结构"></a>第四章：图层树结构</h2><p>图层树与视图的结构很类似：</p>
<ul>
<li>每个图层定义了一个基于其父图层的坐标系的坐标系，当一个图层变换的时候，他的子图层同样变换</li>
<li>一个动态的图层树，可以在程序运行的时候重新设置，图层可以添加，也可以删除</li>
</ul>
<p>ios中，每个UIView的实例会自动创建一个CALayer类的实体，视图为图层提供了底层的事件处理，图层为视图提供了显示的内容。</p>
<h2 id="第五章：图层的内容"><a href="#第五章：图层的内容" class="headerlink" title="第五章：图层的内容"></a>第五章：图层的内容</h2><p>使用CALayer无需创建继承子类，直接设置CALayer的contents属性即可，contents属性是一个CGImageRef类型，这样子创建比使用UIImageView效率要高</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">self</span>.myLayer = [[<span class="built_in">CALayer</span> alloc] init];</div><div class="line"><span class="keyword">self</span>.myLayer.bounds = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>);</div><div class="line"><span class="keyword">self</span>.myLayer.position = <span class="built_in">CGPointMake</span>(<span class="number">100</span>, <span class="number">100</span>);</div><div class="line"><span class="keyword">self</span>.myLayer.backgroundColor = [<span class="built_in">UIColor</span> redColor].CGColor;</div><div class="line"><span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"1.JPG"</span>];</div><div class="line"><span class="keyword">self</span>.myLayer.contents = (__bridge <span class="keyword">id</span> _Nullable)(image.CGImage);</div><div class="line">[<span class="keyword">self</span>.view.layer addSublayer:<span class="keyword">self</span>.myLayer];</div></pre></td></tr></table></figure>
<p>也可以通过代理方法，提供CALayer的内容，有两个代理方法：<code>- (void)displayLayer:(CALayer *)theLayer</code>与<code>- (void)drawLayer:(CALayer *)layer inContext:(CGContextRef)ctx</code>, 要通知系统重绘图层，只需要调用CALayer的<code>setNeedsDisplay</code>或者<code>setNeedsDisplayInRect:</code>方法或者把图层的needsDisplayOnBoundsChange属性值设置为YES即可。</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)drawLayer:(<span class="built_in">CALayer</span> *)layer inContext:(<span class="built_in">CGContextRef</span>)ctx &#123;</div><div class="line">    <span class="built_in">CGMutablePathRef</span> thePath = <span class="built_in">CGPathCreateMutable</span>();</div><div class="line">    <span class="built_in">CGPathMoveToPoint</span>(thePath,<span class="literal">NULL</span>,<span class="number">15.0</span>f,<span class="number">15.</span>f);</div><div class="line">    <span class="built_in">CGPathAddCurveToPoint</span>(thePath,</div><div class="line">                          <span class="literal">NULL</span>,</div><div class="line">                          <span class="number">15.</span>f,<span class="number">250.0</span>f,</div><div class="line">                          <span class="number">295.0</span>f,<span class="number">250.0</span>f,</div><div class="line">                          <span class="number">295.0</span>f,<span class="number">15.0</span>f);</div><div class="line">    <span class="built_in">CGContextBeginPath</span>(ctx);</div><div class="line">    <span class="built_in">CGContextAddPath</span>(ctx, thePath );</div><div class="line">    <span class="built_in">CGContextSetLineWidth</span>(ctx, <span class="number">5</span>);</div><div class="line">    <span class="built_in">CGContextStrokePath</span>(ctx);</div><div class="line">    <span class="comment">// release the path</span></div><div class="line">    <span class="built_in">CFRelease</span>(thePath);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)displayLayer:(<span class="built_in">CALayer</span> *)layer &#123;</div><div class="line">    <span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"1.JPG"</span>];</div><div class="line">    layer.contents = (__bridge <span class="keyword">id</span> _Nullable)(image.CGImage);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>除了设置代理方法，也可以通过继承CALayer，重写<code>display</code>方法或<code>- (void)drawInContext:(CGContextRef)theContext</code>方法来自定义图层</p>
<p>CALayer的contentsGravity属性相当于UIView的contentMode属性。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/11/07/ContentHugging与ContentCompressionResistance/" itemprop="url">
                  Content Hugging与Content Compression Resistance
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-11-07T00:00:00+08:00" content="2015-11-07">
              2015-11-07
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/iOS开发/" itemprop="url" rel="index">
                    <span itemprop="name">iOS开发</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/11/07/ContentHugging与ContentCompressionResistance/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/11/07/ContentHugging与ContentCompressionResistance/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近在使用Autolayout遇到了一个问题，我设置了一个UILabel的宽度约束，希望这个UILabel在显示时，如果内容宽度没有超过约束的宽度，则以约束的宽度显示，如果<br>内容宽度超过约束的宽度，则以内容的宽度显示，这时，如果只设置宽度约束，UILabel会始终以约束的宽度显示，如果降低宽度约束，则UILabel就会使用以内容的宽度显示，<br>始终无法达到我想要的效果，于是一番Google，便发现了Content Hugging与Content Compression Resistance两个概念。</p>
<h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><p><strong>Content Hugging Priority</strong> 字面意思为内容紧缩，通过改变它的优先级，可以设置当View的大小大于实际内容的大小时，是否将View缩小，使其紧紧包裹住内容</p>
<p><strong>Content Compression Resistance Priority</strong> 字面意思为阻止内容紧缩，通过改变它的优先级，可以设置当View的大小小于实际内容的大小时，是否将View扩大，使其紧紧包裹内容</p>
<h2 id="实例应用"><a href="#实例应用" class="headerlink" title="实例应用"></a>实例应用</h2><p>本例将以一个UILabel为例，来说明一下ContentHugging与ContentCompressionResistance的具体设置方法。</p>
<p>首先创建一个空项目，打开SB，拖入一个UILabel，然后设置一下三个约束：</p>
<blockquote>
<ol>
<li>水平居中对齐</li>
<li>垂直居中对齐</li>
<li>宽度为100</li>
</ol>
</blockquote>
<p>为类方便观察，给Label加一个背景颜色，设置完运行如下图：</p>
<p><img src="http://7xn88v.com1.z0.glb.clouddn.com/Screen%20Shot%202015-11-07%20at%2022.46.17.png" alt="image"></p>
<p>然后改变宽度约束的优先级为500，如图：</p>
<p><img src="http://7xn88v.com1.z0.glb.clouddn.com/Screen%20Shot%202015-11-07%20at%2022.15.10.png" alt="image"></p>
<p>然后就可以开始设置ContentHuggingPriority与ContentCompressionResistancePriority了，设置界面如下：</p>
<p><img src="http://7xn88v.com1.z0.glb.clouddn.com/Screen%20Shot%202015-11-07%20at%2022.30.26.png" alt="image"></p>
<p>首先设置水平方向上的ContentHuggingPriority为501，运行项目，显示效果如下：</p>
<p><img src="http://7xn88v.com1.z0.glb.clouddn.com/Screen%20Shot%202015-11-07%20at%2022.44.05.png" alt="image"></p>
<p>如果设置水平方向上的ContentHuggingPriority为499，运行项目，显示效果如下：</p>
<p><img src="http://7xn88v.com1.z0.glb.clouddn.com/Screen%20Shot%202015-11-07%20at%2022.46.17.png" alt="image"></p>
<p>这是因为当宽度约束的优先级大于ContentHuggingPriority，优先以约束的宽度显示，当宽度约束的优先级小于ContentHuggingPriority时，如果Label的大小<br>大于内容的大小，则会按实际内容的大小显示。</p>
<p>接下来改变Label的宽度约束值为30，然后运行项目，显示效果如下：</p>
<p><img src="http://7xn88v.com1.z0.glb.clouddn.com/Screen%20Shot%202015-11-07%20at%2022.44.05.png" alt="image"></p>
<p>水平方向上ContentCompressionResistancePriority的默认值为750，将其改为499，则显示效果如下：</p>
<p><img src="http://7xn88v.com1.z0.glb.clouddn.com/Screen%20Shot%202015-11-07%20at%2023.02.49.png" alt="image"></p>
<p>这是因为当宽度约束的优先级大于ContentCompressionResistancePriority，优先以约束的宽度显示，当宽度约束的优先级小于ContentCompressionResistancePriority<br>时，如果Label的大小小于内容的大小，则会按实际内容的大小显示</p>
<p>除了在SB中设置外，还可以在代码中设置，代码如下：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">// 设置水平方向上内容紧缩的优先级为高</span></div><div class="line">[<span class="keyword">self</span>.label setContentHuggingPriority:<span class="built_in">UILayoutPriorityDefaultHigh</span> forAxis:<span class="built_in">UILayoutConstraintAxisHorizontal</span>];</div><div class="line"></div><div class="line"><span class="comment">// 设置垂直方向上阻止内容紧缩的优先级为低</span></div><div class="line">[<span class="keyword">self</span>.label setContentCompressionResistancePriority:<span class="built_in">UILayoutPriorityDefaultLow</span> forAxis:<span class="built_in">UILayoutConstraintAxisVertical</span>];</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/10/27/UIScrollView与Autolayout/" itemprop="url">
                  UIScrollView与Autolayout
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-10-27T00:00:00+08:00" content="2015-10-27">
              2015-10-27
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/iOS开发/" itemprop="url" rel="index">
                    <span itemprop="name">iOS开发</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/10/27/UIScrollView与Autolayout/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/10/27/UIScrollView与Autolayout/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在Autolayout中应用UIScrollView一直以来都是一个难点或易错点，本文是我在参考了很多资料后，总结的两种在Autolayout中正确使用UIScrollView的方法。本文主要以两个<br>Demo为例，讲解一下如何在Autolayout中应用UIScrollView，希望对大家能有帮助。</p>
<p>先看一下最终的效果吧！</p>
<p><img src="http://7xn88v.com1.z0.glb.clouddn.com/AutolayoutDemo.gif" alt="image"></p>
<h2 id="使用Storyboard布局"><a href="#使用Storyboard布局" class="headerlink" title="使用Storyboard布局"></a>使用Storyboard布局</h2><p>首先创建一个Single View Application项目，然后在Storyboard中完成如下布局。</p>
<p><img src="http://7xn88v.com1.z0.glb.clouddn.com/Screen%20Shot%202015-10-27%20at%2022.29.54.png" alt="image"></p>
<p>第三个Controller就是我们要实现的界面（以下简称主界面），然后向主界面中拖入一个UIScrollView和一个UIView（姑且叫做A），并且设置UIScrollView的约束如下：</p>
<p><img src="http://7xn88v.com1.z0.glb.clouddn.com/Screen%20Shot%202015-10-27%20at%2022.38.34.png" alt="image"></p>
<p>设置A的约束如下，注意不要添加底边距，或者高度约束</p>
<p><img src="http://7xn88v.com1.z0.glb.clouddn.com/Screen%20Shot%202015-10-27%20at%2022.45.57.png" alt="image"></p>
<p><strong>注意，这个A和UIScrollView是同一级的，并不是父子视图的关系。A主要是用来辅助计算UIScrollView中内容的高度的。</strong></p>
<p>此时设置完成后会有约束冲突（A缺少高度约束），先不用在意。接着向UIScrollView中拖入一个UIView（姑且叫做B），然后设置B的宽度和高度约束与A相等，如下图，可以在左侧<br>导航视图中拖线设置。</p>
<p><img src="http://7xn88v.com1.z0.glb.clouddn.com/Screen%20Shot%202015-10-27%20at%2022.56.15.png" alt="image"></p>
<p>然后设置B的边界约束如下：</p>
<p><img src="http://7xn88v.com1.z0.glb.clouddn.com/Screen%20Shot%202015-10-27%20at%2022.38.34.png" alt="image"></p>
<p>设置完成后，此时的主界面的结构如下图：</p>
<p><img src="http://7xn88v.com1.z0.glb.clouddn.com/Screen%20Shot%202015-10-27%20at%2022.58.06.png" alt="image"></p>
<p><strong>B其实就是作为UIScrollView的contentView存在的，把所有原本是UIScrollView中的子控件都应该放在B中。</strong></p>
<p>接下里就是布局主要界面，像最终效果图那样，拖入三个UIImageView和一个UILabel，并且设置对应的约束。（此处设置省略，具体可以参考我项目中的设置）注意不要设置UILabel<br>的高度约束，并且要设置底部两个UIImageView的下边距约束，这样B就会根据显示的内容自适应高度，并且UIScrollView也会根据B的高度设置contentSize。</p>
<p>整个过程过程的关键点就在于A，B两个UIView，A作为一个辅助视图，辅助UIScrollView计算UIScrollView中内容的高度。B的作用是分离UIScrollView和其子控件之间的关系，<br>使得UIScrollView仅与B产生约束关系。</p>
<h2 id="使用Masonry进行布局"><a href="#使用Masonry进行布局" class="headerlink" title="使用Masonry进行布局"></a>使用Masonry进行布局</h2><p>下面使用第三方框架Masonry进行布局，完成上述功能。</p>
<p>首先使用CocoaPods安装Masonry，然后在UItableViewController中添加一个cell，并在SB中创建一个新的UIViewController，绑定对应的类AutolayoutViewController，<br>如下图：</p>
<p><img src="http://7xn88v.com1.z0.glb.clouddn.com/Screen%20Shot%202015-10-28%20at%2000.05.28.png" alt="image"></p>
<p>在AutolayoutViewController中添加代码，核心代码如下</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</div><div class="line">    [<span class="keyword">super</span> viewDidLoad];</div><div class="line"></div><div class="line">    <span class="keyword">self</span>.scrollView = [[<span class="built_in">UIScrollView</span> alloc] init];</div><div class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.scrollView];</div><div class="line"></div><div class="line">    <span class="comment">// 把所有子视图都放在containerView中，然后把containerView加在UIScrollView中</span></div><div class="line">    <span class="keyword">self</span>.containerView = [[<span class="built_in">UIView</span> alloc] init];</div><div class="line">    [<span class="keyword">self</span>.scrollView addSubview:<span class="keyword">self</span>.containerView];</div><div class="line"></div><div class="line">    <span class="keyword">self</span>.topImage = [[<span class="built_in">UIImageView</span> alloc] init];</div><div class="line">    <span class="keyword">self</span>.topImage.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"1.JPG"</span>];</div><div class="line">    [<span class="keyword">self</span>.containerView addSubview:<span class="keyword">self</span>.topImage];</div><div class="line"></div><div class="line">    <span class="keyword">self</span>.descLabel = [[<span class="built_in">UILabel</span> alloc] init];</div><div class="line">    <span class="keyword">self</span>.descLabel.numberOfLines = <span class="number">0</span>;</div><div class="line">    <span class="keyword">self</span>.descLabel.text = <span class="string">@"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"</span>;</div><div class="line">    [<span class="keyword">self</span>.containerView addSubview:<span class="keyword">self</span>.descLabel];</div><div class="line"></div><div class="line">    <span class="keyword">self</span>.leftImage = [[<span class="built_in">UIImageView</span> alloc] init];</div><div class="line">    <span class="keyword">self</span>.leftImage.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"2.JPG"</span>];</div><div class="line">    [<span class="keyword">self</span>.containerView addSubview:<span class="keyword">self</span>.leftImage];</div><div class="line"></div><div class="line">    <span class="keyword">self</span>.rightImage = [[<span class="built_in">UIImageView</span> alloc] init];</div><div class="line">    <span class="keyword">self</span>.rightImage.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"3.JPG"</span>];</div><div class="line">    [<span class="keyword">self</span>.containerView addSubview:<span class="keyword">self</span>.rightImage];</div><div class="line"></div><div class="line">    [<span class="keyword">self</span>.scrollView mas_updateConstraints:^(MASConstraintMaker *make) &#123;</div><div class="line">        make.edges.equalTo(<span class="keyword">self</span>.view);</div><div class="line">    &#125;];</div><div class="line"></div><div class="line">    [<span class="keyword">self</span>.containerView mas_updateConstraints:^(MASConstraintMaker *make) &#123;</div><div class="line">        make.edges.equalTo(<span class="keyword">self</span>.scrollView);</div><div class="line">        make.width.equalTo(<span class="keyword">self</span>.scrollView);</div><div class="line">    &#125;];</div><div class="line"></div><div class="line">    [<span class="keyword">self</span>.topImage mas_updateConstraints:^(MASConstraintMaker *make) &#123;</div><div class="line">        make.top.mas_equalTo(<span class="keyword">self</span>.containerView).offset(<span class="number">20</span>);</div><div class="line">        make.left.mas_equalTo(<span class="keyword">self</span>.containerView).offset(<span class="number">20</span>);</div><div class="line">        make.right.mas_equalTo(<span class="keyword">self</span>.containerView).offset(<span class="number">-20</span>);</div><div class="line">        make.height.mas_equalTo(<span class="number">200</span>);</div><div class="line">    &#125;];</div><div class="line"></div><div class="line">    <span class="comment">// 注意不要设置descLabel的高度约束</span></div><div class="line">    [<span class="keyword">self</span>.descLabel mas_updateConstraints:^(MASConstraintMaker *make) &#123;</div><div class="line">        make.left.equalTo(<span class="keyword">self</span>.topImage);</div><div class="line">        make.right.equalTo(<span class="keyword">self</span>.topImage);</div><div class="line">        make.top.mas_equalTo(<span class="keyword">self</span>.topImage.mas_bottom).offset(<span class="number">20</span>);</div><div class="line">    &#125;];</div><div class="line"></div><div class="line">    [<span class="keyword">self</span>.leftImage mas_updateConstraints:^(MASConstraintMaker *make) &#123;</div><div class="line">        make.size.equalTo(<span class="keyword">self</span>.rightImage);</div><div class="line">        make.left.equalTo(<span class="keyword">self</span>.topImage);</div><div class="line">        make.right.mas_equalTo(<span class="keyword">self</span>.rightImage.mas_left).offset(<span class="number">20</span>);</div><div class="line">        make.top.mas_equalTo(<span class="keyword">self</span>.descLabel.mas_bottom).offset(<span class="number">20</span>);</div><div class="line">        make.height.mas_equalTo(<span class="number">150</span>);</div><div class="line">        make.bottom.mas_equalTo(<span class="keyword">self</span>.containerView.mas_bottom).offset(<span class="number">-20</span>);</div><div class="line">    &#125;];</div><div class="line"></div><div class="line">    [<span class="keyword">self</span>.rightImage mas_updateConstraints:^(MASConstraintMaker *make) &#123;</div><div class="line">        make.top.equalTo(<span class="keyword">self</span>.leftImage);</div><div class="line">        make.right.mas_equalTo(<span class="keyword">self</span>.containerView.mas_right).offset(<span class="number">-20</span>);</div><div class="line">    &#125;];</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这里的关键点是那个containerView，它分离了UIScrollView和子视图的关系。</p>
<p>以上就是本人总结的关于在Autolayout中应用UIScrollView的方法，如果有什么错误欢迎指出。</p>
<p><a href="https://github.com/liujinlongxa/AutolayoutDemo" target="_blank" rel="external">代码在这里</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/10/16/最近开发中遇到的一些问题/" itemprop="url">
                  最近开发中遇到的一些问题
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-10-16T00:00:00+08:00" content="2015-10-16">
              2015-10-16
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/iOS开发/" itemprop="url" rel="index">
                    <span itemprop="name">iOS开发</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/10/16/最近开发中遇到的一些问题/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/10/16/最近开发中遇到的一些问题/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>本文主要记录了我近期在开发中遇到的一些问题以及解决方法。</p>
<h2 id="问题1-TTTAttributedLabel卡顿"><a href="#问题1-TTTAttributedLabel卡顿" class="headerlink" title="问题1: TTTAttributedLabel卡顿"></a>问题1: TTTAttributedLabel卡顿</h2><p><strong>问题描述</strong> 项目中用到了TTTAttributedLabel，用于实现在Label中点击链接跳转，在实际使用过程中，出现了如果Label内容很多，通过UIScrollView滑动Label时非常卡<br>的问题。</p>
<p><strong>解决方案</strong> TTTAttributedLabel中有一个<code>extendsLinkTouchArea</code>属性，指示是否在一个较大的范围内检测链接的Label的Touch事件，默认是YES，设置成NO，表示不检测，<br>这样可以提高TTTAttributedLabel的性能</p>
<h2 id="问题2-dyld-Symbol-not-found-CTRadioAccessTechnologyEdge问题"><a href="#问题2-dyld-Symbol-not-found-CTRadioAccessTechnologyEdge问题" class="headerlink" title="问题2: dyld: Symbol not found: _CTRadioAccessTechnologyEdge问题"></a>问题2: <code>dyld: Symbol not found: _CTRadioAccessTechnologyEdge</code>问题</h2><p><strong>问题描述</strong> 项目中了Reachability用于检测3G/4G/Wifi，之前一直使用正常，最近突然不知什么原因在iOS6上出现了如下图的问题，重新添加CoreTelephone框架也没有用。</p>
<p><img src="http://7xn88v.com1.z0.glb.clouddn.com/Screen%20Shot%202015-10-15%20at%2009.33.53.png" alt="image"></p>
<p><strong>解决方案</strong> 需要将CoreTelephone框架的状态设置为Optional，如下图，这样就不会有上述问题了。</p>
<p><img src="http://7xn88v.com1.z0.glb.clouddn.com/Screen%20Shot%202015-10-16%20at%2022.15.38.png" alt="image"></p>
<p>具体原因我也不是非常清楚，如果有哪位朋友清楚欢迎分享。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/10/07/《图解HTTP》读书笔记(3)/" itemprop="url">
                  《图解HTTP》读书笔记(3)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-10-07T00:00:00+08:00" content="2015-10-07">
              2015-10-07
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/读书笔记/" itemprop="url" rel="index">
                    <span itemprop="name">读书笔记</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/10/07/《图解HTTP》读书笔记(3)/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/10/07/《图解HTTP》读书笔记(3)/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>toc<br>{:toc}</li>
</ul>
<h2 id="第八章-确认访问身份的认证"><a href="#第八章-确认访问身份的认证" class="headerlink" title="第八章 确认访问身份的认证"></a>第八章 确认访问身份的认证</h2><h3 id="何为认证"><a href="#何为认证" class="headerlink" title="何为认证"></a>何为认证</h3><p><strong>认证</strong> 即为了弄清坐在电脑前的用户的真实身份，需要对用户的信息进行核实的过程</p>
<p>常见的几种认证方式：</p>
<ul>
<li>BASIC认证（基本认证）</li>
<li>DIGEST认证（摘要认证）</li>
<li>SSL客户端认证</li>
<li>FormBase认证（基于表单的认证）</li>
</ul>
<h3 id="BASIC认证"><a href="#BASIC认证" class="headerlink" title="BASIC认证"></a>BASIC认证</h3><p>基本步骤</p>
<ol>
<li>请求的资源需要BASIC认证时，服务器返回401，告知客户端需要认证信息</li>
<li>客户端在接收到401后，将用户名和密码组成<code>username:password</code>形式，并进行Base64编码，然后以<code>BASIC &lt;编码后的字符串&gt;</code>形式赋给请求头的<br>Authorization字段，然后再发送给服务器</li>
<li>服务器收到验证信息后，进行验证，如果验证通过，则返回200，并返回相应的资源</li>
</ol>
<p>Base64并非真正的加密，如果具有BASIC认证的请求被窃听，用户名和密钥泄露的几率还是很大的</p>
<h3 id="DIGEST认证"><a href="#DIGEST认证" class="headerlink" title="DIGEST认证"></a>DIGEST认证</h3><p>DIGEST认证使用质询/响应的方式进行认证，但不会像BASIC认证那样明文传输密码。因此DIGEST认证的安全等级要高于BASIC认证。</p>
<h3 id="SSL客户端认证"><a href="#SSL客户端认证" class="headerlink" title="SSL客户端认证"></a>SSL客户端认证</h3><p>SSL客户端认证是借由HTTPS的客户端证书完成认证的方式。</p>
<h3 id="基于表单的认证"><a href="#基于表单的认证" class="headerlink" title="基于表单的认证"></a>基于表单的认证</h3><p>表单认证即我们通常用的在网页上输入密码和账号的认证方式</p>
<p>基本步骤：</p>
<ol>
<li>客户端将用户填写的用户名和密码（会做加密处理）发送给服务器，通常使用POST请求</li>
<li>服务器在接收到用户名和密码后，会去和已经登录在服务器上的用户名和密码做匹配，如果匹配通过，则服务器会在Set-Cookie字段中加入用以<br>识别用户的SessionID</li>
<li>客户端接收到SessionID会将其作为Cookie保存在本地，下次发送请求时会自动带上Cookie字段，这样服务器就能识别用户身份，不用重新登录认证了</li>
</ol>
<h2 id="第九章-基于HTTP的功能追加协议"><a href="#第九章-基于HTTP的功能追加协议" class="headerlink" title="第九章 基于HTTP的功能追加协议"></a>第九章 基于HTTP的功能追加协议</h2><p>随着时代的发展，HTTP协议上的限制和自身性能有限的缺点越来越明显，因此产生许多基于HTTP协议的功能追加协议</p>
<h3 id="消除HTTP瓶颈的SPDY"><a href="#消除HTTP瓶颈的SPDY" class="headerlink" title="消除HTTP瓶颈的SPDY"></a>消除HTTP瓶颈的SPDY</h3><p>Google发布了SPDY，旨在消除HTTP的性能瓶颈。</p>
<p><strong>HTTP协议的瓶颈</strong></p>
<ol>
<li>一条连接上只可以发送一个请求</li>
<li>请求只能从客户端开始，客户端不可以接收除响应以外的任何指令</li>
<li>请求/响应未经压缩就发送，首部信息越多延迟越大</li>
<li>每次互相发送相同的首部造成浪费</li>
<li>可任意选择数据压缩格式，非强制压缩发送</li>
</ol>
<p><strong>解决方式</strong></p>
<ul>
<li>Ajax（异步Javascript与XML技术）的解决方法<ul>
<li>只更新一部分页面，因此传输的数据量大大减少</li>
<li>Ajax仍未解决HTTP协议本身存在的问题</li>
</ul>
</li>
<li>Comet的解决方式<ul>
<li>一旦服务器有内容更新，Comet不会让请求等待，而是直接给客户端返回响应，这是一种延迟应答，模拟实现服务器向客户端推送的功能</li>
<li>客户端发送请求后，不会立即得到响应，相应的请求会在服务器挂起，等到有内容更新时，响应才会返回客户端</li>
<li>服务器为了维持链接会消耗更多资源</li>
</ul>
</li>
<li>SPDY的目标<ul>
<li>从协议层面消除HTTP的瓶颈</li>
</ul>
</li>
</ul>
<h3 id="SPDY的设计与功能"><a href="#SPDY的设计与功能" class="headerlink" title="SPDY的设计与功能"></a>SPDY的设计与功能</h3><p>SPDY没有完全改写HTTP协议，而是在TCP和HTTP之间加入了一个会话层。SPDY的功能</p>
<ul>
<li><strong>多路复用</strong> 单一的TCP链接可以处理多个HTTP请求</li>
<li><strong>赋予请求优先级</strong> 给请求追加优先级，解决因带宽低而导致响应变慢的问题</li>
<li><strong>压缩HTTP首部</strong></li>
<li><strong>推送功能</strong> 支持服务器主动向客户端推送数据的功能</li>
<li><strong>服务器提示功能</strong> 服务器可主动提示客户端请求所需的资源</li>
</ul>
<h3 id="使用浏览器进行双工通信的WebSocket"><a href="#使用浏览器进行双工通信的WebSocket" class="headerlink" title="使用浏览器进行双工通信的WebSocket"></a>使用浏览器进行双工通信的WebSocket</h3><p>一旦建立WebSocket链接，不论是服务器还是客户端，任何一方都可以直接向对方发送报文。</p>
<p>WebSocket的特定：</p>
<ul>
<li>推送功能</li>
<li>减少通信量，WebSocket的首部信息量很少</li>
</ul>
<h3 id="HTTP2-0"><a href="#HTTP2-0" class="headerlink" title="HTTP2.0"></a>HTTP2.0</h3><h2 id="第十章-构建Web内容的技术"><a href="#第十章-构建Web内容的技术" class="headerlink" title="第十章 构建Web内容的技术"></a>第十章 构建Web内容的技术</h2><ul>
<li>HTML</li>
<li>CSS</li>
<li>动态HTML</li>
<li>Web应用</li>
<li>XML</li>
<li>JSON</li>
</ul>
<h2 id="第十一章-Web的攻击技术"><a href="#第十一章-Web的攻击技术" class="headerlink" title="第十一章 Web的攻击技术"></a>第十一章 Web的攻击技术</h2><h3 id="针对Web的攻击技术"><a href="#针对Web的攻击技术" class="headerlink" title="针对Web的攻击技术"></a>针对Web的攻击技术</h3><p>攻击模式</p>
<ul>
<li>主动攻击：SQL注入，OS命令注入</li>
<li>被动攻击：</li>
</ul>
<p>攻击方式</p>
<ul>
<li>跨站脚本攻击</li>
<li>SQL注入攻击</li>
<li>OS命令注入攻击</li>
<li>HTTP首部注入攻击</li>
<li>邮件首部注入攻击</li>
<li>目录遍历攻击</li>
<li>远程文件包含漏洞<br>…</li>
</ul>
<p>-</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/smallhead.png"
               alt="liujinlongxa" />
          <p class="site-author-name" itemprop="name">liujinlongxa</p>
          <p class="site-description motion-element" itemprop="description">生命永不息，Coding永不止</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">31</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">3</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">3</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/liujinlongxa" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/JaylonLiu" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                  Twitter
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/u/1523828165/home" target="_blank" title="微博">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  微博
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.douban.com/people/2470188/" target="_blank" title="豆瓣">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  豆瓣
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">liujinlongxa</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.1"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"liujinlongxa"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
  






  
  
  

  

  

</body>
</html>
