{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"source/.nojekyll","path":".nojekyll","modified":1,"renderable":0},{"_id":"source/Staticfile","path":"Staticfile","modified":1,"renderable":0},{"_id":"source/CNAME","path":"CNAME","modified":1,"renderable":0},{"_id":"source/README.md","path":"README.md","modified":1,"renderable":0},{"_id":"source/images/favicon.ico","path":"images/favicon.ico","modified":1,"renderable":0},{"_id":"source/images/cyclehead.png","path":"images/cyclehead.png","modified":1,"renderable":0},{"_id":"source/images/smallhead.png","path":"images/smallhead.png","modified":1,"renderable":0},{"_id":"themes/next/source/css/main.styl","path":"css/main.styl","modified":1,"renderable":1},{"_id":"themes/next/source/images/avatar.gif","path":"images/avatar.gif","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc-sa.svg","path":"images/cc-by-nc-sa.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc.svg","path":"images/cc-by-nc.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc-nd.svg","path":"images/cc-by-nc-nd.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by.svg","path":"images/cc-by.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by-sa.svg","path":"images/cc-by-sa.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-zero.svg","path":"images/cc-zero.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/loading.gif","path":"images/loading.gif","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by-nd.svg","path":"images/cc-by-nd.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/quote-l.svg","path":"images/quote-l.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/searchicon.png","path":"images/searchicon.png","modified":1,"renderable":1},{"_id":"themes/next/source/images/quote-r.svg","path":"images/quote-r.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/placeholder.gif","path":"images/placeholder.gif","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/bootstrap.js","path":"js/src/bootstrap.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/affix.js","path":"js/src/affix.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/motion.js","path":"js/src/motion.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/hook-duoshuo.js","path":"js/src/hook-duoshuo.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/post-details.js","path":"js/src/post-details.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/scrollspy.js","path":"js/src/scrollspy.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/utils.js","path":"js/src/utils.js","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/fastclick/bower.json","path":"vendors/fastclick/bower.json","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/fastclick/LICENSE","path":"vendors/fastclick/LICENSE","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/fastclick/README.md","path":"vendors/fastclick/README.md","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/font-awesome/HELP-US-OUT.txt","path":"vendors/font-awesome/HELP-US-OUT.txt","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/font-awesome/bower.json","path":"vendors/font-awesome/bower.json","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/jquery_lazyload/CONTRIBUTING.md","path":"vendors/jquery_lazyload/CONTRIBUTING.md","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/jquery_lazyload/bower.json","path":"vendors/jquery_lazyload/bower.json","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/jquery_lazyload/jquery.scrollstop.js","path":"vendors/jquery_lazyload/jquery.scrollstop.js","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/jquery_lazyload/README.md","path":"vendors/jquery_lazyload/README.md","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/jquery_lazyload/jquery.lazyload.js","path":"vendors/jquery_lazyload/jquery.lazyload.js","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/velocity/bower.json","path":"vendors/velocity/bower.json","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/velocity/velocity.ui.min.js","path":"vendors/velocity/velocity.ui.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/velocity/velocity.min.js","path":"vendors/velocity/velocity.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/velocity/velocity.ui.js","path":"vendors/velocity/velocity.ui.js","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/jquery/index.js","path":"vendors/jquery/index.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/schemes/pisces.js","path":"js/src/schemes/pisces.js","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/fancybox/source/fancybox_loading.gif","path":"vendors/fancybox/source/fancybox_loading.gif","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/fancybox/source/blank.gif","path":"vendors/fancybox/source/blank.gif","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/fancybox/source/fancybox_loading@2x.gif","path":"vendors/fancybox/source/fancybox_loading@2x.gif","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/fancybox/source/fancybox_overlay.png","path":"vendors/fancybox/source/fancybox_overlay.png","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/fancybox/source/fancybox_sprite.png","path":"vendors/fancybox/source/fancybox_sprite.png","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/fancybox/source/fancybox_sprite@2x.png","path":"vendors/fancybox/source/fancybox_sprite@2x.png","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/fancybox/source/jquery.fancybox.css","path":"vendors/fancybox/source/jquery.fancybox.css","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/fastclick/lib/fastclick.js","path":"vendors/fastclick/lib/fastclick.js","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/fancybox/source/jquery.fancybox.js","path":"vendors/fancybox/source/jquery.fancybox.js","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/fancybox/source/jquery.fancybox.pack.js","path":"vendors/fancybox/source/jquery.fancybox.pack.js","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/fastclick/lib/fastclick.min.js","path":"vendors/fastclick/lib/fastclick.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/font-awesome/css/font-awesome.css","path":"vendors/font-awesome/css/font-awesome.css","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/font-awesome/css/font-awesome.css.map","path":"vendors/font-awesome/css/font-awesome.css.map","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/font-awesome/css/font-awesome.min.css","path":"vendors/font-awesome/css/font-awesome.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/ua-parser-js/dist/ua-parser.min.js","path":"vendors/ua-parser-js/dist/ua-parser.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/ua-parser-js/dist/ua-parser.pack.js","path":"vendors/ua-parser-js/dist/ua-parser.pack.js","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/font-awesome/fonts/fontawesome-webfont.woff2","path":"vendors/font-awesome/fonts/fontawesome-webfont.woff2","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/font-awesome/fonts/fontawesome-webfont.eot","path":"vendors/font-awesome/fonts/fontawesome-webfont.eot","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/font-awesome/fonts/fontawesome-webfont.woff","path":"vendors/font-awesome/fonts/fontawesome-webfont.woff","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/velocity/velocity.js","path":"vendors/velocity/velocity.js","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/fancybox/source/helpers/fancybox_buttons.png","path":"vendors/fancybox/source/helpers/fancybox_buttons.png","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/fancybox/source/helpers/jquery.fancybox-buttons.js","path":"vendors/fancybox/source/helpers/jquery.fancybox-buttons.js","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/fancybox/source/helpers/jquery.fancybox-thumbs.css","path":"vendors/fancybox/source/helpers/jquery.fancybox-thumbs.css","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/fancybox/source/helpers/jquery.fancybox-thumbs.js","path":"vendors/fancybox/source/helpers/jquery.fancybox-thumbs.js","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/fancybox/source/helpers/jquery.fancybox-media.js","path":"vendors/fancybox/source/helpers/jquery.fancybox-media.js","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/fancybox/source/helpers/jquery.fancybox-buttons.css","path":"vendors/fancybox/source/helpers/jquery.fancybox-buttons.css","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/font-awesome/fonts/FontAwesome.otf","path":"vendors/font-awesome/fonts/FontAwesome.otf","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/font-awesome/fonts/fontawesome-webfont.ttf","path":"vendors/font-awesome/fonts/fontawesome-webfont.ttf","modified":1,"renderable":1},{"_id":"themes/next/source/vendors/font-awesome/fonts/fontawesome-webfont.svg","path":"vendors/font-awesome/fonts/fontawesome-webfont.svg","modified":1,"renderable":1}],"Cache":[{"_id":"source/.nojekyll","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1488350573000},{"_id":"source/Staticfile","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1488350573000},{"_id":"source/CNAME","hash":"d5f11668053a6d6f0df25e75b7c396b4a0c1d06b","modified":1488350573000},{"_id":"source/.DS_Store","hash":"b48c4f7d61a5928be717d4bd654481ff1eab36ee","modified":1488466527000},{"_id":"source/README.md","hash":"6241eb736c81425f44c5ce61555c89e128cee41a","modified":1488350573000},{"_id":"themes/next/.editorconfig","hash":"792fd2bd8174ece1a75d5fd24ab16594886f3a7f","modified":1471109706000},{"_id":"themes/next/.bowerrc","hash":"80e096fdc1cf912ee85dd9f7e6e77fd40cf60f10","modified":1471109706000},{"_id":"themes/next/.DS_Store","hash":"920c6694115559abff4873beda61314bd48fa430","modified":1488385021000},{"_id":"themes/next/.javascript_ignore","hash":"d619ee13031908cd72666e4ff652d2ea3483b1c3","modified":1471109706000},{"_id":"themes/next/.gitignore","hash":"c8d6a73b9e17f0f8a3716e4ada6960d3180425a6","modified":1471109706000},{"_id":"themes/next/README.en.md","hash":"565ba52b3825b85a9f05b41183caca7f18b741d4","modified":1471109706000},{"_id":"themes/next/.hound.yml","hash":"b76daa84c9ca3ad292c78412603370a367cc2bc3","modified":1471109706000},{"_id":"themes/next/.jshintrc","hash":"9928f81bd822f6a8d67fdbc909b517178533bca9","modified":1471109706000},{"_id":"themes/next/README.md","hash":"500b5606eb6a09c979d16128f8b00f4bf9bc95ac","modified":1471109706000},{"_id":"themes/next/bower.json","hash":"f89c6700a11d81e067cc97273ca6bf96cb88c8f9","modified":1471109706000},{"_id":"themes/next/_config.yml","hash":"a42b2ac8f16b979d29a7dceaf0a8446031f159d3","modified":1471109706000},{"_id":"themes/next/gulpfile.coffee","hash":"26e5b1b945704c8bc78b928feede895c4c111c95","modified":1471109706000},{"_id":"themes/next/package.json","hash":"63e9c0f1dd9e5d7f51b4ae383981ef939a2ed45d","modified":1471109706000},{"_id":"source/_posts/.DS_Store","hash":"df2fbeb1400acda0909a32c1cf6bf492f1121e07","modified":1535764126000},{"_id":"source/_posts/2015-10-04-iOS中Emoji表情的判断.md","hash":"85242c35652522430928d435d2f8f8e2534f2371","modified":1488350573000},{"_id":"source/_posts/2015-10-03-博客新家.md","hash":"dbceb588bcc277ac4a32f9bdd86c633935da454c","modified":1488350573000},{"_id":"source/_posts/2015-10-04-NSURLProtocol的使用.md","hash":"52b9797aa57b463f9382f0072e727a11eb8e17a6","modified":1488350573000},{"_id":"source/_posts/2015-10-04-iOS中的多线程编程.md","hash":"2efad2c6ba99a7551e26fb502775b7322eb591b0","modified":1488350573000},{"_id":"source/_posts/2015-10-04-iOS运行时初探-使用运行时机制向Category中添加属性.md","hash":"667978fe3b66c88985648f467eeb6c8c393bb9c0","modified":1488350573000},{"_id":"source/_posts/2015-10-04-iOS中的富文本技术(1)TextKit简介.md","hash":"0b872bbca8797c225474333edc6b246323b895be","modified":1488350573000},{"_id":"source/_posts/2015-10-04-iOS中的富文本技术(2)CoreText框架.md","hash":"ea52268985553d5ab745a771b104b331d5225507","modified":1488350573000},{"_id":"source/_posts/2015-10-04-适配iOS9（ATS问题）.md","hash":"003d9101517e0a8b18a213fdc95a10e97ed458e3","modified":1488350573000},{"_id":"source/_posts/2015-10-04-使用jekyll+GithubPage搭建个人博客系统.md","hash":"26d29e9f0f85098bc9ae415c497a78e68cb80f3a","modified":1547352064456},{"_id":"source/_posts/2015-10-05-《图解HTTP》读书笔记(1).md","hash":"a146ccc639187cc54a1b05fff28b04510ddc5260","modified":1488350573000},{"_id":"source/_posts/2015-10-07-《图解HTTP》读书笔记(3).md","hash":"ac7142582de3187b90b0fafcbfe05e37b42d9172","modified":1488350573000},{"_id":"source/_posts/2015-10-27-UIScrollView与Autolayout.md","hash":"0d4a0956645930cfb6904defc20e3a626c22dea4","modified":1547352064558},{"_id":"source/_posts/2015-10-06-《图解HTTP》读书笔记(2).md","hash":"3786da9e11499253f7503008b21cc07df69846f1","modified":1488350573000},{"_id":"source/_posts/2015-10-16-最近开发中遇到的一些问题.md","hash":"babd64c12749ed2cd04359e2a47f2070b0df51b1","modified":1547352064491},{"_id":"source/_posts/2015-11-07-ContentHugging与ContentCompressionResistance.md","hash":"f4f63bee6d250b57cdf723acb0f4335168fd560f","modified":1547352064582},{"_id":"source/_posts/2015-12-13-CoreAnimation编程指南学习笔记(2).md","hash":"ffe5dadccb35be56afc8eb4f6d4278e4dae630fd","modified":1547352064442},{"_id":"source/_posts/2015-12-06-CoreAnimation编程指南学习笔记(1).md","hash":"c91d96830d316420bef036fa1683a350e0f88b03","modified":1488350573000},{"_id":"source/_posts/2015-12-20-RAC学习笔记.md","hash":"eb1f89c5d63027fa5f81a488b2ce7ca9c32beaa4","modified":1488350573000},{"_id":"source/_posts/2016-01-01-自动打包工具shenzhen使用简介.md","hash":"0a5351c9790a14b37965e1dd554e0e55013eaeec","modified":1488350573000},{"_id":"source/_posts/2015-12-27-《ios核心动画高级技巧》阅读笔记(1).md","hash":"cc780f32feb637c03ee6e10955c0633b43caf08d","modified":1547352064552},{"_id":"source/_posts/2015-12-27-《ios核心动画高级技巧》阅读笔记(3).md","hash":"a9783916e0d5fd1b0d46742f2e755bdfe8309a79","modified":1547352064508},{"_id":"source/_posts/2015-12-27-《ios核心动画高级技巧》阅读笔记(2).md","hash":"87c5c293cb684b44fcd2bc1dfe7d3a71c166a1e4","modified":1547352064524},{"_id":"source/_posts/2016-04-10-iOS开发企业证书申请过程全记录.md","hash":"e8e46bfdbac9b161ef360abad7d1724c1b922204","modified":1547352064581},{"_id":"source/_posts/2016-06-05-2016年6月开发问题记录.md","hash":"e526304ab68e9469075c4aee67f64e3be3096581","modified":1547352064463},{"_id":"source/_posts/2016-05-08-2016年5月开发问题记录.md","hash":"e1b380c52e1c247481688f30562e732cae980a19","modified":1547352064540},{"_id":"source/_posts/2016-05-09-MVVMTutorialwithReactiveCocoaPart2(翻译).md","hash":"74e5399d78af3e9089464e358afc83b047a52564","modified":1488350573000},{"_id":"source/_posts/2016-05-29-自定义NSOperation的那些事.md","hash":"de06841fc6f333fb0b3f5d4b7aef65dbad06ee7f","modified":1488350573000},{"_id":"source/_posts/2016-06-11-打造自己的翻墙VPS:搬运工VPS购买使用流程全记录.md","hash":"1ba8712cedff8698a01db48c12924e13dd243005","modified":1547352064455},{"_id":"source/_posts/2016-07-03-Could-not-load-the-xxx-image-referenced-from-a-nib-in-the-bundle-with-identifier-xxxx问题.md","hash":"7fb7e9089bee23ef7f63abf5dae954d4a45b8e55","modified":1488350573000},{"_id":"source/_posts/2016-07-03-UILabel设置lineBreakMode属性无效.md","hash":"ed7e90d20a6c9fc4814387f57fac5ab456a17245","modified":1488350573000},{"_id":"source/_posts/2016-07-01-从jekyll迁移到hexo.md","hash":"47d90f9c114a1e237ef2027982a30add3a61df83","modified":1547352064474},{"_id":"source/_posts/2016-07-03-用XCode8打开Xib后项目不能在XCode7上运行.md","hash":"120de38767ed7691938be65a16ee80ed4dc1b18a","modified":1488350573000},{"_id":"source/_posts/2016-06-29-GMTC全球移动技术大会见闻.md","hash":"531e412ff0da4bd1e63b8f3f85adc38bf135e584","modified":1547352064445},{"_id":"source/_posts/2016-07-03-设置富文本字间距，文字不能居中对齐.md","hash":"74afb76bd2189686b9a0cd4305215e08a63f86ed","modified":1547352064524},{"_id":"source/_posts/2016-07-26-UIButton设置标题无效.md","hash":"1fcc184d9dcaee9424f3e314be1d2e42ee464d79","modified":1488350573000},{"_id":"source/_posts/2016-07-30-使用HTTPS方法clone下来的Git仓库push时报错.md","hash":"3c2a0cc480beda087fae8ad425d564f5e478d083","modified":1488350573000},{"_id":"source/_posts/2016-08-07-在VPS上搭建Git服务器.md","hash":"b8fbe1f5bd904935e8acbfd52d29fd8155e8de6c","modified":1547352064581},{"_id":"source/_posts/2016-07-10-深入理解CoreAnimation的fillMode和isRemovedOnCompletion.md","hash":"8e9eb9e45f0a9fa60ead5f86ae1fd82ac88640bf","modified":1547352064441},{"_id":"source/_posts/2016-08-25-Mac下生成RSA密钥对要注意的问题.md","hash":"775a0cc348157bd6374b8f93d4c901094e0c7af4","modified":1547352064474},{"_id":"source/_posts/2016-08-30-使用Safair调试JS.md","hash":"cd411ad0c5fa0cd80965261c69e87fbd149ca0fe","modified":1547352064574},{"_id":"source/_posts/2016-08-24-使用ownCloud作为OmniFocus的云同步服务器.md","hash":"d1132295afd0bdeb7ca9b291e8887cc3f56278d5","modified":1547352064540},{"_id":"source/_posts/2016-08-30-做模糊效果时遇到的问题.md","hash":"52ce24f14edcbc3b26c43b059188f8e632d51820","modified":1547352064529},{"_id":"source/_posts/2016-10-07-iOS多环境配置实践.md","hash":"bba60945bf35f491347d6a9f5e03d9a05d107910","modified":1547352064469},{"_id":"source/_posts/2016-09-12-使用代码删除约束要注意的地方.md","hash":"5867e187cd1c0a052636e80c9b738bd891dfc85d","modified":1488350573000},{"_id":"source/_posts/2016-10-04-使用xUnique遇到了的问题.md","hash":"abad5c952a57353ae6eea729f385181f3f263899","modified":1488350573000},{"_id":"source/_posts/2016-10-25-如何获取WebView的UserAgent.md","hash":"b6e94278b111b720271e2fea55ada8f0670defa6","modified":1488350573000},{"_id":"source/_posts/2016-10-26-给多个Target添加CocoaPods.md","hash":"a12863e4907e78507e94832f98e8a12c23c281c1","modified":1488350573000},{"_id":"source/_posts/2016-10-09-获取本地化的APP版本描述信息.md","hash":"49896b01e47687325ab56b8ef175608e33af530a","modified":1488350573000},{"_id":"source/_posts/2016-10-18-iOS10无法获取IDFA的问题.md","hash":"cfc5c76287ac4c11a4a5b166b428b558690c4e79","modified":1547352064507},{"_id":"source/_posts/2016-10-28-Swift3中的预处理宏.md","hash":"52ad7404d968f3e06a22cb5395d3462c7b790d66","modified":1488350573000},{"_id":"source/_posts/2016-11-05-使用nat123实现外网ssh连接内网树莓派设备.md","hash":"4316511e978252a38a960ce10c40cb98b08bb95e","modified":1547352064474},{"_id":"source/_posts/2016-11-15-使用defaults命令获取iOS项目版本号.md","hash":"a1a2d4188774cd1b290dfad3c161e60c7a424388","modified":1488350573000},{"_id":"source/_posts/2016-11-10-Objective-C中如何忽略warning.md","hash":"ba83b42a43d82e6145dc41375cb691cb3a74e05d","modified":1547352064441},{"_id":"source/_posts/2016-11-27-Xcode如何设置在编译前自动运行脚本.md","hash":"7b536d106ba52720608d22ec1ff7e003da707be6","modified":1547352064558},{"_id":"source/_posts/2016-12-20-使用NSURLProtocol注意的一些问题.md","hash":"79d7d4478207394868b9fc35252f6e55dfd3e98a","modified":1488350573000},{"_id":"source/_posts/2017-02-07-iOS开发适配HTTPS总结.md","hash":"50efa987ee19d6b997614976f04f2b737f848321","modified":1547352021974},{"_id":"source/_posts/2017-03-01-深入理解git-merge和git-rebase.md","hash":"aaa73f3dba7251102ab5513a3a6a6ccbb4eaba50","modified":1547352064507},{"_id":"source/_posts/2017-03-06-深入理解git-merge和git-rebase（续）.md","hash":"ec2c35fcf0cd366d2a3f2de074efa77e2f34a346","modified":1547352064455},{"_id":"source/_posts/2017-06-12-通过XCode查看APP的沙盒内容.md","hash":"8ea4fbff418c918665ee3bdb6048e3ecd23eb484","modified":1547352019572},{"_id":"source/_posts/2017-05-27-修改模态界面的转场动画.md","hash":"81dfbb762d6eb0ee376a4b5045cbbb94a063064d","modified":1495851250000},{"_id":"source/_posts/2017-03-27-如何获取分享h5页面时的缩略图.md","hash":"dd41105ca4568f4f649d22cdcd028ab36e916762","modified":1490605444000},{"_id":"source/_posts/2018-09-03-Python学习笔记-2.md","hash":"b29bb4a3a73a6dd3f1473a24ad972c073d55bc53","modified":1535991766000},{"_id":"source/_posts/2018-09-04-Python学习笔记-3.md","hash":"306e6fa85cfa95a99e4655cf4e65e1817ff8c0fe","modified":1538365237000},{"_id":"source/_posts/2018-09-01-Python学习笔记-1.md","hash":"a064a732e019dc11f0dee4ffeed173d566d425ff","modified":1547351637404},{"_id":"source/_posts/2018-09-27-Python学习笔记-5.md","hash":"ef63de176c247dd39882b959b59ab858b9c8ed8e","modified":1538004707000},{"_id":"source/_posts/2018-09-11-Python学习笔记-4.md","hash":"9ed2008193f4e0bc98fd8362d6c1920bb4067010","modified":1547351637405},{"_id":"source/_posts/2018-09-28-Python学习笔记-6.md","hash":"d2819d3e19b0c192c7ffae33d4b7466f7a520c30","modified":1538361912000},{"_id":"source/_posts/2018-09-19-日本五日游.md","hash":"0d8b9ab71805bca394c5a1b3cec7b86cc102cc7a","modified":1547351637404},{"_id":"source/_posts/2019-04-23-【源码解析】Kingfisher.md","hash":"da4fd1b0c7d56491feb8d9a663ed3b60de96666e","modified":1556033625490},{"_id":"source/categories/index.md","hash":"625a9dd629be6760ea4d80df7fd95bc57ee55ee9","modified":1488350573000},{"_id":"source/_posts/2019-01-05-2018年终总结.md","hash":"1b6f18502676050e5c10829a857c41206f56c6c8","modified":1548578582729},{"_id":"source/_posts/2019-01-27-Flask项目部署：Nginx-Gunicorn.md","hash":"0c54552243874d96e8467dbc450561b2b5935767","modified":1548581404339},{"_id":"source/images/favicon.ico","hash":"195dab033350d8bdb617378c719e1184e7d7845a","modified":1488350573000},{"_id":"source/tags/index.md","hash":"7c90e297c92dcc793b9e911f6d75f7977081bdbb","modified":1488350573000},{"_id":"themes/next/.github/CONTRIBUTING.md","hash":"5ab257af816986cd0e53f9527a92d5934ac70ae9","modified":1471109706000},{"_id":"themes/next/.github/ISSUE_TEMPLATE.md","hash":"c2024ded82143807c28a299c5fe6b927ef3525ff","modified":1471109706000},{"_id":"themes/next/languages/de.yml","hash":"786afba25cfc98845a20d9901823ebeebcd1cbbf","modified":1471109706000},{"_id":"themes/next/languages/en.yml","hash":"f03799cbdb5a33064ead080bcac4baca1f6bc5f9","modified":1471109706000},{"_id":"themes/next/languages/fr-FR.yml","hash":"1a084623c39de74301f3e92f9388a3a815a542ca","modified":1471109706000},{"_id":"themes/next/languages/id.yml","hash":"147c01e41b931085ad14250fa900c2249dcbbdd7","modified":1471109706000},{"_id":"themes/next/languages/ja.yml","hash":"a2c7b6301b5474aab798946fb700289df237c3cf","modified":1471109706000},{"_id":"themes/next/languages/default.yml","hash":"9db835c0543ade5a89bc80ec5a898203227cf3d8","modified":1471109706000},{"_id":"themes/next/languages/pt-BR.yml","hash":"462aa865ca3d479bcf6b363cba61247b50f230ff","modified":1471109706000},{"_id":"themes/next/languages/pt.yml","hash":"ca239b39bf65c9462e59d51b12f0fe566d453197","modified":1471109706000},{"_id":"themes/next/languages/ru.yml","hash":"cc7b964a46587aea0e57b0a5269d8fd25570858e","modified":1471109706000},{"_id":"themes/next/languages/zh-Hans.yml","hash":"bea452bc49aed171a210d09bd6cddc4e846ea8ab","modified":1471109706000},{"_id":"themes/next/languages/zh-hk.yml","hash":"519ab3d817ec3bc5bfc91159c494b6b3c170bea7","modified":1471109706000},{"_id":"themes/next/languages/zh-tw.yml","hash":"6b1f345aaefc13e6723dc8a6741b59ac05c20dfd","modified":1471109706000},{"_id":"themes/next/layout/_layout.swig","hash":"74157f6cfd679ea11febec632542793f37c5e5d4","modified":1522305600000},{"_id":"themes/next/layout/archive.swig","hash":"b5b59d70fc1563f482fa07afd435752774ad5981","modified":1471109706000},{"_id":"themes/next/layout/category.swig","hash":"6422d196ceaff4220d54b8af770e7e957f3364ad","modified":1471109706000},{"_id":"themes/next/layout/index.swig","hash":"427d0b95b854e311ae363088ab39a393bf8fdc8b","modified":1471109706000},{"_id":"themes/next/scripts/merge-configs.js","hash":"0c56be2e85c694247cfa327ea6d627b99ca265e8","modified":1471109706000},{"_id":"themes/next/layout/page.swig","hash":"8019d02232a6dd1a665b6a4d2daef8e5dd2f0049","modified":1471109706000},{"_id":"themes/next/layout/post.swig","hash":"e2e512142961ddfe77eba29eaa88f4a2ee43ae18","modified":1471109706000},{"_id":"themes/next/layout/tag.swig","hash":"07cf49c49c39a14dfbe9ce8e7d7eea3d4d0a4911","modified":1471109706000},{"_id":"themes/next/test/.jshintrc","hash":"19f93d13d1689fe033c82eb2d5f3ce30b6543cc0","modified":1471109706000},{"_id":"themes/next/test/helpers.js","hash":"a1f5de25154c3724ffc24a91ddc576cdbd60864f","modified":1471109706000},{"_id":"themes/next/test/intern.js","hash":"11fa8a4f5c3b4119a179ae0a2584c8187f907a73","modified":1471109706000},{"_id":"source/images/cyclehead.png","hash":"1fa870e293d9b5e32cc4f7451f2c62fabdf1f9c9","modified":1488350573000},{"_id":"source/images/smallhead.png","hash":"0687a3fb4b724385888d78d8af89e4daa28ca5cc","modified":1488350573000},{"_id":"themes/next/source/fonts/.gitkeep","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1471109706000},{"_id":"themes/next/layout/_macro/post-collapse.swig","hash":"43c3433155ccd9abcbe7dce2e6bfa1f3a66af18b","modified":1471109706000},{"_id":"themes/next/layout/_macro/post.swig","hash":"1ca03011bed92614832b1343b65be92183957dc5","modified":1471109706000},{"_id":"themes/next/layout/_partials/comments.swig","hash":"b73f9443bee2d3ea383aad52e49ffca8aa97dcc2","modified":1471109706000},{"_id":"themes/next/layout/_macro/reward.swig","hash":"37e5b7c42ec17b9b6b786c5512bcc481a21c974e","modified":1471109706000},{"_id":"themes/next/layout/_macro/wechat-subscriber.swig","hash":"14e785adeb0e671ba0ff9a553e6f0d8def6c670c","modified":1471109706000},{"_id":"themes/next/layout/_macro/sidebar.swig","hash":"1a77843ce5eac62151dc3d38f0a36c43e19e1a74","modified":1471109706000},{"_id":"themes/next/layout/_partials/head.swig","hash":"6b0c495b8154ef8b2d2cb0a554e164ff22cdc962","modified":1471109706000},{"_id":"themes/next/layout/_partials/footer.swig","hash":"f436d19325e043c3cce9245199fb73b4f6767ded","modified":1522306874000},{"_id":"themes/next/layout/_partials/duoshuo-hot-articles.swig","hash":"5d4638c46aef65bf32a01681495b62416ccc98db","modified":1471109706000},{"_id":"themes/next/layout/_partials/header.swig","hash":"eb028685cb3c329537bbced06c063d23e6a33817","modified":1471109706000},{"_id":"themes/next/layout/_partials/pagination.swig","hash":"9e8e21d194ef44d271b1cca0bc1448c14d7edf4f","modified":1471109706000},{"_id":"themes/next/layout/_partials/search.swig","hash":"011b9d6c9f0a2f4654908ea20b9391f9b7981271","modified":1471109706000},{"_id":"themes/next/layout/_scripts/baidu-push.swig","hash":"82d060fe055d6e423bbc9199f82dfe5c68e74779","modified":1471109706000},{"_id":"themes/next/layout/_scripts/boostrap.swig","hash":"03aaebe9d50f6acb007ec38cc04acd1cfceb404d","modified":1471109706000},{"_id":"themes/next/layout/_scripts/commons.swig","hash":"766b2bdda29523ed6cd8d7aa197f996022f8fd94","modified":1471109706000},{"_id":"themes/next/layout/_scripts/vendors.swig","hash":"0b91cadecead8e0b5211cc42b085998d94af503a","modified":1471109706000},{"_id":"themes/next/scripts/tags/center-quote.js","hash":"535fc542781021c4326dec24d8495cbb1387634a","modified":1471109706000},{"_id":"themes/next/scripts/tags/full-image.js","hash":"3acce36db0feb11a982c6c799aa6b6b47df2827c","modified":1471109706000},{"_id":"themes/next/scripts/tags/group-pictures.js","hash":"49252824cd53184dc9b97b2f2d87ff28e1b3ef27","modified":1471109706000},{"_id":"themes/next/source/css/main.styl","hash":"20702c48d6053c92c5bcdbc68e8d0ef1369848a0","modified":1471109706000},{"_id":"themes/next/source/images/avatar.gif","hash":"264082bb3a1af70d5499c7d22b0902cb454b6d12","modified":1471109706000},{"_id":"themes/next/source/images/cc-by-nc-sa.svg","hash":"3031be41e8753c70508aa88e84ed8f4f653f157e","modified":1471109706000},{"_id":"themes/next/source/images/cc-by-nc.svg","hash":"8d39b39d88f8501c0d27f8df9aae47136ebc59b7","modified":1471109706000},{"_id":"themes/next/source/images/cc-by-nc-nd.svg","hash":"c6524ece3f8039a5f612feaf865d21ec8a794564","modified":1471109706000},{"_id":"themes/next/source/images/cc-by.svg","hash":"28a0a4fe355a974a5e42f68031652b76798d4f7e","modified":1471109706000},{"_id":"themes/next/source/images/cc-by-sa.svg","hash":"aa4742d733c8af8d38d4c183b8adbdcab045872e","modified":1471109706000},{"_id":"themes/next/source/images/cc-zero.svg","hash":"87669bf8ac268a91d027a0a4802c92a1473e9030","modified":1471109706000},{"_id":"themes/next/source/images/loading.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1471109706000},{"_id":"themes/next/source/images/cc-by-nd.svg","hash":"c563508ce9ced1e66948024ba1153400ac0e0621","modified":1471109706000},{"_id":"themes/next/source/images/quote-l.svg","hash":"94e870b4c8c48da61d09522196d4dd40e277a98f","modified":1471109706000},{"_id":"themes/next/source/images/searchicon.png","hash":"67727a6a969be0b2659b908518fa6706eed307b8","modified":1471109706000},{"_id":"themes/next/source/images/quote-r.svg","hash":"e60ae504f9d99b712c793c3740c6b100d057d4ec","modified":1471109706000},{"_id":"themes/next/source/images/placeholder.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1471109706000},{"_id":"themes/next/layout/_scripts/schemes/mist.swig","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1471109706000},{"_id":"themes/next/layout/_scripts/schemes/muse.swig","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1471109706000},{"_id":"themes/next/source/css/_mixins/Mist.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1471109706000},{"_id":"themes/next/source/css/_mixins/Muse.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1471109706000},{"_id":"themes/next/source/css/_mixins/custom.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1471109706000},{"_id":"themes/next/source/css/_variables/Muse.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1471109706000},{"_id":"themes/next/source/css/_variables/custom.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1471109706000},{"_id":"themes/next/layout/_partials/head/external-fonts.swig","hash":"7ce76358411184482bb0934e70037949dd0da8ca","modified":1471109706000},{"_id":"themes/next/layout/_partials/search/swiftype.swig","hash":"959b7e04a96a5596056e4009b73b6489c117597e","modified":1471109706000},{"_id":"themes/next/layout/_partials/search/tinysou.swig","hash":"eefe2388ff3d424694045eda21346989b123977c","modified":1471109706000},{"_id":"themes/next/layout/_partials/share/add-this.swig","hash":"c07f7b2f264e5215b8ed42d67e8cef2477558364","modified":1471109706000},{"_id":"themes/next/layout/_partials/search/localsearch.swig","hash":"ff5523d5dacaa77a55a24e50e6e6530c3b98bfad","modified":1471109706000},{"_id":"themes/next/layout/_partials/share/duoshuo_share.swig","hash":"89c5a5240ecb223acfe1d12377df5562a943fd5d","modified":1471109706000},{"_id":"themes/next/layout/_partials/share/baidushare.swig","hash":"7ca5cb4daa58b3504e17f3e02975e794bc634658","modified":1471109706000},{"_id":"themes/next/layout/_partials/share/jiathis.swig","hash":"63315fcf210799f894208c9f512737096df84962","modified":1471109706000},{"_id":"themes/next/layout/_scripts/schemes/pisces.swig","hash":"a44acf9b0d0f44ef3dfc767376a95c984cc127de","modified":1471109706000},{"_id":"themes/next/layout/_scripts/pages/post-details.swig","hash":"069d1357c717572256e5cdee09574ebce529cbae","modified":1471109706000},{"_id":"themes/next/layout/_scripts/third-party/analytics.swig","hash":"0a89c04055bade7baa5962f1d5aefe438d83a244","modified":1471109706000},{"_id":"themes/next/layout/_scripts/third-party/comments.swig","hash":"907b931d775d32405d02a25b3b0a3ac03bf804d0","modified":1471109706000},{"_id":"themes/next/layout/_scripts/third-party/lean-analytics.swig","hash":"92dc60821307fc9769bea9b2d60adaeb798342af","modified":1471109706000},{"_id":"themes/next/layout/_scripts/third-party/mathjax.swig","hash":"5bafc33f57508d1d04a9930165240f6e9efa8d6d","modified":1471109706000},{"_id":"themes/next/layout/_scripts/third-party/localsearch.swig","hash":"7f7148c8f52e4d3cfc070d964160362179fa8e91","modified":1471109706000},{"_id":"themes/next/layout/_scripts/third-party/tinysou.swig","hash":"cb3a5d36dbe1630bab84e03a52733a46df7c219b","modified":1471109706000},{"_id":"themes/next/source/css/_mixins/base.styl","hash":"78a83c38f69a8747bb74e420e6c9eeef1ea76525","modified":1471109706000},{"_id":"themes/next/source/css/_mixins/Pisces.styl","hash":"715d5b40dc52f319fe4bff0325beb874774d9bd9","modified":1471109706000},{"_id":"themes/next/source/css/_custom/custom.styl","hash":"328d9a9696cc2ccf59c67d3c26000d569f46344c","modified":1471109706000},{"_id":"themes/next/source/css/_variables/Pisces.styl","hash":"3ead77befa064d6327dc7afd0a5af7be59a5f196","modified":1471109706000},{"_id":"themes/next/source/css/_variables/Mist.styl","hash":"c8d35a6b9e3bff6d8fdb66de853065af9d37562d","modified":1471109706000},{"_id":"themes/next/source/css/_variables/base.styl","hash":"17624186f7a1f28daddea258d044f8e03b2f4bea","modified":1471109706000},{"_id":"themes/next/source/js/src/bootstrap.js","hash":"39bf93769d9080fa01a9a875183b43198f79bc19","modified":1471109706000},{"_id":"themes/next/source/js/src/affix.js","hash":"978e0422b5bf1b560236d8d10ebc1adcf66392e3","modified":1471109706000},{"_id":"themes/next/source/js/src/motion.js","hash":"269414e84df544a4ccb88519f6abae4943db3c67","modified":1471109706000},{"_id":"themes/next/source/js/src/hook-duoshuo.js","hash":"a6119070c0119f33e08b29da7d2cce2635eb40a0","modified":1471109706000},{"_id":"themes/next/source/js/src/post-details.js","hash":"2038f54e289b6da5def09689e69f623187147be5","modified":1471109706000},{"_id":"themes/next/source/js/src/scrollspy.js","hash":"fe4da1b9fe73518226446f5f27d2831e4426fc35","modified":1471109706000},{"_id":"themes/next/source/js/src/utils.js","hash":"e5cb720894c4bc28ca8f10b33df127fb394018d9","modified":1471109706000},{"_id":"themes/next/source/vendors/fancybox/.gitattributes","hash":"2db21acfbd457452462f71cc4048a943ee61b8e0","modified":1471109706000},{"_id":"themes/next/source/vendors/fancybox/.bower.json","hash":"cc40a9b11e52348e554c84e4a5c058056f6b7aeb","modified":1471109706000},{"_id":"themes/next/source/vendors/fastclick/bower.json","hash":"13379463c7463b4b96d13556b46faa4cc38d81e6","modified":1471109706000},{"_id":"themes/next/source/vendors/fastclick/.bower.json","hash":"93ebd5b35e632f714dcf1753e1f6db77ec74449b","modified":1471109706000},{"_id":"themes/next/source/vendors/fastclick/LICENSE","hash":"dcd5b6b43095d9e90353a28b09cb269de8d4838e","modified":1471109706000},{"_id":"themes/next/source/vendors/fastclick/README.md","hash":"1decd8e1adad2cd6db0ab50cf56de6035156f4ea","modified":1471109706000},{"_id":"themes/next/source/vendors/font-awesome/.bower.json","hash":"7da985a99674e54f514d4fd9fcd3bcea6e7e41d5","modified":1471109706000},{"_id":"themes/next/source/vendors/font-awesome/.gitignore","hash":"69d152fa46b517141ec3b1114dd6134724494d83","modified":1471109706000},{"_id":"themes/next/source/vendors/font-awesome/.npmignore","hash":"dcf470ab3a358103bb896a539cc03caeda10fa8b","modified":1471109706000},{"_id":"themes/next/source/vendors/font-awesome/HELP-US-OUT.txt","hash":"69a4c537d167b68a0ccf1c6febd138aeffca60d6","modified":1471109706000},{"_id":"themes/next/source/vendors/font-awesome/bower.json","hash":"279a8a718ab6c930a67c41237f0aac166c1b9440","modified":1471109706000},{"_id":"themes/next/source/vendors/jquery/.bower.json","hash":"91745c2cc6c946c7275f952b2b0760b880cea69e","modified":1471109706000},{"_id":"themes/next/source/vendors/jquery_lazyload/.bower.json","hash":"b7638afc93e9cd350d0783565ee9a7da6805ad8e","modified":1471109706000},{"_id":"themes/next/source/vendors/jquery_lazyload/CONTRIBUTING.md","hash":"4891864c24c28efecd81a6a8d3f261145190f901","modified":1471109706000},{"_id":"themes/next/source/vendors/jquery_lazyload/bower.json","hash":"65bc85d12197e71c40a55c0cd7f6823995a05222","modified":1471109706000},{"_id":"themes/next/source/vendors/jquery_lazyload/jquery.scrollstop.js","hash":"0e9a81785a011c98be5ea821a8ed7d411818cfd1","modified":1471109706000},{"_id":"themes/next/source/vendors/jquery_lazyload/README.md","hash":"895d50fa29759af7835256522e9dd7dac597765c","modified":1471109706000},{"_id":"themes/next/source/vendors/jquery_lazyload/jquery.lazyload.js","hash":"481fd478650e12b67c201a0ea41e92743f8b45a3","modified":1471109706000},{"_id":"themes/next/source/vendors/velocity/.bower.json","hash":"05f960846f1c7a93dab1d3f9a1121e86812e8c88","modified":1471109706000},{"_id":"themes/next/source/vendors/velocity/bower.json","hash":"2ec99573e84c7117368beccb9e94b6bf35d2db03","modified":1471109706000},{"_id":"themes/next/source/vendors/velocity/velocity.ui.min.js","hash":"ed5e534cd680a25d8d14429af824f38a2c7d9908","modified":1471109706000},{"_id":"themes/next/source/vendors/velocity/velocity.min.js","hash":"2f1afadc12e4cf59ef3b405308d21baa97e739c6","modified":1471109706000},{"_id":"themes/next/source/vendors/velocity/velocity.ui.js","hash":"6a1d101eab3de87527bb54fcc8c7b36b79d8f0df","modified":1471109706000},{"_id":"themes/next/source/vendors/jquery/index.js","hash":"41b4bfbaa96be6d1440db6e78004ade1c134e276","modified":1471109706000},{"_id":"themes/next/layout/_scripts/third-party/analytics/facebook-sdk.swig","hash":"394d008e5e94575280407ad8a1607a028026cbc3","modified":1471109706000},{"_id":"themes/next/layout/_scripts/third-party/analytics/baidu-analytics.swig","hash":"7c43d66da93cde65b473a7d6db2a86f9a42647d6","modified":1471109706000},{"_id":"themes/next/layout/_scripts/third-party/analytics/cnzz-analytics.swig","hash":"f9c6ee91c2a615edd8ca26edcc8a66b71883c238","modified":1471109706000},{"_id":"themes/next/layout/_scripts/third-party/analytics/busuanzi-counter.swig","hash":"4fcbf57c4918528ab51d3d042cff92cf5aefb599","modified":1471109706000},{"_id":"themes/next/layout/_scripts/third-party/comments/disqus.swig","hash":"bff3b18f56175c53f3bc6d733166c4d998e08732","modified":1471109706000},{"_id":"themes/next/layout/_scripts/third-party/analytics/google-analytics.swig","hash":"30a23fa7e816496fdec0e932aa42e2d13098a9c2","modified":1471109706000},{"_id":"themes/next/layout/_scripts/third-party/comments/duoshuo.swig","hash":"696666141cdd204fd8818ac2ad18f05e320f8587","modified":1471109706000},{"_id":"themes/next/layout/_scripts/third-party/analytics/tencent-analytics.swig","hash":"3658414379e0e8a34c45c40feadc3edc8dc55f88","modified":1471109706000},{"_id":"themes/next/source/css/_common/components/buttons.styl","hash":"0dfb4b3ba3180d7285e66f270e1d3fa0f132c3d2","modified":1471109706000},{"_id":"themes/next/source/css/_common/components/components.styl","hash":"10994990d6e0b4d965a728a22cf7f6ee29cae9f6","modified":1471109706000},{"_id":"themes/next/source/css/_common/components/comments.styl","hash":"471f1627891aca5c0e1973e09fbcb01e1510d193","modified":1471109706000},{"_id":"themes/next/source/css/_common/components/back-to-top.styl","hash":"b49efc66bd055a2d0be7deabfcb02ee72a9a28c8","modified":1471109706000},{"_id":"themes/next/source/css/_common/components/pagination.styl","hash":"711c8830886619d4f4a0598b0cde5499dce50c62","modified":1471109706000},{"_id":"themes/next/source/css/_common/components/tag-cloud.styl","hash":"dd8a3b22fc2f222ac6e6c05bd8a773fb039169c0","modified":1471109706000},{"_id":"themes/next/source/css/_common/outline/outline.styl","hash":"2186be20e317505cd31886f1291429cc21f76703","modified":1471109706000},{"_id":"themes/next/source/css/_common/scaffolding/helpers.styl","hash":"54c90cf7bdbf5c596179d8dae6e671bad1292662","modified":1471109706000},{"_id":"themes/next/source/css/_common/scaffolding/base.styl","hash":"5304f99581da3a31de3ecec959b7adf9002fde83","modified":1471109706000},{"_id":"themes/next/source/css/_common/scaffolding/tables.styl","hash":"64f5d56c08d74a338813df1265580ca0cbf0190b","modified":1471109706000},{"_id":"themes/next/source/css/_schemes/Mist/_base.styl","hash":"c2d079788d6fc2e9a191ccdae94e50d55bf849dc","modified":1471109706000},{"_id":"themes/next/source/css/_common/scaffolding/scaffolding.styl","hash":"013619c472c7e4b08311c464fcbe9fcf5edde603","modified":1471109706000},{"_id":"themes/next/source/css/_common/scaffolding/normalize.styl","hash":"ece571f38180febaf02ace8187ead8318a300ea7","modified":1471109706000},{"_id":"themes/next/source/css/_schemes/Mist/_logo.styl","hash":"38e5df90c8689a71c978fd83ba74af3d4e4e5386","modified":1471109706000},{"_id":"themes/next/source/css/_schemes/Mist/_header.styl","hash":"5ae7906dc7c1d9468c7f4b4a6feddddc555797a1","modified":1471109706000},{"_id":"themes/next/source/css/_schemes/Mist/_menu.styl","hash":"b0dcca862cd0cc6e732e33d975b476d744911742","modified":1471109706000},{"_id":"themes/next/source/css/_schemes/Mist/_posts-expanded.styl","hash":"4303776991ef28f5742ca51c7dffe6f12f0acf34","modified":1471109706000},{"_id":"themes/next/source/css/_schemes/Mist/_search.styl","hash":"1452cbe674cc1d008e1e9640eb4283841058fc64","modified":1471109706000},{"_id":"themes/next/source/css/_schemes/Muse/_menu.styl","hash":"c2c6c4f6434b4f94aac2af5861cd769427f0ee10","modified":1471109706000},{"_id":"themes/next/source/css/_schemes/Mist/index.styl","hash":"9a5581a770af8964064fef7afd3e16963e45547f","modified":1471109706000},{"_id":"themes/next/source/css/_schemes/Muse/_layout.styl","hash":"6ed60cc621bac096c0ed7534fa25b1a52dc571d4","modified":1471109706000},{"_id":"themes/next/source/css/_schemes/Muse/_logo.styl","hash":"8829bc556ca38bfec4add4f15a2f028092ac6d46","modified":1471109706000},{"_id":"themes/next/source/css/_schemes/Pisces/_brand.styl","hash":"be22ad34f546a07f6d56b424338cdd898683eea4","modified":1471109706000},{"_id":"themes/next/source/css/_schemes/Muse/_search.styl","hash":"1452cbe674cc1d008e1e9640eb4283841058fc64","modified":1471109706000},{"_id":"themes/next/source/css/_schemes/Muse/index.styl","hash":"a0e2030a606c934fb2c5c7373aaae04a1caac4c5","modified":1471109706000},{"_id":"themes/next/source/css/_schemes/Pisces/_full-image.styl","hash":"938d39eedc6e3d33918c1145a5bf1e79991d3fcf","modified":1471109706000},{"_id":"themes/next/source/css/_schemes/Pisces/_posts.styl","hash":"2f878213cb24c5ddc18877f6d15ec5c5f57745ac","modified":1471109706000},{"_id":"themes/next/source/css/_schemes/Pisces/_menu.styl","hash":"d09280e5b79f3b573edb30f30c7a5f03ac640986","modified":1471109706000},{"_id":"themes/next/source/css/_schemes/Pisces/_sidebar.styl","hash":"d4b7bd610ca03dbb2f5b66631c0e84a79fb4660b","modified":1471109706000},{"_id":"themes/next/source/css/_schemes/Pisces/_layout.styl","hash":"8d7cecde4933900c7df2db9d0a98f5f82f88dc93","modified":1471109706000},{"_id":"themes/next/source/css/_schemes/Pisces/index.styl","hash":"1b10ba2d3ad0c063c418dc94a0b7e0db4b342c53","modified":1471109706000},{"_id":"themes/next/source/js/src/schemes/pisces.js","hash":"7506e7490c69a200831393c38d25e91c156bd471","modified":1471109706000},{"_id":"themes/next/source/vendors/fancybox/source/fancybox_loading.gif","hash":"1a755fb2599f3a313cc6cfdb14df043f8c14a99c","modified":1471109706000},{"_id":"themes/next/source/vendors/fancybox/source/blank.gif","hash":"2daeaa8b5f19f0bc209d976c02bd6acb51b00b0a","modified":1471109706000},{"_id":"themes/next/source/vendors/fancybox/source/fancybox_loading@2x.gif","hash":"273b123496a42ba45c3416adb027cd99745058b0","modified":1471109706000},{"_id":"themes/next/source/vendors/fancybox/source/fancybox_overlay.png","hash":"b3a4ee645ba494f52840ef8412015ba0f465dbe0","modified":1471109706000},{"_id":"themes/next/source/vendors/fancybox/source/fancybox_sprite.png","hash":"17df19f97628e77be09c352bf27425faea248251","modified":1471109706000},{"_id":"themes/next/source/vendors/fancybox/source/fancybox_sprite@2x.png","hash":"30c58913f327e28f466a00f4c1ac8001b560aed8","modified":1471109706000},{"_id":"themes/next/source/vendors/fancybox/source/jquery.fancybox.css","hash":"5f163444617b6cf267342f06ac166a237bb62df9","modified":1471109706000},{"_id":"themes/next/source/vendors/fastclick/lib/fastclick.js","hash":"06cef196733a710e77ad7e386ced6963f092dc55","modified":1471109706000},{"_id":"themes/next/source/vendors/fancybox/source/jquery.fancybox.js","hash":"1cf3d47b5ccb7cb6e9019c64f2a88d03a64853e4","modified":1471109706000},{"_id":"themes/next/source/vendors/fancybox/source/jquery.fancybox.pack.js","hash":"53360764b429c212f424399384417ccc233bb3be","modified":1471109706000},{"_id":"themes/next/source/vendors/fastclick/lib/fastclick.min.js","hash":"2cae0f5a6c5d6f3cb993015e6863f9483fc4de18","modified":1471109706000},{"_id":"themes/next/source/vendors/font-awesome/css/font-awesome.css","hash":"3b87c2560832748cd06f9bfd2fd6ea8edbdae8c7","modified":1471109706000},{"_id":"themes/next/source/vendors/font-awesome/css/font-awesome.css.map","hash":"0189d278706509412bac4745f96c83984e1d59f4","modified":1471109706000},{"_id":"themes/next/source/vendors/font-awesome/css/font-awesome.min.css","hash":"05ea25bc9b3ac48993e1fee322d3bc94b49a6e22","modified":1471109706000},{"_id":"themes/next/source/vendors/ua-parser-js/dist/ua-parser.min.js","hash":"38628e75e4412cc6f11074e03e1c6d257aae495b","modified":1471109706000},{"_id":"themes/next/source/vendors/ua-parser-js/dist/ua-parser.pack.js","hash":"214dad442a92d36af77ed0ca1d9092b16687f02f","modified":1471109706000},{"_id":"themes/next/source/vendors/font-awesome/fonts/fontawesome-webfont.woff2","hash":"574ea2698c03ae9477db2ea3baf460ee32f1a7ea","modified":1471109706000},{"_id":"themes/next/source/vendors/font-awesome/fonts/fontawesome-webfont.eot","hash":"b3c2f08e73320135b69c23a3908b87a12053a2f6","modified":1471109706000},{"_id":"themes/next/source/vendors/font-awesome/fonts/fontawesome-webfont.woff","hash":"507970402e328b2baeb05bde73bf9ded4e2c3a2d","modified":1471109706000},{"_id":"themes/next/source/vendors/velocity/velocity.js","hash":"e63dc7cea055ca60a95d286f32349d88b10c5a4d","modified":1471109706000},{"_id":"themes/next/source/css/_common/components/header/headerband.styl","hash":"d27448f199fc2f9980b601bc22b87f08b5d64dd1","modified":1471109706000},{"_id":"themes/next/source/css/_common/components/header/site-meta.styl","hash":"6c00f6e0978f4d8f9a846a15579963728aaa6a17","modified":1471109706000},{"_id":"themes/next/source/css/_common/components/header/menu.styl","hash":"c890ce7fe933abad7baf39764a01894924854e92","modified":1471109706000},{"_id":"themes/next/source/css/_common/components/footer/footer.styl","hash":"8994ffcce84deac0471532f270f97c44fea54dc0","modified":1471109706000},{"_id":"themes/next/source/css/_common/components/header/site-nav.styl","hash":"49c2b2c14a1e7fcc810c6be4b632975d0204c281","modified":1471109706000},{"_id":"themes/next/source/css/_common/components/highlight/theme.styl","hash":"90f8f9706cd7fe829cf06e9959a65fd3f8b994fa","modified":1471109706000},{"_id":"themes/next/source/css/_common/components/highlight/highlight.styl","hash":"4da051c7f3924fa2db1e73c55b2baf1c2c150255","modified":1471109706000},{"_id":"themes/next/source/css/_common/components/header/header.styl","hash":"ae1ca14e51de67b07dba8f61ec79ee0e2e344574","modified":1471109706000},{"_id":"themes/next/source/css/_common/components/pages/post-detail.styl","hash":"9bf4362a4d0ae151ada84b219d39fbe5bb8c790e","modified":1471109706000},{"_id":"themes/next/source/css/_common/components/pages/categories.styl","hash":"4eff5b252d7b614e500fc7d52c97ce325e57d3ab","modified":1471109706000},{"_id":"themes/next/source/css/_common/components/pages/pages.styl","hash":"3c46efd6601e268093ce6d7b1471d18501878f0d","modified":1471109706000},{"_id":"themes/next/source/css/_common/components/pages/archive.styl","hash":"7778920dd105fa4de3a7ab206eeba30b1a7bac45","modified":1471109706000},{"_id":"themes/next/source/css/_common/components/post/post-expand.styl","hash":"b25132fe6a7ad67059a2c3afc60feabb479bdd75","modified":1471109706000},{"_id":"themes/next/source/css/_common/components/post/post-eof.styl","hash":"2cdc094ecf907a02fce25ad4a607cd5c40da0f2b","modified":1471109706000},{"_id":"themes/next/source/css/_common/components/post/post-collapse.styl","hash":"8fae54591877a73dff0b29b2be2e8935e3c63575","modified":1471109706000},{"_id":"themes/next/source/css/_common/components/post/post-meta.styl","hash":"d543d1377c1f61b70e3adb6da0eb12797552e5f2","modified":1471109706000},{"_id":"themes/next/source/css/_common/components/post/post-gallery.styl","hash":"387ce23bba52b22a586b2dfb4ec618fe1ffd3926","modified":1471109706000},{"_id":"themes/next/source/css/_common/components/post/post-tags.styl","hash":"a352ae5b1f8857393bf770d2e638bf15f0c9585d","modified":1471109706000},{"_id":"themes/next/source/css/_common/components/post/post-more-link.styl","hash":"15063d79b5befc21820baf05d6f20cc1c1787477","modified":1471109706000},{"_id":"themes/next/source/css/_common/components/post/post-nav.styl","hash":"cbca4842a54950e2934b3b8f3cd940f122111aef","modified":1471109706000},{"_id":"themes/next/source/css/_common/components/post/post-reward.styl","hash":"e792c8dc41561c96d128e9b421187f1c3dc978a0","modified":1471109706000},{"_id":"themes/next/source/css/_common/components/post/post-title.styl","hash":"963105a531403d7aad6d9e5e23e3bfabb8ec065a","modified":1471109706000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-author-links.styl","hash":"2e7ec9aaa3293941106b1bdd09055246aa3c3dc6","modified":1471109706000},{"_id":"themes/next/source/css/_common/components/post/post-type.styl","hash":"10251257aceecb117233c9554dcf8ecfef8e2104","modified":1471109706000},{"_id":"themes/next/source/css/_common/components/post/post.styl","hash":"4eb18b12fa0ea6c35925d9a64f64e2a7dae8c7fd","modified":1471109706000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-author.styl","hash":"920343e41c124221a17f050bbb989494d44f7a24","modified":1471109706000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-feed-link.styl","hash":"9486ddd2cb255227db102d09a7df4cae0fabad72","modified":1471109706000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-blogroll.styl","hash":"c44f6a553ec7ea5508f2054a13be33a62a15d3a9","modified":1471109706000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-nav.styl","hash":"45fa7193435a8eae9960267438750b4c9fa9587f","modified":1471109706000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-toc.styl","hash":"7690b9596ec3a49befbe529a5a2649abec0faf76","modified":1471109706000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-toggle.styl","hash":"2d3abbc85b979a648e0e579e45f16a6eba49d1e7","modified":1471109706000},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar.styl","hash":"234facd038f144bd0fe09a31ed1357c5d74c517f","modified":1471109706000},{"_id":"themes/next/source/css/_common/components/tags/group-pictures.styl","hash":"4851b981020c5cbc354a1af9b831a2dcb3cf9d39","modified":1471109706000},{"_id":"themes/next/source/css/_common/components/sidebar/site-state.styl","hash":"3623e7fa4324ec1307370f33d8f287a9e20a5578","modified":1471109706000},{"_id":"themes/next/source/css/_common/components/tags/full-image.styl","hash":"618f73450cf541f88a4fddc3d22898aee49d105d","modified":1471109706000},{"_id":"themes/next/source/css/_common/components/tags/blockquote-center.styl","hash":"c2abe4d87148e23e15d49ee225bc650de60baf46","modified":1471109706000},{"_id":"themes/next/source/css/_common/components/tags/tags.styl","hash":"8e66c2635d48e11de616bb29c4b1323698eebc0a","modified":1471109706000},{"_id":"themes/next/source/css/_common/components/third-party/baidushare.styl","hash":"93b08815c4d17e2b96fef8530ec1f1064dede6ef","modified":1471109706000},{"_id":"themes/next/source/css/_common/components/third-party/busuanzi-counter.styl","hash":"b03f891883446f3a5548b7cc90d29c77e62f1053","modified":1471109706000},{"_id":"themes/next/source/css/_common/components/third-party/duoshuo.styl","hash":"2340dd9b3202c61d73cc708b790fac5adddbfc7f","modified":1471109706000},{"_id":"themes/next/source/css/_common/components/third-party/jiathis.styl","hash":"327b5f63d55ec26f7663185c1a778440588d9803","modified":1471109706000},{"_id":"themes/next/source/css/_common/components/third-party/third-party.styl","hash":"3afc459442c132c480d1d832f1a872f1070bb048","modified":1471109706000},{"_id":"themes/next/source/css/_common/components/third-party/localsearch.styl","hash":"795d94561888d31cb7a6ff4a125596809ea69b7d","modified":1471109706000},{"_id":"themes/next/source/css/_schemes/Mist/outline/outline.styl","hash":"5dc4859c66305f871e56cba78f64bfe3bf1b5f01","modified":1471109706000},{"_id":"themes/next/source/css/_schemes/Mist/sidebar/sidebar-blogroll.styl","hash":"8b8e8cbce98a9296c8fd77f512ae85d945f65d40","modified":1471109706000},{"_id":"themes/next/source/css/_schemes/Muse/sidebar/sidebar-blogroll.styl","hash":"8b8e8cbce98a9296c8fd77f512ae85d945f65d40","modified":1471109706000},{"_id":"themes/next/source/vendors/fancybox/source/helpers/fancybox_buttons.png","hash":"e385b139516c6813dcd64b8fc431c364ceafe5f3","modified":1471109706000},{"_id":"themes/next/source/vendors/fancybox/source/helpers/jquery.fancybox-buttons.js","hash":"91e41741c2e93f732c82aaacec4cfc6e3f3ec876","modified":1471109706000},{"_id":"themes/next/source/vendors/fancybox/source/helpers/jquery.fancybox-thumbs.css","hash":"4ac329c16a5277592fc12a37cca3d72ca4ec292f","modified":1471109706000},{"_id":"themes/next/source/vendors/fancybox/source/helpers/jquery.fancybox-thumbs.js","hash":"53e194f4a72e649c04fb586dd57762b8c022800b","modified":1471109706000},{"_id":"themes/next/source/vendors/fancybox/source/helpers/jquery.fancybox-media.js","hash":"3bdf69ed2469e4fb57f5a95f17300eef891ff90d","modified":1471109706000},{"_id":"themes/next/source/vendors/fancybox/source/helpers/jquery.fancybox-buttons.css","hash":"1a9d8e5c22b371fcc69d4dbbb823d9c39f04c0c8","modified":1471109706000},{"_id":"themes/next/source/vendors/font-awesome/fonts/FontAwesome.otf","hash":"0112e96f327d413938d37c1693806f468ffdbace","modified":1471109706000},{"_id":"themes/next/source/vendors/font-awesome/fonts/fontawesome-webfont.ttf","hash":"27cf1f2ec59aece6938c7bb2feb0e287ea778ff9","modified":1471109706000},{"_id":"themes/next/source/vendors/font-awesome/fonts/fontawesome-webfont.svg","hash":"2b3c8ba7008cc014d8fb37abc6f9f49aeda83824","modified":1471109706000}],"Category":[{"name":"iOS开发","_id":"cjutyfmeq0003c4c9ywxcqxa7"},{"name":"其他","_id":"cjutyfmeu0008c4c9cf3zuwnk"},{"name":"读书笔记","_id":"cjutyfmf1000kc4c9qfb255f4"},{"name":"iOS Tips","_id":"cjutyfmfb0018c4c9rxjpkjfn"},{"name":"Git","_id":"cjutyfmfn0021c4c9fq17djik"},{"name":"树莓派","_id":"cjutyfmg1003ac4c9wu0f5lhq"},{"name":"Swift","_id":"cjutyfmg4003ic4c94wb4sphz"},{"name":"Python","_id":"cjutyfmgf004hc4c952ujaym6"},{"name":"游记","_id":"cjutyfmgo0054c4c930c4s4ck"}],"Data":[],"Page":[{"title":"categories","date":"2016-07-01T10:48:41.000Z","type":"categories","comments":0,"_content":"","source":"categories/index.md","raw":"---\ntitle: categories\ndate: 2016-07-01 18:48:41\ntype: \"categories\" # 类型\ncomments: false # 关闭评论\n---\n","updated":"2017-03-01T06:42:53.000Z","path":"categories/index.html","layout":"page","_id":"cjutyfmeo0001c4c972tgj3xd","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"tags","date":"2016-07-01T10:40:34.000Z","type":"tags","comments":0,"_content":"","source":"tags/index.md","raw":"---\ntitle: tags\ndate: 2016-07-01 18:40:34\ntype: \"tags\" # 类型\ncomments: false # 关闭评论\n---\n","updated":"2017-03-01T06:42:53.000Z","path":"tags/index.html","layout":"page","_id":"cjutyfmj7006rc4c9fqpvwyid","content":"","site":{"data":{}},"excerpt":"","more":""}],"Post":[{"layout":"post","title":"iOS中Emoji表情的判断","_content":"\n## 问题\n服务器端不支持Emoji表情，因此客户端在上传用户输入时，不能包含Emoji表情。\n\n## 解决方案\n在客户端发送请求前，判断用户输入中是否含有表情，如果含有表情，则提示用户重新输入。这个过程关键是如何判断字符串中是否含有Emoji表情。要判断是否含有Emoji表情，\n必须先了解什么是Emoji。\n> Emoji 是一套起源于日本的12x12像素表情符号，由栗田穣崇(Shigetaka Kurit)创作，最早在日本网络及手机用户中流行，自苹果公司发布的iOS 5输入法中加入了emoji后，这种表情符号开始席卷全球，目前emoji已被大多数现代计算机系统所兼容的Unicode编码采纳，普遍应用于各种手机短信和社交网络中。\n\n以上是摘自百度百科里的一段话，Emoji表情最终会被编码成Unicode，因此，只要知道Emoji表情的Unicode编码的范围，就可以判断用户是否输入了Emoji表情。以下是具体代码，\n我这里写成了NSString的一个分类\n\n```objectivec\n@implementation NSString (Emoji)\n\n+ (BOOL)stringContainsEmoji:(NSString *)string\n{\n    __block BOOL returnValue = NO;\n\n    [string enumerateSubstringsInRange:NSMakeRange(0, [string length])\n    options:NSStringEnumerationByComposedCharacterSequences\n    usingBlock:^(NSString *substring, NSRange substringRange, NSRange enclosingRange, BOOL *stop) {\n        const unichar hs = [substring characterAtIndex:0];\n        if (0xd800 <= hs && hs <= 0xdbff) {\n            if (substring.length > 1) {\n                const unichar ls = [substring characterAtIndex:1];\n                const int uc = ((hs - 0xd800) * 0x400) + (ls - 0xdc00) + 0x10000;\n                if (0x1d000 <= uc && uc <= 0x1f77f) {\n                    returnValue = YES;\n                }\n            }\n        } else if (substring.length > 1) {\n            const unichar ls = [substring characterAtIndex:1];\n            if (ls == 0x20e3) {\n                returnValue = YES;\n            }\n        } else {\n            if (0x2100 <= hs && hs <= 0x27ff) {\n                returnValue = YES;\n            } else if (0x2B05 <= hs && hs <= 0x2b07) {\n                returnValue = YES;\n            } else if (0x2934 <= hs && hs <= 0x2935) {\n                returnValue = YES;\n            } else if (0x3297 <= hs && hs <= 0x3299) {\n                returnValue = YES;\n            } else if (hs == 0xa9 || hs == 0xae || hs == 0x303d || hs == 0x3030 || hs == 0x2b55 || hs == 0x2b1c || hs == 0x2b1b || hs == 0x2b50) {\n                returnValue = YES;\n            }\n        }\n    }];\n\n    return returnValue;\n}\n```\n\n这段代码并非本人原创，也是取自互联网，经测试好使，分享给大家。\n\n原博客地址: [iOS中Emoji表情的判断](http://blog.csdn.net/liujinlongxa/article/details/44207003)\n","source":"_posts/2015-10-04-iOS中Emoji表情的判断.md","raw":"---\nlayout: post\ntitle: \"iOS中Emoji表情的判断\"\ncategories: iOS开发\ntags:\n    - iOS开发\n    - Emoji表情\n---\n\n## 问题\n服务器端不支持Emoji表情，因此客户端在上传用户输入时，不能包含Emoji表情。\n\n## 解决方案\n在客户端发送请求前，判断用户输入中是否含有表情，如果含有表情，则提示用户重新输入。这个过程关键是如何判断字符串中是否含有Emoji表情。要判断是否含有Emoji表情，\n必须先了解什么是Emoji。\n> Emoji 是一套起源于日本的12x12像素表情符号，由栗田穣崇(Shigetaka Kurit)创作，最早在日本网络及手机用户中流行，自苹果公司发布的iOS 5输入法中加入了emoji后，这种表情符号开始席卷全球，目前emoji已被大多数现代计算机系统所兼容的Unicode编码采纳，普遍应用于各种手机短信和社交网络中。\n\n以上是摘自百度百科里的一段话，Emoji表情最终会被编码成Unicode，因此，只要知道Emoji表情的Unicode编码的范围，就可以判断用户是否输入了Emoji表情。以下是具体代码，\n我这里写成了NSString的一个分类\n\n```objectivec\n@implementation NSString (Emoji)\n\n+ (BOOL)stringContainsEmoji:(NSString *)string\n{\n    __block BOOL returnValue = NO;\n\n    [string enumerateSubstringsInRange:NSMakeRange(0, [string length])\n    options:NSStringEnumerationByComposedCharacterSequences\n    usingBlock:^(NSString *substring, NSRange substringRange, NSRange enclosingRange, BOOL *stop) {\n        const unichar hs = [substring characterAtIndex:0];\n        if (0xd800 <= hs && hs <= 0xdbff) {\n            if (substring.length > 1) {\n                const unichar ls = [substring characterAtIndex:1];\n                const int uc = ((hs - 0xd800) * 0x400) + (ls - 0xdc00) + 0x10000;\n                if (0x1d000 <= uc && uc <= 0x1f77f) {\n                    returnValue = YES;\n                }\n            }\n        } else if (substring.length > 1) {\n            const unichar ls = [substring characterAtIndex:1];\n            if (ls == 0x20e3) {\n                returnValue = YES;\n            }\n        } else {\n            if (0x2100 <= hs && hs <= 0x27ff) {\n                returnValue = YES;\n            } else if (0x2B05 <= hs && hs <= 0x2b07) {\n                returnValue = YES;\n            } else if (0x2934 <= hs && hs <= 0x2935) {\n                returnValue = YES;\n            } else if (0x3297 <= hs && hs <= 0x3299) {\n                returnValue = YES;\n            } else if (hs == 0xa9 || hs == 0xae || hs == 0x303d || hs == 0x3030 || hs == 0x2b55 || hs == 0x2b1c || hs == 0x2b1b || hs == 0x2b50) {\n                returnValue = YES;\n            }\n        }\n    }];\n\n    return returnValue;\n}\n```\n\n这段代码并非本人原创，也是取自互联网，经测试好使，分享给大家。\n\n原博客地址: [iOS中Emoji表情的判断](http://blog.csdn.net/liujinlongxa/article/details/44207003)\n","slug":"iOS中Emoji表情的判断","published":1,"date":"2015-10-03T16:00:00.000Z","updated":"2017-03-01T06:42:53.000Z","comments":1,"photos":[],"link":"","_id":"cjutyfmek0000c4c9jfg1itqv","content":"<h2 id=\"问题\"><a href=\"#问题\" class=\"headerlink\" title=\"问题\"></a>问题</h2><p>服务器端不支持Emoji表情，因此客户端在上传用户输入时，不能包含Emoji表情。</p>\n<h2 id=\"解决方案\"><a href=\"#解决方案\" class=\"headerlink\" title=\"解决方案\"></a>解决方案</h2><p>在客户端发送请求前，判断用户输入中是否含有表情，如果含有表情，则提示用户重新输入。这个过程关键是如何判断字符串中是否含有Emoji表情。要判断是否含有Emoji表情，<br>必须先了解什么是Emoji。</p>\n<blockquote>\n<p>Emoji 是一套起源于日本的12x12像素表情符号，由栗田穣崇(Shigetaka Kurit)创作，最早在日本网络及手机用户中流行，自苹果公司发布的iOS 5输入法中加入了emoji后，这种表情符号开始席卷全球，目前emoji已被大多数现代计算机系统所兼容的Unicode编码采纳，普遍应用于各种手机短信和社交网络中。</p>\n</blockquote>\n<p>以上是摘自百度百科里的一段话，Emoji表情最终会被编码成Unicode，因此，只要知道Emoji表情的Unicode编码的范围，就可以判断用户是否输入了Emoji表情。以下是具体代码，<br>我这里写成了NSString的一个分类</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">NSString</span> (<span class=\"title\">Emoji</span>)</span></span><br><span class=\"line\"></span><br><span class=\"line\">+ (<span class=\"built_in\">BOOL</span>)stringContainsEmoji:(<span class=\"built_in\">NSString</span> *)string</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    __block <span class=\"built_in\">BOOL</span> returnValue = <span class=\"literal\">NO</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    [string enumerateSubstringsInRange:<span class=\"built_in\">NSMakeRange</span>(<span class=\"number\">0</span>, [string length])</span><br><span class=\"line\">    options:<span class=\"built_in\">NSStringEnumerationByComposedCharacterSequences</span></span><br><span class=\"line\">    usingBlock:^(<span class=\"built_in\">NSString</span> *substring, <span class=\"built_in\">NSRange</span> substringRange, <span class=\"built_in\">NSRange</span> enclosingRange, <span class=\"built_in\">BOOL</span> *stop) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> <span class=\"keyword\">unichar</span> hs = [substring characterAtIndex:<span class=\"number\">0</span>];</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"number\">0xd800</span> &lt;= hs &amp;&amp; hs &lt;= <span class=\"number\">0xdbff</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (substring.length &gt; <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">const</span> <span class=\"keyword\">unichar</span> ls = [substring characterAtIndex:<span class=\"number\">1</span>];</span><br><span class=\"line\">                <span class=\"keyword\">const</span> <span class=\"keyword\">int</span> uc = ((hs - <span class=\"number\">0xd800</span>) * <span class=\"number\">0x400</span>) + (ls - <span class=\"number\">0xdc00</span>) + <span class=\"number\">0x10000</span>;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (<span class=\"number\">0x1d000</span> &lt;= uc &amp;&amp; uc &lt;= <span class=\"number\">0x1f77f</span>) &#123;</span><br><span class=\"line\">                    returnValue = <span class=\"literal\">YES</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (substring.length &gt; <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> <span class=\"keyword\">unichar</span> ls = [substring characterAtIndex:<span class=\"number\">1</span>];</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (ls == <span class=\"number\">0x20e3</span>) &#123;</span><br><span class=\"line\">                returnValue = <span class=\"literal\">YES</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"number\">0x2100</span> &lt;= hs &amp;&amp; hs &lt;= <span class=\"number\">0x27ff</span>) &#123;</span><br><span class=\"line\">                returnValue = <span class=\"literal\">YES</span>;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"number\">0x2B05</span> &lt;= hs &amp;&amp; hs &lt;= <span class=\"number\">0x2b07</span>) &#123;</span><br><span class=\"line\">                returnValue = <span class=\"literal\">YES</span>;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"number\">0x2934</span> &lt;= hs &amp;&amp; hs &lt;= <span class=\"number\">0x2935</span>) &#123;</span><br><span class=\"line\">                returnValue = <span class=\"literal\">YES</span>;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"number\">0x3297</span> &lt;= hs &amp;&amp; hs &lt;= <span class=\"number\">0x3299</span>) &#123;</span><br><span class=\"line\">                returnValue = <span class=\"literal\">YES</span>;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (hs == <span class=\"number\">0xa9</span> || hs == <span class=\"number\">0xae</span> || hs == <span class=\"number\">0x303d</span> || hs == <span class=\"number\">0x3030</span> || hs == <span class=\"number\">0x2b55</span> || hs == <span class=\"number\">0x2b1c</span> || hs == <span class=\"number\">0x2b1b</span> || hs == <span class=\"number\">0x2b50</span>) &#123;</span><br><span class=\"line\">                returnValue = <span class=\"literal\">YES</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> returnValue;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这段代码并非本人原创，也是取自互联网，经测试好使，分享给大家。</p>\n<p>原博客地址: <a href=\"http://blog.csdn.net/liujinlongxa/article/details/44207003\" target=\"_blank\" rel=\"noopener\">iOS中Emoji表情的判断</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"问题\"><a href=\"#问题\" class=\"headerlink\" title=\"问题\"></a>问题</h2><p>服务器端不支持Emoji表情，因此客户端在上传用户输入时，不能包含Emoji表情。</p>\n<h2 id=\"解决方案\"><a href=\"#解决方案\" class=\"headerlink\" title=\"解决方案\"></a>解决方案</h2><p>在客户端发送请求前，判断用户输入中是否含有表情，如果含有表情，则提示用户重新输入。这个过程关键是如何判断字符串中是否含有Emoji表情。要判断是否含有Emoji表情，<br>必须先了解什么是Emoji。</p>\n<blockquote>\n<p>Emoji 是一套起源于日本的12x12像素表情符号，由栗田穣崇(Shigetaka Kurit)创作，最早在日本网络及手机用户中流行，自苹果公司发布的iOS 5输入法中加入了emoji后，这种表情符号开始席卷全球，目前emoji已被大多数现代计算机系统所兼容的Unicode编码采纳，普遍应用于各种手机短信和社交网络中。</p>\n</blockquote>\n<p>以上是摘自百度百科里的一段话，Emoji表情最终会被编码成Unicode，因此，只要知道Emoji表情的Unicode编码的范围，就可以判断用户是否输入了Emoji表情。以下是具体代码，<br>我这里写成了NSString的一个分类</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">NSString</span> (<span class=\"title\">Emoji</span>)</span></span><br><span class=\"line\"></span><br><span class=\"line\">+ (<span class=\"built_in\">BOOL</span>)stringContainsEmoji:(<span class=\"built_in\">NSString</span> *)string</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    __block <span class=\"built_in\">BOOL</span> returnValue = <span class=\"literal\">NO</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    [string enumerateSubstringsInRange:<span class=\"built_in\">NSMakeRange</span>(<span class=\"number\">0</span>, [string length])</span><br><span class=\"line\">    options:<span class=\"built_in\">NSStringEnumerationByComposedCharacterSequences</span></span><br><span class=\"line\">    usingBlock:^(<span class=\"built_in\">NSString</span> *substring, <span class=\"built_in\">NSRange</span> substringRange, <span class=\"built_in\">NSRange</span> enclosingRange, <span class=\"built_in\">BOOL</span> *stop) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> <span class=\"keyword\">unichar</span> hs = [substring characterAtIndex:<span class=\"number\">0</span>];</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"number\">0xd800</span> &lt;= hs &amp;&amp; hs &lt;= <span class=\"number\">0xdbff</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (substring.length &gt; <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">const</span> <span class=\"keyword\">unichar</span> ls = [substring characterAtIndex:<span class=\"number\">1</span>];</span><br><span class=\"line\">                <span class=\"keyword\">const</span> <span class=\"keyword\">int</span> uc = ((hs - <span class=\"number\">0xd800</span>) * <span class=\"number\">0x400</span>) + (ls - <span class=\"number\">0xdc00</span>) + <span class=\"number\">0x10000</span>;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (<span class=\"number\">0x1d000</span> &lt;= uc &amp;&amp; uc &lt;= <span class=\"number\">0x1f77f</span>) &#123;</span><br><span class=\"line\">                    returnValue = <span class=\"literal\">YES</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (substring.length &gt; <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> <span class=\"keyword\">unichar</span> ls = [substring characterAtIndex:<span class=\"number\">1</span>];</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (ls == <span class=\"number\">0x20e3</span>) &#123;</span><br><span class=\"line\">                returnValue = <span class=\"literal\">YES</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"number\">0x2100</span> &lt;= hs &amp;&amp; hs &lt;= <span class=\"number\">0x27ff</span>) &#123;</span><br><span class=\"line\">                returnValue = <span class=\"literal\">YES</span>;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"number\">0x2B05</span> &lt;= hs &amp;&amp; hs &lt;= <span class=\"number\">0x2b07</span>) &#123;</span><br><span class=\"line\">                returnValue = <span class=\"literal\">YES</span>;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"number\">0x2934</span> &lt;= hs &amp;&amp; hs &lt;= <span class=\"number\">0x2935</span>) &#123;</span><br><span class=\"line\">                returnValue = <span class=\"literal\">YES</span>;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"number\">0x3297</span> &lt;= hs &amp;&amp; hs &lt;= <span class=\"number\">0x3299</span>) &#123;</span><br><span class=\"line\">                returnValue = <span class=\"literal\">YES</span>;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (hs == <span class=\"number\">0xa9</span> || hs == <span class=\"number\">0xae</span> || hs == <span class=\"number\">0x303d</span> || hs == <span class=\"number\">0x3030</span> || hs == <span class=\"number\">0x2b55</span> || hs == <span class=\"number\">0x2b1c</span> || hs == <span class=\"number\">0x2b1b</span> || hs == <span class=\"number\">0x2b50</span>) &#123;</span><br><span class=\"line\">                returnValue = <span class=\"literal\">YES</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> returnValue;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这段代码并非本人原创，也是取自互联网，经测试好使，分享给大家。</p>\n<p>原博客地址: <a href=\"http://blog.csdn.net/liujinlongxa/article/details/44207003\" target=\"_blank\" rel=\"noopener\">iOS中Emoji表情的判断</a></p>\n"},{"layout":"post","title":"博客新家","_content":"\n终于有了自己的个人博客，以后要坚持写博客，记录自己的学习，生活，工作。\n\n以前写的博客会陆续搬过来。\n\n来段代码吧！！！\n```objectivec\nNSString * str = @\"I love coding!!\";\nNSLog(@\"%@\", str);\n```\n","source":"_posts/2015-10-03-博客新家.md","raw":"---\nlayout: post\ntitle: \"博客新家\"\ncategories: 其他\n---\n\n终于有了自己的个人博客，以后要坚持写博客，记录自己的学习，生活，工作。\n\n以前写的博客会陆续搬过来。\n\n来段代码吧！！！\n```objectivec\nNSString * str = @\"I love coding!!\";\nNSLog(@\"%@\", str);\n```\n","slug":"博客新家","published":1,"date":"2015-10-02T16:00:00.000Z","updated":"2017-03-01T06:42:53.000Z","comments":1,"photos":[],"link":"","_id":"cjutyfmeo0002c4c9veybclmd","content":"<p>终于有了自己的个人博客，以后要坚持写博客，记录自己的学习，生活，工作。</p>\n<p>以前写的博客会陆续搬过来。</p>\n<p>来段代码吧！！！<br><figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">NSString</span> * str = <span class=\"string\">@\"I love coding!!\"</span>;</span><br><span class=\"line\"><span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%@\"</span>, str);</span><br></pre></td></tr></table></figure></p>\n","site":{"data":{}},"excerpt":"","more":"<p>终于有了自己的个人博客，以后要坚持写博客，记录自己的学习，生活，工作。</p>\n<p>以前写的博客会陆续搬过来。</p>\n<p>来段代码吧！！！<br><figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">NSString</span> * str = <span class=\"string\">@\"I love coding!!\"</span>;</span><br><span class=\"line\"><span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%@\"</span>, str);</span><br></pre></td></tr></table></figure></p>\n"},{"layout":"post","title":"iOS运行时初探 使用运行时机制向Category中添加属性","_content":"\n## 前言\n了解OC的都应该知道，在一般情况下，我们是不能向Category中添加属性的，只能添加方法，但有些情况向，我们确实需要向Category中添加属性，而且很多系统的API也有一些在Category添加属性的情况，例如我们属性的`UITableView`的`section`和`row`属性，就是定义在一个名为`NSIndexPath`的分类里的，如下\n\n![这里写图片描述](http://img.blog.csdn.net/20150531230308155)\n\n那这到底是怎么实现的呢？\n\n## iOS运行时机制简介\niOS运行时机制，简单来说，就是苹果给开发这提供的一套在运行时动态创建类、添加属性/方法（不止这些，还有一些其他功能）的API，它是一套纯C语言的API，使用相应的API就可以通过Category给一个原本存在的类添加属性。\n\n## 实例\n\n```objectivec\n#import <Foundation/Foundation.h>\n#import <objc/runtime.h>\n\n@interface NSObject (CategoryWithProperty)\n\n/**\n *  要在Category中扩展的属性\n */\n@property (nonatomic, strong) NSObject *property;\n\n@end\n\n@implementation NSObject (CategoryWithProperty)\n\n- (NSObject *)property {\n    return objc_getAssociatedObject(self, @selector(property));\n}\n\n- (void)setProperty:(NSObject *)value {\n    objc_setAssociatedObject(self, @selector(property), value, OBJC_ASSOCIATION_RETAIN_NONATOMIC);\n}\n\n@end\n```\n\n这样就可以在Category中添加属性了。\n","source":"_posts/2015-10-04-iOS运行时初探-使用运行时机制向Category中添加属性.md","raw":"---\nlayout: post\ntitle: \"iOS运行时初探 使用运行时机制向Category中添加属性\"\ncategories: \"iOS开发\"\n---\n\n## 前言\n了解OC的都应该知道，在一般情况下，我们是不能向Category中添加属性的，只能添加方法，但有些情况向，我们确实需要向Category中添加属性，而且很多系统的API也有一些在Category添加属性的情况，例如我们属性的`UITableView`的`section`和`row`属性，就是定义在一个名为`NSIndexPath`的分类里的，如下\n\n![这里写图片描述](http://img.blog.csdn.net/20150531230308155)\n\n那这到底是怎么实现的呢？\n\n## iOS运行时机制简介\niOS运行时机制，简单来说，就是苹果给开发这提供的一套在运行时动态创建类、添加属性/方法（不止这些，还有一些其他功能）的API，它是一套纯C语言的API，使用相应的API就可以通过Category给一个原本存在的类添加属性。\n\n## 实例\n\n```objectivec\n#import <Foundation/Foundation.h>\n#import <objc/runtime.h>\n\n@interface NSObject (CategoryWithProperty)\n\n/**\n *  要在Category中扩展的属性\n */\n@property (nonatomic, strong) NSObject *property;\n\n@end\n\n@implementation NSObject (CategoryWithProperty)\n\n- (NSObject *)property {\n    return objc_getAssociatedObject(self, @selector(property));\n}\n\n- (void)setProperty:(NSObject *)value {\n    objc_setAssociatedObject(self, @selector(property), value, OBJC_ASSOCIATION_RETAIN_NONATOMIC);\n}\n\n@end\n```\n\n这样就可以在Category中添加属性了。\n","slug":"iOS运行时初探-使用运行时机制向Category中添加属性","published":1,"date":"2015-10-03T16:00:00.000Z","updated":"2017-03-01T06:42:53.000Z","comments":1,"photos":[],"link":"","_id":"cjutyfmer0005c4c94wriq8gr","content":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>了解OC的都应该知道，在一般情况下，我们是不能向Category中添加属性的，只能添加方法，但有些情况向，我们确实需要向Category中添加属性，而且很多系统的API也有一些在Category添加属性的情况，例如我们属性的<code>UITableView</code>的<code>section</code>和<code>row</code>属性，就是定义在一个名为<code>NSIndexPath</code>的分类里的，如下</p>\n<p><img src=\"http://img.blog.csdn.net/20150531230308155\" alt=\"这里写图片描述\"></p>\n<p>那这到底是怎么实现的呢？</p>\n<h2 id=\"iOS运行时机制简介\"><a href=\"#iOS运行时机制简介\" class=\"headerlink\" title=\"iOS运行时机制简介\"></a>iOS运行时机制简介</h2><p>iOS运行时机制，简单来说，就是苹果给开发这提供的一套在运行时动态创建类、添加属性/方法（不止这些，还有一些其他功能）的API，它是一套纯C语言的API，使用相应的API就可以通过Category给一个原本存在的类添加属性。</p>\n<h2 id=\"实例\"><a href=\"#实例\" class=\"headerlink\" title=\"实例\"></a>实例</h2><figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;objc/runtime.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">NSObject</span> (<span class=\"title\">CategoryWithProperty</span>)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> *  要在Category中扩展的属性</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">@property</span> (<span class=\"keyword\">nonatomic</span>, <span class=\"keyword\">strong</span>) <span class=\"built_in\">NSObject</span> *property;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">NSObject</span> (<span class=\"title\">CategoryWithProperty</span>)</span></span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"built_in\">NSObject</span> *)property &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> objc_getAssociatedObject(<span class=\"keyword\">self</span>, <span class=\"keyword\">@selector</span>(property));</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)setProperty:(<span class=\"built_in\">NSObject</span> *)value &#123;</span><br><span class=\"line\">    objc_setAssociatedObject(<span class=\"keyword\">self</span>, <span class=\"keyword\">@selector</span>(property), value, OBJC_ASSOCIATION_RETAIN_NONATOMIC);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure>\n<p>这样就可以在Category中添加属性了。</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>了解OC的都应该知道，在一般情况下，我们是不能向Category中添加属性的，只能添加方法，但有些情况向，我们确实需要向Category中添加属性，而且很多系统的API也有一些在Category添加属性的情况，例如我们属性的<code>UITableView</code>的<code>section</code>和<code>row</code>属性，就是定义在一个名为<code>NSIndexPath</code>的分类里的，如下</p>\n<p><img src=\"http://img.blog.csdn.net/20150531230308155\" alt=\"这里写图片描述\"></p>\n<p>那这到底是怎么实现的呢？</p>\n<h2 id=\"iOS运行时机制简介\"><a href=\"#iOS运行时机制简介\" class=\"headerlink\" title=\"iOS运行时机制简介\"></a>iOS运行时机制简介</h2><p>iOS运行时机制，简单来说，就是苹果给开发这提供的一套在运行时动态创建类、添加属性/方法（不止这些，还有一些其他功能）的API，它是一套纯C语言的API，使用相应的API就可以通过Category给一个原本存在的类添加属性。</p>\n<h2 id=\"实例\"><a href=\"#实例\" class=\"headerlink\" title=\"实例\"></a>实例</h2><figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;objc/runtime.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">NSObject</span> (<span class=\"title\">CategoryWithProperty</span>)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> *  要在Category中扩展的属性</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">@property</span> (<span class=\"keyword\">nonatomic</span>, <span class=\"keyword\">strong</span>) <span class=\"built_in\">NSObject</span> *property;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">NSObject</span> (<span class=\"title\">CategoryWithProperty</span>)</span></span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"built_in\">NSObject</span> *)property &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> objc_getAssociatedObject(<span class=\"keyword\">self</span>, <span class=\"keyword\">@selector</span>(property));</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)setProperty:(<span class=\"built_in\">NSObject</span> *)value &#123;</span><br><span class=\"line\">    objc_setAssociatedObject(<span class=\"keyword\">self</span>, <span class=\"keyword\">@selector</span>(property), value, OBJC_ASSOCIATION_RETAIN_NONATOMIC);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure>\n<p>这样就可以在Category中添加属性了。</p>\n"},{"layout":"post","title":"NSURLProtocol的使用","_content":"\n### NSURLProtocol的使用\n\nNSURLProtocol可以拦截所有由[URL Loading System](https://developer.apple.com/library/mac/documentation/Cocoa/Conceptual/URLLoadingSystem/URLLoadingSystem.html#//apple_ref/doc/uid/10000165i)发起的请求，可用于实现以下功能：\n\n * 重定向网络请求，实现代理等功能\n * 实现网络缓存\n * 全局设置网络请求\n * 自定义网络请求返回结果\n\n具体的实现步骤如下：\n\n**第一步** 创建NSURLProtocol的子类，重写以下方法\n\n`+ (BOOL)canInitWithRequest:(NSURLRequest *)request`这个方法用来返回是否需要处理这个请求，如果需要处理，返回YES，否则返回NO。在该方法中可以对不需要处理的请求进行过滤。\n\n`+ (NSURLRequest *)canonicalRequestForRequest:(NSURLRequest *)request`重写该方法，可以对请求进行修改，例如添加新的头部信息，修改，修改url等，返回修改后的请求。\n\n`+ (BOOL)requestIsCacheEquivalent:(NSURLRequest *)a toRequest:(NSURLRequest *)b`该方法主要用来判断两个请求是否是同一个请求，如果是，则可以使用缓存数据，通常只需要调用父类的实现即可\n\n`- (void)startLoading`重写该方法，需要在该方法中发起一个请求，对于NSURLConnection来说，就是创建一个NSURLConnection，对于NSURLSession，就是发起一个NSURLSessionTask\n\n`- (void)stopLoading`重写该方法，需要停止响应的请求\n\n**第二步** 实现相应的协议代理方法，对NSURLConnection来说，要实现NSURLConnectionDataDelegate代理方法，对于NSURLSession来说，需要实现NSURLSessionTaskDelegate代理方法。在这些代理方法中，需要使用NSURLProtocolClient来通知URL Loading System。具体实现方式详见示例代码。\n\n**第三步** 在合适的位置注册自定义的NSURLProtocol子类。调用`[NSURLProtocol registerClass:[MyURLProtocol class]]`进行注册，调用`[NSURLProtocol unregisterClass:[MyURLProtocol class]]`可以注销。注意，代码中可以注册多个NSURLProtocol子类，每个子类可以\n\n以上就是整个实现过程，详细内容可以参见代码。\n\n代码地址:[NSURLProtocolDemo](https://github.com/liujinlongxa/NSURLProtocolDemo)\n","source":"_posts/2015-10-04-NSURLProtocol的使用.md","raw":"---\nlayout: post\ntitle: \"NSURLProtocol的使用\"\ncategories: \"iOS开发\"\n---\n\n### NSURLProtocol的使用\n\nNSURLProtocol可以拦截所有由[URL Loading System](https://developer.apple.com/library/mac/documentation/Cocoa/Conceptual/URLLoadingSystem/URLLoadingSystem.html#//apple_ref/doc/uid/10000165i)发起的请求，可用于实现以下功能：\n\n * 重定向网络请求，实现代理等功能\n * 实现网络缓存\n * 全局设置网络请求\n * 自定义网络请求返回结果\n\n具体的实现步骤如下：\n\n**第一步** 创建NSURLProtocol的子类，重写以下方法\n\n`+ (BOOL)canInitWithRequest:(NSURLRequest *)request`这个方法用来返回是否需要处理这个请求，如果需要处理，返回YES，否则返回NO。在该方法中可以对不需要处理的请求进行过滤。\n\n`+ (NSURLRequest *)canonicalRequestForRequest:(NSURLRequest *)request`重写该方法，可以对请求进行修改，例如添加新的头部信息，修改，修改url等，返回修改后的请求。\n\n`+ (BOOL)requestIsCacheEquivalent:(NSURLRequest *)a toRequest:(NSURLRequest *)b`该方法主要用来判断两个请求是否是同一个请求，如果是，则可以使用缓存数据，通常只需要调用父类的实现即可\n\n`- (void)startLoading`重写该方法，需要在该方法中发起一个请求，对于NSURLConnection来说，就是创建一个NSURLConnection，对于NSURLSession，就是发起一个NSURLSessionTask\n\n`- (void)stopLoading`重写该方法，需要停止响应的请求\n\n**第二步** 实现相应的协议代理方法，对NSURLConnection来说，要实现NSURLConnectionDataDelegate代理方法，对于NSURLSession来说，需要实现NSURLSessionTaskDelegate代理方法。在这些代理方法中，需要使用NSURLProtocolClient来通知URL Loading System。具体实现方式详见示例代码。\n\n**第三步** 在合适的位置注册自定义的NSURLProtocol子类。调用`[NSURLProtocol registerClass:[MyURLProtocol class]]`进行注册，调用`[NSURLProtocol unregisterClass:[MyURLProtocol class]]`可以注销。注意，代码中可以注册多个NSURLProtocol子类，每个子类可以\n\n以上就是整个实现过程，详细内容可以参见代码。\n\n代码地址:[NSURLProtocolDemo](https://github.com/liujinlongxa/NSURLProtocolDemo)\n","slug":"NSURLProtocol的使用","published":1,"date":"2015-10-03T16:00:00.000Z","updated":"2017-03-01T06:42:53.000Z","comments":1,"photos":[],"link":"","_id":"cjutyfmes0006c4c9gprxuxq8","content":"<h3 id=\"NSURLProtocol的使用\"><a href=\"#NSURLProtocol的使用\" class=\"headerlink\" title=\"NSURLProtocol的使用\"></a>NSURLProtocol的使用</h3><p>NSURLProtocol可以拦截所有由<a href=\"https://developer.apple.com/library/mac/documentation/Cocoa/Conceptual/URLLoadingSystem/URLLoadingSystem.html#//apple_ref/doc/uid/10000165i\" target=\"_blank\" rel=\"noopener\">URL Loading System</a>发起的请求，可用于实现以下功能：</p>\n<ul>\n<li>重定向网络请求，实现代理等功能</li>\n<li>实现网络缓存</li>\n<li>全局设置网络请求</li>\n<li>自定义网络请求返回结果</li>\n</ul>\n<p>具体的实现步骤如下：</p>\n<p><strong>第一步</strong> 创建NSURLProtocol的子类，重写以下方法</p>\n<p><code>+ (BOOL)canInitWithRequest:(NSURLRequest *)request</code>这个方法用来返回是否需要处理这个请求，如果需要处理，返回YES，否则返回NO。在该方法中可以对不需要处理的请求进行过滤。</p>\n<p><code>+ (NSURLRequest *)canonicalRequestForRequest:(NSURLRequest *)request</code>重写该方法，可以对请求进行修改，例如添加新的头部信息，修改，修改url等，返回修改后的请求。</p>\n<p><code>+ (BOOL)requestIsCacheEquivalent:(NSURLRequest *)a toRequest:(NSURLRequest *)b</code>该方法主要用来判断两个请求是否是同一个请求，如果是，则可以使用缓存数据，通常只需要调用父类的实现即可</p>\n<p><code>- (void)startLoading</code>重写该方法，需要在该方法中发起一个请求，对于NSURLConnection来说，就是创建一个NSURLConnection，对于NSURLSession，就是发起一个NSURLSessionTask</p>\n<p><code>- (void)stopLoading</code>重写该方法，需要停止响应的请求</p>\n<p><strong>第二步</strong> 实现相应的协议代理方法，对NSURLConnection来说，要实现NSURLConnectionDataDelegate代理方法，对于NSURLSession来说，需要实现NSURLSessionTaskDelegate代理方法。在这些代理方法中，需要使用NSURLProtocolClient来通知URL Loading System。具体实现方式详见示例代码。</p>\n<p><strong>第三步</strong> 在合适的位置注册自定义的NSURLProtocol子类。调用<code>[NSURLProtocol registerClass:[MyURLProtocol class]]</code>进行注册，调用<code>[NSURLProtocol unregisterClass:[MyURLProtocol class]]</code>可以注销。注意，代码中可以注册多个NSURLProtocol子类，每个子类可以</p>\n<p>以上就是整个实现过程，详细内容可以参见代码。</p>\n<p>代码地址:<a href=\"https://github.com/liujinlongxa/NSURLProtocolDemo\" target=\"_blank\" rel=\"noopener\">NSURLProtocolDemo</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"NSURLProtocol的使用\"><a href=\"#NSURLProtocol的使用\" class=\"headerlink\" title=\"NSURLProtocol的使用\"></a>NSURLProtocol的使用</h3><p>NSURLProtocol可以拦截所有由<a href=\"https://developer.apple.com/library/mac/documentation/Cocoa/Conceptual/URLLoadingSystem/URLLoadingSystem.html#//apple_ref/doc/uid/10000165i\" target=\"_blank\" rel=\"noopener\">URL Loading System</a>发起的请求，可用于实现以下功能：</p>\n<ul>\n<li>重定向网络请求，实现代理等功能</li>\n<li>实现网络缓存</li>\n<li>全局设置网络请求</li>\n<li>自定义网络请求返回结果</li>\n</ul>\n<p>具体的实现步骤如下：</p>\n<p><strong>第一步</strong> 创建NSURLProtocol的子类，重写以下方法</p>\n<p><code>+ (BOOL)canInitWithRequest:(NSURLRequest *)request</code>这个方法用来返回是否需要处理这个请求，如果需要处理，返回YES，否则返回NO。在该方法中可以对不需要处理的请求进行过滤。</p>\n<p><code>+ (NSURLRequest *)canonicalRequestForRequest:(NSURLRequest *)request</code>重写该方法，可以对请求进行修改，例如添加新的头部信息，修改，修改url等，返回修改后的请求。</p>\n<p><code>+ (BOOL)requestIsCacheEquivalent:(NSURLRequest *)a toRequest:(NSURLRequest *)b</code>该方法主要用来判断两个请求是否是同一个请求，如果是，则可以使用缓存数据，通常只需要调用父类的实现即可</p>\n<p><code>- (void)startLoading</code>重写该方法，需要在该方法中发起一个请求，对于NSURLConnection来说，就是创建一个NSURLConnection，对于NSURLSession，就是发起一个NSURLSessionTask</p>\n<p><code>- (void)stopLoading</code>重写该方法，需要停止响应的请求</p>\n<p><strong>第二步</strong> 实现相应的协议代理方法，对NSURLConnection来说，要实现NSURLConnectionDataDelegate代理方法，对于NSURLSession来说，需要实现NSURLSessionTaskDelegate代理方法。在这些代理方法中，需要使用NSURLProtocolClient来通知URL Loading System。具体实现方式详见示例代码。</p>\n<p><strong>第三步</strong> 在合适的位置注册自定义的NSURLProtocol子类。调用<code>[NSURLProtocol registerClass:[MyURLProtocol class]]</code>进行注册，调用<code>[NSURLProtocol unregisterClass:[MyURLProtocol class]]</code>可以注销。注意，代码中可以注册多个NSURLProtocol子类，每个子类可以</p>\n<p>以上就是整个实现过程，详细内容可以参见代码。</p>\n<p>代码地址:<a href=\"https://github.com/liujinlongxa/NSURLProtocolDemo\" target=\"_blank\" rel=\"noopener\">NSURLProtocolDemo</a></p>\n"},{"layout":"post","title":"iOS中的富文本技术(1)TextKit简介","_content":"\n## 前言\n 最近项目中用到了图文混排，所以就研究了一下iOS中的富文本，打算把研究的结果分享一下，也是对自己学习的一个总结。初步打算写两篇，这是第一篇，主要介绍iOS7新出的TextKit的简单实用。\n\n## 简介\nTextKit是iOS7新推出的文字排版技术，使用TextKit可以很方便的实现富文本、表情混排和图文混排等效果。TextKit中的几个关键的类：\n* `NSAttributeString`和`NSMutableAttributeString`：属性字符串和可变属性字符串，这个TextKit中最基础的类，文字中的所有富文本属性都是通过属性字符串来表现出来的\n* `NSTextAttachment`：字符串的附件，将图片，可以将图片等内容当做一个附件插入到属性字符串中，可以实现表情混排，链接等效果\n\n## 示例\n废话不多说，直接上代码，先看一下效果图：\n![这里写图片描述](http://img.blog.csdn.net/20150402235843040)\n\n```objectivec\n#import \"TextKitEmojiTextVC.h\"\n\nNSString * str = @\"asfasfa阿斯顿发生大发撒放大离开家撒旦法按时付款就阿里；双方均asfasdfasfdalkjsflakj阿斯顿发生大发撒旦法asdfasdfaasfdaasa撒旦法；拉斯克奖发了奥斯卡奖罚洛杉矶的法律；看见谁发的阿斯利康就发；了数据库等法律按实际开发；阿里就开始放到了；安家费阿里山科技发达了开始将对方拉开始交电费了卡双方的空间啊发送卡飞机阿里开始就放暑假了罚款就是浪费\";\n\n@interface TextKitEmojiTextVC ()<UITextViewDelegate>\n\n@property (nonatomic, strong) UITextView * textView;\n\n@end\n\n@implementation TextKitEmojiTextVC\n\n- (void)viewDidLoad {\n    [super viewDidLoad];\n\n    self.title = @\"普通文字排版&表情混排\";\n\n\n    //初始化textView\n    self.edgesForExtendedLayout = UIRectEdgeNone;\n    self.textView = [[UITextView alloc] initWithFrame:CGRectMake(20, 20, [UIScreen mainScreen].bounds.size.width - 40, [UIScreen mainScreen].bounds.size.height - 40 - 44 - 20)];\n    self.textView.backgroundColor = [UIColor cyanColor];\n    self.textView.text = str;\n    self.textView.font = [UIFont systemFontOfSize:15];\n    self.textView.editable = NO;\n    self.textView.delegate = self;\n    [self.view addSubview:self.textView];\n\n    //设置常规属性\n    [self setupNormalAttribute];\n\n    //链接和表情\n    [self setupEmojiAndLink];\n\n}\n\n/**\n *  向文本中添加表情，链接等\n */\n- (void)setupEmojiAndLink\n{\n\n    NSMutableAttributedString * mutStr = [self.textView.attributedText mutableCopy];\n\n    //添加表情\n    UIImage * image1 = [UIImage imageNamed:@\"010\"];\n    NSTextAttachment * attachment1 = [[NSTextAttachment alloc] init];\n    attachment1.bounds = CGRectMake(0, 0, 30, 30);\n    attachment1.image = image1;\n    NSAttributedString * attachStr1 = [NSAttributedString attributedStringWithAttachment:attachment1];\n    [mutStr insertAttributedString:attachStr1 atIndex:50];\n\n    //添加表情\n    UIImage * image2 = [UIImage imageNamed:@\"011\"];\n    NSTextAttachment * attachment2 = [[NSTextAttachment alloc] init];\n    attachment2.bounds = CGRectMake(0, 0, 15, 15);\n    attachment2.image = image2;\n    NSAttributedString * attachStr2 = [NSAttributedString attributedStringWithAttachment:attachment2];\n    [mutStr insertAttributedString:attachStr2 atIndex:100];\n\n    //添加链接\n    NSURL * url = [NSURL URLWithString:@\"http://www.baidu.com\"];\n    [mutStr addAttribute:NSLinkAttributeName value:url range:NSMakeRange(70, 10)];\n\n    self.textView.attributedText = [mutStr copy];\n}\n\n/**\n *  设置常规属性\n */\n- (void)setupNormalAttribute\n{\n    NSMutableAttributedString * mutStr = [self.textView.attributedText mutableCopy];\n\n    //颜色\n    [mutStr addAttribute:NSForegroundColorAttributeName value:[UIColor redColor] range:NSMakeRange(10, 10)];\n    //字体\n    [mutStr addAttribute:NSFontAttributeName value:[UIFont systemFontOfSize:25] range:NSMakeRange(20, 5)];\n    //下划线\n    [mutStr addAttribute:NSUnderlineStyleAttributeName value:@(NSUnderlineStyleSingle | NSUnderlinePatternDot) range:NSMakeRange(32, 8)];\n    //空心字\n    [mutStr addAttribute:NSStrokeWidthAttributeName value:@(2) range:NSMakeRange(42, 5)];\n    self.textView.attributedText = [mutStr copy];\n}\n\n/**\n *  点击图片触发代理事件\n */\n- (BOOL)textView:(UITextView *)textView shouldInteractWithTextAttachment:(NSTextAttachment *)textAttachment inRange:(NSRange)characterRange\n{\n    NSLog(@\"%@\", textAttachment);\n    return NO;\n}\n\n/**\n *  点击链接，触发代理事件\n */\n- (BOOL)textView:(UITextView *)textView shouldInteractWithURL:(NSURL *)URL inRange:(NSRange)characterRange\n{\n    [[UIApplication sharedApplication] openURL:URL];\n    return YES;\n}\n\n- (void)didReceiveMemoryWarning {\n    [super didReceiveMemoryWarning];\n    // Dispose of any resources that can be recreated.\n}\n\n@end\n```\n\n图片环绕效果图：\n![这里写图片描述](http://img.blog.csdn.net/20150403000308303)\n\n```objectivec\n#import \"TextKitImageTextVC.h\"\n\nNSString * str1 = @\"asfasfa阿斯顿发生大发撒放大离开家撒旦法按时付款就阿里；双方均asfasdfasfdalkjsflakj阿斯顿发生大发撒旦法asdfasdfaasfdaasa撒旦法；拉斯克奖发了奥斯卡奖罚洛杉矶的法律；看见谁发的阿斯利康就发；了数据库等法律按实际开发；阿里就开始放到了；安家费阿里山科技发达了开始将对方拉开始交电费了卡双方的空间啊发送卡飞机阿里开始就放暑假了罚款就是浪费asfasfa阿斯顿发生大发撒放大离开家撒旦法按时付款就阿里；双方均asfasdfasfdalkjsflakj阿斯顿发生大发撒旦法asdfasdfaasfdaasa撒旦法；拉斯克奖发了奥斯卡奖罚洛杉矶的法律；看见谁发的阿斯利康就发；了数据库等法律按实际开发；阿里就开始放到了；安家费阿里山科技发达了开始将对方拉开始交电费了卡双方的空间啊发送卡飞机阿里开始就放暑假了罚款就是浪费asfasfa阿斯顿发生大发撒放大离开家撒旦法按时付款就阿里；双方均asfasdfasfdalkjsflakj阿斯顿发生大发撒旦法asdfasdfaasfdaasa撒旦法；拉斯克奖发了奥斯卡奖罚洛杉矶的法律；看见谁发的阿斯利康就发；了数据库等法律按实际开发；阿里就开始放到了；安家费阿里山科技发达了开始将对方拉开始交电费了卡双方的空间啊发送卡飞机阿里开始就放暑假了罚款就是浪费\";\n\n@interface TextKitImageTextVC ()\n\n@property (nonatomic, strong) UITextView * textView;\n\n@end\n\n@implementation TextKitImageTextVC\n\n- (void)viewDidLoad {\n    [super viewDidLoad];\n    // Do any additional setup after loading the view.\n\n    self.title = @\"文字环绕\";\n\n    //初始化textLabel\n    self.edgesForExtendedLayout = UIRectEdgeNone;\n    self.textView = [[UITextView alloc] initWithFrame:CGRectMake(20, 20, [UIScreen mainScreen].bounds.size.width - 40, [UIScreen mainScreen].bounds.size.height - 40 - 44 - 20)];\n    self.textView.backgroundColor = [UIColor cyanColor];\n    self.textView.text = str1;\n    self.textView.font = [UIFont systemFontOfSize:15];\n    self.textView.editable = NO;\n    [self.view addSubview:self.textView];\n\n    //图文混排，设置图片的位置\n    UIImageView * imageView = [[UIImageView alloc] initWithFrame:CGRectMake(120, 120, 100, 110)];\n    imageView.image = [UIImage imageNamed:@\"011\"];\n    imageView.backgroundColor = [UIColor redColor];\n    [self.view addSubview:imageView];\n    CGRect rect = CGRectMake(100, 100, 100, 100);\n\n    //设置环绕的路径\n    UIBezierPath * path = [UIBezierPath bezierPathWithRect:rect];\n    self.textView.textContainer.exclusionPaths = @[path];\n\n}\n\n- (void)didReceiveMemoryWarning {\n    [super didReceiveMemoryWarning];\n    // Dispose of any resources that can be recreated.\n}\n@end\n```\n\n## 总结\nTextKit极大的简化了文字排版的复杂度，但是它的缺点也很明显，就是只能在iOS7之后的系统中使用，很多需要兼容iOS7以前的系统的应用都没法使用。不过随着技术的发展，相信它的应用也会越来越广泛。\n","source":"_posts/2015-10-04-iOS中的富文本技术(1)TextKit简介.md","raw":"---\nlayout: post\ntitle: \"iOS中的富文本技术(1)TextKit简介\"\ncategories: \"iOS开发\"\n---\n\n## 前言\n 最近项目中用到了图文混排，所以就研究了一下iOS中的富文本，打算把研究的结果分享一下，也是对自己学习的一个总结。初步打算写两篇，这是第一篇，主要介绍iOS7新出的TextKit的简单实用。\n\n## 简介\nTextKit是iOS7新推出的文字排版技术，使用TextKit可以很方便的实现富文本、表情混排和图文混排等效果。TextKit中的几个关键的类：\n* `NSAttributeString`和`NSMutableAttributeString`：属性字符串和可变属性字符串，这个TextKit中最基础的类，文字中的所有富文本属性都是通过属性字符串来表现出来的\n* `NSTextAttachment`：字符串的附件，将图片，可以将图片等内容当做一个附件插入到属性字符串中，可以实现表情混排，链接等效果\n\n## 示例\n废话不多说，直接上代码，先看一下效果图：\n![这里写图片描述](http://img.blog.csdn.net/20150402235843040)\n\n```objectivec\n#import \"TextKitEmojiTextVC.h\"\n\nNSString * str = @\"asfasfa阿斯顿发生大发撒放大离开家撒旦法按时付款就阿里；双方均asfasdfasfdalkjsflakj阿斯顿发生大发撒旦法asdfasdfaasfdaasa撒旦法；拉斯克奖发了奥斯卡奖罚洛杉矶的法律；看见谁发的阿斯利康就发；了数据库等法律按实际开发；阿里就开始放到了；安家费阿里山科技发达了开始将对方拉开始交电费了卡双方的空间啊发送卡飞机阿里开始就放暑假了罚款就是浪费\";\n\n@interface TextKitEmojiTextVC ()<UITextViewDelegate>\n\n@property (nonatomic, strong) UITextView * textView;\n\n@end\n\n@implementation TextKitEmojiTextVC\n\n- (void)viewDidLoad {\n    [super viewDidLoad];\n\n    self.title = @\"普通文字排版&表情混排\";\n\n\n    //初始化textView\n    self.edgesForExtendedLayout = UIRectEdgeNone;\n    self.textView = [[UITextView alloc] initWithFrame:CGRectMake(20, 20, [UIScreen mainScreen].bounds.size.width - 40, [UIScreen mainScreen].bounds.size.height - 40 - 44 - 20)];\n    self.textView.backgroundColor = [UIColor cyanColor];\n    self.textView.text = str;\n    self.textView.font = [UIFont systemFontOfSize:15];\n    self.textView.editable = NO;\n    self.textView.delegate = self;\n    [self.view addSubview:self.textView];\n\n    //设置常规属性\n    [self setupNormalAttribute];\n\n    //链接和表情\n    [self setupEmojiAndLink];\n\n}\n\n/**\n *  向文本中添加表情，链接等\n */\n- (void)setupEmojiAndLink\n{\n\n    NSMutableAttributedString * mutStr = [self.textView.attributedText mutableCopy];\n\n    //添加表情\n    UIImage * image1 = [UIImage imageNamed:@\"010\"];\n    NSTextAttachment * attachment1 = [[NSTextAttachment alloc] init];\n    attachment1.bounds = CGRectMake(0, 0, 30, 30);\n    attachment1.image = image1;\n    NSAttributedString * attachStr1 = [NSAttributedString attributedStringWithAttachment:attachment1];\n    [mutStr insertAttributedString:attachStr1 atIndex:50];\n\n    //添加表情\n    UIImage * image2 = [UIImage imageNamed:@\"011\"];\n    NSTextAttachment * attachment2 = [[NSTextAttachment alloc] init];\n    attachment2.bounds = CGRectMake(0, 0, 15, 15);\n    attachment2.image = image2;\n    NSAttributedString * attachStr2 = [NSAttributedString attributedStringWithAttachment:attachment2];\n    [mutStr insertAttributedString:attachStr2 atIndex:100];\n\n    //添加链接\n    NSURL * url = [NSURL URLWithString:@\"http://www.baidu.com\"];\n    [mutStr addAttribute:NSLinkAttributeName value:url range:NSMakeRange(70, 10)];\n\n    self.textView.attributedText = [mutStr copy];\n}\n\n/**\n *  设置常规属性\n */\n- (void)setupNormalAttribute\n{\n    NSMutableAttributedString * mutStr = [self.textView.attributedText mutableCopy];\n\n    //颜色\n    [mutStr addAttribute:NSForegroundColorAttributeName value:[UIColor redColor] range:NSMakeRange(10, 10)];\n    //字体\n    [mutStr addAttribute:NSFontAttributeName value:[UIFont systemFontOfSize:25] range:NSMakeRange(20, 5)];\n    //下划线\n    [mutStr addAttribute:NSUnderlineStyleAttributeName value:@(NSUnderlineStyleSingle | NSUnderlinePatternDot) range:NSMakeRange(32, 8)];\n    //空心字\n    [mutStr addAttribute:NSStrokeWidthAttributeName value:@(2) range:NSMakeRange(42, 5)];\n    self.textView.attributedText = [mutStr copy];\n}\n\n/**\n *  点击图片触发代理事件\n */\n- (BOOL)textView:(UITextView *)textView shouldInteractWithTextAttachment:(NSTextAttachment *)textAttachment inRange:(NSRange)characterRange\n{\n    NSLog(@\"%@\", textAttachment);\n    return NO;\n}\n\n/**\n *  点击链接，触发代理事件\n */\n- (BOOL)textView:(UITextView *)textView shouldInteractWithURL:(NSURL *)URL inRange:(NSRange)characterRange\n{\n    [[UIApplication sharedApplication] openURL:URL];\n    return YES;\n}\n\n- (void)didReceiveMemoryWarning {\n    [super didReceiveMemoryWarning];\n    // Dispose of any resources that can be recreated.\n}\n\n@end\n```\n\n图片环绕效果图：\n![这里写图片描述](http://img.blog.csdn.net/20150403000308303)\n\n```objectivec\n#import \"TextKitImageTextVC.h\"\n\nNSString * str1 = @\"asfasfa阿斯顿发生大发撒放大离开家撒旦法按时付款就阿里；双方均asfasdfasfdalkjsflakj阿斯顿发生大发撒旦法asdfasdfaasfdaasa撒旦法；拉斯克奖发了奥斯卡奖罚洛杉矶的法律；看见谁发的阿斯利康就发；了数据库等法律按实际开发；阿里就开始放到了；安家费阿里山科技发达了开始将对方拉开始交电费了卡双方的空间啊发送卡飞机阿里开始就放暑假了罚款就是浪费asfasfa阿斯顿发生大发撒放大离开家撒旦法按时付款就阿里；双方均asfasdfasfdalkjsflakj阿斯顿发生大发撒旦法asdfasdfaasfdaasa撒旦法；拉斯克奖发了奥斯卡奖罚洛杉矶的法律；看见谁发的阿斯利康就发；了数据库等法律按实际开发；阿里就开始放到了；安家费阿里山科技发达了开始将对方拉开始交电费了卡双方的空间啊发送卡飞机阿里开始就放暑假了罚款就是浪费asfasfa阿斯顿发生大发撒放大离开家撒旦法按时付款就阿里；双方均asfasdfasfdalkjsflakj阿斯顿发生大发撒旦法asdfasdfaasfdaasa撒旦法；拉斯克奖发了奥斯卡奖罚洛杉矶的法律；看见谁发的阿斯利康就发；了数据库等法律按实际开发；阿里就开始放到了；安家费阿里山科技发达了开始将对方拉开始交电费了卡双方的空间啊发送卡飞机阿里开始就放暑假了罚款就是浪费\";\n\n@interface TextKitImageTextVC ()\n\n@property (nonatomic, strong) UITextView * textView;\n\n@end\n\n@implementation TextKitImageTextVC\n\n- (void)viewDidLoad {\n    [super viewDidLoad];\n    // Do any additional setup after loading the view.\n\n    self.title = @\"文字环绕\";\n\n    //初始化textLabel\n    self.edgesForExtendedLayout = UIRectEdgeNone;\n    self.textView = [[UITextView alloc] initWithFrame:CGRectMake(20, 20, [UIScreen mainScreen].bounds.size.width - 40, [UIScreen mainScreen].bounds.size.height - 40 - 44 - 20)];\n    self.textView.backgroundColor = [UIColor cyanColor];\n    self.textView.text = str1;\n    self.textView.font = [UIFont systemFontOfSize:15];\n    self.textView.editable = NO;\n    [self.view addSubview:self.textView];\n\n    //图文混排，设置图片的位置\n    UIImageView * imageView = [[UIImageView alloc] initWithFrame:CGRectMake(120, 120, 100, 110)];\n    imageView.image = [UIImage imageNamed:@\"011\"];\n    imageView.backgroundColor = [UIColor redColor];\n    [self.view addSubview:imageView];\n    CGRect rect = CGRectMake(100, 100, 100, 100);\n\n    //设置环绕的路径\n    UIBezierPath * path = [UIBezierPath bezierPathWithRect:rect];\n    self.textView.textContainer.exclusionPaths = @[path];\n\n}\n\n- (void)didReceiveMemoryWarning {\n    [super didReceiveMemoryWarning];\n    // Dispose of any resources that can be recreated.\n}\n@end\n```\n\n## 总结\nTextKit极大的简化了文字排版的复杂度，但是它的缺点也很明显，就是只能在iOS7之后的系统中使用，很多需要兼容iOS7以前的系统的应用都没法使用。不过随着技术的发展，相信它的应用也会越来越广泛。\n","slug":"iOS中的富文本技术(1)TextKit简介","published":1,"date":"2015-10-03T16:00:00.000Z","updated":"2017-03-01T06:42:53.000Z","comments":1,"photos":[],"link":"","_id":"cjutyfmet0007c4c9i77i90sz","content":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p> 最近项目中用到了图文混排，所以就研究了一下iOS中的富文本，打算把研究的结果分享一下，也是对自己学习的一个总结。初步打算写两篇，这是第一篇，主要介绍iOS7新出的TextKit的简单实用。</p>\n<h2 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h2><p>TextKit是iOS7新推出的文字排版技术，使用TextKit可以很方便的实现富文本、表情混排和图文混排等效果。TextKit中的几个关键的类：</p>\n<ul>\n<li><code>NSAttributeString</code>和<code>NSMutableAttributeString</code>：属性字符串和可变属性字符串，这个TextKit中最基础的类，文字中的所有富文本属性都是通过属性字符串来表现出来的</li>\n<li><code>NSTextAttachment</code>：字符串的附件，将图片，可以将图片等内容当做一个附件插入到属性字符串中，可以实现表情混排，链接等效果</li>\n</ul>\n<h2 id=\"示例\"><a href=\"#示例\" class=\"headerlink\" title=\"示例\"></a>示例</h2><p>废话不多说，直接上代码，先看一下效果图：<br><img src=\"http://img.blog.csdn.net/20150402235843040\" alt=\"这里写图片描述\"></p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">\"TextKitEmojiTextVC.h\"</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">NSString</span> * str = <span class=\"string\">@\"asfasfa阿斯顿发生大发撒放大离开家撒旦法按时付款就阿里；双方均asfasdfasfdalkjsflakj阿斯顿发生大发撒旦法asdfasdfaasfdaasa撒旦法；拉斯克奖发了奥斯卡奖罚洛杉矶的法律；看见谁发的阿斯利康就发；了数据库等法律按实际开发；阿里就开始放到了；安家费阿里山科技发达了开始将对方拉开始交电费了卡双方的空间啊发送卡飞机阿里开始就放暑假了罚款就是浪费\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">TextKitEmojiTextVC</span> ()&lt;<span class=\"title\">UITextViewDelegate</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@property</span> (<span class=\"keyword\">nonatomic</span>, <span class=\"keyword\">strong</span>) <span class=\"built_in\">UITextView</span> * textView;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">TextKitEmojiTextVC</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)viewDidLoad &#123;</span><br><span class=\"line\">    [<span class=\"keyword\">super</span> viewDidLoad];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">self</span>.title = <span class=\"string\">@\"普通文字排版&amp;表情混排\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//初始化textView</span></span><br><span class=\"line\">    <span class=\"keyword\">self</span>.edgesForExtendedLayout = <span class=\"built_in\">UIRectEdgeNone</span>;</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.textView = [[<span class=\"built_in\">UITextView</span> alloc] initWithFrame:<span class=\"built_in\">CGRectMake</span>(<span class=\"number\">20</span>, <span class=\"number\">20</span>, [<span class=\"built_in\">UIScreen</span> mainScreen].bounds.size.width - <span class=\"number\">40</span>, [<span class=\"built_in\">UIScreen</span> mainScreen].bounds.size.height - <span class=\"number\">40</span> - <span class=\"number\">44</span> - <span class=\"number\">20</span>)];</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.textView.backgroundColor = [<span class=\"built_in\">UIColor</span> cyanColor];</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.textView.text = str;</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.textView.font = [<span class=\"built_in\">UIFont</span> systemFontOfSize:<span class=\"number\">15</span>];</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.textView.editable = <span class=\"literal\">NO</span>;</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.textView.delegate = <span class=\"keyword\">self</span>;</span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.view addSubview:<span class=\"keyword\">self</span>.textView];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//设置常规属性</span></span><br><span class=\"line\">    [<span class=\"keyword\">self</span> setupNormalAttribute];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//链接和表情</span></span><br><span class=\"line\">    [<span class=\"keyword\">self</span> setupEmojiAndLink];</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> *  向文本中添加表情，链接等</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)setupEmojiAndLink</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">NSMutableAttributedString</span> * mutStr = [<span class=\"keyword\">self</span>.textView.attributedText mutableCopy];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//添加表情</span></span><br><span class=\"line\">    <span class=\"built_in\">UIImage</span> * image1 = [<span class=\"built_in\">UIImage</span> imageNamed:<span class=\"string\">@\"010\"</span>];</span><br><span class=\"line\">    <span class=\"built_in\">NSTextAttachment</span> * attachment1 = [[<span class=\"built_in\">NSTextAttachment</span> alloc] init];</span><br><span class=\"line\">    attachment1.bounds = <span class=\"built_in\">CGRectMake</span>(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">30</span>, <span class=\"number\">30</span>);</span><br><span class=\"line\">    attachment1.image = image1;</span><br><span class=\"line\">    <span class=\"built_in\">NSAttributedString</span> * attachStr1 = [<span class=\"built_in\">NSAttributedString</span> attributedStringWithAttachment:attachment1];</span><br><span class=\"line\">    [mutStr insertAttributedString:attachStr1 atIndex:<span class=\"number\">50</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//添加表情</span></span><br><span class=\"line\">    <span class=\"built_in\">UIImage</span> * image2 = [<span class=\"built_in\">UIImage</span> imageNamed:<span class=\"string\">@\"011\"</span>];</span><br><span class=\"line\">    <span class=\"built_in\">NSTextAttachment</span> * attachment2 = [[<span class=\"built_in\">NSTextAttachment</span> alloc] init];</span><br><span class=\"line\">    attachment2.bounds = <span class=\"built_in\">CGRectMake</span>(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">15</span>, <span class=\"number\">15</span>);</span><br><span class=\"line\">    attachment2.image = image2;</span><br><span class=\"line\">    <span class=\"built_in\">NSAttributedString</span> * attachStr2 = [<span class=\"built_in\">NSAttributedString</span> attributedStringWithAttachment:attachment2];</span><br><span class=\"line\">    [mutStr insertAttributedString:attachStr2 atIndex:<span class=\"number\">100</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//添加链接</span></span><br><span class=\"line\">    <span class=\"built_in\">NSURL</span> * url = [<span class=\"built_in\">NSURL</span> URLWithString:<span class=\"string\">@\"http://www.baidu.com\"</span>];</span><br><span class=\"line\">    [mutStr addAttribute:<span class=\"built_in\">NSLinkAttributeName</span> value:url range:<span class=\"built_in\">NSMakeRange</span>(<span class=\"number\">70</span>, <span class=\"number\">10</span>)];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">self</span>.textView.attributedText = [mutStr <span class=\"keyword\">copy</span>];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> *  设置常规属性</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)setupNormalAttribute</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSMutableAttributedString</span> * mutStr = [<span class=\"keyword\">self</span>.textView.attributedText mutableCopy];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//颜色</span></span><br><span class=\"line\">    [mutStr addAttribute:<span class=\"built_in\">NSForegroundColorAttributeName</span> value:[<span class=\"built_in\">UIColor</span> redColor] range:<span class=\"built_in\">NSMakeRange</span>(<span class=\"number\">10</span>, <span class=\"number\">10</span>)];</span><br><span class=\"line\">    <span class=\"comment\">//字体</span></span><br><span class=\"line\">    [mutStr addAttribute:<span class=\"built_in\">NSFontAttributeName</span> value:[<span class=\"built_in\">UIFont</span> systemFontOfSize:<span class=\"number\">25</span>] range:<span class=\"built_in\">NSMakeRange</span>(<span class=\"number\">20</span>, <span class=\"number\">5</span>)];</span><br><span class=\"line\">    <span class=\"comment\">//下划线</span></span><br><span class=\"line\">    [mutStr addAttribute:<span class=\"built_in\">NSUnderlineStyleAttributeName</span> value:@(<span class=\"built_in\">NSUnderlineStyleSingle</span> | <span class=\"built_in\">NSUnderlinePatternDot</span>) range:<span class=\"built_in\">NSMakeRange</span>(<span class=\"number\">32</span>, <span class=\"number\">8</span>)];</span><br><span class=\"line\">    <span class=\"comment\">//空心字</span></span><br><span class=\"line\">    [mutStr addAttribute:<span class=\"built_in\">NSStrokeWidthAttributeName</span> value:@(<span class=\"number\">2</span>) range:<span class=\"built_in\">NSMakeRange</span>(<span class=\"number\">42</span>, <span class=\"number\">5</span>)];</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.textView.attributedText = [mutStr <span class=\"keyword\">copy</span>];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> *  点击图片触发代理事件</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\">- (<span class=\"built_in\">BOOL</span>)textView:(<span class=\"built_in\">UITextView</span> *)textView shouldInteractWithTextAttachment:(<span class=\"built_in\">NSTextAttachment</span> *)textAttachment inRange:(<span class=\"built_in\">NSRange</span>)characterRange</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%@\"</span>, textAttachment);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">NO</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> *  点击链接，触发代理事件</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\">- (<span class=\"built_in\">BOOL</span>)textView:(<span class=\"built_in\">UITextView</span> *)textView shouldInteractWithURL:(<span class=\"built_in\">NSURL</span> *)URL inRange:(<span class=\"built_in\">NSRange</span>)characterRange</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    [[<span class=\"built_in\">UIApplication</span> sharedApplication] openURL:URL];</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">YES</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)didReceiveMemoryWarning &#123;</span><br><span class=\"line\">    [<span class=\"keyword\">super</span> didReceiveMemoryWarning];</span><br><span class=\"line\">    <span class=\"comment\">// Dispose of any resources that can be recreated.</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure>\n<p>图片环绕效果图：<br><img src=\"http://img.blog.csdn.net/20150403000308303\" alt=\"这里写图片描述\"></p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">\"TextKitImageTextVC.h\"</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">NSString</span> * str1 = <span class=\"string\">@\"asfasfa阿斯顿发生大发撒放大离开家撒旦法按时付款就阿里；双方均asfasdfasfdalkjsflakj阿斯顿发生大发撒旦法asdfasdfaasfdaasa撒旦法；拉斯克奖发了奥斯卡奖罚洛杉矶的法律；看见谁发的阿斯利康就发；了数据库等法律按实际开发；阿里就开始放到了；安家费阿里山科技发达了开始将对方拉开始交电费了卡双方的空间啊发送卡飞机阿里开始就放暑假了罚款就是浪费asfasfa阿斯顿发生大发撒放大离开家撒旦法按时付款就阿里；双方均asfasdfasfdalkjsflakj阿斯顿发生大发撒旦法asdfasdfaasfdaasa撒旦法；拉斯克奖发了奥斯卡奖罚洛杉矶的法律；看见谁发的阿斯利康就发；了数据库等法律按实际开发；阿里就开始放到了；安家费阿里山科技发达了开始将对方拉开始交电费了卡双方的空间啊发送卡飞机阿里开始就放暑假了罚款就是浪费asfasfa阿斯顿发生大发撒放大离开家撒旦法按时付款就阿里；双方均asfasdfasfdalkjsflakj阿斯顿发生大发撒旦法asdfasdfaasfdaasa撒旦法；拉斯克奖发了奥斯卡奖罚洛杉矶的法律；看见谁发的阿斯利康就发；了数据库等法律按实际开发；阿里就开始放到了；安家费阿里山科技发达了开始将对方拉开始交电费了卡双方的空间啊发送卡飞机阿里开始就放暑假了罚款就是浪费\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">TextKitImageTextVC</span> ()</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@property</span> (<span class=\"keyword\">nonatomic</span>, <span class=\"keyword\">strong</span>) <span class=\"built_in\">UITextView</span> * textView;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">TextKitImageTextVC</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)viewDidLoad &#123;</span><br><span class=\"line\">    [<span class=\"keyword\">super</span> viewDidLoad];</span><br><span class=\"line\">    <span class=\"comment\">// Do any additional setup after loading the view.</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">self</span>.title = <span class=\"string\">@\"文字环绕\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//初始化textLabel</span></span><br><span class=\"line\">    <span class=\"keyword\">self</span>.edgesForExtendedLayout = <span class=\"built_in\">UIRectEdgeNone</span>;</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.textView = [[<span class=\"built_in\">UITextView</span> alloc] initWithFrame:<span class=\"built_in\">CGRectMake</span>(<span class=\"number\">20</span>, <span class=\"number\">20</span>, [<span class=\"built_in\">UIScreen</span> mainScreen].bounds.size.width - <span class=\"number\">40</span>, [<span class=\"built_in\">UIScreen</span> mainScreen].bounds.size.height - <span class=\"number\">40</span> - <span class=\"number\">44</span> - <span class=\"number\">20</span>)];</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.textView.backgroundColor = [<span class=\"built_in\">UIColor</span> cyanColor];</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.textView.text = str1;</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.textView.font = [<span class=\"built_in\">UIFont</span> systemFontOfSize:<span class=\"number\">15</span>];</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.textView.editable = <span class=\"literal\">NO</span>;</span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.view addSubview:<span class=\"keyword\">self</span>.textView];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//图文混排，设置图片的位置</span></span><br><span class=\"line\">    <span class=\"built_in\">UIImageView</span> * imageView = [[<span class=\"built_in\">UIImageView</span> alloc] initWithFrame:<span class=\"built_in\">CGRectMake</span>(<span class=\"number\">120</span>, <span class=\"number\">120</span>, <span class=\"number\">100</span>, <span class=\"number\">110</span>)];</span><br><span class=\"line\">    imageView.image = [<span class=\"built_in\">UIImage</span> imageNamed:<span class=\"string\">@\"011\"</span>];</span><br><span class=\"line\">    imageView.backgroundColor = [<span class=\"built_in\">UIColor</span> redColor];</span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.view addSubview:imageView];</span><br><span class=\"line\">    <span class=\"built_in\">CGRect</span> rect = <span class=\"built_in\">CGRectMake</span>(<span class=\"number\">100</span>, <span class=\"number\">100</span>, <span class=\"number\">100</span>, <span class=\"number\">100</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//设置环绕的路径</span></span><br><span class=\"line\">    <span class=\"built_in\">UIBezierPath</span> * path = [<span class=\"built_in\">UIBezierPath</span> bezierPathWithRect:rect];</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.textView.textContainer.exclusionPaths = @[path];</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)didReceiveMemoryWarning &#123;</span><br><span class=\"line\">    [<span class=\"keyword\">super</span> didReceiveMemoryWarning];</span><br><span class=\"line\">    <span class=\"comment\">// Dispose of any resources that can be recreated.</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>TextKit极大的简化了文字排版的复杂度，但是它的缺点也很明显，就是只能在iOS7之后的系统中使用，很多需要兼容iOS7以前的系统的应用都没法使用。不过随着技术的发展，相信它的应用也会越来越广泛。</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p> 最近项目中用到了图文混排，所以就研究了一下iOS中的富文本，打算把研究的结果分享一下，也是对自己学习的一个总结。初步打算写两篇，这是第一篇，主要介绍iOS7新出的TextKit的简单实用。</p>\n<h2 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h2><p>TextKit是iOS7新推出的文字排版技术，使用TextKit可以很方便的实现富文本、表情混排和图文混排等效果。TextKit中的几个关键的类：</p>\n<ul>\n<li><code>NSAttributeString</code>和<code>NSMutableAttributeString</code>：属性字符串和可变属性字符串，这个TextKit中最基础的类，文字中的所有富文本属性都是通过属性字符串来表现出来的</li>\n<li><code>NSTextAttachment</code>：字符串的附件，将图片，可以将图片等内容当做一个附件插入到属性字符串中，可以实现表情混排，链接等效果</li>\n</ul>\n<h2 id=\"示例\"><a href=\"#示例\" class=\"headerlink\" title=\"示例\"></a>示例</h2><p>废话不多说，直接上代码，先看一下效果图：<br><img src=\"http://img.blog.csdn.net/20150402235843040\" alt=\"这里写图片描述\"></p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">\"TextKitEmojiTextVC.h\"</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">NSString</span> * str = <span class=\"string\">@\"asfasfa阿斯顿发生大发撒放大离开家撒旦法按时付款就阿里；双方均asfasdfasfdalkjsflakj阿斯顿发生大发撒旦法asdfasdfaasfdaasa撒旦法；拉斯克奖发了奥斯卡奖罚洛杉矶的法律；看见谁发的阿斯利康就发；了数据库等法律按实际开发；阿里就开始放到了；安家费阿里山科技发达了开始将对方拉开始交电费了卡双方的空间啊发送卡飞机阿里开始就放暑假了罚款就是浪费\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">TextKitEmojiTextVC</span> ()&lt;<span class=\"title\">UITextViewDelegate</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@property</span> (<span class=\"keyword\">nonatomic</span>, <span class=\"keyword\">strong</span>) <span class=\"built_in\">UITextView</span> * textView;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">TextKitEmojiTextVC</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)viewDidLoad &#123;</span><br><span class=\"line\">    [<span class=\"keyword\">super</span> viewDidLoad];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">self</span>.title = <span class=\"string\">@\"普通文字排版&amp;表情混排\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//初始化textView</span></span><br><span class=\"line\">    <span class=\"keyword\">self</span>.edgesForExtendedLayout = <span class=\"built_in\">UIRectEdgeNone</span>;</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.textView = [[<span class=\"built_in\">UITextView</span> alloc] initWithFrame:<span class=\"built_in\">CGRectMake</span>(<span class=\"number\">20</span>, <span class=\"number\">20</span>, [<span class=\"built_in\">UIScreen</span> mainScreen].bounds.size.width - <span class=\"number\">40</span>, [<span class=\"built_in\">UIScreen</span> mainScreen].bounds.size.height - <span class=\"number\">40</span> - <span class=\"number\">44</span> - <span class=\"number\">20</span>)];</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.textView.backgroundColor = [<span class=\"built_in\">UIColor</span> cyanColor];</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.textView.text = str;</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.textView.font = [<span class=\"built_in\">UIFont</span> systemFontOfSize:<span class=\"number\">15</span>];</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.textView.editable = <span class=\"literal\">NO</span>;</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.textView.delegate = <span class=\"keyword\">self</span>;</span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.view addSubview:<span class=\"keyword\">self</span>.textView];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//设置常规属性</span></span><br><span class=\"line\">    [<span class=\"keyword\">self</span> setupNormalAttribute];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//链接和表情</span></span><br><span class=\"line\">    [<span class=\"keyword\">self</span> setupEmojiAndLink];</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> *  向文本中添加表情，链接等</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)setupEmojiAndLink</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">NSMutableAttributedString</span> * mutStr = [<span class=\"keyword\">self</span>.textView.attributedText mutableCopy];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//添加表情</span></span><br><span class=\"line\">    <span class=\"built_in\">UIImage</span> * image1 = [<span class=\"built_in\">UIImage</span> imageNamed:<span class=\"string\">@\"010\"</span>];</span><br><span class=\"line\">    <span class=\"built_in\">NSTextAttachment</span> * attachment1 = [[<span class=\"built_in\">NSTextAttachment</span> alloc] init];</span><br><span class=\"line\">    attachment1.bounds = <span class=\"built_in\">CGRectMake</span>(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">30</span>, <span class=\"number\">30</span>);</span><br><span class=\"line\">    attachment1.image = image1;</span><br><span class=\"line\">    <span class=\"built_in\">NSAttributedString</span> * attachStr1 = [<span class=\"built_in\">NSAttributedString</span> attributedStringWithAttachment:attachment1];</span><br><span class=\"line\">    [mutStr insertAttributedString:attachStr1 atIndex:<span class=\"number\">50</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//添加表情</span></span><br><span class=\"line\">    <span class=\"built_in\">UIImage</span> * image2 = [<span class=\"built_in\">UIImage</span> imageNamed:<span class=\"string\">@\"011\"</span>];</span><br><span class=\"line\">    <span class=\"built_in\">NSTextAttachment</span> * attachment2 = [[<span class=\"built_in\">NSTextAttachment</span> alloc] init];</span><br><span class=\"line\">    attachment2.bounds = <span class=\"built_in\">CGRectMake</span>(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">15</span>, <span class=\"number\">15</span>);</span><br><span class=\"line\">    attachment2.image = image2;</span><br><span class=\"line\">    <span class=\"built_in\">NSAttributedString</span> * attachStr2 = [<span class=\"built_in\">NSAttributedString</span> attributedStringWithAttachment:attachment2];</span><br><span class=\"line\">    [mutStr insertAttributedString:attachStr2 atIndex:<span class=\"number\">100</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//添加链接</span></span><br><span class=\"line\">    <span class=\"built_in\">NSURL</span> * url = [<span class=\"built_in\">NSURL</span> URLWithString:<span class=\"string\">@\"http://www.baidu.com\"</span>];</span><br><span class=\"line\">    [mutStr addAttribute:<span class=\"built_in\">NSLinkAttributeName</span> value:url range:<span class=\"built_in\">NSMakeRange</span>(<span class=\"number\">70</span>, <span class=\"number\">10</span>)];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">self</span>.textView.attributedText = [mutStr <span class=\"keyword\">copy</span>];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> *  设置常规属性</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)setupNormalAttribute</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSMutableAttributedString</span> * mutStr = [<span class=\"keyword\">self</span>.textView.attributedText mutableCopy];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//颜色</span></span><br><span class=\"line\">    [mutStr addAttribute:<span class=\"built_in\">NSForegroundColorAttributeName</span> value:[<span class=\"built_in\">UIColor</span> redColor] range:<span class=\"built_in\">NSMakeRange</span>(<span class=\"number\">10</span>, <span class=\"number\">10</span>)];</span><br><span class=\"line\">    <span class=\"comment\">//字体</span></span><br><span class=\"line\">    [mutStr addAttribute:<span class=\"built_in\">NSFontAttributeName</span> value:[<span class=\"built_in\">UIFont</span> systemFontOfSize:<span class=\"number\">25</span>] range:<span class=\"built_in\">NSMakeRange</span>(<span class=\"number\">20</span>, <span class=\"number\">5</span>)];</span><br><span class=\"line\">    <span class=\"comment\">//下划线</span></span><br><span class=\"line\">    [mutStr addAttribute:<span class=\"built_in\">NSUnderlineStyleAttributeName</span> value:@(<span class=\"built_in\">NSUnderlineStyleSingle</span> | <span class=\"built_in\">NSUnderlinePatternDot</span>) range:<span class=\"built_in\">NSMakeRange</span>(<span class=\"number\">32</span>, <span class=\"number\">8</span>)];</span><br><span class=\"line\">    <span class=\"comment\">//空心字</span></span><br><span class=\"line\">    [mutStr addAttribute:<span class=\"built_in\">NSStrokeWidthAttributeName</span> value:@(<span class=\"number\">2</span>) range:<span class=\"built_in\">NSMakeRange</span>(<span class=\"number\">42</span>, <span class=\"number\">5</span>)];</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.textView.attributedText = [mutStr <span class=\"keyword\">copy</span>];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> *  点击图片触发代理事件</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\">- (<span class=\"built_in\">BOOL</span>)textView:(<span class=\"built_in\">UITextView</span> *)textView shouldInteractWithTextAttachment:(<span class=\"built_in\">NSTextAttachment</span> *)textAttachment inRange:(<span class=\"built_in\">NSRange</span>)characterRange</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%@\"</span>, textAttachment);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">NO</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> *  点击链接，触发代理事件</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\">- (<span class=\"built_in\">BOOL</span>)textView:(<span class=\"built_in\">UITextView</span> *)textView shouldInteractWithURL:(<span class=\"built_in\">NSURL</span> *)URL inRange:(<span class=\"built_in\">NSRange</span>)characterRange</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    [[<span class=\"built_in\">UIApplication</span> sharedApplication] openURL:URL];</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">YES</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)didReceiveMemoryWarning &#123;</span><br><span class=\"line\">    [<span class=\"keyword\">super</span> didReceiveMemoryWarning];</span><br><span class=\"line\">    <span class=\"comment\">// Dispose of any resources that can be recreated.</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure>\n<p>图片环绕效果图：<br><img src=\"http://img.blog.csdn.net/20150403000308303\" alt=\"这里写图片描述\"></p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">\"TextKitImageTextVC.h\"</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">NSString</span> * str1 = <span class=\"string\">@\"asfasfa阿斯顿发生大发撒放大离开家撒旦法按时付款就阿里；双方均asfasdfasfdalkjsflakj阿斯顿发生大发撒旦法asdfasdfaasfdaasa撒旦法；拉斯克奖发了奥斯卡奖罚洛杉矶的法律；看见谁发的阿斯利康就发；了数据库等法律按实际开发；阿里就开始放到了；安家费阿里山科技发达了开始将对方拉开始交电费了卡双方的空间啊发送卡飞机阿里开始就放暑假了罚款就是浪费asfasfa阿斯顿发生大发撒放大离开家撒旦法按时付款就阿里；双方均asfasdfasfdalkjsflakj阿斯顿发生大发撒旦法asdfasdfaasfdaasa撒旦法；拉斯克奖发了奥斯卡奖罚洛杉矶的法律；看见谁发的阿斯利康就发；了数据库等法律按实际开发；阿里就开始放到了；安家费阿里山科技发达了开始将对方拉开始交电费了卡双方的空间啊发送卡飞机阿里开始就放暑假了罚款就是浪费asfasfa阿斯顿发生大发撒放大离开家撒旦法按时付款就阿里；双方均asfasdfasfdalkjsflakj阿斯顿发生大发撒旦法asdfasdfaasfdaasa撒旦法；拉斯克奖发了奥斯卡奖罚洛杉矶的法律；看见谁发的阿斯利康就发；了数据库等法律按实际开发；阿里就开始放到了；安家费阿里山科技发达了开始将对方拉开始交电费了卡双方的空间啊发送卡飞机阿里开始就放暑假了罚款就是浪费\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">TextKitImageTextVC</span> ()</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@property</span> (<span class=\"keyword\">nonatomic</span>, <span class=\"keyword\">strong</span>) <span class=\"built_in\">UITextView</span> * textView;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">TextKitImageTextVC</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)viewDidLoad &#123;</span><br><span class=\"line\">    [<span class=\"keyword\">super</span> viewDidLoad];</span><br><span class=\"line\">    <span class=\"comment\">// Do any additional setup after loading the view.</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">self</span>.title = <span class=\"string\">@\"文字环绕\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//初始化textLabel</span></span><br><span class=\"line\">    <span class=\"keyword\">self</span>.edgesForExtendedLayout = <span class=\"built_in\">UIRectEdgeNone</span>;</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.textView = [[<span class=\"built_in\">UITextView</span> alloc] initWithFrame:<span class=\"built_in\">CGRectMake</span>(<span class=\"number\">20</span>, <span class=\"number\">20</span>, [<span class=\"built_in\">UIScreen</span> mainScreen].bounds.size.width - <span class=\"number\">40</span>, [<span class=\"built_in\">UIScreen</span> mainScreen].bounds.size.height - <span class=\"number\">40</span> - <span class=\"number\">44</span> - <span class=\"number\">20</span>)];</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.textView.backgroundColor = [<span class=\"built_in\">UIColor</span> cyanColor];</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.textView.text = str1;</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.textView.font = [<span class=\"built_in\">UIFont</span> systemFontOfSize:<span class=\"number\">15</span>];</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.textView.editable = <span class=\"literal\">NO</span>;</span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.view addSubview:<span class=\"keyword\">self</span>.textView];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//图文混排，设置图片的位置</span></span><br><span class=\"line\">    <span class=\"built_in\">UIImageView</span> * imageView = [[<span class=\"built_in\">UIImageView</span> alloc] initWithFrame:<span class=\"built_in\">CGRectMake</span>(<span class=\"number\">120</span>, <span class=\"number\">120</span>, <span class=\"number\">100</span>, <span class=\"number\">110</span>)];</span><br><span class=\"line\">    imageView.image = [<span class=\"built_in\">UIImage</span> imageNamed:<span class=\"string\">@\"011\"</span>];</span><br><span class=\"line\">    imageView.backgroundColor = [<span class=\"built_in\">UIColor</span> redColor];</span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.view addSubview:imageView];</span><br><span class=\"line\">    <span class=\"built_in\">CGRect</span> rect = <span class=\"built_in\">CGRectMake</span>(<span class=\"number\">100</span>, <span class=\"number\">100</span>, <span class=\"number\">100</span>, <span class=\"number\">100</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//设置环绕的路径</span></span><br><span class=\"line\">    <span class=\"built_in\">UIBezierPath</span> * path = [<span class=\"built_in\">UIBezierPath</span> bezierPathWithRect:rect];</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.textView.textContainer.exclusionPaths = @[path];</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)didReceiveMemoryWarning &#123;</span><br><span class=\"line\">    [<span class=\"keyword\">super</span> didReceiveMemoryWarning];</span><br><span class=\"line\">    <span class=\"comment\">// Dispose of any resources that can be recreated.</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>TextKit极大的简化了文字排版的复杂度，但是它的缺点也很明显，就是只能在iOS7之后的系统中使用，很多需要兼容iOS7以前的系统的应用都没法使用。不过随着技术的发展，相信它的应用也会越来越广泛。</p>\n"},{"layout":"post","title":"适配iOS9（ATS问题）","_content":"\n## 前言\n今天下了XCode7 Beta版，跑了一下自家的APP，结果发现所有服务器请求都返回失败，明明网络正常，怎么会返回失败呢？起初我以为是AFNetworking的问题，于是我写了个demo，去掉AFNetworking，直接用NSURLSession请求数据，也是请求失败。于是乎一顿Google，原来是iOS9（XCode7的模拟器默认是iOS9）的新特性——ATS搞的鬼。\n\n## 简介\nATS全称为App Transport Security，它是iOS9的一个新特性，旨在提高iOS设备与服务器交互的安全性。简单地说，ATS会阻止未注册的网络请求。你可以在info.plist文件中注册相应的host，这样该host的网络请求就不会被阻止。你也可以设置不阻止任何host的网络请求。\n\n## 详细设置\n如果你想设置不阻止任何网络，只需要在info.plist文件中加入以下内容即可\n\n![这里写图片描述](http://img.blog.csdn.net/20150619164549061)\n\n如果你想设置只允许特定host的网络请求，在info.plist文件中加入以下内容\n\n![这里写图片描述](http://img.blog.csdn.net/20150619164722416)\n\n这样，你在发往`baike.baidu.com`这个host的请求就都不会被阻止了，你可以注册多个域名。\n\n## 参考资料\n[What's New in iOS9](https://developer.apple.com/library/prerelease/ios/releasenotes/General/WhatsNewIniOS/Articles/iOS9.html#//apple_ref/doc/uid/TP40016198-DontLinkElementID_13)\n[NSURLSession/NSURLConnection HTTP load failed](http://stackoverflow.com/questions/30739473/nsurlsession-nsurlconnection-http-load-failed)\n","source":"_posts/2015-10-04-适配iOS9（ATS问题）.md","raw":"---\nlayout: post\ntitle: \"适配iOS9（ATS问题）\"\ncategories: \"iOS开发\"\n---\n\n## 前言\n今天下了XCode7 Beta版，跑了一下自家的APP，结果发现所有服务器请求都返回失败，明明网络正常，怎么会返回失败呢？起初我以为是AFNetworking的问题，于是我写了个demo，去掉AFNetworking，直接用NSURLSession请求数据，也是请求失败。于是乎一顿Google，原来是iOS9（XCode7的模拟器默认是iOS9）的新特性——ATS搞的鬼。\n\n## 简介\nATS全称为App Transport Security，它是iOS9的一个新特性，旨在提高iOS设备与服务器交互的安全性。简单地说，ATS会阻止未注册的网络请求。你可以在info.plist文件中注册相应的host，这样该host的网络请求就不会被阻止。你也可以设置不阻止任何host的网络请求。\n\n## 详细设置\n如果你想设置不阻止任何网络，只需要在info.plist文件中加入以下内容即可\n\n![这里写图片描述](http://img.blog.csdn.net/20150619164549061)\n\n如果你想设置只允许特定host的网络请求，在info.plist文件中加入以下内容\n\n![这里写图片描述](http://img.blog.csdn.net/20150619164722416)\n\n这样，你在发往`baike.baidu.com`这个host的请求就都不会被阻止了，你可以注册多个域名。\n\n## 参考资料\n[What's New in iOS9](https://developer.apple.com/library/prerelease/ios/releasenotes/General/WhatsNewIniOS/Articles/iOS9.html#//apple_ref/doc/uid/TP40016198-DontLinkElementID_13)\n[NSURLSession/NSURLConnection HTTP load failed](http://stackoverflow.com/questions/30739473/nsurlsession-nsurlconnection-http-load-failed)\n","slug":"适配iOS9（ATS问题）","published":1,"date":"2015-10-03T16:00:00.000Z","updated":"2017-03-01T06:42:53.000Z","comments":1,"photos":[],"link":"","_id":"cjutyfmev000ac4c9ouo02ybj","content":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>今天下了XCode7 Beta版，跑了一下自家的APP，结果发现所有服务器请求都返回失败，明明网络正常，怎么会返回失败呢？起初我以为是AFNetworking的问题，于是我写了个demo，去掉AFNetworking，直接用NSURLSession请求数据，也是请求失败。于是乎一顿Google，原来是iOS9（XCode7的模拟器默认是iOS9）的新特性——ATS搞的鬼。</p>\n<h2 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h2><p>ATS全称为App Transport Security，它是iOS9的一个新特性，旨在提高iOS设备与服务器交互的安全性。简单地说，ATS会阻止未注册的网络请求。你可以在info.plist文件中注册相应的host，这样该host的网络请求就不会被阻止。你也可以设置不阻止任何host的网络请求。</p>\n<h2 id=\"详细设置\"><a href=\"#详细设置\" class=\"headerlink\" title=\"详细设置\"></a>详细设置</h2><p>如果你想设置不阻止任何网络，只需要在info.plist文件中加入以下内容即可</p>\n<p><img src=\"http://img.blog.csdn.net/20150619164549061\" alt=\"这里写图片描述\"></p>\n<p>如果你想设置只允许特定host的网络请求，在info.plist文件中加入以下内容</p>\n<p><img src=\"http://img.blog.csdn.net/20150619164722416\" alt=\"这里写图片描述\"></p>\n<p>这样，你在发往<code>baike.baidu.com</code>这个host的请求就都不会被阻止了，你可以注册多个域名。</p>\n<h2 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h2><p><a href=\"https://developer.apple.com/library/prerelease/ios/releasenotes/General/WhatsNewIniOS/Articles/iOS9.html#//apple_ref/doc/uid/TP40016198-DontLinkElementID_13\" target=\"_blank\" rel=\"noopener\">What’s New in iOS9</a><br><a href=\"http://stackoverflow.com/questions/30739473/nsurlsession-nsurlconnection-http-load-failed\" target=\"_blank\" rel=\"noopener\">NSURLSession/NSURLConnection HTTP load failed</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>今天下了XCode7 Beta版，跑了一下自家的APP，结果发现所有服务器请求都返回失败，明明网络正常，怎么会返回失败呢？起初我以为是AFNetworking的问题，于是我写了个demo，去掉AFNetworking，直接用NSURLSession请求数据，也是请求失败。于是乎一顿Google，原来是iOS9（XCode7的模拟器默认是iOS9）的新特性——ATS搞的鬼。</p>\n<h2 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h2><p>ATS全称为App Transport Security，它是iOS9的一个新特性，旨在提高iOS设备与服务器交互的安全性。简单地说，ATS会阻止未注册的网络请求。你可以在info.plist文件中注册相应的host，这样该host的网络请求就不会被阻止。你也可以设置不阻止任何host的网络请求。</p>\n<h2 id=\"详细设置\"><a href=\"#详细设置\" class=\"headerlink\" title=\"详细设置\"></a>详细设置</h2><p>如果你想设置不阻止任何网络，只需要在info.plist文件中加入以下内容即可</p>\n<p><img src=\"http://img.blog.csdn.net/20150619164549061\" alt=\"这里写图片描述\"></p>\n<p>如果你想设置只允许特定host的网络请求，在info.plist文件中加入以下内容</p>\n<p><img src=\"http://img.blog.csdn.net/20150619164722416\" alt=\"这里写图片描述\"></p>\n<p>这样，你在发往<code>baike.baidu.com</code>这个host的请求就都不会被阻止了，你可以注册多个域名。</p>\n<h2 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h2><p><a href=\"https://developer.apple.com/library/prerelease/ios/releasenotes/General/WhatsNewIniOS/Articles/iOS9.html#//apple_ref/doc/uid/TP40016198-DontLinkElementID_13\" target=\"_blank\" rel=\"noopener\">What’s New in iOS9</a><br><a href=\"http://stackoverflow.com/questions/30739473/nsurlsession-nsurlconnection-http-load-failed\" target=\"_blank\" rel=\"noopener\">NSURLSession/NSURLConnection HTTP load failed</a></p>\n"},{"layout":"post","title":"使用jekyll+Github Pages搭建个人博客","_content":"\n从2号决定要做博客，到现在，总共折腾了两天半，总算把这个博客整好了，这篇文章算我对这个过程的一个总结。\n\n## 准备工作\n\n1. 安装Git，熟悉Git的常用操作（必须）\n2. 注册一个Github账号，熟悉Github的操作（必须）\n3. 注册一个多说账号，可以为你的博客增加评论功能（可选）\n\n## 开始搭建个人博客\n\n1. 安装jekyll，这个网上教程很多，基本上就是先安装ruby，在安装gem，然后安装jekyll。此处就略过了，大家可以在网上找教程。\n推荐：[http://jekyll.bootcss.com/](http://jekyll.bootcss.com/)\n2. 寻找jekyll模板，当然，有能力的可以自己制作模板，推荐几个寻找模板的好地方：\n    * [jekyllthemes](http://jekyllthemes.org/)，我的模板就是在这找的\n    * [知乎：有推荐的简洁明快的jekyll模板吗？](http://www.zhihu.com/question/20223939)\n3. 把找好的模板源码下载下来，然后在Github上创建一个空项目，把模板源码上传上去，下面以我用的模板Pithy说明一下具体的过程：\n    * 下载模板源码，如下图点击Download下载源码并解压\n\n    ![image](http://oldblog.shicishuzhai.com/2015-10-04_16-46-21.jpg)\n\n    * 登录Github，创建一个空项目，取名为：<你的用户名>.github.io\n    * 然后把这个空项目clone到本地，把下载好的模板源码拷进去，然后再push到Github上，完成后的效果如下图\n\n    ![image](http://oldblog.shicishuzhai.com/2015-10-04_16-54-30.jpg)\n\n4. 修改模板内容，主要有以下几点\n    * 修改_config.yml，具体修改方法可以参照 [http://higrid.net/c-art-blog_jekyll.htm](http://higrid.net/c-art-blog_jekyll.htm#--3)\n    * 修改多说账号，这个一般在_layouts/post.html文件中，有的模板中集成了多说，你只需要更改一下shortname即可，有的模板中没有集成多说，添加如下图的代码即可\n\n    ![image](http://oldblog.shicishuzhai.com/2015-10-04_17-10-06.jpg)\n\n    * 删除_posts文件夹下的内容，这个文件夹下存放的就是你要发表的博客，大多数模板在这个文件夹中都会有几篇博客，你可以删除他们，\n    添加你自己的博客，注意文件名的命名规范：yyyy-MM-dd-博客标题.md，博客的头（两个---之间的内容）可以参考模板自带的博客，\n    把title改为自己博客的title\n5. 测试博客，此时，博客就已经搭建好了，你可以在_posts文件夹中添加新的博客\n    * 打开终端，进入博客目录，输入命令`jekyll server -w`\n    * 打开浏览器，输入`http://localhost:4000/`，这样就可以看到你的博客啦\n\n    ![image](http://oldblog.shicishuzhai.com/2015-10-04_17-25-46.jpg)\n6. 把刚才的修改push到Github上，这样你就有了一个域名为：<你的用户名>.github.io的博客\n\n## 其他的一些优化\n\n* 添加Rakefile\n    * 用常规的方法创建博客，需要在_posts文件夹下创建一个.md文件，还要符合相应的命名规范，还要手动添加文件的头，非常麻烦，\n        使用Rakefile可以直接通过命令`rake post title=\"<博客标题>\"`，直接创建一篇博客，非常便捷\n    * 很多模板不带有Rakefile, 你可以从[我的博客仓库](https://github.com/liujinlongxa/liujinlongxa.github.io)里下载Rakefile文件，\n    拷贝到自己博客的根目录下\n\n* 定制博客文件头：根据自己的需求，修改Rakefile，定制博客的头，下面是我定制的内容，默认支持标题和分类，命令格式:\n    `rake post title=\"<博客标题> categories=\"<博客分类>\"`\n\n```shell\n\n    # Usage: rake post title=\"A Title\" [categories=\"post categories\"] [date=\"2012-02-09\"]\n    desc \"Begin a new post in #{CONFIG['posts']}\"\n    task :post do\n      abort(\"rake aborted: '#{CONFIG['posts']}' directory not found.\") unless FileTest.directory?(CONFIG['posts'])\n      title = ENV[\"title\"] || \"无题\"\n      categories = ENV[\"categories\"] || \"其他\" # 添加分类参数，默认为“其他”分类\n      # slug = title.downcase.strip.gsub(' ', '-').gsub(/[^\\w-]/, '')\n      slug = title.gsub(' ', '') # 修改博客标题，使其支持中文\n      begin\n        date = (ENV['date'] ? Time.parse(ENV['date']) : Time.now).strftime('%Y-%m-%d')\n      rescue Exception => e\n        puts \"Error - date format must be YYYY-MM-DD, please check you typed it correctly!\"\n        exit -1\n      end\n      filename = File.join(CONFIG['posts'], \"#{date}-#{slug}.#{CONFIG['post_ext']}\")\n      if File.exist?(filename)\n        abort(\"rake aborted!\") if ask(\"#{filename} already exists. Do you want to overwrite?\", ['y', 'n']) == 'n'\n      end\n\n      puts \"Creating new post: #{filename}\"\n\n    # 下面就是具体的博客头的内容\n      open(filename, 'w') do |post|\n        post.puts \"---\"\n        post.puts \"layout: post\"\n        post.puts \"title: \\\"#{title.gsub(/-/,' ')}\\\"\"\n        post.puts \"categories: \\\"#{categories.gsub(/-/,' ')}\\\"\"\n        post.puts \"---\"\n      end\n    end # task :post\n```\n\n* 简化创建博客的命令：每次创建博客输入`rake post title=\"<博客标题> categories=\"<博客分类>\"`这么一长串命令还是有些繁琐，可以在`~/.zshrc`\n    文件（如果没有装Oh-my-zsh，应该是`~/.bashrc`）添加如下代码，这样，以后你就可以直接输入命令 `rpt \"<博客标题>\" \"<博客分类>\"`创建博客，\n    怎么样，是不是非常方便\n\n```shell\nrpt() {\n        rake post title=$1 categories=$2\n}\n```\n\n* 使用七牛存储图片。博客空间是有限的（200M），建议将博客中的图片上传到第三方图床上（这里推荐七牛），博客中直接使用图片的外链，\n节省博客空间。\n\n## 接下来要做的\n\n* 目前，我写博客使用的是Atom，平时都是用Xcode，这种编辑器还是第一次用，感觉它对jekyll的markdown支持的不是很好，特别是\n`% highlight objectiveC %`代码块，打算以后看看有什么解决办法，不行的话就换个编辑器\n* 当前博客使用的还是github的域名，打算以后买个独立域名\n* 最后，当然是开始写博客啦！！！！\n","source":"_posts/2015-10-04-使用jekyll+GithubPage搭建个人博客系统.md","raw":"---\nlayout: post\ntitle: \"使用jekyll+Github Pages搭建个人博客\"\ncategories: \"其他\"\n---\n\n从2号决定要做博客，到现在，总共折腾了两天半，总算把这个博客整好了，这篇文章算我对这个过程的一个总结。\n\n## 准备工作\n\n1. 安装Git，熟悉Git的常用操作（必须）\n2. 注册一个Github账号，熟悉Github的操作（必须）\n3. 注册一个多说账号，可以为你的博客增加评论功能（可选）\n\n## 开始搭建个人博客\n\n1. 安装jekyll，这个网上教程很多，基本上就是先安装ruby，在安装gem，然后安装jekyll。此处就略过了，大家可以在网上找教程。\n推荐：[http://jekyll.bootcss.com/](http://jekyll.bootcss.com/)\n2. 寻找jekyll模板，当然，有能力的可以自己制作模板，推荐几个寻找模板的好地方：\n    * [jekyllthemes](http://jekyllthemes.org/)，我的模板就是在这找的\n    * [知乎：有推荐的简洁明快的jekyll模板吗？](http://www.zhihu.com/question/20223939)\n3. 把找好的模板源码下载下来，然后在Github上创建一个空项目，把模板源码上传上去，下面以我用的模板Pithy说明一下具体的过程：\n    * 下载模板源码，如下图点击Download下载源码并解压\n\n    ![image](http://oldblog.shicishuzhai.com/2015-10-04_16-46-21.jpg)\n\n    * 登录Github，创建一个空项目，取名为：<你的用户名>.github.io\n    * 然后把这个空项目clone到本地，把下载好的模板源码拷进去，然后再push到Github上，完成后的效果如下图\n\n    ![image](http://oldblog.shicishuzhai.com/2015-10-04_16-54-30.jpg)\n\n4. 修改模板内容，主要有以下几点\n    * 修改_config.yml，具体修改方法可以参照 [http://higrid.net/c-art-blog_jekyll.htm](http://higrid.net/c-art-blog_jekyll.htm#--3)\n    * 修改多说账号，这个一般在_layouts/post.html文件中，有的模板中集成了多说，你只需要更改一下shortname即可，有的模板中没有集成多说，添加如下图的代码即可\n\n    ![image](http://oldblog.shicishuzhai.com/2015-10-04_17-10-06.jpg)\n\n    * 删除_posts文件夹下的内容，这个文件夹下存放的就是你要发表的博客，大多数模板在这个文件夹中都会有几篇博客，你可以删除他们，\n    添加你自己的博客，注意文件名的命名规范：yyyy-MM-dd-博客标题.md，博客的头（两个---之间的内容）可以参考模板自带的博客，\n    把title改为自己博客的title\n5. 测试博客，此时，博客就已经搭建好了，你可以在_posts文件夹中添加新的博客\n    * 打开终端，进入博客目录，输入命令`jekyll server -w`\n    * 打开浏览器，输入`http://localhost:4000/`，这样就可以看到你的博客啦\n\n    ![image](http://oldblog.shicishuzhai.com/2015-10-04_17-25-46.jpg)\n6. 把刚才的修改push到Github上，这样你就有了一个域名为：<你的用户名>.github.io的博客\n\n## 其他的一些优化\n\n* 添加Rakefile\n    * 用常规的方法创建博客，需要在_posts文件夹下创建一个.md文件，还要符合相应的命名规范，还要手动添加文件的头，非常麻烦，\n        使用Rakefile可以直接通过命令`rake post title=\"<博客标题>\"`，直接创建一篇博客，非常便捷\n    * 很多模板不带有Rakefile, 你可以从[我的博客仓库](https://github.com/liujinlongxa/liujinlongxa.github.io)里下载Rakefile文件，\n    拷贝到自己博客的根目录下\n\n* 定制博客文件头：根据自己的需求，修改Rakefile，定制博客的头，下面是我定制的内容，默认支持标题和分类，命令格式:\n    `rake post title=\"<博客标题> categories=\"<博客分类>\"`\n\n```shell\n\n    # Usage: rake post title=\"A Title\" [categories=\"post categories\"] [date=\"2012-02-09\"]\n    desc \"Begin a new post in #{CONFIG['posts']}\"\n    task :post do\n      abort(\"rake aborted: '#{CONFIG['posts']}' directory not found.\") unless FileTest.directory?(CONFIG['posts'])\n      title = ENV[\"title\"] || \"无题\"\n      categories = ENV[\"categories\"] || \"其他\" # 添加分类参数，默认为“其他”分类\n      # slug = title.downcase.strip.gsub(' ', '-').gsub(/[^\\w-]/, '')\n      slug = title.gsub(' ', '') # 修改博客标题，使其支持中文\n      begin\n        date = (ENV['date'] ? Time.parse(ENV['date']) : Time.now).strftime('%Y-%m-%d')\n      rescue Exception => e\n        puts \"Error - date format must be YYYY-MM-DD, please check you typed it correctly!\"\n        exit -1\n      end\n      filename = File.join(CONFIG['posts'], \"#{date}-#{slug}.#{CONFIG['post_ext']}\")\n      if File.exist?(filename)\n        abort(\"rake aborted!\") if ask(\"#{filename} already exists. Do you want to overwrite?\", ['y', 'n']) == 'n'\n      end\n\n      puts \"Creating new post: #{filename}\"\n\n    # 下面就是具体的博客头的内容\n      open(filename, 'w') do |post|\n        post.puts \"---\"\n        post.puts \"layout: post\"\n        post.puts \"title: \\\"#{title.gsub(/-/,' ')}\\\"\"\n        post.puts \"categories: \\\"#{categories.gsub(/-/,' ')}\\\"\"\n        post.puts \"---\"\n      end\n    end # task :post\n```\n\n* 简化创建博客的命令：每次创建博客输入`rake post title=\"<博客标题> categories=\"<博客分类>\"`这么一长串命令还是有些繁琐，可以在`~/.zshrc`\n    文件（如果没有装Oh-my-zsh，应该是`~/.bashrc`）添加如下代码，这样，以后你就可以直接输入命令 `rpt \"<博客标题>\" \"<博客分类>\"`创建博客，\n    怎么样，是不是非常方便\n\n```shell\nrpt() {\n        rake post title=$1 categories=$2\n}\n```\n\n* 使用七牛存储图片。博客空间是有限的（200M），建议将博客中的图片上传到第三方图床上（这里推荐七牛），博客中直接使用图片的外链，\n节省博客空间。\n\n## 接下来要做的\n\n* 目前，我写博客使用的是Atom，平时都是用Xcode，这种编辑器还是第一次用，感觉它对jekyll的markdown支持的不是很好，特别是\n`% highlight objectiveC %`代码块，打算以后看看有什么解决办法，不行的话就换个编辑器\n* 当前博客使用的还是github的域名，打算以后买个独立域名\n* 最后，当然是开始写博客啦！！！！\n","slug":"使用jekyll+GithubPage搭建个人博客系统","published":1,"date":"2015-10-03T16:00:00.000Z","updated":"2019-01-13T04:01:04.456Z","comments":1,"photos":[],"link":"","_id":"cjutyfmev000bc4c9emmaykbs","content":"<p>从2号决定要做博客，到现在，总共折腾了两天半，总算把这个博客整好了，这篇文章算我对这个过程的一个总结。</p>\n<h2 id=\"准备工作\"><a href=\"#准备工作\" class=\"headerlink\" title=\"准备工作\"></a>准备工作</h2><ol>\n<li>安装Git，熟悉Git的常用操作（必须）</li>\n<li>注册一个Github账号，熟悉Github的操作（必须）</li>\n<li>注册一个多说账号，可以为你的博客增加评论功能（可选）</li>\n</ol>\n<h2 id=\"开始搭建个人博客\"><a href=\"#开始搭建个人博客\" class=\"headerlink\" title=\"开始搭建个人博客\"></a>开始搭建个人博客</h2><ol>\n<li>安装jekyll，这个网上教程很多，基本上就是先安装ruby，在安装gem，然后安装jekyll。此处就略过了，大家可以在网上找教程。<br>推荐：<a href=\"http://jekyll.bootcss.com/\" target=\"_blank\" rel=\"noopener\">http://jekyll.bootcss.com/</a></li>\n<li>寻找jekyll模板，当然，有能力的可以自己制作模板，推荐几个寻找模板的好地方：<ul>\n<li><a href=\"http://jekyllthemes.org/\" target=\"_blank\" rel=\"noopener\">jekyllthemes</a>，我的模板就是在这找的</li>\n<li><a href=\"http://www.zhihu.com/question/20223939\" target=\"_blank\" rel=\"noopener\">知乎：有推荐的简洁明快的jekyll模板吗？</a></li>\n</ul>\n</li>\n<li><p>把找好的模板源码下载下来，然后在Github上创建一个空项目，把模板源码上传上去，下面以我用的模板Pithy说明一下具体的过程：</p>\n<ul>\n<li><p>下载模板源码，如下图点击Download下载源码并解压</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/2015-10-04_16-46-21.jpg\" alt=\"image\"></p>\n</li>\n<li><p>登录Github，创建一个空项目，取名为：&lt;你的用户名&gt;.github.io</p>\n</li>\n<li><p>然后把这个空项目clone到本地，把下载好的模板源码拷进去，然后再push到Github上，完成后的效果如下图</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/2015-10-04_16-54-30.jpg\" alt=\"image\"></p>\n</li>\n</ul>\n</li>\n<li><p>修改模板内容，主要有以下几点</p>\n<ul>\n<li>修改_config.yml，具体修改方法可以参照 <a href=\"http://higrid.net/c-art-blog_jekyll.htm#--3\" target=\"_blank\" rel=\"noopener\">http://higrid.net/c-art-blog_jekyll.htm</a></li>\n<li><p>修改多说账号，这个一般在_layouts/post.html文件中，有的模板中集成了多说，你只需要更改一下shortname即可，有的模板中没有集成多说，添加如下图的代码即可</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/2015-10-04_17-10-06.jpg\" alt=\"image\"></p>\n</li>\n<li><p>删除_posts文件夹下的内容，这个文件夹下存放的就是你要发表的博客，大多数模板在这个文件夹中都会有几篇博客，你可以删除他们，<br>添加你自己的博客，注意文件名的命名规范：yyyy-MM-dd-博客标题.md，博客的头（两个—之间的内容）可以参考模板自带的博客，<br>把title改为自己博客的title</p>\n</li>\n</ul>\n</li>\n<li><p>测试博客，此时，博客就已经搭建好了，你可以在_posts文件夹中添加新的博客</p>\n<ul>\n<li>打开终端，进入博客目录，输入命令<code>jekyll server -w</code></li>\n<li><p>打开浏览器，输入<code>http://localhost:4000/</code>，这样就可以看到你的博客啦</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/2015-10-04_17-25-46.jpg\" alt=\"image\"></p>\n</li>\n</ul>\n</li>\n<li>把刚才的修改push到Github上，这样你就有了一个域名为：&lt;你的用户名&gt;.github.io的博客</li>\n</ol>\n<h2 id=\"其他的一些优化\"><a href=\"#其他的一些优化\" class=\"headerlink\" title=\"其他的一些优化\"></a>其他的一些优化</h2><ul>\n<li><p>添加Rakefile</p>\n<ul>\n<li>用常规的方法创建博客，需要在_posts文件夹下创建一个.md文件，还要符合相应的命名规范，还要手动添加文件的头，非常麻烦，<br>  使用Rakefile可以直接通过命令<code>rake post title=&quot;&lt;博客标题&gt;&quot;</code>，直接创建一篇博客，非常便捷</li>\n<li>很多模板不带有Rakefile, 你可以从<a href=\"https://github.com/liujinlongxa/liujinlongxa.github.io\" target=\"_blank\" rel=\"noopener\">我的博客仓库</a>里下载Rakefile文件，<br>拷贝到自己博客的根目录下</li>\n</ul>\n</li>\n<li><p>定制博客文件头：根据自己的需求，修改Rakefile，定制博客的头，下面是我定制的内容，默认支持标题和分类，命令格式:<br>  <code>rake post title=&quot;&lt;博客标题&gt; categories=&quot;&lt;博客分类&gt;&quot;</code></p>\n</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span> Usage: rake post title=\"A Title\" [categories=\"post categories\"] [date=\"2012-02-09\"]</span><br><span class=\"line\">desc \"Begin a new post in #&#123;CONFIG['posts']&#125;\"</span><br><span class=\"line\">task :post do</span><br><span class=\"line\">  abort(\"rake aborted: '#&#123;CONFIG['posts']&#125;' directory not found.\") unless FileTest.directory?(CONFIG['posts'])</span><br><span class=\"line\">  title = ENV[\"title\"] || \"无题\"</span><br><span class=\"line\">  categories = ENV[\"categories\"] || \"其他\" # 添加分类参数，默认为“其他”分类</span><br><span class=\"line\"><span class=\"meta\">  #</span> slug = title.downcase.strip.gsub(' ', '-').gsub(/[^\\w-]/, '')</span><br><span class=\"line\">  slug = title.gsub(' ', '') # 修改博客标题，使其支持中文</span><br><span class=\"line\">  begin</span><br><span class=\"line\">    date = (ENV['date'] ? Time.parse(ENV['date']) : Time.now).strftime('%Y-%m-%d')</span><br><span class=\"line\">  rescue Exception =&gt; e</span><br><span class=\"line\">    puts \"Error - date format must be YYYY-MM-DD, please check you typed it correctly!\"</span><br><span class=\"line\">    exit -1</span><br><span class=\"line\">  end</span><br><span class=\"line\">  filename = File.join(CONFIG['posts'], \"#&#123;date&#125;-#&#123;slug&#125;.#&#123;CONFIG['post_ext']&#125;\")</span><br><span class=\"line\">  if File.exist?(filename)</span><br><span class=\"line\">    abort(\"rake aborted!\") if ask(\"#&#123;filename&#125; already exists. Do you want to overwrite?\", ['y', 'n']) == 'n'</span><br><span class=\"line\">  end</span><br><span class=\"line\"></span><br><span class=\"line\">  puts \"Creating new post: #&#123;filename&#125;\"</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span> 下面就是具体的博客头的内容</span><br><span class=\"line\">  open(filename, 'w') do |post|</span><br><span class=\"line\">    post.puts \"---\"</span><br><span class=\"line\">    post.puts \"layout: post\"</span><br><span class=\"line\">    post.puts \"title: \\\"#&#123;title.gsub(/-/,' ')&#125;\\\"\"</span><br><span class=\"line\">    post.puts \"categories: \\\"#&#123;categories.gsub(/-/,' ')&#125;\\\"\"</span><br><span class=\"line\">    post.puts \"---\"</span><br><span class=\"line\">  end</span><br><span class=\"line\">end # task :post</span><br></pre></td></tr></table></figure>\n<ul>\n<li>简化创建博客的命令：每次创建博客输入<code>rake post title=&quot;&lt;博客标题&gt; categories=&quot;&lt;博客分类&gt;&quot;</code>这么一长串命令还是有些繁琐，可以在<code>~/.zshrc</code><br>  文件（如果没有装Oh-my-zsh，应该是<code>~/.bashrc</code>）添加如下代码，这样，以后你就可以直接输入命令 <code>rpt &quot;&lt;博客标题&gt;&quot; &quot;&lt;博客分类&gt;&quot;</code>创建博客，<br>  怎么样，是不是非常方便</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpt() &#123;</span><br><span class=\"line\">        rake post title=$1 categories=$2</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>使用七牛存储图片。博客空间是有限的（200M），建议将博客中的图片上传到第三方图床上（这里推荐七牛），博客中直接使用图片的外链，<br>节省博客空间。</li>\n</ul>\n<h2 id=\"接下来要做的\"><a href=\"#接下来要做的\" class=\"headerlink\" title=\"接下来要做的\"></a>接下来要做的</h2><ul>\n<li>目前，我写博客使用的是Atom，平时都是用Xcode，这种编辑器还是第一次用，感觉它对jekyll的markdown支持的不是很好，特别是<br><code>% highlight objectiveC %</code>代码块，打算以后看看有什么解决办法，不行的话就换个编辑器</li>\n<li>当前博客使用的还是github的域名，打算以后买个独立域名</li>\n<li>最后，当然是开始写博客啦！！！！</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<p>从2号决定要做博客，到现在，总共折腾了两天半，总算把这个博客整好了，这篇文章算我对这个过程的一个总结。</p>\n<h2 id=\"准备工作\"><a href=\"#准备工作\" class=\"headerlink\" title=\"准备工作\"></a>准备工作</h2><ol>\n<li>安装Git，熟悉Git的常用操作（必须）</li>\n<li>注册一个Github账号，熟悉Github的操作（必须）</li>\n<li>注册一个多说账号，可以为你的博客增加评论功能（可选）</li>\n</ol>\n<h2 id=\"开始搭建个人博客\"><a href=\"#开始搭建个人博客\" class=\"headerlink\" title=\"开始搭建个人博客\"></a>开始搭建个人博客</h2><ol>\n<li>安装jekyll，这个网上教程很多，基本上就是先安装ruby，在安装gem，然后安装jekyll。此处就略过了，大家可以在网上找教程。<br>推荐：<a href=\"http://jekyll.bootcss.com/\" target=\"_blank\" rel=\"noopener\">http://jekyll.bootcss.com/</a></li>\n<li>寻找jekyll模板，当然，有能力的可以自己制作模板，推荐几个寻找模板的好地方：<ul>\n<li><a href=\"http://jekyllthemes.org/\" target=\"_blank\" rel=\"noopener\">jekyllthemes</a>，我的模板就是在这找的</li>\n<li><a href=\"http://www.zhihu.com/question/20223939\" target=\"_blank\" rel=\"noopener\">知乎：有推荐的简洁明快的jekyll模板吗？</a></li>\n</ul>\n</li>\n<li><p>把找好的模板源码下载下来，然后在Github上创建一个空项目，把模板源码上传上去，下面以我用的模板Pithy说明一下具体的过程：</p>\n<ul>\n<li><p>下载模板源码，如下图点击Download下载源码并解压</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/2015-10-04_16-46-21.jpg\" alt=\"image\"></p>\n</li>\n<li><p>登录Github，创建一个空项目，取名为：&lt;你的用户名&gt;.github.io</p>\n</li>\n<li><p>然后把这个空项目clone到本地，把下载好的模板源码拷进去，然后再push到Github上，完成后的效果如下图</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/2015-10-04_16-54-30.jpg\" alt=\"image\"></p>\n</li>\n</ul>\n</li>\n<li><p>修改模板内容，主要有以下几点</p>\n<ul>\n<li>修改_config.yml，具体修改方法可以参照 <a href=\"http://higrid.net/c-art-blog_jekyll.htm#--3\" target=\"_blank\" rel=\"noopener\">http://higrid.net/c-art-blog_jekyll.htm</a></li>\n<li><p>修改多说账号，这个一般在_layouts/post.html文件中，有的模板中集成了多说，你只需要更改一下shortname即可，有的模板中没有集成多说，添加如下图的代码即可</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/2015-10-04_17-10-06.jpg\" alt=\"image\"></p>\n</li>\n<li><p>删除_posts文件夹下的内容，这个文件夹下存放的就是你要发表的博客，大多数模板在这个文件夹中都会有几篇博客，你可以删除他们，<br>添加你自己的博客，注意文件名的命名规范：yyyy-MM-dd-博客标题.md，博客的头（两个—之间的内容）可以参考模板自带的博客，<br>把title改为自己博客的title</p>\n</li>\n</ul>\n</li>\n<li><p>测试博客，此时，博客就已经搭建好了，你可以在_posts文件夹中添加新的博客</p>\n<ul>\n<li>打开终端，进入博客目录，输入命令<code>jekyll server -w</code></li>\n<li><p>打开浏览器，输入<code>http://localhost:4000/</code>，这样就可以看到你的博客啦</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/2015-10-04_17-25-46.jpg\" alt=\"image\"></p>\n</li>\n</ul>\n</li>\n<li>把刚才的修改push到Github上，这样你就有了一个域名为：&lt;你的用户名&gt;.github.io的博客</li>\n</ol>\n<h2 id=\"其他的一些优化\"><a href=\"#其他的一些优化\" class=\"headerlink\" title=\"其他的一些优化\"></a>其他的一些优化</h2><ul>\n<li><p>添加Rakefile</p>\n<ul>\n<li>用常规的方法创建博客，需要在_posts文件夹下创建一个.md文件，还要符合相应的命名规范，还要手动添加文件的头，非常麻烦，<br>  使用Rakefile可以直接通过命令<code>rake post title=&quot;&lt;博客标题&gt;&quot;</code>，直接创建一篇博客，非常便捷</li>\n<li>很多模板不带有Rakefile, 你可以从<a href=\"https://github.com/liujinlongxa/liujinlongxa.github.io\" target=\"_blank\" rel=\"noopener\">我的博客仓库</a>里下载Rakefile文件，<br>拷贝到自己博客的根目录下</li>\n</ul>\n</li>\n<li><p>定制博客文件头：根据自己的需求，修改Rakefile，定制博客的头，下面是我定制的内容，默认支持标题和分类，命令格式:<br>  <code>rake post title=&quot;&lt;博客标题&gt; categories=&quot;&lt;博客分类&gt;&quot;</code></p>\n</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span> Usage: rake post title=\"A Title\" [categories=\"post categories\"] [date=\"2012-02-09\"]</span><br><span class=\"line\">desc \"Begin a new post in #&#123;CONFIG['posts']&#125;\"</span><br><span class=\"line\">task :post do</span><br><span class=\"line\">  abort(\"rake aborted: '#&#123;CONFIG['posts']&#125;' directory not found.\") unless FileTest.directory?(CONFIG['posts'])</span><br><span class=\"line\">  title = ENV[\"title\"] || \"无题\"</span><br><span class=\"line\">  categories = ENV[\"categories\"] || \"其他\" # 添加分类参数，默认为“其他”分类</span><br><span class=\"line\"><span class=\"meta\">  #</span> slug = title.downcase.strip.gsub(' ', '-').gsub(/[^\\w-]/, '')</span><br><span class=\"line\">  slug = title.gsub(' ', '') # 修改博客标题，使其支持中文</span><br><span class=\"line\">  begin</span><br><span class=\"line\">    date = (ENV['date'] ? Time.parse(ENV['date']) : Time.now).strftime('%Y-%m-%d')</span><br><span class=\"line\">  rescue Exception =&gt; e</span><br><span class=\"line\">    puts \"Error - date format must be YYYY-MM-DD, please check you typed it correctly!\"</span><br><span class=\"line\">    exit -1</span><br><span class=\"line\">  end</span><br><span class=\"line\">  filename = File.join(CONFIG['posts'], \"#&#123;date&#125;-#&#123;slug&#125;.#&#123;CONFIG['post_ext']&#125;\")</span><br><span class=\"line\">  if File.exist?(filename)</span><br><span class=\"line\">    abort(\"rake aborted!\") if ask(\"#&#123;filename&#125; already exists. Do you want to overwrite?\", ['y', 'n']) == 'n'</span><br><span class=\"line\">  end</span><br><span class=\"line\"></span><br><span class=\"line\">  puts \"Creating new post: #&#123;filename&#125;\"</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span> 下面就是具体的博客头的内容</span><br><span class=\"line\">  open(filename, 'w') do |post|</span><br><span class=\"line\">    post.puts \"---\"</span><br><span class=\"line\">    post.puts \"layout: post\"</span><br><span class=\"line\">    post.puts \"title: \\\"#&#123;title.gsub(/-/,' ')&#125;\\\"\"</span><br><span class=\"line\">    post.puts \"categories: \\\"#&#123;categories.gsub(/-/,' ')&#125;\\\"\"</span><br><span class=\"line\">    post.puts \"---\"</span><br><span class=\"line\">  end</span><br><span class=\"line\">end # task :post</span><br></pre></td></tr></table></figure>\n<ul>\n<li>简化创建博客的命令：每次创建博客输入<code>rake post title=&quot;&lt;博客标题&gt; categories=&quot;&lt;博客分类&gt;&quot;</code>这么一长串命令还是有些繁琐，可以在<code>~/.zshrc</code><br>  文件（如果没有装Oh-my-zsh，应该是<code>~/.bashrc</code>）添加如下代码，这样，以后你就可以直接输入命令 <code>rpt &quot;&lt;博客标题&gt;&quot; &quot;&lt;博客分类&gt;&quot;</code>创建博客，<br>  怎么样，是不是非常方便</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpt() &#123;</span><br><span class=\"line\">        rake post title=$1 categories=$2</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>使用七牛存储图片。博客空间是有限的（200M），建议将博客中的图片上传到第三方图床上（这里推荐七牛），博客中直接使用图片的外链，<br>节省博客空间。</li>\n</ul>\n<h2 id=\"接下来要做的\"><a href=\"#接下来要做的\" class=\"headerlink\" title=\"接下来要做的\"></a>接下来要做的</h2><ul>\n<li>目前，我写博客使用的是Atom，平时都是用Xcode，这种编辑器还是第一次用，感觉它对jekyll的markdown支持的不是很好，特别是<br><code>% highlight objectiveC %</code>代码块，打算以后看看有什么解决办法，不行的话就换个编辑器</li>\n<li>当前博客使用的还是github的域名，打算以后买个独立域名</li>\n<li>最后，当然是开始写博客啦！！！！</li>\n</ul>\n"},{"layout":"post","title":"《图解HTTP》读书笔记(1)","_content":"\n* toc\n{:toc}\n\n## 第一章 了解web及网络基础\n\n### TCP/IP协议族\n\n通常使用的网络（包括互联网）实在TCP/IP协议族的基础上运作的，而HTTP属于它内部的一个子集。\n\n**协议(protocol)** ： 不同硬件、操作系统之间的通信规则\n\n#### TCP/IP的分层管理\n\n发送端逐层向下传输，接收端逐层向上传输。发送端每经过一层传输，需要加上该层的头部信息，\n接收端需要进行拆包，去掉头部信息。\n\n* 应用层：决定了向用户提供应用服务时通信的活动。FTP，DNS，HTTP都属于这一层\n* 传输层：提供网络连接中两台计算机之间的数据传输。TCP和UDP属于这一层。\n* 网络层：又称网络互联层，处理网络上流动的数据包。\n* 链路层：又称数据链路层，处理链接网络的硬件部分。\n\n### 与HTTP关系密切的协议：IP，TCP和DNS\n\n#### 1.负责传输的IP协议\n\nIP协议（网际协议，Internet Protocol）属于网络层。IP协议和IP地址是不同的概念。\nIP协议的作用是把各种数据包传送给对方。传送需要满足两个条件，IP地址和MAC地址。\n\n* IP地址指明了节点被分配到的地址\n* MAC地址是指网卡所属的固定地址\n\n#### 2.保证可靠性的TCP协议\n\nTCP协议位于传输层，提供可靠的字节流服务。\n\n* 字节流服务：将大块数据分割成以报文段为单位的数据包进行管理\n* 可靠：通过一些手段确保信息准确无误的传输\n\n**三次握手** 确保通信的可靠性\n\n#### 3.负责域名解析的DNS服务\n\nDNS属于应用层协议，它提供域名到IP之间的解析服务。\n\n#### 4.URI和URL\n\n* URI：统一资源标识符，用字符串标识互联网上的某一资源\n    * URI的格式：`http://user:pass@www.example.jp:80/dir/index.htm?uid=1#ch1`\n\n* URL：统一资源定位符，互联网上某一资源的位置，他是URI的子集\n\n## 第二章 简单的HTTP协议\n\n### 请求与响应\n\n每次HTTP通信都是客户端发起请求，服务器返回响应\n\n### HTTP是不保存状态的协议\n\nHTTP是无状态协议，它自身不对请求和响应之间的通信状态进行保存。为了实现状态保存，例如用户的登录状态保存，引入的Cookie技术。\n\n### HTTP方法\n\n* GET方法：获取资源\n* POST方法：传输实体主体\n* PUT方法：传输文件，存在安全问题，一般网站不使用该方法\n* HEAD方法：获取报文首部，与GET方法一样，只不过不返回报文主体部分\n* DELETE方法：删除文件，存在安全问题，一般网站不使用该方法\n* OPTIONS方法：询问支持的方法\n* TRACE方法：追踪路径，可查询发出的请求是怎么被加工修改、篡改的，可追踪代理服务器中转请求时对请求的修改，不常用\n* CONNECT方法：要求使用隧道协议链接代理，主要使用SSL和TLS协议把通信内容加密后经网络隧道传输。\n\n### 持久链接和管线化\n\n* **持久链接**\n所谓的持久链接就是在客户端和服务器建立TCP链接后，只要任何一方都没有提出中断链接，TCP链接就不会断。在HTTP1.0中，每个HTTP请求都要重新建立TCP链接，传输完成后，再断开\n链接，在HTTP1.1中，默认所有的请求都是持久链接，只需要链接一次，就可以一直保持这个链接，这样就大大减少了建立链接的开销，提高页面的显示速度。\n* **管线化**\n所谓的管线化就是发送一个请求后，不需要等到响应返回，就可以发送下一个请求\n\n### 使用Cookie的状态管理\n\nCookie会根据服务器发送响应报文内的一个叫做Set-Cookie的首部字段信息，通知客户端保存Cookie，当下次客户端再往该服务器发送请求时，客户端会自动在请求报文中加入Cookie值，\n这样服务器就会获取客户端的状态。\n","source":"_posts/2015-10-05-《图解HTTP》读书笔记(1).md","raw":"---\nlayout: post\ntitle: \"《图解HTTP》读书笔记(1)\"\ncategories: \"读书笔记\"\n---\n\n* toc\n{:toc}\n\n## 第一章 了解web及网络基础\n\n### TCP/IP协议族\n\n通常使用的网络（包括互联网）实在TCP/IP协议族的基础上运作的，而HTTP属于它内部的一个子集。\n\n**协议(protocol)** ： 不同硬件、操作系统之间的通信规则\n\n#### TCP/IP的分层管理\n\n发送端逐层向下传输，接收端逐层向上传输。发送端每经过一层传输，需要加上该层的头部信息，\n接收端需要进行拆包，去掉头部信息。\n\n* 应用层：决定了向用户提供应用服务时通信的活动。FTP，DNS，HTTP都属于这一层\n* 传输层：提供网络连接中两台计算机之间的数据传输。TCP和UDP属于这一层。\n* 网络层：又称网络互联层，处理网络上流动的数据包。\n* 链路层：又称数据链路层，处理链接网络的硬件部分。\n\n### 与HTTP关系密切的协议：IP，TCP和DNS\n\n#### 1.负责传输的IP协议\n\nIP协议（网际协议，Internet Protocol）属于网络层。IP协议和IP地址是不同的概念。\nIP协议的作用是把各种数据包传送给对方。传送需要满足两个条件，IP地址和MAC地址。\n\n* IP地址指明了节点被分配到的地址\n* MAC地址是指网卡所属的固定地址\n\n#### 2.保证可靠性的TCP协议\n\nTCP协议位于传输层，提供可靠的字节流服务。\n\n* 字节流服务：将大块数据分割成以报文段为单位的数据包进行管理\n* 可靠：通过一些手段确保信息准确无误的传输\n\n**三次握手** 确保通信的可靠性\n\n#### 3.负责域名解析的DNS服务\n\nDNS属于应用层协议，它提供域名到IP之间的解析服务。\n\n#### 4.URI和URL\n\n* URI：统一资源标识符，用字符串标识互联网上的某一资源\n    * URI的格式：`http://user:pass@www.example.jp:80/dir/index.htm?uid=1#ch1`\n\n* URL：统一资源定位符，互联网上某一资源的位置，他是URI的子集\n\n## 第二章 简单的HTTP协议\n\n### 请求与响应\n\n每次HTTP通信都是客户端发起请求，服务器返回响应\n\n### HTTP是不保存状态的协议\n\nHTTP是无状态协议，它自身不对请求和响应之间的通信状态进行保存。为了实现状态保存，例如用户的登录状态保存，引入的Cookie技术。\n\n### HTTP方法\n\n* GET方法：获取资源\n* POST方法：传输实体主体\n* PUT方法：传输文件，存在安全问题，一般网站不使用该方法\n* HEAD方法：获取报文首部，与GET方法一样，只不过不返回报文主体部分\n* DELETE方法：删除文件，存在安全问题，一般网站不使用该方法\n* OPTIONS方法：询问支持的方法\n* TRACE方法：追踪路径，可查询发出的请求是怎么被加工修改、篡改的，可追踪代理服务器中转请求时对请求的修改，不常用\n* CONNECT方法：要求使用隧道协议链接代理，主要使用SSL和TLS协议把通信内容加密后经网络隧道传输。\n\n### 持久链接和管线化\n\n* **持久链接**\n所谓的持久链接就是在客户端和服务器建立TCP链接后，只要任何一方都没有提出中断链接，TCP链接就不会断。在HTTP1.0中，每个HTTP请求都要重新建立TCP链接，传输完成后，再断开\n链接，在HTTP1.1中，默认所有的请求都是持久链接，只需要链接一次，就可以一直保持这个链接，这样就大大减少了建立链接的开销，提高页面的显示速度。\n* **管线化**\n所谓的管线化就是发送一个请求后，不需要等到响应返回，就可以发送下一个请求\n\n### 使用Cookie的状态管理\n\nCookie会根据服务器发送响应报文内的一个叫做Set-Cookie的首部字段信息，通知客户端保存Cookie，当下次客户端再往该服务器发送请求时，客户端会自动在请求报文中加入Cookie值，\n这样服务器就会获取客户端的状态。\n","slug":"《图解HTTP》读书笔记(1)","published":1,"date":"2015-10-04T16:00:00.000Z","updated":"2017-03-01T06:42:53.000Z","comments":1,"photos":[],"link":"","_id":"cjutyfmex000ec4c9st4o2ib4","content":"<ul>\n<li>toc<br>{:toc}</li>\n</ul>\n<h2 id=\"第一章-了解web及网络基础\"><a href=\"#第一章-了解web及网络基础\" class=\"headerlink\" title=\"第一章 了解web及网络基础\"></a>第一章 了解web及网络基础</h2><h3 id=\"TCP-IP协议族\"><a href=\"#TCP-IP协议族\" class=\"headerlink\" title=\"TCP/IP协议族\"></a>TCP/IP协议族</h3><p>通常使用的网络（包括互联网）实在TCP/IP协议族的基础上运作的，而HTTP属于它内部的一个子集。</p>\n<p><strong>协议(protocol)</strong> ： 不同硬件、操作系统之间的通信规则</p>\n<h4 id=\"TCP-IP的分层管理\"><a href=\"#TCP-IP的分层管理\" class=\"headerlink\" title=\"TCP/IP的分层管理\"></a>TCP/IP的分层管理</h4><p>发送端逐层向下传输，接收端逐层向上传输。发送端每经过一层传输，需要加上该层的头部信息，<br>接收端需要进行拆包，去掉头部信息。</p>\n<ul>\n<li>应用层：决定了向用户提供应用服务时通信的活动。FTP，DNS，HTTP都属于这一层</li>\n<li>传输层：提供网络连接中两台计算机之间的数据传输。TCP和UDP属于这一层。</li>\n<li>网络层：又称网络互联层，处理网络上流动的数据包。</li>\n<li>链路层：又称数据链路层，处理链接网络的硬件部分。</li>\n</ul>\n<h3 id=\"与HTTP关系密切的协议：IP，TCP和DNS\"><a href=\"#与HTTP关系密切的协议：IP，TCP和DNS\" class=\"headerlink\" title=\"与HTTP关系密切的协议：IP，TCP和DNS\"></a>与HTTP关系密切的协议：IP，TCP和DNS</h3><h4 id=\"1-负责传输的IP协议\"><a href=\"#1-负责传输的IP协议\" class=\"headerlink\" title=\"1.负责传输的IP协议\"></a>1.负责传输的IP协议</h4><p>IP协议（网际协议，Internet Protocol）属于网络层。IP协议和IP地址是不同的概念。<br>IP协议的作用是把各种数据包传送给对方。传送需要满足两个条件，IP地址和MAC地址。</p>\n<ul>\n<li>IP地址指明了节点被分配到的地址</li>\n<li>MAC地址是指网卡所属的固定地址</li>\n</ul>\n<h4 id=\"2-保证可靠性的TCP协议\"><a href=\"#2-保证可靠性的TCP协议\" class=\"headerlink\" title=\"2.保证可靠性的TCP协议\"></a>2.保证可靠性的TCP协议</h4><p>TCP协议位于传输层，提供可靠的字节流服务。</p>\n<ul>\n<li>字节流服务：将大块数据分割成以报文段为单位的数据包进行管理</li>\n<li>可靠：通过一些手段确保信息准确无误的传输</li>\n</ul>\n<p><strong>三次握手</strong> 确保通信的可靠性</p>\n<h4 id=\"3-负责域名解析的DNS服务\"><a href=\"#3-负责域名解析的DNS服务\" class=\"headerlink\" title=\"3.负责域名解析的DNS服务\"></a>3.负责域名解析的DNS服务</h4><p>DNS属于应用层协议，它提供域名到IP之间的解析服务。</p>\n<h4 id=\"4-URI和URL\"><a href=\"#4-URI和URL\" class=\"headerlink\" title=\"4.URI和URL\"></a>4.URI和URL</h4><ul>\n<li><p>URI：统一资源标识符，用字符串标识互联网上的某一资源</p>\n<ul>\n<li>URI的格式：<code>http://user:pass@www.example.jp:80/dir/index.htm?uid=1#ch1</code></li>\n</ul>\n</li>\n<li><p>URL：统一资源定位符，互联网上某一资源的位置，他是URI的子集</p>\n</li>\n</ul>\n<h2 id=\"第二章-简单的HTTP协议\"><a href=\"#第二章-简单的HTTP协议\" class=\"headerlink\" title=\"第二章 简单的HTTP协议\"></a>第二章 简单的HTTP协议</h2><h3 id=\"请求与响应\"><a href=\"#请求与响应\" class=\"headerlink\" title=\"请求与响应\"></a>请求与响应</h3><p>每次HTTP通信都是客户端发起请求，服务器返回响应</p>\n<h3 id=\"HTTP是不保存状态的协议\"><a href=\"#HTTP是不保存状态的协议\" class=\"headerlink\" title=\"HTTP是不保存状态的协议\"></a>HTTP是不保存状态的协议</h3><p>HTTP是无状态协议，它自身不对请求和响应之间的通信状态进行保存。为了实现状态保存，例如用户的登录状态保存，引入的Cookie技术。</p>\n<h3 id=\"HTTP方法\"><a href=\"#HTTP方法\" class=\"headerlink\" title=\"HTTP方法\"></a>HTTP方法</h3><ul>\n<li>GET方法：获取资源</li>\n<li>POST方法：传输实体主体</li>\n<li>PUT方法：传输文件，存在安全问题，一般网站不使用该方法</li>\n<li>HEAD方法：获取报文首部，与GET方法一样，只不过不返回报文主体部分</li>\n<li>DELETE方法：删除文件，存在安全问题，一般网站不使用该方法</li>\n<li>OPTIONS方法：询问支持的方法</li>\n<li>TRACE方法：追踪路径，可查询发出的请求是怎么被加工修改、篡改的，可追踪代理服务器中转请求时对请求的修改，不常用</li>\n<li>CONNECT方法：要求使用隧道协议链接代理，主要使用SSL和TLS协议把通信内容加密后经网络隧道传输。</li>\n</ul>\n<h3 id=\"持久链接和管线化\"><a href=\"#持久链接和管线化\" class=\"headerlink\" title=\"持久链接和管线化\"></a>持久链接和管线化</h3><ul>\n<li><strong>持久链接</strong><br>所谓的持久链接就是在客户端和服务器建立TCP链接后，只要任何一方都没有提出中断链接，TCP链接就不会断。在HTTP1.0中，每个HTTP请求都要重新建立TCP链接，传输完成后，再断开<br>链接，在HTTP1.1中，默认所有的请求都是持久链接，只需要链接一次，就可以一直保持这个链接，这样就大大减少了建立链接的开销，提高页面的显示速度。</li>\n<li><strong>管线化</strong><br>所谓的管线化就是发送一个请求后，不需要等到响应返回，就可以发送下一个请求</li>\n</ul>\n<h3 id=\"使用Cookie的状态管理\"><a href=\"#使用Cookie的状态管理\" class=\"headerlink\" title=\"使用Cookie的状态管理\"></a>使用Cookie的状态管理</h3><p>Cookie会根据服务器发送响应报文内的一个叫做Set-Cookie的首部字段信息，通知客户端保存Cookie，当下次客户端再往该服务器发送请求时，客户端会自动在请求报文中加入Cookie值，<br>这样服务器就会获取客户端的状态。</p>\n","site":{"data":{}},"excerpt":"","more":"<ul>\n<li>toc<br>{:toc}</li>\n</ul>\n<h2 id=\"第一章-了解web及网络基础\"><a href=\"#第一章-了解web及网络基础\" class=\"headerlink\" title=\"第一章 了解web及网络基础\"></a>第一章 了解web及网络基础</h2><h3 id=\"TCP-IP协议族\"><a href=\"#TCP-IP协议族\" class=\"headerlink\" title=\"TCP/IP协议族\"></a>TCP/IP协议族</h3><p>通常使用的网络（包括互联网）实在TCP/IP协议族的基础上运作的，而HTTP属于它内部的一个子集。</p>\n<p><strong>协议(protocol)</strong> ： 不同硬件、操作系统之间的通信规则</p>\n<h4 id=\"TCP-IP的分层管理\"><a href=\"#TCP-IP的分层管理\" class=\"headerlink\" title=\"TCP/IP的分层管理\"></a>TCP/IP的分层管理</h4><p>发送端逐层向下传输，接收端逐层向上传输。发送端每经过一层传输，需要加上该层的头部信息，<br>接收端需要进行拆包，去掉头部信息。</p>\n<ul>\n<li>应用层：决定了向用户提供应用服务时通信的活动。FTP，DNS，HTTP都属于这一层</li>\n<li>传输层：提供网络连接中两台计算机之间的数据传输。TCP和UDP属于这一层。</li>\n<li>网络层：又称网络互联层，处理网络上流动的数据包。</li>\n<li>链路层：又称数据链路层，处理链接网络的硬件部分。</li>\n</ul>\n<h3 id=\"与HTTP关系密切的协议：IP，TCP和DNS\"><a href=\"#与HTTP关系密切的协议：IP，TCP和DNS\" class=\"headerlink\" title=\"与HTTP关系密切的协议：IP，TCP和DNS\"></a>与HTTP关系密切的协议：IP，TCP和DNS</h3><h4 id=\"1-负责传输的IP协议\"><a href=\"#1-负责传输的IP协议\" class=\"headerlink\" title=\"1.负责传输的IP协议\"></a>1.负责传输的IP协议</h4><p>IP协议（网际协议，Internet Protocol）属于网络层。IP协议和IP地址是不同的概念。<br>IP协议的作用是把各种数据包传送给对方。传送需要满足两个条件，IP地址和MAC地址。</p>\n<ul>\n<li>IP地址指明了节点被分配到的地址</li>\n<li>MAC地址是指网卡所属的固定地址</li>\n</ul>\n<h4 id=\"2-保证可靠性的TCP协议\"><a href=\"#2-保证可靠性的TCP协议\" class=\"headerlink\" title=\"2.保证可靠性的TCP协议\"></a>2.保证可靠性的TCP协议</h4><p>TCP协议位于传输层，提供可靠的字节流服务。</p>\n<ul>\n<li>字节流服务：将大块数据分割成以报文段为单位的数据包进行管理</li>\n<li>可靠：通过一些手段确保信息准确无误的传输</li>\n</ul>\n<p><strong>三次握手</strong> 确保通信的可靠性</p>\n<h4 id=\"3-负责域名解析的DNS服务\"><a href=\"#3-负责域名解析的DNS服务\" class=\"headerlink\" title=\"3.负责域名解析的DNS服务\"></a>3.负责域名解析的DNS服务</h4><p>DNS属于应用层协议，它提供域名到IP之间的解析服务。</p>\n<h4 id=\"4-URI和URL\"><a href=\"#4-URI和URL\" class=\"headerlink\" title=\"4.URI和URL\"></a>4.URI和URL</h4><ul>\n<li><p>URI：统一资源标识符，用字符串标识互联网上的某一资源</p>\n<ul>\n<li>URI的格式：<code>http://user:pass@www.example.jp:80/dir/index.htm?uid=1#ch1</code></li>\n</ul>\n</li>\n<li><p>URL：统一资源定位符，互联网上某一资源的位置，他是URI的子集</p>\n</li>\n</ul>\n<h2 id=\"第二章-简单的HTTP协议\"><a href=\"#第二章-简单的HTTP协议\" class=\"headerlink\" title=\"第二章 简单的HTTP协议\"></a>第二章 简单的HTTP协议</h2><h3 id=\"请求与响应\"><a href=\"#请求与响应\" class=\"headerlink\" title=\"请求与响应\"></a>请求与响应</h3><p>每次HTTP通信都是客户端发起请求，服务器返回响应</p>\n<h3 id=\"HTTP是不保存状态的协议\"><a href=\"#HTTP是不保存状态的协议\" class=\"headerlink\" title=\"HTTP是不保存状态的协议\"></a>HTTP是不保存状态的协议</h3><p>HTTP是无状态协议，它自身不对请求和响应之间的通信状态进行保存。为了实现状态保存，例如用户的登录状态保存，引入的Cookie技术。</p>\n<h3 id=\"HTTP方法\"><a href=\"#HTTP方法\" class=\"headerlink\" title=\"HTTP方法\"></a>HTTP方法</h3><ul>\n<li>GET方法：获取资源</li>\n<li>POST方法：传输实体主体</li>\n<li>PUT方法：传输文件，存在安全问题，一般网站不使用该方法</li>\n<li>HEAD方法：获取报文首部，与GET方法一样，只不过不返回报文主体部分</li>\n<li>DELETE方法：删除文件，存在安全问题，一般网站不使用该方法</li>\n<li>OPTIONS方法：询问支持的方法</li>\n<li>TRACE方法：追踪路径，可查询发出的请求是怎么被加工修改、篡改的，可追踪代理服务器中转请求时对请求的修改，不常用</li>\n<li>CONNECT方法：要求使用隧道协议链接代理，主要使用SSL和TLS协议把通信内容加密后经网络隧道传输。</li>\n</ul>\n<h3 id=\"持久链接和管线化\"><a href=\"#持久链接和管线化\" class=\"headerlink\" title=\"持久链接和管线化\"></a>持久链接和管线化</h3><ul>\n<li><strong>持久链接</strong><br>所谓的持久链接就是在客户端和服务器建立TCP链接后，只要任何一方都没有提出中断链接，TCP链接就不会断。在HTTP1.0中，每个HTTP请求都要重新建立TCP链接，传输完成后，再断开<br>链接，在HTTP1.1中，默认所有的请求都是持久链接，只需要链接一次，就可以一直保持这个链接，这样就大大减少了建立链接的开销，提高页面的显示速度。</li>\n<li><strong>管线化</strong><br>所谓的管线化就是发送一个请求后，不需要等到响应返回，就可以发送下一个请求</li>\n</ul>\n<h3 id=\"使用Cookie的状态管理\"><a href=\"#使用Cookie的状态管理\" class=\"headerlink\" title=\"使用Cookie的状态管理\"></a>使用Cookie的状态管理</h3><p>Cookie会根据服务器发送响应报文内的一个叫做Set-Cookie的首部字段信息，通知客户端保存Cookie，当下次客户端再往该服务器发送请求时，客户端会自动在请求报文中加入Cookie值，<br>这样服务器就会获取客户端的状态。</p>\n"},{"layout":"post","title":"《图解HTTP》读书笔记(3)","_content":"\n* toc\n{:toc}\n\n## 第八章 确认访问身份的认证\n\n### 何为认证\n\n**认证** 即为了弄清坐在电脑前的用户的真实身份，需要对用户的信息进行核实的过程\n\n常见的几种认证方式：\n\n* BASIC认证（基本认证）\n* DIGEST认证（摘要认证）\n* SSL客户端认证\n* FormBase认证（基于表单的认证）\n\n### BASIC认证\n\n基本步骤\n\n1. 请求的资源需要BASIC认证时，服务器返回401，告知客户端需要认证信息\n2. 客户端在接收到401后，将用户名和密码组成`username:password`形式，并进行Base64编码，然后以`BASIC <编码后的字符串>`形式赋给请求头的\nAuthorization字段，然后再发送给服务器\n3. 服务器收到验证信息后，进行验证，如果验证通过，则返回200，并返回相应的资源\n\nBase64并非真正的加密，如果具有BASIC认证的请求被窃听，用户名和密钥泄露的几率还是很大的\n\n### DIGEST认证\n\nDIGEST认证使用质询/响应的方式进行认证，但不会像BASIC认证那样明文传输密码。因此DIGEST认证的安全等级要高于BASIC认证。\n\n### SSL客户端认证\n\nSSL客户端认证是借由HTTPS的客户端证书完成认证的方式。\n\n### 基于表单的认证\n\n表单认证即我们通常用的在网页上输入密码和账号的认证方式\n\n基本步骤：\n\n1. 客户端将用户填写的用户名和密码（会做加密处理）发送给服务器，通常使用POST请求\n2. 服务器在接收到用户名和密码后，会去和已经登录在服务器上的用户名和密码做匹配，如果匹配通过，则服务器会在Set-Cookie字段中加入用以\n识别用户的SessionID\n3. 客户端接收到SessionID会将其作为Cookie保存在本地，下次发送请求时会自动带上Cookie字段，这样服务器就能识别用户身份，不用重新登录认证了\n\n## 第九章 基于HTTP的功能追加协议\n\n随着时代的发展，HTTP协议上的限制和自身性能有限的缺点越来越明显，因此产生许多基于HTTP协议的功能追加协议\n\n### 消除HTTP瓶颈的SPDY\n\nGoogle发布了SPDY，旨在消除HTTP的性能瓶颈。\n\n**HTTP协议的瓶颈**\n\n1. 一条连接上只可以发送一个请求\n2. 请求只能从客户端开始，客户端不可以接收除响应以外的任何指令\n3. 请求/响应未经压缩就发送，首部信息越多延迟越大\n4. 每次互相发送相同的首部造成浪费\n5. 可任意选择数据压缩格式，非强制压缩发送\n\n**解决方式**\n\n* Ajax（异步Javascript与XML技术）的解决方法\n    * 只更新一部分页面，因此传输的数据量大大减少\n    * Ajax仍未解决HTTP协议本身存在的问题\n* Comet的解决方式\n    * 一旦服务器有内容更新，Comet不会让请求等待，而是直接给客户端返回响应，这是一种延迟应答，模拟实现服务器向客户端推送的功能\n    * 客户端发送请求后，不会立即得到响应，相应的请求会在服务器挂起，等到有内容更新时，响应才会返回客户端\n    * 服务器为了维持链接会消耗更多资源\n* SPDY的目标\n    * 从协议层面消除HTTP的瓶颈\n\n### SPDY的设计与功能\n\nSPDY没有完全改写HTTP协议，而是在TCP和HTTP之间加入了一个会话层。SPDY的功能\n\n* **多路复用** 单一的TCP链接可以处理多个HTTP请求\n* **赋予请求优先级** 给请求追加优先级，解决因带宽低而导致响应变慢的问题\n* **压缩HTTP首部**\n* **推送功能** 支持服务器主动向客户端推送数据的功能\n* **服务器提示功能** 服务器可主动提示客户端请求所需的资源\n\n### 使用浏览器进行双工通信的WebSocket\n\n一旦建立WebSocket链接，不论是服务器还是客户端，任何一方都可以直接向对方发送报文。\n\nWebSocket的特定：\n\n* 推送功能\n* 减少通信量，WebSocket的首部信息量很少\n\n### HTTP2.0\n\n## 第十章 构建Web内容的技术\n\n* HTML\n* CSS\n* 动态HTML\n* Web应用\n* XML\n* JSON\n\n## 第十一章 Web的攻击技术\n\n### 针对Web的攻击技术\n\n攻击模式\n\n* 主动攻击：SQL注入，OS命令注入\n* 被动攻击：\n\n攻击方式\n\n* 跨站脚本攻击\n* SQL注入攻击\n* OS命令注入攻击\n* HTTP首部注入攻击\n* 邮件首部注入攻击\n* 目录遍历攻击\n* 远程文件包含漏洞\n...\n\n\n\n\n-\n","source":"_posts/2015-10-07-《图解HTTP》读书笔记(3).md","raw":"---\nlayout: post\ntitle: \"《图解HTTP》读书笔记(3)\"\ncategories: \"读书笔记\"\n---\n\n* toc\n{:toc}\n\n## 第八章 确认访问身份的认证\n\n### 何为认证\n\n**认证** 即为了弄清坐在电脑前的用户的真实身份，需要对用户的信息进行核实的过程\n\n常见的几种认证方式：\n\n* BASIC认证（基本认证）\n* DIGEST认证（摘要认证）\n* SSL客户端认证\n* FormBase认证（基于表单的认证）\n\n### BASIC认证\n\n基本步骤\n\n1. 请求的资源需要BASIC认证时，服务器返回401，告知客户端需要认证信息\n2. 客户端在接收到401后，将用户名和密码组成`username:password`形式，并进行Base64编码，然后以`BASIC <编码后的字符串>`形式赋给请求头的\nAuthorization字段，然后再发送给服务器\n3. 服务器收到验证信息后，进行验证，如果验证通过，则返回200，并返回相应的资源\n\nBase64并非真正的加密，如果具有BASIC认证的请求被窃听，用户名和密钥泄露的几率还是很大的\n\n### DIGEST认证\n\nDIGEST认证使用质询/响应的方式进行认证，但不会像BASIC认证那样明文传输密码。因此DIGEST认证的安全等级要高于BASIC认证。\n\n### SSL客户端认证\n\nSSL客户端认证是借由HTTPS的客户端证书完成认证的方式。\n\n### 基于表单的认证\n\n表单认证即我们通常用的在网页上输入密码和账号的认证方式\n\n基本步骤：\n\n1. 客户端将用户填写的用户名和密码（会做加密处理）发送给服务器，通常使用POST请求\n2. 服务器在接收到用户名和密码后，会去和已经登录在服务器上的用户名和密码做匹配，如果匹配通过，则服务器会在Set-Cookie字段中加入用以\n识别用户的SessionID\n3. 客户端接收到SessionID会将其作为Cookie保存在本地，下次发送请求时会自动带上Cookie字段，这样服务器就能识别用户身份，不用重新登录认证了\n\n## 第九章 基于HTTP的功能追加协议\n\n随着时代的发展，HTTP协议上的限制和自身性能有限的缺点越来越明显，因此产生许多基于HTTP协议的功能追加协议\n\n### 消除HTTP瓶颈的SPDY\n\nGoogle发布了SPDY，旨在消除HTTP的性能瓶颈。\n\n**HTTP协议的瓶颈**\n\n1. 一条连接上只可以发送一个请求\n2. 请求只能从客户端开始，客户端不可以接收除响应以外的任何指令\n3. 请求/响应未经压缩就发送，首部信息越多延迟越大\n4. 每次互相发送相同的首部造成浪费\n5. 可任意选择数据压缩格式，非强制压缩发送\n\n**解决方式**\n\n* Ajax（异步Javascript与XML技术）的解决方法\n    * 只更新一部分页面，因此传输的数据量大大减少\n    * Ajax仍未解决HTTP协议本身存在的问题\n* Comet的解决方式\n    * 一旦服务器有内容更新，Comet不会让请求等待，而是直接给客户端返回响应，这是一种延迟应答，模拟实现服务器向客户端推送的功能\n    * 客户端发送请求后，不会立即得到响应，相应的请求会在服务器挂起，等到有内容更新时，响应才会返回客户端\n    * 服务器为了维持链接会消耗更多资源\n* SPDY的目标\n    * 从协议层面消除HTTP的瓶颈\n\n### SPDY的设计与功能\n\nSPDY没有完全改写HTTP协议，而是在TCP和HTTP之间加入了一个会话层。SPDY的功能\n\n* **多路复用** 单一的TCP链接可以处理多个HTTP请求\n* **赋予请求优先级** 给请求追加优先级，解决因带宽低而导致响应变慢的问题\n* **压缩HTTP首部**\n* **推送功能** 支持服务器主动向客户端推送数据的功能\n* **服务器提示功能** 服务器可主动提示客户端请求所需的资源\n\n### 使用浏览器进行双工通信的WebSocket\n\n一旦建立WebSocket链接，不论是服务器还是客户端，任何一方都可以直接向对方发送报文。\n\nWebSocket的特定：\n\n* 推送功能\n* 减少通信量，WebSocket的首部信息量很少\n\n### HTTP2.0\n\n## 第十章 构建Web内容的技术\n\n* HTML\n* CSS\n* 动态HTML\n* Web应用\n* XML\n* JSON\n\n## 第十一章 Web的攻击技术\n\n### 针对Web的攻击技术\n\n攻击模式\n\n* 主动攻击：SQL注入，OS命令注入\n* 被动攻击：\n\n攻击方式\n\n* 跨站脚本攻击\n* SQL注入攻击\n* OS命令注入攻击\n* HTTP首部注入攻击\n* 邮件首部注入攻击\n* 目录遍历攻击\n* 远程文件包含漏洞\n...\n\n\n\n\n-\n","slug":"《图解HTTP》读书笔记(3)","published":1,"date":"2015-10-06T16:00:00.000Z","updated":"2017-03-01T06:42:53.000Z","comments":1,"photos":[],"link":"","_id":"cjutyfmf0000hc4c9zqghro5w","content":"<ul>\n<li>toc<br>{:toc}</li>\n</ul>\n<h2 id=\"第八章-确认访问身份的认证\"><a href=\"#第八章-确认访问身份的认证\" class=\"headerlink\" title=\"第八章 确认访问身份的认证\"></a>第八章 确认访问身份的认证</h2><h3 id=\"何为认证\"><a href=\"#何为认证\" class=\"headerlink\" title=\"何为认证\"></a>何为认证</h3><p><strong>认证</strong> 即为了弄清坐在电脑前的用户的真实身份，需要对用户的信息进行核实的过程</p>\n<p>常见的几种认证方式：</p>\n<ul>\n<li>BASIC认证（基本认证）</li>\n<li>DIGEST认证（摘要认证）</li>\n<li>SSL客户端认证</li>\n<li>FormBase认证（基于表单的认证）</li>\n</ul>\n<h3 id=\"BASIC认证\"><a href=\"#BASIC认证\" class=\"headerlink\" title=\"BASIC认证\"></a>BASIC认证</h3><p>基本步骤</p>\n<ol>\n<li>请求的资源需要BASIC认证时，服务器返回401，告知客户端需要认证信息</li>\n<li>客户端在接收到401后，将用户名和密码组成<code>username:password</code>形式，并进行Base64编码，然后以<code>BASIC &lt;编码后的字符串&gt;</code>形式赋给请求头的<br>Authorization字段，然后再发送给服务器</li>\n<li>服务器收到验证信息后，进行验证，如果验证通过，则返回200，并返回相应的资源</li>\n</ol>\n<p>Base64并非真正的加密，如果具有BASIC认证的请求被窃听，用户名和密钥泄露的几率还是很大的</p>\n<h3 id=\"DIGEST认证\"><a href=\"#DIGEST认证\" class=\"headerlink\" title=\"DIGEST认证\"></a>DIGEST认证</h3><p>DIGEST认证使用质询/响应的方式进行认证，但不会像BASIC认证那样明文传输密码。因此DIGEST认证的安全等级要高于BASIC认证。</p>\n<h3 id=\"SSL客户端认证\"><a href=\"#SSL客户端认证\" class=\"headerlink\" title=\"SSL客户端认证\"></a>SSL客户端认证</h3><p>SSL客户端认证是借由HTTPS的客户端证书完成认证的方式。</p>\n<h3 id=\"基于表单的认证\"><a href=\"#基于表单的认证\" class=\"headerlink\" title=\"基于表单的认证\"></a>基于表单的认证</h3><p>表单认证即我们通常用的在网页上输入密码和账号的认证方式</p>\n<p>基本步骤：</p>\n<ol>\n<li>客户端将用户填写的用户名和密码（会做加密处理）发送给服务器，通常使用POST请求</li>\n<li>服务器在接收到用户名和密码后，会去和已经登录在服务器上的用户名和密码做匹配，如果匹配通过，则服务器会在Set-Cookie字段中加入用以<br>识别用户的SessionID</li>\n<li>客户端接收到SessionID会将其作为Cookie保存在本地，下次发送请求时会自动带上Cookie字段，这样服务器就能识别用户身份，不用重新登录认证了</li>\n</ol>\n<h2 id=\"第九章-基于HTTP的功能追加协议\"><a href=\"#第九章-基于HTTP的功能追加协议\" class=\"headerlink\" title=\"第九章 基于HTTP的功能追加协议\"></a>第九章 基于HTTP的功能追加协议</h2><p>随着时代的发展，HTTP协议上的限制和自身性能有限的缺点越来越明显，因此产生许多基于HTTP协议的功能追加协议</p>\n<h3 id=\"消除HTTP瓶颈的SPDY\"><a href=\"#消除HTTP瓶颈的SPDY\" class=\"headerlink\" title=\"消除HTTP瓶颈的SPDY\"></a>消除HTTP瓶颈的SPDY</h3><p>Google发布了SPDY，旨在消除HTTP的性能瓶颈。</p>\n<p><strong>HTTP协议的瓶颈</strong></p>\n<ol>\n<li>一条连接上只可以发送一个请求</li>\n<li>请求只能从客户端开始，客户端不可以接收除响应以外的任何指令</li>\n<li>请求/响应未经压缩就发送，首部信息越多延迟越大</li>\n<li>每次互相发送相同的首部造成浪费</li>\n<li>可任意选择数据压缩格式，非强制压缩发送</li>\n</ol>\n<p><strong>解决方式</strong></p>\n<ul>\n<li>Ajax（异步Javascript与XML技术）的解决方法<ul>\n<li>只更新一部分页面，因此传输的数据量大大减少</li>\n<li>Ajax仍未解决HTTP协议本身存在的问题</li>\n</ul>\n</li>\n<li>Comet的解决方式<ul>\n<li>一旦服务器有内容更新，Comet不会让请求等待，而是直接给客户端返回响应，这是一种延迟应答，模拟实现服务器向客户端推送的功能</li>\n<li>客户端发送请求后，不会立即得到响应，相应的请求会在服务器挂起，等到有内容更新时，响应才会返回客户端</li>\n<li>服务器为了维持链接会消耗更多资源</li>\n</ul>\n</li>\n<li>SPDY的目标<ul>\n<li>从协议层面消除HTTP的瓶颈</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"SPDY的设计与功能\"><a href=\"#SPDY的设计与功能\" class=\"headerlink\" title=\"SPDY的设计与功能\"></a>SPDY的设计与功能</h3><p>SPDY没有完全改写HTTP协议，而是在TCP和HTTP之间加入了一个会话层。SPDY的功能</p>\n<ul>\n<li><strong>多路复用</strong> 单一的TCP链接可以处理多个HTTP请求</li>\n<li><strong>赋予请求优先级</strong> 给请求追加优先级，解决因带宽低而导致响应变慢的问题</li>\n<li><strong>压缩HTTP首部</strong></li>\n<li><strong>推送功能</strong> 支持服务器主动向客户端推送数据的功能</li>\n<li><strong>服务器提示功能</strong> 服务器可主动提示客户端请求所需的资源</li>\n</ul>\n<h3 id=\"使用浏览器进行双工通信的WebSocket\"><a href=\"#使用浏览器进行双工通信的WebSocket\" class=\"headerlink\" title=\"使用浏览器进行双工通信的WebSocket\"></a>使用浏览器进行双工通信的WebSocket</h3><p>一旦建立WebSocket链接，不论是服务器还是客户端，任何一方都可以直接向对方发送报文。</p>\n<p>WebSocket的特定：</p>\n<ul>\n<li>推送功能</li>\n<li>减少通信量，WebSocket的首部信息量很少</li>\n</ul>\n<h3 id=\"HTTP2-0\"><a href=\"#HTTP2-0\" class=\"headerlink\" title=\"HTTP2.0\"></a>HTTP2.0</h3><h2 id=\"第十章-构建Web内容的技术\"><a href=\"#第十章-构建Web内容的技术\" class=\"headerlink\" title=\"第十章 构建Web内容的技术\"></a>第十章 构建Web内容的技术</h2><ul>\n<li>HTML</li>\n<li>CSS</li>\n<li>动态HTML</li>\n<li>Web应用</li>\n<li>XML</li>\n<li>JSON</li>\n</ul>\n<h2 id=\"第十一章-Web的攻击技术\"><a href=\"#第十一章-Web的攻击技术\" class=\"headerlink\" title=\"第十一章 Web的攻击技术\"></a>第十一章 Web的攻击技术</h2><h3 id=\"针对Web的攻击技术\"><a href=\"#针对Web的攻击技术\" class=\"headerlink\" title=\"针对Web的攻击技术\"></a>针对Web的攻击技术</h3><p>攻击模式</p>\n<ul>\n<li>主动攻击：SQL注入，OS命令注入</li>\n<li>被动攻击：</li>\n</ul>\n<p>攻击方式</p>\n<ul>\n<li>跨站脚本攻击</li>\n<li>SQL注入攻击</li>\n<li>OS命令注入攻击</li>\n<li>HTTP首部注入攻击</li>\n<li>邮件首部注入攻击</li>\n<li>目录遍历攻击</li>\n<li>远程文件包含漏洞<br>…</li>\n</ul>\n<p>-</p>\n","site":{"data":{}},"excerpt":"","more":"<ul>\n<li>toc<br>{:toc}</li>\n</ul>\n<h2 id=\"第八章-确认访问身份的认证\"><a href=\"#第八章-确认访问身份的认证\" class=\"headerlink\" title=\"第八章 确认访问身份的认证\"></a>第八章 确认访问身份的认证</h2><h3 id=\"何为认证\"><a href=\"#何为认证\" class=\"headerlink\" title=\"何为认证\"></a>何为认证</h3><p><strong>认证</strong> 即为了弄清坐在电脑前的用户的真实身份，需要对用户的信息进行核实的过程</p>\n<p>常见的几种认证方式：</p>\n<ul>\n<li>BASIC认证（基本认证）</li>\n<li>DIGEST认证（摘要认证）</li>\n<li>SSL客户端认证</li>\n<li>FormBase认证（基于表单的认证）</li>\n</ul>\n<h3 id=\"BASIC认证\"><a href=\"#BASIC认证\" class=\"headerlink\" title=\"BASIC认证\"></a>BASIC认证</h3><p>基本步骤</p>\n<ol>\n<li>请求的资源需要BASIC认证时，服务器返回401，告知客户端需要认证信息</li>\n<li>客户端在接收到401后，将用户名和密码组成<code>username:password</code>形式，并进行Base64编码，然后以<code>BASIC &lt;编码后的字符串&gt;</code>形式赋给请求头的<br>Authorization字段，然后再发送给服务器</li>\n<li>服务器收到验证信息后，进行验证，如果验证通过，则返回200，并返回相应的资源</li>\n</ol>\n<p>Base64并非真正的加密，如果具有BASIC认证的请求被窃听，用户名和密钥泄露的几率还是很大的</p>\n<h3 id=\"DIGEST认证\"><a href=\"#DIGEST认证\" class=\"headerlink\" title=\"DIGEST认证\"></a>DIGEST认证</h3><p>DIGEST认证使用质询/响应的方式进行认证，但不会像BASIC认证那样明文传输密码。因此DIGEST认证的安全等级要高于BASIC认证。</p>\n<h3 id=\"SSL客户端认证\"><a href=\"#SSL客户端认证\" class=\"headerlink\" title=\"SSL客户端认证\"></a>SSL客户端认证</h3><p>SSL客户端认证是借由HTTPS的客户端证书完成认证的方式。</p>\n<h3 id=\"基于表单的认证\"><a href=\"#基于表单的认证\" class=\"headerlink\" title=\"基于表单的认证\"></a>基于表单的认证</h3><p>表单认证即我们通常用的在网页上输入密码和账号的认证方式</p>\n<p>基本步骤：</p>\n<ol>\n<li>客户端将用户填写的用户名和密码（会做加密处理）发送给服务器，通常使用POST请求</li>\n<li>服务器在接收到用户名和密码后，会去和已经登录在服务器上的用户名和密码做匹配，如果匹配通过，则服务器会在Set-Cookie字段中加入用以<br>识别用户的SessionID</li>\n<li>客户端接收到SessionID会将其作为Cookie保存在本地，下次发送请求时会自动带上Cookie字段，这样服务器就能识别用户身份，不用重新登录认证了</li>\n</ol>\n<h2 id=\"第九章-基于HTTP的功能追加协议\"><a href=\"#第九章-基于HTTP的功能追加协议\" class=\"headerlink\" title=\"第九章 基于HTTP的功能追加协议\"></a>第九章 基于HTTP的功能追加协议</h2><p>随着时代的发展，HTTP协议上的限制和自身性能有限的缺点越来越明显，因此产生许多基于HTTP协议的功能追加协议</p>\n<h3 id=\"消除HTTP瓶颈的SPDY\"><a href=\"#消除HTTP瓶颈的SPDY\" class=\"headerlink\" title=\"消除HTTP瓶颈的SPDY\"></a>消除HTTP瓶颈的SPDY</h3><p>Google发布了SPDY，旨在消除HTTP的性能瓶颈。</p>\n<p><strong>HTTP协议的瓶颈</strong></p>\n<ol>\n<li>一条连接上只可以发送一个请求</li>\n<li>请求只能从客户端开始，客户端不可以接收除响应以外的任何指令</li>\n<li>请求/响应未经压缩就发送，首部信息越多延迟越大</li>\n<li>每次互相发送相同的首部造成浪费</li>\n<li>可任意选择数据压缩格式，非强制压缩发送</li>\n</ol>\n<p><strong>解决方式</strong></p>\n<ul>\n<li>Ajax（异步Javascript与XML技术）的解决方法<ul>\n<li>只更新一部分页面，因此传输的数据量大大减少</li>\n<li>Ajax仍未解决HTTP协议本身存在的问题</li>\n</ul>\n</li>\n<li>Comet的解决方式<ul>\n<li>一旦服务器有内容更新，Comet不会让请求等待，而是直接给客户端返回响应，这是一种延迟应答，模拟实现服务器向客户端推送的功能</li>\n<li>客户端发送请求后，不会立即得到响应，相应的请求会在服务器挂起，等到有内容更新时，响应才会返回客户端</li>\n<li>服务器为了维持链接会消耗更多资源</li>\n</ul>\n</li>\n<li>SPDY的目标<ul>\n<li>从协议层面消除HTTP的瓶颈</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"SPDY的设计与功能\"><a href=\"#SPDY的设计与功能\" class=\"headerlink\" title=\"SPDY的设计与功能\"></a>SPDY的设计与功能</h3><p>SPDY没有完全改写HTTP协议，而是在TCP和HTTP之间加入了一个会话层。SPDY的功能</p>\n<ul>\n<li><strong>多路复用</strong> 单一的TCP链接可以处理多个HTTP请求</li>\n<li><strong>赋予请求优先级</strong> 给请求追加优先级，解决因带宽低而导致响应变慢的问题</li>\n<li><strong>压缩HTTP首部</strong></li>\n<li><strong>推送功能</strong> 支持服务器主动向客户端推送数据的功能</li>\n<li><strong>服务器提示功能</strong> 服务器可主动提示客户端请求所需的资源</li>\n</ul>\n<h3 id=\"使用浏览器进行双工通信的WebSocket\"><a href=\"#使用浏览器进行双工通信的WebSocket\" class=\"headerlink\" title=\"使用浏览器进行双工通信的WebSocket\"></a>使用浏览器进行双工通信的WebSocket</h3><p>一旦建立WebSocket链接，不论是服务器还是客户端，任何一方都可以直接向对方发送报文。</p>\n<p>WebSocket的特定：</p>\n<ul>\n<li>推送功能</li>\n<li>减少通信量，WebSocket的首部信息量很少</li>\n</ul>\n<h3 id=\"HTTP2-0\"><a href=\"#HTTP2-0\" class=\"headerlink\" title=\"HTTP2.0\"></a>HTTP2.0</h3><h2 id=\"第十章-构建Web内容的技术\"><a href=\"#第十章-构建Web内容的技术\" class=\"headerlink\" title=\"第十章 构建Web内容的技术\"></a>第十章 构建Web内容的技术</h2><ul>\n<li>HTML</li>\n<li>CSS</li>\n<li>动态HTML</li>\n<li>Web应用</li>\n<li>XML</li>\n<li>JSON</li>\n</ul>\n<h2 id=\"第十一章-Web的攻击技术\"><a href=\"#第十一章-Web的攻击技术\" class=\"headerlink\" title=\"第十一章 Web的攻击技术\"></a>第十一章 Web的攻击技术</h2><h3 id=\"针对Web的攻击技术\"><a href=\"#针对Web的攻击技术\" class=\"headerlink\" title=\"针对Web的攻击技术\"></a>针对Web的攻击技术</h3><p>攻击模式</p>\n<ul>\n<li>主动攻击：SQL注入，OS命令注入</li>\n<li>被动攻击：</li>\n</ul>\n<p>攻击方式</p>\n<ul>\n<li>跨站脚本攻击</li>\n<li>SQL注入攻击</li>\n<li>OS命令注入攻击</li>\n<li>HTTP首部注入攻击</li>\n<li>邮件首部注入攻击</li>\n<li>目录遍历攻击</li>\n<li>远程文件包含漏洞<br>…</li>\n</ul>\n<p>-</p>\n"},{"layout":"post","title":"UIScrollView与Autolayout","_content":"\n在Autolayout中应用UIScrollView一直以来都是一个难点或易错点，本文是我在参考了很多资料后，总结的两种在Autolayout中正确使用UIScrollView的方法。本文主要以两个\nDemo为例，讲解一下如何在Autolayout中应用UIScrollView，希望对大家能有帮助。\n\n先看一下最终的效果吧！\n\n![image](http://oldblog.shicishuzhai.com/AutolayoutDemo.gif)\n\n## 使用Storyboard布局\n\n首先创建一个Single View Application项目，然后在Storyboard中完成如下布局。\n\n![image](http://oldblog.shicishuzhai.com/Screen%20Shot%202015-10-27%20at%2022.29.54.png)\n\n第三个Controller就是我们要实现的界面（以下简称主界面），然后向主界面中拖入一个UIScrollView和一个UIView（姑且叫做A），并且设置UIScrollView的约束如下：\n\n![image](http://oldblog.shicishuzhai.com/Screen%20Shot%202015-10-27%20at%2022.38.34.png)\n\n设置A的约束如下，注意不要添加底边距，或者高度约束\n\n![image](http://oldblog.shicishuzhai.com/Screen%20Shot%202015-10-27%20at%2022.45.57.png)\n\n**注意，这个A和UIScrollView是同一级的，并不是父子视图的关系。A主要是用来辅助计算UIScrollView中内容的高度的。**\n\n此时设置完成后会有约束冲突（A缺少高度约束），先不用在意。接着向UIScrollView中拖入一个UIView（姑且叫做B），然后设置B的宽度和高度约束与A相等，如下图，可以在左侧\n导航视图中拖线设置。\n\n![image](http://oldblog.shicishuzhai.com/Screen%20Shot%202015-10-27%20at%2022.56.15.png)\n\n然后设置B的边界约束如下：\n\n![image](http://oldblog.shicishuzhai.com/Screen%20Shot%202015-10-27%20at%2022.38.34.png)\n\n设置完成后，此时的主界面的结构如下图：\n\n![image](http://oldblog.shicishuzhai.com/Screen%20Shot%202015-10-27%20at%2022.58.06.png)\n\n**B其实就是作为UIScrollView的contentView存在的，把所有原本是UIScrollView中的子控件都应该放在B中。**\n\n接下里就是布局主要界面，像最终效果图那样，拖入三个UIImageView和一个UILabel，并且设置对应的约束。（此处设置省略，具体可以参考我项目中的设置）注意不要设置UILabel\n的高度约束，并且要设置底部两个UIImageView的下边距约束，这样B就会根据显示的内容自适应高度，并且UIScrollView也会根据B的高度设置contentSize。\n\n整个过程过程的关键点就在于A，B两个UIView，A作为一个辅助视图，辅助UIScrollView计算UIScrollView中内容的高度。B的作用是分离UIScrollView和其子控件之间的关系，\n使得UIScrollView仅与B产生约束关系。\n\n## 使用Masonry进行布局\n\n下面使用第三方框架Masonry进行布局，完成上述功能。\n\n首先使用CocoaPods安装Masonry，然后在UItableViewController中添加一个cell，并在SB中创建一个新的UIViewController，绑定对应的类AutolayoutViewController，\n如下图：\n\n![image](http://oldblog.shicishuzhai.com/Screen%20Shot%202015-10-28%20at%2000.05.28.png)\n\n在AutolayoutViewController中添加代码，核心代码如下\n\n```objectivec\n\n- (void)viewDidLoad {\n    [super viewDidLoad];\n\n    self.scrollView = [[UIScrollView alloc] init];\n    [self.view addSubview:self.scrollView];\n\n    // 把所有子视图都放在containerView中，然后把containerView加在UIScrollView中\n    self.containerView = [[UIView alloc] init];\n    [self.scrollView addSubview:self.containerView];\n\n    self.topImage = [[UIImageView alloc] init];\n    self.topImage.image = [UIImage imageNamed:@\"1.JPG\"];\n    [self.containerView addSubview:self.topImage];\n\n    self.descLabel = [[UILabel alloc] init];\n    self.descLabel.numberOfLines = 0;\n    self.descLabel.text = @\"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\";\n    [self.containerView addSubview:self.descLabel];\n\n    self.leftImage = [[UIImageView alloc] init];\n    self.leftImage.image = [UIImage imageNamed:@\"2.JPG\"];\n    [self.containerView addSubview:self.leftImage];\n\n    self.rightImage = [[UIImageView alloc] init];\n    self.rightImage.image = [UIImage imageNamed:@\"3.JPG\"];\n    [self.containerView addSubview:self.rightImage];\n\n    [self.scrollView mas_updateConstraints:^(MASConstraintMaker *make) {\n        make.edges.equalTo(self.view);\n    }];\n\n    [self.containerView mas_updateConstraints:^(MASConstraintMaker *make) {\n        make.edges.equalTo(self.scrollView);\n        make.width.equalTo(self.scrollView);\n    }];\n\n    [self.topImage mas_updateConstraints:^(MASConstraintMaker *make) {\n        make.top.mas_equalTo(self.containerView).offset(20);\n        make.left.mas_equalTo(self.containerView).offset(20);\n        make.right.mas_equalTo(self.containerView).offset(-20);\n        make.height.mas_equalTo(200);\n    }];\n\n    // 注意不要设置descLabel的高度约束\n    [self.descLabel mas_updateConstraints:^(MASConstraintMaker *make) {\n        make.left.equalTo(self.topImage);\n        make.right.equalTo(self.topImage);\n        make.top.mas_equalTo(self.topImage.mas_bottom).offset(20);\n    }];\n\n    [self.leftImage mas_updateConstraints:^(MASConstraintMaker *make) {\n        make.size.equalTo(self.rightImage);\n        make.left.equalTo(self.topImage);\n        make.right.mas_equalTo(self.rightImage.mas_left).offset(20);\n        make.top.mas_equalTo(self.descLabel.mas_bottom).offset(20);\n        make.height.mas_equalTo(150);\n        make.bottom.mas_equalTo(self.containerView.mas_bottom).offset(-20);\n    }];\n\n    [self.rightImage mas_updateConstraints:^(MASConstraintMaker *make) {\n        make.top.equalTo(self.leftImage);\n        make.right.mas_equalTo(self.containerView.mas_right).offset(-20);\n    }];\n\n}\n\n```\n\n这里的关键点是那个containerView，它分离了UIScrollView和子视图的关系。\n\n以上就是本人总结的关于在Autolayout中应用UIScrollView的方法，如果有什么错误欢迎指出。\n\n[代码在这里](https://github.com/liujinlongxa/AutolayoutDemo)\n","source":"_posts/2015-10-27-UIScrollView与Autolayout.md","raw":"---\nlayout: post\ntitle: \"UIScrollView与Autolayout\"\ncategories: \"iOS开发\"\n---\n\n在Autolayout中应用UIScrollView一直以来都是一个难点或易错点，本文是我在参考了很多资料后，总结的两种在Autolayout中正确使用UIScrollView的方法。本文主要以两个\nDemo为例，讲解一下如何在Autolayout中应用UIScrollView，希望对大家能有帮助。\n\n先看一下最终的效果吧！\n\n![image](http://oldblog.shicishuzhai.com/AutolayoutDemo.gif)\n\n## 使用Storyboard布局\n\n首先创建一个Single View Application项目，然后在Storyboard中完成如下布局。\n\n![image](http://oldblog.shicishuzhai.com/Screen%20Shot%202015-10-27%20at%2022.29.54.png)\n\n第三个Controller就是我们要实现的界面（以下简称主界面），然后向主界面中拖入一个UIScrollView和一个UIView（姑且叫做A），并且设置UIScrollView的约束如下：\n\n![image](http://oldblog.shicishuzhai.com/Screen%20Shot%202015-10-27%20at%2022.38.34.png)\n\n设置A的约束如下，注意不要添加底边距，或者高度约束\n\n![image](http://oldblog.shicishuzhai.com/Screen%20Shot%202015-10-27%20at%2022.45.57.png)\n\n**注意，这个A和UIScrollView是同一级的，并不是父子视图的关系。A主要是用来辅助计算UIScrollView中内容的高度的。**\n\n此时设置完成后会有约束冲突（A缺少高度约束），先不用在意。接着向UIScrollView中拖入一个UIView（姑且叫做B），然后设置B的宽度和高度约束与A相等，如下图，可以在左侧\n导航视图中拖线设置。\n\n![image](http://oldblog.shicishuzhai.com/Screen%20Shot%202015-10-27%20at%2022.56.15.png)\n\n然后设置B的边界约束如下：\n\n![image](http://oldblog.shicishuzhai.com/Screen%20Shot%202015-10-27%20at%2022.38.34.png)\n\n设置完成后，此时的主界面的结构如下图：\n\n![image](http://oldblog.shicishuzhai.com/Screen%20Shot%202015-10-27%20at%2022.58.06.png)\n\n**B其实就是作为UIScrollView的contentView存在的，把所有原本是UIScrollView中的子控件都应该放在B中。**\n\n接下里就是布局主要界面，像最终效果图那样，拖入三个UIImageView和一个UILabel，并且设置对应的约束。（此处设置省略，具体可以参考我项目中的设置）注意不要设置UILabel\n的高度约束，并且要设置底部两个UIImageView的下边距约束，这样B就会根据显示的内容自适应高度，并且UIScrollView也会根据B的高度设置contentSize。\n\n整个过程过程的关键点就在于A，B两个UIView，A作为一个辅助视图，辅助UIScrollView计算UIScrollView中内容的高度。B的作用是分离UIScrollView和其子控件之间的关系，\n使得UIScrollView仅与B产生约束关系。\n\n## 使用Masonry进行布局\n\n下面使用第三方框架Masonry进行布局，完成上述功能。\n\n首先使用CocoaPods安装Masonry，然后在UItableViewController中添加一个cell，并在SB中创建一个新的UIViewController，绑定对应的类AutolayoutViewController，\n如下图：\n\n![image](http://oldblog.shicishuzhai.com/Screen%20Shot%202015-10-28%20at%2000.05.28.png)\n\n在AutolayoutViewController中添加代码，核心代码如下\n\n```objectivec\n\n- (void)viewDidLoad {\n    [super viewDidLoad];\n\n    self.scrollView = [[UIScrollView alloc] init];\n    [self.view addSubview:self.scrollView];\n\n    // 把所有子视图都放在containerView中，然后把containerView加在UIScrollView中\n    self.containerView = [[UIView alloc] init];\n    [self.scrollView addSubview:self.containerView];\n\n    self.topImage = [[UIImageView alloc] init];\n    self.topImage.image = [UIImage imageNamed:@\"1.JPG\"];\n    [self.containerView addSubview:self.topImage];\n\n    self.descLabel = [[UILabel alloc] init];\n    self.descLabel.numberOfLines = 0;\n    self.descLabel.text = @\"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\";\n    [self.containerView addSubview:self.descLabel];\n\n    self.leftImage = [[UIImageView alloc] init];\n    self.leftImage.image = [UIImage imageNamed:@\"2.JPG\"];\n    [self.containerView addSubview:self.leftImage];\n\n    self.rightImage = [[UIImageView alloc] init];\n    self.rightImage.image = [UIImage imageNamed:@\"3.JPG\"];\n    [self.containerView addSubview:self.rightImage];\n\n    [self.scrollView mas_updateConstraints:^(MASConstraintMaker *make) {\n        make.edges.equalTo(self.view);\n    }];\n\n    [self.containerView mas_updateConstraints:^(MASConstraintMaker *make) {\n        make.edges.equalTo(self.scrollView);\n        make.width.equalTo(self.scrollView);\n    }];\n\n    [self.topImage mas_updateConstraints:^(MASConstraintMaker *make) {\n        make.top.mas_equalTo(self.containerView).offset(20);\n        make.left.mas_equalTo(self.containerView).offset(20);\n        make.right.mas_equalTo(self.containerView).offset(-20);\n        make.height.mas_equalTo(200);\n    }];\n\n    // 注意不要设置descLabel的高度约束\n    [self.descLabel mas_updateConstraints:^(MASConstraintMaker *make) {\n        make.left.equalTo(self.topImage);\n        make.right.equalTo(self.topImage);\n        make.top.mas_equalTo(self.topImage.mas_bottom).offset(20);\n    }];\n\n    [self.leftImage mas_updateConstraints:^(MASConstraintMaker *make) {\n        make.size.equalTo(self.rightImage);\n        make.left.equalTo(self.topImage);\n        make.right.mas_equalTo(self.rightImage.mas_left).offset(20);\n        make.top.mas_equalTo(self.descLabel.mas_bottom).offset(20);\n        make.height.mas_equalTo(150);\n        make.bottom.mas_equalTo(self.containerView.mas_bottom).offset(-20);\n    }];\n\n    [self.rightImage mas_updateConstraints:^(MASConstraintMaker *make) {\n        make.top.equalTo(self.leftImage);\n        make.right.mas_equalTo(self.containerView.mas_right).offset(-20);\n    }];\n\n}\n\n```\n\n这里的关键点是那个containerView，它分离了UIScrollView和子视图的关系。\n\n以上就是本人总结的关于在Autolayout中应用UIScrollView的方法，如果有什么错误欢迎指出。\n\n[代码在这里](https://github.com/liujinlongxa/AutolayoutDemo)\n","slug":"UIScrollView与Autolayout","published":1,"date":"2015-10-26T16:00:00.000Z","updated":"2019-01-13T04:01:04.558Z","comments":1,"photos":[],"link":"","_id":"cjutyfmf1000lc4c9oudsitqs","content":"<p>在Autolayout中应用UIScrollView一直以来都是一个难点或易错点，本文是我在参考了很多资料后，总结的两种在Autolayout中正确使用UIScrollView的方法。本文主要以两个<br>Demo为例，讲解一下如何在Autolayout中应用UIScrollView，希望对大家能有帮助。</p>\n<p>先看一下最终的效果吧！</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/AutolayoutDemo.gif\" alt=\"image\"></p>\n<h2 id=\"使用Storyboard布局\"><a href=\"#使用Storyboard布局\" class=\"headerlink\" title=\"使用Storyboard布局\"></a>使用Storyboard布局</h2><p>首先创建一个Single View Application项目，然后在Storyboard中完成如下布局。</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/Screen%20Shot%202015-10-27%20at%2022.29.54.png\" alt=\"image\"></p>\n<p>第三个Controller就是我们要实现的界面（以下简称主界面），然后向主界面中拖入一个UIScrollView和一个UIView（姑且叫做A），并且设置UIScrollView的约束如下：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/Screen%20Shot%202015-10-27%20at%2022.38.34.png\" alt=\"image\"></p>\n<p>设置A的约束如下，注意不要添加底边距，或者高度约束</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/Screen%20Shot%202015-10-27%20at%2022.45.57.png\" alt=\"image\"></p>\n<p><strong>注意，这个A和UIScrollView是同一级的，并不是父子视图的关系。A主要是用来辅助计算UIScrollView中内容的高度的。</strong></p>\n<p>此时设置完成后会有约束冲突（A缺少高度约束），先不用在意。接着向UIScrollView中拖入一个UIView（姑且叫做B），然后设置B的宽度和高度约束与A相等，如下图，可以在左侧<br>导航视图中拖线设置。</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/Screen%20Shot%202015-10-27%20at%2022.56.15.png\" alt=\"image\"></p>\n<p>然后设置B的边界约束如下：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/Screen%20Shot%202015-10-27%20at%2022.38.34.png\" alt=\"image\"></p>\n<p>设置完成后，此时的主界面的结构如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/Screen%20Shot%202015-10-27%20at%2022.58.06.png\" alt=\"image\"></p>\n<p><strong>B其实就是作为UIScrollView的contentView存在的，把所有原本是UIScrollView中的子控件都应该放在B中。</strong></p>\n<p>接下里就是布局主要界面，像最终效果图那样，拖入三个UIImageView和一个UILabel，并且设置对应的约束。（此处设置省略，具体可以参考我项目中的设置）注意不要设置UILabel<br>的高度约束，并且要设置底部两个UIImageView的下边距约束，这样B就会根据显示的内容自适应高度，并且UIScrollView也会根据B的高度设置contentSize。</p>\n<p>整个过程过程的关键点就在于A，B两个UIView，A作为一个辅助视图，辅助UIScrollView计算UIScrollView中内容的高度。B的作用是分离UIScrollView和其子控件之间的关系，<br>使得UIScrollView仅与B产生约束关系。</p>\n<h2 id=\"使用Masonry进行布局\"><a href=\"#使用Masonry进行布局\" class=\"headerlink\" title=\"使用Masonry进行布局\"></a>使用Masonry进行布局</h2><p>下面使用第三方框架Masonry进行布局，完成上述功能。</p>\n<p>首先使用CocoaPods安装Masonry，然后在UItableViewController中添加一个cell，并在SB中创建一个新的UIViewController，绑定对应的类AutolayoutViewController，<br>如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/Screen%20Shot%202015-10-28%20at%2000.05.28.png\" alt=\"image\"></p>\n<p>在AutolayoutViewController中添加代码，核心代码如下</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)viewDidLoad &#123;</span><br><span class=\"line\">    [<span class=\"keyword\">super</span> viewDidLoad];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">self</span>.scrollView = [[<span class=\"built_in\">UIScrollView</span> alloc] init];</span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.view addSubview:<span class=\"keyword\">self</span>.scrollView];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 把所有子视图都放在containerView中，然后把containerView加在UIScrollView中</span></span><br><span class=\"line\">    <span class=\"keyword\">self</span>.containerView = [[<span class=\"built_in\">UIView</span> alloc] init];</span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.scrollView addSubview:<span class=\"keyword\">self</span>.containerView];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">self</span>.topImage = [[<span class=\"built_in\">UIImageView</span> alloc] init];</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.topImage.image = [<span class=\"built_in\">UIImage</span> imageNamed:<span class=\"string\">@\"1.JPG\"</span>];</span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.containerView addSubview:<span class=\"keyword\">self</span>.topImage];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">self</span>.descLabel = [[<span class=\"built_in\">UILabel</span> alloc] init];</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.descLabel.numberOfLines = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.descLabel.text = <span class=\"string\">@\"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\"</span>;</span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.containerView addSubview:<span class=\"keyword\">self</span>.descLabel];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">self</span>.leftImage = [[<span class=\"built_in\">UIImageView</span> alloc] init];</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.leftImage.image = [<span class=\"built_in\">UIImage</span> imageNamed:<span class=\"string\">@\"2.JPG\"</span>];</span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.containerView addSubview:<span class=\"keyword\">self</span>.leftImage];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">self</span>.rightImage = [[<span class=\"built_in\">UIImageView</span> alloc] init];</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.rightImage.image = [<span class=\"built_in\">UIImage</span> imageNamed:<span class=\"string\">@\"3.JPG\"</span>];</span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.containerView addSubview:<span class=\"keyword\">self</span>.rightImage];</span><br><span class=\"line\"></span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.scrollView mas_updateConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class=\"line\">        make.edges.equalTo(<span class=\"keyword\">self</span>.view);</span><br><span class=\"line\">    &#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.containerView mas_updateConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class=\"line\">        make.edges.equalTo(<span class=\"keyword\">self</span>.scrollView);</span><br><span class=\"line\">        make.width.equalTo(<span class=\"keyword\">self</span>.scrollView);</span><br><span class=\"line\">    &#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.topImage mas_updateConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class=\"line\">        make.top.mas_equalTo(<span class=\"keyword\">self</span>.containerView).offset(<span class=\"number\">20</span>);</span><br><span class=\"line\">        make.left.mas_equalTo(<span class=\"keyword\">self</span>.containerView).offset(<span class=\"number\">20</span>);</span><br><span class=\"line\">        make.right.mas_equalTo(<span class=\"keyword\">self</span>.containerView).offset(<span class=\"number\">-20</span>);</span><br><span class=\"line\">        make.height.mas_equalTo(<span class=\"number\">200</span>);</span><br><span class=\"line\">    &#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 注意不要设置descLabel的高度约束</span></span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.descLabel mas_updateConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class=\"line\">        make.left.equalTo(<span class=\"keyword\">self</span>.topImage);</span><br><span class=\"line\">        make.right.equalTo(<span class=\"keyword\">self</span>.topImage);</span><br><span class=\"line\">        make.top.mas_equalTo(<span class=\"keyword\">self</span>.topImage.mas_bottom).offset(<span class=\"number\">20</span>);</span><br><span class=\"line\">    &#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.leftImage mas_updateConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class=\"line\">        make.size.equalTo(<span class=\"keyword\">self</span>.rightImage);</span><br><span class=\"line\">        make.left.equalTo(<span class=\"keyword\">self</span>.topImage);</span><br><span class=\"line\">        make.right.mas_equalTo(<span class=\"keyword\">self</span>.rightImage.mas_left).offset(<span class=\"number\">20</span>);</span><br><span class=\"line\">        make.top.mas_equalTo(<span class=\"keyword\">self</span>.descLabel.mas_bottom).offset(<span class=\"number\">20</span>);</span><br><span class=\"line\">        make.height.mas_equalTo(<span class=\"number\">150</span>);</span><br><span class=\"line\">        make.bottom.mas_equalTo(<span class=\"keyword\">self</span>.containerView.mas_bottom).offset(<span class=\"number\">-20</span>);</span><br><span class=\"line\">    &#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.rightImage mas_updateConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class=\"line\">        make.top.equalTo(<span class=\"keyword\">self</span>.leftImage);</span><br><span class=\"line\">        make.right.mas_equalTo(<span class=\"keyword\">self</span>.containerView.mas_right).offset(<span class=\"number\">-20</span>);</span><br><span class=\"line\">    &#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这里的关键点是那个containerView，它分离了UIScrollView和子视图的关系。</p>\n<p>以上就是本人总结的关于在Autolayout中应用UIScrollView的方法，如果有什么错误欢迎指出。</p>\n<p><a href=\"https://github.com/liujinlongxa/AutolayoutDemo\" target=\"_blank\" rel=\"noopener\">代码在这里</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>在Autolayout中应用UIScrollView一直以来都是一个难点或易错点，本文是我在参考了很多资料后，总结的两种在Autolayout中正确使用UIScrollView的方法。本文主要以两个<br>Demo为例，讲解一下如何在Autolayout中应用UIScrollView，希望对大家能有帮助。</p>\n<p>先看一下最终的效果吧！</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/AutolayoutDemo.gif\" alt=\"image\"></p>\n<h2 id=\"使用Storyboard布局\"><a href=\"#使用Storyboard布局\" class=\"headerlink\" title=\"使用Storyboard布局\"></a>使用Storyboard布局</h2><p>首先创建一个Single View Application项目，然后在Storyboard中完成如下布局。</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/Screen%20Shot%202015-10-27%20at%2022.29.54.png\" alt=\"image\"></p>\n<p>第三个Controller就是我们要实现的界面（以下简称主界面），然后向主界面中拖入一个UIScrollView和一个UIView（姑且叫做A），并且设置UIScrollView的约束如下：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/Screen%20Shot%202015-10-27%20at%2022.38.34.png\" alt=\"image\"></p>\n<p>设置A的约束如下，注意不要添加底边距，或者高度约束</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/Screen%20Shot%202015-10-27%20at%2022.45.57.png\" alt=\"image\"></p>\n<p><strong>注意，这个A和UIScrollView是同一级的，并不是父子视图的关系。A主要是用来辅助计算UIScrollView中内容的高度的。</strong></p>\n<p>此时设置完成后会有约束冲突（A缺少高度约束），先不用在意。接着向UIScrollView中拖入一个UIView（姑且叫做B），然后设置B的宽度和高度约束与A相等，如下图，可以在左侧<br>导航视图中拖线设置。</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/Screen%20Shot%202015-10-27%20at%2022.56.15.png\" alt=\"image\"></p>\n<p>然后设置B的边界约束如下：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/Screen%20Shot%202015-10-27%20at%2022.38.34.png\" alt=\"image\"></p>\n<p>设置完成后，此时的主界面的结构如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/Screen%20Shot%202015-10-27%20at%2022.58.06.png\" alt=\"image\"></p>\n<p><strong>B其实就是作为UIScrollView的contentView存在的，把所有原本是UIScrollView中的子控件都应该放在B中。</strong></p>\n<p>接下里就是布局主要界面，像最终效果图那样，拖入三个UIImageView和一个UILabel，并且设置对应的约束。（此处设置省略，具体可以参考我项目中的设置）注意不要设置UILabel<br>的高度约束，并且要设置底部两个UIImageView的下边距约束，这样B就会根据显示的内容自适应高度，并且UIScrollView也会根据B的高度设置contentSize。</p>\n<p>整个过程过程的关键点就在于A，B两个UIView，A作为一个辅助视图，辅助UIScrollView计算UIScrollView中内容的高度。B的作用是分离UIScrollView和其子控件之间的关系，<br>使得UIScrollView仅与B产生约束关系。</p>\n<h2 id=\"使用Masonry进行布局\"><a href=\"#使用Masonry进行布局\" class=\"headerlink\" title=\"使用Masonry进行布局\"></a>使用Masonry进行布局</h2><p>下面使用第三方框架Masonry进行布局，完成上述功能。</p>\n<p>首先使用CocoaPods安装Masonry，然后在UItableViewController中添加一个cell，并在SB中创建一个新的UIViewController，绑定对应的类AutolayoutViewController，<br>如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/Screen%20Shot%202015-10-28%20at%2000.05.28.png\" alt=\"image\"></p>\n<p>在AutolayoutViewController中添加代码，核心代码如下</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)viewDidLoad &#123;</span><br><span class=\"line\">    [<span class=\"keyword\">super</span> viewDidLoad];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">self</span>.scrollView = [[<span class=\"built_in\">UIScrollView</span> alloc] init];</span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.view addSubview:<span class=\"keyword\">self</span>.scrollView];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 把所有子视图都放在containerView中，然后把containerView加在UIScrollView中</span></span><br><span class=\"line\">    <span class=\"keyword\">self</span>.containerView = [[<span class=\"built_in\">UIView</span> alloc] init];</span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.scrollView addSubview:<span class=\"keyword\">self</span>.containerView];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">self</span>.topImage = [[<span class=\"built_in\">UIImageView</span> alloc] init];</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.topImage.image = [<span class=\"built_in\">UIImage</span> imageNamed:<span class=\"string\">@\"1.JPG\"</span>];</span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.containerView addSubview:<span class=\"keyword\">self</span>.topImage];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">self</span>.descLabel = [[<span class=\"built_in\">UILabel</span> alloc] init];</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.descLabel.numberOfLines = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.descLabel.text = <span class=\"string\">@\"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\"</span>;</span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.containerView addSubview:<span class=\"keyword\">self</span>.descLabel];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">self</span>.leftImage = [[<span class=\"built_in\">UIImageView</span> alloc] init];</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.leftImage.image = [<span class=\"built_in\">UIImage</span> imageNamed:<span class=\"string\">@\"2.JPG\"</span>];</span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.containerView addSubview:<span class=\"keyword\">self</span>.leftImage];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">self</span>.rightImage = [[<span class=\"built_in\">UIImageView</span> alloc] init];</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.rightImage.image = [<span class=\"built_in\">UIImage</span> imageNamed:<span class=\"string\">@\"3.JPG\"</span>];</span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.containerView addSubview:<span class=\"keyword\">self</span>.rightImage];</span><br><span class=\"line\"></span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.scrollView mas_updateConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class=\"line\">        make.edges.equalTo(<span class=\"keyword\">self</span>.view);</span><br><span class=\"line\">    &#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.containerView mas_updateConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class=\"line\">        make.edges.equalTo(<span class=\"keyword\">self</span>.scrollView);</span><br><span class=\"line\">        make.width.equalTo(<span class=\"keyword\">self</span>.scrollView);</span><br><span class=\"line\">    &#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.topImage mas_updateConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class=\"line\">        make.top.mas_equalTo(<span class=\"keyword\">self</span>.containerView).offset(<span class=\"number\">20</span>);</span><br><span class=\"line\">        make.left.mas_equalTo(<span class=\"keyword\">self</span>.containerView).offset(<span class=\"number\">20</span>);</span><br><span class=\"line\">        make.right.mas_equalTo(<span class=\"keyword\">self</span>.containerView).offset(<span class=\"number\">-20</span>);</span><br><span class=\"line\">        make.height.mas_equalTo(<span class=\"number\">200</span>);</span><br><span class=\"line\">    &#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 注意不要设置descLabel的高度约束</span></span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.descLabel mas_updateConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class=\"line\">        make.left.equalTo(<span class=\"keyword\">self</span>.topImage);</span><br><span class=\"line\">        make.right.equalTo(<span class=\"keyword\">self</span>.topImage);</span><br><span class=\"line\">        make.top.mas_equalTo(<span class=\"keyword\">self</span>.topImage.mas_bottom).offset(<span class=\"number\">20</span>);</span><br><span class=\"line\">    &#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.leftImage mas_updateConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class=\"line\">        make.size.equalTo(<span class=\"keyword\">self</span>.rightImage);</span><br><span class=\"line\">        make.left.equalTo(<span class=\"keyword\">self</span>.topImage);</span><br><span class=\"line\">        make.right.mas_equalTo(<span class=\"keyword\">self</span>.rightImage.mas_left).offset(<span class=\"number\">20</span>);</span><br><span class=\"line\">        make.top.mas_equalTo(<span class=\"keyword\">self</span>.descLabel.mas_bottom).offset(<span class=\"number\">20</span>);</span><br><span class=\"line\">        make.height.mas_equalTo(<span class=\"number\">150</span>);</span><br><span class=\"line\">        make.bottom.mas_equalTo(<span class=\"keyword\">self</span>.containerView.mas_bottom).offset(<span class=\"number\">-20</span>);</span><br><span class=\"line\">    &#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.rightImage mas_updateConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class=\"line\">        make.top.equalTo(<span class=\"keyword\">self</span>.leftImage);</span><br><span class=\"line\">        make.right.mas_equalTo(<span class=\"keyword\">self</span>.containerView.mas_right).offset(<span class=\"number\">-20</span>);</span><br><span class=\"line\">    &#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这里的关键点是那个containerView，它分离了UIScrollView和子视图的关系。</p>\n<p>以上就是本人总结的关于在Autolayout中应用UIScrollView的方法，如果有什么错误欢迎指出。</p>\n<p><a href=\"https://github.com/liujinlongxa/AutolayoutDemo\" target=\"_blank\" rel=\"noopener\">代码在这里</a></p>\n"},{"layout":"post","title":"最近开发中遇到的一些问题","_content":"\n本文主要记录了我近期在开发中遇到的一些问题以及解决方法。\n\n## 问题1: TTTAttributedLabel卡顿\n\n**问题描述** 项目中用到了TTTAttributedLabel，用于实现在Label中点击链接跳转，在实际使用过程中，出现了如果Label内容很多，通过UIScrollView滑动Label时非常卡\n的问题。\n\n**解决方案** TTTAttributedLabel中有一个`extendsLinkTouchArea`属性，指示是否在一个较大的范围内检测链接的Label的Touch事件，默认是YES，设置成NO，表示不检测，\n这样可以提高TTTAttributedLabel的性能\n\n## 问题2: `dyld: Symbol not found: _CTRadioAccessTechnologyEdge`问题\n\n**问题描述** 项目中了Reachability用于检测3G/4G/Wifi，之前一直使用正常，最近突然不知什么原因在iOS6上出现了如下图的问题，重新添加CoreTelephone框架也没有用。\n\n![image](http://oldblog.shicishuzhai.com/Screen%20Shot%202015-10-15%20at%2009.33.53.png)\n\n**解决方案** 需要将CoreTelephone框架的状态设置为Optional，如下图，这样就不会有上述问题了。\n\n![image](http://oldblog.shicishuzhai.com/Screen%20Shot%202015-10-16%20at%2022.15.38.png)\n\n具体原因我也不是非常清楚，如果有哪位朋友清楚欢迎分享。\n","source":"_posts/2015-10-16-最近开发中遇到的一些问题.md","raw":"---\nlayout: post\ntitle: \"最近开发中遇到的一些问题\"\ncategories: \"iOS开发\"\n---\n\n本文主要记录了我近期在开发中遇到的一些问题以及解决方法。\n\n## 问题1: TTTAttributedLabel卡顿\n\n**问题描述** 项目中用到了TTTAttributedLabel，用于实现在Label中点击链接跳转，在实际使用过程中，出现了如果Label内容很多，通过UIScrollView滑动Label时非常卡\n的问题。\n\n**解决方案** TTTAttributedLabel中有一个`extendsLinkTouchArea`属性，指示是否在一个较大的范围内检测链接的Label的Touch事件，默认是YES，设置成NO，表示不检测，\n这样可以提高TTTAttributedLabel的性能\n\n## 问题2: `dyld: Symbol not found: _CTRadioAccessTechnologyEdge`问题\n\n**问题描述** 项目中了Reachability用于检测3G/4G/Wifi，之前一直使用正常，最近突然不知什么原因在iOS6上出现了如下图的问题，重新添加CoreTelephone框架也没有用。\n\n![image](http://oldblog.shicishuzhai.com/Screen%20Shot%202015-10-15%20at%2009.33.53.png)\n\n**解决方案** 需要将CoreTelephone框架的状态设置为Optional，如下图，这样就不会有上述问题了。\n\n![image](http://oldblog.shicishuzhai.com/Screen%20Shot%202015-10-16%20at%2022.15.38.png)\n\n具体原因我也不是非常清楚，如果有哪位朋友清楚欢迎分享。\n","slug":"最近开发中遇到的一些问题","published":1,"date":"2015-10-15T16:00:00.000Z","updated":"2019-01-13T04:01:04.491Z","comments":1,"photos":[],"link":"","_id":"cjutyfmf3000nc4c9gfltksp2","content":"<p>本文主要记录了我近期在开发中遇到的一些问题以及解决方法。</p>\n<h2 id=\"问题1-TTTAttributedLabel卡顿\"><a href=\"#问题1-TTTAttributedLabel卡顿\" class=\"headerlink\" title=\"问题1: TTTAttributedLabel卡顿\"></a>问题1: TTTAttributedLabel卡顿</h2><p><strong>问题描述</strong> 项目中用到了TTTAttributedLabel，用于实现在Label中点击链接跳转，在实际使用过程中，出现了如果Label内容很多，通过UIScrollView滑动Label时非常卡<br>的问题。</p>\n<p><strong>解决方案</strong> TTTAttributedLabel中有一个<code>extendsLinkTouchArea</code>属性，指示是否在一个较大的范围内检测链接的Label的Touch事件，默认是YES，设置成NO，表示不检测，<br>这样可以提高TTTAttributedLabel的性能</p>\n<h2 id=\"问题2-dyld-Symbol-not-found-CTRadioAccessTechnologyEdge问题\"><a href=\"#问题2-dyld-Symbol-not-found-CTRadioAccessTechnologyEdge问题\" class=\"headerlink\" title=\"问题2: dyld: Symbol not found: _CTRadioAccessTechnologyEdge问题\"></a>问题2: <code>dyld: Symbol not found: _CTRadioAccessTechnologyEdge</code>问题</h2><p><strong>问题描述</strong> 项目中了Reachability用于检测3G/4G/Wifi，之前一直使用正常，最近突然不知什么原因在iOS6上出现了如下图的问题，重新添加CoreTelephone框架也没有用。</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/Screen%20Shot%202015-10-15%20at%2009.33.53.png\" alt=\"image\"></p>\n<p><strong>解决方案</strong> 需要将CoreTelephone框架的状态设置为Optional，如下图，这样就不会有上述问题了。</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/Screen%20Shot%202015-10-16%20at%2022.15.38.png\" alt=\"image\"></p>\n<p>具体原因我也不是非常清楚，如果有哪位朋友清楚欢迎分享。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>本文主要记录了我近期在开发中遇到的一些问题以及解决方法。</p>\n<h2 id=\"问题1-TTTAttributedLabel卡顿\"><a href=\"#问题1-TTTAttributedLabel卡顿\" class=\"headerlink\" title=\"问题1: TTTAttributedLabel卡顿\"></a>问题1: TTTAttributedLabel卡顿</h2><p><strong>问题描述</strong> 项目中用到了TTTAttributedLabel，用于实现在Label中点击链接跳转，在实际使用过程中，出现了如果Label内容很多，通过UIScrollView滑动Label时非常卡<br>的问题。</p>\n<p><strong>解决方案</strong> TTTAttributedLabel中有一个<code>extendsLinkTouchArea</code>属性，指示是否在一个较大的范围内检测链接的Label的Touch事件，默认是YES，设置成NO，表示不检测，<br>这样可以提高TTTAttributedLabel的性能</p>\n<h2 id=\"问题2-dyld-Symbol-not-found-CTRadioAccessTechnologyEdge问题\"><a href=\"#问题2-dyld-Symbol-not-found-CTRadioAccessTechnologyEdge问题\" class=\"headerlink\" title=\"问题2: dyld: Symbol not found: _CTRadioAccessTechnologyEdge问题\"></a>问题2: <code>dyld: Symbol not found: _CTRadioAccessTechnologyEdge</code>问题</h2><p><strong>问题描述</strong> 项目中了Reachability用于检测3G/4G/Wifi，之前一直使用正常，最近突然不知什么原因在iOS6上出现了如下图的问题，重新添加CoreTelephone框架也没有用。</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/Screen%20Shot%202015-10-15%20at%2009.33.53.png\" alt=\"image\"></p>\n<p><strong>解决方案</strong> 需要将CoreTelephone框架的状态设置为Optional，如下图，这样就不会有上述问题了。</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/Screen%20Shot%202015-10-16%20at%2022.15.38.png\" alt=\"image\"></p>\n<p>具体原因我也不是非常清楚，如果有哪位朋友清楚欢迎分享。</p>\n"},{"layout":"post","title":"Content Hugging与Content Compression Resistance","_content":"\n最近在使用Autolayout遇到了一个问题，我设置了一个UILabel的宽度约束，希望这个UILabel在显示时，如果内容宽度没有超过约束的宽度，则以约束的宽度显示，如果\n内容宽度超过约束的宽度，则以内容的宽度显示，这时，如果只设置宽度约束，UILabel会始终以约束的宽度显示，如果降低宽度约束，则UILabel就会使用以内容的宽度显示，\n始终无法达到我想要的效果，于是一番Google，便发现了Content Hugging与Content Compression Resistance两个概念。\n\n## 基本概念\n\n**Content Hugging Priority** 字面意思为内容紧缩，通过改变它的优先级，可以设置当View的大小大于实际内容的大小时，是否将View缩小，使其紧紧包裹住内容\n\n**Content Compression Resistance Priority** 字面意思为阻止内容紧缩，通过改变它的优先级，可以设置当View的大小小于实际内容的大小时，是否将View扩大，使其紧紧包裹内容\n\n##  实例应用\n\n本例将以一个UILabel为例，来说明一下ContentHugging与ContentCompressionResistance的具体设置方法。\n\n首先创建一个空项目，打开SB，拖入一个UILabel，然后设置一下三个约束：\n\n> 1. 水平居中对齐\n> 2. 垂直居中对齐\n> 3. 宽度为100\n\n为类方便观察，给Label加一个背景颜色，设置完运行如下图：\n\n![image](http://oldblog.shicishuzhai.com/Screen%20Shot%202015-11-07%20at%2022.46.17.png)\n\n然后改变宽度约束的优先级为500，如图：\n\n![image](http://oldblog.shicishuzhai.com/Screen%20Shot%202015-11-07%20at%2022.15.10.png)\n\n然后就可以开始设置ContentHuggingPriority与ContentCompressionResistancePriority了，设置界面如下：\n\n![image](http://oldblog.shicishuzhai.com/Screen%20Shot%202015-11-07%20at%2022.30.26.png)\n\n首先设置水平方向上的ContentHuggingPriority为501，运行项目，显示效果如下：\n\n![image](http://oldblog.shicishuzhai.com/Screen%20Shot%202015-11-07%20at%2022.44.05.png)\n\n如果设置水平方向上的ContentHuggingPriority为499，运行项目，显示效果如下：\n\n![image](http://oldblog.shicishuzhai.com/Screen%20Shot%202015-11-07%20at%2022.46.17.png)\n\n这是因为当宽度约束的优先级大于ContentHuggingPriority，优先以约束的宽度显示，当宽度约束的优先级小于ContentHuggingPriority时，如果Label的大小\n大于内容的大小，则会按实际内容的大小显示。\n\n接下来改变Label的宽度约束值为30，然后运行项目，显示效果如下：\n\n![image](http://oldblog.shicishuzhai.com/Screen%20Shot%202015-11-07%20at%2022.44.05.png)\n\n水平方向上ContentCompressionResistancePriority的默认值为750，将其改为499，则显示效果如下：\n\n![image](http://oldblog.shicishuzhai.com/Screen%20Shot%202015-11-07%20at%2023.02.49.png)\n\n这是因为当宽度约束的优先级大于ContentCompressionResistancePriority，优先以约束的宽度显示，当宽度约束的优先级小于ContentCompressionResistancePriority\n时，如果Label的大小小于内容的大小，则会按实际内容的大小显示\n\n除了在SB中设置外，还可以在代码中设置，代码如下：\n\n```objectivec\n\n// 设置水平方向上内容紧缩的优先级为高\n[self.label setContentHuggingPriority:UILayoutPriorityDefaultHigh forAxis:UILayoutConstraintAxisHorizontal];\n\n// 设置垂直方向上阻止内容紧缩的优先级为低\n[self.label setContentCompressionResistancePriority:UILayoutPriorityDefaultLow forAxis:UILayoutConstraintAxisVertical];\n\n```\n","source":"_posts/2015-11-07-ContentHugging与ContentCompressionResistance.md","raw":"---\nlayout: post\ntitle: \"Content Hugging与Content Compression Resistance\"\ncategories: \"iOS开发\"\n---\n\n最近在使用Autolayout遇到了一个问题，我设置了一个UILabel的宽度约束，希望这个UILabel在显示时，如果内容宽度没有超过约束的宽度，则以约束的宽度显示，如果\n内容宽度超过约束的宽度，则以内容的宽度显示，这时，如果只设置宽度约束，UILabel会始终以约束的宽度显示，如果降低宽度约束，则UILabel就会使用以内容的宽度显示，\n始终无法达到我想要的效果，于是一番Google，便发现了Content Hugging与Content Compression Resistance两个概念。\n\n## 基本概念\n\n**Content Hugging Priority** 字面意思为内容紧缩，通过改变它的优先级，可以设置当View的大小大于实际内容的大小时，是否将View缩小，使其紧紧包裹住内容\n\n**Content Compression Resistance Priority** 字面意思为阻止内容紧缩，通过改变它的优先级，可以设置当View的大小小于实际内容的大小时，是否将View扩大，使其紧紧包裹内容\n\n##  实例应用\n\n本例将以一个UILabel为例，来说明一下ContentHugging与ContentCompressionResistance的具体设置方法。\n\n首先创建一个空项目，打开SB，拖入一个UILabel，然后设置一下三个约束：\n\n> 1. 水平居中对齐\n> 2. 垂直居中对齐\n> 3. 宽度为100\n\n为类方便观察，给Label加一个背景颜色，设置完运行如下图：\n\n![image](http://oldblog.shicishuzhai.com/Screen%20Shot%202015-11-07%20at%2022.46.17.png)\n\n然后改变宽度约束的优先级为500，如图：\n\n![image](http://oldblog.shicishuzhai.com/Screen%20Shot%202015-11-07%20at%2022.15.10.png)\n\n然后就可以开始设置ContentHuggingPriority与ContentCompressionResistancePriority了，设置界面如下：\n\n![image](http://oldblog.shicishuzhai.com/Screen%20Shot%202015-11-07%20at%2022.30.26.png)\n\n首先设置水平方向上的ContentHuggingPriority为501，运行项目，显示效果如下：\n\n![image](http://oldblog.shicishuzhai.com/Screen%20Shot%202015-11-07%20at%2022.44.05.png)\n\n如果设置水平方向上的ContentHuggingPriority为499，运行项目，显示效果如下：\n\n![image](http://oldblog.shicishuzhai.com/Screen%20Shot%202015-11-07%20at%2022.46.17.png)\n\n这是因为当宽度约束的优先级大于ContentHuggingPriority，优先以约束的宽度显示，当宽度约束的优先级小于ContentHuggingPriority时，如果Label的大小\n大于内容的大小，则会按实际内容的大小显示。\n\n接下来改变Label的宽度约束值为30，然后运行项目，显示效果如下：\n\n![image](http://oldblog.shicishuzhai.com/Screen%20Shot%202015-11-07%20at%2022.44.05.png)\n\n水平方向上ContentCompressionResistancePriority的默认值为750，将其改为499，则显示效果如下：\n\n![image](http://oldblog.shicishuzhai.com/Screen%20Shot%202015-11-07%20at%2023.02.49.png)\n\n这是因为当宽度约束的优先级大于ContentCompressionResistancePriority，优先以约束的宽度显示，当宽度约束的优先级小于ContentCompressionResistancePriority\n时，如果Label的大小小于内容的大小，则会按实际内容的大小显示\n\n除了在SB中设置外，还可以在代码中设置，代码如下：\n\n```objectivec\n\n// 设置水平方向上内容紧缩的优先级为高\n[self.label setContentHuggingPriority:UILayoutPriorityDefaultHigh forAxis:UILayoutConstraintAxisHorizontal];\n\n// 设置垂直方向上阻止内容紧缩的优先级为低\n[self.label setContentCompressionResistancePriority:UILayoutPriorityDefaultLow forAxis:UILayoutConstraintAxisVertical];\n\n```\n","slug":"ContentHugging与ContentCompressionResistance","published":1,"date":"2015-11-06T16:00:00.000Z","updated":"2019-01-13T04:01:04.582Z","comments":1,"photos":[],"link":"","_id":"cjutyfmf3000pc4c9gja2x439","content":"<p>最近在使用Autolayout遇到了一个问题，我设置了一个UILabel的宽度约束，希望这个UILabel在显示时，如果内容宽度没有超过约束的宽度，则以约束的宽度显示，如果<br>内容宽度超过约束的宽度，则以内容的宽度显示，这时，如果只设置宽度约束，UILabel会始终以约束的宽度显示，如果降低宽度约束，则UILabel就会使用以内容的宽度显示，<br>始终无法达到我想要的效果，于是一番Google，便发现了Content Hugging与Content Compression Resistance两个概念。</p>\n<h2 id=\"基本概念\"><a href=\"#基本概念\" class=\"headerlink\" title=\"基本概念\"></a>基本概念</h2><p><strong>Content Hugging Priority</strong> 字面意思为内容紧缩，通过改变它的优先级，可以设置当View的大小大于实际内容的大小时，是否将View缩小，使其紧紧包裹住内容</p>\n<p><strong>Content Compression Resistance Priority</strong> 字面意思为阻止内容紧缩，通过改变它的优先级，可以设置当View的大小小于实际内容的大小时，是否将View扩大，使其紧紧包裹内容</p>\n<h2 id=\"实例应用\"><a href=\"#实例应用\" class=\"headerlink\" title=\"实例应用\"></a>实例应用</h2><p>本例将以一个UILabel为例，来说明一下ContentHugging与ContentCompressionResistance的具体设置方法。</p>\n<p>首先创建一个空项目，打开SB，拖入一个UILabel，然后设置一下三个约束：</p>\n<blockquote>\n<ol>\n<li>水平居中对齐</li>\n<li>垂直居中对齐</li>\n<li>宽度为100</li>\n</ol>\n</blockquote>\n<p>为类方便观察，给Label加一个背景颜色，设置完运行如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/Screen%20Shot%202015-11-07%20at%2022.46.17.png\" alt=\"image\"></p>\n<p>然后改变宽度约束的优先级为500，如图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/Screen%20Shot%202015-11-07%20at%2022.15.10.png\" alt=\"image\"></p>\n<p>然后就可以开始设置ContentHuggingPriority与ContentCompressionResistancePriority了，设置界面如下：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/Screen%20Shot%202015-11-07%20at%2022.30.26.png\" alt=\"image\"></p>\n<p>首先设置水平方向上的ContentHuggingPriority为501，运行项目，显示效果如下：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/Screen%20Shot%202015-11-07%20at%2022.44.05.png\" alt=\"image\"></p>\n<p>如果设置水平方向上的ContentHuggingPriority为499，运行项目，显示效果如下：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/Screen%20Shot%202015-11-07%20at%2022.46.17.png\" alt=\"image\"></p>\n<p>这是因为当宽度约束的优先级大于ContentHuggingPriority，优先以约束的宽度显示，当宽度约束的优先级小于ContentHuggingPriority时，如果Label的大小<br>大于内容的大小，则会按实际内容的大小显示。</p>\n<p>接下来改变Label的宽度约束值为30，然后运行项目，显示效果如下：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/Screen%20Shot%202015-11-07%20at%2022.44.05.png\" alt=\"image\"></p>\n<p>水平方向上ContentCompressionResistancePriority的默认值为750，将其改为499，则显示效果如下：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/Screen%20Shot%202015-11-07%20at%2023.02.49.png\" alt=\"image\"></p>\n<p>这是因为当宽度约束的优先级大于ContentCompressionResistancePriority，优先以约束的宽度显示，当宽度约束的优先级小于ContentCompressionResistancePriority<br>时，如果Label的大小小于内容的大小，则会按实际内容的大小显示</p>\n<p>除了在SB中设置外，还可以在代码中设置，代码如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 设置水平方向上内容紧缩的优先级为高</span></span><br><span class=\"line\">[<span class=\"keyword\">self</span>.label setContentHuggingPriority:<span class=\"built_in\">UILayoutPriorityDefaultHigh</span> forAxis:<span class=\"built_in\">UILayoutConstraintAxisHorizontal</span>];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 设置垂直方向上阻止内容紧缩的优先级为低</span></span><br><span class=\"line\">[<span class=\"keyword\">self</span>.label setContentCompressionResistancePriority:<span class=\"built_in\">UILayoutPriorityDefaultLow</span> forAxis:<span class=\"built_in\">UILayoutConstraintAxisVertical</span>];</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<p>最近在使用Autolayout遇到了一个问题，我设置了一个UILabel的宽度约束，希望这个UILabel在显示时，如果内容宽度没有超过约束的宽度，则以约束的宽度显示，如果<br>内容宽度超过约束的宽度，则以内容的宽度显示，这时，如果只设置宽度约束，UILabel会始终以约束的宽度显示，如果降低宽度约束，则UILabel就会使用以内容的宽度显示，<br>始终无法达到我想要的效果，于是一番Google，便发现了Content Hugging与Content Compression Resistance两个概念。</p>\n<h2 id=\"基本概念\"><a href=\"#基本概念\" class=\"headerlink\" title=\"基本概念\"></a>基本概念</h2><p><strong>Content Hugging Priority</strong> 字面意思为内容紧缩，通过改变它的优先级，可以设置当View的大小大于实际内容的大小时，是否将View缩小，使其紧紧包裹住内容</p>\n<p><strong>Content Compression Resistance Priority</strong> 字面意思为阻止内容紧缩，通过改变它的优先级，可以设置当View的大小小于实际内容的大小时，是否将View扩大，使其紧紧包裹内容</p>\n<h2 id=\"实例应用\"><a href=\"#实例应用\" class=\"headerlink\" title=\"实例应用\"></a>实例应用</h2><p>本例将以一个UILabel为例，来说明一下ContentHugging与ContentCompressionResistance的具体设置方法。</p>\n<p>首先创建一个空项目，打开SB，拖入一个UILabel，然后设置一下三个约束：</p>\n<blockquote>\n<ol>\n<li>水平居中对齐</li>\n<li>垂直居中对齐</li>\n<li>宽度为100</li>\n</ol>\n</blockquote>\n<p>为类方便观察，给Label加一个背景颜色，设置完运行如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/Screen%20Shot%202015-11-07%20at%2022.46.17.png\" alt=\"image\"></p>\n<p>然后改变宽度约束的优先级为500，如图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/Screen%20Shot%202015-11-07%20at%2022.15.10.png\" alt=\"image\"></p>\n<p>然后就可以开始设置ContentHuggingPriority与ContentCompressionResistancePriority了，设置界面如下：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/Screen%20Shot%202015-11-07%20at%2022.30.26.png\" alt=\"image\"></p>\n<p>首先设置水平方向上的ContentHuggingPriority为501，运行项目，显示效果如下：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/Screen%20Shot%202015-11-07%20at%2022.44.05.png\" alt=\"image\"></p>\n<p>如果设置水平方向上的ContentHuggingPriority为499，运行项目，显示效果如下：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/Screen%20Shot%202015-11-07%20at%2022.46.17.png\" alt=\"image\"></p>\n<p>这是因为当宽度约束的优先级大于ContentHuggingPriority，优先以约束的宽度显示，当宽度约束的优先级小于ContentHuggingPriority时，如果Label的大小<br>大于内容的大小，则会按实际内容的大小显示。</p>\n<p>接下来改变Label的宽度约束值为30，然后运行项目，显示效果如下：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/Screen%20Shot%202015-11-07%20at%2022.44.05.png\" alt=\"image\"></p>\n<p>水平方向上ContentCompressionResistancePriority的默认值为750，将其改为499，则显示效果如下：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/Screen%20Shot%202015-11-07%20at%2023.02.49.png\" alt=\"image\"></p>\n<p>这是因为当宽度约束的优先级大于ContentCompressionResistancePriority，优先以约束的宽度显示，当宽度约束的优先级小于ContentCompressionResistancePriority<br>时，如果Label的大小小于内容的大小，则会按实际内容的大小显示</p>\n<p>除了在SB中设置外，还可以在代码中设置，代码如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 设置水平方向上内容紧缩的优先级为高</span></span><br><span class=\"line\">[<span class=\"keyword\">self</span>.label setContentHuggingPriority:<span class=\"built_in\">UILayoutPriorityDefaultHigh</span> forAxis:<span class=\"built_in\">UILayoutConstraintAxisHorizontal</span>];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 设置垂直方向上阻止内容紧缩的优先级为低</span></span><br><span class=\"line\">[<span class=\"keyword\">self</span>.label setContentCompressionResistancePriority:<span class=\"built_in\">UILayoutPriorityDefaultLow</span> forAxis:<span class=\"built_in\">UILayoutConstraintAxisVertical</span>];</span><br></pre></td></tr></table></figure>\n"},{"layout":"post","title":"CoreAnimation编程指南学习笔记(2)","_content":"\n## 第六章 动画\n\n### 动画类\n\n* CABasicAnimation提供了在图层的属性值间简单的插入。\n* CAKeyframeAnimation提供支持关键帧动画。你指定动画的一个图层属性的关键路径，一个表示在动画的每个阶段的价值的数组，还有一个关键帧时间的数组和时间函数。\n* CATransition提供了一个影响整个图层的内容过渡效果。在动画显示过程中采用淡出（fade）、推出(push)、显露(reveal)图层的内容。 常用的过渡效果可以通过提供你自己定制的核心图像滤镜来扩展。\n\n### 隐式动画\n\n隐式动画指所有修改CALayer的可动画属性，默认会都会带有动画。例如`self.layer.position = CGPointMake(200, 200);`默认是带有动画效果的。注意一定是修改layer属性，修改UIView的属性，默认是不带有隐式动画的。而且UIView默认带有的layer属性也是不带隐式动画的。\n\n### 显示动画\n\n```objectivec\n\tCABasicAnimation *anim = [CABasicAnimation \tanimationWithKeyPath:@\"opacity\"];\n    anim.fromValue = @(1.0);\n    anim.toValue = @(0.5);\n    anim.autoreverses = YES;\n    anim.repeatCount = 10;\n    anim.duration = 2;\n    [self.layer addAnimation:anim forKey:@\"anim\"];\n```\n\n## 第七章 事务\n\n图层的每一个改变都是事务的一部分。隐式分为显示事务和隐式事务。隐式事务由系统自动创建和提交，在修改图层属性时，系统会自动创建一个事务，在下一次运行循环时自动提交。显示事务由用户程序控制创建和提交。一旦创建了显示事务，系统就不会再创建隐式事务。\n\n### 使用显式事务禁止隐式动画\n\n```objectivec\n\t[CATransaction begin];\n    [CATransaction setDisableActions:YES];\n    self.layer.position = CGPointMake(200, 200);\n    [CATransaction commit];\n```\n\n### 修改隐式动画的动画时长\n\n```objectivec\n\t[CATransaction begin];\n    [CATransaction setAnimationDuration:2.0];\n    self.layer.position = CGPointMake(200, 200);\n    [CATransaction commit];\n```\n\n## 第八章 KVC\n\nCoreAnimation是通过KVC来实现对不同字段或关键路径进行动画的，使用方法如下\n\n```objectivec\n[theLayer setValue:[NSNumber numberWithInteger:50] forKey:@\"someKey\"];\n```\n\n使用`defaultValueForKey:`可以获取字段的默认值。\n\nCAAnimation提供支持使用关键路径访问选择的结构字段。目前支持的字段如下\n\n![](http://oldblog.shicishuzhai.com/2015-12-13_10-42-53.jpg)\n","source":"_posts/2015-12-13-CoreAnimation编程指南学习笔记(2).md","raw":"---\nlayout: post\ntitle: \"CoreAnimation编程指南学习笔记(2)\"\ncategories: \"读书笔记\"\n---\n\n## 第六章 动画\n\n### 动画类\n\n* CABasicAnimation提供了在图层的属性值间简单的插入。\n* CAKeyframeAnimation提供支持关键帧动画。你指定动画的一个图层属性的关键路径，一个表示在动画的每个阶段的价值的数组，还有一个关键帧时间的数组和时间函数。\n* CATransition提供了一个影响整个图层的内容过渡效果。在动画显示过程中采用淡出（fade）、推出(push)、显露(reveal)图层的内容。 常用的过渡效果可以通过提供你自己定制的核心图像滤镜来扩展。\n\n### 隐式动画\n\n隐式动画指所有修改CALayer的可动画属性，默认会都会带有动画。例如`self.layer.position = CGPointMake(200, 200);`默认是带有动画效果的。注意一定是修改layer属性，修改UIView的属性，默认是不带有隐式动画的。而且UIView默认带有的layer属性也是不带隐式动画的。\n\n### 显示动画\n\n```objectivec\n\tCABasicAnimation *anim = [CABasicAnimation \tanimationWithKeyPath:@\"opacity\"];\n    anim.fromValue = @(1.0);\n    anim.toValue = @(0.5);\n    anim.autoreverses = YES;\n    anim.repeatCount = 10;\n    anim.duration = 2;\n    [self.layer addAnimation:anim forKey:@\"anim\"];\n```\n\n## 第七章 事务\n\n图层的每一个改变都是事务的一部分。隐式分为显示事务和隐式事务。隐式事务由系统自动创建和提交，在修改图层属性时，系统会自动创建一个事务，在下一次运行循环时自动提交。显示事务由用户程序控制创建和提交。一旦创建了显示事务，系统就不会再创建隐式事务。\n\n### 使用显式事务禁止隐式动画\n\n```objectivec\n\t[CATransaction begin];\n    [CATransaction setDisableActions:YES];\n    self.layer.position = CGPointMake(200, 200);\n    [CATransaction commit];\n```\n\n### 修改隐式动画的动画时长\n\n```objectivec\n\t[CATransaction begin];\n    [CATransaction setAnimationDuration:2.0];\n    self.layer.position = CGPointMake(200, 200);\n    [CATransaction commit];\n```\n\n## 第八章 KVC\n\nCoreAnimation是通过KVC来实现对不同字段或关键路径进行动画的，使用方法如下\n\n```objectivec\n[theLayer setValue:[NSNumber numberWithInteger:50] forKey:@\"someKey\"];\n```\n\n使用`defaultValueForKey:`可以获取字段的默认值。\n\nCAAnimation提供支持使用关键路径访问选择的结构字段。目前支持的字段如下\n\n![](http://oldblog.shicishuzhai.com/2015-12-13_10-42-53.jpg)\n","slug":"CoreAnimation编程指南学习笔记(2)","published":1,"date":"2015-12-12T16:00:00.000Z","updated":"2019-01-13T04:01:04.442Z","comments":1,"photos":[],"link":"","_id":"cjutyfmf5000sc4c9wbm2ztyt","content":"<h2 id=\"第六章-动画\"><a href=\"#第六章-动画\" class=\"headerlink\" title=\"第六章 动画\"></a>第六章 动画</h2><h3 id=\"动画类\"><a href=\"#动画类\" class=\"headerlink\" title=\"动画类\"></a>动画类</h3><ul>\n<li>CABasicAnimation提供了在图层的属性值间简单的插入。</li>\n<li>CAKeyframeAnimation提供支持关键帧动画。你指定动画的一个图层属性的关键路径，一个表示在动画的每个阶段的价值的数组，还有一个关键帧时间的数组和时间函数。</li>\n<li>CATransition提供了一个影响整个图层的内容过渡效果。在动画显示过程中采用淡出（fade）、推出(push)、显露(reveal)图层的内容。 常用的过渡效果可以通过提供你自己定制的核心图像滤镜来扩展。</li>\n</ul>\n<h3 id=\"隐式动画\"><a href=\"#隐式动画\" class=\"headerlink\" title=\"隐式动画\"></a>隐式动画</h3><p>隐式动画指所有修改CALayer的可动画属性，默认会都会带有动画。例如<code>self.layer.position = CGPointMake(200, 200);</code>默认是带有动画效果的。注意一定是修改layer属性，修改UIView的属性，默认是不带有隐式动画的。而且UIView默认带有的layer属性也是不带隐式动画的。</p>\n<h3 id=\"显示动画\"><a href=\"#显示动画\" class=\"headerlink\" title=\"显示动画\"></a>显示动画</h3><figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">CABasicAnimation</span> *anim = [<span class=\"built_in\">CABasicAnimation</span> \tanimationWithKeyPath:<span class=\"string\">@\"opacity\"</span>];</span><br><span class=\"line\">   anim.fromValue = @(<span class=\"number\">1.0</span>);</span><br><span class=\"line\">   anim.toValue = @(<span class=\"number\">0.5</span>);</span><br><span class=\"line\">   anim.autoreverses = <span class=\"literal\">YES</span>;</span><br><span class=\"line\">   anim.repeatCount = <span class=\"number\">10</span>;</span><br><span class=\"line\">   anim.duration = <span class=\"number\">2</span>;</span><br><span class=\"line\">   [<span class=\"keyword\">self</span>.layer addAnimation:anim forKey:<span class=\"string\">@\"anim\"</span>];</span><br></pre></td></tr></table></figure>\n<h2 id=\"第七章-事务\"><a href=\"#第七章-事务\" class=\"headerlink\" title=\"第七章 事务\"></a>第七章 事务</h2><p>图层的每一个改变都是事务的一部分。隐式分为显示事务和隐式事务。隐式事务由系统自动创建和提交，在修改图层属性时，系统会自动创建一个事务，在下一次运行循环时自动提交。显示事务由用户程序控制创建和提交。一旦创建了显示事务，系统就不会再创建隐式事务。</p>\n<h3 id=\"使用显式事务禁止隐式动画\"><a href=\"#使用显式事务禁止隐式动画\" class=\"headerlink\" title=\"使用显式事务禁止隐式动画\"></a>使用显式事务禁止隐式动画</h3><figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"built_in\">CATransaction</span> begin];</span><br><span class=\"line\">   [<span class=\"built_in\">CATransaction</span> setDisableActions:<span class=\"literal\">YES</span>];</span><br><span class=\"line\">   <span class=\"keyword\">self</span>.layer.position = <span class=\"built_in\">CGPointMake</span>(<span class=\"number\">200</span>, <span class=\"number\">200</span>);</span><br><span class=\"line\">   [<span class=\"built_in\">CATransaction</span> commit];</span><br></pre></td></tr></table></figure>\n<h3 id=\"修改隐式动画的动画时长\"><a href=\"#修改隐式动画的动画时长\" class=\"headerlink\" title=\"修改隐式动画的动画时长\"></a>修改隐式动画的动画时长</h3><figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"built_in\">CATransaction</span> begin];</span><br><span class=\"line\">   [<span class=\"built_in\">CATransaction</span> setAnimationDuration:<span class=\"number\">2.0</span>];</span><br><span class=\"line\">   <span class=\"keyword\">self</span>.layer.position = <span class=\"built_in\">CGPointMake</span>(<span class=\"number\">200</span>, <span class=\"number\">200</span>);</span><br><span class=\"line\">   [<span class=\"built_in\">CATransaction</span> commit];</span><br></pre></td></tr></table></figure>\n<h2 id=\"第八章-KVC\"><a href=\"#第八章-KVC\" class=\"headerlink\" title=\"第八章 KVC\"></a>第八章 KVC</h2><p>CoreAnimation是通过KVC来实现对不同字段或关键路径进行动画的，使用方法如下</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[theLayer setValue:[<span class=\"built_in\">NSNumber</span> numberWithInteger:<span class=\"number\">50</span>] forKey:<span class=\"string\">@\"someKey\"</span>];</span><br></pre></td></tr></table></figure>\n<p>使用<code>defaultValueForKey:</code>可以获取字段的默认值。</p>\n<p>CAAnimation提供支持使用关键路径访问选择的结构字段。目前支持的字段如下</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/2015-12-13_10-42-53.jpg\" alt=\"\"></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"第六章-动画\"><a href=\"#第六章-动画\" class=\"headerlink\" title=\"第六章 动画\"></a>第六章 动画</h2><h3 id=\"动画类\"><a href=\"#动画类\" class=\"headerlink\" title=\"动画类\"></a>动画类</h3><ul>\n<li>CABasicAnimation提供了在图层的属性值间简单的插入。</li>\n<li>CAKeyframeAnimation提供支持关键帧动画。你指定动画的一个图层属性的关键路径，一个表示在动画的每个阶段的价值的数组，还有一个关键帧时间的数组和时间函数。</li>\n<li>CATransition提供了一个影响整个图层的内容过渡效果。在动画显示过程中采用淡出（fade）、推出(push)、显露(reveal)图层的内容。 常用的过渡效果可以通过提供你自己定制的核心图像滤镜来扩展。</li>\n</ul>\n<h3 id=\"隐式动画\"><a href=\"#隐式动画\" class=\"headerlink\" title=\"隐式动画\"></a>隐式动画</h3><p>隐式动画指所有修改CALayer的可动画属性，默认会都会带有动画。例如<code>self.layer.position = CGPointMake(200, 200);</code>默认是带有动画效果的。注意一定是修改layer属性，修改UIView的属性，默认是不带有隐式动画的。而且UIView默认带有的layer属性也是不带隐式动画的。</p>\n<h3 id=\"显示动画\"><a href=\"#显示动画\" class=\"headerlink\" title=\"显示动画\"></a>显示动画</h3><figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">CABasicAnimation</span> *anim = [<span class=\"built_in\">CABasicAnimation</span> \tanimationWithKeyPath:<span class=\"string\">@\"opacity\"</span>];</span><br><span class=\"line\">   anim.fromValue = @(<span class=\"number\">1.0</span>);</span><br><span class=\"line\">   anim.toValue = @(<span class=\"number\">0.5</span>);</span><br><span class=\"line\">   anim.autoreverses = <span class=\"literal\">YES</span>;</span><br><span class=\"line\">   anim.repeatCount = <span class=\"number\">10</span>;</span><br><span class=\"line\">   anim.duration = <span class=\"number\">2</span>;</span><br><span class=\"line\">   [<span class=\"keyword\">self</span>.layer addAnimation:anim forKey:<span class=\"string\">@\"anim\"</span>];</span><br></pre></td></tr></table></figure>\n<h2 id=\"第七章-事务\"><a href=\"#第七章-事务\" class=\"headerlink\" title=\"第七章 事务\"></a>第七章 事务</h2><p>图层的每一个改变都是事务的一部分。隐式分为显示事务和隐式事务。隐式事务由系统自动创建和提交，在修改图层属性时，系统会自动创建一个事务，在下一次运行循环时自动提交。显示事务由用户程序控制创建和提交。一旦创建了显示事务，系统就不会再创建隐式事务。</p>\n<h3 id=\"使用显式事务禁止隐式动画\"><a href=\"#使用显式事务禁止隐式动画\" class=\"headerlink\" title=\"使用显式事务禁止隐式动画\"></a>使用显式事务禁止隐式动画</h3><figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"built_in\">CATransaction</span> begin];</span><br><span class=\"line\">   [<span class=\"built_in\">CATransaction</span> setDisableActions:<span class=\"literal\">YES</span>];</span><br><span class=\"line\">   <span class=\"keyword\">self</span>.layer.position = <span class=\"built_in\">CGPointMake</span>(<span class=\"number\">200</span>, <span class=\"number\">200</span>);</span><br><span class=\"line\">   [<span class=\"built_in\">CATransaction</span> commit];</span><br></pre></td></tr></table></figure>\n<h3 id=\"修改隐式动画的动画时长\"><a href=\"#修改隐式动画的动画时长\" class=\"headerlink\" title=\"修改隐式动画的动画时长\"></a>修改隐式动画的动画时长</h3><figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"built_in\">CATransaction</span> begin];</span><br><span class=\"line\">   [<span class=\"built_in\">CATransaction</span> setAnimationDuration:<span class=\"number\">2.0</span>];</span><br><span class=\"line\">   <span class=\"keyword\">self</span>.layer.position = <span class=\"built_in\">CGPointMake</span>(<span class=\"number\">200</span>, <span class=\"number\">200</span>);</span><br><span class=\"line\">   [<span class=\"built_in\">CATransaction</span> commit];</span><br></pre></td></tr></table></figure>\n<h2 id=\"第八章-KVC\"><a href=\"#第八章-KVC\" class=\"headerlink\" title=\"第八章 KVC\"></a>第八章 KVC</h2><p>CoreAnimation是通过KVC来实现对不同字段或关键路径进行动画的，使用方法如下</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[theLayer setValue:[<span class=\"built_in\">NSNumber</span> numberWithInteger:<span class=\"number\">50</span>] forKey:<span class=\"string\">@\"someKey\"</span>];</span><br></pre></td></tr></table></figure>\n<p>使用<code>defaultValueForKey:</code>可以获取字段的默认值。</p>\n<p>CAAnimation提供支持使用关键路径访问选择的结构字段。目前支持的字段如下</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/2015-12-13_10-42-53.jpg\" alt=\"\"></p>\n"},{"layout":"post","title":"CoreAnimation编程指南学习笔记(1)","_content":"\n## 第一章：核心动画概念\n\nCoreAnimation框架中类的分类\n\n* 提供显示内容的图层类\n* 动画和计时类\n* 布局和约束类\n* 事务类，在原子更新的时候组合图层类\n\n\n### 图层类（Layer Classes）\n\nCALayer是所有层类的父类，几个常见的图层子类：CAScrollLayer,CATextLayer,CATiledLayer等\n\n### 动画类和计时类\n\nCAAnimation是动画类的基类，他实现了CAMediaTiming协议，提供了动画的持续时间，速度，和重复计数等。他也实现了CAAction协议，该协议为图层触发一个动画动作提供了标准化响应。\n\n动画类同时定义了一个使用贝塞尔曲线来描述动画改变的时间函数。\n\n* CATransition：提供了一个图层改变的过渡效果，他能影响图层的整个内容。\n* CAAnimationGroup:组动画\n* CAPropertyAnimation:属性动画\n* CABasicAnimation:基础动画\n* CAKeyframeAnimation:关键帧动画\n\n### 布局管理类\n\nCAConstraint类是一个布局管理类，他可以指定子图层类限制于你指定的约束集合。\n\n### 事务管理类\n\nCATransaction是核心动画里面负责协调多个动画原子更新显示操作。事务支持嵌套使用。核心动画支持两种事务：隐式事务和显式事务。\n\n## 第二章：渲染架构\n\n每个可见的图层树由两个相应的树组成，一个是呈现树，一个是渲染树。修改图层的一个属性，图层树里相应的值会被马上更新，但是呈现树里面的值在将要显示给用户的时候才会被更新为新值。\n\n## 第三章：几何变换\n\nanchorPoint:锚点，他指定了bounds相对于position的值，同时也作为变换时候的支点。在Autolayout设置约束时，锚点的值也会影响视图显示的位置。\n\n几何变换：CATransform3D，可以使用变换函数进行变换，例如CATransform3DMakeTranslation，CATransform3DTranslate等，也可以通过键值路径修改变换。\n\n## 第四章：图层树结构\n\n图层树与视图的结构很类似：\n\n* 每个图层定义了一个基于其父图层的坐标系的坐标系，当一个图层变换的时候，他的子图层同样变换\n* 一个动态的图层树，可以在程序运行的时候重新设置，图层可以添加，也可以删除\n\nios中，每个UIView的实例会自动创建一个CALayer类的实体，视图为图层提供了底层的事件处理，图层为视图提供了显示的内容。\n\n## 第五章：图层的内容\n\n使用CALayer无需创建继承子类，直接设置CALayer的contents属性即可，contents属性是一个CGImageRef类型，这样子创建比使用UIImageView效率要高\n\n```objectivec\nself.myLayer = [[CALayer alloc] init];\nself.myLayer.bounds = CGRectMake(0, 0, 100, 100);\nself.myLayer.position = CGPointMake(100, 100);\nself.myLayer.backgroundColor = [UIColor redColor].CGColor;\nUIImage *image = [UIImage imageNamed:@\"1.JPG\"];\nself.myLayer.contents = (__bridge id _Nullable)(image.CGImage);\n[self.view.layer addSublayer:self.myLayer];\n```\n\n\n也可以通过代理方法，提供CALayer的内容，有两个代理方法：`- (void)displayLayer:(CALayer *)theLayer`与`- (void)drawLayer:(CALayer *)layer inContext:(CGContextRef)ctx`, 要通知系统重绘图层，只需要调用CALayer的`setNeedsDisplay`或者`setNeedsDisplayInRect:`方法或者把图层的needsDisplayOnBoundsChange属性值设置为YES即可。\n\n\n```objectivec\n- (void)drawLayer:(CALayer *)layer inContext:(CGContextRef)ctx {\n    CGMutablePathRef thePath = CGPathCreateMutable();\n    CGPathMoveToPoint(thePath,NULL,15.0f,15.f);\n    CGPathAddCurveToPoint(thePath,\n                          NULL,\n                          15.f,250.0f,\n                          295.0f,250.0f,\n                          295.0f,15.0f);\n    CGContextBeginPath(ctx);\n    CGContextAddPath(ctx, thePath );\n    CGContextSetLineWidth(ctx, 5);\n    CGContextStrokePath(ctx);\n    // release the path\n    CFRelease(thePath);\n}\n\n- (void)displayLayer:(CALayer *)layer {\n    UIImage *image = [UIImage imageNamed:@\"1.JPG\"];\n    layer.contents = (__bridge id _Nullable)(image.CGImage);\n}\n```\n\n\n除了设置代理方法，也可以通过继承CALayer，重写`display`方法或`- (void)drawInContext:(CGContextRef)theContext`方法来自定义图层\n\nCALayer的contentsGravity属性相当于UIView的contentMode属性。\n","source":"_posts/2015-12-06-CoreAnimation编程指南学习笔记(1).md","raw":"---\nlayout: post\ntitle: \"CoreAnimation编程指南学习笔记(1)\"\ncategories: \"读书笔记\"\n---\n\n## 第一章：核心动画概念\n\nCoreAnimation框架中类的分类\n\n* 提供显示内容的图层类\n* 动画和计时类\n* 布局和约束类\n* 事务类，在原子更新的时候组合图层类\n\n\n### 图层类（Layer Classes）\n\nCALayer是所有层类的父类，几个常见的图层子类：CAScrollLayer,CATextLayer,CATiledLayer等\n\n### 动画类和计时类\n\nCAAnimation是动画类的基类，他实现了CAMediaTiming协议，提供了动画的持续时间，速度，和重复计数等。他也实现了CAAction协议，该协议为图层触发一个动画动作提供了标准化响应。\n\n动画类同时定义了一个使用贝塞尔曲线来描述动画改变的时间函数。\n\n* CATransition：提供了一个图层改变的过渡效果，他能影响图层的整个内容。\n* CAAnimationGroup:组动画\n* CAPropertyAnimation:属性动画\n* CABasicAnimation:基础动画\n* CAKeyframeAnimation:关键帧动画\n\n### 布局管理类\n\nCAConstraint类是一个布局管理类，他可以指定子图层类限制于你指定的约束集合。\n\n### 事务管理类\n\nCATransaction是核心动画里面负责协调多个动画原子更新显示操作。事务支持嵌套使用。核心动画支持两种事务：隐式事务和显式事务。\n\n## 第二章：渲染架构\n\n每个可见的图层树由两个相应的树组成，一个是呈现树，一个是渲染树。修改图层的一个属性，图层树里相应的值会被马上更新，但是呈现树里面的值在将要显示给用户的时候才会被更新为新值。\n\n## 第三章：几何变换\n\nanchorPoint:锚点，他指定了bounds相对于position的值，同时也作为变换时候的支点。在Autolayout设置约束时，锚点的值也会影响视图显示的位置。\n\n几何变换：CATransform3D，可以使用变换函数进行变换，例如CATransform3DMakeTranslation，CATransform3DTranslate等，也可以通过键值路径修改变换。\n\n## 第四章：图层树结构\n\n图层树与视图的结构很类似：\n\n* 每个图层定义了一个基于其父图层的坐标系的坐标系，当一个图层变换的时候，他的子图层同样变换\n* 一个动态的图层树，可以在程序运行的时候重新设置，图层可以添加，也可以删除\n\nios中，每个UIView的实例会自动创建一个CALayer类的实体，视图为图层提供了底层的事件处理，图层为视图提供了显示的内容。\n\n## 第五章：图层的内容\n\n使用CALayer无需创建继承子类，直接设置CALayer的contents属性即可，contents属性是一个CGImageRef类型，这样子创建比使用UIImageView效率要高\n\n```objectivec\nself.myLayer = [[CALayer alloc] init];\nself.myLayer.bounds = CGRectMake(0, 0, 100, 100);\nself.myLayer.position = CGPointMake(100, 100);\nself.myLayer.backgroundColor = [UIColor redColor].CGColor;\nUIImage *image = [UIImage imageNamed:@\"1.JPG\"];\nself.myLayer.contents = (__bridge id _Nullable)(image.CGImage);\n[self.view.layer addSublayer:self.myLayer];\n```\n\n\n也可以通过代理方法，提供CALayer的内容，有两个代理方法：`- (void)displayLayer:(CALayer *)theLayer`与`- (void)drawLayer:(CALayer *)layer inContext:(CGContextRef)ctx`, 要通知系统重绘图层，只需要调用CALayer的`setNeedsDisplay`或者`setNeedsDisplayInRect:`方法或者把图层的needsDisplayOnBoundsChange属性值设置为YES即可。\n\n\n```objectivec\n- (void)drawLayer:(CALayer *)layer inContext:(CGContextRef)ctx {\n    CGMutablePathRef thePath = CGPathCreateMutable();\n    CGPathMoveToPoint(thePath,NULL,15.0f,15.f);\n    CGPathAddCurveToPoint(thePath,\n                          NULL,\n                          15.f,250.0f,\n                          295.0f,250.0f,\n                          295.0f,15.0f);\n    CGContextBeginPath(ctx);\n    CGContextAddPath(ctx, thePath );\n    CGContextSetLineWidth(ctx, 5);\n    CGContextStrokePath(ctx);\n    // release the path\n    CFRelease(thePath);\n}\n\n- (void)displayLayer:(CALayer *)layer {\n    UIImage *image = [UIImage imageNamed:@\"1.JPG\"];\n    layer.contents = (__bridge id _Nullable)(image.CGImage);\n}\n```\n\n\n除了设置代理方法，也可以通过继承CALayer，重写`display`方法或`- (void)drawInContext:(CGContextRef)theContext`方法来自定义图层\n\nCALayer的contentsGravity属性相当于UIView的contentMode属性。\n","slug":"CoreAnimation编程指南学习笔记(1)","published":1,"date":"2015-12-05T16:00:00.000Z","updated":"2017-03-01T06:42:53.000Z","comments":1,"photos":[],"link":"","_id":"cjutyfmf5000uc4c99gitklmd","content":"<h2 id=\"第一章：核心动画概念\"><a href=\"#第一章：核心动画概念\" class=\"headerlink\" title=\"第一章：核心动画概念\"></a>第一章：核心动画概念</h2><p>CoreAnimation框架中类的分类</p>\n<ul>\n<li>提供显示内容的图层类</li>\n<li>动画和计时类</li>\n<li>布局和约束类</li>\n<li>事务类，在原子更新的时候组合图层类</li>\n</ul>\n<h3 id=\"图层类（Layer-Classes）\"><a href=\"#图层类（Layer-Classes）\" class=\"headerlink\" title=\"图层类（Layer Classes）\"></a>图层类（Layer Classes）</h3><p>CALayer是所有层类的父类，几个常见的图层子类：CAScrollLayer,CATextLayer,CATiledLayer等</p>\n<h3 id=\"动画类和计时类\"><a href=\"#动画类和计时类\" class=\"headerlink\" title=\"动画类和计时类\"></a>动画类和计时类</h3><p>CAAnimation是动画类的基类，他实现了CAMediaTiming协议，提供了动画的持续时间，速度，和重复计数等。他也实现了CAAction协议，该协议为图层触发一个动画动作提供了标准化响应。</p>\n<p>动画类同时定义了一个使用贝塞尔曲线来描述动画改变的时间函数。</p>\n<ul>\n<li>CATransition：提供了一个图层改变的过渡效果，他能影响图层的整个内容。</li>\n<li>CAAnimationGroup:组动画</li>\n<li>CAPropertyAnimation:属性动画</li>\n<li>CABasicAnimation:基础动画</li>\n<li>CAKeyframeAnimation:关键帧动画</li>\n</ul>\n<h3 id=\"布局管理类\"><a href=\"#布局管理类\" class=\"headerlink\" title=\"布局管理类\"></a>布局管理类</h3><p>CAConstraint类是一个布局管理类，他可以指定子图层类限制于你指定的约束集合。</p>\n<h3 id=\"事务管理类\"><a href=\"#事务管理类\" class=\"headerlink\" title=\"事务管理类\"></a>事务管理类</h3><p>CATransaction是核心动画里面负责协调多个动画原子更新显示操作。事务支持嵌套使用。核心动画支持两种事务：隐式事务和显式事务。</p>\n<h2 id=\"第二章：渲染架构\"><a href=\"#第二章：渲染架构\" class=\"headerlink\" title=\"第二章：渲染架构\"></a>第二章：渲染架构</h2><p>每个可见的图层树由两个相应的树组成，一个是呈现树，一个是渲染树。修改图层的一个属性，图层树里相应的值会被马上更新，但是呈现树里面的值在将要显示给用户的时候才会被更新为新值。</p>\n<h2 id=\"第三章：几何变换\"><a href=\"#第三章：几何变换\" class=\"headerlink\" title=\"第三章：几何变换\"></a>第三章：几何变换</h2><p>anchorPoint:锚点，他指定了bounds相对于position的值，同时也作为变换时候的支点。在Autolayout设置约束时，锚点的值也会影响视图显示的位置。</p>\n<p>几何变换：CATransform3D，可以使用变换函数进行变换，例如CATransform3DMakeTranslation，CATransform3DTranslate等，也可以通过键值路径修改变换。</p>\n<h2 id=\"第四章：图层树结构\"><a href=\"#第四章：图层树结构\" class=\"headerlink\" title=\"第四章：图层树结构\"></a>第四章：图层树结构</h2><p>图层树与视图的结构很类似：</p>\n<ul>\n<li>每个图层定义了一个基于其父图层的坐标系的坐标系，当一个图层变换的时候，他的子图层同样变换</li>\n<li>一个动态的图层树，可以在程序运行的时候重新设置，图层可以添加，也可以删除</li>\n</ul>\n<p>ios中，每个UIView的实例会自动创建一个CALayer类的实体，视图为图层提供了底层的事件处理，图层为视图提供了显示的内容。</p>\n<h2 id=\"第五章：图层的内容\"><a href=\"#第五章：图层的内容\" class=\"headerlink\" title=\"第五章：图层的内容\"></a>第五章：图层的内容</h2><p>使用CALayer无需创建继承子类，直接设置CALayer的contents属性即可，contents属性是一个CGImageRef类型，这样子创建比使用UIImageView效率要高</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">self</span>.myLayer = [[<span class=\"built_in\">CALayer</span> alloc] init];</span><br><span class=\"line\"><span class=\"keyword\">self</span>.myLayer.bounds = <span class=\"built_in\">CGRectMake</span>(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">100</span>, <span class=\"number\">100</span>);</span><br><span class=\"line\"><span class=\"keyword\">self</span>.myLayer.position = <span class=\"built_in\">CGPointMake</span>(<span class=\"number\">100</span>, <span class=\"number\">100</span>);</span><br><span class=\"line\"><span class=\"keyword\">self</span>.myLayer.backgroundColor = [<span class=\"built_in\">UIColor</span> redColor].CGColor;</span><br><span class=\"line\"><span class=\"built_in\">UIImage</span> *image = [<span class=\"built_in\">UIImage</span> imageNamed:<span class=\"string\">@\"1.JPG\"</span>];</span><br><span class=\"line\"><span class=\"keyword\">self</span>.myLayer.contents = (__bridge <span class=\"keyword\">id</span> _Nullable)(image.CGImage);</span><br><span class=\"line\">[<span class=\"keyword\">self</span>.view.layer addSublayer:<span class=\"keyword\">self</span>.myLayer];</span><br></pre></td></tr></table></figure>\n<p>也可以通过代理方法，提供CALayer的内容，有两个代理方法：<code>- (void)displayLayer:(CALayer *)theLayer</code>与<code>- (void)drawLayer:(CALayer *)layer inContext:(CGContextRef)ctx</code>, 要通知系统重绘图层，只需要调用CALayer的<code>setNeedsDisplay</code>或者<code>setNeedsDisplayInRect:</code>方法或者把图层的needsDisplayOnBoundsChange属性值设置为YES即可。</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)drawLayer:(<span class=\"built_in\">CALayer</span> *)layer inContext:(<span class=\"built_in\">CGContextRef</span>)ctx &#123;</span><br><span class=\"line\">    <span class=\"built_in\">CGMutablePathRef</span> thePath = <span class=\"built_in\">CGPathCreateMutable</span>();</span><br><span class=\"line\">    <span class=\"built_in\">CGPathMoveToPoint</span>(thePath,<span class=\"literal\">NULL</span>,<span class=\"number\">15.0</span>f,<span class=\"number\">15.</span>f);</span><br><span class=\"line\">    <span class=\"built_in\">CGPathAddCurveToPoint</span>(thePath,</span><br><span class=\"line\">                          <span class=\"literal\">NULL</span>,</span><br><span class=\"line\">                          <span class=\"number\">15.</span>f,<span class=\"number\">250.0</span>f,</span><br><span class=\"line\">                          <span class=\"number\">295.0</span>f,<span class=\"number\">250.0</span>f,</span><br><span class=\"line\">                          <span class=\"number\">295.0</span>f,<span class=\"number\">15.0</span>f);</span><br><span class=\"line\">    <span class=\"built_in\">CGContextBeginPath</span>(ctx);</span><br><span class=\"line\">    <span class=\"built_in\">CGContextAddPath</span>(ctx, thePath );</span><br><span class=\"line\">    <span class=\"built_in\">CGContextSetLineWidth</span>(ctx, <span class=\"number\">5</span>);</span><br><span class=\"line\">    <span class=\"built_in\">CGContextStrokePath</span>(ctx);</span><br><span class=\"line\">    <span class=\"comment\">// release the path</span></span><br><span class=\"line\">    <span class=\"built_in\">CFRelease</span>(thePath);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)displayLayer:(<span class=\"built_in\">CALayer</span> *)layer &#123;</span><br><span class=\"line\">    <span class=\"built_in\">UIImage</span> *image = [<span class=\"built_in\">UIImage</span> imageNamed:<span class=\"string\">@\"1.JPG\"</span>];</span><br><span class=\"line\">    layer.contents = (__bridge <span class=\"keyword\">id</span> _Nullable)(image.CGImage);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>除了设置代理方法，也可以通过继承CALayer，重写<code>display</code>方法或<code>- (void)drawInContext:(CGContextRef)theContext</code>方法来自定义图层</p>\n<p>CALayer的contentsGravity属性相当于UIView的contentMode属性。</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"第一章：核心动画概念\"><a href=\"#第一章：核心动画概念\" class=\"headerlink\" title=\"第一章：核心动画概念\"></a>第一章：核心动画概念</h2><p>CoreAnimation框架中类的分类</p>\n<ul>\n<li>提供显示内容的图层类</li>\n<li>动画和计时类</li>\n<li>布局和约束类</li>\n<li>事务类，在原子更新的时候组合图层类</li>\n</ul>\n<h3 id=\"图层类（Layer-Classes）\"><a href=\"#图层类（Layer-Classes）\" class=\"headerlink\" title=\"图层类（Layer Classes）\"></a>图层类（Layer Classes）</h3><p>CALayer是所有层类的父类，几个常见的图层子类：CAScrollLayer,CATextLayer,CATiledLayer等</p>\n<h3 id=\"动画类和计时类\"><a href=\"#动画类和计时类\" class=\"headerlink\" title=\"动画类和计时类\"></a>动画类和计时类</h3><p>CAAnimation是动画类的基类，他实现了CAMediaTiming协议，提供了动画的持续时间，速度，和重复计数等。他也实现了CAAction协议，该协议为图层触发一个动画动作提供了标准化响应。</p>\n<p>动画类同时定义了一个使用贝塞尔曲线来描述动画改变的时间函数。</p>\n<ul>\n<li>CATransition：提供了一个图层改变的过渡效果，他能影响图层的整个内容。</li>\n<li>CAAnimationGroup:组动画</li>\n<li>CAPropertyAnimation:属性动画</li>\n<li>CABasicAnimation:基础动画</li>\n<li>CAKeyframeAnimation:关键帧动画</li>\n</ul>\n<h3 id=\"布局管理类\"><a href=\"#布局管理类\" class=\"headerlink\" title=\"布局管理类\"></a>布局管理类</h3><p>CAConstraint类是一个布局管理类，他可以指定子图层类限制于你指定的约束集合。</p>\n<h3 id=\"事务管理类\"><a href=\"#事务管理类\" class=\"headerlink\" title=\"事务管理类\"></a>事务管理类</h3><p>CATransaction是核心动画里面负责协调多个动画原子更新显示操作。事务支持嵌套使用。核心动画支持两种事务：隐式事务和显式事务。</p>\n<h2 id=\"第二章：渲染架构\"><a href=\"#第二章：渲染架构\" class=\"headerlink\" title=\"第二章：渲染架构\"></a>第二章：渲染架构</h2><p>每个可见的图层树由两个相应的树组成，一个是呈现树，一个是渲染树。修改图层的一个属性，图层树里相应的值会被马上更新，但是呈现树里面的值在将要显示给用户的时候才会被更新为新值。</p>\n<h2 id=\"第三章：几何变换\"><a href=\"#第三章：几何变换\" class=\"headerlink\" title=\"第三章：几何变换\"></a>第三章：几何变换</h2><p>anchorPoint:锚点，他指定了bounds相对于position的值，同时也作为变换时候的支点。在Autolayout设置约束时，锚点的值也会影响视图显示的位置。</p>\n<p>几何变换：CATransform3D，可以使用变换函数进行变换，例如CATransform3DMakeTranslation，CATransform3DTranslate等，也可以通过键值路径修改变换。</p>\n<h2 id=\"第四章：图层树结构\"><a href=\"#第四章：图层树结构\" class=\"headerlink\" title=\"第四章：图层树结构\"></a>第四章：图层树结构</h2><p>图层树与视图的结构很类似：</p>\n<ul>\n<li>每个图层定义了一个基于其父图层的坐标系的坐标系，当一个图层变换的时候，他的子图层同样变换</li>\n<li>一个动态的图层树，可以在程序运行的时候重新设置，图层可以添加，也可以删除</li>\n</ul>\n<p>ios中，每个UIView的实例会自动创建一个CALayer类的实体，视图为图层提供了底层的事件处理，图层为视图提供了显示的内容。</p>\n<h2 id=\"第五章：图层的内容\"><a href=\"#第五章：图层的内容\" class=\"headerlink\" title=\"第五章：图层的内容\"></a>第五章：图层的内容</h2><p>使用CALayer无需创建继承子类，直接设置CALayer的contents属性即可，contents属性是一个CGImageRef类型，这样子创建比使用UIImageView效率要高</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">self</span>.myLayer = [[<span class=\"built_in\">CALayer</span> alloc] init];</span><br><span class=\"line\"><span class=\"keyword\">self</span>.myLayer.bounds = <span class=\"built_in\">CGRectMake</span>(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">100</span>, <span class=\"number\">100</span>);</span><br><span class=\"line\"><span class=\"keyword\">self</span>.myLayer.position = <span class=\"built_in\">CGPointMake</span>(<span class=\"number\">100</span>, <span class=\"number\">100</span>);</span><br><span class=\"line\"><span class=\"keyword\">self</span>.myLayer.backgroundColor = [<span class=\"built_in\">UIColor</span> redColor].CGColor;</span><br><span class=\"line\"><span class=\"built_in\">UIImage</span> *image = [<span class=\"built_in\">UIImage</span> imageNamed:<span class=\"string\">@\"1.JPG\"</span>];</span><br><span class=\"line\"><span class=\"keyword\">self</span>.myLayer.contents = (__bridge <span class=\"keyword\">id</span> _Nullable)(image.CGImage);</span><br><span class=\"line\">[<span class=\"keyword\">self</span>.view.layer addSublayer:<span class=\"keyword\">self</span>.myLayer];</span><br></pre></td></tr></table></figure>\n<p>也可以通过代理方法，提供CALayer的内容，有两个代理方法：<code>- (void)displayLayer:(CALayer *)theLayer</code>与<code>- (void)drawLayer:(CALayer *)layer inContext:(CGContextRef)ctx</code>, 要通知系统重绘图层，只需要调用CALayer的<code>setNeedsDisplay</code>或者<code>setNeedsDisplayInRect:</code>方法或者把图层的needsDisplayOnBoundsChange属性值设置为YES即可。</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)drawLayer:(<span class=\"built_in\">CALayer</span> *)layer inContext:(<span class=\"built_in\">CGContextRef</span>)ctx &#123;</span><br><span class=\"line\">    <span class=\"built_in\">CGMutablePathRef</span> thePath = <span class=\"built_in\">CGPathCreateMutable</span>();</span><br><span class=\"line\">    <span class=\"built_in\">CGPathMoveToPoint</span>(thePath,<span class=\"literal\">NULL</span>,<span class=\"number\">15.0</span>f,<span class=\"number\">15.</span>f);</span><br><span class=\"line\">    <span class=\"built_in\">CGPathAddCurveToPoint</span>(thePath,</span><br><span class=\"line\">                          <span class=\"literal\">NULL</span>,</span><br><span class=\"line\">                          <span class=\"number\">15.</span>f,<span class=\"number\">250.0</span>f,</span><br><span class=\"line\">                          <span class=\"number\">295.0</span>f,<span class=\"number\">250.0</span>f,</span><br><span class=\"line\">                          <span class=\"number\">295.0</span>f,<span class=\"number\">15.0</span>f);</span><br><span class=\"line\">    <span class=\"built_in\">CGContextBeginPath</span>(ctx);</span><br><span class=\"line\">    <span class=\"built_in\">CGContextAddPath</span>(ctx, thePath );</span><br><span class=\"line\">    <span class=\"built_in\">CGContextSetLineWidth</span>(ctx, <span class=\"number\">5</span>);</span><br><span class=\"line\">    <span class=\"built_in\">CGContextStrokePath</span>(ctx);</span><br><span class=\"line\">    <span class=\"comment\">// release the path</span></span><br><span class=\"line\">    <span class=\"built_in\">CFRelease</span>(thePath);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)displayLayer:(<span class=\"built_in\">CALayer</span> *)layer &#123;</span><br><span class=\"line\">    <span class=\"built_in\">UIImage</span> *image = [<span class=\"built_in\">UIImage</span> imageNamed:<span class=\"string\">@\"1.JPG\"</span>];</span><br><span class=\"line\">    layer.contents = (__bridge <span class=\"keyword\">id</span> _Nullable)(image.CGImage);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>除了设置代理方法，也可以通过继承CALayer，重写<code>display</code>方法或<code>- (void)drawInContext:(CGContextRef)theContext</code>方法来自定义图层</p>\n<p>CALayer的contentsGravity属性相当于UIView的contentMode属性。</p>\n"},{"layout":"post","title":"自动打包工具shenzhen使用简介","_content":"\nDailyBuild几乎是每一个iOS开发每天都必做的事情，尤其是到了项目测试阶段，每天都要打好几个安装包给测试同学去测试，如果使用以前的老方法，就得先手动Clean，然后Archive，然后创建响应的目录，把安装包和dSYM文件都拷进去，然后再上传到FTP，所有的这些操作，手动做下来至少得七八分钟，每天如果打三个包，那么将近半个小时就浪费在了打包上。\n\n为了节约打包话费的时间，出现了很多自动打包的工具，比较著名的有facebook的[xctool](https://github.com/facebook/xctool)以及Mattt Thompson大神的[shenzhen](https://github.com/nomad/shenzhen)（深圳，名字也很有意思，😄），本文主要介绍一下[shenzhen](https://github.com/nomad/shenzhen)的用法。\n\n[shenzhen](https://github.com/nomad/shenzhen)最大的特点就是它除了能个打包外，还可以发布，可以发布到[iTunes Connect](https://itunesconnect.apple.com)，也可以发布到[FIR.im](http://fir.im/)，[蒲公英](http://www.pgyer.com/)等第三方应用托管平台。让我们可以一键时间打包发布。\n\n## 安装\n\n使用gem安装\n\n```\n$ sudo gem install shenzhen\n```\n\n## 使用\n\n### 打包\n\n```\nipa build -w lazyaudio.xcworkspace --clean -d /Users/liujinlong/Desktop/App -s MyApp --ipa AppName.ipa -c Debug --verbose\n```\n\n说明：\n\n* -w 表示编译的workspace，如果没有创建workspace，可以使用-p来指定项目名\n* --clean 表示在编译前进行clean操作\n* -d 指定的是打包后生成的*.ipa和*.dSYM文件存放的目录，可以是不存在的目录，如果目录不存在，会自动创建\n* -s 指定scheme，如果存在多个scheme，需要明确指定的，如果不指定，在执行时会出现选项，进行选择\n* -ipa 指定生成的ipa的名称，注意要添加.ipa\n* -c 指定configuration，这里可以指定是以Debug还是以Release方法进行编译，注意第一个字母要大写，否则会出错\n* --verbose打印，更多log\n* 如果项目使用了CocoaPods，应该使用-w指定workspace进行编译，并且要明确指定编译哪个scheme\n\n### 发布\n\n发布的命令的很多，具体可以参考github的[README](https://github.com/nomad/shenzhen/blob/master/README.md)，这里只介绍上传到FTP一种\n\n```\nipa distribute:ftp --host 127.0.0.1 -port 8080 -f /Users/liujinlong/Desktop/App/AppName.ipa -u username -p 123456 --path /iOSApp/v1.1.2/20160101 --mkdir\n```\n\n说明：\n\n* --host 指定FTP服务器主机\n* --port 指定FTP服务器端口\n* -f 指定要上传的ipa文件的路径\n* -u 指定FTP服务器用户名\n* -p 指定FTP服务器密码\n* --path 指定FTP服务器路径\n* --mkdir 如果指定的FTP服务器路径不存在，则创建路径\n\n有了[shenzhen](https://github.com/nomad/shenzhen)这个工具，我们的打包工作就变得异常轻松，下面是我使用[shenzhen](https://github.com/nomad/shenzhen)写的一个shell脚本，可以一个命令完成打包并上传到FTP。\n\nGithub: [BuildIPAScript](https://github.com/liujinlongxa/BuildIPAScript)\n","source":"_posts/2016-01-01-自动打包工具shenzhen使用简介.md","raw":"---\nlayout: post\ntitle: \"自动打包工具shenzhen使用简介\"\ncategories: \"iOS开发\"\n---\n\nDailyBuild几乎是每一个iOS开发每天都必做的事情，尤其是到了项目测试阶段，每天都要打好几个安装包给测试同学去测试，如果使用以前的老方法，就得先手动Clean，然后Archive，然后创建响应的目录，把安装包和dSYM文件都拷进去，然后再上传到FTP，所有的这些操作，手动做下来至少得七八分钟，每天如果打三个包，那么将近半个小时就浪费在了打包上。\n\n为了节约打包话费的时间，出现了很多自动打包的工具，比较著名的有facebook的[xctool](https://github.com/facebook/xctool)以及Mattt Thompson大神的[shenzhen](https://github.com/nomad/shenzhen)（深圳，名字也很有意思，😄），本文主要介绍一下[shenzhen](https://github.com/nomad/shenzhen)的用法。\n\n[shenzhen](https://github.com/nomad/shenzhen)最大的特点就是它除了能个打包外，还可以发布，可以发布到[iTunes Connect](https://itunesconnect.apple.com)，也可以发布到[FIR.im](http://fir.im/)，[蒲公英](http://www.pgyer.com/)等第三方应用托管平台。让我们可以一键时间打包发布。\n\n## 安装\n\n使用gem安装\n\n```\n$ sudo gem install shenzhen\n```\n\n## 使用\n\n### 打包\n\n```\nipa build -w lazyaudio.xcworkspace --clean -d /Users/liujinlong/Desktop/App -s MyApp --ipa AppName.ipa -c Debug --verbose\n```\n\n说明：\n\n* -w 表示编译的workspace，如果没有创建workspace，可以使用-p来指定项目名\n* --clean 表示在编译前进行clean操作\n* -d 指定的是打包后生成的*.ipa和*.dSYM文件存放的目录，可以是不存在的目录，如果目录不存在，会自动创建\n* -s 指定scheme，如果存在多个scheme，需要明确指定的，如果不指定，在执行时会出现选项，进行选择\n* -ipa 指定生成的ipa的名称，注意要添加.ipa\n* -c 指定configuration，这里可以指定是以Debug还是以Release方法进行编译，注意第一个字母要大写，否则会出错\n* --verbose打印，更多log\n* 如果项目使用了CocoaPods，应该使用-w指定workspace进行编译，并且要明确指定编译哪个scheme\n\n### 发布\n\n发布的命令的很多，具体可以参考github的[README](https://github.com/nomad/shenzhen/blob/master/README.md)，这里只介绍上传到FTP一种\n\n```\nipa distribute:ftp --host 127.0.0.1 -port 8080 -f /Users/liujinlong/Desktop/App/AppName.ipa -u username -p 123456 --path /iOSApp/v1.1.2/20160101 --mkdir\n```\n\n说明：\n\n* --host 指定FTP服务器主机\n* --port 指定FTP服务器端口\n* -f 指定要上传的ipa文件的路径\n* -u 指定FTP服务器用户名\n* -p 指定FTP服务器密码\n* --path 指定FTP服务器路径\n* --mkdir 如果指定的FTP服务器路径不存在，则创建路径\n\n有了[shenzhen](https://github.com/nomad/shenzhen)这个工具，我们的打包工作就变得异常轻松，下面是我使用[shenzhen](https://github.com/nomad/shenzhen)写的一个shell脚本，可以一个命令完成打包并上传到FTP。\n\nGithub: [BuildIPAScript](https://github.com/liujinlongxa/BuildIPAScript)\n","slug":"自动打包工具shenzhen使用简介","published":1,"date":"2015-12-31T16:00:00.000Z","updated":"2017-03-01T06:42:53.000Z","comments":1,"photos":[],"link":"","_id":"cjutyfmf6000wc4c9ki5hbqlv","content":"<p>DailyBuild几乎是每一个iOS开发每天都必做的事情，尤其是到了项目测试阶段，每天都要打好几个安装包给测试同学去测试，如果使用以前的老方法，就得先手动Clean，然后Archive，然后创建响应的目录，把安装包和dSYM文件都拷进去，然后再上传到FTP，所有的这些操作，手动做下来至少得七八分钟，每天如果打三个包，那么将近半个小时就浪费在了打包上。</p>\n<p>为了节约打包话费的时间，出现了很多自动打包的工具，比较著名的有facebook的<a href=\"https://github.com/facebook/xctool\" target=\"_blank\" rel=\"noopener\">xctool</a>以及Mattt Thompson大神的<a href=\"https://github.com/nomad/shenzhen\" target=\"_blank\" rel=\"noopener\">shenzhen</a>（深圳，名字也很有意思，😄），本文主要介绍一下<a href=\"https://github.com/nomad/shenzhen\" target=\"_blank\" rel=\"noopener\">shenzhen</a>的用法。</p>\n<p><a href=\"https://github.com/nomad/shenzhen\" target=\"_blank\" rel=\"noopener\">shenzhen</a>最大的特点就是它除了能个打包外，还可以发布，可以发布到<a href=\"https://itunesconnect.apple.com\" target=\"_blank\" rel=\"noopener\">iTunes Connect</a>，也可以发布到<a href=\"http://fir.im/\" target=\"_blank\" rel=\"noopener\">FIR.im</a>，<a href=\"http://www.pgyer.com/\" target=\"_blank\" rel=\"noopener\">蒲公英</a>等第三方应用托管平台。让我们可以一键时间打包发布。</p>\n<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><p>使用gem安装</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo gem install shenzhen</span><br></pre></td></tr></table></figure>\n<h2 id=\"使用\"><a href=\"#使用\" class=\"headerlink\" title=\"使用\"></a>使用</h2><h3 id=\"打包\"><a href=\"#打包\" class=\"headerlink\" title=\"打包\"></a>打包</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ipa build -w lazyaudio.xcworkspace --clean -d /Users/liujinlong/Desktop/App -s MyApp --ipa AppName.ipa -c Debug --verbose</span><br></pre></td></tr></table></figure>\n<p>说明：</p>\n<ul>\n<li>-w 表示编译的workspace，如果没有创建workspace，可以使用-p来指定项目名</li>\n<li>–clean 表示在编译前进行clean操作</li>\n<li>-d 指定的是打包后生成的<em>.ipa和</em>.dSYM文件存放的目录，可以是不存在的目录，如果目录不存在，会自动创建</li>\n<li>-s 指定scheme，如果存在多个scheme，需要明确指定的，如果不指定，在执行时会出现选项，进行选择</li>\n<li>-ipa 指定生成的ipa的名称，注意要添加.ipa</li>\n<li>-c 指定configuration，这里可以指定是以Debug还是以Release方法进行编译，注意第一个字母要大写，否则会出错</li>\n<li>–verbose打印，更多log</li>\n<li>如果项目使用了CocoaPods，应该使用-w指定workspace进行编译，并且要明确指定编译哪个scheme</li>\n</ul>\n<h3 id=\"发布\"><a href=\"#发布\" class=\"headerlink\" title=\"发布\"></a>发布</h3><p>发布的命令的很多，具体可以参考github的<a href=\"https://github.com/nomad/shenzhen/blob/master/README.md\" target=\"_blank\" rel=\"noopener\">README</a>，这里只介绍上传到FTP一种</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ipa distribute:ftp --host 127.0.0.1 -port 8080 -f /Users/liujinlong/Desktop/App/AppName.ipa -u username -p 123456 --path /iOSApp/v1.1.2/20160101 --mkdir</span><br></pre></td></tr></table></figure>\n<p>说明：</p>\n<ul>\n<li>–host 指定FTP服务器主机</li>\n<li>–port 指定FTP服务器端口</li>\n<li>-f 指定要上传的ipa文件的路径</li>\n<li>-u 指定FTP服务器用户名</li>\n<li>-p 指定FTP服务器密码</li>\n<li>–path 指定FTP服务器路径</li>\n<li>–mkdir 如果指定的FTP服务器路径不存在，则创建路径</li>\n</ul>\n<p>有了<a href=\"https://github.com/nomad/shenzhen\" target=\"_blank\" rel=\"noopener\">shenzhen</a>这个工具，我们的打包工作就变得异常轻松，下面是我使用<a href=\"https://github.com/nomad/shenzhen\" target=\"_blank\" rel=\"noopener\">shenzhen</a>写的一个shell脚本，可以一个命令完成打包并上传到FTP。</p>\n<p>Github: <a href=\"https://github.com/liujinlongxa/BuildIPAScript\" target=\"_blank\" rel=\"noopener\">BuildIPAScript</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>DailyBuild几乎是每一个iOS开发每天都必做的事情，尤其是到了项目测试阶段，每天都要打好几个安装包给测试同学去测试，如果使用以前的老方法，就得先手动Clean，然后Archive，然后创建响应的目录，把安装包和dSYM文件都拷进去，然后再上传到FTP，所有的这些操作，手动做下来至少得七八分钟，每天如果打三个包，那么将近半个小时就浪费在了打包上。</p>\n<p>为了节约打包话费的时间，出现了很多自动打包的工具，比较著名的有facebook的<a href=\"https://github.com/facebook/xctool\" target=\"_blank\" rel=\"noopener\">xctool</a>以及Mattt Thompson大神的<a href=\"https://github.com/nomad/shenzhen\" target=\"_blank\" rel=\"noopener\">shenzhen</a>（深圳，名字也很有意思，😄），本文主要介绍一下<a href=\"https://github.com/nomad/shenzhen\" target=\"_blank\" rel=\"noopener\">shenzhen</a>的用法。</p>\n<p><a href=\"https://github.com/nomad/shenzhen\" target=\"_blank\" rel=\"noopener\">shenzhen</a>最大的特点就是它除了能个打包外，还可以发布，可以发布到<a href=\"https://itunesconnect.apple.com\" target=\"_blank\" rel=\"noopener\">iTunes Connect</a>，也可以发布到<a href=\"http://fir.im/\" target=\"_blank\" rel=\"noopener\">FIR.im</a>，<a href=\"http://www.pgyer.com/\" target=\"_blank\" rel=\"noopener\">蒲公英</a>等第三方应用托管平台。让我们可以一键时间打包发布。</p>\n<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><p>使用gem安装</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo gem install shenzhen</span><br></pre></td></tr></table></figure>\n<h2 id=\"使用\"><a href=\"#使用\" class=\"headerlink\" title=\"使用\"></a>使用</h2><h3 id=\"打包\"><a href=\"#打包\" class=\"headerlink\" title=\"打包\"></a>打包</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ipa build -w lazyaudio.xcworkspace --clean -d /Users/liujinlong/Desktop/App -s MyApp --ipa AppName.ipa -c Debug --verbose</span><br></pre></td></tr></table></figure>\n<p>说明：</p>\n<ul>\n<li>-w 表示编译的workspace，如果没有创建workspace，可以使用-p来指定项目名</li>\n<li>–clean 表示在编译前进行clean操作</li>\n<li>-d 指定的是打包后生成的<em>.ipa和</em>.dSYM文件存放的目录，可以是不存在的目录，如果目录不存在，会自动创建</li>\n<li>-s 指定scheme，如果存在多个scheme，需要明确指定的，如果不指定，在执行时会出现选项，进行选择</li>\n<li>-ipa 指定生成的ipa的名称，注意要添加.ipa</li>\n<li>-c 指定configuration，这里可以指定是以Debug还是以Release方法进行编译，注意第一个字母要大写，否则会出错</li>\n<li>–verbose打印，更多log</li>\n<li>如果项目使用了CocoaPods，应该使用-w指定workspace进行编译，并且要明确指定编译哪个scheme</li>\n</ul>\n<h3 id=\"发布\"><a href=\"#发布\" class=\"headerlink\" title=\"发布\"></a>发布</h3><p>发布的命令的很多，具体可以参考github的<a href=\"https://github.com/nomad/shenzhen/blob/master/README.md\" target=\"_blank\" rel=\"noopener\">README</a>，这里只介绍上传到FTP一种</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ipa distribute:ftp --host 127.0.0.1 -port 8080 -f /Users/liujinlong/Desktop/App/AppName.ipa -u username -p 123456 --path /iOSApp/v1.1.2/20160101 --mkdir</span><br></pre></td></tr></table></figure>\n<p>说明：</p>\n<ul>\n<li>–host 指定FTP服务器主机</li>\n<li>–port 指定FTP服务器端口</li>\n<li>-f 指定要上传的ipa文件的路径</li>\n<li>-u 指定FTP服务器用户名</li>\n<li>-p 指定FTP服务器密码</li>\n<li>–path 指定FTP服务器路径</li>\n<li>–mkdir 如果指定的FTP服务器路径不存在，则创建路径</li>\n</ul>\n<p>有了<a href=\"https://github.com/nomad/shenzhen\" target=\"_blank\" rel=\"noopener\">shenzhen</a>这个工具，我们的打包工作就变得异常轻松，下面是我使用<a href=\"https://github.com/nomad/shenzhen\" target=\"_blank\" rel=\"noopener\">shenzhen</a>写的一个shell脚本，可以一个命令完成打包并上传到FTP。</p>\n<p>Github: <a href=\"https://github.com/liujinlongxa/BuildIPAScript\" target=\"_blank\" rel=\"noopener\">BuildIPAScript</a></p>\n"},{"layout":"post","title":"《ios核心动画高级技巧》阅读笔记(1)","_content":"## 第一章 图层树\n\n### CoreAnimation简介\n\n* 动画只是CoreAnimation特性的冰山一角\n* CoreAnimation是一个复合引擎，它的职责就是尽可能快地组合屏幕上不同的可视内容，这个内容被分解成独立的图层，存储在一个叫图层树的体系中。\n\n### 图层与视图\n\n* CALayer类在概念上和UIView类似，同样是一些被层级关系树管理的矩形块，同样可以含有一些内容。他有一些方法和属性用来做动画和变换。\n* 和UIView最大的不同是，CALayer不处理用户的交互。CALayer并不清楚具体的响应链，因此它并不能响应时间。\n* 每个UIView都有一个CALayer属性，即所谓的bakinglayer，视图的职责就是创建并管理这个图层。视图的层级关系与其图层的层级关系是相同的。\n* 真正在界面上显示和进行动画的都是CALayer，UIView只是对CALayer的一个封装而已。\n* 进行视图和图层的分类，是为了职责分离，避免重复的代码。ios中视图为UIView，MacOS中视图为NSView，但是他们的图层都是CALayer。\n\n### 图层的能力\n\n* CALayer能做但UIView不能做的东西：\n    * 阴影，圆角，带颜色的边框\n    * 3D变换\n    * 非矩形范围\n    * 透明遮罩\n    * 多级非线性动画\n\n### 使用图层\n\n* 可以直接在UIView的layer属性中添加图层，如下\n\n```objectivec\n- (void)viewDidLoad {\n    [super viewDidLoad];\n\n    CALayer *blueLayer = [[CALayer alloc] init];\n    blueLayer.frame = CGRectMake(50, 50, 50, 50);\n    blueLayer.backgroundColor = [UIColor blueColor].CGColor;\n    [self.layerView.layer addSublayer:blueLayer];\n\n}\n```\n* 使用图层而不使用视图的情况\n    * 开发可以在MacOS上运行的跨平台应用\n    * 使用多种CALayer的子类（特殊图层），并且不想创建单独的UIView去封装他们\n    * 做一些对性能特别挑剔的工作\n\n## 第二章 寄宿图\n\nCALayer除了可以设置颜色，也可以设置一张图片，这张图片称为CALayer的寄宿图。\n\n### contents属性\n\n* CALayer有一个contents的属性，它虽然是id类型，但是必须设置一个CGImage，才能显示出图片，设置为其他类型，都只会显示一个空白的区域。这种现象是有Mac OS的历史历史原因造成的。在Mac OS上，contents对CGImage和NSImage类型的值都起作用，但在ios中，不能给contents设置一个UIImage。\n* contentGravity属性：与UIView中的contentMode属性对应\n* contentScale属性：定义了寄宿图的像素尺寸和视图的比例，默认为1.0。UIView中与之对应的属性为contentScaleFactor。使用UIImage加载图片会自动根据屏幕加载2x或3x图片，但是使用CGImage则不会。这样我们就需要手动设置contentScale属性来修复这个问题。一般使用代码设置寄宿图，都会手动设置contentScale，如下：`blueLayer.contentsScale = [[UIScreen mainScreen] scale];`\n* maskToBounds属性用来决定是否显示超出边界的内容\n\n### contentsRect属性\n\n* contentRect属性允许我们在图层边框里显示寄宿图的一个子域，这要比contentGravity属性灵活许多。contentRect是一个单位坐标，长宽最大都为1。默认为{0，0，1，1}，当设置为{0，0，0.5，0.5}，则显示效果如下图：\n\n![contentsRect](http://oldblog.shicishuzhai.com/004ddacd5a9506600889fc2c32686262.png)\n\n* contentRect的另外一个用途就是ImageSprites（图片拼合），把多张图片放在一张大的图片上，然后使用contentRect分别显示每一张图片，去掉不显示的部分，这就是图片拼合。在游戏编程中非常常见。加载一张大图要比加载多张小图效率要高。\n\n### contentsCenter属性\n\n* contentsCenter属性表示图层相对于寄宿图的位置与大小，可以用来定义图片的拉伸。\n* 如下图，虚线框为图层的区域，灰色为内容的区域。\n\n![contentCenter](http://oldblog.shicishuzhai.com/01278b2b759e5b3c5fc5ae2a961a71ee.png)\n\n* 该属性相当于UIImage的`resizableImageWithCapInsets:`方法\n\n\n### customDrawing\n\n* 除了直接给contents属性设置CGImage，也可以通过CoreGraphics直接绘制寄宿图。使用UIVIew 的drawRect:方法来自定义绘制\n* 除了重写drawRect:方法，也可以通过设置CALayer的代理，使用代理方法`(void)displayLayer:`来实现重绘，但是强烈建议使用前一种方法。\n","source":"_posts/2015-12-27-《ios核心动画高级技巧》阅读笔记(1).md","raw":"---\nlayout: post\ntitle: \"《ios核心动画高级技巧》阅读笔记(1)\"\ncategories: \"读书笔记\"\n---\n## 第一章 图层树\n\n### CoreAnimation简介\n\n* 动画只是CoreAnimation特性的冰山一角\n* CoreAnimation是一个复合引擎，它的职责就是尽可能快地组合屏幕上不同的可视内容，这个内容被分解成独立的图层，存储在一个叫图层树的体系中。\n\n### 图层与视图\n\n* CALayer类在概念上和UIView类似，同样是一些被层级关系树管理的矩形块，同样可以含有一些内容。他有一些方法和属性用来做动画和变换。\n* 和UIView最大的不同是，CALayer不处理用户的交互。CALayer并不清楚具体的响应链，因此它并不能响应时间。\n* 每个UIView都有一个CALayer属性，即所谓的bakinglayer，视图的职责就是创建并管理这个图层。视图的层级关系与其图层的层级关系是相同的。\n* 真正在界面上显示和进行动画的都是CALayer，UIView只是对CALayer的一个封装而已。\n* 进行视图和图层的分类，是为了职责分离，避免重复的代码。ios中视图为UIView，MacOS中视图为NSView，但是他们的图层都是CALayer。\n\n### 图层的能力\n\n* CALayer能做但UIView不能做的东西：\n    * 阴影，圆角，带颜色的边框\n    * 3D变换\n    * 非矩形范围\n    * 透明遮罩\n    * 多级非线性动画\n\n### 使用图层\n\n* 可以直接在UIView的layer属性中添加图层，如下\n\n```objectivec\n- (void)viewDidLoad {\n    [super viewDidLoad];\n\n    CALayer *blueLayer = [[CALayer alloc] init];\n    blueLayer.frame = CGRectMake(50, 50, 50, 50);\n    blueLayer.backgroundColor = [UIColor blueColor].CGColor;\n    [self.layerView.layer addSublayer:blueLayer];\n\n}\n```\n* 使用图层而不使用视图的情况\n    * 开发可以在MacOS上运行的跨平台应用\n    * 使用多种CALayer的子类（特殊图层），并且不想创建单独的UIView去封装他们\n    * 做一些对性能特别挑剔的工作\n\n## 第二章 寄宿图\n\nCALayer除了可以设置颜色，也可以设置一张图片，这张图片称为CALayer的寄宿图。\n\n### contents属性\n\n* CALayer有一个contents的属性，它虽然是id类型，但是必须设置一个CGImage，才能显示出图片，设置为其他类型，都只会显示一个空白的区域。这种现象是有Mac OS的历史历史原因造成的。在Mac OS上，contents对CGImage和NSImage类型的值都起作用，但在ios中，不能给contents设置一个UIImage。\n* contentGravity属性：与UIView中的contentMode属性对应\n* contentScale属性：定义了寄宿图的像素尺寸和视图的比例，默认为1.0。UIView中与之对应的属性为contentScaleFactor。使用UIImage加载图片会自动根据屏幕加载2x或3x图片，但是使用CGImage则不会。这样我们就需要手动设置contentScale属性来修复这个问题。一般使用代码设置寄宿图，都会手动设置contentScale，如下：`blueLayer.contentsScale = [[UIScreen mainScreen] scale];`\n* maskToBounds属性用来决定是否显示超出边界的内容\n\n### contentsRect属性\n\n* contentRect属性允许我们在图层边框里显示寄宿图的一个子域，这要比contentGravity属性灵活许多。contentRect是一个单位坐标，长宽最大都为1。默认为{0，0，1，1}，当设置为{0，0，0.5，0.5}，则显示效果如下图：\n\n![contentsRect](http://oldblog.shicishuzhai.com/004ddacd5a9506600889fc2c32686262.png)\n\n* contentRect的另外一个用途就是ImageSprites（图片拼合），把多张图片放在一张大的图片上，然后使用contentRect分别显示每一张图片，去掉不显示的部分，这就是图片拼合。在游戏编程中非常常见。加载一张大图要比加载多张小图效率要高。\n\n### contentsCenter属性\n\n* contentsCenter属性表示图层相对于寄宿图的位置与大小，可以用来定义图片的拉伸。\n* 如下图，虚线框为图层的区域，灰色为内容的区域。\n\n![contentCenter](http://oldblog.shicishuzhai.com/01278b2b759e5b3c5fc5ae2a961a71ee.png)\n\n* 该属性相当于UIImage的`resizableImageWithCapInsets:`方法\n\n\n### customDrawing\n\n* 除了直接给contents属性设置CGImage，也可以通过CoreGraphics直接绘制寄宿图。使用UIVIew 的drawRect:方法来自定义绘制\n* 除了重写drawRect:方法，也可以通过设置CALayer的代理，使用代理方法`(void)displayLayer:`来实现重绘，但是强烈建议使用前一种方法。\n","slug":"《ios核心动画高级技巧》阅读笔记(1)","published":1,"date":"2015-12-26T16:00:00.000Z","updated":"2019-01-13T04:01:04.552Z","comments":1,"photos":[],"link":"","_id":"cjutyfmf7000yc4c9urgy5w7u","content":"<h2 id=\"第一章-图层树\"><a href=\"#第一章-图层树\" class=\"headerlink\" title=\"第一章 图层树\"></a>第一章 图层树</h2><h3 id=\"CoreAnimation简介\"><a href=\"#CoreAnimation简介\" class=\"headerlink\" title=\"CoreAnimation简介\"></a>CoreAnimation简介</h3><ul>\n<li>动画只是CoreAnimation特性的冰山一角</li>\n<li>CoreAnimation是一个复合引擎，它的职责就是尽可能快地组合屏幕上不同的可视内容，这个内容被分解成独立的图层，存储在一个叫图层树的体系中。</li>\n</ul>\n<h3 id=\"图层与视图\"><a href=\"#图层与视图\" class=\"headerlink\" title=\"图层与视图\"></a>图层与视图</h3><ul>\n<li>CALayer类在概念上和UIView类似，同样是一些被层级关系树管理的矩形块，同样可以含有一些内容。他有一些方法和属性用来做动画和变换。</li>\n<li>和UIView最大的不同是，CALayer不处理用户的交互。CALayer并不清楚具体的响应链，因此它并不能响应时间。</li>\n<li>每个UIView都有一个CALayer属性，即所谓的bakinglayer，视图的职责就是创建并管理这个图层。视图的层级关系与其图层的层级关系是相同的。</li>\n<li>真正在界面上显示和进行动画的都是CALayer，UIView只是对CALayer的一个封装而已。</li>\n<li>进行视图和图层的分类，是为了职责分离，避免重复的代码。ios中视图为UIView，MacOS中视图为NSView，但是他们的图层都是CALayer。</li>\n</ul>\n<h3 id=\"图层的能力\"><a href=\"#图层的能力\" class=\"headerlink\" title=\"图层的能力\"></a>图层的能力</h3><ul>\n<li>CALayer能做但UIView不能做的东西：<ul>\n<li>阴影，圆角，带颜色的边框</li>\n<li>3D变换</li>\n<li>非矩形范围</li>\n<li>透明遮罩</li>\n<li>多级非线性动画</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"使用图层\"><a href=\"#使用图层\" class=\"headerlink\" title=\"使用图层\"></a>使用图层</h3><ul>\n<li>可以直接在UIView的layer属性中添加图层，如下</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)viewDidLoad &#123;</span><br><span class=\"line\">    [<span class=\"keyword\">super</span> viewDidLoad];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">CALayer</span> *blueLayer = [[<span class=\"built_in\">CALayer</span> alloc] init];</span><br><span class=\"line\">    blueLayer.frame = <span class=\"built_in\">CGRectMake</span>(<span class=\"number\">50</span>, <span class=\"number\">50</span>, <span class=\"number\">50</span>, <span class=\"number\">50</span>);</span><br><span class=\"line\">    blueLayer.backgroundColor = [<span class=\"built_in\">UIColor</span> blueColor].CGColor;</span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.layerView.layer addSublayer:blueLayer];</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>使用图层而不使用视图的情况<ul>\n<li>开发可以在MacOS上运行的跨平台应用</li>\n<li>使用多种CALayer的子类（特殊图层），并且不想创建单独的UIView去封装他们</li>\n<li>做一些对性能特别挑剔的工作</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"第二章-寄宿图\"><a href=\"#第二章-寄宿图\" class=\"headerlink\" title=\"第二章 寄宿图\"></a>第二章 寄宿图</h2><p>CALayer除了可以设置颜色，也可以设置一张图片，这张图片称为CALayer的寄宿图。</p>\n<h3 id=\"contents属性\"><a href=\"#contents属性\" class=\"headerlink\" title=\"contents属性\"></a>contents属性</h3><ul>\n<li>CALayer有一个contents的属性，它虽然是id类型，但是必须设置一个CGImage，才能显示出图片，设置为其他类型，都只会显示一个空白的区域。这种现象是有Mac OS的历史历史原因造成的。在Mac OS上，contents对CGImage和NSImage类型的值都起作用，但在ios中，不能给contents设置一个UIImage。</li>\n<li>contentGravity属性：与UIView中的contentMode属性对应</li>\n<li>contentScale属性：定义了寄宿图的像素尺寸和视图的比例，默认为1.0。UIView中与之对应的属性为contentScaleFactor。使用UIImage加载图片会自动根据屏幕加载2x或3x图片，但是使用CGImage则不会。这样我们就需要手动设置contentScale属性来修复这个问题。一般使用代码设置寄宿图，都会手动设置contentScale，如下：<code>blueLayer.contentsScale = [[UIScreen mainScreen] scale];</code></li>\n<li>maskToBounds属性用来决定是否显示超出边界的内容</li>\n</ul>\n<h3 id=\"contentsRect属性\"><a href=\"#contentsRect属性\" class=\"headerlink\" title=\"contentsRect属性\"></a>contentsRect属性</h3><ul>\n<li>contentRect属性允许我们在图层边框里显示寄宿图的一个子域，这要比contentGravity属性灵活许多。contentRect是一个单位坐标，长宽最大都为1。默认为{0，0，1，1}，当设置为{0，0，0.5，0.5}，则显示效果如下图：</li>\n</ul>\n<p><img src=\"http://oldblog.shicishuzhai.com/004ddacd5a9506600889fc2c32686262.png\" alt=\"contentsRect\"></p>\n<ul>\n<li>contentRect的另外一个用途就是ImageSprites（图片拼合），把多张图片放在一张大的图片上，然后使用contentRect分别显示每一张图片，去掉不显示的部分，这就是图片拼合。在游戏编程中非常常见。加载一张大图要比加载多张小图效率要高。</li>\n</ul>\n<h3 id=\"contentsCenter属性\"><a href=\"#contentsCenter属性\" class=\"headerlink\" title=\"contentsCenter属性\"></a>contentsCenter属性</h3><ul>\n<li>contentsCenter属性表示图层相对于寄宿图的位置与大小，可以用来定义图片的拉伸。</li>\n<li>如下图，虚线框为图层的区域，灰色为内容的区域。</li>\n</ul>\n<p><img src=\"http://oldblog.shicishuzhai.com/01278b2b759e5b3c5fc5ae2a961a71ee.png\" alt=\"contentCenter\"></p>\n<ul>\n<li>该属性相当于UIImage的<code>resizableImageWithCapInsets:</code>方法</li>\n</ul>\n<h3 id=\"customDrawing\"><a href=\"#customDrawing\" class=\"headerlink\" title=\"customDrawing\"></a>customDrawing</h3><ul>\n<li>除了直接给contents属性设置CGImage，也可以通过CoreGraphics直接绘制寄宿图。使用UIVIew 的drawRect:方法来自定义绘制</li>\n<li>除了重写drawRect:方法，也可以通过设置CALayer的代理，使用代理方法<code>(void)displayLayer:</code>来实现重绘，但是强烈建议使用前一种方法。</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"第一章-图层树\"><a href=\"#第一章-图层树\" class=\"headerlink\" title=\"第一章 图层树\"></a>第一章 图层树</h2><h3 id=\"CoreAnimation简介\"><a href=\"#CoreAnimation简介\" class=\"headerlink\" title=\"CoreAnimation简介\"></a>CoreAnimation简介</h3><ul>\n<li>动画只是CoreAnimation特性的冰山一角</li>\n<li>CoreAnimation是一个复合引擎，它的职责就是尽可能快地组合屏幕上不同的可视内容，这个内容被分解成独立的图层，存储在一个叫图层树的体系中。</li>\n</ul>\n<h3 id=\"图层与视图\"><a href=\"#图层与视图\" class=\"headerlink\" title=\"图层与视图\"></a>图层与视图</h3><ul>\n<li>CALayer类在概念上和UIView类似，同样是一些被层级关系树管理的矩形块，同样可以含有一些内容。他有一些方法和属性用来做动画和变换。</li>\n<li>和UIView最大的不同是，CALayer不处理用户的交互。CALayer并不清楚具体的响应链，因此它并不能响应时间。</li>\n<li>每个UIView都有一个CALayer属性，即所谓的bakinglayer，视图的职责就是创建并管理这个图层。视图的层级关系与其图层的层级关系是相同的。</li>\n<li>真正在界面上显示和进行动画的都是CALayer，UIView只是对CALayer的一个封装而已。</li>\n<li>进行视图和图层的分类，是为了职责分离，避免重复的代码。ios中视图为UIView，MacOS中视图为NSView，但是他们的图层都是CALayer。</li>\n</ul>\n<h3 id=\"图层的能力\"><a href=\"#图层的能力\" class=\"headerlink\" title=\"图层的能力\"></a>图层的能力</h3><ul>\n<li>CALayer能做但UIView不能做的东西：<ul>\n<li>阴影，圆角，带颜色的边框</li>\n<li>3D变换</li>\n<li>非矩形范围</li>\n<li>透明遮罩</li>\n<li>多级非线性动画</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"使用图层\"><a href=\"#使用图层\" class=\"headerlink\" title=\"使用图层\"></a>使用图层</h3><ul>\n<li>可以直接在UIView的layer属性中添加图层，如下</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)viewDidLoad &#123;</span><br><span class=\"line\">    [<span class=\"keyword\">super</span> viewDidLoad];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">CALayer</span> *blueLayer = [[<span class=\"built_in\">CALayer</span> alloc] init];</span><br><span class=\"line\">    blueLayer.frame = <span class=\"built_in\">CGRectMake</span>(<span class=\"number\">50</span>, <span class=\"number\">50</span>, <span class=\"number\">50</span>, <span class=\"number\">50</span>);</span><br><span class=\"line\">    blueLayer.backgroundColor = [<span class=\"built_in\">UIColor</span> blueColor].CGColor;</span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.layerView.layer addSublayer:blueLayer];</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>使用图层而不使用视图的情况<ul>\n<li>开发可以在MacOS上运行的跨平台应用</li>\n<li>使用多种CALayer的子类（特殊图层），并且不想创建单独的UIView去封装他们</li>\n<li>做一些对性能特别挑剔的工作</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"第二章-寄宿图\"><a href=\"#第二章-寄宿图\" class=\"headerlink\" title=\"第二章 寄宿图\"></a>第二章 寄宿图</h2><p>CALayer除了可以设置颜色，也可以设置一张图片，这张图片称为CALayer的寄宿图。</p>\n<h3 id=\"contents属性\"><a href=\"#contents属性\" class=\"headerlink\" title=\"contents属性\"></a>contents属性</h3><ul>\n<li>CALayer有一个contents的属性，它虽然是id类型，但是必须设置一个CGImage，才能显示出图片，设置为其他类型，都只会显示一个空白的区域。这种现象是有Mac OS的历史历史原因造成的。在Mac OS上，contents对CGImage和NSImage类型的值都起作用，但在ios中，不能给contents设置一个UIImage。</li>\n<li>contentGravity属性：与UIView中的contentMode属性对应</li>\n<li>contentScale属性：定义了寄宿图的像素尺寸和视图的比例，默认为1.0。UIView中与之对应的属性为contentScaleFactor。使用UIImage加载图片会自动根据屏幕加载2x或3x图片，但是使用CGImage则不会。这样我们就需要手动设置contentScale属性来修复这个问题。一般使用代码设置寄宿图，都会手动设置contentScale，如下：<code>blueLayer.contentsScale = [[UIScreen mainScreen] scale];</code></li>\n<li>maskToBounds属性用来决定是否显示超出边界的内容</li>\n</ul>\n<h3 id=\"contentsRect属性\"><a href=\"#contentsRect属性\" class=\"headerlink\" title=\"contentsRect属性\"></a>contentsRect属性</h3><ul>\n<li>contentRect属性允许我们在图层边框里显示寄宿图的一个子域，这要比contentGravity属性灵活许多。contentRect是一个单位坐标，长宽最大都为1。默认为{0，0，1，1}，当设置为{0，0，0.5，0.5}，则显示效果如下图：</li>\n</ul>\n<p><img src=\"http://oldblog.shicishuzhai.com/004ddacd5a9506600889fc2c32686262.png\" alt=\"contentsRect\"></p>\n<ul>\n<li>contentRect的另外一个用途就是ImageSprites（图片拼合），把多张图片放在一张大的图片上，然后使用contentRect分别显示每一张图片，去掉不显示的部分，这就是图片拼合。在游戏编程中非常常见。加载一张大图要比加载多张小图效率要高。</li>\n</ul>\n<h3 id=\"contentsCenter属性\"><a href=\"#contentsCenter属性\" class=\"headerlink\" title=\"contentsCenter属性\"></a>contentsCenter属性</h3><ul>\n<li>contentsCenter属性表示图层相对于寄宿图的位置与大小，可以用来定义图片的拉伸。</li>\n<li>如下图，虚线框为图层的区域，灰色为内容的区域。</li>\n</ul>\n<p><img src=\"http://oldblog.shicishuzhai.com/01278b2b759e5b3c5fc5ae2a961a71ee.png\" alt=\"contentCenter\"></p>\n<ul>\n<li>该属性相当于UIImage的<code>resizableImageWithCapInsets:</code>方法</li>\n</ul>\n<h3 id=\"customDrawing\"><a href=\"#customDrawing\" class=\"headerlink\" title=\"customDrawing\"></a>customDrawing</h3><ul>\n<li>除了直接给contents属性设置CGImage，也可以通过CoreGraphics直接绘制寄宿图。使用UIVIew 的drawRect:方法来自定义绘制</li>\n<li>除了重写drawRect:方法，也可以通过设置CALayer的代理，使用代理方法<code>(void)displayLayer:</code>来实现重绘，但是强烈建议使用前一种方法。</li>\n</ul>\n"},{"layout":"post","title":"《ios核心动画高级技巧》阅读笔记(3)","_content":"\n## 第四章 视觉效果\n\n### 圆角\n\n* 设置CALayer的cornerRadius属性来设置圆角，并且要把maskToBounds设置为YES\n\n### 边框\n\n* 设置CALayer的borderColor和borderWidth可以设置边框的颜色和宽度\n\n### 阴影\n\n* shadowColor:阴影的颜色\n* shadowOpacity:阴影的透明度\n* shadowOffset:阴影的偏移\n* shadowRadius:阴影的模糊度，即模糊半径\n* 如果设置了maskToBounds，则阴影就不会显示了，因为阴影已经被裁减调了。要解决这个问题，可以再创建一个frame一样的View，给这个view设置阴影，而设置原本的view的maskToBounds，这样阴影就不会被裁减掉了。\n* shadowPath:指定阴影的路径。\n* 设置ImageView,label等的阴影，并不是设置他们边界的阴影，而是设置里面内容的阴影，例如设置label的阴影，设置的是label中文字的阴影。\n\n```objectivec\n- (void)viewDidAppear:(BOOL)animated {\n    [super viewDidAppear:animated];\n    self.buleView.hidden = YES;\n    self.layerView.layer.shadowColor = [UIColor redColor].CGColor;\n    self.layerView.layer.shadowOpacity = 1;\n    self.layerView.layer.shadowRadius = 10;\n\n    CGMutablePathRef path = CGPathCreateMutable();\n    CGPathAddEllipseInRect(path, NULL, self.layerView.bounds);\n    self.layerView.layer.shadowPath = path;\n    CGPathRelease(path);\n}\n```\n\n### 图层蒙版\n\n* mask:CALayer的mask属性定义了父图层的部分可见区域，父图层与mask的关系如下图\n\n![mask](http://oldblog.shicishuzhai.com/87291a0061be6a254bd4937851ecf4d8.png)\n\n* 虽然设置了mask，但是视图的事件响应区域任然是原视图的区域\n* mask是可以动态设置的，只要改变mask的大小，就可以对视图的显示区域进行动画\n\n```objectivec\n- (void)viewDidAppear:(BOOL)animated {\n    [super viewDidAppear:animated];\n    CAShapeLayer *mask = [CAShapeLayer layer];\n    UIBezierPath *path = [UIBezierPath bezierPathWithOvalInRect:self.greenBtn.bounds];\n    mask.path = path.CGPath;\n    self.greenBtn.layer.mask = mask;\n}\n\n- (void)touchesBegan:(NSSet<UITouch *> *)touches withEvent:(UIEvent *)event {\n\n    UIBezierPath *endPath = [UIBezierPath bezierPathWithRect:self.greenBtn.bounds];\n    CAShapeLayer *layer = (CAShapeLayer *)self.greenBtn.layer.mask;\n\n    // 动画\n    CABasicAnimation *animation = [CABasicAnimation animationWithKeyPath:@\"path\"];\n    animation.duration = 1;\n    animation.fromValue = (id)layer.path;\n    animation.toValue = (__bridge id _Nullable)(endPath.CGPath);\n    animation.removedOnCompletion = NO;\n    animation.fillMode = kCAFillModeForwards;\n    [layer addAnimation:animation forKey:@\"shapeLayerPath\"];\n}\n```\n\n### 拉伸过滤\n\n* minificationFilter:缩小图片的拉伸算法\n* magnificationFilter:方法图片的拉伸算法\n* 三个值：kCAFilterNearest，kCAFilterLinear，kCAFilterTrilinear\n\n### 组透明\n\n* 改变视图或图层的透明度，其子视图或子图层的透明度也会跟着改变，但是经过叠加后，原本颜色相同的父子视图，变成了不同的视图，如下图：\n\n![group-opacity](http://oldblog.shicishuzhai.com/dda57bde043a3358e1cbc03af4fcbcf1.png)\n\n* 为了解决这种问题，可以在plist中添加\"Renders with group opacity\"为YES（目前ios9中默认就为YES），或者设置CALayer的shouldRasterize为YES也可以达到相同的效果。\n","source":"_posts/2015-12-27-《ios核心动画高级技巧》阅读笔记(3).md","raw":"---\nlayout: post\ntitle: \"《ios核心动画高级技巧》阅读笔记(3)\"\ncategories: \"读书笔记\"\n---\n\n## 第四章 视觉效果\n\n### 圆角\n\n* 设置CALayer的cornerRadius属性来设置圆角，并且要把maskToBounds设置为YES\n\n### 边框\n\n* 设置CALayer的borderColor和borderWidth可以设置边框的颜色和宽度\n\n### 阴影\n\n* shadowColor:阴影的颜色\n* shadowOpacity:阴影的透明度\n* shadowOffset:阴影的偏移\n* shadowRadius:阴影的模糊度，即模糊半径\n* 如果设置了maskToBounds，则阴影就不会显示了，因为阴影已经被裁减调了。要解决这个问题，可以再创建一个frame一样的View，给这个view设置阴影，而设置原本的view的maskToBounds，这样阴影就不会被裁减掉了。\n* shadowPath:指定阴影的路径。\n* 设置ImageView,label等的阴影，并不是设置他们边界的阴影，而是设置里面内容的阴影，例如设置label的阴影，设置的是label中文字的阴影。\n\n```objectivec\n- (void)viewDidAppear:(BOOL)animated {\n    [super viewDidAppear:animated];\n    self.buleView.hidden = YES;\n    self.layerView.layer.shadowColor = [UIColor redColor].CGColor;\n    self.layerView.layer.shadowOpacity = 1;\n    self.layerView.layer.shadowRadius = 10;\n\n    CGMutablePathRef path = CGPathCreateMutable();\n    CGPathAddEllipseInRect(path, NULL, self.layerView.bounds);\n    self.layerView.layer.shadowPath = path;\n    CGPathRelease(path);\n}\n```\n\n### 图层蒙版\n\n* mask:CALayer的mask属性定义了父图层的部分可见区域，父图层与mask的关系如下图\n\n![mask](http://oldblog.shicishuzhai.com/87291a0061be6a254bd4937851ecf4d8.png)\n\n* 虽然设置了mask，但是视图的事件响应区域任然是原视图的区域\n* mask是可以动态设置的，只要改变mask的大小，就可以对视图的显示区域进行动画\n\n```objectivec\n- (void)viewDidAppear:(BOOL)animated {\n    [super viewDidAppear:animated];\n    CAShapeLayer *mask = [CAShapeLayer layer];\n    UIBezierPath *path = [UIBezierPath bezierPathWithOvalInRect:self.greenBtn.bounds];\n    mask.path = path.CGPath;\n    self.greenBtn.layer.mask = mask;\n}\n\n- (void)touchesBegan:(NSSet<UITouch *> *)touches withEvent:(UIEvent *)event {\n\n    UIBezierPath *endPath = [UIBezierPath bezierPathWithRect:self.greenBtn.bounds];\n    CAShapeLayer *layer = (CAShapeLayer *)self.greenBtn.layer.mask;\n\n    // 动画\n    CABasicAnimation *animation = [CABasicAnimation animationWithKeyPath:@\"path\"];\n    animation.duration = 1;\n    animation.fromValue = (id)layer.path;\n    animation.toValue = (__bridge id _Nullable)(endPath.CGPath);\n    animation.removedOnCompletion = NO;\n    animation.fillMode = kCAFillModeForwards;\n    [layer addAnimation:animation forKey:@\"shapeLayerPath\"];\n}\n```\n\n### 拉伸过滤\n\n* minificationFilter:缩小图片的拉伸算法\n* magnificationFilter:方法图片的拉伸算法\n* 三个值：kCAFilterNearest，kCAFilterLinear，kCAFilterTrilinear\n\n### 组透明\n\n* 改变视图或图层的透明度，其子视图或子图层的透明度也会跟着改变，但是经过叠加后，原本颜色相同的父子视图，变成了不同的视图，如下图：\n\n![group-opacity](http://oldblog.shicishuzhai.com/dda57bde043a3358e1cbc03af4fcbcf1.png)\n\n* 为了解决这种问题，可以在plist中添加\"Renders with group opacity\"为YES（目前ios9中默认就为YES），或者设置CALayer的shouldRasterize为YES也可以达到相同的效果。\n","slug":"《ios核心动画高级技巧》阅读笔记(3)","published":1,"date":"2015-12-26T16:00:00.000Z","updated":"2019-01-13T04:01:04.508Z","comments":1,"photos":[],"link":"","_id":"cjutyfmf80010c4c9bt2kvitg","content":"<h2 id=\"第四章-视觉效果\"><a href=\"#第四章-视觉效果\" class=\"headerlink\" title=\"第四章 视觉效果\"></a>第四章 视觉效果</h2><h3 id=\"圆角\"><a href=\"#圆角\" class=\"headerlink\" title=\"圆角\"></a>圆角</h3><ul>\n<li>设置CALayer的cornerRadius属性来设置圆角，并且要把maskToBounds设置为YES</li>\n</ul>\n<h3 id=\"边框\"><a href=\"#边框\" class=\"headerlink\" title=\"边框\"></a>边框</h3><ul>\n<li>设置CALayer的borderColor和borderWidth可以设置边框的颜色和宽度</li>\n</ul>\n<h3 id=\"阴影\"><a href=\"#阴影\" class=\"headerlink\" title=\"阴影\"></a>阴影</h3><ul>\n<li>shadowColor:阴影的颜色</li>\n<li>shadowOpacity:阴影的透明度</li>\n<li>shadowOffset:阴影的偏移</li>\n<li>shadowRadius:阴影的模糊度，即模糊半径</li>\n<li>如果设置了maskToBounds，则阴影就不会显示了，因为阴影已经被裁减调了。要解决这个问题，可以再创建一个frame一样的View，给这个view设置阴影，而设置原本的view的maskToBounds，这样阴影就不会被裁减掉了。</li>\n<li>shadowPath:指定阴影的路径。</li>\n<li>设置ImageView,label等的阴影，并不是设置他们边界的阴影，而是设置里面内容的阴影，例如设置label的阴影，设置的是label中文字的阴影。</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)viewDidAppear:(<span class=\"built_in\">BOOL</span>)animated &#123;</span><br><span class=\"line\">    [<span class=\"keyword\">super</span> viewDidAppear:animated];</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.buleView.hidden = <span class=\"literal\">YES</span>;</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.layerView.layer.shadowColor = [<span class=\"built_in\">UIColor</span> redColor].CGColor;</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.layerView.layer.shadowOpacity = <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.layerView.layer.shadowRadius = <span class=\"number\">10</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">CGMutablePathRef</span> path = <span class=\"built_in\">CGPathCreateMutable</span>();</span><br><span class=\"line\">    <span class=\"built_in\">CGPathAddEllipseInRect</span>(path, <span class=\"literal\">NULL</span>, <span class=\"keyword\">self</span>.layerView.bounds);</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.layerView.layer.shadowPath = path;</span><br><span class=\"line\">    <span class=\"built_in\">CGPathRelease</span>(path);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"图层蒙版\"><a href=\"#图层蒙版\" class=\"headerlink\" title=\"图层蒙版\"></a>图层蒙版</h3><ul>\n<li>mask:CALayer的mask属性定义了父图层的部分可见区域，父图层与mask的关系如下图</li>\n</ul>\n<p><img src=\"http://oldblog.shicishuzhai.com/87291a0061be6a254bd4937851ecf4d8.png\" alt=\"mask\"></p>\n<ul>\n<li>虽然设置了mask，但是视图的事件响应区域任然是原视图的区域</li>\n<li>mask是可以动态设置的，只要改变mask的大小，就可以对视图的显示区域进行动画</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)viewDidAppear:(<span class=\"built_in\">BOOL</span>)animated &#123;</span><br><span class=\"line\">    [<span class=\"keyword\">super</span> viewDidAppear:animated];</span><br><span class=\"line\">    <span class=\"built_in\">CAShapeLayer</span> *mask = [<span class=\"built_in\">CAShapeLayer</span> layer];</span><br><span class=\"line\">    <span class=\"built_in\">UIBezierPath</span> *path = [<span class=\"built_in\">UIBezierPath</span> bezierPathWithOvalInRect:<span class=\"keyword\">self</span>.greenBtn.bounds];</span><br><span class=\"line\">    mask.path = path.CGPath;</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.greenBtn.layer.mask = mask;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)touchesBegan:(<span class=\"built_in\">NSSet</span>&lt;<span class=\"built_in\">UITouch</span> *&gt; *)touches withEvent:(<span class=\"built_in\">UIEvent</span> *)event &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">UIBezierPath</span> *endPath = [<span class=\"built_in\">UIBezierPath</span> bezierPathWithRect:<span class=\"keyword\">self</span>.greenBtn.bounds];</span><br><span class=\"line\">    <span class=\"built_in\">CAShapeLayer</span> *layer = (<span class=\"built_in\">CAShapeLayer</span> *)<span class=\"keyword\">self</span>.greenBtn.layer.mask;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 动画</span></span><br><span class=\"line\">    <span class=\"built_in\">CABasicAnimation</span> *animation = [<span class=\"built_in\">CABasicAnimation</span> animationWithKeyPath:<span class=\"string\">@\"path\"</span>];</span><br><span class=\"line\">    animation.duration = <span class=\"number\">1</span>;</span><br><span class=\"line\">    animation.fromValue = (<span class=\"keyword\">id</span>)layer.path;</span><br><span class=\"line\">    animation.toValue = (__bridge <span class=\"keyword\">id</span> _Nullable)(endPath.CGPath);</span><br><span class=\"line\">    animation.removedOnCompletion = <span class=\"literal\">NO</span>;</span><br><span class=\"line\">    animation.fillMode = kCAFillModeForwards;</span><br><span class=\"line\">    [layer addAnimation:animation forKey:<span class=\"string\">@\"shapeLayerPath\"</span>];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"拉伸过滤\"><a href=\"#拉伸过滤\" class=\"headerlink\" title=\"拉伸过滤\"></a>拉伸过滤</h3><ul>\n<li>minificationFilter:缩小图片的拉伸算法</li>\n<li>magnificationFilter:方法图片的拉伸算法</li>\n<li>三个值：kCAFilterNearest，kCAFilterLinear，kCAFilterTrilinear</li>\n</ul>\n<h3 id=\"组透明\"><a href=\"#组透明\" class=\"headerlink\" title=\"组透明\"></a>组透明</h3><ul>\n<li>改变视图或图层的透明度，其子视图或子图层的透明度也会跟着改变，但是经过叠加后，原本颜色相同的父子视图，变成了不同的视图，如下图：</li>\n</ul>\n<p><img src=\"http://oldblog.shicishuzhai.com/dda57bde043a3358e1cbc03af4fcbcf1.png\" alt=\"group-opacity\"></p>\n<ul>\n<li>为了解决这种问题，可以在plist中添加”Renders with group opacity”为YES（目前ios9中默认就为YES），或者设置CALayer的shouldRasterize为YES也可以达到相同的效果。</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"第四章-视觉效果\"><a href=\"#第四章-视觉效果\" class=\"headerlink\" title=\"第四章 视觉效果\"></a>第四章 视觉效果</h2><h3 id=\"圆角\"><a href=\"#圆角\" class=\"headerlink\" title=\"圆角\"></a>圆角</h3><ul>\n<li>设置CALayer的cornerRadius属性来设置圆角，并且要把maskToBounds设置为YES</li>\n</ul>\n<h3 id=\"边框\"><a href=\"#边框\" class=\"headerlink\" title=\"边框\"></a>边框</h3><ul>\n<li>设置CALayer的borderColor和borderWidth可以设置边框的颜色和宽度</li>\n</ul>\n<h3 id=\"阴影\"><a href=\"#阴影\" class=\"headerlink\" title=\"阴影\"></a>阴影</h3><ul>\n<li>shadowColor:阴影的颜色</li>\n<li>shadowOpacity:阴影的透明度</li>\n<li>shadowOffset:阴影的偏移</li>\n<li>shadowRadius:阴影的模糊度，即模糊半径</li>\n<li>如果设置了maskToBounds，则阴影就不会显示了，因为阴影已经被裁减调了。要解决这个问题，可以再创建一个frame一样的View，给这个view设置阴影，而设置原本的view的maskToBounds，这样阴影就不会被裁减掉了。</li>\n<li>shadowPath:指定阴影的路径。</li>\n<li>设置ImageView,label等的阴影，并不是设置他们边界的阴影，而是设置里面内容的阴影，例如设置label的阴影，设置的是label中文字的阴影。</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)viewDidAppear:(<span class=\"built_in\">BOOL</span>)animated &#123;</span><br><span class=\"line\">    [<span class=\"keyword\">super</span> viewDidAppear:animated];</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.buleView.hidden = <span class=\"literal\">YES</span>;</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.layerView.layer.shadowColor = [<span class=\"built_in\">UIColor</span> redColor].CGColor;</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.layerView.layer.shadowOpacity = <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.layerView.layer.shadowRadius = <span class=\"number\">10</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">CGMutablePathRef</span> path = <span class=\"built_in\">CGPathCreateMutable</span>();</span><br><span class=\"line\">    <span class=\"built_in\">CGPathAddEllipseInRect</span>(path, <span class=\"literal\">NULL</span>, <span class=\"keyword\">self</span>.layerView.bounds);</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.layerView.layer.shadowPath = path;</span><br><span class=\"line\">    <span class=\"built_in\">CGPathRelease</span>(path);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"图层蒙版\"><a href=\"#图层蒙版\" class=\"headerlink\" title=\"图层蒙版\"></a>图层蒙版</h3><ul>\n<li>mask:CALayer的mask属性定义了父图层的部分可见区域，父图层与mask的关系如下图</li>\n</ul>\n<p><img src=\"http://oldblog.shicishuzhai.com/87291a0061be6a254bd4937851ecf4d8.png\" alt=\"mask\"></p>\n<ul>\n<li>虽然设置了mask，但是视图的事件响应区域任然是原视图的区域</li>\n<li>mask是可以动态设置的，只要改变mask的大小，就可以对视图的显示区域进行动画</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)viewDidAppear:(<span class=\"built_in\">BOOL</span>)animated &#123;</span><br><span class=\"line\">    [<span class=\"keyword\">super</span> viewDidAppear:animated];</span><br><span class=\"line\">    <span class=\"built_in\">CAShapeLayer</span> *mask = [<span class=\"built_in\">CAShapeLayer</span> layer];</span><br><span class=\"line\">    <span class=\"built_in\">UIBezierPath</span> *path = [<span class=\"built_in\">UIBezierPath</span> bezierPathWithOvalInRect:<span class=\"keyword\">self</span>.greenBtn.bounds];</span><br><span class=\"line\">    mask.path = path.CGPath;</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.greenBtn.layer.mask = mask;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)touchesBegan:(<span class=\"built_in\">NSSet</span>&lt;<span class=\"built_in\">UITouch</span> *&gt; *)touches withEvent:(<span class=\"built_in\">UIEvent</span> *)event &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">UIBezierPath</span> *endPath = [<span class=\"built_in\">UIBezierPath</span> bezierPathWithRect:<span class=\"keyword\">self</span>.greenBtn.bounds];</span><br><span class=\"line\">    <span class=\"built_in\">CAShapeLayer</span> *layer = (<span class=\"built_in\">CAShapeLayer</span> *)<span class=\"keyword\">self</span>.greenBtn.layer.mask;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 动画</span></span><br><span class=\"line\">    <span class=\"built_in\">CABasicAnimation</span> *animation = [<span class=\"built_in\">CABasicAnimation</span> animationWithKeyPath:<span class=\"string\">@\"path\"</span>];</span><br><span class=\"line\">    animation.duration = <span class=\"number\">1</span>;</span><br><span class=\"line\">    animation.fromValue = (<span class=\"keyword\">id</span>)layer.path;</span><br><span class=\"line\">    animation.toValue = (__bridge <span class=\"keyword\">id</span> _Nullable)(endPath.CGPath);</span><br><span class=\"line\">    animation.removedOnCompletion = <span class=\"literal\">NO</span>;</span><br><span class=\"line\">    animation.fillMode = kCAFillModeForwards;</span><br><span class=\"line\">    [layer addAnimation:animation forKey:<span class=\"string\">@\"shapeLayerPath\"</span>];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"拉伸过滤\"><a href=\"#拉伸过滤\" class=\"headerlink\" title=\"拉伸过滤\"></a>拉伸过滤</h3><ul>\n<li>minificationFilter:缩小图片的拉伸算法</li>\n<li>magnificationFilter:方法图片的拉伸算法</li>\n<li>三个值：kCAFilterNearest，kCAFilterLinear，kCAFilterTrilinear</li>\n</ul>\n<h3 id=\"组透明\"><a href=\"#组透明\" class=\"headerlink\" title=\"组透明\"></a>组透明</h3><ul>\n<li>改变视图或图层的透明度，其子视图或子图层的透明度也会跟着改变，但是经过叠加后，原本颜色相同的父子视图，变成了不同的视图，如下图：</li>\n</ul>\n<p><img src=\"http://oldblog.shicishuzhai.com/dda57bde043a3358e1cbc03af4fcbcf1.png\" alt=\"group-opacity\"></p>\n<ul>\n<li>为了解决这种问题，可以在plist中添加”Renders with group opacity”为YES（目前ios9中默认就为YES），或者设置CALayer的shouldRasterize为YES也可以达到相同的效果。</li>\n</ul>\n"},{"layout":"post","title":"iOS开发企业证书申请过程全记录","_content":"\n最近帮公司申请了企业开发者证书，中间也遇到了不少坑，下面是整个过程的一个完整记录，包括申请邓白氏编码的过程，希望对大家有所帮助。\n\n### 申请邓白氏编码\n\n1. 注册企业开发者账号之前，要先申请[邓白氏编码](http://baike.baidu.com/link?url=dzCD0bvR7RV_I_3KBXQtse65aaKmEO8_ghvPq7M9Y3V6-H-omCBMvpOMNImYwvKYdBBdhkvaD2oTmgiTYd9FHq)，申请地址p[https://developer.apple.com/support/D-U-N-S/](https://developer.apple.com/support/D-U-N-S/)，首先填写公司信息，然后提交申请\n![1.1.1](http://oldblog.shicishuzhai.com/b1ee643bd69fb351c1048b0f4c620ca2.png)\n![1.1.2](http://oldblog.shicishuzhai.com/7bd0b2899cdc677a901febad7306fba2.png)\n2. 过一会会收到一封邮件，大概内容就是正在申请邓氏码，大概什么时候完成，还有一个requestID\n![1.2.1](http://oldblog.shicishuzhai.com/5a8e972d91eb408774c787acf066c713.png)\n3. 又过了两天，接到了上海一家公司的电话，他跟我确认了一下邮箱，接着他会给你这个邮箱发一封邮件，要求你提供以下公司信息\n![1.3.1](http://oldblog.shicishuzhai.com/810e19e549cbac41c918fdd9f794c025.png)\n4. 回复这封邮件，过一会又会收到一封邮件，内容如下\n![1.4.1](http://oldblog.shicishuzhai.com/f1de6028777c7874a1593ec0119da0a6.png)\n5. 有过了不到一天的时间，就收到了申请的邓氏码，虽然他邮件上要求14个工作日再去使用邓氏码，但是根据我的尝试，我只等了不到两天就可以使用了。\n\n### 注册企业开发者账号\n\n1. 注册一个AppleID，这个就不用说了，这里要注意的一点是，你在注册AppleID时必须使用你真实姓名的拼音去注册，否则苹果会给你发邮件让你改成真实姓名，我就遇到了这一点。\n![2.1.1](http://oldblog.shicishuzhai.com/66506633bad28c995b24039688dda30e.png)\n2. 用你注册的AppleID登录苹果开发者中心，在最底部点击Enterprise Program，注意不是Developer Program。\n![2.2.1](http://oldblog.shicishuzhai.com/939056f54db775460ceb68e2506e0003.png)\n![2.2.2](http://oldblog.shicishuzhai.com/2281829dbb65193c65e248e581e595b3.png)\n![2.2.3](http://oldblog.shicishuzhai.com/0aa47a0de740fdcd44c8197dafd43006.png)\n3. Entity Type选择“Company/Organization”，然后点击继续\n![2.3.1](http://oldblog.shicishuzhai.com/81c91b2b12845c24d0376ac599769625.png)\n4. 填写资料，然后点击继续\n![2.4.1](http://oldblog.shicishuzhai.com/f04ef93f3b1298058add7700888fbb97.png)\n5. 确认信息，这里要注意一点，苹果显示的地址有字数限制，所以如果你的公司地址很长，这里可能会显示不全，这是正常的。确认完成后，点击提交。\n![2.4.1](http://oldblog.shicishuzhai.com/2bad2013936e0dfe82b8e0b5bbc1a7ec.png)\n6. 过一会会收到一封邮件，提示你的申请已经被接受\n7. 又过了两天，苹果会打电话来确认一些信息，然后就可以接着走下面的流程了，进入开发者中心，点击Review Now\n![2.7.1](http://oldblog.shicishuzhai.com/dade54e4af9cc6126cb099e6656bf59f.png)\n8. 点击继续，然后就到了付款的阶段\n![2.8.1](http://oldblog.shicishuzhai.com/249c8652294855c003063ab3cb1d04df.png)\n9. 点击Purchase，然后要重新登录一次AppleID，然后就是填写付款信息，这里要注意的是使用的信用卡一定是要同时具有银联标志和VISA标志的卡，我尝试过，使用仅支持银联或者VISA的信用卡是不能支付成功的。\n10. 支付完成后，这个企业开发者证书就申请完了，登录开发者中心，显示的开发者类型就是企业开发者（in-house)\n![2.10.1](http://oldblog.shicishuzhai.com/6c79710a8bb20bf59439b3de749e1839.png)\n\n以上就算是我申请苹果企业开发者证书的全过程，希望对大家有所帮助\n","source":"_posts/2016-04-10-iOS开发企业证书申请过程全记录.md","raw":"---\nlayout: post\ntitle: \"iOS开发企业证书申请过程全记录\"\ncategories: \"iOS开发\"\n---\n\n最近帮公司申请了企业开发者证书，中间也遇到了不少坑，下面是整个过程的一个完整记录，包括申请邓白氏编码的过程，希望对大家有所帮助。\n\n### 申请邓白氏编码\n\n1. 注册企业开发者账号之前，要先申请[邓白氏编码](http://baike.baidu.com/link?url=dzCD0bvR7RV_I_3KBXQtse65aaKmEO8_ghvPq7M9Y3V6-H-omCBMvpOMNImYwvKYdBBdhkvaD2oTmgiTYd9FHq)，申请地址p[https://developer.apple.com/support/D-U-N-S/](https://developer.apple.com/support/D-U-N-S/)，首先填写公司信息，然后提交申请\n![1.1.1](http://oldblog.shicishuzhai.com/b1ee643bd69fb351c1048b0f4c620ca2.png)\n![1.1.2](http://oldblog.shicishuzhai.com/7bd0b2899cdc677a901febad7306fba2.png)\n2. 过一会会收到一封邮件，大概内容就是正在申请邓氏码，大概什么时候完成，还有一个requestID\n![1.2.1](http://oldblog.shicishuzhai.com/5a8e972d91eb408774c787acf066c713.png)\n3. 又过了两天，接到了上海一家公司的电话，他跟我确认了一下邮箱，接着他会给你这个邮箱发一封邮件，要求你提供以下公司信息\n![1.3.1](http://oldblog.shicishuzhai.com/810e19e549cbac41c918fdd9f794c025.png)\n4. 回复这封邮件，过一会又会收到一封邮件，内容如下\n![1.4.1](http://oldblog.shicishuzhai.com/f1de6028777c7874a1593ec0119da0a6.png)\n5. 有过了不到一天的时间，就收到了申请的邓氏码，虽然他邮件上要求14个工作日再去使用邓氏码，但是根据我的尝试，我只等了不到两天就可以使用了。\n\n### 注册企业开发者账号\n\n1. 注册一个AppleID，这个就不用说了，这里要注意的一点是，你在注册AppleID时必须使用你真实姓名的拼音去注册，否则苹果会给你发邮件让你改成真实姓名，我就遇到了这一点。\n![2.1.1](http://oldblog.shicishuzhai.com/66506633bad28c995b24039688dda30e.png)\n2. 用你注册的AppleID登录苹果开发者中心，在最底部点击Enterprise Program，注意不是Developer Program。\n![2.2.1](http://oldblog.shicishuzhai.com/939056f54db775460ceb68e2506e0003.png)\n![2.2.2](http://oldblog.shicishuzhai.com/2281829dbb65193c65e248e581e595b3.png)\n![2.2.3](http://oldblog.shicishuzhai.com/0aa47a0de740fdcd44c8197dafd43006.png)\n3. Entity Type选择“Company/Organization”，然后点击继续\n![2.3.1](http://oldblog.shicishuzhai.com/81c91b2b12845c24d0376ac599769625.png)\n4. 填写资料，然后点击继续\n![2.4.1](http://oldblog.shicishuzhai.com/f04ef93f3b1298058add7700888fbb97.png)\n5. 确认信息，这里要注意一点，苹果显示的地址有字数限制，所以如果你的公司地址很长，这里可能会显示不全，这是正常的。确认完成后，点击提交。\n![2.4.1](http://oldblog.shicishuzhai.com/2bad2013936e0dfe82b8e0b5bbc1a7ec.png)\n6. 过一会会收到一封邮件，提示你的申请已经被接受\n7. 又过了两天，苹果会打电话来确认一些信息，然后就可以接着走下面的流程了，进入开发者中心，点击Review Now\n![2.7.1](http://oldblog.shicishuzhai.com/dade54e4af9cc6126cb099e6656bf59f.png)\n8. 点击继续，然后就到了付款的阶段\n![2.8.1](http://oldblog.shicishuzhai.com/249c8652294855c003063ab3cb1d04df.png)\n9. 点击Purchase，然后要重新登录一次AppleID，然后就是填写付款信息，这里要注意的是使用的信用卡一定是要同时具有银联标志和VISA标志的卡，我尝试过，使用仅支持银联或者VISA的信用卡是不能支付成功的。\n10. 支付完成后，这个企业开发者证书就申请完了，登录开发者中心，显示的开发者类型就是企业开发者（in-house)\n![2.10.1](http://oldblog.shicishuzhai.com/6c79710a8bb20bf59439b3de749e1839.png)\n\n以上就算是我申请苹果企业开发者证书的全过程，希望对大家有所帮助\n","slug":"iOS开发企业证书申请过程全记录","published":1,"date":"2016-04-09T16:00:00.000Z","updated":"2019-01-13T04:01:04.581Z","comments":1,"photos":[],"link":"","_id":"cjutyfmf90012c4c97jes5zen","content":"<p>最近帮公司申请了企业开发者证书，中间也遇到了不少坑，下面是整个过程的一个完整记录，包括申请邓白氏编码的过程，希望对大家有所帮助。</p>\n<h3 id=\"申请邓白氏编码\"><a href=\"#申请邓白氏编码\" class=\"headerlink\" title=\"申请邓白氏编码\"></a>申请邓白氏编码</h3><ol>\n<li>注册企业开发者账号之前，要先申请<a href=\"http://baike.baidu.com/link?url=dzCD0bvR7RV_I_3KBXQtse65aaKmEO8_ghvPq7M9Y3V6-H-omCBMvpOMNImYwvKYdBBdhkvaD2oTmgiTYd9FHq\" target=\"_blank\" rel=\"noopener\">邓白氏编码</a>，申请地址p<a href=\"https://developer.apple.com/support/D-U-N-S/\" target=\"_blank\" rel=\"noopener\">https://developer.apple.com/support/D-U-N-S/</a>，首先填写公司信息，然后提交申请<br><img src=\"http://oldblog.shicishuzhai.com/b1ee643bd69fb351c1048b0f4c620ca2.png\" alt=\"1.1.1\"><br><img src=\"http://oldblog.shicishuzhai.com/7bd0b2899cdc677a901febad7306fba2.png\" alt=\"1.1.2\"></li>\n<li>过一会会收到一封邮件，大概内容就是正在申请邓氏码，大概什么时候完成，还有一个requestID<br><img src=\"http://oldblog.shicishuzhai.com/5a8e972d91eb408774c787acf066c713.png\" alt=\"1.2.1\"></li>\n<li>又过了两天，接到了上海一家公司的电话，他跟我确认了一下邮箱，接着他会给你这个邮箱发一封邮件，要求你提供以下公司信息<br><img src=\"http://oldblog.shicishuzhai.com/810e19e549cbac41c918fdd9f794c025.png\" alt=\"1.3.1\"></li>\n<li>回复这封邮件，过一会又会收到一封邮件，内容如下<br><img src=\"http://oldblog.shicishuzhai.com/f1de6028777c7874a1593ec0119da0a6.png\" alt=\"1.4.1\"></li>\n<li>有过了不到一天的时间，就收到了申请的邓氏码，虽然他邮件上要求14个工作日再去使用邓氏码，但是根据我的尝试，我只等了不到两天就可以使用了。</li>\n</ol>\n<h3 id=\"注册企业开发者账号\"><a href=\"#注册企业开发者账号\" class=\"headerlink\" title=\"注册企业开发者账号\"></a>注册企业开发者账号</h3><ol>\n<li>注册一个AppleID，这个就不用说了，这里要注意的一点是，你在注册AppleID时必须使用你真实姓名的拼音去注册，否则苹果会给你发邮件让你改成真实姓名，我就遇到了这一点。<br><img src=\"http://oldblog.shicishuzhai.com/66506633bad28c995b24039688dda30e.png\" alt=\"2.1.1\"></li>\n<li>用你注册的AppleID登录苹果开发者中心，在最底部点击Enterprise Program，注意不是Developer Program。<br><img src=\"http://oldblog.shicishuzhai.com/939056f54db775460ceb68e2506e0003.png\" alt=\"2.2.1\"><br><img src=\"http://oldblog.shicishuzhai.com/2281829dbb65193c65e248e581e595b3.png\" alt=\"2.2.2\"><br><img src=\"http://oldblog.shicishuzhai.com/0aa47a0de740fdcd44c8197dafd43006.png\" alt=\"2.2.3\"></li>\n<li>Entity Type选择“Company/Organization”，然后点击继续<br><img src=\"http://oldblog.shicishuzhai.com/81c91b2b12845c24d0376ac599769625.png\" alt=\"2.3.1\"></li>\n<li>填写资料，然后点击继续<br><img src=\"http://oldblog.shicishuzhai.com/f04ef93f3b1298058add7700888fbb97.png\" alt=\"2.4.1\"></li>\n<li>确认信息，这里要注意一点，苹果显示的地址有字数限制，所以如果你的公司地址很长，这里可能会显示不全，这是正常的。确认完成后，点击提交。<br><img src=\"http://oldblog.shicishuzhai.com/2bad2013936e0dfe82b8e0b5bbc1a7ec.png\" alt=\"2.4.1\"></li>\n<li>过一会会收到一封邮件，提示你的申请已经被接受</li>\n<li>又过了两天，苹果会打电话来确认一些信息，然后就可以接着走下面的流程了，进入开发者中心，点击Review Now<br><img src=\"http://oldblog.shicishuzhai.com/dade54e4af9cc6126cb099e6656bf59f.png\" alt=\"2.7.1\"></li>\n<li>点击继续，然后就到了付款的阶段<br><img src=\"http://oldblog.shicishuzhai.com/249c8652294855c003063ab3cb1d04df.png\" alt=\"2.8.1\"></li>\n<li>点击Purchase，然后要重新登录一次AppleID，然后就是填写付款信息，这里要注意的是使用的信用卡一定是要同时具有银联标志和VISA标志的卡，我尝试过，使用仅支持银联或者VISA的信用卡是不能支付成功的。</li>\n<li>支付完成后，这个企业开发者证书就申请完了，登录开发者中心，显示的开发者类型就是企业开发者（in-house)<br><img src=\"http://oldblog.shicishuzhai.com/6c79710a8bb20bf59439b3de749e1839.png\" alt=\"2.10.1\"></li>\n</ol>\n<p>以上就算是我申请苹果企业开发者证书的全过程，希望对大家有所帮助</p>\n","site":{"data":{}},"excerpt":"","more":"<p>最近帮公司申请了企业开发者证书，中间也遇到了不少坑，下面是整个过程的一个完整记录，包括申请邓白氏编码的过程，希望对大家有所帮助。</p>\n<h3 id=\"申请邓白氏编码\"><a href=\"#申请邓白氏编码\" class=\"headerlink\" title=\"申请邓白氏编码\"></a>申请邓白氏编码</h3><ol>\n<li>注册企业开发者账号之前，要先申请<a href=\"http://baike.baidu.com/link?url=dzCD0bvR7RV_I_3KBXQtse65aaKmEO8_ghvPq7M9Y3V6-H-omCBMvpOMNImYwvKYdBBdhkvaD2oTmgiTYd9FHq\" target=\"_blank\" rel=\"noopener\">邓白氏编码</a>，申请地址p<a href=\"https://developer.apple.com/support/D-U-N-S/\" target=\"_blank\" rel=\"noopener\">https://developer.apple.com/support/D-U-N-S/</a>，首先填写公司信息，然后提交申请<br><img src=\"http://oldblog.shicishuzhai.com/b1ee643bd69fb351c1048b0f4c620ca2.png\" alt=\"1.1.1\"><br><img src=\"http://oldblog.shicishuzhai.com/7bd0b2899cdc677a901febad7306fba2.png\" alt=\"1.1.2\"></li>\n<li>过一会会收到一封邮件，大概内容就是正在申请邓氏码，大概什么时候完成，还有一个requestID<br><img src=\"http://oldblog.shicishuzhai.com/5a8e972d91eb408774c787acf066c713.png\" alt=\"1.2.1\"></li>\n<li>又过了两天，接到了上海一家公司的电话，他跟我确认了一下邮箱，接着他会给你这个邮箱发一封邮件，要求你提供以下公司信息<br><img src=\"http://oldblog.shicishuzhai.com/810e19e549cbac41c918fdd9f794c025.png\" alt=\"1.3.1\"></li>\n<li>回复这封邮件，过一会又会收到一封邮件，内容如下<br><img src=\"http://oldblog.shicishuzhai.com/f1de6028777c7874a1593ec0119da0a6.png\" alt=\"1.4.1\"></li>\n<li>有过了不到一天的时间，就收到了申请的邓氏码，虽然他邮件上要求14个工作日再去使用邓氏码，但是根据我的尝试，我只等了不到两天就可以使用了。</li>\n</ol>\n<h3 id=\"注册企业开发者账号\"><a href=\"#注册企业开发者账号\" class=\"headerlink\" title=\"注册企业开发者账号\"></a>注册企业开发者账号</h3><ol>\n<li>注册一个AppleID，这个就不用说了，这里要注意的一点是，你在注册AppleID时必须使用你真实姓名的拼音去注册，否则苹果会给你发邮件让你改成真实姓名，我就遇到了这一点。<br><img src=\"http://oldblog.shicishuzhai.com/66506633bad28c995b24039688dda30e.png\" alt=\"2.1.1\"></li>\n<li>用你注册的AppleID登录苹果开发者中心，在最底部点击Enterprise Program，注意不是Developer Program。<br><img src=\"http://oldblog.shicishuzhai.com/939056f54db775460ceb68e2506e0003.png\" alt=\"2.2.1\"><br><img src=\"http://oldblog.shicishuzhai.com/2281829dbb65193c65e248e581e595b3.png\" alt=\"2.2.2\"><br><img src=\"http://oldblog.shicishuzhai.com/0aa47a0de740fdcd44c8197dafd43006.png\" alt=\"2.2.3\"></li>\n<li>Entity Type选择“Company/Organization”，然后点击继续<br><img src=\"http://oldblog.shicishuzhai.com/81c91b2b12845c24d0376ac599769625.png\" alt=\"2.3.1\"></li>\n<li>填写资料，然后点击继续<br><img src=\"http://oldblog.shicishuzhai.com/f04ef93f3b1298058add7700888fbb97.png\" alt=\"2.4.1\"></li>\n<li>确认信息，这里要注意一点，苹果显示的地址有字数限制，所以如果你的公司地址很长，这里可能会显示不全，这是正常的。确认完成后，点击提交。<br><img src=\"http://oldblog.shicishuzhai.com/2bad2013936e0dfe82b8e0b5bbc1a7ec.png\" alt=\"2.4.1\"></li>\n<li>过一会会收到一封邮件，提示你的申请已经被接受</li>\n<li>又过了两天，苹果会打电话来确认一些信息，然后就可以接着走下面的流程了，进入开发者中心，点击Review Now<br><img src=\"http://oldblog.shicishuzhai.com/dade54e4af9cc6126cb099e6656bf59f.png\" alt=\"2.7.1\"></li>\n<li>点击继续，然后就到了付款的阶段<br><img src=\"http://oldblog.shicishuzhai.com/249c8652294855c003063ab3cb1d04df.png\" alt=\"2.8.1\"></li>\n<li>点击Purchase，然后要重新登录一次AppleID，然后就是填写付款信息，这里要注意的是使用的信用卡一定是要同时具有银联标志和VISA标志的卡，我尝试过，使用仅支持银联或者VISA的信用卡是不能支付成功的。</li>\n<li>支付完成后，这个企业开发者证书就申请完了，登录开发者中心，显示的开发者类型就是企业开发者（in-house)<br><img src=\"http://oldblog.shicishuzhai.com/6c79710a8bb20bf59439b3de749e1839.png\" alt=\"2.10.1\"></li>\n</ol>\n<p>以上就算是我申请苹果企业开发者证书的全过程，希望对大家有所帮助</p>\n"},{"layout":"post","title":"2016年6月开发问题记录","_content":"\n继续记录6月份开发中遇到的问题。\n\n## UIBarButtonItem点击区域的问题\n\n今天在定制导航上的返回按钮遇到了一个问题，顺便记录一下。\n\n一般常规的定制导航栏返回按钮的方法如下：\n\n```objectivec\n self.navigationItem.leftBarButtonItem = [[UIBarButtonItem alloc] initWithImage:[UIImage imageNamed:@\"back\"] style:UIBarButtonItemStyleDone target:self action:@selector(clickBackBtn:)];\n```\n\n这样写有一个问题，运行代码后，返回按钮的可点击区域如下图所示：\n\n![1](http://oldblog.shicishuzhai.com/d869dc4bbc06c476771fc0cfe1b19d49.png)\n\n这并不是我想要的，点击区域太大，完全没有点到返回按钮上都可以触发返回操作。于是换一种思路，用自定义View实现，代码如下：\n\n```objectivec\nUIButton *backBtn = [[UIButton alloc] initWithFrame:CGRectMake(0, 0, 30, 44)];\n[backBtn addTarget:self action:@selector(clickBackBtn:) forControlEvents:UIControlEventTouchUpInside];\n[backBtn setImage:[UIImage imageNamed:@\"back\"] forState:UIControlStateNormal];\nself.navigationItem.leftBarButtonItem = [[UIBarButtonItem alloc] initWithCustomView:backBtn];\n```\n\n编译运行，效果依然一样，点击区域还是太大，如下图：\n\n![2](http://oldblog.shicishuzhai.com/639a2d998265085ba8f03b4fb3cc6068.png)\n\n这我就不明白了，于是一阵Google，找到了一个解决方案，代码如下：\n\n```objectivec\nUIButton *backBtn = [[UIButton alloc] initWithFrame:CGRectMake(0, 0, 30, 44)];\n[backBtn addTarget:self action:@selector(clickBackBtn:) forControlEvents:UIControlEventTouchUpInside];\n[backBtn setImage:[UIImage imageNamed:@\"back\"] forState:UIControlStateNormal];\nUIView *containerView = [[UIView alloc] initWithFrame:CGRectMake(0, 0, 30, 44)];\n[containerView addSubview:backBtn];\nself.navigationItem.leftBarButtonItem = [[UIBarButtonItem alloc] initWithCustomView:containerView];\n```\n\n这样点击区域就正常了，如下图：\n\n![3](http://oldblog.shicishuzhai.com/0b15b63f3ddab728a7c593154f0083a2.png)\n\n其实就是在Button外面又包了一层View，这样点击区域就只有Button那么大，我怀疑，可能是加载BarButtonItem上的自定义View都会被自动的拉长，暂时还没找到其他解决方案。\n\nReference：[UIBarButtonItem tap area](http://stackoverflow.com/questions/16858433/uibarbuttonitem-tap-area)\n\n## 将自定义对象作为NSDictionary的Key\n\n将自定义对象作为NSDictionary的Key，需要重写自定义isEqual方法和hash方法。isEqual方法比较简单，如下代码：\n\n```objectivec\n- (BOOL)isEqual:(id)object {\n    Student *st = (Student *)object;\n    if ([st.name isEqualToString:self.name] && st.age == self.age) {\n        return YES;\n    }\n    else {\n        return NO;\n    }\n}\n\n```\n\n但是如果要把自定义的对象作为NSDictionary的Key，光重写isEqual方法是不够的，还需要重写hash方法，如果不重写hash方法就会导致字典不能正确的添加和删除。重写hash函数的方法很多，可以通过构建不同散列函数来实现，但是无论哪种方法，目的都是尽可能的确保相同的对象返回的hash值相同，一个简单的方法就是使用每一个属性的hash的异或的结果来作为这个对象的hash值。代码如下：\n\n```objectivec\n- (NSUInteger)hash {\n    return [self.name hash] ^ self.age;\n}\n```\n\n这样构建的hash值冲突的概率很小。另外，要作为字典的Key，还必须实现`NSCopying`协议。因为不需要做深拷贝，所以只需要简单的返回self即可，代码如下：\n\n```objectivec\n- (id)copyWithZone:(NSZone *)zone {\n    return self;\n}\n```\n\n这个构建的一个对象就可以作为NSDictionary的Key了。\n\nReference：[Equality](http://nshipster.com/equality/)\n\n## UITableViewCell的“no index path for table cell being reused”问题\n\n项目中有一个自定义的UITableViewCell，由于版本更新，要把这个Cell改为可以悬停的SectionHeader，为了图方便，我没有重新自定义一个View，而是直接在`viewForHeaderInSection:`方法里返回了cell，代码如下：\n\n```objectivec\nLMBookWriteCommentCell *cell = (LMBookWriteCommentCell *)[self tableView:self.tableView writeCommentCellWithIndexPath:nil];\nreturn cell;\n```\n\n这样写有个问题，就是在reloadData时，这SectionHeader就消失了，变成了空白的一片，并且出现了“no index path for table cell being reused”错误，程序没有崩溃，但是就是看不见Cell上的内容。于是一阵Google，终于找到了答案，只要把上面的代码的`return cell;`改为`return cell.contentView;`就可以了。\n\nReference：[What is the meaning of the “no index path for table cell being reused” message in iOS 6/7?](http://stackoverflow.com/questions/12772197/what-is-the-meaning-of-the-no-index-path-for-table-cell-being-reused-message-i?lq=1)\n\n## Autolayout动画的正确姿势\n\n做Autolayout动画的一般步骤是：\n\n1. 修改约束，如果使用Masonry，使用`mas_updateConstraints`方法修改约束，如果使用Xib，则直接把要修改的约束通过拉线链接到代码里进行修改即可。\n2. 在动画的block中，调用View的`layoutIfNeed()`方法。\n\n这里要注意的一点是第二步，如果直接调用`view.layoutIfNeed()`，可能会导致动画不能进行，正确的方法应该是调用`view.superview.layoutIfNeed()`，这样才能正确的进行动画。完整代码如下：\n\n```objectivec\nclass ViewController: UIViewController {\n\n    @IBOutlet weak var myView: UIView!\n    @IBOutlet weak var topConstraint: NSLayoutConstraint!\n\n    override func viewDidLoad() {\n        super.viewDidLoad()\n    }\n\n    override func touchesBegan(touches: Set<UITouch>, withEvent event: UIEvent?) {\n        topConstraint.constant += 100\n        UIView.animateWithDuration(2.0) {\n            self.myView.superview?.layoutIfNeeded()\n        };\n    }\n}\n```\n\n## 在iOS7上UILabel的省略点颜色不正确\n\n在iOS7上，有时UILabel的省略点的颜色与文字的颜色不同，如下图：\n\n![uilable color error](http://oldblog.shicishuzhai.com/90fa287185b4062e4c37dd86ac05436b.png)\n\n网上查了一下，这应该是iOS7的一个Bug，解决方法就是不要使用textColor设置文字颜色，而使用attributeText，代码如下：\n\n```objectivec\nNSAttributedString *attStr = [[NSAttributedString alloc] initWithString:self.titleLabel.text attributes:@{NSForegroundColorAttributeName:style.fColor, NSFontAttributeName:style.font}];\nself.titleLabel.attributedText = attStr;\n```\n\n参考：[UILabel dotted line color bug in iOS 7.1](http://stackoverflow.com/questions/22718172/uilabel-dotted-line-color-bug-in-ios-7-1)\n\n## iOS7上，给UICollectionViewCell添加长按手势的坑\n\n项目中有一个需求，当长按任何一个UICollectionViewCell时，刷新UICollectionView，每一个Cell的右上角都出现一个选择按钮。效果如下：\n\n![iOS7 UICollectionView longPress](http://oldblog.shicishuzhai.com/88e710b25fdcd0403ba7fe2610bd1547.png)\n\n这是一个比较常见的需求，我的做法是在每一个Cell上添加一个长按手势，然后，在手势触发时，刷新这个UICollectionView，然每一个Cell都显示选择按钮。这样做在iOS8，iOS9上都没有问题，当时在iOS7上却出现了问题。在iOS7上，当触发某一个Cell的长按手势之后，这个Cell就不再响应UICollectionView的`collectionView:didSelectItemAtIndexPath:`方法了。\n\n网上没有找到类似的情况，只能自己解决。最终找到了一种解决方案，代码如下：\n\n```objectivec\n// 必须重新放在主线程队列中，否则在iOS7上回出现Cell不触发didSelect的情况\ndispatch_async(dispatch_get_main_queue(), ^{\n    [self.collectionView reloadData];\n});\n```\n\n要将reloadData重新放在主线程队列中，这样就不会出现这种情况。具体原因不是非常明白，但是，这样确实可以完美的解决这个问题。\n","source":"_posts/2016-06-05-2016年6月开发问题记录.md","raw":"---\nlayout: post\ntitle: \"2016年6月开发问题记录\"\ncategories: \"iOS Tips\"\n---\n\n继续记录6月份开发中遇到的问题。\n\n## UIBarButtonItem点击区域的问题\n\n今天在定制导航上的返回按钮遇到了一个问题，顺便记录一下。\n\n一般常规的定制导航栏返回按钮的方法如下：\n\n```objectivec\n self.navigationItem.leftBarButtonItem = [[UIBarButtonItem alloc] initWithImage:[UIImage imageNamed:@\"back\"] style:UIBarButtonItemStyleDone target:self action:@selector(clickBackBtn:)];\n```\n\n这样写有一个问题，运行代码后，返回按钮的可点击区域如下图所示：\n\n![1](http://oldblog.shicishuzhai.com/d869dc4bbc06c476771fc0cfe1b19d49.png)\n\n这并不是我想要的，点击区域太大，完全没有点到返回按钮上都可以触发返回操作。于是换一种思路，用自定义View实现，代码如下：\n\n```objectivec\nUIButton *backBtn = [[UIButton alloc] initWithFrame:CGRectMake(0, 0, 30, 44)];\n[backBtn addTarget:self action:@selector(clickBackBtn:) forControlEvents:UIControlEventTouchUpInside];\n[backBtn setImage:[UIImage imageNamed:@\"back\"] forState:UIControlStateNormal];\nself.navigationItem.leftBarButtonItem = [[UIBarButtonItem alloc] initWithCustomView:backBtn];\n```\n\n编译运行，效果依然一样，点击区域还是太大，如下图：\n\n![2](http://oldblog.shicishuzhai.com/639a2d998265085ba8f03b4fb3cc6068.png)\n\n这我就不明白了，于是一阵Google，找到了一个解决方案，代码如下：\n\n```objectivec\nUIButton *backBtn = [[UIButton alloc] initWithFrame:CGRectMake(0, 0, 30, 44)];\n[backBtn addTarget:self action:@selector(clickBackBtn:) forControlEvents:UIControlEventTouchUpInside];\n[backBtn setImage:[UIImage imageNamed:@\"back\"] forState:UIControlStateNormal];\nUIView *containerView = [[UIView alloc] initWithFrame:CGRectMake(0, 0, 30, 44)];\n[containerView addSubview:backBtn];\nself.navigationItem.leftBarButtonItem = [[UIBarButtonItem alloc] initWithCustomView:containerView];\n```\n\n这样点击区域就正常了，如下图：\n\n![3](http://oldblog.shicishuzhai.com/0b15b63f3ddab728a7c593154f0083a2.png)\n\n其实就是在Button外面又包了一层View，这样点击区域就只有Button那么大，我怀疑，可能是加载BarButtonItem上的自定义View都会被自动的拉长，暂时还没找到其他解决方案。\n\nReference：[UIBarButtonItem tap area](http://stackoverflow.com/questions/16858433/uibarbuttonitem-tap-area)\n\n## 将自定义对象作为NSDictionary的Key\n\n将自定义对象作为NSDictionary的Key，需要重写自定义isEqual方法和hash方法。isEqual方法比较简单，如下代码：\n\n```objectivec\n- (BOOL)isEqual:(id)object {\n    Student *st = (Student *)object;\n    if ([st.name isEqualToString:self.name] && st.age == self.age) {\n        return YES;\n    }\n    else {\n        return NO;\n    }\n}\n\n```\n\n但是如果要把自定义的对象作为NSDictionary的Key，光重写isEqual方法是不够的，还需要重写hash方法，如果不重写hash方法就会导致字典不能正确的添加和删除。重写hash函数的方法很多，可以通过构建不同散列函数来实现，但是无论哪种方法，目的都是尽可能的确保相同的对象返回的hash值相同，一个简单的方法就是使用每一个属性的hash的异或的结果来作为这个对象的hash值。代码如下：\n\n```objectivec\n- (NSUInteger)hash {\n    return [self.name hash] ^ self.age;\n}\n```\n\n这样构建的hash值冲突的概率很小。另外，要作为字典的Key，还必须实现`NSCopying`协议。因为不需要做深拷贝，所以只需要简单的返回self即可，代码如下：\n\n```objectivec\n- (id)copyWithZone:(NSZone *)zone {\n    return self;\n}\n```\n\n这个构建的一个对象就可以作为NSDictionary的Key了。\n\nReference：[Equality](http://nshipster.com/equality/)\n\n## UITableViewCell的“no index path for table cell being reused”问题\n\n项目中有一个自定义的UITableViewCell，由于版本更新，要把这个Cell改为可以悬停的SectionHeader，为了图方便，我没有重新自定义一个View，而是直接在`viewForHeaderInSection:`方法里返回了cell，代码如下：\n\n```objectivec\nLMBookWriteCommentCell *cell = (LMBookWriteCommentCell *)[self tableView:self.tableView writeCommentCellWithIndexPath:nil];\nreturn cell;\n```\n\n这样写有个问题，就是在reloadData时，这SectionHeader就消失了，变成了空白的一片，并且出现了“no index path for table cell being reused”错误，程序没有崩溃，但是就是看不见Cell上的内容。于是一阵Google，终于找到了答案，只要把上面的代码的`return cell;`改为`return cell.contentView;`就可以了。\n\nReference：[What is the meaning of the “no index path for table cell being reused” message in iOS 6/7?](http://stackoverflow.com/questions/12772197/what-is-the-meaning-of-the-no-index-path-for-table-cell-being-reused-message-i?lq=1)\n\n## Autolayout动画的正确姿势\n\n做Autolayout动画的一般步骤是：\n\n1. 修改约束，如果使用Masonry，使用`mas_updateConstraints`方法修改约束，如果使用Xib，则直接把要修改的约束通过拉线链接到代码里进行修改即可。\n2. 在动画的block中，调用View的`layoutIfNeed()`方法。\n\n这里要注意的一点是第二步，如果直接调用`view.layoutIfNeed()`，可能会导致动画不能进行，正确的方法应该是调用`view.superview.layoutIfNeed()`，这样才能正确的进行动画。完整代码如下：\n\n```objectivec\nclass ViewController: UIViewController {\n\n    @IBOutlet weak var myView: UIView!\n    @IBOutlet weak var topConstraint: NSLayoutConstraint!\n\n    override func viewDidLoad() {\n        super.viewDidLoad()\n    }\n\n    override func touchesBegan(touches: Set<UITouch>, withEvent event: UIEvent?) {\n        topConstraint.constant += 100\n        UIView.animateWithDuration(2.0) {\n            self.myView.superview?.layoutIfNeeded()\n        };\n    }\n}\n```\n\n## 在iOS7上UILabel的省略点颜色不正确\n\n在iOS7上，有时UILabel的省略点的颜色与文字的颜色不同，如下图：\n\n![uilable color error](http://oldblog.shicishuzhai.com/90fa287185b4062e4c37dd86ac05436b.png)\n\n网上查了一下，这应该是iOS7的一个Bug，解决方法就是不要使用textColor设置文字颜色，而使用attributeText，代码如下：\n\n```objectivec\nNSAttributedString *attStr = [[NSAttributedString alloc] initWithString:self.titleLabel.text attributes:@{NSForegroundColorAttributeName:style.fColor, NSFontAttributeName:style.font}];\nself.titleLabel.attributedText = attStr;\n```\n\n参考：[UILabel dotted line color bug in iOS 7.1](http://stackoverflow.com/questions/22718172/uilabel-dotted-line-color-bug-in-ios-7-1)\n\n## iOS7上，给UICollectionViewCell添加长按手势的坑\n\n项目中有一个需求，当长按任何一个UICollectionViewCell时，刷新UICollectionView，每一个Cell的右上角都出现一个选择按钮。效果如下：\n\n![iOS7 UICollectionView longPress](http://oldblog.shicishuzhai.com/88e710b25fdcd0403ba7fe2610bd1547.png)\n\n这是一个比较常见的需求，我的做法是在每一个Cell上添加一个长按手势，然后，在手势触发时，刷新这个UICollectionView，然每一个Cell都显示选择按钮。这样做在iOS8，iOS9上都没有问题，当时在iOS7上却出现了问题。在iOS7上，当触发某一个Cell的长按手势之后，这个Cell就不再响应UICollectionView的`collectionView:didSelectItemAtIndexPath:`方法了。\n\n网上没有找到类似的情况，只能自己解决。最终找到了一种解决方案，代码如下：\n\n```objectivec\n// 必须重新放在主线程队列中，否则在iOS7上回出现Cell不触发didSelect的情况\ndispatch_async(dispatch_get_main_queue(), ^{\n    [self.collectionView reloadData];\n});\n```\n\n要将reloadData重新放在主线程队列中，这样就不会出现这种情况。具体原因不是非常明白，但是，这样确实可以完美的解决这个问题。\n","slug":"2016年6月开发问题记录","published":1,"date":"2016-06-04T16:00:00.000Z","updated":"2019-01-13T04:01:04.463Z","comments":1,"photos":[],"link":"","_id":"cjutyfmfa0014c4c9ennwcxn5","content":"<p>继续记录6月份开发中遇到的问题。</p>\n<h2 id=\"UIBarButtonItem点击区域的问题\"><a href=\"#UIBarButtonItem点击区域的问题\" class=\"headerlink\" title=\"UIBarButtonItem点击区域的问题\"></a>UIBarButtonItem点击区域的问题</h2><p>今天在定制导航上的返回按钮遇到了一个问题，顺便记录一下。</p>\n<p>一般常规的定制导航栏返回按钮的方法如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">self</span>.navigationItem.leftBarButtonItem = [[<span class=\"built_in\">UIBarButtonItem</span> alloc] initWithImage:[<span class=\"built_in\">UIImage</span> imageNamed:<span class=\"string\">@\"back\"</span>] style:<span class=\"built_in\">UIBarButtonItemStyleDone</span> target:<span class=\"keyword\">self</span> action:<span class=\"keyword\">@selector</span>(clickBackBtn:)];</span><br></pre></td></tr></table></figure>\n<p>这样写有一个问题，运行代码后，返回按钮的可点击区域如下图所示：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/d869dc4bbc06c476771fc0cfe1b19d49.png\" alt=\"1\"></p>\n<p>这并不是我想要的，点击区域太大，完全没有点到返回按钮上都可以触发返回操作。于是换一种思路，用自定义View实现，代码如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">UIButton</span> *backBtn = [[<span class=\"built_in\">UIButton</span> alloc] initWithFrame:<span class=\"built_in\">CGRectMake</span>(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">30</span>, <span class=\"number\">44</span>)];</span><br><span class=\"line\">[backBtn addTarget:<span class=\"keyword\">self</span> action:<span class=\"keyword\">@selector</span>(clickBackBtn:) forControlEvents:<span class=\"built_in\">UIControlEventTouchUpInside</span>];</span><br><span class=\"line\">[backBtn setImage:[<span class=\"built_in\">UIImage</span> imageNamed:<span class=\"string\">@\"back\"</span>] forState:<span class=\"built_in\">UIControlStateNormal</span>];</span><br><span class=\"line\"><span class=\"keyword\">self</span>.navigationItem.leftBarButtonItem = [[<span class=\"built_in\">UIBarButtonItem</span> alloc] initWithCustomView:backBtn];</span><br></pre></td></tr></table></figure>\n<p>编译运行，效果依然一样，点击区域还是太大，如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/639a2d998265085ba8f03b4fb3cc6068.png\" alt=\"2\"></p>\n<p>这我就不明白了，于是一阵Google，找到了一个解决方案，代码如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">UIButton</span> *backBtn = [[<span class=\"built_in\">UIButton</span> alloc] initWithFrame:<span class=\"built_in\">CGRectMake</span>(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">30</span>, <span class=\"number\">44</span>)];</span><br><span class=\"line\">[backBtn addTarget:<span class=\"keyword\">self</span> action:<span class=\"keyword\">@selector</span>(clickBackBtn:) forControlEvents:<span class=\"built_in\">UIControlEventTouchUpInside</span>];</span><br><span class=\"line\">[backBtn setImage:[<span class=\"built_in\">UIImage</span> imageNamed:<span class=\"string\">@\"back\"</span>] forState:<span class=\"built_in\">UIControlStateNormal</span>];</span><br><span class=\"line\"><span class=\"built_in\">UIView</span> *containerView = [[<span class=\"built_in\">UIView</span> alloc] initWithFrame:<span class=\"built_in\">CGRectMake</span>(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">30</span>, <span class=\"number\">44</span>)];</span><br><span class=\"line\">[containerView addSubview:backBtn];</span><br><span class=\"line\"><span class=\"keyword\">self</span>.navigationItem.leftBarButtonItem = [[<span class=\"built_in\">UIBarButtonItem</span> alloc] initWithCustomView:containerView];</span><br></pre></td></tr></table></figure>\n<p>这样点击区域就正常了，如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/0b15b63f3ddab728a7c593154f0083a2.png\" alt=\"3\"></p>\n<p>其实就是在Button外面又包了一层View，这样点击区域就只有Button那么大，我怀疑，可能是加载BarButtonItem上的自定义View都会被自动的拉长，暂时还没找到其他解决方案。</p>\n<p>Reference：<a href=\"http://stackoverflow.com/questions/16858433/uibarbuttonitem-tap-area\" target=\"_blank\" rel=\"noopener\">UIBarButtonItem tap area</a></p>\n<h2 id=\"将自定义对象作为NSDictionary的Key\"><a href=\"#将自定义对象作为NSDictionary的Key\" class=\"headerlink\" title=\"将自定义对象作为NSDictionary的Key\"></a>将自定义对象作为NSDictionary的Key</h2><p>将自定义对象作为NSDictionary的Key，需要重写自定义isEqual方法和hash方法。isEqual方法比较简单，如下代码：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"built_in\">BOOL</span>)isEqual:(<span class=\"keyword\">id</span>)object &#123;</span><br><span class=\"line\">    Student *st = (Student *)object;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> ([st.name isEqualToString:<span class=\"keyword\">self</span>.name] &amp;&amp; st.age == <span class=\"keyword\">self</span>.age) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">YES</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">NO</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>但是如果要把自定义的对象作为NSDictionary的Key，光重写isEqual方法是不够的，还需要重写hash方法，如果不重写hash方法就会导致字典不能正确的添加和删除。重写hash函数的方法很多，可以通过构建不同散列函数来实现，但是无论哪种方法，目的都是尽可能的确保相同的对象返回的hash值相同，一个简单的方法就是使用每一个属性的hash的异或的结果来作为这个对象的hash值。代码如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"built_in\">NSUInteger</span>)hash &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> [<span class=\"keyword\">self</span>.name hash] ^ <span class=\"keyword\">self</span>.age;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这样构建的hash值冲突的概率很小。另外，要作为字典的Key，还必须实现<code>NSCopying</code>协议。因为不需要做深拷贝，所以只需要简单的返回self即可，代码如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">id</span>)copyWithZone:(<span class=\"built_in\">NSZone</span> *)zone &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">self</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这个构建的一个对象就可以作为NSDictionary的Key了。</p>\n<p>Reference：<a href=\"http://nshipster.com/equality/\" target=\"_blank\" rel=\"noopener\">Equality</a></p>\n<h2 id=\"UITableViewCell的“no-index-path-for-table-cell-being-reused”问题\"><a href=\"#UITableViewCell的“no-index-path-for-table-cell-being-reused”问题\" class=\"headerlink\" title=\"UITableViewCell的“no index path for table cell being reused”问题\"></a>UITableViewCell的“no index path for table cell being reused”问题</h2><p>项目中有一个自定义的UITableViewCell，由于版本更新，要把这个Cell改为可以悬停的SectionHeader，为了图方便，我没有重新自定义一个View，而是直接在<code>viewForHeaderInSection:</code>方法里返回了cell，代码如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">LMBookWriteCommentCell *cell = (LMBookWriteCommentCell *)[<span class=\"keyword\">self</span> tableView:<span class=\"keyword\">self</span>.tableView writeCommentCellWithIndexPath:<span class=\"literal\">nil</span>];</span><br><span class=\"line\"><span class=\"keyword\">return</span> cell;</span><br></pre></td></tr></table></figure>\n<p>这样写有个问题，就是在reloadData时，这SectionHeader就消失了，变成了空白的一片，并且出现了“no index path for table cell being reused”错误，程序没有崩溃，但是就是看不见Cell上的内容。于是一阵Google，终于找到了答案，只要把上面的代码的<code>return cell;</code>改为<code>return cell.contentView;</code>就可以了。</p>\n<p>Reference：<a href=\"http://stackoverflow.com/questions/12772197/what-is-the-meaning-of-the-no-index-path-for-table-cell-being-reused-message-i?lq=1\" target=\"_blank\" rel=\"noopener\">What is the meaning of the “no index path for table cell being reused” message in iOS 6/7?</a></p>\n<h2 id=\"Autolayout动画的正确姿势\"><a href=\"#Autolayout动画的正确姿势\" class=\"headerlink\" title=\"Autolayout动画的正确姿势\"></a>Autolayout动画的正确姿势</h2><p>做Autolayout动画的一般步骤是：</p>\n<ol>\n<li>修改约束，如果使用Masonry，使用<code>mas_updateConstraints</code>方法修改约束，如果使用Xib，则直接把要修改的约束通过拉线链接到代码里进行修改即可。</li>\n<li>在动画的block中，调用View的<code>layoutIfNeed()</code>方法。</li>\n</ol>\n<p>这里要注意的一点是第二步，如果直接调用<code>view.layoutIfNeed()</code>，可能会导致动画不能进行，正确的方法应该是调用<code>view.superview.layoutIfNeed()</code>，这样才能正确的进行动画。完整代码如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> ViewController: <span class=\"built_in\">UIViewController</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    @IBOutlet <span class=\"keyword\">weak</span> var myView: <span class=\"built_in\">UIView</span>!</span><br><span class=\"line\">    @IBOutlet <span class=\"keyword\">weak</span> var topConstraint: <span class=\"built_in\">NSLayoutConstraint</span>!</span><br><span class=\"line\"></span><br><span class=\"line\">    override func viewDidLoad() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.viewDidLoad()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    override func touchesBegan(touches: Set&lt;<span class=\"built_in\">UITouch</span>&gt;, withEvent event: <span class=\"built_in\">UIEvent</span>?) &#123;</span><br><span class=\"line\">        topConstraint.constant += <span class=\"number\">100</span></span><br><span class=\"line\">        <span class=\"built_in\">UIView</span>.animateWithDuration(<span class=\"number\">2.0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">self</span>.myView.superview?.layoutIfNeeded()</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"在iOS7上UILabel的省略点颜色不正确\"><a href=\"#在iOS7上UILabel的省略点颜色不正确\" class=\"headerlink\" title=\"在iOS7上UILabel的省略点颜色不正确\"></a>在iOS7上UILabel的省略点颜色不正确</h2><p>在iOS7上，有时UILabel的省略点的颜色与文字的颜色不同，如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/90fa287185b4062e4c37dd86ac05436b.png\" alt=\"uilable color error\"></p>\n<p>网上查了一下，这应该是iOS7的一个Bug，解决方法就是不要使用textColor设置文字颜色，而使用attributeText，代码如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">NSAttributedString</span> *attStr = [[<span class=\"built_in\">NSAttributedString</span> alloc] initWithString:<span class=\"keyword\">self</span>.titleLabel.text attributes:@&#123;<span class=\"built_in\">NSForegroundColorAttributeName</span>:style.fColor, <span class=\"built_in\">NSFontAttributeName</span>:style.font&#125;];</span><br><span class=\"line\"><span class=\"keyword\">self</span>.titleLabel.attributedText = attStr;</span><br></pre></td></tr></table></figure>\n<p>参考：<a href=\"http://stackoverflow.com/questions/22718172/uilabel-dotted-line-color-bug-in-ios-7-1\" target=\"_blank\" rel=\"noopener\">UILabel dotted line color bug in iOS 7.1</a></p>\n<h2 id=\"iOS7上，给UICollectionViewCell添加长按手势的坑\"><a href=\"#iOS7上，给UICollectionViewCell添加长按手势的坑\" class=\"headerlink\" title=\"iOS7上，给UICollectionViewCell添加长按手势的坑\"></a>iOS7上，给UICollectionViewCell添加长按手势的坑</h2><p>项目中有一个需求，当长按任何一个UICollectionViewCell时，刷新UICollectionView，每一个Cell的右上角都出现一个选择按钮。效果如下：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/88e710b25fdcd0403ba7fe2610bd1547.png\" alt=\"iOS7 UICollectionView longPress\"></p>\n<p>这是一个比较常见的需求，我的做法是在每一个Cell上添加一个长按手势，然后，在手势触发时，刷新这个UICollectionView，然每一个Cell都显示选择按钮。这样做在iOS8，iOS9上都没有问题，当时在iOS7上却出现了问题。在iOS7上，当触发某一个Cell的长按手势之后，这个Cell就不再响应UICollectionView的<code>collectionView:didSelectItemAtIndexPath:</code>方法了。</p>\n<p>网上没有找到类似的情况，只能自己解决。最终找到了一种解决方案，代码如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 必须重新放在主线程队列中，否则在iOS7上回出现Cell不触发didSelect的情况</span></span><br><span class=\"line\"><span class=\"built_in\">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.collectionView reloadData];</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>要将reloadData重新放在主线程队列中，这样就不会出现这种情况。具体原因不是非常明白，但是，这样确实可以完美的解决这个问题。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>继续记录6月份开发中遇到的问题。</p>\n<h2 id=\"UIBarButtonItem点击区域的问题\"><a href=\"#UIBarButtonItem点击区域的问题\" class=\"headerlink\" title=\"UIBarButtonItem点击区域的问题\"></a>UIBarButtonItem点击区域的问题</h2><p>今天在定制导航上的返回按钮遇到了一个问题，顺便记录一下。</p>\n<p>一般常规的定制导航栏返回按钮的方法如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">self</span>.navigationItem.leftBarButtonItem = [[<span class=\"built_in\">UIBarButtonItem</span> alloc] initWithImage:[<span class=\"built_in\">UIImage</span> imageNamed:<span class=\"string\">@\"back\"</span>] style:<span class=\"built_in\">UIBarButtonItemStyleDone</span> target:<span class=\"keyword\">self</span> action:<span class=\"keyword\">@selector</span>(clickBackBtn:)];</span><br></pre></td></tr></table></figure>\n<p>这样写有一个问题，运行代码后，返回按钮的可点击区域如下图所示：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/d869dc4bbc06c476771fc0cfe1b19d49.png\" alt=\"1\"></p>\n<p>这并不是我想要的，点击区域太大，完全没有点到返回按钮上都可以触发返回操作。于是换一种思路，用自定义View实现，代码如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">UIButton</span> *backBtn = [[<span class=\"built_in\">UIButton</span> alloc] initWithFrame:<span class=\"built_in\">CGRectMake</span>(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">30</span>, <span class=\"number\">44</span>)];</span><br><span class=\"line\">[backBtn addTarget:<span class=\"keyword\">self</span> action:<span class=\"keyword\">@selector</span>(clickBackBtn:) forControlEvents:<span class=\"built_in\">UIControlEventTouchUpInside</span>];</span><br><span class=\"line\">[backBtn setImage:[<span class=\"built_in\">UIImage</span> imageNamed:<span class=\"string\">@\"back\"</span>] forState:<span class=\"built_in\">UIControlStateNormal</span>];</span><br><span class=\"line\"><span class=\"keyword\">self</span>.navigationItem.leftBarButtonItem = [[<span class=\"built_in\">UIBarButtonItem</span> alloc] initWithCustomView:backBtn];</span><br></pre></td></tr></table></figure>\n<p>编译运行，效果依然一样，点击区域还是太大，如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/639a2d998265085ba8f03b4fb3cc6068.png\" alt=\"2\"></p>\n<p>这我就不明白了，于是一阵Google，找到了一个解决方案，代码如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">UIButton</span> *backBtn = [[<span class=\"built_in\">UIButton</span> alloc] initWithFrame:<span class=\"built_in\">CGRectMake</span>(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">30</span>, <span class=\"number\">44</span>)];</span><br><span class=\"line\">[backBtn addTarget:<span class=\"keyword\">self</span> action:<span class=\"keyword\">@selector</span>(clickBackBtn:) forControlEvents:<span class=\"built_in\">UIControlEventTouchUpInside</span>];</span><br><span class=\"line\">[backBtn setImage:[<span class=\"built_in\">UIImage</span> imageNamed:<span class=\"string\">@\"back\"</span>] forState:<span class=\"built_in\">UIControlStateNormal</span>];</span><br><span class=\"line\"><span class=\"built_in\">UIView</span> *containerView = [[<span class=\"built_in\">UIView</span> alloc] initWithFrame:<span class=\"built_in\">CGRectMake</span>(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">30</span>, <span class=\"number\">44</span>)];</span><br><span class=\"line\">[containerView addSubview:backBtn];</span><br><span class=\"line\"><span class=\"keyword\">self</span>.navigationItem.leftBarButtonItem = [[<span class=\"built_in\">UIBarButtonItem</span> alloc] initWithCustomView:containerView];</span><br></pre></td></tr></table></figure>\n<p>这样点击区域就正常了，如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/0b15b63f3ddab728a7c593154f0083a2.png\" alt=\"3\"></p>\n<p>其实就是在Button外面又包了一层View，这样点击区域就只有Button那么大，我怀疑，可能是加载BarButtonItem上的自定义View都会被自动的拉长，暂时还没找到其他解决方案。</p>\n<p>Reference：<a href=\"http://stackoverflow.com/questions/16858433/uibarbuttonitem-tap-area\" target=\"_blank\" rel=\"noopener\">UIBarButtonItem tap area</a></p>\n<h2 id=\"将自定义对象作为NSDictionary的Key\"><a href=\"#将自定义对象作为NSDictionary的Key\" class=\"headerlink\" title=\"将自定义对象作为NSDictionary的Key\"></a>将自定义对象作为NSDictionary的Key</h2><p>将自定义对象作为NSDictionary的Key，需要重写自定义isEqual方法和hash方法。isEqual方法比较简单，如下代码：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"built_in\">BOOL</span>)isEqual:(<span class=\"keyword\">id</span>)object &#123;</span><br><span class=\"line\">    Student *st = (Student *)object;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> ([st.name isEqualToString:<span class=\"keyword\">self</span>.name] &amp;&amp; st.age == <span class=\"keyword\">self</span>.age) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">YES</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">NO</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>但是如果要把自定义的对象作为NSDictionary的Key，光重写isEqual方法是不够的，还需要重写hash方法，如果不重写hash方法就会导致字典不能正确的添加和删除。重写hash函数的方法很多，可以通过构建不同散列函数来实现，但是无论哪种方法，目的都是尽可能的确保相同的对象返回的hash值相同，一个简单的方法就是使用每一个属性的hash的异或的结果来作为这个对象的hash值。代码如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"built_in\">NSUInteger</span>)hash &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> [<span class=\"keyword\">self</span>.name hash] ^ <span class=\"keyword\">self</span>.age;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这样构建的hash值冲突的概率很小。另外，要作为字典的Key，还必须实现<code>NSCopying</code>协议。因为不需要做深拷贝，所以只需要简单的返回self即可，代码如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">id</span>)copyWithZone:(<span class=\"built_in\">NSZone</span> *)zone &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">self</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这个构建的一个对象就可以作为NSDictionary的Key了。</p>\n<p>Reference：<a href=\"http://nshipster.com/equality/\" target=\"_blank\" rel=\"noopener\">Equality</a></p>\n<h2 id=\"UITableViewCell的“no-index-path-for-table-cell-being-reused”问题\"><a href=\"#UITableViewCell的“no-index-path-for-table-cell-being-reused”问题\" class=\"headerlink\" title=\"UITableViewCell的“no index path for table cell being reused”问题\"></a>UITableViewCell的“no index path for table cell being reused”问题</h2><p>项目中有一个自定义的UITableViewCell，由于版本更新，要把这个Cell改为可以悬停的SectionHeader，为了图方便，我没有重新自定义一个View，而是直接在<code>viewForHeaderInSection:</code>方法里返回了cell，代码如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">LMBookWriteCommentCell *cell = (LMBookWriteCommentCell *)[<span class=\"keyword\">self</span> tableView:<span class=\"keyword\">self</span>.tableView writeCommentCellWithIndexPath:<span class=\"literal\">nil</span>];</span><br><span class=\"line\"><span class=\"keyword\">return</span> cell;</span><br></pre></td></tr></table></figure>\n<p>这样写有个问题，就是在reloadData时，这SectionHeader就消失了，变成了空白的一片，并且出现了“no index path for table cell being reused”错误，程序没有崩溃，但是就是看不见Cell上的内容。于是一阵Google，终于找到了答案，只要把上面的代码的<code>return cell;</code>改为<code>return cell.contentView;</code>就可以了。</p>\n<p>Reference：<a href=\"http://stackoverflow.com/questions/12772197/what-is-the-meaning-of-the-no-index-path-for-table-cell-being-reused-message-i?lq=1\" target=\"_blank\" rel=\"noopener\">What is the meaning of the “no index path for table cell being reused” message in iOS 6/7?</a></p>\n<h2 id=\"Autolayout动画的正确姿势\"><a href=\"#Autolayout动画的正确姿势\" class=\"headerlink\" title=\"Autolayout动画的正确姿势\"></a>Autolayout动画的正确姿势</h2><p>做Autolayout动画的一般步骤是：</p>\n<ol>\n<li>修改约束，如果使用Masonry，使用<code>mas_updateConstraints</code>方法修改约束，如果使用Xib，则直接把要修改的约束通过拉线链接到代码里进行修改即可。</li>\n<li>在动画的block中，调用View的<code>layoutIfNeed()</code>方法。</li>\n</ol>\n<p>这里要注意的一点是第二步，如果直接调用<code>view.layoutIfNeed()</code>，可能会导致动画不能进行，正确的方法应该是调用<code>view.superview.layoutIfNeed()</code>，这样才能正确的进行动画。完整代码如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> ViewController: <span class=\"built_in\">UIViewController</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    @IBOutlet <span class=\"keyword\">weak</span> var myView: <span class=\"built_in\">UIView</span>!</span><br><span class=\"line\">    @IBOutlet <span class=\"keyword\">weak</span> var topConstraint: <span class=\"built_in\">NSLayoutConstraint</span>!</span><br><span class=\"line\"></span><br><span class=\"line\">    override func viewDidLoad() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.viewDidLoad()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    override func touchesBegan(touches: Set&lt;<span class=\"built_in\">UITouch</span>&gt;, withEvent event: <span class=\"built_in\">UIEvent</span>?) &#123;</span><br><span class=\"line\">        topConstraint.constant += <span class=\"number\">100</span></span><br><span class=\"line\">        <span class=\"built_in\">UIView</span>.animateWithDuration(<span class=\"number\">2.0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">self</span>.myView.superview?.layoutIfNeeded()</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"在iOS7上UILabel的省略点颜色不正确\"><a href=\"#在iOS7上UILabel的省略点颜色不正确\" class=\"headerlink\" title=\"在iOS7上UILabel的省略点颜色不正确\"></a>在iOS7上UILabel的省略点颜色不正确</h2><p>在iOS7上，有时UILabel的省略点的颜色与文字的颜色不同，如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/90fa287185b4062e4c37dd86ac05436b.png\" alt=\"uilable color error\"></p>\n<p>网上查了一下，这应该是iOS7的一个Bug，解决方法就是不要使用textColor设置文字颜色，而使用attributeText，代码如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">NSAttributedString</span> *attStr = [[<span class=\"built_in\">NSAttributedString</span> alloc] initWithString:<span class=\"keyword\">self</span>.titleLabel.text attributes:@&#123;<span class=\"built_in\">NSForegroundColorAttributeName</span>:style.fColor, <span class=\"built_in\">NSFontAttributeName</span>:style.font&#125;];</span><br><span class=\"line\"><span class=\"keyword\">self</span>.titleLabel.attributedText = attStr;</span><br></pre></td></tr></table></figure>\n<p>参考：<a href=\"http://stackoverflow.com/questions/22718172/uilabel-dotted-line-color-bug-in-ios-7-1\" target=\"_blank\" rel=\"noopener\">UILabel dotted line color bug in iOS 7.1</a></p>\n<h2 id=\"iOS7上，给UICollectionViewCell添加长按手势的坑\"><a href=\"#iOS7上，给UICollectionViewCell添加长按手势的坑\" class=\"headerlink\" title=\"iOS7上，给UICollectionViewCell添加长按手势的坑\"></a>iOS7上，给UICollectionViewCell添加长按手势的坑</h2><p>项目中有一个需求，当长按任何一个UICollectionViewCell时，刷新UICollectionView，每一个Cell的右上角都出现一个选择按钮。效果如下：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/88e710b25fdcd0403ba7fe2610bd1547.png\" alt=\"iOS7 UICollectionView longPress\"></p>\n<p>这是一个比较常见的需求，我的做法是在每一个Cell上添加一个长按手势，然后，在手势触发时，刷新这个UICollectionView，然每一个Cell都显示选择按钮。这样做在iOS8，iOS9上都没有问题，当时在iOS7上却出现了问题。在iOS7上，当触发某一个Cell的长按手势之后，这个Cell就不再响应UICollectionView的<code>collectionView:didSelectItemAtIndexPath:</code>方法了。</p>\n<p>网上没有找到类似的情况，只能自己解决。最终找到了一种解决方案，代码如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 必须重新放在主线程队列中，否则在iOS7上回出现Cell不触发didSelect的情况</span></span><br><span class=\"line\"><span class=\"built_in\">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.collectionView reloadData];</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>要将reloadData重新放在主线程队列中，这样就不会出现这种情况。具体原因不是非常明白，但是，这样确实可以完美的解决这个问题。</p>\n"},{"layout":"post","title":"《ios核心动画高级技巧》阅读笔记(2)","_content":"## 第三章 图层集合学\n\n### 布局\n\n* frame：图层的相对于父图层的外部坐标\n* bounds：内部坐标\n* center和position：相对于父图层anchorPoint所在的位置\n* 设置视图的frame，bounds和center，也就是相当于设置图层的frame，bounds和position\n* 一般情况下，frame中的size与bounds中的size是相同的，但是当视图旋转时，frame的size和bounds的size就不一样了，如下图\n\n![frame&bounds&center](http://oldblog.shicishuzhai.com/a592d9f689fe8a2818583430f5a8211d.png)\n\n### 锚点\n\n* 锚点是相对于父图层anchorPoint所在的位置。\n* 默认，锚点位于图层的中点，可以改变锚点的位置，描点改变，frame也会随之改变。\n\n![anchorPoint](http://oldblog.shicishuzhai.com/99c7a6ddc1d2b162816b2a9ef5ff568f.png)\n\n* 改变锚点，position不会改变，但是frame改变了。\n* anchorPoint是View在旋转是的轴点，如果想改变view的旋转轴点，改变anchorPoint即可\n\n### 坐标系\n\n* 与UIView一样，CALayer也提供了一套坐标变换的借口\n\n```objectivec\n- (CGPoint)convertPoint:(CGPoint)p fromLayer:(nullable CALayer *)l;\n- (CGPoint)convertPoint:(CGPoint)p toLayer:(nullable CALayer *)l;\n- (CGRect)convertRect:(CGRect)r fromLayer:(nullable CALayer *)l;\n- (CGRect)convertRect:(CGRect)r toLayer:(nullable CALayer *)l;\n```\n\n### 翻转的几何结构\n\n* ios上坐标系原点为左上角，macOS上坐标系原点为左下角。\n* CALayer的`geometryFlipped`属性决定了图层的坐标是否相对于父图层翻转。\n\n### z坐标轴\n\n* zPosition：表示图层空间z轴上的位置\n* zPosition除了可以改变z轴的位置，还可以用来改变图层的先后顺序，如图，如果设置了绿色view的zPosition，绿色View就可以覆盖在蓝色view之上。但是通过这种方法改变视图的层次，是不能改变视图的响应事件的顺序的。\n\n![zPositon](http://oldblog.shicishuzhai.com/d673bc31fdbe28367ad557ac739a60fd.png)\n\n* anchorPointZ表示z轴上锚点的位置\n\n### Hit Testing\n\n* CALayer不能处理点击事件，但是他有一系列方法帮你处理事件。\n* `- (BOOL)containsPoint:(CGPoint)p;`用于判断一个点是否属于一个图层\n* `- (nullable CALayer *)hitTest:(CGPoint)p;`返回被点击的图层\n\n```objectivec\n- (void)touchesBegan:(NSSet<UITouch *> *)touches withEvent:(UIEvent *)event {\n    UITouch *touch = [touches anyObject];\n    CGPoint point = [touch locationInView:self.view];\n\n    point = [self.layerView convertPoint:point fromView:self.view];\n    BOOL ret = [self.layerView.layer containsPoint:point];\n    if (ret) {\n        NSLog(@\"green\");\n    }\n\n    point = [self.buleView convertPoint:point fromView:self.layerView];\n    ret = [self.buleView.layer containsPoint:point];\n    if (ret) {\n        NSLog(@\"blue\");\n    }\n\n    CALayer *layer = [self.view.layer hitTest:point];\n    if (layer == self.layerView.layer) {\n        NSLog(@\"green\");\n    }\n    else if(layer == self.buleView.layer) {\n        NSLog(@\"blue\");\n    }\n\n}\n```\n","source":"_posts/2015-12-27-《ios核心动画高级技巧》阅读笔记(2).md","raw":"---\nlayout: post\ntitle: \"《ios核心动画高级技巧》阅读笔记(2)\"\ncategories: \"读书笔记\"\n---\n## 第三章 图层集合学\n\n### 布局\n\n* frame：图层的相对于父图层的外部坐标\n* bounds：内部坐标\n* center和position：相对于父图层anchorPoint所在的位置\n* 设置视图的frame，bounds和center，也就是相当于设置图层的frame，bounds和position\n* 一般情况下，frame中的size与bounds中的size是相同的，但是当视图旋转时，frame的size和bounds的size就不一样了，如下图\n\n![frame&bounds&center](http://oldblog.shicishuzhai.com/a592d9f689fe8a2818583430f5a8211d.png)\n\n### 锚点\n\n* 锚点是相对于父图层anchorPoint所在的位置。\n* 默认，锚点位于图层的中点，可以改变锚点的位置，描点改变，frame也会随之改变。\n\n![anchorPoint](http://oldblog.shicishuzhai.com/99c7a6ddc1d2b162816b2a9ef5ff568f.png)\n\n* 改变锚点，position不会改变，但是frame改变了。\n* anchorPoint是View在旋转是的轴点，如果想改变view的旋转轴点，改变anchorPoint即可\n\n### 坐标系\n\n* 与UIView一样，CALayer也提供了一套坐标变换的借口\n\n```objectivec\n- (CGPoint)convertPoint:(CGPoint)p fromLayer:(nullable CALayer *)l;\n- (CGPoint)convertPoint:(CGPoint)p toLayer:(nullable CALayer *)l;\n- (CGRect)convertRect:(CGRect)r fromLayer:(nullable CALayer *)l;\n- (CGRect)convertRect:(CGRect)r toLayer:(nullable CALayer *)l;\n```\n\n### 翻转的几何结构\n\n* ios上坐标系原点为左上角，macOS上坐标系原点为左下角。\n* CALayer的`geometryFlipped`属性决定了图层的坐标是否相对于父图层翻转。\n\n### z坐标轴\n\n* zPosition：表示图层空间z轴上的位置\n* zPosition除了可以改变z轴的位置，还可以用来改变图层的先后顺序，如图，如果设置了绿色view的zPosition，绿色View就可以覆盖在蓝色view之上。但是通过这种方法改变视图的层次，是不能改变视图的响应事件的顺序的。\n\n![zPositon](http://oldblog.shicishuzhai.com/d673bc31fdbe28367ad557ac739a60fd.png)\n\n* anchorPointZ表示z轴上锚点的位置\n\n### Hit Testing\n\n* CALayer不能处理点击事件，但是他有一系列方法帮你处理事件。\n* `- (BOOL)containsPoint:(CGPoint)p;`用于判断一个点是否属于一个图层\n* `- (nullable CALayer *)hitTest:(CGPoint)p;`返回被点击的图层\n\n```objectivec\n- (void)touchesBegan:(NSSet<UITouch *> *)touches withEvent:(UIEvent *)event {\n    UITouch *touch = [touches anyObject];\n    CGPoint point = [touch locationInView:self.view];\n\n    point = [self.layerView convertPoint:point fromView:self.view];\n    BOOL ret = [self.layerView.layer containsPoint:point];\n    if (ret) {\n        NSLog(@\"green\");\n    }\n\n    point = [self.buleView convertPoint:point fromView:self.layerView];\n    ret = [self.buleView.layer containsPoint:point];\n    if (ret) {\n        NSLog(@\"blue\");\n    }\n\n    CALayer *layer = [self.view.layer hitTest:point];\n    if (layer == self.layerView.layer) {\n        NSLog(@\"green\");\n    }\n    else if(layer == self.buleView.layer) {\n        NSLog(@\"blue\");\n    }\n\n}\n```\n","slug":"《ios核心动画高级技巧》阅读笔记(2)","published":1,"date":"2015-12-26T16:00:00.000Z","updated":"2019-01-13T04:01:04.524Z","comments":1,"photos":[],"link":"","_id":"cjutyfmfa0016c4c9j4mfu2kl","content":"<h2 id=\"第三章-图层集合学\"><a href=\"#第三章-图层集合学\" class=\"headerlink\" title=\"第三章 图层集合学\"></a>第三章 图层集合学</h2><h3 id=\"布局\"><a href=\"#布局\" class=\"headerlink\" title=\"布局\"></a>布局</h3><ul>\n<li>frame：图层的相对于父图层的外部坐标</li>\n<li>bounds：内部坐标</li>\n<li>center和position：相对于父图层anchorPoint所在的位置</li>\n<li>设置视图的frame，bounds和center，也就是相当于设置图层的frame，bounds和position</li>\n<li>一般情况下，frame中的size与bounds中的size是相同的，但是当视图旋转时，frame的size和bounds的size就不一样了，如下图</li>\n</ul>\n<p><img src=\"http://oldblog.shicishuzhai.com/a592d9f689fe8a2818583430f5a8211d.png\" alt=\"frame&amp;bounds&amp;center\"></p>\n<h3 id=\"锚点\"><a href=\"#锚点\" class=\"headerlink\" title=\"锚点\"></a>锚点</h3><ul>\n<li>锚点是相对于父图层anchorPoint所在的位置。</li>\n<li>默认，锚点位于图层的中点，可以改变锚点的位置，描点改变，frame也会随之改变。</li>\n</ul>\n<p><img src=\"http://oldblog.shicishuzhai.com/99c7a6ddc1d2b162816b2a9ef5ff568f.png\" alt=\"anchorPoint\"></p>\n<ul>\n<li>改变锚点，position不会改变，但是frame改变了。</li>\n<li>anchorPoint是View在旋转是的轴点，如果想改变view的旋转轴点，改变anchorPoint即可</li>\n</ul>\n<h3 id=\"坐标系\"><a href=\"#坐标系\" class=\"headerlink\" title=\"坐标系\"></a>坐标系</h3><ul>\n<li>与UIView一样，CALayer也提供了一套坐标变换的借口</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"built_in\">CGPoint</span>)convertPoint:(<span class=\"built_in\">CGPoint</span>)p fromLayer:(<span class=\"keyword\">nullable</span> <span class=\"built_in\">CALayer</span> *)l;</span><br><span class=\"line\">- (<span class=\"built_in\">CGPoint</span>)convertPoint:(<span class=\"built_in\">CGPoint</span>)p toLayer:(<span class=\"keyword\">nullable</span> <span class=\"built_in\">CALayer</span> *)l;</span><br><span class=\"line\">- (<span class=\"built_in\">CGRect</span>)convertRect:(<span class=\"built_in\">CGRect</span>)r fromLayer:(<span class=\"keyword\">nullable</span> <span class=\"built_in\">CALayer</span> *)l;</span><br><span class=\"line\">- (<span class=\"built_in\">CGRect</span>)convertRect:(<span class=\"built_in\">CGRect</span>)r toLayer:(<span class=\"keyword\">nullable</span> <span class=\"built_in\">CALayer</span> *)l;</span><br></pre></td></tr></table></figure>\n<h3 id=\"翻转的几何结构\"><a href=\"#翻转的几何结构\" class=\"headerlink\" title=\"翻转的几何结构\"></a>翻转的几何结构</h3><ul>\n<li>ios上坐标系原点为左上角，macOS上坐标系原点为左下角。</li>\n<li>CALayer的<code>geometryFlipped</code>属性决定了图层的坐标是否相对于父图层翻转。</li>\n</ul>\n<h3 id=\"z坐标轴\"><a href=\"#z坐标轴\" class=\"headerlink\" title=\"z坐标轴\"></a>z坐标轴</h3><ul>\n<li>zPosition：表示图层空间z轴上的位置</li>\n<li>zPosition除了可以改变z轴的位置，还可以用来改变图层的先后顺序，如图，如果设置了绿色view的zPosition，绿色View就可以覆盖在蓝色view之上。但是通过这种方法改变视图的层次，是不能改变视图的响应事件的顺序的。</li>\n</ul>\n<p><img src=\"http://oldblog.shicishuzhai.com/d673bc31fdbe28367ad557ac739a60fd.png\" alt=\"zPositon\"></p>\n<ul>\n<li>anchorPointZ表示z轴上锚点的位置</li>\n</ul>\n<h3 id=\"Hit-Testing\"><a href=\"#Hit-Testing\" class=\"headerlink\" title=\"Hit Testing\"></a>Hit Testing</h3><ul>\n<li>CALayer不能处理点击事件，但是他有一系列方法帮你处理事件。</li>\n<li><code>- (BOOL)containsPoint:(CGPoint)p;</code>用于判断一个点是否属于一个图层</li>\n<li><code>- (nullable CALayer *)hitTest:(CGPoint)p;</code>返回被点击的图层</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)touchesBegan:(<span class=\"built_in\">NSSet</span>&lt;<span class=\"built_in\">UITouch</span> *&gt; *)touches withEvent:(<span class=\"built_in\">UIEvent</span> *)event &#123;</span><br><span class=\"line\">    <span class=\"built_in\">UITouch</span> *touch = [touches anyObject];</span><br><span class=\"line\">    <span class=\"built_in\">CGPoint</span> point = [touch locationInView:<span class=\"keyword\">self</span>.view];</span><br><span class=\"line\"></span><br><span class=\"line\">    point = [<span class=\"keyword\">self</span>.layerView convertPoint:point fromView:<span class=\"keyword\">self</span>.view];</span><br><span class=\"line\">    <span class=\"built_in\">BOOL</span> ret = [<span class=\"keyword\">self</span>.layerView.layer containsPoint:point];</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (ret) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"green\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    point = [<span class=\"keyword\">self</span>.buleView convertPoint:point fromView:<span class=\"keyword\">self</span>.layerView];</span><br><span class=\"line\">    ret = [<span class=\"keyword\">self</span>.buleView.layer containsPoint:point];</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (ret) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"blue\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">CALayer</span> *layer = [<span class=\"keyword\">self</span>.view.layer hitTest:point];</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (layer == <span class=\"keyword\">self</span>.layerView.layer) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"green\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(layer == <span class=\"keyword\">self</span>.buleView.layer) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"blue\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"第三章-图层集合学\"><a href=\"#第三章-图层集合学\" class=\"headerlink\" title=\"第三章 图层集合学\"></a>第三章 图层集合学</h2><h3 id=\"布局\"><a href=\"#布局\" class=\"headerlink\" title=\"布局\"></a>布局</h3><ul>\n<li>frame：图层的相对于父图层的外部坐标</li>\n<li>bounds：内部坐标</li>\n<li>center和position：相对于父图层anchorPoint所在的位置</li>\n<li>设置视图的frame，bounds和center，也就是相当于设置图层的frame，bounds和position</li>\n<li>一般情况下，frame中的size与bounds中的size是相同的，但是当视图旋转时，frame的size和bounds的size就不一样了，如下图</li>\n</ul>\n<p><img src=\"http://oldblog.shicishuzhai.com/a592d9f689fe8a2818583430f5a8211d.png\" alt=\"frame&amp;bounds&amp;center\"></p>\n<h3 id=\"锚点\"><a href=\"#锚点\" class=\"headerlink\" title=\"锚点\"></a>锚点</h3><ul>\n<li>锚点是相对于父图层anchorPoint所在的位置。</li>\n<li>默认，锚点位于图层的中点，可以改变锚点的位置，描点改变，frame也会随之改变。</li>\n</ul>\n<p><img src=\"http://oldblog.shicishuzhai.com/99c7a6ddc1d2b162816b2a9ef5ff568f.png\" alt=\"anchorPoint\"></p>\n<ul>\n<li>改变锚点，position不会改变，但是frame改变了。</li>\n<li>anchorPoint是View在旋转是的轴点，如果想改变view的旋转轴点，改变anchorPoint即可</li>\n</ul>\n<h3 id=\"坐标系\"><a href=\"#坐标系\" class=\"headerlink\" title=\"坐标系\"></a>坐标系</h3><ul>\n<li>与UIView一样，CALayer也提供了一套坐标变换的借口</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"built_in\">CGPoint</span>)convertPoint:(<span class=\"built_in\">CGPoint</span>)p fromLayer:(<span class=\"keyword\">nullable</span> <span class=\"built_in\">CALayer</span> *)l;</span><br><span class=\"line\">- (<span class=\"built_in\">CGPoint</span>)convertPoint:(<span class=\"built_in\">CGPoint</span>)p toLayer:(<span class=\"keyword\">nullable</span> <span class=\"built_in\">CALayer</span> *)l;</span><br><span class=\"line\">- (<span class=\"built_in\">CGRect</span>)convertRect:(<span class=\"built_in\">CGRect</span>)r fromLayer:(<span class=\"keyword\">nullable</span> <span class=\"built_in\">CALayer</span> *)l;</span><br><span class=\"line\">- (<span class=\"built_in\">CGRect</span>)convertRect:(<span class=\"built_in\">CGRect</span>)r toLayer:(<span class=\"keyword\">nullable</span> <span class=\"built_in\">CALayer</span> *)l;</span><br></pre></td></tr></table></figure>\n<h3 id=\"翻转的几何结构\"><a href=\"#翻转的几何结构\" class=\"headerlink\" title=\"翻转的几何结构\"></a>翻转的几何结构</h3><ul>\n<li>ios上坐标系原点为左上角，macOS上坐标系原点为左下角。</li>\n<li>CALayer的<code>geometryFlipped</code>属性决定了图层的坐标是否相对于父图层翻转。</li>\n</ul>\n<h3 id=\"z坐标轴\"><a href=\"#z坐标轴\" class=\"headerlink\" title=\"z坐标轴\"></a>z坐标轴</h3><ul>\n<li>zPosition：表示图层空间z轴上的位置</li>\n<li>zPosition除了可以改变z轴的位置，还可以用来改变图层的先后顺序，如图，如果设置了绿色view的zPosition，绿色View就可以覆盖在蓝色view之上。但是通过这种方法改变视图的层次，是不能改变视图的响应事件的顺序的。</li>\n</ul>\n<p><img src=\"http://oldblog.shicishuzhai.com/d673bc31fdbe28367ad557ac739a60fd.png\" alt=\"zPositon\"></p>\n<ul>\n<li>anchorPointZ表示z轴上锚点的位置</li>\n</ul>\n<h3 id=\"Hit-Testing\"><a href=\"#Hit-Testing\" class=\"headerlink\" title=\"Hit Testing\"></a>Hit Testing</h3><ul>\n<li>CALayer不能处理点击事件，但是他有一系列方法帮你处理事件。</li>\n<li><code>- (BOOL)containsPoint:(CGPoint)p;</code>用于判断一个点是否属于一个图层</li>\n<li><code>- (nullable CALayer *)hitTest:(CGPoint)p;</code>返回被点击的图层</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)touchesBegan:(<span class=\"built_in\">NSSet</span>&lt;<span class=\"built_in\">UITouch</span> *&gt; *)touches withEvent:(<span class=\"built_in\">UIEvent</span> *)event &#123;</span><br><span class=\"line\">    <span class=\"built_in\">UITouch</span> *touch = [touches anyObject];</span><br><span class=\"line\">    <span class=\"built_in\">CGPoint</span> point = [touch locationInView:<span class=\"keyword\">self</span>.view];</span><br><span class=\"line\"></span><br><span class=\"line\">    point = [<span class=\"keyword\">self</span>.layerView convertPoint:point fromView:<span class=\"keyword\">self</span>.view];</span><br><span class=\"line\">    <span class=\"built_in\">BOOL</span> ret = [<span class=\"keyword\">self</span>.layerView.layer containsPoint:point];</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (ret) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"green\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    point = [<span class=\"keyword\">self</span>.buleView convertPoint:point fromView:<span class=\"keyword\">self</span>.layerView];</span><br><span class=\"line\">    ret = [<span class=\"keyword\">self</span>.buleView.layer containsPoint:point];</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (ret) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"blue\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">CALayer</span> *layer = [<span class=\"keyword\">self</span>.view.layer hitTest:point];</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (layer == <span class=\"keyword\">self</span>.layerView.layer) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"green\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(layer == <span class=\"keyword\">self</span>.buleView.layer) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"blue\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n"},{"layout":"post","title":"打造自己的翻墙VPS:搬运工VPS购买使用流程全记录","_content":"\n端午节在家无聊，买了一个VPS，打算做翻墙用，下面是我购买和使用的一个流程全集了，主要以截图为主，文字为辅。\n\n我选的VPS是[搬运工](https://bandwagonhost.com/index.php)，因为网上教程比较多，而且支持支付宝支付（实际证明支付宝支付就是个坑）。\n\n## 第一步：购买搬运工VPS\n\n打开[搬运工](https://bandwagonhost.com/index.php)官网，点击Home\n\n![1](http://oldblog.shicishuzhai.com/bed44e502ad30c6337a757df1096eb42.png)\n\n选择一个套餐，点击OrderNow，出现了一个错误界面，没关系，继续点击Please Check...\n\n![2](http://oldblog.shicishuzhai.com/6521ec84ff41c1c28efcbaf55195b41b.png)\n\n往下拉，选择一个套餐，显示out of stock是已经售罄的，选择一个没有售罄的，点击Order Now（便宜的都卖完了😭😭）\n\n![3](http://oldblog.shicishuzhai.com/4d0c8ffde0ee4fabd1619a2f76cd142d.png)\n\n我选的是4.99$每月的套餐，然后选择计费周期和机房地址，计费周期有每月，每季度，每半年，每年，机房地址如果开通后觉得速度慢可以换的，选择完成后，点击Add to Cart\n\n![4](http://oldblog.shicishuzhai.com/df89863eb89691d23f8ede6df91474ac.png)\n\n填写优惠码（如果有的话），然后点击CheckOut提交订单\n\n![5](http://oldblog.shicishuzhai.com/22185a6765ad03c3c490039547b1a6f9.png)\n\n填写支付信息，可以选择支付宝支付，然后点击Complete Order完成订单\n\n![6](http://oldblog.shicishuzhai.com/c52d6ec41f2fe7306d95fe02c150ff3c.png)\n\n然后，点击PayNow\n\n![7](http://oldblog.shicishuzhai.com/8c5c7146ebeae385a78a0d2ff4f41d50.png)\n\n点了好几遍，使用没反应，最后无奈，只能使用PayPal（坑！！）\n\n![8](http://oldblog.shicishuzhai.com/5044a701d5863fb3df75cde054e40bf1.png)\n\n然后登陆PayPal，确认订单，支付就可了。支付完成后，返回搬运工，可以看到一个订单号，这就说明订单已经完成了。\n\n![9](http://oldblog.shicishuzhai.com/b1919f5edb17005e107f2cda76ea6543.png)\n\n## 第二步：如何使用搬运工\n\n* 查看主机\n\n![10](http://oldblog.shicishuzhai.com/0d844d6592095394205b3ec705c27c07.png)\n\n![11](http://oldblog.shicishuzhai.com/519dd5c39986045804589fb1c2037bc1.png)\n\n![12](http://oldblog.shicishuzhai.com/32ba5f9b92493a7fae77e566ffeb1899.png)\n\n* 管理我的VPS，点击KiwiVM..进入管理界面，这里可以查看服务器的状态，以及进行各种管理操作，具体操作方法可以参考最后我的两篇博客链接。\n\n![13](http://oldblog.shicishuzhai.com/765e9238bfc53b4d7efcf7eddadc1713.png)\n\n## 第三步：一键安装shadowsocks（搬运工这个功能太赞啦）\n\n进入管理界面，然后点击Shadowsocks Server，然后点击Install Sh...\n\n![14](http://oldblog.shicishuzhai.com/6c277b288f658f0f46b49692ad44cd07.png)\n\n安装完成后，点击返回，就可以看到你的SS的端口和密码\n\n![15](http://oldblog.shicishuzhai.com/cf4d5ded8facbea9375c69e1736db8b7.png)\n\n然后跟着上图的“What‘s Next”后面的内容，安装并配置Shadowsocks，就可以使用了。\n\n以上就是这个购买和使用VPS的流程，希望对大家有所帮助。\n\nReference:\n[https://blog.phpgao.com/vps.html](https://blog.phpgao.com/vps.html)\n[http://www.jianshu.com/p/2f51144c35c9](http://www.jianshu.com/p/2f51144c35c9)\n","source":"_posts/2016-06-11-打造自己的翻墙VPS:搬运工VPS购买使用流程全记录.md","raw":"---\nlayout: post\ntitle: \"打造自己的翻墙VPS:搬运工VPS购买使用流程全记录\"\ncategories: \"其他\"\n---\n\n端午节在家无聊，买了一个VPS，打算做翻墙用，下面是我购买和使用的一个流程全集了，主要以截图为主，文字为辅。\n\n我选的VPS是[搬运工](https://bandwagonhost.com/index.php)，因为网上教程比较多，而且支持支付宝支付（实际证明支付宝支付就是个坑）。\n\n## 第一步：购买搬运工VPS\n\n打开[搬运工](https://bandwagonhost.com/index.php)官网，点击Home\n\n![1](http://oldblog.shicishuzhai.com/bed44e502ad30c6337a757df1096eb42.png)\n\n选择一个套餐，点击OrderNow，出现了一个错误界面，没关系，继续点击Please Check...\n\n![2](http://oldblog.shicishuzhai.com/6521ec84ff41c1c28efcbaf55195b41b.png)\n\n往下拉，选择一个套餐，显示out of stock是已经售罄的，选择一个没有售罄的，点击Order Now（便宜的都卖完了😭😭）\n\n![3](http://oldblog.shicishuzhai.com/4d0c8ffde0ee4fabd1619a2f76cd142d.png)\n\n我选的是4.99$每月的套餐，然后选择计费周期和机房地址，计费周期有每月，每季度，每半年，每年，机房地址如果开通后觉得速度慢可以换的，选择完成后，点击Add to Cart\n\n![4](http://oldblog.shicishuzhai.com/df89863eb89691d23f8ede6df91474ac.png)\n\n填写优惠码（如果有的话），然后点击CheckOut提交订单\n\n![5](http://oldblog.shicishuzhai.com/22185a6765ad03c3c490039547b1a6f9.png)\n\n填写支付信息，可以选择支付宝支付，然后点击Complete Order完成订单\n\n![6](http://oldblog.shicishuzhai.com/c52d6ec41f2fe7306d95fe02c150ff3c.png)\n\n然后，点击PayNow\n\n![7](http://oldblog.shicishuzhai.com/8c5c7146ebeae385a78a0d2ff4f41d50.png)\n\n点了好几遍，使用没反应，最后无奈，只能使用PayPal（坑！！）\n\n![8](http://oldblog.shicishuzhai.com/5044a701d5863fb3df75cde054e40bf1.png)\n\n然后登陆PayPal，确认订单，支付就可了。支付完成后，返回搬运工，可以看到一个订单号，这就说明订单已经完成了。\n\n![9](http://oldblog.shicishuzhai.com/b1919f5edb17005e107f2cda76ea6543.png)\n\n## 第二步：如何使用搬运工\n\n* 查看主机\n\n![10](http://oldblog.shicishuzhai.com/0d844d6592095394205b3ec705c27c07.png)\n\n![11](http://oldblog.shicishuzhai.com/519dd5c39986045804589fb1c2037bc1.png)\n\n![12](http://oldblog.shicishuzhai.com/32ba5f9b92493a7fae77e566ffeb1899.png)\n\n* 管理我的VPS，点击KiwiVM..进入管理界面，这里可以查看服务器的状态，以及进行各种管理操作，具体操作方法可以参考最后我的两篇博客链接。\n\n![13](http://oldblog.shicishuzhai.com/765e9238bfc53b4d7efcf7eddadc1713.png)\n\n## 第三步：一键安装shadowsocks（搬运工这个功能太赞啦）\n\n进入管理界面，然后点击Shadowsocks Server，然后点击Install Sh...\n\n![14](http://oldblog.shicishuzhai.com/6c277b288f658f0f46b49692ad44cd07.png)\n\n安装完成后，点击返回，就可以看到你的SS的端口和密码\n\n![15](http://oldblog.shicishuzhai.com/cf4d5ded8facbea9375c69e1736db8b7.png)\n\n然后跟着上图的“What‘s Next”后面的内容，安装并配置Shadowsocks，就可以使用了。\n\n以上就是这个购买和使用VPS的流程，希望对大家有所帮助。\n\nReference:\n[https://blog.phpgao.com/vps.html](https://blog.phpgao.com/vps.html)\n[http://www.jianshu.com/p/2f51144c35c9](http://www.jianshu.com/p/2f51144c35c9)\n","slug":"打造自己的翻墙VPS:搬运工VPS购买使用流程全记录","published":1,"date":"2016-06-10T16:00:00.000Z","updated":"2019-01-13T04:01:04.455Z","comments":1,"photos":[],"link":"","_id":"cjutyfmfb0019c4c9574r5lst","content":"<p>端午节在家无聊，买了一个VPS，打算做翻墙用，下面是我购买和使用的一个流程全集了，主要以截图为主，文字为辅。</p>\n<p>我选的VPS是<a href=\"https://bandwagonhost.com/index.php\" target=\"_blank\" rel=\"noopener\">搬运工</a>，因为网上教程比较多，而且支持支付宝支付（实际证明支付宝支付就是个坑）。</p>\n<h2 id=\"第一步：购买搬运工VPS\"><a href=\"#第一步：购买搬运工VPS\" class=\"headerlink\" title=\"第一步：购买搬运工VPS\"></a>第一步：购买搬运工VPS</h2><p>打开<a href=\"https://bandwagonhost.com/index.php\" target=\"_blank\" rel=\"noopener\">搬运工</a>官网，点击Home</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/bed44e502ad30c6337a757df1096eb42.png\" alt=\"1\"></p>\n<p>选择一个套餐，点击OrderNow，出现了一个错误界面，没关系，继续点击Please Check…</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/6521ec84ff41c1c28efcbaf55195b41b.png\" alt=\"2\"></p>\n<p>往下拉，选择一个套餐，显示out of stock是已经售罄的，选择一个没有售罄的，点击Order Now（便宜的都卖完了😭😭）</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/4d0c8ffde0ee4fabd1619a2f76cd142d.png\" alt=\"3\"></p>\n<p>我选的是4.99$每月的套餐，然后选择计费周期和机房地址，计费周期有每月，每季度，每半年，每年，机房地址如果开通后觉得速度慢可以换的，选择完成后，点击Add to Cart</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/df89863eb89691d23f8ede6df91474ac.png\" alt=\"4\"></p>\n<p>填写优惠码（如果有的话），然后点击CheckOut提交订单</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/22185a6765ad03c3c490039547b1a6f9.png\" alt=\"5\"></p>\n<p>填写支付信息，可以选择支付宝支付，然后点击Complete Order完成订单</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/c52d6ec41f2fe7306d95fe02c150ff3c.png\" alt=\"6\"></p>\n<p>然后，点击PayNow</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/8c5c7146ebeae385a78a0d2ff4f41d50.png\" alt=\"7\"></p>\n<p>点了好几遍，使用没反应，最后无奈，只能使用PayPal（坑！！）</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/5044a701d5863fb3df75cde054e40bf1.png\" alt=\"8\"></p>\n<p>然后登陆PayPal，确认订单，支付就可了。支付完成后，返回搬运工，可以看到一个订单号，这就说明订单已经完成了。</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/b1919f5edb17005e107f2cda76ea6543.png\" alt=\"9\"></p>\n<h2 id=\"第二步：如何使用搬运工\"><a href=\"#第二步：如何使用搬运工\" class=\"headerlink\" title=\"第二步：如何使用搬运工\"></a>第二步：如何使用搬运工</h2><ul>\n<li>查看主机</li>\n</ul>\n<p><img src=\"http://oldblog.shicishuzhai.com/0d844d6592095394205b3ec705c27c07.png\" alt=\"10\"></p>\n<p><img src=\"http://oldblog.shicishuzhai.com/519dd5c39986045804589fb1c2037bc1.png\" alt=\"11\"></p>\n<p><img src=\"http://oldblog.shicishuzhai.com/32ba5f9b92493a7fae77e566ffeb1899.png\" alt=\"12\"></p>\n<ul>\n<li>管理我的VPS，点击KiwiVM..进入管理界面，这里可以查看服务器的状态，以及进行各种管理操作，具体操作方法可以参考最后我的两篇博客链接。</li>\n</ul>\n<p><img src=\"http://oldblog.shicishuzhai.com/765e9238bfc53b4d7efcf7eddadc1713.png\" alt=\"13\"></p>\n<h2 id=\"第三步：一键安装shadowsocks（搬运工这个功能太赞啦）\"><a href=\"#第三步：一键安装shadowsocks（搬运工这个功能太赞啦）\" class=\"headerlink\" title=\"第三步：一键安装shadowsocks（搬运工这个功能太赞啦）\"></a>第三步：一键安装shadowsocks（搬运工这个功能太赞啦）</h2><p>进入管理界面，然后点击Shadowsocks Server，然后点击Install Sh…</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/6c277b288f658f0f46b49692ad44cd07.png\" alt=\"14\"></p>\n<p>安装完成后，点击返回，就可以看到你的SS的端口和密码</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/cf4d5ded8facbea9375c69e1736db8b7.png\" alt=\"15\"></p>\n<p>然后跟着上图的“What‘s Next”后面的内容，安装并配置Shadowsocks，就可以使用了。</p>\n<p>以上就是这个购买和使用VPS的流程，希望对大家有所帮助。</p>\n<p>Reference:<br><a href=\"https://blog.phpgao.com/vps.html\" target=\"_blank\" rel=\"noopener\">https://blog.phpgao.com/vps.html</a><br><a href=\"http://www.jianshu.com/p/2f51144c35c9\" target=\"_blank\" rel=\"noopener\">http://www.jianshu.com/p/2f51144c35c9</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>端午节在家无聊，买了一个VPS，打算做翻墙用，下面是我购买和使用的一个流程全集了，主要以截图为主，文字为辅。</p>\n<p>我选的VPS是<a href=\"https://bandwagonhost.com/index.php\" target=\"_blank\" rel=\"noopener\">搬运工</a>，因为网上教程比较多，而且支持支付宝支付（实际证明支付宝支付就是个坑）。</p>\n<h2 id=\"第一步：购买搬运工VPS\"><a href=\"#第一步：购买搬运工VPS\" class=\"headerlink\" title=\"第一步：购买搬运工VPS\"></a>第一步：购买搬运工VPS</h2><p>打开<a href=\"https://bandwagonhost.com/index.php\" target=\"_blank\" rel=\"noopener\">搬运工</a>官网，点击Home</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/bed44e502ad30c6337a757df1096eb42.png\" alt=\"1\"></p>\n<p>选择一个套餐，点击OrderNow，出现了一个错误界面，没关系，继续点击Please Check…</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/6521ec84ff41c1c28efcbaf55195b41b.png\" alt=\"2\"></p>\n<p>往下拉，选择一个套餐，显示out of stock是已经售罄的，选择一个没有售罄的，点击Order Now（便宜的都卖完了😭😭）</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/4d0c8ffde0ee4fabd1619a2f76cd142d.png\" alt=\"3\"></p>\n<p>我选的是4.99$每月的套餐，然后选择计费周期和机房地址，计费周期有每月，每季度，每半年，每年，机房地址如果开通后觉得速度慢可以换的，选择完成后，点击Add to Cart</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/df89863eb89691d23f8ede6df91474ac.png\" alt=\"4\"></p>\n<p>填写优惠码（如果有的话），然后点击CheckOut提交订单</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/22185a6765ad03c3c490039547b1a6f9.png\" alt=\"5\"></p>\n<p>填写支付信息，可以选择支付宝支付，然后点击Complete Order完成订单</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/c52d6ec41f2fe7306d95fe02c150ff3c.png\" alt=\"6\"></p>\n<p>然后，点击PayNow</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/8c5c7146ebeae385a78a0d2ff4f41d50.png\" alt=\"7\"></p>\n<p>点了好几遍，使用没反应，最后无奈，只能使用PayPal（坑！！）</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/5044a701d5863fb3df75cde054e40bf1.png\" alt=\"8\"></p>\n<p>然后登陆PayPal，确认订单，支付就可了。支付完成后，返回搬运工，可以看到一个订单号，这就说明订单已经完成了。</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/b1919f5edb17005e107f2cda76ea6543.png\" alt=\"9\"></p>\n<h2 id=\"第二步：如何使用搬运工\"><a href=\"#第二步：如何使用搬运工\" class=\"headerlink\" title=\"第二步：如何使用搬运工\"></a>第二步：如何使用搬运工</h2><ul>\n<li>查看主机</li>\n</ul>\n<p><img src=\"http://oldblog.shicishuzhai.com/0d844d6592095394205b3ec705c27c07.png\" alt=\"10\"></p>\n<p><img src=\"http://oldblog.shicishuzhai.com/519dd5c39986045804589fb1c2037bc1.png\" alt=\"11\"></p>\n<p><img src=\"http://oldblog.shicishuzhai.com/32ba5f9b92493a7fae77e566ffeb1899.png\" alt=\"12\"></p>\n<ul>\n<li>管理我的VPS，点击KiwiVM..进入管理界面，这里可以查看服务器的状态，以及进行各种管理操作，具体操作方法可以参考最后我的两篇博客链接。</li>\n</ul>\n<p><img src=\"http://oldblog.shicishuzhai.com/765e9238bfc53b4d7efcf7eddadc1713.png\" alt=\"13\"></p>\n<h2 id=\"第三步：一键安装shadowsocks（搬运工这个功能太赞啦）\"><a href=\"#第三步：一键安装shadowsocks（搬运工这个功能太赞啦）\" class=\"headerlink\" title=\"第三步：一键安装shadowsocks（搬运工这个功能太赞啦）\"></a>第三步：一键安装shadowsocks（搬运工这个功能太赞啦）</h2><p>进入管理界面，然后点击Shadowsocks Server，然后点击Install Sh…</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/6c277b288f658f0f46b49692ad44cd07.png\" alt=\"14\"></p>\n<p>安装完成后，点击返回，就可以看到你的SS的端口和密码</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/cf4d5ded8facbea9375c69e1736db8b7.png\" alt=\"15\"></p>\n<p>然后跟着上图的“What‘s Next”后面的内容，安装并配置Shadowsocks，就可以使用了。</p>\n<p>以上就是这个购买和使用VPS的流程，希望对大家有所帮助。</p>\n<p>Reference:<br><a href=\"https://blog.phpgao.com/vps.html\" target=\"_blank\" rel=\"noopener\">https://blog.phpgao.com/vps.html</a><br><a href=\"http://www.jianshu.com/p/2f51144c35c9\" target=\"_blank\" rel=\"noopener\">http://www.jianshu.com/p/2f51144c35c9</a></p>\n"},{"layout":"post","title":"自定义NSOperation的那些事","_content":"\n最近在项目中负责一个下载模块，使用的是NSOperation+NSOperationQueue实现的，以前总以为自己对NSOperation已经很熟悉了，也写过很多Demo，但是到真正使用的时候，才发现里面还有很多细节的东西自己没有注意到，这篇博客算是对NSOperation的用法的一个总结。比较简单的NSBlockOperation以及NSInvocationOperation就不介绍，本文主要讲解一下自定义NSOperation的方法以及注意事项。\n\n很多技术Blog在介绍自定NSOperation时，思路都是大同小异，大致可以分为一下几步：\n\n1. 创建一个集成自NSOperation的类\n2. 重写NSOperation的main()方法，在main()方法中实现耗时操作\n3. 然后使用时创建自定义的NNSOperation对象，把它添加到NSOperationQueue中，这样就可以自动执行了\n\n其实，这只是自定义NSOperation的一种方法，而且是比较简单的一种方法，不需要自己去控制NSOperation的完成，取消等。另外一种方式是重写NSOperation的start方法，这种方法就需要你自己去控制NSOperation的完成，取消，执行等，而且有许多需要注意的地方。下面着重介绍一些第二种方法。\n\n废话不多说，直接上代码：\n\n```objectivec\n\n#import \"CustomOperation.h\"\n\n@implementation CustomOperation\n\n- (void)start {\n    [NSThread sleepForTimeInterval:3.0];\n    static NSInteger i = 0;\n    NSLog(@\"这是一个耗时操作：%@\", @(++i));\n}\n\n@end\n\nint main(int argc, const char * argv[]) {\n    @autoreleasepool {\n\n        NSOperationQueue *queue = [[NSOperationQueue alloc] init];\n        queue.maxConcurrentOperationCount = 1;\n\n        CustomOperation *op1 = [[CustomOperation alloc] init];\n        CustomOperation *op2 = [[CustomOperation alloc] init];\n        CustomOperation *op3 = [[CustomOperation alloc] init];\n\n        [queue addOperation:op1];\n        [queue addOperation:op2];\n        [queue addOperation:op3];\n\n        [[NSRunLoop mainRunLoop] run];\n    }\n    return 0;\n}\n```\n\n上述代码创建了一个NSOperation的子类CustomOperation，然后重写了start方法，在start方法中模拟了一个耗时操作，然后在main方法中创建一个NSOperationQueue并添加三个CustomOperation，执行结果是只有op1被执行，op2和op3一直没有被执行。这是因为，一个NSOperationQueue在判断一个Operation是否执行完成的标志是Operation的`- (BOOL)isFinished`方法返回YES，所以这里需要有一个变量来记录当前Operation执行的状态，修改代码，如下：\n\n```objectivec\n#import \"CustomOperation.h\"\n\ntypedef NS_ENUM(NSUInteger, OperationState) {\n    OperationStateReady,\n    OperationStateExecuting,\n    OperationStateFinished,\n};\n\n@interface CustomOperation ()\n\n@property (nonatomic, assign) OperationState state;\n\n@end\n\n@implementation CustomOperation\n\n- (instancetype)init {\n    if (self = [super init]) {\n        _state = OperationStateReady;\n    }\n    return self;\n}\n\n- (BOOL)isFinished {\n    return self.state == OperationStateFinished;\n}\n\n- (void)start {\n    self.state = OperationStateExecuting;\n    [NSThread sleepForTimeInterval:3.0];\n    static NSInteger i = 0;\n    NSLog(@\"这是一个耗时操作：%@\", @(++i));\n    self.state = OperationStateFinished;\n}\n\n@end\n```\n\n这里先定义个一个表示Operation状态的枚举，共有三种状态：\n\n1. OperationStateReady：准备状态，创建Operation后默认就是准备状态\n2. OperationStateExecuting：执行状态，Operation在执行过程中的状态\n3. OperationStateFinished：完成状态，Operation执行完成后的状态\n\n然后在main方法中先将状态置为执行状态，然后在耗时操作执行完后，将状态置为完成状态。有了状态之后，重写NSOperation的`- (BOOL)isFinished`方法，当状态为OperationStateFinished时返回YES，否则返回NO。这样，NSOperationQueue就可以知道操作已经执行完成。运行代码，现在三个Operation就可以按顺序执行了。\n\n继续完善代码\n\n```objectivec\n@implementation CustomOperation\n\n- (instancetype)init {\n    if (self = [super init]) {\n        _state = OperationStateReady;\n    }\n    return self;\n}\n\n- (BOOL)isFinished {\n    return self.state == OperationStateFinished;\n}\n\n- (BOOL)isExecuting {\n    return self.state == OperationStateExecuting;\n}\n\n- (BOOL)isReady {\n    return self.state == OperationStateReady && [super isReady];\n}\n\n- (void)cancel {\n    if (![self isExecuting] && ![self isFinished]) {\n        [super cancel];\n    }\n}\n\n- (void)start {\n\n    if (![self isReady]) {\n        return;\n    }\n\n    if ([self isCancelled]) {\n        return;\n    }\n\n    self.state = OperationStateExecuting;\n    [NSThread sleepForTimeInterval:3.0];\n    static NSInteger i = 0;\n    NSLog(@\"这是一个耗时操作：%@\", @(++i));\n    self.state = OperationStateFinished;\n}\n\n@end\n```\n\n这样，一个重写start方法的自定义NSOperation就完成了，这是CustomOperation支持Cancel操作，测试代码如下：\n\n```objectivec\nint main(int argc, const char * argv[]) {\n    @autoreleasepool {\n\n        NSOperationQueue *queue = [[NSOperationQueue alloc] init];\n        queue.maxConcurrentOperationCount = 1;\n\n        CustomOperation *op1 = [[CustomOperation alloc] init];\n        CustomOperation *op2 = [[CustomOperation alloc] init];\n        CustomOperation *op3 = [[CustomOperation alloc] init];\n\n        [queue addOperation:op1];\n        [queue addOperation:op2];\n        [queue addOperation:op3];\n\n        dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(2.0 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{\n            [op3 cancel];\n        });\n\n        [[NSRunLoop mainRunLoop] run];\n    }\n    return 0;\n}\n```\n\n运行代码，会发现只执行了op1和op2，达到了我们预期的效果。\n\n这就是一个完整的自定义NSOperation的方法，这里的关键点就是那几个状态。\n\n比较一下重写start函数的方法和重写main函数的方法，重写main函数实现起来更加简单，不需要自己控制Operation的状态，但是重写start函数更加灵活，可以根据自己的需求定制不同的状态。更加完善的实现可以参看[AFNetworking](https://github.com/AFNetworking/AFNetworking)的AFURLConnectionOperation实现，里面有很多值得学习的东西。\n\n参考资料：\n[NSOperation](http://nshipster.com/nsoperation/)\n","source":"_posts/2016-05-29-自定义NSOperation的那些事.md","raw":"---\nlayout: post\ntitle: \"自定义NSOperation的那些事\"\ncategories: \"iOS开发\"\n---\n\n最近在项目中负责一个下载模块，使用的是NSOperation+NSOperationQueue实现的，以前总以为自己对NSOperation已经很熟悉了，也写过很多Demo，但是到真正使用的时候，才发现里面还有很多细节的东西自己没有注意到，这篇博客算是对NSOperation的用法的一个总结。比较简单的NSBlockOperation以及NSInvocationOperation就不介绍，本文主要讲解一下自定义NSOperation的方法以及注意事项。\n\n很多技术Blog在介绍自定NSOperation时，思路都是大同小异，大致可以分为一下几步：\n\n1. 创建一个集成自NSOperation的类\n2. 重写NSOperation的main()方法，在main()方法中实现耗时操作\n3. 然后使用时创建自定义的NNSOperation对象，把它添加到NSOperationQueue中，这样就可以自动执行了\n\n其实，这只是自定义NSOperation的一种方法，而且是比较简单的一种方法，不需要自己去控制NSOperation的完成，取消等。另外一种方式是重写NSOperation的start方法，这种方法就需要你自己去控制NSOperation的完成，取消，执行等，而且有许多需要注意的地方。下面着重介绍一些第二种方法。\n\n废话不多说，直接上代码：\n\n```objectivec\n\n#import \"CustomOperation.h\"\n\n@implementation CustomOperation\n\n- (void)start {\n    [NSThread sleepForTimeInterval:3.0];\n    static NSInteger i = 0;\n    NSLog(@\"这是一个耗时操作：%@\", @(++i));\n}\n\n@end\n\nint main(int argc, const char * argv[]) {\n    @autoreleasepool {\n\n        NSOperationQueue *queue = [[NSOperationQueue alloc] init];\n        queue.maxConcurrentOperationCount = 1;\n\n        CustomOperation *op1 = [[CustomOperation alloc] init];\n        CustomOperation *op2 = [[CustomOperation alloc] init];\n        CustomOperation *op3 = [[CustomOperation alloc] init];\n\n        [queue addOperation:op1];\n        [queue addOperation:op2];\n        [queue addOperation:op3];\n\n        [[NSRunLoop mainRunLoop] run];\n    }\n    return 0;\n}\n```\n\n上述代码创建了一个NSOperation的子类CustomOperation，然后重写了start方法，在start方法中模拟了一个耗时操作，然后在main方法中创建一个NSOperationQueue并添加三个CustomOperation，执行结果是只有op1被执行，op2和op3一直没有被执行。这是因为，一个NSOperationQueue在判断一个Operation是否执行完成的标志是Operation的`- (BOOL)isFinished`方法返回YES，所以这里需要有一个变量来记录当前Operation执行的状态，修改代码，如下：\n\n```objectivec\n#import \"CustomOperation.h\"\n\ntypedef NS_ENUM(NSUInteger, OperationState) {\n    OperationStateReady,\n    OperationStateExecuting,\n    OperationStateFinished,\n};\n\n@interface CustomOperation ()\n\n@property (nonatomic, assign) OperationState state;\n\n@end\n\n@implementation CustomOperation\n\n- (instancetype)init {\n    if (self = [super init]) {\n        _state = OperationStateReady;\n    }\n    return self;\n}\n\n- (BOOL)isFinished {\n    return self.state == OperationStateFinished;\n}\n\n- (void)start {\n    self.state = OperationStateExecuting;\n    [NSThread sleepForTimeInterval:3.0];\n    static NSInteger i = 0;\n    NSLog(@\"这是一个耗时操作：%@\", @(++i));\n    self.state = OperationStateFinished;\n}\n\n@end\n```\n\n这里先定义个一个表示Operation状态的枚举，共有三种状态：\n\n1. OperationStateReady：准备状态，创建Operation后默认就是准备状态\n2. OperationStateExecuting：执行状态，Operation在执行过程中的状态\n3. OperationStateFinished：完成状态，Operation执行完成后的状态\n\n然后在main方法中先将状态置为执行状态，然后在耗时操作执行完后，将状态置为完成状态。有了状态之后，重写NSOperation的`- (BOOL)isFinished`方法，当状态为OperationStateFinished时返回YES，否则返回NO。这样，NSOperationQueue就可以知道操作已经执行完成。运行代码，现在三个Operation就可以按顺序执行了。\n\n继续完善代码\n\n```objectivec\n@implementation CustomOperation\n\n- (instancetype)init {\n    if (self = [super init]) {\n        _state = OperationStateReady;\n    }\n    return self;\n}\n\n- (BOOL)isFinished {\n    return self.state == OperationStateFinished;\n}\n\n- (BOOL)isExecuting {\n    return self.state == OperationStateExecuting;\n}\n\n- (BOOL)isReady {\n    return self.state == OperationStateReady && [super isReady];\n}\n\n- (void)cancel {\n    if (![self isExecuting] && ![self isFinished]) {\n        [super cancel];\n    }\n}\n\n- (void)start {\n\n    if (![self isReady]) {\n        return;\n    }\n\n    if ([self isCancelled]) {\n        return;\n    }\n\n    self.state = OperationStateExecuting;\n    [NSThread sleepForTimeInterval:3.0];\n    static NSInteger i = 0;\n    NSLog(@\"这是一个耗时操作：%@\", @(++i));\n    self.state = OperationStateFinished;\n}\n\n@end\n```\n\n这样，一个重写start方法的自定义NSOperation就完成了，这是CustomOperation支持Cancel操作，测试代码如下：\n\n```objectivec\nint main(int argc, const char * argv[]) {\n    @autoreleasepool {\n\n        NSOperationQueue *queue = [[NSOperationQueue alloc] init];\n        queue.maxConcurrentOperationCount = 1;\n\n        CustomOperation *op1 = [[CustomOperation alloc] init];\n        CustomOperation *op2 = [[CustomOperation alloc] init];\n        CustomOperation *op3 = [[CustomOperation alloc] init];\n\n        [queue addOperation:op1];\n        [queue addOperation:op2];\n        [queue addOperation:op3];\n\n        dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(2.0 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{\n            [op3 cancel];\n        });\n\n        [[NSRunLoop mainRunLoop] run];\n    }\n    return 0;\n}\n```\n\n运行代码，会发现只执行了op1和op2，达到了我们预期的效果。\n\n这就是一个完整的自定义NSOperation的方法，这里的关键点就是那几个状态。\n\n比较一下重写start函数的方法和重写main函数的方法，重写main函数实现起来更加简单，不需要自己控制Operation的状态，但是重写start函数更加灵活，可以根据自己的需求定制不同的状态。更加完善的实现可以参看[AFNetworking](https://github.com/AFNetworking/AFNetworking)的AFURLConnectionOperation实现，里面有很多值得学习的东西。\n\n参考资料：\n[NSOperation](http://nshipster.com/nsoperation/)\n","slug":"自定义NSOperation的那些事","published":1,"date":"2016-05-28T16:00:00.000Z","updated":"2017-03-01T06:42:53.000Z","comments":1,"photos":[],"link":"","_id":"cjutyfmfc001bc4c9zw40q5tg","content":"<p>最近在项目中负责一个下载模块，使用的是NSOperation+NSOperationQueue实现的，以前总以为自己对NSOperation已经很熟悉了，也写过很多Demo，但是到真正使用的时候，才发现里面还有很多细节的东西自己没有注意到，这篇博客算是对NSOperation的用法的一个总结。比较简单的NSBlockOperation以及NSInvocationOperation就不介绍，本文主要讲解一下自定义NSOperation的方法以及注意事项。</p>\n<p>很多技术Blog在介绍自定NSOperation时，思路都是大同小异，大致可以分为一下几步：</p>\n<ol>\n<li>创建一个集成自NSOperation的类</li>\n<li>重写NSOperation的main()方法，在main()方法中实现耗时操作</li>\n<li>然后使用时创建自定义的NNSOperation对象，把它添加到NSOperationQueue中，这样就可以自动执行了</li>\n</ol>\n<p>其实，这只是自定义NSOperation的一种方法，而且是比较简单的一种方法，不需要自己去控制NSOperation的完成，取消等。另外一种方式是重写NSOperation的start方法，这种方法就需要你自己去控制NSOperation的完成，取消，执行等，而且有许多需要注意的地方。下面着重介绍一些第二种方法。</p>\n<p>废话不多说，直接上代码：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">\"CustomOperation.h\"</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">CustomOperation</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)start &#123;</span><br><span class=\"line\">    [<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">3.0</span>];</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"built_in\">NSInteger</span> i = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"这是一个耗时操作：%@\"</span>, @(++i));</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">int</span> main(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">const</span> <span class=\"keyword\">char</span> * argv[]) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">@autoreleasepool</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">NSOperationQueue</span> *queue = [[<span class=\"built_in\">NSOperationQueue</span> alloc] init];</span><br><span class=\"line\">        queue.maxConcurrentOperationCount = <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        CustomOperation *op1 = [[CustomOperation alloc] init];</span><br><span class=\"line\">        CustomOperation *op2 = [[CustomOperation alloc] init];</span><br><span class=\"line\">        CustomOperation *op3 = [[CustomOperation alloc] init];</span><br><span class=\"line\"></span><br><span class=\"line\">        [queue addOperation:op1];</span><br><span class=\"line\">        [queue addOperation:op2];</span><br><span class=\"line\">        [queue addOperation:op3];</span><br><span class=\"line\"></span><br><span class=\"line\">        [[<span class=\"built_in\">NSRunLoop</span> mainRunLoop] run];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>上述代码创建了一个NSOperation的子类CustomOperation，然后重写了start方法，在start方法中模拟了一个耗时操作，然后在main方法中创建一个NSOperationQueue并添加三个CustomOperation，执行结果是只有op1被执行，op2和op3一直没有被执行。这是因为，一个NSOperationQueue在判断一个Operation是否执行完成的标志是Operation的<code>- (BOOL)isFinished</code>方法返回YES，所以这里需要有一个变量来记录当前Operation执行的状态，修改代码，如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">\"CustomOperation.h\"</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"built_in\">NS_ENUM</span>(<span class=\"built_in\">NSUInteger</span>, OperationState) &#123;</span><br><span class=\"line\">    OperationStateReady,</span><br><span class=\"line\">    OperationStateExecuting,</span><br><span class=\"line\">    OperationStateFinished,</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">CustomOperation</span> ()</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@property</span> (<span class=\"keyword\">nonatomic</span>, <span class=\"keyword\">assign</span>) OperationState state;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">CustomOperation</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">instancetype</span>)init &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">self</span> = [<span class=\"keyword\">super</span> init]) &#123;</span><br><span class=\"line\">        _state = OperationStateReady;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">self</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"built_in\">BOOL</span>)isFinished &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">self</span>.state == OperationStateFinished;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)start &#123;</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.state = OperationStateExecuting;</span><br><span class=\"line\">    [<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">3.0</span>];</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"built_in\">NSInteger</span> i = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"这是一个耗时操作：%@\"</span>, @(++i));</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.state = OperationStateFinished;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure>\n<p>这里先定义个一个表示Operation状态的枚举，共有三种状态：</p>\n<ol>\n<li>OperationStateReady：准备状态，创建Operation后默认就是准备状态</li>\n<li>OperationStateExecuting：执行状态，Operation在执行过程中的状态</li>\n<li>OperationStateFinished：完成状态，Operation执行完成后的状态</li>\n</ol>\n<p>然后在main方法中先将状态置为执行状态，然后在耗时操作执行完后，将状态置为完成状态。有了状态之后，重写NSOperation的<code>- (BOOL)isFinished</code>方法，当状态为OperationStateFinished时返回YES，否则返回NO。这样，NSOperationQueue就可以知道操作已经执行完成。运行代码，现在三个Operation就可以按顺序执行了。</p>\n<p>继续完善代码</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">CustomOperation</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">instancetype</span>)init &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">self</span> = [<span class=\"keyword\">super</span> init]) &#123;</span><br><span class=\"line\">        _state = OperationStateReady;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">self</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"built_in\">BOOL</span>)isFinished &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">self</span>.state == OperationStateFinished;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"built_in\">BOOL</span>)isExecuting &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">self</span>.state == OperationStateExecuting;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"built_in\">BOOL</span>)isReady &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">self</span>.state == OperationStateReady &amp;&amp; [<span class=\"keyword\">super</span> isReady];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)cancel &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (![<span class=\"keyword\">self</span> isExecuting] &amp;&amp; ![<span class=\"keyword\">self</span> isFinished]) &#123;</span><br><span class=\"line\">        [<span class=\"keyword\">super</span> cancel];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)start &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (![<span class=\"keyword\">self</span> isReady]) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ([<span class=\"keyword\">self</span> isCancelled]) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">self</span>.state = OperationStateExecuting;</span><br><span class=\"line\">    [<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">3.0</span>];</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"built_in\">NSInteger</span> i = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"这是一个耗时操作：%@\"</span>, @(++i));</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.state = OperationStateFinished;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure>\n<p>这样，一个重写start方法的自定义NSOperation就完成了，这是CustomOperation支持Cancel操作，测试代码如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">int</span> main(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">const</span> <span class=\"keyword\">char</span> * argv[]) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">@autoreleasepool</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">NSOperationQueue</span> *queue = [[<span class=\"built_in\">NSOperationQueue</span> alloc] init];</span><br><span class=\"line\">        queue.maxConcurrentOperationCount = <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        CustomOperation *op1 = [[CustomOperation alloc] init];</span><br><span class=\"line\">        CustomOperation *op2 = [[CustomOperation alloc] init];</span><br><span class=\"line\">        CustomOperation *op3 = [[CustomOperation alloc] init];</span><br><span class=\"line\"></span><br><span class=\"line\">        [queue addOperation:op1];</span><br><span class=\"line\">        [queue addOperation:op2];</span><br><span class=\"line\">        [queue addOperation:op3];</span><br><span class=\"line\"></span><br><span class=\"line\">        dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class=\"number\">2.0</span> * <span class=\"built_in\">NSEC_PER_SEC</span>)), dispatch_get_main_queue(), ^&#123;</span><br><span class=\"line\">            [op3 cancel];</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        [[<span class=\"built_in\">NSRunLoop</span> mainRunLoop] run];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>运行代码，会发现只执行了op1和op2，达到了我们预期的效果。</p>\n<p>这就是一个完整的自定义NSOperation的方法，这里的关键点就是那几个状态。</p>\n<p>比较一下重写start函数的方法和重写main函数的方法，重写main函数实现起来更加简单，不需要自己控制Operation的状态，但是重写start函数更加灵活，可以根据自己的需求定制不同的状态。更加完善的实现可以参看<a href=\"https://github.com/AFNetworking/AFNetworking\" target=\"_blank\" rel=\"noopener\">AFNetworking</a>的AFURLConnectionOperation实现，里面有很多值得学习的东西。</p>\n<p>参考资料：<br><a href=\"http://nshipster.com/nsoperation/\" target=\"_blank\" rel=\"noopener\">NSOperation</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>最近在项目中负责一个下载模块，使用的是NSOperation+NSOperationQueue实现的，以前总以为自己对NSOperation已经很熟悉了，也写过很多Demo，但是到真正使用的时候，才发现里面还有很多细节的东西自己没有注意到，这篇博客算是对NSOperation的用法的一个总结。比较简单的NSBlockOperation以及NSInvocationOperation就不介绍，本文主要讲解一下自定义NSOperation的方法以及注意事项。</p>\n<p>很多技术Blog在介绍自定NSOperation时，思路都是大同小异，大致可以分为一下几步：</p>\n<ol>\n<li>创建一个集成自NSOperation的类</li>\n<li>重写NSOperation的main()方法，在main()方法中实现耗时操作</li>\n<li>然后使用时创建自定义的NNSOperation对象，把它添加到NSOperationQueue中，这样就可以自动执行了</li>\n</ol>\n<p>其实，这只是自定义NSOperation的一种方法，而且是比较简单的一种方法，不需要自己去控制NSOperation的完成，取消等。另外一种方式是重写NSOperation的start方法，这种方法就需要你自己去控制NSOperation的完成，取消，执行等，而且有许多需要注意的地方。下面着重介绍一些第二种方法。</p>\n<p>废话不多说，直接上代码：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">\"CustomOperation.h\"</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">CustomOperation</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)start &#123;</span><br><span class=\"line\">    [<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">3.0</span>];</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"built_in\">NSInteger</span> i = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"这是一个耗时操作：%@\"</span>, @(++i));</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">int</span> main(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">const</span> <span class=\"keyword\">char</span> * argv[]) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">@autoreleasepool</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">NSOperationQueue</span> *queue = [[<span class=\"built_in\">NSOperationQueue</span> alloc] init];</span><br><span class=\"line\">        queue.maxConcurrentOperationCount = <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        CustomOperation *op1 = [[CustomOperation alloc] init];</span><br><span class=\"line\">        CustomOperation *op2 = [[CustomOperation alloc] init];</span><br><span class=\"line\">        CustomOperation *op3 = [[CustomOperation alloc] init];</span><br><span class=\"line\"></span><br><span class=\"line\">        [queue addOperation:op1];</span><br><span class=\"line\">        [queue addOperation:op2];</span><br><span class=\"line\">        [queue addOperation:op3];</span><br><span class=\"line\"></span><br><span class=\"line\">        [[<span class=\"built_in\">NSRunLoop</span> mainRunLoop] run];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>上述代码创建了一个NSOperation的子类CustomOperation，然后重写了start方法，在start方法中模拟了一个耗时操作，然后在main方法中创建一个NSOperationQueue并添加三个CustomOperation，执行结果是只有op1被执行，op2和op3一直没有被执行。这是因为，一个NSOperationQueue在判断一个Operation是否执行完成的标志是Operation的<code>- (BOOL)isFinished</code>方法返回YES，所以这里需要有一个变量来记录当前Operation执行的状态，修改代码，如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">\"CustomOperation.h\"</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"built_in\">NS_ENUM</span>(<span class=\"built_in\">NSUInteger</span>, OperationState) &#123;</span><br><span class=\"line\">    OperationStateReady,</span><br><span class=\"line\">    OperationStateExecuting,</span><br><span class=\"line\">    OperationStateFinished,</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">CustomOperation</span> ()</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@property</span> (<span class=\"keyword\">nonatomic</span>, <span class=\"keyword\">assign</span>) OperationState state;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">CustomOperation</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">instancetype</span>)init &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">self</span> = [<span class=\"keyword\">super</span> init]) &#123;</span><br><span class=\"line\">        _state = OperationStateReady;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">self</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"built_in\">BOOL</span>)isFinished &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">self</span>.state == OperationStateFinished;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)start &#123;</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.state = OperationStateExecuting;</span><br><span class=\"line\">    [<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">3.0</span>];</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"built_in\">NSInteger</span> i = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"这是一个耗时操作：%@\"</span>, @(++i));</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.state = OperationStateFinished;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure>\n<p>这里先定义个一个表示Operation状态的枚举，共有三种状态：</p>\n<ol>\n<li>OperationStateReady：准备状态，创建Operation后默认就是准备状态</li>\n<li>OperationStateExecuting：执行状态，Operation在执行过程中的状态</li>\n<li>OperationStateFinished：完成状态，Operation执行完成后的状态</li>\n</ol>\n<p>然后在main方法中先将状态置为执行状态，然后在耗时操作执行完后，将状态置为完成状态。有了状态之后，重写NSOperation的<code>- (BOOL)isFinished</code>方法，当状态为OperationStateFinished时返回YES，否则返回NO。这样，NSOperationQueue就可以知道操作已经执行完成。运行代码，现在三个Operation就可以按顺序执行了。</p>\n<p>继续完善代码</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">CustomOperation</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">instancetype</span>)init &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">self</span> = [<span class=\"keyword\">super</span> init]) &#123;</span><br><span class=\"line\">        _state = OperationStateReady;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">self</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"built_in\">BOOL</span>)isFinished &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">self</span>.state == OperationStateFinished;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"built_in\">BOOL</span>)isExecuting &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">self</span>.state == OperationStateExecuting;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"built_in\">BOOL</span>)isReady &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">self</span>.state == OperationStateReady &amp;&amp; [<span class=\"keyword\">super</span> isReady];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)cancel &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (![<span class=\"keyword\">self</span> isExecuting] &amp;&amp; ![<span class=\"keyword\">self</span> isFinished]) &#123;</span><br><span class=\"line\">        [<span class=\"keyword\">super</span> cancel];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)start &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (![<span class=\"keyword\">self</span> isReady]) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ([<span class=\"keyword\">self</span> isCancelled]) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">self</span>.state = OperationStateExecuting;</span><br><span class=\"line\">    [<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">3.0</span>];</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"built_in\">NSInteger</span> i = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"这是一个耗时操作：%@\"</span>, @(++i));</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.state = OperationStateFinished;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure>\n<p>这样，一个重写start方法的自定义NSOperation就完成了，这是CustomOperation支持Cancel操作，测试代码如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">int</span> main(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">const</span> <span class=\"keyword\">char</span> * argv[]) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">@autoreleasepool</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">NSOperationQueue</span> *queue = [[<span class=\"built_in\">NSOperationQueue</span> alloc] init];</span><br><span class=\"line\">        queue.maxConcurrentOperationCount = <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        CustomOperation *op1 = [[CustomOperation alloc] init];</span><br><span class=\"line\">        CustomOperation *op2 = [[CustomOperation alloc] init];</span><br><span class=\"line\">        CustomOperation *op3 = [[CustomOperation alloc] init];</span><br><span class=\"line\"></span><br><span class=\"line\">        [queue addOperation:op1];</span><br><span class=\"line\">        [queue addOperation:op2];</span><br><span class=\"line\">        [queue addOperation:op3];</span><br><span class=\"line\"></span><br><span class=\"line\">        dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class=\"number\">2.0</span> * <span class=\"built_in\">NSEC_PER_SEC</span>)), dispatch_get_main_queue(), ^&#123;</span><br><span class=\"line\">            [op3 cancel];</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        [[<span class=\"built_in\">NSRunLoop</span> mainRunLoop] run];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>运行代码，会发现只执行了op1和op2，达到了我们预期的效果。</p>\n<p>这就是一个完整的自定义NSOperation的方法，这里的关键点就是那几个状态。</p>\n<p>比较一下重写start函数的方法和重写main函数的方法，重写main函数实现起来更加简单，不需要自己控制Operation的状态，但是重写start函数更加灵活，可以根据自己的需求定制不同的状态。更加完善的实现可以参看<a href=\"https://github.com/AFNetworking/AFNetworking\" target=\"_blank\" rel=\"noopener\">AFNetworking</a>的AFURLConnectionOperation实现，里面有很多值得学习的东西。</p>\n<p>参考资料：<br><a href=\"http://nshipster.com/nsoperation/\" target=\"_blank\" rel=\"noopener\">NSOperation</a></p>\n"},{"title":"Could not load the xxx image referenced from a nib in the bundle with identifier xxxx问题","date":"2016-07-03T10:51:49.000Z","_content":"\n出现在非retina的屏幕上，不能正确加载xib上的图片，只能通过代码重新设置图片。还没有找到其他解决办法。\n","source":"_posts/2016-07-03-Could-not-load-the-xxx-image-referenced-from-a-nib-in-the-bundle-with-identifier-xxxx问题.md","raw":"---\ntitle: >-\n  Could not load the xxx image referenced from a nib in the bundle with\n  identifier xxxx问题\ncategories: iOS Tips\ntags:\n  - 其他\ndate: 2016-07-03 18:51:49\n---\n\n出现在非retina的屏幕上，不能正确加载xib上的图片，只能通过代码重新设置图片。还没有找到其他解决办法。\n","slug":"Could-not-load-the-xxx-image-referenced-from-a-nib-in-the-bundle-with-identifier-xxxx问题","published":1,"updated":"2017-03-01T06:42:53.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjutyfmfd001dc4c9r7gf2u0g","content":"<p>出现在非retina的屏幕上，不能正确加载xib上的图片，只能通过代码重新设置图片。还没有找到其他解决办法。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>出现在非retina的屏幕上，不能正确加载xib上的图片，只能通过代码重新设置图片。还没有找到其他解决办法。</p>\n"},{"title":"UILabel设置lineBreakMode属性无效","date":"2016-07-03T10:09:30.000Z","_content":"\nUILabel的lineBreakMode属性用于设置文字的截断方式，我在使用过程中，发现了一个问题，当我设置lineBreakMode为NSLineBreakByCharWrapping或NSLineBreakByWordWrapping时，有时会没有效果，它依然以NSLineBreakByClipping方式显示。\n\n经过一番Google，原来，要设置NSLineBreakByCharWrapping或NSLineBreakByWordWrapping，UILabel的numberOfLines必须是0，否则就会无效。\n","source":"_posts/2016-07-03-UILabel设置lineBreakMode属性无效.md","raw":"---\ntitle: \"UILabel设置lineBreakMode属性无效\"\ndate: 2016-07-03 18:09:30\ncategories: iOS Tips\ntags:\n  - UILabel\n---\n\nUILabel的lineBreakMode属性用于设置文字的截断方式，我在使用过程中，发现了一个问题，当我设置lineBreakMode为NSLineBreakByCharWrapping或NSLineBreakByWordWrapping时，有时会没有效果，它依然以NSLineBreakByClipping方式显示。\n\n经过一番Google，原来，要设置NSLineBreakByCharWrapping或NSLineBreakByWordWrapping，UILabel的numberOfLines必须是0，否则就会无效。\n","slug":"UILabel设置lineBreakMode属性无效","published":1,"updated":"2017-03-01T06:42:53.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjutyfmfe001fc4c9p5o1r2x8","content":"<p>UILabel的lineBreakMode属性用于设置文字的截断方式，我在使用过程中，发现了一个问题，当我设置lineBreakMode为NSLineBreakByCharWrapping或NSLineBreakByWordWrapping时，有时会没有效果，它依然以NSLineBreakByClipping方式显示。</p>\n<p>经过一番Google，原来，要设置NSLineBreakByCharWrapping或NSLineBreakByWordWrapping，UILabel的numberOfLines必须是0，否则就会无效。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>UILabel的lineBreakMode属性用于设置文字的截断方式，我在使用过程中，发现了一个问题，当我设置lineBreakMode为NSLineBreakByCharWrapping或NSLineBreakByWordWrapping时，有时会没有效果，它依然以NSLineBreakByClipping方式显示。</p>\n<p>经过一番Google，原来，要设置NSLineBreakByCharWrapping或NSLineBreakByWordWrapping，UILabel的numberOfLines必须是0，否则就会无效。</p>\n"},{"title":"用XCode8打开Xib后项目不能在XCode7上运行","date":"2016-07-03T10:56:06.000Z","_content":"\n可以设置xib以Xcode7.x的方法打开，参考如下\n\n[The document Main.storyboard requires Xcode 8.0 or later](http://stackoverflow.com/questions/37851459/the-document-main-storyboard-requires-xcode-8-0-or-later)\n","source":"_posts/2016-07-03-用XCode8打开Xib后项目不能在XCode7上运行.md","raw":"---\ntitle: 用XCode8打开Xib后项目不能在XCode7上运行\ncategories: iOS Tips\ntags:\n  - 其他\ndate: 2016-07-03 18:56:06\n---\n\n可以设置xib以Xcode7.x的方法打开，参考如下\n\n[The document Main.storyboard requires Xcode 8.0 or later](http://stackoverflow.com/questions/37851459/the-document-main-storyboard-requires-xcode-8-0-or-later)\n","slug":"用XCode8打开Xib后项目不能在XCode7上运行","published":1,"updated":"2017-03-01T06:42:53.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjutyfmff001ic4c9l9dwzjlp","content":"<p>可以设置xib以Xcode7.x的方法打开，参考如下</p>\n<p><a href=\"http://stackoverflow.com/questions/37851459/the-document-main-storyboard-requires-xcode-8-0-or-later\" target=\"_blank\" rel=\"noopener\">The document Main.storyboard requires Xcode 8.0 or later</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>可以设置xib以Xcode7.x的方法打开，参考如下</p>\n<p><a href=\"http://stackoverflow.com/questions/37851459/the-document-main-storyboard-requires-xcode-8-0-or-later\" target=\"_blank\" rel=\"noopener\">The document Main.storyboard requires Xcode 8.0 or later</a></p>\n"},{"title":"从jekyll迁移到hexo","date":"2016-07-01T13:24:50.000Z","_content":"\n最近公司项目不是很忙，所以想把自己的博客好好整整，下面就是我从原先的jekyll迁移的hexo的整个过程的记录以及中间遇到的一些问题。\n\n## 安装Hexo\n\n打开终端，执行命令：\n\n```shell\n$ npm install -g hexo-cli\n```\n\n然后随便找个文件夹，执行命令：\n\n```shell\n$ hexo init .\n```\n\n这个过程可能有些长，因为要安装很多依赖的包。\n\n执行完后，就会在这个文件中生成一些文件，如下图，这就是Hexo的主目录。然后执行命令\n\n```shell\n$ npm install\n```\n\n这个命令一定要执行，否则后面在启动本地服务器预览是会出现“Get 404”错误。\n\n其他还要执行的命令有：\n\n```shell\n$ npm install hexo-renderer-ejs --save\n$ npm install hexo-renderer-stylus --save\n$ npm install hexo-renderer-marked --save\n$ npm install hexo-server --save\n```\n\n这样就完成了安装，然后执行命令：\n\n```shell\nhexo server\n```\n\n然后打开浏览器，输入http://127.0.0.1:4000/  ，就可以看到预览界面\n\n![1](http://oldblog.shicishuzhai.com/5f8ddbc140ff9ec8ecbd1bb8bb119b4a.png)\n\n## 配置主题\n\n我选的是NexT主题，这个主题比较美观，而且最重要的是文档齐全，在[这里](http://theme-next.iissnan.com/)可以找到关于这个主题的所有内容。\n\n安装主题的方法很简单，在hexo主目录执行命令：\n\n```shell\ngit clone https://github.com/iissnan/hexo-theme-next themes/next\n```\n\n然后修改配置文件_config.yml，添加一下内容：\n\n```\ntheme: next\n```\n\n然后开启预览，就可以看到主题已经换成了新的主题\n\n![2](http://oldblog.shicishuzhai.com/81a90b7504bc5d934c642d1395dd63ed.png)\n\n更详细的配置可以参考这个主题的[文档](http://theme-next.iissnan.com/)。\n\n## 数据迁移\n\nHexo的数据迁移很简单，只要要以前jekyll主目录下的`_post`文件夹里的所有文件拷贝到hexo目录下的`source/_posts`,然后在配置文件_config.yml中添加如下内容：\n\n```\nnew_post_name: :year-:month-:day-:title.md\n```\n\n这样就完成了数据迁移。其他框架的博客迁移到hexo可以参看[官方文档](https://hexo.io/zh-cn/docs/migration.html)\n\n这里要注意的是，之前在jekyll中，代码块是这样的格式：\n\n```objectiveC\n{% highlight objectiveC linenos %}\nNSString * str = @\"I love coding!!\";\nNSLog(@\"%@\", str);\n{% endhighlight %}\n```\n\n但是在hexo不支持这样的格式，所以要全部替换成标准的Markdown代码块，这是比较蛋疼的地方。\n\n做完这些之后，再次打开预览，就可以看到原来的博客啦。\n\n![3](http://oldblog.shicishuzhai.com/d8627ec1356b590c21c2c6fba2cffd47.png)\n\n## 部署\n\n先安装hexo-deployer-git，执行命令：\n\n```shell\n$ npm install hexo-deployer-git --save\n```\n\n然后在Github上创建一个仓库，然后开启Github Pages功能，可以参考[这篇文章](http://jingpin.jikexueyuan.com/article/33505.html)\n\n然后修改配置文件_config.yml,添加如下内容：\n\n```\ndeploy:\n  type: git\n  repository: git@github.com:liujinlongxa/liujinlongxa.github.io.git\n  branch: master\n```\n\n然后执行命令\n\n```shell\n$ hexo deploy\n```\n\n这样就把博客部署到了github上\n\n## 绑定独立域名\n\n到万网购买了一个独立域名（后来才知道DNSPod的解析速度更快一些，后悔了），然后在hexo主目录下的source文件夹中创建一个名为CNAME的文件，里面填写你的独立域名，如下：\n\n![4](http://oldblog.shicishuzhai.com/307f1cb10cc4a3286cc1dd01b0d4f0ce.png)\n\n然后重新部署一下，这样这个CNAME就会上传到Github仓库的根目录下。如下：\n\n![5](http://oldblog.shicishuzhai.com/69301b3770b43797bda6fbd110f08f87.png)\n\n这里一定要注意，要把CNAME放在source文件夹里，如果直接从Github创建CNAME，重新部署博客后，会删掉添加的CNAME。\n\n然后就是添加域名解析，打开万网域名管理后台，添加如下解析\n\n![6](http://oldblog.shicishuzhai.com/f696d7662bef60f14f045484df43f22e.png)\n\n```\n192.30.252.153\n192.30.252.154\n```\n\n这两个IP是Github的IP，设置完后，过一会，就可以用独立域名访问了。\n\n这样一个Hexo博客就搭建完成了。\n\n## 写博客\n\nHexo自带命令可以生成生成一篇新的博客，如下：\n\n```shell\nhexo new post \"helloworld\"\n```\n\n然后就会生成一篇名为\"helloworld\"的博客。\n\n写完博客后，然后执行下面三条命令发布博客。\n\n```shell\nhexo clean\nhexo generate\nhexo deploy\n```\n\n这里可以写一个脚本，一次性执行这三条命令。\n\n## 遇到的问题\n\n*  执行hexo deploy后，CNAME和README.md文件消失\n\n解决方法，把这两个文件放在source目录下，这样在部署时就会把这两个文件也放到github的根目录下\n\n![7](http://oldblog.shicishuzhai.com/b371a047e69935cd2c92c11169483d00.png)\n\n*  执行hexo deploy后，README.md被渲染成了README.html\n\n解决方法，在_config.yml中添加如下内容即可：\n\n```\nskip_render: README.md\n```\n\n以上就是我从Jekyll迁移到Hexo的整个过程。\n\n参考资料：\n* [Hexo文档](https://hexo.io/zh-cn/docs/)\n* [NexT使用手册](http://theme-next.iissnan.com/)\n* [hexo边搭边记](http://blog.sunnyxx.com/2014/02/27/hexo_startup/)\n","source":"_posts/2016-07-01-从jekyll迁移到hexo.md","raw":"---\ntitle: \"从jekyll迁移到hexo\"\ndate: 2016-07-01 21:24:50\ncategories: \"其他\"\ntags:\n    - Hexo\n---\n\n最近公司项目不是很忙，所以想把自己的博客好好整整，下面就是我从原先的jekyll迁移的hexo的整个过程的记录以及中间遇到的一些问题。\n\n## 安装Hexo\n\n打开终端，执行命令：\n\n```shell\n$ npm install -g hexo-cli\n```\n\n然后随便找个文件夹，执行命令：\n\n```shell\n$ hexo init .\n```\n\n这个过程可能有些长，因为要安装很多依赖的包。\n\n执行完后，就会在这个文件中生成一些文件，如下图，这就是Hexo的主目录。然后执行命令\n\n```shell\n$ npm install\n```\n\n这个命令一定要执行，否则后面在启动本地服务器预览是会出现“Get 404”错误。\n\n其他还要执行的命令有：\n\n```shell\n$ npm install hexo-renderer-ejs --save\n$ npm install hexo-renderer-stylus --save\n$ npm install hexo-renderer-marked --save\n$ npm install hexo-server --save\n```\n\n这样就完成了安装，然后执行命令：\n\n```shell\nhexo server\n```\n\n然后打开浏览器，输入http://127.0.0.1:4000/  ，就可以看到预览界面\n\n![1](http://oldblog.shicishuzhai.com/5f8ddbc140ff9ec8ecbd1bb8bb119b4a.png)\n\n## 配置主题\n\n我选的是NexT主题，这个主题比较美观，而且最重要的是文档齐全，在[这里](http://theme-next.iissnan.com/)可以找到关于这个主题的所有内容。\n\n安装主题的方法很简单，在hexo主目录执行命令：\n\n```shell\ngit clone https://github.com/iissnan/hexo-theme-next themes/next\n```\n\n然后修改配置文件_config.yml，添加一下内容：\n\n```\ntheme: next\n```\n\n然后开启预览，就可以看到主题已经换成了新的主题\n\n![2](http://oldblog.shicishuzhai.com/81a90b7504bc5d934c642d1395dd63ed.png)\n\n更详细的配置可以参考这个主题的[文档](http://theme-next.iissnan.com/)。\n\n## 数据迁移\n\nHexo的数据迁移很简单，只要要以前jekyll主目录下的`_post`文件夹里的所有文件拷贝到hexo目录下的`source/_posts`,然后在配置文件_config.yml中添加如下内容：\n\n```\nnew_post_name: :year-:month-:day-:title.md\n```\n\n这样就完成了数据迁移。其他框架的博客迁移到hexo可以参看[官方文档](https://hexo.io/zh-cn/docs/migration.html)\n\n这里要注意的是，之前在jekyll中，代码块是这样的格式：\n\n```objectiveC\n{% highlight objectiveC linenos %}\nNSString * str = @\"I love coding!!\";\nNSLog(@\"%@\", str);\n{% endhighlight %}\n```\n\n但是在hexo不支持这样的格式，所以要全部替换成标准的Markdown代码块，这是比较蛋疼的地方。\n\n做完这些之后，再次打开预览，就可以看到原来的博客啦。\n\n![3](http://oldblog.shicishuzhai.com/d8627ec1356b590c21c2c6fba2cffd47.png)\n\n## 部署\n\n先安装hexo-deployer-git，执行命令：\n\n```shell\n$ npm install hexo-deployer-git --save\n```\n\n然后在Github上创建一个仓库，然后开启Github Pages功能，可以参考[这篇文章](http://jingpin.jikexueyuan.com/article/33505.html)\n\n然后修改配置文件_config.yml,添加如下内容：\n\n```\ndeploy:\n  type: git\n  repository: git@github.com:liujinlongxa/liujinlongxa.github.io.git\n  branch: master\n```\n\n然后执行命令\n\n```shell\n$ hexo deploy\n```\n\n这样就把博客部署到了github上\n\n## 绑定独立域名\n\n到万网购买了一个独立域名（后来才知道DNSPod的解析速度更快一些，后悔了），然后在hexo主目录下的source文件夹中创建一个名为CNAME的文件，里面填写你的独立域名，如下：\n\n![4](http://oldblog.shicishuzhai.com/307f1cb10cc4a3286cc1dd01b0d4f0ce.png)\n\n然后重新部署一下，这样这个CNAME就会上传到Github仓库的根目录下。如下：\n\n![5](http://oldblog.shicishuzhai.com/69301b3770b43797bda6fbd110f08f87.png)\n\n这里一定要注意，要把CNAME放在source文件夹里，如果直接从Github创建CNAME，重新部署博客后，会删掉添加的CNAME。\n\n然后就是添加域名解析，打开万网域名管理后台，添加如下解析\n\n![6](http://oldblog.shicishuzhai.com/f696d7662bef60f14f045484df43f22e.png)\n\n```\n192.30.252.153\n192.30.252.154\n```\n\n这两个IP是Github的IP，设置完后，过一会，就可以用独立域名访问了。\n\n这样一个Hexo博客就搭建完成了。\n\n## 写博客\n\nHexo自带命令可以生成生成一篇新的博客，如下：\n\n```shell\nhexo new post \"helloworld\"\n```\n\n然后就会生成一篇名为\"helloworld\"的博客。\n\n写完博客后，然后执行下面三条命令发布博客。\n\n```shell\nhexo clean\nhexo generate\nhexo deploy\n```\n\n这里可以写一个脚本，一次性执行这三条命令。\n\n## 遇到的问题\n\n*  执行hexo deploy后，CNAME和README.md文件消失\n\n解决方法，把这两个文件放在source目录下，这样在部署时就会把这两个文件也放到github的根目录下\n\n![7](http://oldblog.shicishuzhai.com/b371a047e69935cd2c92c11169483d00.png)\n\n*  执行hexo deploy后，README.md被渲染成了README.html\n\n解决方法，在_config.yml中添加如下内容即可：\n\n```\nskip_render: README.md\n```\n\n以上就是我从Jekyll迁移到Hexo的整个过程。\n\n参考资料：\n* [Hexo文档](https://hexo.io/zh-cn/docs/)\n* [NexT使用手册](http://theme-next.iissnan.com/)\n* [hexo边搭边记](http://blog.sunnyxx.com/2014/02/27/hexo_startup/)\n","slug":"从jekyll迁移到hexo","published":1,"updated":"2019-01-13T04:01:04.474Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjutyfmfg001kc4c9h1tg6387","content":"<p>最近公司项目不是很忙，所以想把自己的博客好好整整，下面就是我从原先的jekyll迁移的hexo的整个过程的记录以及中间遇到的一些问题。</p>\n<h2 id=\"安装Hexo\"><a href=\"#安装Hexo\" class=\"headerlink\" title=\"安装Hexo\"></a>安装Hexo</h2><p>打开终端，执行命令：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span> npm install -g hexo-cli</span><br></pre></td></tr></table></figure>\n<p>然后随便找个文件夹，执行命令：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span> hexo init .</span><br></pre></td></tr></table></figure>\n<p>这个过程可能有些长，因为要安装很多依赖的包。</p>\n<p>执行完后，就会在这个文件中生成一些文件，如下图，这就是Hexo的主目录。然后执行命令</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span> npm install</span><br></pre></td></tr></table></figure>\n<p>这个命令一定要执行，否则后面在启动本地服务器预览是会出现“Get 404”错误。</p>\n<p>其他还要执行的命令有：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span> npm install hexo-renderer-ejs --save</span><br><span class=\"line\"><span class=\"meta\">$</span> npm install hexo-renderer-stylus --save</span><br><span class=\"line\"><span class=\"meta\">$</span> npm install hexo-renderer-marked --save</span><br><span class=\"line\"><span class=\"meta\">$</span> npm install hexo-server --save</span><br></pre></td></tr></table></figure>\n<p>这样就完成了安装，然后执行命令：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo server</span><br></pre></td></tr></table></figure>\n<p>然后打开浏览器，输入<a href=\"http://127.0.0.1:4000/\" target=\"_blank\" rel=\"noopener\">http://127.0.0.1:4000/</a>  ，就可以看到预览界面</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/5f8ddbc140ff9ec8ecbd1bb8bb119b4a.png\" alt=\"1\"></p>\n<h2 id=\"配置主题\"><a href=\"#配置主题\" class=\"headerlink\" title=\"配置主题\"></a>配置主题</h2><p>我选的是NexT主题，这个主题比较美观，而且最重要的是文档齐全，在<a href=\"http://theme-next.iissnan.com/\" target=\"_blank\" rel=\"noopener\">这里</a>可以找到关于这个主题的所有内容。</p>\n<p>安装主题的方法很简单，在hexo主目录执行命令：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone https://github.com/iissnan/hexo-theme-next themes/next</span><br></pre></td></tr></table></figure>\n<p>然后修改配置文件_config.yml，添加一下内容：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">theme: next</span><br></pre></td></tr></table></figure>\n<p>然后开启预览，就可以看到主题已经换成了新的主题</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/81a90b7504bc5d934c642d1395dd63ed.png\" alt=\"2\"></p>\n<p>更详细的配置可以参考这个主题的<a href=\"http://theme-next.iissnan.com/\" target=\"_blank\" rel=\"noopener\">文档</a>。</p>\n<h2 id=\"数据迁移\"><a href=\"#数据迁移\" class=\"headerlink\" title=\"数据迁移\"></a>数据迁移</h2><p>Hexo的数据迁移很简单，只要要以前jekyll主目录下的<code>_post</code>文件夹里的所有文件拷贝到hexo目录下的<code>source/_posts</code>,然后在配置文件_config.yml中添加如下内容：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">new_post_name: :year-:month-:day-:title.md</span><br></pre></td></tr></table></figure>\n<p>这样就完成了数据迁移。其他框架的博客迁移到hexo可以参看<a href=\"https://hexo.io/zh-cn/docs/migration.html\" target=\"_blank\" rel=\"noopener\">官方文档</a></p>\n<p>这里要注意的是，之前在jekyll中，代码块是这样的格式：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;% highlight objectiveC linenos %&#125;</span><br><span class=\"line\"><span class=\"built_in\">NSString</span> * str = <span class=\"string\">@\"I love coding!!\"</span>;</span><br><span class=\"line\"><span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%@\"</span>, str);</span><br><span class=\"line\">&#123;% endhighlight %&#125;</span><br></pre></td></tr></table></figure>\n<p>但是在hexo不支持这样的格式，所以要全部替换成标准的Markdown代码块，这是比较蛋疼的地方。</p>\n<p>做完这些之后，再次打开预览，就可以看到原来的博客啦。</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/d8627ec1356b590c21c2c6fba2cffd47.png\" alt=\"3\"></p>\n<h2 id=\"部署\"><a href=\"#部署\" class=\"headerlink\" title=\"部署\"></a>部署</h2><p>先安装hexo-deployer-git，执行命令：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span> npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure>\n<p>然后在Github上创建一个仓库，然后开启Github Pages功能，可以参考<a href=\"http://jingpin.jikexueyuan.com/article/33505.html\" target=\"_blank\" rel=\"noopener\">这篇文章</a></p>\n<p>然后修改配置文件_config.yml,添加如下内容：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">deploy:</span><br><span class=\"line\">  type: git</span><br><span class=\"line\">  repository: git@github.com:liujinlongxa/liujinlongxa.github.io.git</span><br><span class=\"line\">  branch: master</span><br></pre></td></tr></table></figure>\n<p>然后执行命令</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span> hexo deploy</span><br></pre></td></tr></table></figure>\n<p>这样就把博客部署到了github上</p>\n<h2 id=\"绑定独立域名\"><a href=\"#绑定独立域名\" class=\"headerlink\" title=\"绑定独立域名\"></a>绑定独立域名</h2><p>到万网购买了一个独立域名（后来才知道DNSPod的解析速度更快一些，后悔了），然后在hexo主目录下的source文件夹中创建一个名为CNAME的文件，里面填写你的独立域名，如下：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/307f1cb10cc4a3286cc1dd01b0d4f0ce.png\" alt=\"4\"></p>\n<p>然后重新部署一下，这样这个CNAME就会上传到Github仓库的根目录下。如下：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/69301b3770b43797bda6fbd110f08f87.png\" alt=\"5\"></p>\n<p>这里一定要注意，要把CNAME放在source文件夹里，如果直接从Github创建CNAME，重新部署博客后，会删掉添加的CNAME。</p>\n<p>然后就是添加域名解析，打开万网域名管理后台，添加如下解析</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/f696d7662bef60f14f045484df43f22e.png\" alt=\"6\"></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">192.30.252.153</span><br><span class=\"line\">192.30.252.154</span><br></pre></td></tr></table></figure>\n<p>这两个IP是Github的IP，设置完后，过一会，就可以用独立域名访问了。</p>\n<p>这样一个Hexo博客就搭建完成了。</p>\n<h2 id=\"写博客\"><a href=\"#写博客\" class=\"headerlink\" title=\"写博客\"></a>写博客</h2><p>Hexo自带命令可以生成生成一篇新的博客，如下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo new post \"helloworld\"</span><br></pre></td></tr></table></figure>\n<p>然后就会生成一篇名为”helloworld”的博客。</p>\n<p>写完博客后，然后执行下面三条命令发布博客。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo clean</span><br><span class=\"line\">hexo generate</span><br><span class=\"line\">hexo deploy</span><br></pre></td></tr></table></figure>\n<p>这里可以写一个脚本，一次性执行这三条命令。</p>\n<h2 id=\"遇到的问题\"><a href=\"#遇到的问题\" class=\"headerlink\" title=\"遇到的问题\"></a>遇到的问题</h2><ul>\n<li>执行hexo deploy后，CNAME和README.md文件消失</li>\n</ul>\n<p>解决方法，把这两个文件放在source目录下，这样在部署时就会把这两个文件也放到github的根目录下</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/b371a047e69935cd2c92c11169483d00.png\" alt=\"7\"></p>\n<ul>\n<li>执行hexo deploy后，README.md被渲染成了README.html</li>\n</ul>\n<p>解决方法，在_config.yml中添加如下内容即可：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">skip_render: README.md</span><br></pre></td></tr></table></figure>\n<p>以上就是我从Jekyll迁移到Hexo的整个过程。</p>\n<p>参考资料：</p>\n<ul>\n<li><a href=\"https://hexo.io/zh-cn/docs/\" target=\"_blank\" rel=\"noopener\">Hexo文档</a></li>\n<li><a href=\"http://theme-next.iissnan.com/\" target=\"_blank\" rel=\"noopener\">NexT使用手册</a></li>\n<li><a href=\"http://blog.sunnyxx.com/2014/02/27/hexo_startup/\" target=\"_blank\" rel=\"noopener\">hexo边搭边记</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<p>最近公司项目不是很忙，所以想把自己的博客好好整整，下面就是我从原先的jekyll迁移的hexo的整个过程的记录以及中间遇到的一些问题。</p>\n<h2 id=\"安装Hexo\"><a href=\"#安装Hexo\" class=\"headerlink\" title=\"安装Hexo\"></a>安装Hexo</h2><p>打开终端，执行命令：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span> npm install -g hexo-cli</span><br></pre></td></tr></table></figure>\n<p>然后随便找个文件夹，执行命令：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span> hexo init .</span><br></pre></td></tr></table></figure>\n<p>这个过程可能有些长，因为要安装很多依赖的包。</p>\n<p>执行完后，就会在这个文件中生成一些文件，如下图，这就是Hexo的主目录。然后执行命令</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span> npm install</span><br></pre></td></tr></table></figure>\n<p>这个命令一定要执行，否则后面在启动本地服务器预览是会出现“Get 404”错误。</p>\n<p>其他还要执行的命令有：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span> npm install hexo-renderer-ejs --save</span><br><span class=\"line\"><span class=\"meta\">$</span> npm install hexo-renderer-stylus --save</span><br><span class=\"line\"><span class=\"meta\">$</span> npm install hexo-renderer-marked --save</span><br><span class=\"line\"><span class=\"meta\">$</span> npm install hexo-server --save</span><br></pre></td></tr></table></figure>\n<p>这样就完成了安装，然后执行命令：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo server</span><br></pre></td></tr></table></figure>\n<p>然后打开浏览器，输入<a href=\"http://127.0.0.1:4000/\" target=\"_blank\" rel=\"noopener\">http://127.0.0.1:4000/</a>  ，就可以看到预览界面</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/5f8ddbc140ff9ec8ecbd1bb8bb119b4a.png\" alt=\"1\"></p>\n<h2 id=\"配置主题\"><a href=\"#配置主题\" class=\"headerlink\" title=\"配置主题\"></a>配置主题</h2><p>我选的是NexT主题，这个主题比较美观，而且最重要的是文档齐全，在<a href=\"http://theme-next.iissnan.com/\" target=\"_blank\" rel=\"noopener\">这里</a>可以找到关于这个主题的所有内容。</p>\n<p>安装主题的方法很简单，在hexo主目录执行命令：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone https://github.com/iissnan/hexo-theme-next themes/next</span><br></pre></td></tr></table></figure>\n<p>然后修改配置文件_config.yml，添加一下内容：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">theme: next</span><br></pre></td></tr></table></figure>\n<p>然后开启预览，就可以看到主题已经换成了新的主题</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/81a90b7504bc5d934c642d1395dd63ed.png\" alt=\"2\"></p>\n<p>更详细的配置可以参考这个主题的<a href=\"http://theme-next.iissnan.com/\" target=\"_blank\" rel=\"noopener\">文档</a>。</p>\n<h2 id=\"数据迁移\"><a href=\"#数据迁移\" class=\"headerlink\" title=\"数据迁移\"></a>数据迁移</h2><p>Hexo的数据迁移很简单，只要要以前jekyll主目录下的<code>_post</code>文件夹里的所有文件拷贝到hexo目录下的<code>source/_posts</code>,然后在配置文件_config.yml中添加如下内容：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">new_post_name: :year-:month-:day-:title.md</span><br></pre></td></tr></table></figure>\n<p>这样就完成了数据迁移。其他框架的博客迁移到hexo可以参看<a href=\"https://hexo.io/zh-cn/docs/migration.html\" target=\"_blank\" rel=\"noopener\">官方文档</a></p>\n<p>这里要注意的是，之前在jekyll中，代码块是这样的格式：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;% highlight objectiveC linenos %&#125;</span><br><span class=\"line\"><span class=\"built_in\">NSString</span> * str = <span class=\"string\">@\"I love coding!!\"</span>;</span><br><span class=\"line\"><span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%@\"</span>, str);</span><br><span class=\"line\">&#123;% endhighlight %&#125;</span><br></pre></td></tr></table></figure>\n<p>但是在hexo不支持这样的格式，所以要全部替换成标准的Markdown代码块，这是比较蛋疼的地方。</p>\n<p>做完这些之后，再次打开预览，就可以看到原来的博客啦。</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/d8627ec1356b590c21c2c6fba2cffd47.png\" alt=\"3\"></p>\n<h2 id=\"部署\"><a href=\"#部署\" class=\"headerlink\" title=\"部署\"></a>部署</h2><p>先安装hexo-deployer-git，执行命令：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span> npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure>\n<p>然后在Github上创建一个仓库，然后开启Github Pages功能，可以参考<a href=\"http://jingpin.jikexueyuan.com/article/33505.html\" target=\"_blank\" rel=\"noopener\">这篇文章</a></p>\n<p>然后修改配置文件_config.yml,添加如下内容：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">deploy:</span><br><span class=\"line\">  type: git</span><br><span class=\"line\">  repository: git@github.com:liujinlongxa/liujinlongxa.github.io.git</span><br><span class=\"line\">  branch: master</span><br></pre></td></tr></table></figure>\n<p>然后执行命令</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span> hexo deploy</span><br></pre></td></tr></table></figure>\n<p>这样就把博客部署到了github上</p>\n<h2 id=\"绑定独立域名\"><a href=\"#绑定独立域名\" class=\"headerlink\" title=\"绑定独立域名\"></a>绑定独立域名</h2><p>到万网购买了一个独立域名（后来才知道DNSPod的解析速度更快一些，后悔了），然后在hexo主目录下的source文件夹中创建一个名为CNAME的文件，里面填写你的独立域名，如下：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/307f1cb10cc4a3286cc1dd01b0d4f0ce.png\" alt=\"4\"></p>\n<p>然后重新部署一下，这样这个CNAME就会上传到Github仓库的根目录下。如下：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/69301b3770b43797bda6fbd110f08f87.png\" alt=\"5\"></p>\n<p>这里一定要注意，要把CNAME放在source文件夹里，如果直接从Github创建CNAME，重新部署博客后，会删掉添加的CNAME。</p>\n<p>然后就是添加域名解析，打开万网域名管理后台，添加如下解析</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/f696d7662bef60f14f045484df43f22e.png\" alt=\"6\"></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">192.30.252.153</span><br><span class=\"line\">192.30.252.154</span><br></pre></td></tr></table></figure>\n<p>这两个IP是Github的IP，设置完后，过一会，就可以用独立域名访问了。</p>\n<p>这样一个Hexo博客就搭建完成了。</p>\n<h2 id=\"写博客\"><a href=\"#写博客\" class=\"headerlink\" title=\"写博客\"></a>写博客</h2><p>Hexo自带命令可以生成生成一篇新的博客，如下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo new post \"helloworld\"</span><br></pre></td></tr></table></figure>\n<p>然后就会生成一篇名为”helloworld”的博客。</p>\n<p>写完博客后，然后执行下面三条命令发布博客。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo clean</span><br><span class=\"line\">hexo generate</span><br><span class=\"line\">hexo deploy</span><br></pre></td></tr></table></figure>\n<p>这里可以写一个脚本，一次性执行这三条命令。</p>\n<h2 id=\"遇到的问题\"><a href=\"#遇到的问题\" class=\"headerlink\" title=\"遇到的问题\"></a>遇到的问题</h2><ul>\n<li>执行hexo deploy后，CNAME和README.md文件消失</li>\n</ul>\n<p>解决方法，把这两个文件放在source目录下，这样在部署时就会把这两个文件也放到github的根目录下</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/b371a047e69935cd2c92c11169483d00.png\" alt=\"7\"></p>\n<ul>\n<li>执行hexo deploy后，README.md被渲染成了README.html</li>\n</ul>\n<p>解决方法，在_config.yml中添加如下内容即可：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">skip_render: README.md</span><br></pre></td></tr></table></figure>\n<p>以上就是我从Jekyll迁移到Hexo的整个过程。</p>\n<p>参考资料：</p>\n<ul>\n<li><a href=\"https://hexo.io/zh-cn/docs/\" target=\"_blank\" rel=\"noopener\">Hexo文档</a></li>\n<li><a href=\"http://theme-next.iissnan.com/\" target=\"_blank\" rel=\"noopener\">NexT使用手册</a></li>\n<li><a href=\"http://blog.sunnyxx.com/2014/02/27/hexo_startup/\" target=\"_blank\" rel=\"noopener\">hexo边搭边记</a></li>\n</ul>\n"},{"layout":"post","title":"GMTC全球移动技术大会见闻","_content":"\n6月24日至6月25日，我有幸参加了“GMTC全球移动技术大会”，这篇博客就是我对参见会议的一个经历和感受。\n\n![1](http://oldblog.shicishuzhai.com/457acda7bd3dc65f172468c45dad4a8f.png)\n\n### 第一天上午\n\n会议共分为两天，第一天上午是主会场，首先是主办方开场致辞，然后是京东，阿里和微信的三个技术负责人的演讲，主要讲了移动开发的现状以及未来的一些趋势，没有涉及到具体的技术。\n\n接下来是Facebook的一个前员工分享了”Facebook iOS App技术演化10年”，讲到了很多有意思的地方，这里令我印象比较深刻的是Facebook一共有1000+的iOS工程师，这个iOS App的代码行数超过1000万行，同时他也分享了Facebook App演化过程中走过的一些完了，例如H5，CoreData等。\n\n接下来也是一个硅谷的iOS开发者分享了“Mobile Growth 的方法和实践”，由于之前从来没有接触过Growth，所以听的也是一知半解，感觉与产品运营更相关。这就是第一天早上的整个会议。\n\n### 第一天下午\n\n从第一天的下午开始，就开始分了几个分会场进行具体的技术分享。第一天下午有三个分会场，分别是动态化，Swift和新技术专场。\n\n我先是听了”函数式编程中的Swift与Swift中的函数式编程”，分享者是SwiftyJSON的作者，由于之前在使用RAC时已经接触过函数式编程，所以这个并不陌生，整个演讲主要是分享了函数式编程的一些思想。\n\n接下来我有听了“RN项目实战优化之路”，由于之前从来没接触过ReactNative，所有听得也是云里雾里，听到一半就跑去听”JSPatch成长之路”。\n\nJSPatch目前是当前比较热门的一种iOS热修复技术，演讲者就是JSPatch的作者，他分享了整个JSPatch发展过程中遇到的问题以及解决方案，很佩服作者为了推广JSPatch而做的各项工作，包括代码转换工具、XCode插件、JSPatch平台等等，这些工作极大地促进了JSPatch的推广使用，有机会我一定要尝试一下JSPatch。\n\n听完了JSPatch，我又去听了“当泛型遇上协议”，是猿题库的iOS负责人做的分享，之前看过他写的关于Swift的博客，演讲中，作者通过具体的代码分享自己在Swift的协议与泛型上的实践经验，如果能把泛型使用好确实能极大地简化自己的代码。\n\n最后我又听了”聚划算iOS平台动态化方案LuaView”，分享者是阿里聚划算的技术专家，LuaView提供了一种使用Lua脚本动态更新App的方案，演讲者讲解了LuaView的基本原理、使用以及对LuaView未来发展的一些规划。\n\n这样，第一天的会议就结束了。\n\n### 第二天上午\n\n第二天上午也有三个分会场，分别是架构演进、VR/AR、移动解决方案。\n\n我先听了“360°全景视频播放器的实现原理”，演讲者是阿里的高级iOS工程师，分享了如何使用OpenGL实现全景视频播放，以前从来没有接触过这一块，所以听得也是迷迷糊糊。VR/AR目前是是一个很火的方向，但还处于发展的初期，不过有机会还是值得尝试尝试。\n\n接下来我又听了一段“手机天猫解耦之路”，我是中间进去的，会场挤满了人，分享者讲的东西也是干货满满。演讲嘉宾是天猫的无线技术专家，我听的那一块正好讲到了一种界面间解耦的思路，使用URL Server来实现界面间跳转。\n\n接下来又听了滴滴的iOS负责人分享的“滴滴的组件化实践与优化”，主要讲到了滴滴iOS端在发展中遇到的问题以及解决方案，重点讲了滴滴组件化的经历，也是干货满满。后面提到的灰度发布对我们目前的项目很有参考价值。\n\n后面又听了“iOS遗留系统上的架构重构”，是一名来自澳洲的iOS工程师分享的，主要分享了自己是如何在遗留的代码上，把数据存储从CoreData迁移到Realm并且没有影响正常迭代的经历，使用的是抽象分支+特性开关，也非常有参考价值。\n\n### 第二天下午\n\n第二天下午有两个分会场，分别是性能优化专场和应用架构专场。\n\n我先听了“美团 iOS 客户端的构建思考与实践”，分享者是美团的高级工程师，主要讲了美团APP iOS客户端的架构，以及集成和发布中遇到的问题和一些实践经验。分享了一些持续集成的经验，目前我们项目中还没有用到持续集成，所有这一块也不是很了解，不过很多东西还是值得借鉴和尝试的。\n\n后面我又听了来自微博的美女架构师分享的“微博复杂信息流的架构之道”，分享中提到的隔周发版也是一种很好的实践方式。\n\n### 总结\n\n总体来说这次GMTC大会还是收获很多的，学习到了业界一些最新最热的技术和思想，非常感谢公司能给我这次机会。\n\n最后，由于第一次去北京，当然少不了要到处逛逛。\n\n![2](http://oldblog.shicishuzhai.com/9088bb3373fad1444a78921cb8c8172f.png)\n\n![3](http://oldblog.shicishuzhai.com/5a0e1b3dac94502a08f70de2f14bee22.png)\n","source":"_posts/2016-06-29-GMTC全球移动技术大会见闻.md","raw":"---\nlayout: post\ntitle: \"GMTC全球移动技术大会见闻\"\ncategories: \"其他\"\n---\n\n6月24日至6月25日，我有幸参加了“GMTC全球移动技术大会”，这篇博客就是我对参见会议的一个经历和感受。\n\n![1](http://oldblog.shicishuzhai.com/457acda7bd3dc65f172468c45dad4a8f.png)\n\n### 第一天上午\n\n会议共分为两天，第一天上午是主会场，首先是主办方开场致辞，然后是京东，阿里和微信的三个技术负责人的演讲，主要讲了移动开发的现状以及未来的一些趋势，没有涉及到具体的技术。\n\n接下来是Facebook的一个前员工分享了”Facebook iOS App技术演化10年”，讲到了很多有意思的地方，这里令我印象比较深刻的是Facebook一共有1000+的iOS工程师，这个iOS App的代码行数超过1000万行，同时他也分享了Facebook App演化过程中走过的一些完了，例如H5，CoreData等。\n\n接下来也是一个硅谷的iOS开发者分享了“Mobile Growth 的方法和实践”，由于之前从来没有接触过Growth，所以听的也是一知半解，感觉与产品运营更相关。这就是第一天早上的整个会议。\n\n### 第一天下午\n\n从第一天的下午开始，就开始分了几个分会场进行具体的技术分享。第一天下午有三个分会场，分别是动态化，Swift和新技术专场。\n\n我先是听了”函数式编程中的Swift与Swift中的函数式编程”，分享者是SwiftyJSON的作者，由于之前在使用RAC时已经接触过函数式编程，所以这个并不陌生，整个演讲主要是分享了函数式编程的一些思想。\n\n接下来我有听了“RN项目实战优化之路”，由于之前从来没接触过ReactNative，所有听得也是云里雾里，听到一半就跑去听”JSPatch成长之路”。\n\nJSPatch目前是当前比较热门的一种iOS热修复技术，演讲者就是JSPatch的作者，他分享了整个JSPatch发展过程中遇到的问题以及解决方案，很佩服作者为了推广JSPatch而做的各项工作，包括代码转换工具、XCode插件、JSPatch平台等等，这些工作极大地促进了JSPatch的推广使用，有机会我一定要尝试一下JSPatch。\n\n听完了JSPatch，我又去听了“当泛型遇上协议”，是猿题库的iOS负责人做的分享，之前看过他写的关于Swift的博客，演讲中，作者通过具体的代码分享自己在Swift的协议与泛型上的实践经验，如果能把泛型使用好确实能极大地简化自己的代码。\n\n最后我又听了”聚划算iOS平台动态化方案LuaView”，分享者是阿里聚划算的技术专家，LuaView提供了一种使用Lua脚本动态更新App的方案，演讲者讲解了LuaView的基本原理、使用以及对LuaView未来发展的一些规划。\n\n这样，第一天的会议就结束了。\n\n### 第二天上午\n\n第二天上午也有三个分会场，分别是架构演进、VR/AR、移动解决方案。\n\n我先听了“360°全景视频播放器的实现原理”，演讲者是阿里的高级iOS工程师，分享了如何使用OpenGL实现全景视频播放，以前从来没有接触过这一块，所以听得也是迷迷糊糊。VR/AR目前是是一个很火的方向，但还处于发展的初期，不过有机会还是值得尝试尝试。\n\n接下来我又听了一段“手机天猫解耦之路”，我是中间进去的，会场挤满了人，分享者讲的东西也是干货满满。演讲嘉宾是天猫的无线技术专家，我听的那一块正好讲到了一种界面间解耦的思路，使用URL Server来实现界面间跳转。\n\n接下来又听了滴滴的iOS负责人分享的“滴滴的组件化实践与优化”，主要讲到了滴滴iOS端在发展中遇到的问题以及解决方案，重点讲了滴滴组件化的经历，也是干货满满。后面提到的灰度发布对我们目前的项目很有参考价值。\n\n后面又听了“iOS遗留系统上的架构重构”，是一名来自澳洲的iOS工程师分享的，主要分享了自己是如何在遗留的代码上，把数据存储从CoreData迁移到Realm并且没有影响正常迭代的经历，使用的是抽象分支+特性开关，也非常有参考价值。\n\n### 第二天下午\n\n第二天下午有两个分会场，分别是性能优化专场和应用架构专场。\n\n我先听了“美团 iOS 客户端的构建思考与实践”，分享者是美团的高级工程师，主要讲了美团APP iOS客户端的架构，以及集成和发布中遇到的问题和一些实践经验。分享了一些持续集成的经验，目前我们项目中还没有用到持续集成，所有这一块也不是很了解，不过很多东西还是值得借鉴和尝试的。\n\n后面我又听了来自微博的美女架构师分享的“微博复杂信息流的架构之道”，分享中提到的隔周发版也是一种很好的实践方式。\n\n### 总结\n\n总体来说这次GMTC大会还是收获很多的，学习到了业界一些最新最热的技术和思想，非常感谢公司能给我这次机会。\n\n最后，由于第一次去北京，当然少不了要到处逛逛。\n\n![2](http://oldblog.shicishuzhai.com/9088bb3373fad1444a78921cb8c8172f.png)\n\n![3](http://oldblog.shicishuzhai.com/5a0e1b3dac94502a08f70de2f14bee22.png)\n","slug":"GMTC全球移动技术大会见闻","published":1,"date":"2016-06-28T16:00:00.000Z","updated":"2019-01-13T04:01:04.445Z","comments":1,"photos":[],"link":"","_id":"cjutyfmfh001mc4c9fjsj9stq","content":"<p>6月24日至6月25日，我有幸参加了“GMTC全球移动技术大会”，这篇博客就是我对参见会议的一个经历和感受。</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/457acda7bd3dc65f172468c45dad4a8f.png\" alt=\"1\"></p>\n<h3 id=\"第一天上午\"><a href=\"#第一天上午\" class=\"headerlink\" title=\"第一天上午\"></a>第一天上午</h3><p>会议共分为两天，第一天上午是主会场，首先是主办方开场致辞，然后是京东，阿里和微信的三个技术负责人的演讲，主要讲了移动开发的现状以及未来的一些趋势，没有涉及到具体的技术。</p>\n<p>接下来是Facebook的一个前员工分享了”Facebook iOS App技术演化10年”，讲到了很多有意思的地方，这里令我印象比较深刻的是Facebook一共有1000+的iOS工程师，这个iOS App的代码行数超过1000万行，同时他也分享了Facebook App演化过程中走过的一些完了，例如H5，CoreData等。</p>\n<p>接下来也是一个硅谷的iOS开发者分享了“Mobile Growth 的方法和实践”，由于之前从来没有接触过Growth，所以听的也是一知半解，感觉与产品运营更相关。这就是第一天早上的整个会议。</p>\n<h3 id=\"第一天下午\"><a href=\"#第一天下午\" class=\"headerlink\" title=\"第一天下午\"></a>第一天下午</h3><p>从第一天的下午开始，就开始分了几个分会场进行具体的技术分享。第一天下午有三个分会场，分别是动态化，Swift和新技术专场。</p>\n<p>我先是听了”函数式编程中的Swift与Swift中的函数式编程”，分享者是SwiftyJSON的作者，由于之前在使用RAC时已经接触过函数式编程，所以这个并不陌生，整个演讲主要是分享了函数式编程的一些思想。</p>\n<p>接下来我有听了“RN项目实战优化之路”，由于之前从来没接触过ReactNative，所有听得也是云里雾里，听到一半就跑去听”JSPatch成长之路”。</p>\n<p>JSPatch目前是当前比较热门的一种iOS热修复技术，演讲者就是JSPatch的作者，他分享了整个JSPatch发展过程中遇到的问题以及解决方案，很佩服作者为了推广JSPatch而做的各项工作，包括代码转换工具、XCode插件、JSPatch平台等等，这些工作极大地促进了JSPatch的推广使用，有机会我一定要尝试一下JSPatch。</p>\n<p>听完了JSPatch，我又去听了“当泛型遇上协议”，是猿题库的iOS负责人做的分享，之前看过他写的关于Swift的博客，演讲中，作者通过具体的代码分享自己在Swift的协议与泛型上的实践经验，如果能把泛型使用好确实能极大地简化自己的代码。</p>\n<p>最后我又听了”聚划算iOS平台动态化方案LuaView”，分享者是阿里聚划算的技术专家，LuaView提供了一种使用Lua脚本动态更新App的方案，演讲者讲解了LuaView的基本原理、使用以及对LuaView未来发展的一些规划。</p>\n<p>这样，第一天的会议就结束了。</p>\n<h3 id=\"第二天上午\"><a href=\"#第二天上午\" class=\"headerlink\" title=\"第二天上午\"></a>第二天上午</h3><p>第二天上午也有三个分会场，分别是架构演进、VR/AR、移动解决方案。</p>\n<p>我先听了“360°全景视频播放器的实现原理”，演讲者是阿里的高级iOS工程师，分享了如何使用OpenGL实现全景视频播放，以前从来没有接触过这一块，所以听得也是迷迷糊糊。VR/AR目前是是一个很火的方向，但还处于发展的初期，不过有机会还是值得尝试尝试。</p>\n<p>接下来我又听了一段“手机天猫解耦之路”，我是中间进去的，会场挤满了人，分享者讲的东西也是干货满满。演讲嘉宾是天猫的无线技术专家，我听的那一块正好讲到了一种界面间解耦的思路，使用URL Server来实现界面间跳转。</p>\n<p>接下来又听了滴滴的iOS负责人分享的“滴滴的组件化实践与优化”，主要讲到了滴滴iOS端在发展中遇到的问题以及解决方案，重点讲了滴滴组件化的经历，也是干货满满。后面提到的灰度发布对我们目前的项目很有参考价值。</p>\n<p>后面又听了“iOS遗留系统上的架构重构”，是一名来自澳洲的iOS工程师分享的，主要分享了自己是如何在遗留的代码上，把数据存储从CoreData迁移到Realm并且没有影响正常迭代的经历，使用的是抽象分支+特性开关，也非常有参考价值。</p>\n<h3 id=\"第二天下午\"><a href=\"#第二天下午\" class=\"headerlink\" title=\"第二天下午\"></a>第二天下午</h3><p>第二天下午有两个分会场，分别是性能优化专场和应用架构专场。</p>\n<p>我先听了“美团 iOS 客户端的构建思考与实践”，分享者是美团的高级工程师，主要讲了美团APP iOS客户端的架构，以及集成和发布中遇到的问题和一些实践经验。分享了一些持续集成的经验，目前我们项目中还没有用到持续集成，所有这一块也不是很了解，不过很多东西还是值得借鉴和尝试的。</p>\n<p>后面我又听了来自微博的美女架构师分享的“微博复杂信息流的架构之道”，分享中提到的隔周发版也是一种很好的实践方式。</p>\n<h3 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h3><p>总体来说这次GMTC大会还是收获很多的，学习到了业界一些最新最热的技术和思想，非常感谢公司能给我这次机会。</p>\n<p>最后，由于第一次去北京，当然少不了要到处逛逛。</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/9088bb3373fad1444a78921cb8c8172f.png\" alt=\"2\"></p>\n<p><img src=\"http://oldblog.shicishuzhai.com/5a0e1b3dac94502a08f70de2f14bee22.png\" alt=\"3\"></p>\n","site":{"data":{}},"excerpt":"","more":"<p>6月24日至6月25日，我有幸参加了“GMTC全球移动技术大会”，这篇博客就是我对参见会议的一个经历和感受。</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/457acda7bd3dc65f172468c45dad4a8f.png\" alt=\"1\"></p>\n<h3 id=\"第一天上午\"><a href=\"#第一天上午\" class=\"headerlink\" title=\"第一天上午\"></a>第一天上午</h3><p>会议共分为两天，第一天上午是主会场，首先是主办方开场致辞，然后是京东，阿里和微信的三个技术负责人的演讲，主要讲了移动开发的现状以及未来的一些趋势，没有涉及到具体的技术。</p>\n<p>接下来是Facebook的一个前员工分享了”Facebook iOS App技术演化10年”，讲到了很多有意思的地方，这里令我印象比较深刻的是Facebook一共有1000+的iOS工程师，这个iOS App的代码行数超过1000万行，同时他也分享了Facebook App演化过程中走过的一些完了，例如H5，CoreData等。</p>\n<p>接下来也是一个硅谷的iOS开发者分享了“Mobile Growth 的方法和实践”，由于之前从来没有接触过Growth，所以听的也是一知半解，感觉与产品运营更相关。这就是第一天早上的整个会议。</p>\n<h3 id=\"第一天下午\"><a href=\"#第一天下午\" class=\"headerlink\" title=\"第一天下午\"></a>第一天下午</h3><p>从第一天的下午开始，就开始分了几个分会场进行具体的技术分享。第一天下午有三个分会场，分别是动态化，Swift和新技术专场。</p>\n<p>我先是听了”函数式编程中的Swift与Swift中的函数式编程”，分享者是SwiftyJSON的作者，由于之前在使用RAC时已经接触过函数式编程，所以这个并不陌生，整个演讲主要是分享了函数式编程的一些思想。</p>\n<p>接下来我有听了“RN项目实战优化之路”，由于之前从来没接触过ReactNative，所有听得也是云里雾里，听到一半就跑去听”JSPatch成长之路”。</p>\n<p>JSPatch目前是当前比较热门的一种iOS热修复技术，演讲者就是JSPatch的作者，他分享了整个JSPatch发展过程中遇到的问题以及解决方案，很佩服作者为了推广JSPatch而做的各项工作，包括代码转换工具、XCode插件、JSPatch平台等等，这些工作极大地促进了JSPatch的推广使用，有机会我一定要尝试一下JSPatch。</p>\n<p>听完了JSPatch，我又去听了“当泛型遇上协议”，是猿题库的iOS负责人做的分享，之前看过他写的关于Swift的博客，演讲中，作者通过具体的代码分享自己在Swift的协议与泛型上的实践经验，如果能把泛型使用好确实能极大地简化自己的代码。</p>\n<p>最后我又听了”聚划算iOS平台动态化方案LuaView”，分享者是阿里聚划算的技术专家，LuaView提供了一种使用Lua脚本动态更新App的方案，演讲者讲解了LuaView的基本原理、使用以及对LuaView未来发展的一些规划。</p>\n<p>这样，第一天的会议就结束了。</p>\n<h3 id=\"第二天上午\"><a href=\"#第二天上午\" class=\"headerlink\" title=\"第二天上午\"></a>第二天上午</h3><p>第二天上午也有三个分会场，分别是架构演进、VR/AR、移动解决方案。</p>\n<p>我先听了“360°全景视频播放器的实现原理”，演讲者是阿里的高级iOS工程师，分享了如何使用OpenGL实现全景视频播放，以前从来没有接触过这一块，所以听得也是迷迷糊糊。VR/AR目前是是一个很火的方向，但还处于发展的初期，不过有机会还是值得尝试尝试。</p>\n<p>接下来我又听了一段“手机天猫解耦之路”，我是中间进去的，会场挤满了人，分享者讲的东西也是干货满满。演讲嘉宾是天猫的无线技术专家，我听的那一块正好讲到了一种界面间解耦的思路，使用URL Server来实现界面间跳转。</p>\n<p>接下来又听了滴滴的iOS负责人分享的“滴滴的组件化实践与优化”，主要讲到了滴滴iOS端在发展中遇到的问题以及解决方案，重点讲了滴滴组件化的经历，也是干货满满。后面提到的灰度发布对我们目前的项目很有参考价值。</p>\n<p>后面又听了“iOS遗留系统上的架构重构”，是一名来自澳洲的iOS工程师分享的，主要分享了自己是如何在遗留的代码上，把数据存储从CoreData迁移到Realm并且没有影响正常迭代的经历，使用的是抽象分支+特性开关，也非常有参考价值。</p>\n<h3 id=\"第二天下午\"><a href=\"#第二天下午\" class=\"headerlink\" title=\"第二天下午\"></a>第二天下午</h3><p>第二天下午有两个分会场，分别是性能优化专场和应用架构专场。</p>\n<p>我先听了“美团 iOS 客户端的构建思考与实践”，分享者是美团的高级工程师，主要讲了美团APP iOS客户端的架构，以及集成和发布中遇到的问题和一些实践经验。分享了一些持续集成的经验，目前我们项目中还没有用到持续集成，所有这一块也不是很了解，不过很多东西还是值得借鉴和尝试的。</p>\n<p>后面我又听了来自微博的美女架构师分享的“微博复杂信息流的架构之道”，分享中提到的隔周发版也是一种很好的实践方式。</p>\n<h3 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h3><p>总体来说这次GMTC大会还是收获很多的，学习到了业界一些最新最热的技术和思想，非常感谢公司能给我这次机会。</p>\n<p>最后，由于第一次去北京，当然少不了要到处逛逛。</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/9088bb3373fad1444a78921cb8c8172f.png\" alt=\"2\"></p>\n<p><img src=\"http://oldblog.shicishuzhai.com/5a0e1b3dac94502a08f70de2f14bee22.png\" alt=\"3\"></p>\n"},{"title":"设置富文本字间距，文字不能居中对齐","date":"2016-07-03T10:40:19.000Z","_content":"\n最近有一个需求，需要设置一个UILabel的字间距，我马上就想到了富文本，于是就写了下面的代码\n\n```objectivec\nNSString *str = self.label.text;\nNSDictionary *attribute = @{NSKernAttributeName:@(10),\n                            NSFontAttributeName:[UIFont systemFontOfSize:15]};\nNSAttributedString *attStr = [[NSAttributedString alloc] initWithString:str attributes:attribute];\nself.label.attributedText = attStr;\n```\n\n其中NSKernAttributeName属性就是设置文字的字间距。但是，现在就有一个问题，设置字间距后，原本居中显示的文字，不能居中显示了。\n\n这是我设置字间距之前的label\n\n![1](http://oldblog.shicishuzhai.com/3cba47225e6b1a02cfad6885a67d83ed.png)\n\n这是我设置了字间距后的label\n\n![2](http://oldblog.shicishuzhai.com/424954a63f3e38514b84ab7277269336.png)\n\n\"你\"字距左边距明显要比\"鸿\"字的右边距要大。\n\n经过一阵Google，在StackOverflow上找到了相同的问题，链接是[http://stackoverflow.com/questions/23741850/nsstring-drawinrectwithattributes-not-correctly-centered-when-using-nskernattr](http://stackoverflow.com/questions/23741850/nsstring-drawinrectwithattributes-not-correctly-centered-when-using-nskernattr)，根据问题回答里的做法，我把代码做了修改，如下：\n\n```objectivec\nNSString *str = self.label.text;\nNSMutableAttributedString *mutAttStr = [[NSMutableAttributedString alloc] initWithString:str];\n[mutAttStr addAttribute:NSKernAttributeName value:@(10) range:NSMakeRange(0, str.length - 1)];\n[mutAttStr addAttribute:NSFontAttributeName value:[UIFont systemFontOfSize:15] range:NSMakeRange(0, str.length)];\nself.label.attributedText = [mutAttStr copy];\n```\n\n修改后效果如下：\n\n![3](http://oldblog.shicishuzhai.com/35b1f58bf08aa3dc7b827edb1da01e80.png)\n","source":"_posts/2016-07-03-设置富文本字间距，文字不能居中对齐.md","raw":"---\ntitle: 设置富文本字间距，文字不能居中对齐\ncategories: iOS Tips\ntags:\n  - UILabel\n  - NSAttributedString\ndate: 2016-07-03 18:40:19\n---\n\n最近有一个需求，需要设置一个UILabel的字间距，我马上就想到了富文本，于是就写了下面的代码\n\n```objectivec\nNSString *str = self.label.text;\nNSDictionary *attribute = @{NSKernAttributeName:@(10),\n                            NSFontAttributeName:[UIFont systemFontOfSize:15]};\nNSAttributedString *attStr = [[NSAttributedString alloc] initWithString:str attributes:attribute];\nself.label.attributedText = attStr;\n```\n\n其中NSKernAttributeName属性就是设置文字的字间距。但是，现在就有一个问题，设置字间距后，原本居中显示的文字，不能居中显示了。\n\n这是我设置字间距之前的label\n\n![1](http://oldblog.shicishuzhai.com/3cba47225e6b1a02cfad6885a67d83ed.png)\n\n这是我设置了字间距后的label\n\n![2](http://oldblog.shicishuzhai.com/424954a63f3e38514b84ab7277269336.png)\n\n\"你\"字距左边距明显要比\"鸿\"字的右边距要大。\n\n经过一阵Google，在StackOverflow上找到了相同的问题，链接是[http://stackoverflow.com/questions/23741850/nsstring-drawinrectwithattributes-not-correctly-centered-when-using-nskernattr](http://stackoverflow.com/questions/23741850/nsstring-drawinrectwithattributes-not-correctly-centered-when-using-nskernattr)，根据问题回答里的做法，我把代码做了修改，如下：\n\n```objectivec\nNSString *str = self.label.text;\nNSMutableAttributedString *mutAttStr = [[NSMutableAttributedString alloc] initWithString:str];\n[mutAttStr addAttribute:NSKernAttributeName value:@(10) range:NSMakeRange(0, str.length - 1)];\n[mutAttStr addAttribute:NSFontAttributeName value:[UIFont systemFontOfSize:15] range:NSMakeRange(0, str.length)];\nself.label.attributedText = [mutAttStr copy];\n```\n\n修改后效果如下：\n\n![3](http://oldblog.shicishuzhai.com/35b1f58bf08aa3dc7b827edb1da01e80.png)\n","slug":"设置富文本字间距，文字不能居中对齐","published":1,"updated":"2019-01-13T04:01:04.524Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjutyfmfi001qc4c91nq7vexy","content":"<p>最近有一个需求，需要设置一个UILabel的字间距，我马上就想到了富文本，于是就写了下面的代码</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">NSString</span> *str = <span class=\"keyword\">self</span>.label.text;</span><br><span class=\"line\"><span class=\"built_in\">NSDictionary</span> *attribute = @&#123;<span class=\"built_in\">NSKernAttributeName</span>:@(<span class=\"number\">10</span>),</span><br><span class=\"line\">                            <span class=\"built_in\">NSFontAttributeName</span>:[<span class=\"built_in\">UIFont</span> systemFontOfSize:<span class=\"number\">15</span>]&#125;;</span><br><span class=\"line\"><span class=\"built_in\">NSAttributedString</span> *attStr = [[<span class=\"built_in\">NSAttributedString</span> alloc] initWithString:str attributes:attribute];</span><br><span class=\"line\"><span class=\"keyword\">self</span>.label.attributedText = attStr;</span><br></pre></td></tr></table></figure>\n<p>其中NSKernAttributeName属性就是设置文字的字间距。但是，现在就有一个问题，设置字间距后，原本居中显示的文字，不能居中显示了。</p>\n<p>这是我设置字间距之前的label</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/3cba47225e6b1a02cfad6885a67d83ed.png\" alt=\"1\"></p>\n<p>这是我设置了字间距后的label</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/424954a63f3e38514b84ab7277269336.png\" alt=\"2\"></p>\n<p>“你”字距左边距明显要比”鸿”字的右边距要大。</p>\n<p>经过一阵Google，在StackOverflow上找到了相同的问题，链接是<a href=\"http://stackoverflow.com/questions/23741850/nsstring-drawinrectwithattributes-not-correctly-centered-when-using-nskernattr\" target=\"_blank\" rel=\"noopener\">http://stackoverflow.com/questions/23741850/nsstring-drawinrectwithattributes-not-correctly-centered-when-using-nskernattr</a>，根据问题回答里的做法，我把代码做了修改，如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">NSString</span> *str = <span class=\"keyword\">self</span>.label.text;</span><br><span class=\"line\"><span class=\"built_in\">NSMutableAttributedString</span> *mutAttStr = [[<span class=\"built_in\">NSMutableAttributedString</span> alloc] initWithString:str];</span><br><span class=\"line\">[mutAttStr addAttribute:<span class=\"built_in\">NSKernAttributeName</span> value:@(<span class=\"number\">10</span>) range:<span class=\"built_in\">NSMakeRange</span>(<span class=\"number\">0</span>, str.length - <span class=\"number\">1</span>)];</span><br><span class=\"line\">[mutAttStr addAttribute:<span class=\"built_in\">NSFontAttributeName</span> value:[<span class=\"built_in\">UIFont</span> systemFontOfSize:<span class=\"number\">15</span>] range:<span class=\"built_in\">NSMakeRange</span>(<span class=\"number\">0</span>, str.length)];</span><br><span class=\"line\"><span class=\"keyword\">self</span>.label.attributedText = [mutAttStr <span class=\"keyword\">copy</span>];</span><br></pre></td></tr></table></figure>\n<p>修改后效果如下：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/35b1f58bf08aa3dc7b827edb1da01e80.png\" alt=\"3\"></p>\n","site":{"data":{}},"excerpt":"","more":"<p>最近有一个需求，需要设置一个UILabel的字间距，我马上就想到了富文本，于是就写了下面的代码</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">NSString</span> *str = <span class=\"keyword\">self</span>.label.text;</span><br><span class=\"line\"><span class=\"built_in\">NSDictionary</span> *attribute = @&#123;<span class=\"built_in\">NSKernAttributeName</span>:@(<span class=\"number\">10</span>),</span><br><span class=\"line\">                            <span class=\"built_in\">NSFontAttributeName</span>:[<span class=\"built_in\">UIFont</span> systemFontOfSize:<span class=\"number\">15</span>]&#125;;</span><br><span class=\"line\"><span class=\"built_in\">NSAttributedString</span> *attStr = [[<span class=\"built_in\">NSAttributedString</span> alloc] initWithString:str attributes:attribute];</span><br><span class=\"line\"><span class=\"keyword\">self</span>.label.attributedText = attStr;</span><br></pre></td></tr></table></figure>\n<p>其中NSKernAttributeName属性就是设置文字的字间距。但是，现在就有一个问题，设置字间距后，原本居中显示的文字，不能居中显示了。</p>\n<p>这是我设置字间距之前的label</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/3cba47225e6b1a02cfad6885a67d83ed.png\" alt=\"1\"></p>\n<p>这是我设置了字间距后的label</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/424954a63f3e38514b84ab7277269336.png\" alt=\"2\"></p>\n<p>“你”字距左边距明显要比”鸿”字的右边距要大。</p>\n<p>经过一阵Google，在StackOverflow上找到了相同的问题，链接是<a href=\"http://stackoverflow.com/questions/23741850/nsstring-drawinrectwithattributes-not-correctly-centered-when-using-nskernattr\" target=\"_blank\" rel=\"noopener\">http://stackoverflow.com/questions/23741850/nsstring-drawinrectwithattributes-not-correctly-centered-when-using-nskernattr</a>，根据问题回答里的做法，我把代码做了修改，如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">NSString</span> *str = <span class=\"keyword\">self</span>.label.text;</span><br><span class=\"line\"><span class=\"built_in\">NSMutableAttributedString</span> *mutAttStr = [[<span class=\"built_in\">NSMutableAttributedString</span> alloc] initWithString:str];</span><br><span class=\"line\">[mutAttStr addAttribute:<span class=\"built_in\">NSKernAttributeName</span> value:@(<span class=\"number\">10</span>) range:<span class=\"built_in\">NSMakeRange</span>(<span class=\"number\">0</span>, str.length - <span class=\"number\">1</span>)];</span><br><span class=\"line\">[mutAttStr addAttribute:<span class=\"built_in\">NSFontAttributeName</span> value:[<span class=\"built_in\">UIFont</span> systemFontOfSize:<span class=\"number\">15</span>] range:<span class=\"built_in\">NSMakeRange</span>(<span class=\"number\">0</span>, str.length)];</span><br><span class=\"line\"><span class=\"keyword\">self</span>.label.attributedText = [mutAttStr <span class=\"keyword\">copy</span>];</span><br></pre></td></tr></table></figure>\n<p>修改后效果如下：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/35b1f58bf08aa3dc7b827edb1da01e80.png\" alt=\"3\"></p>\n"},{"title":"UIButton设置标题无效","date":"2016-07-26T15:19:02.000Z","_content":"\nUIButton在使用`setAttributedTitle:forState:`设置了富文本标题后，是使用`setTitle:forState:`设置标题是没有效果的，解决方案是先把富文本去掉，然后再使用`setTitle:forState:`设置标题，或者直接使用`setAttributedTitle:forState:`重新设置不带属性的富文本。代码如下：\n\n```objectivec\n[self.payButton setAttributedTitle:nil forState:UIControlStateNormal];\n[self.payButton setTitle:@\"余额不足，去充值\" forState:UIControlStateNormal];\n```\n","source":"_posts/2016-07-26-UIButton设置标题无效.md","raw":"---\ntitle: UIButton设置标题无效\ncategories: iOS Tips\ntags:\n  - UIButton\ndate: 2016-07-26 23:19:02\n---\n\nUIButton在使用`setAttributedTitle:forState:`设置了富文本标题后，是使用`setTitle:forState:`设置标题是没有效果的，解决方案是先把富文本去掉，然后再使用`setTitle:forState:`设置标题，或者直接使用`setAttributedTitle:forState:`重新设置不带属性的富文本。代码如下：\n\n```objectivec\n[self.payButton setAttributedTitle:nil forState:UIControlStateNormal];\n[self.payButton setTitle:@\"余额不足，去充值\" forState:UIControlStateNormal];\n```\n","slug":"UIButton设置标题无效","published":1,"updated":"2017-03-01T06:42:53.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjutyfmfj001sc4c9iv7tct8v","content":"<p>UIButton在使用<code>setAttributedTitle:forState:</code>设置了富文本标题后，是使用<code>setTitle:forState:</code>设置标题是没有效果的，解决方案是先把富文本去掉，然后再使用<code>setTitle:forState:</code>设置标题，或者直接使用<code>setAttributedTitle:forState:</code>重新设置不带属性的富文本。代码如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"keyword\">self</span>.payButton setAttributedTitle:<span class=\"literal\">nil</span> forState:<span class=\"built_in\">UIControlStateNormal</span>];</span><br><span class=\"line\">[<span class=\"keyword\">self</span>.payButton setTitle:<span class=\"string\">@\"余额不足，去充值\"</span> forState:<span class=\"built_in\">UIControlStateNormal</span>];</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<p>UIButton在使用<code>setAttributedTitle:forState:</code>设置了富文本标题后，是使用<code>setTitle:forState:</code>设置标题是没有效果的，解决方案是先把富文本去掉，然后再使用<code>setTitle:forState:</code>设置标题，或者直接使用<code>setAttributedTitle:forState:</code>重新设置不带属性的富文本。代码如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"keyword\">self</span>.payButton setAttributedTitle:<span class=\"literal\">nil</span> forState:<span class=\"built_in\">UIControlStateNormal</span>];</span><br><span class=\"line\">[<span class=\"keyword\">self</span>.payButton setTitle:<span class=\"string\">@\"余额不足，去充值\"</span> forState:<span class=\"built_in\">UIControlStateNormal</span>];</span><br></pre></td></tr></table></figure>\n"},{"title":"使用HTTPS方法clone下来的Git仓库push时报错","date":"2016-07-30T03:22:55.000Z","_content":"\n昨天在使用Git时遇到了一个问题，今天记录一下。\n\n一般我在克隆Github的项目时都是使用ssh的方式进行的，这样只要你的ssh-key配置正确，就没有问题。昨天心血来潮试了一下https克隆了一个项目，修改完后，准备push的时候需要了问题，问题如下：\n\n\n>remote: Permission to liujinlongxa/Spoon-Knife.git denied to xxxx.\nfatal: unable to access 'https://github.com/liujinlongxa/Spoon-Knife.git/': The requested URL returned error: 403\n\n解决方案是修改git的配置文件，\n\n`vim .git/config`\n\n将\n\n\n>[remote \"origin\"]\n        url = https://github.com/liujinlongxa/Spoon-Knife.git\n\n\n改为\n\n\n>[remote \"origin\"]\n        url = https://liujinlongxa@github.com/liujinlongxa/Spoon-Knife.git\n\n即前面加上用户名，这样就可以正常的push，或者直接运行命令\n\n```shell\ngit config --local remote.origin.url https://liujinlongxa@github.com/liujinlongxa/Spoon-Knife.git\n```\n\n也可以达到相同的效果。\n","source":"_posts/2016-07-30-使用HTTPS方法clone下来的Git仓库push时报错.md","raw":"---\ntitle: 使用HTTPS方法clone下来的Git仓库push时报错\ncategories: Git\ntags:\n  - Git\ndate: 2016-07-30 11:22:55\n---\n\n昨天在使用Git时遇到了一个问题，今天记录一下。\n\n一般我在克隆Github的项目时都是使用ssh的方式进行的，这样只要你的ssh-key配置正确，就没有问题。昨天心血来潮试了一下https克隆了一个项目，修改完后，准备push的时候需要了问题，问题如下：\n\n\n>remote: Permission to liujinlongxa/Spoon-Knife.git denied to xxxx.\nfatal: unable to access 'https://github.com/liujinlongxa/Spoon-Knife.git/': The requested URL returned error: 403\n\n解决方案是修改git的配置文件，\n\n`vim .git/config`\n\n将\n\n\n>[remote \"origin\"]\n        url = https://github.com/liujinlongxa/Spoon-Knife.git\n\n\n改为\n\n\n>[remote \"origin\"]\n        url = https://liujinlongxa@github.com/liujinlongxa/Spoon-Knife.git\n\n即前面加上用户名，这样就可以正常的push，或者直接运行命令\n\n```shell\ngit config --local remote.origin.url https://liujinlongxa@github.com/liujinlongxa/Spoon-Knife.git\n```\n\n也可以达到相同的效果。\n","slug":"使用HTTPS方法clone下来的Git仓库push时报错","published":1,"updated":"2017-03-01T06:42:53.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjutyfmfk001vc4c9jky7vyrm","content":"<p>昨天在使用Git时遇到了一个问题，今天记录一下。</p>\n<p>一般我在克隆Github的项目时都是使用ssh的方式进行的，这样只要你的ssh-key配置正确，就没有问题。昨天心血来潮试了一下https克隆了一个项目，修改完后，准备push的时候需要了问题，问题如下：</p>\n<blockquote>\n<p>remote: Permission to liujinlongxa/Spoon-Knife.git denied to xxxx.<br>fatal: unable to access ‘<a href=\"https://github.com/liujinlongxa/Spoon-Knife.git/&#39;\" target=\"_blank\" rel=\"noopener\">https://github.com/liujinlongxa/Spoon-Knife.git/&#39;</a>: The requested URL returned error: 403</p>\n</blockquote>\n<p>解决方案是修改git的配置文件，</p>\n<p><code>vim .git/config</code></p>\n<p>将</p>\n<blockquote>\n<p>[remote “origin”]<br>        url = <a href=\"https://github.com/liujinlongxa/Spoon-Knife.git\" target=\"_blank\" rel=\"noopener\">https://github.com/liujinlongxa/Spoon-Knife.git</a></p>\n</blockquote>\n<p>改为</p>\n<blockquote>\n<p>[remote “origin”]<br>        url = <a href=\"https://liujinlongxa@github.com/liujinlongxa/Spoon-Knife.git\" target=\"_blank\" rel=\"noopener\">https://liujinlongxa@github.com/liujinlongxa/Spoon-Knife.git</a></p>\n</blockquote>\n<p>即前面加上用户名，这样就可以正常的push，或者直接运行命令</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git config --local remote.origin.url https://liujinlongxa@github.com/liujinlongxa/Spoon-Knife.git</span><br></pre></td></tr></table></figure>\n<p>也可以达到相同的效果。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>昨天在使用Git时遇到了一个问题，今天记录一下。</p>\n<p>一般我在克隆Github的项目时都是使用ssh的方式进行的，这样只要你的ssh-key配置正确，就没有问题。昨天心血来潮试了一下https克隆了一个项目，修改完后，准备push的时候需要了问题，问题如下：</p>\n<blockquote>\n<p>remote: Permission to liujinlongxa/Spoon-Knife.git denied to xxxx.<br>fatal: unable to access ‘<a href=\"https://github.com/liujinlongxa/Spoon-Knife.git/&#39;\" target=\"_blank\" rel=\"noopener\">https://github.com/liujinlongxa/Spoon-Knife.git/&#39;</a>: The requested URL returned error: 403</p>\n</blockquote>\n<p>解决方案是修改git的配置文件，</p>\n<p><code>vim .git/config</code></p>\n<p>将</p>\n<blockquote>\n<p>[remote “origin”]<br>        url = <a href=\"https://github.com/liujinlongxa/Spoon-Knife.git\" target=\"_blank\" rel=\"noopener\">https://github.com/liujinlongxa/Spoon-Knife.git</a></p>\n</blockquote>\n<p>改为</p>\n<blockquote>\n<p>[remote “origin”]<br>        url = <a href=\"https://liujinlongxa@github.com/liujinlongxa/Spoon-Knife.git\" target=\"_blank\" rel=\"noopener\">https://liujinlongxa@github.com/liujinlongxa/Spoon-Knife.git</a></p>\n</blockquote>\n<p>即前面加上用户名，这样就可以正常的push，或者直接运行命令</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git config --local remote.origin.url https://liujinlongxa@github.com/liujinlongxa/Spoon-Knife.git</span><br></pre></td></tr></table></figure>\n<p>也可以达到相同的效果。</p>\n"},{"title":"在VPS上搭建Git服务器","date":"2016-08-07T07:27:52.000Z","_content":"\n昨天尝试了在自己的VPS上搭建一个git服务器，中间踩了很多坑，下面是我整个搭建的过程。\n\n## 具体流程\n\n### 第一步：安装Git\n\n打开VPS(这里我用的是[搬运工](https://bandwagonhost.com/index.php)，怎么购买VPS可以参考我的[这篇博客](http://liujinlongxa.com/2016/06/11/%E6%89%93%E9%80%A0%E8%87%AA%E5%B7%B1%E7%9A%84%E7%BF%BB%E5%A2%99VPS:%E6%90%AC%E8%BF%90%E5%B7%A5VPS%E8%B4%AD%E4%B9%B0%E4%BD%BF%E7%94%A8%E6%B5%81%E7%A8%8B%E5%85%A8%E8%AE%B0%E5%BD%95/))的控制后台，进入Shell，然后输入命令：\n\n```shell\nyum install -y git\n```\n\n执行完后如图：\n\n![2](http://oldblog.shicishuzhai.com/b9dd798ab599b9b53adebee98ebe5bbd.png)\n\n查看Git版本，如果能显示Git版本，则说明安装成功。\n\n![3](http://oldblog.shicishuzhai.com/d7cdff1b7006e2c9b5f1e521319d903c.png)\n\n### 第二步：添加用户\n\n输入命令\n\n```shell\nadduser git\nsu git\n```\n\n添加一个名为git的用户，并且将当前用户切换到git\n\n![4](http://oldblog.shicishuzhai.com/c5350088190cd59d220b4942b9d87eae.png)\n\n### 第三步：创建仓库\n\n创建一个文件夹用来存放git仓库，然后输入命令\n\n```shell\ngit init --bare mycode.git\n```\n\n这样就可以创建一个裸仓库，因为服务器上的Git仓库纯粹是为了共享，所以不让用户直接登录到服务器上去改工作区，如下图：\n\n![5](http://oldblog.shicishuzhai.com/c58f27e2d859d984c844371a43a37ab8.png)\n\n把服务器的git仓库的用户组改为git\n\n![6](http://oldblog.shicishuzhai.com/26a614c08121e4b0f8783551208e2d19.png)\n\n这样仓库就创建完了\n\n### 第四步：创建证书\n\n在服务器/homg/git目录下创建文件夹.ssh，然后在.ssh文件夹里创建authorized_keys\n\n** 注意：一定要切换到git用户下再创建，否则使用root用户创建，会因为文件夹权限的问题而造成RSA校验失败，我就是在这里卡了半天 **\n\n然后在客户端创建公钥，即~/.ssh/id_rsa.pub文件里的内容，然后把公钥填入服务器的authorized_keys文件中\n\n![7](http://oldblog.shicishuzhai.com/9eca6530c312dc064c8901735ef9942e.png)\n\n![8](http://oldblog.shicishuzhai.com/7c38fa2c806440f162b83208038a8dc9.png)\n\n### 第五步：打开服务器RSA验证\n\n进入服务器/etc/ssh目录，使用vim打开sshd_config（建议先做一个备份），修改如下内容\n\n```shell\nRSAAuthentication yes     \nPubkeyAuthentication yes     \nAuthorizedKeysFile  .ssh/authorized_keys\n```\n\n大部分Linux系统的RSA认证默认就是开启的，如果已经开启，则可以忽略(在这里也卡了好久😭)\n\n![9](http://oldblog.shicishuzhai.com/9d534724207d6319fcf654142e91ba24.png)\n\n然后保存退出，重新启动sshd\n\n![10](http://oldblog.shicishuzhai.com/74d02be9217b7ea806af5970560ac956.png)\n\n### 第六步：修改指定服务器的ssh端口\n\n一般ssh访问默认的端口是22，但是搬运工VPS修改了ssh访问的端口，而Git访问还是用还是22端口，因此要修改Git使用ssh访问的端口(在这里也卡了好久😭)，要查看ssh端口可以在服务器的sshd_config文件中查看，如下：\n\n![11](http://oldblog.shicishuzhai.com/b2f7743ffae9917e88f0ace60e11637b.png)\n\n 如果不想修改服务器端口配置，可以修改客户端访问端口。在客户端的/~/.ssh/config文件中添加如下两行，第一行是服务器的地址，第二行是服务器的端口\n\n![12](http://oldblog.shicishuzhai.com/17e45daf40d28f1174387104a3daef40.png)\n\n这样就修改了访问指定服务器时的ssh端口。\n\n### 第七步：创建本地仓库\n\n经过以上六步，一个Git服务器就建立好了，现在你就可以把仓库clone下来，然后开始使用了。\n\n![13](http://oldblog.shicishuzhai.com/285c535aa2610ae916b1f964617a8d68.png)\n\n## 遇到的坑\n\n在整个搭建过程中，我也踩了很多坑，下面对这些坑做一个总结。\n\n### 服务器与客户端ssh端口不一致\n\n在完成创建证书之后，按理说，应该已经可以clone仓库了，但是我尝试克隆会报如下错误：\n\n![14](http://oldblog.shicishuzhai.com/e5bc21bbdb55bcdf473e6addf69cf495.png)\n\n网上找了很多方法，最后发现是因为客户端和服务器的ssh端口不一致导致，修改了客户端的ssh访问端口才解决了这个问题。\n\n相关参考：[修改了SSH默认端口之后，如何配置git？](http://zengrong.net/post/1544.htm)\n\n### ssh验证失败\n\n修改了ssh端口后，可以访问仓库了，但是每次访问都要输入密码，按理说我已经创建了证书，并且也把公钥放到了服务器，为什么还是不行呢？\n\n找了半天，发现服务器的RSA身份校验压根就没有开启，ssh在校验时是先使用RSA进行校验，如果校验失败再使用密码进行校验。修改sshd_config文件，打开身份校验，参照上面的第五步。\n\n打开身份校验之后，发现还是要输入密码。最初我的做法是关闭服务器的ssh密码校验，修改服务器/etc/ssh/sshd_config文件如下内容：\n\n```shell\nPasswordAuthentication no\n```\n\n![15](http://oldblog.shicishuzhai.com/fadd0406c6a9e9c02402e170082c82c7.png)\n\n然后重启sshd。\n\n这样修改了之后，由于禁止了密码验证的方式，而RSA验证又失败，所以压根验证失败，访问都访问不了了。\n\n![16](http://oldblog.shicishuzhai.com/2b0a4555687ea4fe8326f690ee35533e.png)\n\n然后我尝试看Log，输入命令：\n\n```shell\nssh git@xxx.xxx.xxx.xxx -vvv\n```\n\n从Log上看，客户端已经把key传给了服务器，但是服务器在验证时失败了，所以八成可能是服务器的问题。\n\n![20](http://oldblog.shicishuzhai.com/8ec00cb79352b30a2f95a1b48410cdfe.png)\n\n然后我又根据[这篇博客](http://www.androiddev.net/ssh-public-key-authentication-error/)修改了目录的权限，但是还是不行。\n\n根据[这篇博客](http://flysnowxf.iteye.com/blog/1567570)关闭了SELinux也还是不行。\n\n然后我又根据[这篇博客](http://blog.csdn.net/lansesl2008/article/details/16113193)打开了ssh的log，修改sshd_config如下内容：\n\n![17](http://oldblog.shicishuzhai.com/3dc7b3340f6b693b047ecbee93400564.png)\n\n然后又重新登录和退出几次ssh，在/var/log/secure里看到了如下内容：\n\n![18](http://oldblog.shicishuzhai.com/4f320784c4d9d731d53b3792856ec4dd.png)\n\n并没有什么有用的信息，不知道是不是我的Log配置的有问题。\n\n找了很多资料，有很多文章都提到了文件夹权限的问题，于是我又回到服务器git目录下看了一下文件夹的权限：\n\n![19](http://oldblog.shicishuzhai.com/c9be98241282c46c0111cb25e1be9aa4.png)\n\n原来我在创建.ssh目录是用的是root账户，所有造成ssh在进行身份认证时没有权限方位.ssh目录，导致认证失败。输入命令\n\n```shell\nchown git .ssh\n```\n\n将.ssh文件夹的所属用户改为git，.ssh里的authorized_keys文件也做相同的处理，这样改了之后终于可以验证成功了，并且不用输入密码了。\n\n## 总结\n\n整个搭建过程用了将近一天的时间，虽然过程有些曲折，但是最终还是成功了，而且这个过程中我也学到了不少的东西，更加深入的了解了ssh服务。\n\n希望这篇文章能对大家在搭建git服务器时有所帮助。\n\n## 参考资料\n\n[在CentOS下搭建自己的Git服务器](http://blog.csdn.net/wave_1102/article/details/47779401)\n[ssh无密码登录认证失败](http://blog.csdn.net/jacky0922/article/details/17999271)\n[sshd_config配置详解](http://blog.csdn.net/lansesl2008/article/details/16113193)\n[一个SSH 公钥登录失败的问题及解决经验](http://www.androiddev.net/ssh-public-key-authentication-error/)\n[Permission denied (publickey, gssapi-keyex,gssapi-with-mic,password)](http://www.linuxquestions.org/questions/linux-newbie-8/permission-denied-publickey-gssapi-keyex-gssapi-with-mic-password-4175413607/)\n[ssh使用公钥授权不通过的问题解决](http://flysnowxf.iteye.com/blog/1567570)\n[修改了SSH默认端口之后，如何配置git？](http://zengrong.net/post/1544.htm)\n","source":"_posts/2016-08-07-在VPS上搭建Git服务器.md","raw":"---\ntitle: 在VPS上搭建Git服务器\ncategories: Git\ntags:\n  - Git\ndate: 2016-08-07 15:27:52\n---\n\n昨天尝试了在自己的VPS上搭建一个git服务器，中间踩了很多坑，下面是我整个搭建的过程。\n\n## 具体流程\n\n### 第一步：安装Git\n\n打开VPS(这里我用的是[搬运工](https://bandwagonhost.com/index.php)，怎么购买VPS可以参考我的[这篇博客](http://liujinlongxa.com/2016/06/11/%E6%89%93%E9%80%A0%E8%87%AA%E5%B7%B1%E7%9A%84%E7%BF%BB%E5%A2%99VPS:%E6%90%AC%E8%BF%90%E5%B7%A5VPS%E8%B4%AD%E4%B9%B0%E4%BD%BF%E7%94%A8%E6%B5%81%E7%A8%8B%E5%85%A8%E8%AE%B0%E5%BD%95/))的控制后台，进入Shell，然后输入命令：\n\n```shell\nyum install -y git\n```\n\n执行完后如图：\n\n![2](http://oldblog.shicishuzhai.com/b9dd798ab599b9b53adebee98ebe5bbd.png)\n\n查看Git版本，如果能显示Git版本，则说明安装成功。\n\n![3](http://oldblog.shicishuzhai.com/d7cdff1b7006e2c9b5f1e521319d903c.png)\n\n### 第二步：添加用户\n\n输入命令\n\n```shell\nadduser git\nsu git\n```\n\n添加一个名为git的用户，并且将当前用户切换到git\n\n![4](http://oldblog.shicishuzhai.com/c5350088190cd59d220b4942b9d87eae.png)\n\n### 第三步：创建仓库\n\n创建一个文件夹用来存放git仓库，然后输入命令\n\n```shell\ngit init --bare mycode.git\n```\n\n这样就可以创建一个裸仓库，因为服务器上的Git仓库纯粹是为了共享，所以不让用户直接登录到服务器上去改工作区，如下图：\n\n![5](http://oldblog.shicishuzhai.com/c58f27e2d859d984c844371a43a37ab8.png)\n\n把服务器的git仓库的用户组改为git\n\n![6](http://oldblog.shicishuzhai.com/26a614c08121e4b0f8783551208e2d19.png)\n\n这样仓库就创建完了\n\n### 第四步：创建证书\n\n在服务器/homg/git目录下创建文件夹.ssh，然后在.ssh文件夹里创建authorized_keys\n\n** 注意：一定要切换到git用户下再创建，否则使用root用户创建，会因为文件夹权限的问题而造成RSA校验失败，我就是在这里卡了半天 **\n\n然后在客户端创建公钥，即~/.ssh/id_rsa.pub文件里的内容，然后把公钥填入服务器的authorized_keys文件中\n\n![7](http://oldblog.shicishuzhai.com/9eca6530c312dc064c8901735ef9942e.png)\n\n![8](http://oldblog.shicishuzhai.com/7c38fa2c806440f162b83208038a8dc9.png)\n\n### 第五步：打开服务器RSA验证\n\n进入服务器/etc/ssh目录，使用vim打开sshd_config（建议先做一个备份），修改如下内容\n\n```shell\nRSAAuthentication yes     \nPubkeyAuthentication yes     \nAuthorizedKeysFile  .ssh/authorized_keys\n```\n\n大部分Linux系统的RSA认证默认就是开启的，如果已经开启，则可以忽略(在这里也卡了好久😭)\n\n![9](http://oldblog.shicishuzhai.com/9d534724207d6319fcf654142e91ba24.png)\n\n然后保存退出，重新启动sshd\n\n![10](http://oldblog.shicishuzhai.com/74d02be9217b7ea806af5970560ac956.png)\n\n### 第六步：修改指定服务器的ssh端口\n\n一般ssh访问默认的端口是22，但是搬运工VPS修改了ssh访问的端口，而Git访问还是用还是22端口，因此要修改Git使用ssh访问的端口(在这里也卡了好久😭)，要查看ssh端口可以在服务器的sshd_config文件中查看，如下：\n\n![11](http://oldblog.shicishuzhai.com/b2f7743ffae9917e88f0ace60e11637b.png)\n\n 如果不想修改服务器端口配置，可以修改客户端访问端口。在客户端的/~/.ssh/config文件中添加如下两行，第一行是服务器的地址，第二行是服务器的端口\n\n![12](http://oldblog.shicishuzhai.com/17e45daf40d28f1174387104a3daef40.png)\n\n这样就修改了访问指定服务器时的ssh端口。\n\n### 第七步：创建本地仓库\n\n经过以上六步，一个Git服务器就建立好了，现在你就可以把仓库clone下来，然后开始使用了。\n\n![13](http://oldblog.shicishuzhai.com/285c535aa2610ae916b1f964617a8d68.png)\n\n## 遇到的坑\n\n在整个搭建过程中，我也踩了很多坑，下面对这些坑做一个总结。\n\n### 服务器与客户端ssh端口不一致\n\n在完成创建证书之后，按理说，应该已经可以clone仓库了，但是我尝试克隆会报如下错误：\n\n![14](http://oldblog.shicishuzhai.com/e5bc21bbdb55bcdf473e6addf69cf495.png)\n\n网上找了很多方法，最后发现是因为客户端和服务器的ssh端口不一致导致，修改了客户端的ssh访问端口才解决了这个问题。\n\n相关参考：[修改了SSH默认端口之后，如何配置git？](http://zengrong.net/post/1544.htm)\n\n### ssh验证失败\n\n修改了ssh端口后，可以访问仓库了，但是每次访问都要输入密码，按理说我已经创建了证书，并且也把公钥放到了服务器，为什么还是不行呢？\n\n找了半天，发现服务器的RSA身份校验压根就没有开启，ssh在校验时是先使用RSA进行校验，如果校验失败再使用密码进行校验。修改sshd_config文件，打开身份校验，参照上面的第五步。\n\n打开身份校验之后，发现还是要输入密码。最初我的做法是关闭服务器的ssh密码校验，修改服务器/etc/ssh/sshd_config文件如下内容：\n\n```shell\nPasswordAuthentication no\n```\n\n![15](http://oldblog.shicishuzhai.com/fadd0406c6a9e9c02402e170082c82c7.png)\n\n然后重启sshd。\n\n这样修改了之后，由于禁止了密码验证的方式，而RSA验证又失败，所以压根验证失败，访问都访问不了了。\n\n![16](http://oldblog.shicishuzhai.com/2b0a4555687ea4fe8326f690ee35533e.png)\n\n然后我尝试看Log，输入命令：\n\n```shell\nssh git@xxx.xxx.xxx.xxx -vvv\n```\n\n从Log上看，客户端已经把key传给了服务器，但是服务器在验证时失败了，所以八成可能是服务器的问题。\n\n![20](http://oldblog.shicishuzhai.com/8ec00cb79352b30a2f95a1b48410cdfe.png)\n\n然后我又根据[这篇博客](http://www.androiddev.net/ssh-public-key-authentication-error/)修改了目录的权限，但是还是不行。\n\n根据[这篇博客](http://flysnowxf.iteye.com/blog/1567570)关闭了SELinux也还是不行。\n\n然后我又根据[这篇博客](http://blog.csdn.net/lansesl2008/article/details/16113193)打开了ssh的log，修改sshd_config如下内容：\n\n![17](http://oldblog.shicishuzhai.com/3dc7b3340f6b693b047ecbee93400564.png)\n\n然后又重新登录和退出几次ssh，在/var/log/secure里看到了如下内容：\n\n![18](http://oldblog.shicishuzhai.com/4f320784c4d9d731d53b3792856ec4dd.png)\n\n并没有什么有用的信息，不知道是不是我的Log配置的有问题。\n\n找了很多资料，有很多文章都提到了文件夹权限的问题，于是我又回到服务器git目录下看了一下文件夹的权限：\n\n![19](http://oldblog.shicishuzhai.com/c9be98241282c46c0111cb25e1be9aa4.png)\n\n原来我在创建.ssh目录是用的是root账户，所有造成ssh在进行身份认证时没有权限方位.ssh目录，导致认证失败。输入命令\n\n```shell\nchown git .ssh\n```\n\n将.ssh文件夹的所属用户改为git，.ssh里的authorized_keys文件也做相同的处理，这样改了之后终于可以验证成功了，并且不用输入密码了。\n\n## 总结\n\n整个搭建过程用了将近一天的时间，虽然过程有些曲折，但是最终还是成功了，而且这个过程中我也学到了不少的东西，更加深入的了解了ssh服务。\n\n希望这篇文章能对大家在搭建git服务器时有所帮助。\n\n## 参考资料\n\n[在CentOS下搭建自己的Git服务器](http://blog.csdn.net/wave_1102/article/details/47779401)\n[ssh无密码登录认证失败](http://blog.csdn.net/jacky0922/article/details/17999271)\n[sshd_config配置详解](http://blog.csdn.net/lansesl2008/article/details/16113193)\n[一个SSH 公钥登录失败的问题及解决经验](http://www.androiddev.net/ssh-public-key-authentication-error/)\n[Permission denied (publickey, gssapi-keyex,gssapi-with-mic,password)](http://www.linuxquestions.org/questions/linux-newbie-8/permission-denied-publickey-gssapi-keyex-gssapi-with-mic-password-4175413607/)\n[ssh使用公钥授权不通过的问题解决](http://flysnowxf.iteye.com/blog/1567570)\n[修改了SSH默认端口之后，如何配置git？](http://zengrong.net/post/1544.htm)\n","slug":"在VPS上搭建Git服务器","published":1,"updated":"2019-01-13T04:01:04.581Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjutyfmfl001yc4c98a7mwq8c","content":"<p>昨天尝试了在自己的VPS上搭建一个git服务器，中间踩了很多坑，下面是我整个搭建的过程。</p>\n<h2 id=\"具体流程\"><a href=\"#具体流程\" class=\"headerlink\" title=\"具体流程\"></a>具体流程</h2><h3 id=\"第一步：安装Git\"><a href=\"#第一步：安装Git\" class=\"headerlink\" title=\"第一步：安装Git\"></a>第一步：安装Git</h3><p>打开VPS(这里我用的是<a href=\"https://bandwagonhost.com/index.php\" target=\"_blank\" rel=\"noopener\">搬运工</a>，怎么购买VPS可以参考我的<a href=\"http://liujinlongxa.com/2016/06/11/%E6%89%93%E9%80%A0%E8%87%AA%E5%B7%B1%E7%9A%84%E7%BF%BB%E5%A2%99VPS:%E6%90%AC%E8%BF%90%E5%B7%A5VPS%E8%B4%AD%E4%B9%B0%E4%BD%BF%E7%94%A8%E6%B5%81%E7%A8%8B%E5%85%A8%E8%AE%B0%E5%BD%95/\">这篇博客</a>)的控制后台，进入Shell，然后输入命令：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install -y git</span><br></pre></td></tr></table></figure>\n<p>执行完后如图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/b9dd798ab599b9b53adebee98ebe5bbd.png\" alt=\"2\"></p>\n<p>查看Git版本，如果能显示Git版本，则说明安装成功。</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/d7cdff1b7006e2c9b5f1e521319d903c.png\" alt=\"3\"></p>\n<h3 id=\"第二步：添加用户\"><a href=\"#第二步：添加用户\" class=\"headerlink\" title=\"第二步：添加用户\"></a>第二步：添加用户</h3><p>输入命令</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">adduser git</span><br><span class=\"line\">su git</span><br></pre></td></tr></table></figure>\n<p>添加一个名为git的用户，并且将当前用户切换到git</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/c5350088190cd59d220b4942b9d87eae.png\" alt=\"4\"></p>\n<h3 id=\"第三步：创建仓库\"><a href=\"#第三步：创建仓库\" class=\"headerlink\" title=\"第三步：创建仓库\"></a>第三步：创建仓库</h3><p>创建一个文件夹用来存放git仓库，然后输入命令</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git init --bare mycode.git</span><br></pre></td></tr></table></figure>\n<p>这样就可以创建一个裸仓库，因为服务器上的Git仓库纯粹是为了共享，所以不让用户直接登录到服务器上去改工作区，如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/c58f27e2d859d984c844371a43a37ab8.png\" alt=\"5\"></p>\n<p>把服务器的git仓库的用户组改为git</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/26a614c08121e4b0f8783551208e2d19.png\" alt=\"6\"></p>\n<p>这样仓库就创建完了</p>\n<h3 id=\"第四步：创建证书\"><a href=\"#第四步：创建证书\" class=\"headerlink\" title=\"第四步：创建证书\"></a>第四步：创建证书</h3><p>在服务器/homg/git目录下创建文件夹.ssh，然后在.ssh文件夹里创建authorized_keys</p>\n<p><strong> 注意：一定要切换到git用户下再创建，否则使用root用户创建，会因为文件夹权限的问题而造成RSA校验失败，我就是在这里卡了半天 </strong></p>\n<p>然后在客户端创建公钥，即~/.ssh/id_rsa.pub文件里的内容，然后把公钥填入服务器的authorized_keys文件中</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/9eca6530c312dc064c8901735ef9942e.png\" alt=\"7\"></p>\n<p><img src=\"http://oldblog.shicishuzhai.com/7c38fa2c806440f162b83208038a8dc9.png\" alt=\"8\"></p>\n<h3 id=\"第五步：打开服务器RSA验证\"><a href=\"#第五步：打开服务器RSA验证\" class=\"headerlink\" title=\"第五步：打开服务器RSA验证\"></a>第五步：打开服务器RSA验证</h3><p>进入服务器/etc/ssh目录，使用vim打开sshd_config（建议先做一个备份），修改如下内容</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">RSAAuthentication yes     </span><br><span class=\"line\">PubkeyAuthentication yes     </span><br><span class=\"line\">AuthorizedKeysFile  .ssh/authorized_keys</span><br></pre></td></tr></table></figure>\n<p>大部分Linux系统的RSA认证默认就是开启的，如果已经开启，则可以忽略(在这里也卡了好久😭)</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/9d534724207d6319fcf654142e91ba24.png\" alt=\"9\"></p>\n<p>然后保存退出，重新启动sshd</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/74d02be9217b7ea806af5970560ac956.png\" alt=\"10\"></p>\n<h3 id=\"第六步：修改指定服务器的ssh端口\"><a href=\"#第六步：修改指定服务器的ssh端口\" class=\"headerlink\" title=\"第六步：修改指定服务器的ssh端口\"></a>第六步：修改指定服务器的ssh端口</h3><p>一般ssh访问默认的端口是22，但是搬运工VPS修改了ssh访问的端口，而Git访问还是用还是22端口，因此要修改Git使用ssh访问的端口(在这里也卡了好久😭)，要查看ssh端口可以在服务器的sshd_config文件中查看，如下：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/b2f7743ffae9917e88f0ace60e11637b.png\" alt=\"11\"></p>\n<p> 如果不想修改服务器端口配置，可以修改客户端访问端口。在客户端的/~/.ssh/config文件中添加如下两行，第一行是服务器的地址，第二行是服务器的端口</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/17e45daf40d28f1174387104a3daef40.png\" alt=\"12\"></p>\n<p>这样就修改了访问指定服务器时的ssh端口。</p>\n<h3 id=\"第七步：创建本地仓库\"><a href=\"#第七步：创建本地仓库\" class=\"headerlink\" title=\"第七步：创建本地仓库\"></a>第七步：创建本地仓库</h3><p>经过以上六步，一个Git服务器就建立好了，现在你就可以把仓库clone下来，然后开始使用了。</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/285c535aa2610ae916b1f964617a8d68.png\" alt=\"13\"></p>\n<h2 id=\"遇到的坑\"><a href=\"#遇到的坑\" class=\"headerlink\" title=\"遇到的坑\"></a>遇到的坑</h2><p>在整个搭建过程中，我也踩了很多坑，下面对这些坑做一个总结。</p>\n<h3 id=\"服务器与客户端ssh端口不一致\"><a href=\"#服务器与客户端ssh端口不一致\" class=\"headerlink\" title=\"服务器与客户端ssh端口不一致\"></a>服务器与客户端ssh端口不一致</h3><p>在完成创建证书之后，按理说，应该已经可以clone仓库了，但是我尝试克隆会报如下错误：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/e5bc21bbdb55bcdf473e6addf69cf495.png\" alt=\"14\"></p>\n<p>网上找了很多方法，最后发现是因为客户端和服务器的ssh端口不一致导致，修改了客户端的ssh访问端口才解决了这个问题。</p>\n<p>相关参考：<a href=\"http://zengrong.net/post/1544.htm\" target=\"_blank\" rel=\"noopener\">修改了SSH默认端口之后，如何配置git？</a></p>\n<h3 id=\"ssh验证失败\"><a href=\"#ssh验证失败\" class=\"headerlink\" title=\"ssh验证失败\"></a>ssh验证失败</h3><p>修改了ssh端口后，可以访问仓库了，但是每次访问都要输入密码，按理说我已经创建了证书，并且也把公钥放到了服务器，为什么还是不行呢？</p>\n<p>找了半天，发现服务器的RSA身份校验压根就没有开启，ssh在校验时是先使用RSA进行校验，如果校验失败再使用密码进行校验。修改sshd_config文件，打开身份校验，参照上面的第五步。</p>\n<p>打开身份校验之后，发现还是要输入密码。最初我的做法是关闭服务器的ssh密码校验，修改服务器/etc/ssh/sshd_config文件如下内容：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PasswordAuthentication no</span><br></pre></td></tr></table></figure>\n<p><img src=\"http://oldblog.shicishuzhai.com/fadd0406c6a9e9c02402e170082c82c7.png\" alt=\"15\"></p>\n<p>然后重启sshd。</p>\n<p>这样修改了之后，由于禁止了密码验证的方式，而RSA验证又失败，所以压根验证失败，访问都访问不了了。</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/2b0a4555687ea4fe8326f690ee35533e.png\" alt=\"16\"></p>\n<p>然后我尝试看Log，输入命令：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh git@xxx.xxx.xxx.xxx -vvv</span><br></pre></td></tr></table></figure>\n<p>从Log上看，客户端已经把key传给了服务器，但是服务器在验证时失败了，所以八成可能是服务器的问题。</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/8ec00cb79352b30a2f95a1b48410cdfe.png\" alt=\"20\"></p>\n<p>然后我又根据<a href=\"http://www.androiddev.net/ssh-public-key-authentication-error/\" target=\"_blank\" rel=\"noopener\">这篇博客</a>修改了目录的权限，但是还是不行。</p>\n<p>根据<a href=\"http://flysnowxf.iteye.com/blog/1567570\" target=\"_blank\" rel=\"noopener\">这篇博客</a>关闭了SELinux也还是不行。</p>\n<p>然后我又根据<a href=\"http://blog.csdn.net/lansesl2008/article/details/16113193\" target=\"_blank\" rel=\"noopener\">这篇博客</a>打开了ssh的log，修改sshd_config如下内容：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/3dc7b3340f6b693b047ecbee93400564.png\" alt=\"17\"></p>\n<p>然后又重新登录和退出几次ssh，在/var/log/secure里看到了如下内容：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/4f320784c4d9d731d53b3792856ec4dd.png\" alt=\"18\"></p>\n<p>并没有什么有用的信息，不知道是不是我的Log配置的有问题。</p>\n<p>找了很多资料，有很多文章都提到了文件夹权限的问题，于是我又回到服务器git目录下看了一下文件夹的权限：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/c9be98241282c46c0111cb25e1be9aa4.png\" alt=\"19\"></p>\n<p>原来我在创建.ssh目录是用的是root账户，所有造成ssh在进行身份认证时没有权限方位.ssh目录，导致认证失败。输入命令</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chown git .ssh</span><br></pre></td></tr></table></figure>\n<p>将.ssh文件夹的所属用户改为git，.ssh里的authorized_keys文件也做相同的处理，这样改了之后终于可以验证成功了，并且不用输入密码了。</p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>整个搭建过程用了将近一天的时间，虽然过程有些曲折，但是最终还是成功了，而且这个过程中我也学到了不少的东西，更加深入的了解了ssh服务。</p>\n<p>希望这篇文章能对大家在搭建git服务器时有所帮助。</p>\n<h2 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h2><p><a href=\"http://blog.csdn.net/wave_1102/article/details/47779401\" target=\"_blank\" rel=\"noopener\">在CentOS下搭建自己的Git服务器</a><br><a href=\"http://blog.csdn.net/jacky0922/article/details/17999271\" target=\"_blank\" rel=\"noopener\">ssh无密码登录认证失败</a><br><a href=\"http://blog.csdn.net/lansesl2008/article/details/16113193\" target=\"_blank\" rel=\"noopener\">sshd_config配置详解</a><br><a href=\"http://www.androiddev.net/ssh-public-key-authentication-error/\" target=\"_blank\" rel=\"noopener\">一个SSH 公钥登录失败的问题及解决经验</a><br><a href=\"http://www.linuxquestions.org/questions/linux-newbie-8/permission-denied-publickey-gssapi-keyex-gssapi-with-mic-password-4175413607/\" target=\"_blank\" rel=\"noopener\">Permission denied (publickey, gssapi-keyex,gssapi-with-mic,password)</a><br><a href=\"http://flysnowxf.iteye.com/blog/1567570\" target=\"_blank\" rel=\"noopener\">ssh使用公钥授权不通过的问题解决</a><br><a href=\"http://zengrong.net/post/1544.htm\" target=\"_blank\" rel=\"noopener\">修改了SSH默认端口之后，如何配置git？</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>昨天尝试了在自己的VPS上搭建一个git服务器，中间踩了很多坑，下面是我整个搭建的过程。</p>\n<h2 id=\"具体流程\"><a href=\"#具体流程\" class=\"headerlink\" title=\"具体流程\"></a>具体流程</h2><h3 id=\"第一步：安装Git\"><a href=\"#第一步：安装Git\" class=\"headerlink\" title=\"第一步：安装Git\"></a>第一步：安装Git</h3><p>打开VPS(这里我用的是<a href=\"https://bandwagonhost.com/index.php\" target=\"_blank\" rel=\"noopener\">搬运工</a>，怎么购买VPS可以参考我的<a href=\"http://liujinlongxa.com/2016/06/11/%E6%89%93%E9%80%A0%E8%87%AA%E5%B7%B1%E7%9A%84%E7%BF%BB%E5%A2%99VPS:%E6%90%AC%E8%BF%90%E5%B7%A5VPS%E8%B4%AD%E4%B9%B0%E4%BD%BF%E7%94%A8%E6%B5%81%E7%A8%8B%E5%85%A8%E8%AE%B0%E5%BD%95/\">这篇博客</a>)的控制后台，进入Shell，然后输入命令：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install -y git</span><br></pre></td></tr></table></figure>\n<p>执行完后如图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/b9dd798ab599b9b53adebee98ebe5bbd.png\" alt=\"2\"></p>\n<p>查看Git版本，如果能显示Git版本，则说明安装成功。</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/d7cdff1b7006e2c9b5f1e521319d903c.png\" alt=\"3\"></p>\n<h3 id=\"第二步：添加用户\"><a href=\"#第二步：添加用户\" class=\"headerlink\" title=\"第二步：添加用户\"></a>第二步：添加用户</h3><p>输入命令</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">adduser git</span><br><span class=\"line\">su git</span><br></pre></td></tr></table></figure>\n<p>添加一个名为git的用户，并且将当前用户切换到git</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/c5350088190cd59d220b4942b9d87eae.png\" alt=\"4\"></p>\n<h3 id=\"第三步：创建仓库\"><a href=\"#第三步：创建仓库\" class=\"headerlink\" title=\"第三步：创建仓库\"></a>第三步：创建仓库</h3><p>创建一个文件夹用来存放git仓库，然后输入命令</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git init --bare mycode.git</span><br></pre></td></tr></table></figure>\n<p>这样就可以创建一个裸仓库，因为服务器上的Git仓库纯粹是为了共享，所以不让用户直接登录到服务器上去改工作区，如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/c58f27e2d859d984c844371a43a37ab8.png\" alt=\"5\"></p>\n<p>把服务器的git仓库的用户组改为git</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/26a614c08121e4b0f8783551208e2d19.png\" alt=\"6\"></p>\n<p>这样仓库就创建完了</p>\n<h3 id=\"第四步：创建证书\"><a href=\"#第四步：创建证书\" class=\"headerlink\" title=\"第四步：创建证书\"></a>第四步：创建证书</h3><p>在服务器/homg/git目录下创建文件夹.ssh，然后在.ssh文件夹里创建authorized_keys</p>\n<p><strong> 注意：一定要切换到git用户下再创建，否则使用root用户创建，会因为文件夹权限的问题而造成RSA校验失败，我就是在这里卡了半天 </strong></p>\n<p>然后在客户端创建公钥，即~/.ssh/id_rsa.pub文件里的内容，然后把公钥填入服务器的authorized_keys文件中</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/9eca6530c312dc064c8901735ef9942e.png\" alt=\"7\"></p>\n<p><img src=\"http://oldblog.shicishuzhai.com/7c38fa2c806440f162b83208038a8dc9.png\" alt=\"8\"></p>\n<h3 id=\"第五步：打开服务器RSA验证\"><a href=\"#第五步：打开服务器RSA验证\" class=\"headerlink\" title=\"第五步：打开服务器RSA验证\"></a>第五步：打开服务器RSA验证</h3><p>进入服务器/etc/ssh目录，使用vim打开sshd_config（建议先做一个备份），修改如下内容</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">RSAAuthentication yes     </span><br><span class=\"line\">PubkeyAuthentication yes     </span><br><span class=\"line\">AuthorizedKeysFile  .ssh/authorized_keys</span><br></pre></td></tr></table></figure>\n<p>大部分Linux系统的RSA认证默认就是开启的，如果已经开启，则可以忽略(在这里也卡了好久😭)</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/9d534724207d6319fcf654142e91ba24.png\" alt=\"9\"></p>\n<p>然后保存退出，重新启动sshd</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/74d02be9217b7ea806af5970560ac956.png\" alt=\"10\"></p>\n<h3 id=\"第六步：修改指定服务器的ssh端口\"><a href=\"#第六步：修改指定服务器的ssh端口\" class=\"headerlink\" title=\"第六步：修改指定服务器的ssh端口\"></a>第六步：修改指定服务器的ssh端口</h3><p>一般ssh访问默认的端口是22，但是搬运工VPS修改了ssh访问的端口，而Git访问还是用还是22端口，因此要修改Git使用ssh访问的端口(在这里也卡了好久😭)，要查看ssh端口可以在服务器的sshd_config文件中查看，如下：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/b2f7743ffae9917e88f0ace60e11637b.png\" alt=\"11\"></p>\n<p> 如果不想修改服务器端口配置，可以修改客户端访问端口。在客户端的/~/.ssh/config文件中添加如下两行，第一行是服务器的地址，第二行是服务器的端口</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/17e45daf40d28f1174387104a3daef40.png\" alt=\"12\"></p>\n<p>这样就修改了访问指定服务器时的ssh端口。</p>\n<h3 id=\"第七步：创建本地仓库\"><a href=\"#第七步：创建本地仓库\" class=\"headerlink\" title=\"第七步：创建本地仓库\"></a>第七步：创建本地仓库</h3><p>经过以上六步，一个Git服务器就建立好了，现在你就可以把仓库clone下来，然后开始使用了。</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/285c535aa2610ae916b1f964617a8d68.png\" alt=\"13\"></p>\n<h2 id=\"遇到的坑\"><a href=\"#遇到的坑\" class=\"headerlink\" title=\"遇到的坑\"></a>遇到的坑</h2><p>在整个搭建过程中，我也踩了很多坑，下面对这些坑做一个总结。</p>\n<h3 id=\"服务器与客户端ssh端口不一致\"><a href=\"#服务器与客户端ssh端口不一致\" class=\"headerlink\" title=\"服务器与客户端ssh端口不一致\"></a>服务器与客户端ssh端口不一致</h3><p>在完成创建证书之后，按理说，应该已经可以clone仓库了，但是我尝试克隆会报如下错误：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/e5bc21bbdb55bcdf473e6addf69cf495.png\" alt=\"14\"></p>\n<p>网上找了很多方法，最后发现是因为客户端和服务器的ssh端口不一致导致，修改了客户端的ssh访问端口才解决了这个问题。</p>\n<p>相关参考：<a href=\"http://zengrong.net/post/1544.htm\" target=\"_blank\" rel=\"noopener\">修改了SSH默认端口之后，如何配置git？</a></p>\n<h3 id=\"ssh验证失败\"><a href=\"#ssh验证失败\" class=\"headerlink\" title=\"ssh验证失败\"></a>ssh验证失败</h3><p>修改了ssh端口后，可以访问仓库了，但是每次访问都要输入密码，按理说我已经创建了证书，并且也把公钥放到了服务器，为什么还是不行呢？</p>\n<p>找了半天，发现服务器的RSA身份校验压根就没有开启，ssh在校验时是先使用RSA进行校验，如果校验失败再使用密码进行校验。修改sshd_config文件，打开身份校验，参照上面的第五步。</p>\n<p>打开身份校验之后，发现还是要输入密码。最初我的做法是关闭服务器的ssh密码校验，修改服务器/etc/ssh/sshd_config文件如下内容：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PasswordAuthentication no</span><br></pre></td></tr></table></figure>\n<p><img src=\"http://oldblog.shicishuzhai.com/fadd0406c6a9e9c02402e170082c82c7.png\" alt=\"15\"></p>\n<p>然后重启sshd。</p>\n<p>这样修改了之后，由于禁止了密码验证的方式，而RSA验证又失败，所以压根验证失败，访问都访问不了了。</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/2b0a4555687ea4fe8326f690ee35533e.png\" alt=\"16\"></p>\n<p>然后我尝试看Log，输入命令：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh git@xxx.xxx.xxx.xxx -vvv</span><br></pre></td></tr></table></figure>\n<p>从Log上看，客户端已经把key传给了服务器，但是服务器在验证时失败了，所以八成可能是服务器的问题。</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/8ec00cb79352b30a2f95a1b48410cdfe.png\" alt=\"20\"></p>\n<p>然后我又根据<a href=\"http://www.androiddev.net/ssh-public-key-authentication-error/\" target=\"_blank\" rel=\"noopener\">这篇博客</a>修改了目录的权限，但是还是不行。</p>\n<p>根据<a href=\"http://flysnowxf.iteye.com/blog/1567570\" target=\"_blank\" rel=\"noopener\">这篇博客</a>关闭了SELinux也还是不行。</p>\n<p>然后我又根据<a href=\"http://blog.csdn.net/lansesl2008/article/details/16113193\" target=\"_blank\" rel=\"noopener\">这篇博客</a>打开了ssh的log，修改sshd_config如下内容：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/3dc7b3340f6b693b047ecbee93400564.png\" alt=\"17\"></p>\n<p>然后又重新登录和退出几次ssh，在/var/log/secure里看到了如下内容：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/4f320784c4d9d731d53b3792856ec4dd.png\" alt=\"18\"></p>\n<p>并没有什么有用的信息，不知道是不是我的Log配置的有问题。</p>\n<p>找了很多资料，有很多文章都提到了文件夹权限的问题，于是我又回到服务器git目录下看了一下文件夹的权限：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/c9be98241282c46c0111cb25e1be9aa4.png\" alt=\"19\"></p>\n<p>原来我在创建.ssh目录是用的是root账户，所有造成ssh在进行身份认证时没有权限方位.ssh目录，导致认证失败。输入命令</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chown git .ssh</span><br></pre></td></tr></table></figure>\n<p>将.ssh文件夹的所属用户改为git，.ssh里的authorized_keys文件也做相同的处理，这样改了之后终于可以验证成功了，并且不用输入密码了。</p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>整个搭建过程用了将近一天的时间，虽然过程有些曲折，但是最终还是成功了，而且这个过程中我也学到了不少的东西，更加深入的了解了ssh服务。</p>\n<p>希望这篇文章能对大家在搭建git服务器时有所帮助。</p>\n<h2 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h2><p><a href=\"http://blog.csdn.net/wave_1102/article/details/47779401\" target=\"_blank\" rel=\"noopener\">在CentOS下搭建自己的Git服务器</a><br><a href=\"http://blog.csdn.net/jacky0922/article/details/17999271\" target=\"_blank\" rel=\"noopener\">ssh无密码登录认证失败</a><br><a href=\"http://blog.csdn.net/lansesl2008/article/details/16113193\" target=\"_blank\" rel=\"noopener\">sshd_config配置详解</a><br><a href=\"http://www.androiddev.net/ssh-public-key-authentication-error/\" target=\"_blank\" rel=\"noopener\">一个SSH 公钥登录失败的问题及解决经验</a><br><a href=\"http://www.linuxquestions.org/questions/linux-newbie-8/permission-denied-publickey-gssapi-keyex-gssapi-with-mic-password-4175413607/\" target=\"_blank\" rel=\"noopener\">Permission denied (publickey, gssapi-keyex,gssapi-with-mic,password)</a><br><a href=\"http://flysnowxf.iteye.com/blog/1567570\" target=\"_blank\" rel=\"noopener\">ssh使用公钥授权不通过的问题解决</a><br><a href=\"http://zengrong.net/post/1544.htm\" target=\"_blank\" rel=\"noopener\">修改了SSH默认端口之后，如何配置git？</a></p>\n"},{"title":"深入理解CoreAnimation的fillMode和isRemovedOnCompletion","date":"2016-07-10T06:34:06.000Z","_content":"\n一般在使用CoreAnimation写动画是，在定义CAAnimation时，都要加入如下两句来防止动画完成后视图的位置又还原成了原来的位置。\n\n```swift\nanimation.fillMode = kCAFillModeBoth\nanimation.isRemovedOnCompletion = false\n```\n\n很少有文章能详细说明这两个属性的作用，今天我们就来深究一下这两个属性。\n\n## fillMode\n\nfillMode是一个枚举值，用于表示动画在开始和结束时的状态，这样说可能不太好理解，直接看例子比较直观。\n\n### kCAFillModeRemoved\n\n这个是fillMode的默认值，表示在到达beginTime时才显示动画的第一帧，动画结束时，删除CALayer做的变化\n\n实例代码：\n\n```swift\noverride func touchesBegan(touches: Set<UITouch>, withEvent event: UIEvent?) {\n    let move = CABasicAnimation(keyPath: \"position.y\")\n    move.fromValue = 100\n    move.toValue = 500\n    move.duration = 1.0\n    move.beginTime = CACurrentMediaTime() + 2.0\n    move.fillMode = kCAFillModeRemoved\n    self.myView.layer.add(move, forKey: nil)\n}\n```\n\n代码中，我们将一个View的y坐标从100移动到500，历时1s，注意开始时间我设定为了`CACurrentMediaTime() + 2.0`，即添加动画2s后才开始执行动画，这样才能看到效果。运行结果如下：\n\n![kCAFillModeRemoved](http://oldblog.shicishuzhai.com/kCAFillModeRemoved.gif)\n\n可以看到，在鼠标点击触发后，2s之后myView才移动到了动画的初始位置100开始执行动画，并且在动画结束后视图又立刻恢复到原来的位置。\n\n### kCAFillModeBackwards\n\n这个值表示无论是否到达beginTime，动画开始后，立刻显示动画的第一帧，修改代码如下：\n\n```swift\noverride func touchesBegan(touches: Set<UITouch>, withEvent event: UIEvent?) {\n    let move = CABasicAnimation(keyPath: \"position.y\")\n    move.fromValue = 100\n    move.toValue = 500\n    move.duration = 1.0\n    move.beginTime = CACurrentMediaTime() + 2.0\n    move.fillMode = kCAFillModeBackwards\n    self.myView.layer.add(move, forKey: nil)\n}\n```\n\n运行效果如下：\n\n![kCAFillModeBackwards](http://oldblog.shicishuzhai.com/kCAFillModeBackwards.gif)\n\n可以看到，鼠标点击后，myView立刻移动到了动画的初始位置100，然后2s后开始执行动画。\n\n### kCAFillModeForwards\n\n这个值表示在到达beginTime时显示动画的第一帧，在动画结束时，保持动画最后一帧的状态，直到动画被删除，修改代码如下：\n\n```swift\noverride func touchesBegan(_ touches: Set<UITouch>, with event: UIEvent?) {\n    let move = CABasicAnimation(keyPath: \"position.y\")\n    move.fromValue = 100\n    move.toValue = 500\n    move.duration = 1.0\n    move.beginTime = CACurrentMediaTime() + 2.0\n    move.fillMode = kCAFillModeForwards;\n    move.isRemovedOnCompletion = false\n    move.delegate = self;\n    self.myView.layer.add(move, forKey: nil)\n}\n\noverride func animationDidStop(_ anim: CAAnimation, finished flag: Bool) {\n    DispatchQueue.main.after(when: .now() + 3) {\n        self.myView.layer.removeAllAnimations()\n    }\n}\n```\n\n代码中添加了`move.isRemovedOnCompletion = false`，即动画执行完后不立刻删除动画，默认情况下，动画执行完后会立刻删除动画。`isRemovedOnCompletion`属性设置为false后，就不会立刻删除。然后我们还添加了`animationDidStop`方法，这个是`CABasicAnimation`的代理方法，在动画执行结束时会被调用。我们在这个方法里延时3s删除动画。运行效果如下：\n\n![kCAFillModeForwards](http://oldblog.shicishuzhai.com/kCAFillModeForwards.gif)\n\n可以看到，鼠标点击后，myView等了2s才移动到动画初始位置，动画结束后，等待了3s，myView才恢复到原来的位置。也就是动画结束后会保持最后一帧的状态，直到动画被删除掉。\n\n### kCAFillModeBoth\n\n这个值相当于kCAFillModeBackwards与kCAFillModeForwards的共同合集，即无论是否到达beginTime，动画开始后，立刻显示动画的第一帧，并且在动画结束时保持最后一帧的状态，直到动画被删除。修改代码如下：\n\n```swift\noverride func touchesBegan(_ touches: Set<UITouch>, with event: UIEvent?) {\n    let move = CABasicAnimation(keyPath: \"position.y\")\n    move.fromValue = 100\n    move.toValue = 500\n    move.duration = 1.0\n    move.beginTime = CACurrentMediaTime() + 2.0\n    move.fillMode = kCAFillModeBoth;\n    move.isRemovedOnCompletion = false\n    move.delegate = self;\n    self.myView.layer.add(move, forKey: nil)\n}\n\noverride func animationDidStop(_ anim: CAAnimation, finished flag: Bool) {\n    DispatchQueue.main.after(when: .now() + 3) {\n        self.myView.layer.removeAllAnimations()\n    }\n}\n```\n\n运行效果如下：\n\n![kCAFillModeBoth](http://oldblog.shicishuzhai.com/kCAFillModeBoth.gif)\n\n可以看到，鼠标点击后，myView立刻移动到了动画的初始位置，然后动画结束后，等待了3s，myView才恢复到原来的位置。\n\n## 更进一步的思考\n\n以上就是我对fillMode的一个探究，下面再回到文章开头的那段代码\n\n```swift\nanimation.fillMode = kCAFillModeBoth\nanimation.isRemovedOnCompletion = false\n```\n\n这时，就很明白了，设置fillMode为`kCAFillModeBoth`，可以使视图在动画结束时，仍然停留在动画结束的位置，直到动画被删除。设置`isRemovedOnCompletion`为false，可以使动画在结束后不被删除，这样视图就会永远停留在动画结束的位置。\n\n乍一看没什么问题，但仔细想想还是觉得有点奇怪，动画已经结束了为什么不删除，还占着内存。如果动画少还好，如果动画非常多，每个动画执行完了都不删除的话，那内存岂不是会爆掉，这是不能接受的。有没有办法能够既让视图停留在动画结束的位置，又能在动画结束后删除动画呢？\n\n当然有，直接上代码：\n\n```swift\noverride func touchesBegan(_ touches: Set<UITouch>, with event: UIEvent?) {\n    let move = CABasicAnimation(keyPath: \"position.y\")\n    move.fromValue = 100\n    move.toValue = 500\n    move.duration = 1.0\n    move.beginTime = CACurrentMediaTime() + 2.0\n    move.fillMode = kCAFillModeBoth;\n    move.delegate = self;\n    self.myView.layer.add(move, forKey: nil)\n\n    self.myView.layer.position.y = 500\n}\n```\n\n解决方法就是在视图添加动画后，手动修改视图的位置为动画结束后的最终位置，这样动画结束后，动画就会被删除并且视图会停留在动画结束时的位置。\n\n注意：这里应该使用layer的position，不能直接修改UIView的frame，否则动画效果会不正确。\n\n## 参考资料\n\n[iOS Animations by Tutorials](https://www.raywenderlich.com/store/ios-animations-by-tutorials)\n","source":"_posts/2016-07-10-深入理解CoreAnimation的fillMode和isRemovedOnCompletion.md","raw":"---\ntitle: 深入理解CoreAnimation的fillMode和isRemovedOnCompletion\ncategories: iOS开发\ntags:\n  - CoreAnimation\ndate: 2016-07-10 14:34:06\n---\n\n一般在使用CoreAnimation写动画是，在定义CAAnimation时，都要加入如下两句来防止动画完成后视图的位置又还原成了原来的位置。\n\n```swift\nanimation.fillMode = kCAFillModeBoth\nanimation.isRemovedOnCompletion = false\n```\n\n很少有文章能详细说明这两个属性的作用，今天我们就来深究一下这两个属性。\n\n## fillMode\n\nfillMode是一个枚举值，用于表示动画在开始和结束时的状态，这样说可能不太好理解，直接看例子比较直观。\n\n### kCAFillModeRemoved\n\n这个是fillMode的默认值，表示在到达beginTime时才显示动画的第一帧，动画结束时，删除CALayer做的变化\n\n实例代码：\n\n```swift\noverride func touchesBegan(touches: Set<UITouch>, withEvent event: UIEvent?) {\n    let move = CABasicAnimation(keyPath: \"position.y\")\n    move.fromValue = 100\n    move.toValue = 500\n    move.duration = 1.0\n    move.beginTime = CACurrentMediaTime() + 2.0\n    move.fillMode = kCAFillModeRemoved\n    self.myView.layer.add(move, forKey: nil)\n}\n```\n\n代码中，我们将一个View的y坐标从100移动到500，历时1s，注意开始时间我设定为了`CACurrentMediaTime() + 2.0`，即添加动画2s后才开始执行动画，这样才能看到效果。运行结果如下：\n\n![kCAFillModeRemoved](http://oldblog.shicishuzhai.com/kCAFillModeRemoved.gif)\n\n可以看到，在鼠标点击触发后，2s之后myView才移动到了动画的初始位置100开始执行动画，并且在动画结束后视图又立刻恢复到原来的位置。\n\n### kCAFillModeBackwards\n\n这个值表示无论是否到达beginTime，动画开始后，立刻显示动画的第一帧，修改代码如下：\n\n```swift\noverride func touchesBegan(touches: Set<UITouch>, withEvent event: UIEvent?) {\n    let move = CABasicAnimation(keyPath: \"position.y\")\n    move.fromValue = 100\n    move.toValue = 500\n    move.duration = 1.0\n    move.beginTime = CACurrentMediaTime() + 2.0\n    move.fillMode = kCAFillModeBackwards\n    self.myView.layer.add(move, forKey: nil)\n}\n```\n\n运行效果如下：\n\n![kCAFillModeBackwards](http://oldblog.shicishuzhai.com/kCAFillModeBackwards.gif)\n\n可以看到，鼠标点击后，myView立刻移动到了动画的初始位置100，然后2s后开始执行动画。\n\n### kCAFillModeForwards\n\n这个值表示在到达beginTime时显示动画的第一帧，在动画结束时，保持动画最后一帧的状态，直到动画被删除，修改代码如下：\n\n```swift\noverride func touchesBegan(_ touches: Set<UITouch>, with event: UIEvent?) {\n    let move = CABasicAnimation(keyPath: \"position.y\")\n    move.fromValue = 100\n    move.toValue = 500\n    move.duration = 1.0\n    move.beginTime = CACurrentMediaTime() + 2.0\n    move.fillMode = kCAFillModeForwards;\n    move.isRemovedOnCompletion = false\n    move.delegate = self;\n    self.myView.layer.add(move, forKey: nil)\n}\n\noverride func animationDidStop(_ anim: CAAnimation, finished flag: Bool) {\n    DispatchQueue.main.after(when: .now() + 3) {\n        self.myView.layer.removeAllAnimations()\n    }\n}\n```\n\n代码中添加了`move.isRemovedOnCompletion = false`，即动画执行完后不立刻删除动画，默认情况下，动画执行完后会立刻删除动画。`isRemovedOnCompletion`属性设置为false后，就不会立刻删除。然后我们还添加了`animationDidStop`方法，这个是`CABasicAnimation`的代理方法，在动画执行结束时会被调用。我们在这个方法里延时3s删除动画。运行效果如下：\n\n![kCAFillModeForwards](http://oldblog.shicishuzhai.com/kCAFillModeForwards.gif)\n\n可以看到，鼠标点击后，myView等了2s才移动到动画初始位置，动画结束后，等待了3s，myView才恢复到原来的位置。也就是动画结束后会保持最后一帧的状态，直到动画被删除掉。\n\n### kCAFillModeBoth\n\n这个值相当于kCAFillModeBackwards与kCAFillModeForwards的共同合集，即无论是否到达beginTime，动画开始后，立刻显示动画的第一帧，并且在动画结束时保持最后一帧的状态，直到动画被删除。修改代码如下：\n\n```swift\noverride func touchesBegan(_ touches: Set<UITouch>, with event: UIEvent?) {\n    let move = CABasicAnimation(keyPath: \"position.y\")\n    move.fromValue = 100\n    move.toValue = 500\n    move.duration = 1.0\n    move.beginTime = CACurrentMediaTime() + 2.0\n    move.fillMode = kCAFillModeBoth;\n    move.isRemovedOnCompletion = false\n    move.delegate = self;\n    self.myView.layer.add(move, forKey: nil)\n}\n\noverride func animationDidStop(_ anim: CAAnimation, finished flag: Bool) {\n    DispatchQueue.main.after(when: .now() + 3) {\n        self.myView.layer.removeAllAnimations()\n    }\n}\n```\n\n运行效果如下：\n\n![kCAFillModeBoth](http://oldblog.shicishuzhai.com/kCAFillModeBoth.gif)\n\n可以看到，鼠标点击后，myView立刻移动到了动画的初始位置，然后动画结束后，等待了3s，myView才恢复到原来的位置。\n\n## 更进一步的思考\n\n以上就是我对fillMode的一个探究，下面再回到文章开头的那段代码\n\n```swift\nanimation.fillMode = kCAFillModeBoth\nanimation.isRemovedOnCompletion = false\n```\n\n这时，就很明白了，设置fillMode为`kCAFillModeBoth`，可以使视图在动画结束时，仍然停留在动画结束的位置，直到动画被删除。设置`isRemovedOnCompletion`为false，可以使动画在结束后不被删除，这样视图就会永远停留在动画结束的位置。\n\n乍一看没什么问题，但仔细想想还是觉得有点奇怪，动画已经结束了为什么不删除，还占着内存。如果动画少还好，如果动画非常多，每个动画执行完了都不删除的话，那内存岂不是会爆掉，这是不能接受的。有没有办法能够既让视图停留在动画结束的位置，又能在动画结束后删除动画呢？\n\n当然有，直接上代码：\n\n```swift\noverride func touchesBegan(_ touches: Set<UITouch>, with event: UIEvent?) {\n    let move = CABasicAnimation(keyPath: \"position.y\")\n    move.fromValue = 100\n    move.toValue = 500\n    move.duration = 1.0\n    move.beginTime = CACurrentMediaTime() + 2.0\n    move.fillMode = kCAFillModeBoth;\n    move.delegate = self;\n    self.myView.layer.add(move, forKey: nil)\n\n    self.myView.layer.position.y = 500\n}\n```\n\n解决方法就是在视图添加动画后，手动修改视图的位置为动画结束后的最终位置，这样动画结束后，动画就会被删除并且视图会停留在动画结束时的位置。\n\n注意：这里应该使用layer的position，不能直接修改UIView的frame，否则动画效果会不正确。\n\n## 参考资料\n\n[iOS Animations by Tutorials](https://www.raywenderlich.com/store/ios-animations-by-tutorials)\n","slug":"深入理解CoreAnimation的fillMode和isRemovedOnCompletion","published":1,"updated":"2019-01-13T04:01:04.441Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjutyfmfn0022c4c968dsrker","content":"<p>一般在使用CoreAnimation写动画是，在定义CAAnimation时，都要加入如下两句来防止动画完成后视图的位置又还原成了原来的位置。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">animation.fillMode = kCAFillModeBoth</span><br><span class=\"line\">animation.isRemovedOnCompletion = <span class=\"literal\">false</span></span><br></pre></td></tr></table></figure>\n<p>很少有文章能详细说明这两个属性的作用，今天我们就来深究一下这两个属性。</p>\n<h2 id=\"fillMode\"><a href=\"#fillMode\" class=\"headerlink\" title=\"fillMode\"></a>fillMode</h2><p>fillMode是一个枚举值，用于表示动画在开始和结束时的状态，这样说可能不太好理解，直接看例子比较直观。</p>\n<h3 id=\"kCAFillModeRemoved\"><a href=\"#kCAFillModeRemoved\" class=\"headerlink\" title=\"kCAFillModeRemoved\"></a>kCAFillModeRemoved</h3><p>这个是fillMode的默认值，表示在到达beginTime时才显示动画的第一帧，动画结束时，删除CALayer做的变化</p>\n<p>实例代码：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">touchesBegan</span><span class=\"params\">(touches: Set&lt;UITouch&gt;, withEvent event: UIEvent?)</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> move = <span class=\"type\">CABasicAnimation</span>(keyPath: <span class=\"string\">\"position.y\"</span>)</span><br><span class=\"line\">    move.fromValue = <span class=\"number\">100</span></span><br><span class=\"line\">    move.toValue = <span class=\"number\">500</span></span><br><span class=\"line\">    move.duration = <span class=\"number\">1.0</span></span><br><span class=\"line\">    move.beginTime = <span class=\"type\">CACurrentMediaTime</span>() + <span class=\"number\">2.0</span></span><br><span class=\"line\">    move.fillMode = kCAFillModeRemoved</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.myView.layer.add(move, forKey: <span class=\"literal\">nil</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>代码中，我们将一个View的y坐标从100移动到500，历时1s，注意开始时间我设定为了<code>CACurrentMediaTime() + 2.0</code>，即添加动画2s后才开始执行动画，这样才能看到效果。运行结果如下：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/kCAFillModeRemoved.gif\" alt=\"kCAFillModeRemoved\"></p>\n<p>可以看到，在鼠标点击触发后，2s之后myView才移动到了动画的初始位置100开始执行动画，并且在动画结束后视图又立刻恢复到原来的位置。</p>\n<h3 id=\"kCAFillModeBackwards\"><a href=\"#kCAFillModeBackwards\" class=\"headerlink\" title=\"kCAFillModeBackwards\"></a>kCAFillModeBackwards</h3><p>这个值表示无论是否到达beginTime，动画开始后，立刻显示动画的第一帧，修改代码如下：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">touchesBegan</span><span class=\"params\">(touches: Set&lt;UITouch&gt;, withEvent event: UIEvent?)</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> move = <span class=\"type\">CABasicAnimation</span>(keyPath: <span class=\"string\">\"position.y\"</span>)</span><br><span class=\"line\">    move.fromValue = <span class=\"number\">100</span></span><br><span class=\"line\">    move.toValue = <span class=\"number\">500</span></span><br><span class=\"line\">    move.duration = <span class=\"number\">1.0</span></span><br><span class=\"line\">    move.beginTime = <span class=\"type\">CACurrentMediaTime</span>() + <span class=\"number\">2.0</span></span><br><span class=\"line\">    move.fillMode = kCAFillModeBackwards</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.myView.layer.add(move, forKey: <span class=\"literal\">nil</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>运行效果如下：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/kCAFillModeBackwards.gif\" alt=\"kCAFillModeBackwards\"></p>\n<p>可以看到，鼠标点击后，myView立刻移动到了动画的初始位置100，然后2s后开始执行动画。</p>\n<h3 id=\"kCAFillModeForwards\"><a href=\"#kCAFillModeForwards\" class=\"headerlink\" title=\"kCAFillModeForwards\"></a>kCAFillModeForwards</h3><p>这个值表示在到达beginTime时显示动画的第一帧，在动画结束时，保持动画最后一帧的状态，直到动画被删除，修改代码如下：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">touchesBegan</span><span class=\"params\">(<span class=\"number\">_</span> touches: Set&lt;UITouch&gt;, with event: UIEvent?)</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> move = <span class=\"type\">CABasicAnimation</span>(keyPath: <span class=\"string\">\"position.y\"</span>)</span><br><span class=\"line\">    move.fromValue = <span class=\"number\">100</span></span><br><span class=\"line\">    move.toValue = <span class=\"number\">500</span></span><br><span class=\"line\">    move.duration = <span class=\"number\">1.0</span></span><br><span class=\"line\">    move.beginTime = <span class=\"type\">CACurrentMediaTime</span>() + <span class=\"number\">2.0</span></span><br><span class=\"line\">    move.fillMode = kCAFillModeForwards;</span><br><span class=\"line\">    move.isRemovedOnCompletion = <span class=\"literal\">false</span></span><br><span class=\"line\">    move.delegate = <span class=\"keyword\">self</span>;</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.myView.layer.add(move, forKey: <span class=\"literal\">nil</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">animationDidStop</span><span class=\"params\">(<span class=\"number\">_</span> anim: CAAnimation, finished flag: Bool)</span></span> &#123;</span><br><span class=\"line\">    <span class=\"type\">DispatchQueue</span>.main.after(when: .now() + <span class=\"number\">3</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.myView.layer.removeAllAnimations()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>代码中添加了<code>move.isRemovedOnCompletion = false</code>，即动画执行完后不立刻删除动画，默认情况下，动画执行完后会立刻删除动画。<code>isRemovedOnCompletion</code>属性设置为false后，就不会立刻删除。然后我们还添加了<code>animationDidStop</code>方法，这个是<code>CABasicAnimation</code>的代理方法，在动画执行结束时会被调用。我们在这个方法里延时3s删除动画。运行效果如下：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/kCAFillModeForwards.gif\" alt=\"kCAFillModeForwards\"></p>\n<p>可以看到，鼠标点击后，myView等了2s才移动到动画初始位置，动画结束后，等待了3s，myView才恢复到原来的位置。也就是动画结束后会保持最后一帧的状态，直到动画被删除掉。</p>\n<h3 id=\"kCAFillModeBoth\"><a href=\"#kCAFillModeBoth\" class=\"headerlink\" title=\"kCAFillModeBoth\"></a>kCAFillModeBoth</h3><p>这个值相当于kCAFillModeBackwards与kCAFillModeForwards的共同合集，即无论是否到达beginTime，动画开始后，立刻显示动画的第一帧，并且在动画结束时保持最后一帧的状态，直到动画被删除。修改代码如下：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">touchesBegan</span><span class=\"params\">(<span class=\"number\">_</span> touches: Set&lt;UITouch&gt;, with event: UIEvent?)</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> move = <span class=\"type\">CABasicAnimation</span>(keyPath: <span class=\"string\">\"position.y\"</span>)</span><br><span class=\"line\">    move.fromValue = <span class=\"number\">100</span></span><br><span class=\"line\">    move.toValue = <span class=\"number\">500</span></span><br><span class=\"line\">    move.duration = <span class=\"number\">1.0</span></span><br><span class=\"line\">    move.beginTime = <span class=\"type\">CACurrentMediaTime</span>() + <span class=\"number\">2.0</span></span><br><span class=\"line\">    move.fillMode = kCAFillModeBoth;</span><br><span class=\"line\">    move.isRemovedOnCompletion = <span class=\"literal\">false</span></span><br><span class=\"line\">    move.delegate = <span class=\"keyword\">self</span>;</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.myView.layer.add(move, forKey: <span class=\"literal\">nil</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">animationDidStop</span><span class=\"params\">(<span class=\"number\">_</span> anim: CAAnimation, finished flag: Bool)</span></span> &#123;</span><br><span class=\"line\">    <span class=\"type\">DispatchQueue</span>.main.after(when: .now() + <span class=\"number\">3</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.myView.layer.removeAllAnimations()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>运行效果如下：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/kCAFillModeBoth.gif\" alt=\"kCAFillModeBoth\"></p>\n<p>可以看到，鼠标点击后，myView立刻移动到了动画的初始位置，然后动画结束后，等待了3s，myView才恢复到原来的位置。</p>\n<h2 id=\"更进一步的思考\"><a href=\"#更进一步的思考\" class=\"headerlink\" title=\"更进一步的思考\"></a>更进一步的思考</h2><p>以上就是我对fillMode的一个探究，下面再回到文章开头的那段代码</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">animation.fillMode = kCAFillModeBoth</span><br><span class=\"line\">animation.isRemovedOnCompletion = <span class=\"literal\">false</span></span><br></pre></td></tr></table></figure>\n<p>这时，就很明白了，设置fillMode为<code>kCAFillModeBoth</code>，可以使视图在动画结束时，仍然停留在动画结束的位置，直到动画被删除。设置<code>isRemovedOnCompletion</code>为false，可以使动画在结束后不被删除，这样视图就会永远停留在动画结束的位置。</p>\n<p>乍一看没什么问题，但仔细想想还是觉得有点奇怪，动画已经结束了为什么不删除，还占着内存。如果动画少还好，如果动画非常多，每个动画执行完了都不删除的话，那内存岂不是会爆掉，这是不能接受的。有没有办法能够既让视图停留在动画结束的位置，又能在动画结束后删除动画呢？</p>\n<p>当然有，直接上代码：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">touchesBegan</span><span class=\"params\">(<span class=\"number\">_</span> touches: Set&lt;UITouch&gt;, with event: UIEvent?)</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> move = <span class=\"type\">CABasicAnimation</span>(keyPath: <span class=\"string\">\"position.y\"</span>)</span><br><span class=\"line\">    move.fromValue = <span class=\"number\">100</span></span><br><span class=\"line\">    move.toValue = <span class=\"number\">500</span></span><br><span class=\"line\">    move.duration = <span class=\"number\">1.0</span></span><br><span class=\"line\">    move.beginTime = <span class=\"type\">CACurrentMediaTime</span>() + <span class=\"number\">2.0</span></span><br><span class=\"line\">    move.fillMode = kCAFillModeBoth;</span><br><span class=\"line\">    move.delegate = <span class=\"keyword\">self</span>;</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.myView.layer.add(move, forKey: <span class=\"literal\">nil</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">self</span>.myView.layer.position.y = <span class=\"number\">500</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>解决方法就是在视图添加动画后，手动修改视图的位置为动画结束后的最终位置，这样动画结束后，动画就会被删除并且视图会停留在动画结束时的位置。</p>\n<p>注意：这里应该使用layer的position，不能直接修改UIView的frame，否则动画效果会不正确。</p>\n<h2 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h2><p><a href=\"https://www.raywenderlich.com/store/ios-animations-by-tutorials\" target=\"_blank\" rel=\"noopener\">iOS Animations by Tutorials</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>一般在使用CoreAnimation写动画是，在定义CAAnimation时，都要加入如下两句来防止动画完成后视图的位置又还原成了原来的位置。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">animation.fillMode = kCAFillModeBoth</span><br><span class=\"line\">animation.isRemovedOnCompletion = <span class=\"literal\">false</span></span><br></pre></td></tr></table></figure>\n<p>很少有文章能详细说明这两个属性的作用，今天我们就来深究一下这两个属性。</p>\n<h2 id=\"fillMode\"><a href=\"#fillMode\" class=\"headerlink\" title=\"fillMode\"></a>fillMode</h2><p>fillMode是一个枚举值，用于表示动画在开始和结束时的状态，这样说可能不太好理解，直接看例子比较直观。</p>\n<h3 id=\"kCAFillModeRemoved\"><a href=\"#kCAFillModeRemoved\" class=\"headerlink\" title=\"kCAFillModeRemoved\"></a>kCAFillModeRemoved</h3><p>这个是fillMode的默认值，表示在到达beginTime时才显示动画的第一帧，动画结束时，删除CALayer做的变化</p>\n<p>实例代码：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">touchesBegan</span><span class=\"params\">(touches: Set&lt;UITouch&gt;, withEvent event: UIEvent?)</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> move = <span class=\"type\">CABasicAnimation</span>(keyPath: <span class=\"string\">\"position.y\"</span>)</span><br><span class=\"line\">    move.fromValue = <span class=\"number\">100</span></span><br><span class=\"line\">    move.toValue = <span class=\"number\">500</span></span><br><span class=\"line\">    move.duration = <span class=\"number\">1.0</span></span><br><span class=\"line\">    move.beginTime = <span class=\"type\">CACurrentMediaTime</span>() + <span class=\"number\">2.0</span></span><br><span class=\"line\">    move.fillMode = kCAFillModeRemoved</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.myView.layer.add(move, forKey: <span class=\"literal\">nil</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>代码中，我们将一个View的y坐标从100移动到500，历时1s，注意开始时间我设定为了<code>CACurrentMediaTime() + 2.0</code>，即添加动画2s后才开始执行动画，这样才能看到效果。运行结果如下：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/kCAFillModeRemoved.gif\" alt=\"kCAFillModeRemoved\"></p>\n<p>可以看到，在鼠标点击触发后，2s之后myView才移动到了动画的初始位置100开始执行动画，并且在动画结束后视图又立刻恢复到原来的位置。</p>\n<h3 id=\"kCAFillModeBackwards\"><a href=\"#kCAFillModeBackwards\" class=\"headerlink\" title=\"kCAFillModeBackwards\"></a>kCAFillModeBackwards</h3><p>这个值表示无论是否到达beginTime，动画开始后，立刻显示动画的第一帧，修改代码如下：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">touchesBegan</span><span class=\"params\">(touches: Set&lt;UITouch&gt;, withEvent event: UIEvent?)</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> move = <span class=\"type\">CABasicAnimation</span>(keyPath: <span class=\"string\">\"position.y\"</span>)</span><br><span class=\"line\">    move.fromValue = <span class=\"number\">100</span></span><br><span class=\"line\">    move.toValue = <span class=\"number\">500</span></span><br><span class=\"line\">    move.duration = <span class=\"number\">1.0</span></span><br><span class=\"line\">    move.beginTime = <span class=\"type\">CACurrentMediaTime</span>() + <span class=\"number\">2.0</span></span><br><span class=\"line\">    move.fillMode = kCAFillModeBackwards</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.myView.layer.add(move, forKey: <span class=\"literal\">nil</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>运行效果如下：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/kCAFillModeBackwards.gif\" alt=\"kCAFillModeBackwards\"></p>\n<p>可以看到，鼠标点击后，myView立刻移动到了动画的初始位置100，然后2s后开始执行动画。</p>\n<h3 id=\"kCAFillModeForwards\"><a href=\"#kCAFillModeForwards\" class=\"headerlink\" title=\"kCAFillModeForwards\"></a>kCAFillModeForwards</h3><p>这个值表示在到达beginTime时显示动画的第一帧，在动画结束时，保持动画最后一帧的状态，直到动画被删除，修改代码如下：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">touchesBegan</span><span class=\"params\">(<span class=\"number\">_</span> touches: Set&lt;UITouch&gt;, with event: UIEvent?)</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> move = <span class=\"type\">CABasicAnimation</span>(keyPath: <span class=\"string\">\"position.y\"</span>)</span><br><span class=\"line\">    move.fromValue = <span class=\"number\">100</span></span><br><span class=\"line\">    move.toValue = <span class=\"number\">500</span></span><br><span class=\"line\">    move.duration = <span class=\"number\">1.0</span></span><br><span class=\"line\">    move.beginTime = <span class=\"type\">CACurrentMediaTime</span>() + <span class=\"number\">2.0</span></span><br><span class=\"line\">    move.fillMode = kCAFillModeForwards;</span><br><span class=\"line\">    move.isRemovedOnCompletion = <span class=\"literal\">false</span></span><br><span class=\"line\">    move.delegate = <span class=\"keyword\">self</span>;</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.myView.layer.add(move, forKey: <span class=\"literal\">nil</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">animationDidStop</span><span class=\"params\">(<span class=\"number\">_</span> anim: CAAnimation, finished flag: Bool)</span></span> &#123;</span><br><span class=\"line\">    <span class=\"type\">DispatchQueue</span>.main.after(when: .now() + <span class=\"number\">3</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.myView.layer.removeAllAnimations()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>代码中添加了<code>move.isRemovedOnCompletion = false</code>，即动画执行完后不立刻删除动画，默认情况下，动画执行完后会立刻删除动画。<code>isRemovedOnCompletion</code>属性设置为false后，就不会立刻删除。然后我们还添加了<code>animationDidStop</code>方法，这个是<code>CABasicAnimation</code>的代理方法，在动画执行结束时会被调用。我们在这个方法里延时3s删除动画。运行效果如下：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/kCAFillModeForwards.gif\" alt=\"kCAFillModeForwards\"></p>\n<p>可以看到，鼠标点击后，myView等了2s才移动到动画初始位置，动画结束后，等待了3s，myView才恢复到原来的位置。也就是动画结束后会保持最后一帧的状态，直到动画被删除掉。</p>\n<h3 id=\"kCAFillModeBoth\"><a href=\"#kCAFillModeBoth\" class=\"headerlink\" title=\"kCAFillModeBoth\"></a>kCAFillModeBoth</h3><p>这个值相当于kCAFillModeBackwards与kCAFillModeForwards的共同合集，即无论是否到达beginTime，动画开始后，立刻显示动画的第一帧，并且在动画结束时保持最后一帧的状态，直到动画被删除。修改代码如下：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">touchesBegan</span><span class=\"params\">(<span class=\"number\">_</span> touches: Set&lt;UITouch&gt;, with event: UIEvent?)</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> move = <span class=\"type\">CABasicAnimation</span>(keyPath: <span class=\"string\">\"position.y\"</span>)</span><br><span class=\"line\">    move.fromValue = <span class=\"number\">100</span></span><br><span class=\"line\">    move.toValue = <span class=\"number\">500</span></span><br><span class=\"line\">    move.duration = <span class=\"number\">1.0</span></span><br><span class=\"line\">    move.beginTime = <span class=\"type\">CACurrentMediaTime</span>() + <span class=\"number\">2.0</span></span><br><span class=\"line\">    move.fillMode = kCAFillModeBoth;</span><br><span class=\"line\">    move.isRemovedOnCompletion = <span class=\"literal\">false</span></span><br><span class=\"line\">    move.delegate = <span class=\"keyword\">self</span>;</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.myView.layer.add(move, forKey: <span class=\"literal\">nil</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">animationDidStop</span><span class=\"params\">(<span class=\"number\">_</span> anim: CAAnimation, finished flag: Bool)</span></span> &#123;</span><br><span class=\"line\">    <span class=\"type\">DispatchQueue</span>.main.after(when: .now() + <span class=\"number\">3</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.myView.layer.removeAllAnimations()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>运行效果如下：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/kCAFillModeBoth.gif\" alt=\"kCAFillModeBoth\"></p>\n<p>可以看到，鼠标点击后，myView立刻移动到了动画的初始位置，然后动画结束后，等待了3s，myView才恢复到原来的位置。</p>\n<h2 id=\"更进一步的思考\"><a href=\"#更进一步的思考\" class=\"headerlink\" title=\"更进一步的思考\"></a>更进一步的思考</h2><p>以上就是我对fillMode的一个探究，下面再回到文章开头的那段代码</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">animation.fillMode = kCAFillModeBoth</span><br><span class=\"line\">animation.isRemovedOnCompletion = <span class=\"literal\">false</span></span><br></pre></td></tr></table></figure>\n<p>这时，就很明白了，设置fillMode为<code>kCAFillModeBoth</code>，可以使视图在动画结束时，仍然停留在动画结束的位置，直到动画被删除。设置<code>isRemovedOnCompletion</code>为false，可以使动画在结束后不被删除，这样视图就会永远停留在动画结束的位置。</p>\n<p>乍一看没什么问题，但仔细想想还是觉得有点奇怪，动画已经结束了为什么不删除，还占着内存。如果动画少还好，如果动画非常多，每个动画执行完了都不删除的话，那内存岂不是会爆掉，这是不能接受的。有没有办法能够既让视图停留在动画结束的位置，又能在动画结束后删除动画呢？</p>\n<p>当然有，直接上代码：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">touchesBegan</span><span class=\"params\">(<span class=\"number\">_</span> touches: Set&lt;UITouch&gt;, with event: UIEvent?)</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> move = <span class=\"type\">CABasicAnimation</span>(keyPath: <span class=\"string\">\"position.y\"</span>)</span><br><span class=\"line\">    move.fromValue = <span class=\"number\">100</span></span><br><span class=\"line\">    move.toValue = <span class=\"number\">500</span></span><br><span class=\"line\">    move.duration = <span class=\"number\">1.0</span></span><br><span class=\"line\">    move.beginTime = <span class=\"type\">CACurrentMediaTime</span>() + <span class=\"number\">2.0</span></span><br><span class=\"line\">    move.fillMode = kCAFillModeBoth;</span><br><span class=\"line\">    move.delegate = <span class=\"keyword\">self</span>;</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.myView.layer.add(move, forKey: <span class=\"literal\">nil</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">self</span>.myView.layer.position.y = <span class=\"number\">500</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>解决方法就是在视图添加动画后，手动修改视图的位置为动画结束后的最终位置，这样动画结束后，动画就会被删除并且视图会停留在动画结束时的位置。</p>\n<p>注意：这里应该使用layer的position，不能直接修改UIView的frame，否则动画效果会不正确。</p>\n<h2 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h2><p><a href=\"https://www.raywenderlich.com/store/ios-animations-by-tutorials\" target=\"_blank\" rel=\"noopener\">iOS Animations by Tutorials</a></p>\n"},{"title":"Mac下生成RSA密钥对要注意的问题","date":"2016-08-25T15:50:06.000Z","_content":"\n生成RSA密钥一般使用的Openssl，方法如下：\n\n在终端输入命令openssl然后敲回车，进入openssl命令输入模式，如下：\n\n![1](http://oldblog.shicishuzhai.com/d0eff7b11f3bb040e28e46de5393d9d2.png)\n\n然后输入一下三行命令：\n\n```shell\ngenrsa -out rsa_private_key.pem 1024\npkcs8 -topk8 -in rsa_private_key.pem -out pkcs8_rsa_private_key.pem -nocrypt\nrsa -in rsa_private_key.pem -pubout -out rsa_public_key.pem\n```\n\n然后输入exit退出openssl命令输入模式，这样会在当前目录生成三个文件，如下：\n\n![2](http://oldblog.shicishuzhai.com/980dc450a7d1f4db0759d42ac882f54a.png)\n\n其中：\n\n* rsa_private_key.pem为私钥\n* rsa_public_key.pem为公钥\n* pkcs8_rsa_private_key.pem为PKCS#8编码的私钥\n\n公钥没有问题，主要是私钥，私钥有两个，两个有什么区别，到底该用哪一个呢？\n\n主要区别在于：\n\n* rsa_private_key.pem为PKCS#1编码，只包含RSA的密钥信息，是以\"-----BEGIN RSA PRIVATE KEY-----\"开头，以\"-----END RSA PRIVATE KEY-----\"结尾，如下图：\n\n![3](http://oldblog.shicishuzhai.com/9927f538bea6e031960a0a908076ccdd.png)\n\n* pkcs8_rsa_private_key.pem为PKCS#8编码，除了包含RSA密钥信息外，还包含一些附加信息，例如version和算法等，是以\"-----BEGIN PRIVATE KEY-----\"开头，以\"-----END PRIVATE KEY-----\"结尾的，如下图：\n\n![4](http://oldblog.shicishuzhai.com/b98831c564629c062c9bfcb5f7868625.png)\n\nMac默认生成的是PKCS#1编码的私钥，而有的系统生成私钥是PKCS#8编码，具体用哪个这要看你的加密代码里是否对附加信息进行了校验判断，如果进行了校验，则应该使用PKCS#8编码的私钥，否则应该使用PKCS#1编码的私钥。\n\n我使用的是[这个第三方库](https://github.com/ideawu/Objective-C-RSA)进行加密解密的，里面对附加信息进行了校验，所以应该使用PKCS#8编码的密钥。\n\n## 参考资料\n\n[Objective-C-RSA](https://github.com/ideawu/Objective-C-RSA)\n[Objective-C-RSA Issuse #15](https://github.com/ideawu/Objective-C-RSA/issues/15)\n[openssl生成RSA格式，并转为pkcs8格式](http://www.tuicool.com/articles/Rbu6zm)\n","source":"_posts/2016-08-25-Mac下生成RSA密钥对要注意的问题.md","raw":"---\ntitle: Mac下生成RSA密钥对要注意的问题\ncategories: 其他\ntags:\n  - 加密解密\ndate: 2016-08-25 23:50:06\n---\n\n生成RSA密钥一般使用的Openssl，方法如下：\n\n在终端输入命令openssl然后敲回车，进入openssl命令输入模式，如下：\n\n![1](http://oldblog.shicishuzhai.com/d0eff7b11f3bb040e28e46de5393d9d2.png)\n\n然后输入一下三行命令：\n\n```shell\ngenrsa -out rsa_private_key.pem 1024\npkcs8 -topk8 -in rsa_private_key.pem -out pkcs8_rsa_private_key.pem -nocrypt\nrsa -in rsa_private_key.pem -pubout -out rsa_public_key.pem\n```\n\n然后输入exit退出openssl命令输入模式，这样会在当前目录生成三个文件，如下：\n\n![2](http://oldblog.shicishuzhai.com/980dc450a7d1f4db0759d42ac882f54a.png)\n\n其中：\n\n* rsa_private_key.pem为私钥\n* rsa_public_key.pem为公钥\n* pkcs8_rsa_private_key.pem为PKCS#8编码的私钥\n\n公钥没有问题，主要是私钥，私钥有两个，两个有什么区别，到底该用哪一个呢？\n\n主要区别在于：\n\n* rsa_private_key.pem为PKCS#1编码，只包含RSA的密钥信息，是以\"-----BEGIN RSA PRIVATE KEY-----\"开头，以\"-----END RSA PRIVATE KEY-----\"结尾，如下图：\n\n![3](http://oldblog.shicishuzhai.com/9927f538bea6e031960a0a908076ccdd.png)\n\n* pkcs8_rsa_private_key.pem为PKCS#8编码，除了包含RSA密钥信息外，还包含一些附加信息，例如version和算法等，是以\"-----BEGIN PRIVATE KEY-----\"开头，以\"-----END PRIVATE KEY-----\"结尾的，如下图：\n\n![4](http://oldblog.shicishuzhai.com/b98831c564629c062c9bfcb5f7868625.png)\n\nMac默认生成的是PKCS#1编码的私钥，而有的系统生成私钥是PKCS#8编码，具体用哪个这要看你的加密代码里是否对附加信息进行了校验判断，如果进行了校验，则应该使用PKCS#8编码的私钥，否则应该使用PKCS#1编码的私钥。\n\n我使用的是[这个第三方库](https://github.com/ideawu/Objective-C-RSA)进行加密解密的，里面对附加信息进行了校验，所以应该使用PKCS#8编码的密钥。\n\n## 参考资料\n\n[Objective-C-RSA](https://github.com/ideawu/Objective-C-RSA)\n[Objective-C-RSA Issuse #15](https://github.com/ideawu/Objective-C-RSA/issues/15)\n[openssl生成RSA格式，并转为pkcs8格式](http://www.tuicool.com/articles/Rbu6zm)\n","slug":"Mac下生成RSA密钥对要注意的问题","published":1,"updated":"2019-01-13T04:01:04.474Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjutyfmfo0025c4c9abtj4eo8","content":"<p>生成RSA密钥一般使用的Openssl，方法如下：</p>\n<p>在终端输入命令openssl然后敲回车，进入openssl命令输入模式，如下：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/d0eff7b11f3bb040e28e46de5393d9d2.png\" alt=\"1\"></p>\n<p>然后输入一下三行命令：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">genrsa -out rsa_private_key.pem 1024</span><br><span class=\"line\">pkcs8 -topk8 -in rsa_private_key.pem -out pkcs8_rsa_private_key.pem -nocrypt</span><br><span class=\"line\">rsa -in rsa_private_key.pem -pubout -out rsa_public_key.pem</span><br></pre></td></tr></table></figure>\n<p>然后输入exit退出openssl命令输入模式，这样会在当前目录生成三个文件，如下：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/980dc450a7d1f4db0759d42ac882f54a.png\" alt=\"2\"></p>\n<p>其中：</p>\n<ul>\n<li>rsa_private_key.pem为私钥</li>\n<li>rsa_public_key.pem为公钥</li>\n<li>pkcs8_rsa_private_key.pem为PKCS#8编码的私钥</li>\n</ul>\n<p>公钥没有问题，主要是私钥，私钥有两个，两个有什么区别，到底该用哪一个呢？</p>\n<p>主要区别在于：</p>\n<ul>\n<li>rsa_private_key.pem为PKCS#1编码，只包含RSA的密钥信息，是以”—–BEGIN RSA PRIVATE KEY—–”开头，以”—–END RSA PRIVATE KEY—–”结尾，如下图：</li>\n</ul>\n<p><img src=\"http://oldblog.shicishuzhai.com/9927f538bea6e031960a0a908076ccdd.png\" alt=\"3\"></p>\n<ul>\n<li>pkcs8_rsa_private_key.pem为PKCS#8编码，除了包含RSA密钥信息外，还包含一些附加信息，例如version和算法等，是以”—–BEGIN PRIVATE KEY—–”开头，以”—–END PRIVATE KEY—–”结尾的，如下图：</li>\n</ul>\n<p><img src=\"http://oldblog.shicishuzhai.com/b98831c564629c062c9bfcb5f7868625.png\" alt=\"4\"></p>\n<p>Mac默认生成的是PKCS#1编码的私钥，而有的系统生成私钥是PKCS#8编码，具体用哪个这要看你的加密代码里是否对附加信息进行了校验判断，如果进行了校验，则应该使用PKCS#8编码的私钥，否则应该使用PKCS#1编码的私钥。</p>\n<p>我使用的是<a href=\"https://github.com/ideawu/Objective-C-RSA\" target=\"_blank\" rel=\"noopener\">这个第三方库</a>进行加密解密的，里面对附加信息进行了校验，所以应该使用PKCS#8编码的密钥。</p>\n<h2 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h2><p><a href=\"https://github.com/ideawu/Objective-C-RSA\" target=\"_blank\" rel=\"noopener\">Objective-C-RSA</a><br><a href=\"https://github.com/ideawu/Objective-C-RSA/issues/15\" target=\"_blank\" rel=\"noopener\">Objective-C-RSA Issuse #15</a><br><a href=\"http://www.tuicool.com/articles/Rbu6zm\" target=\"_blank\" rel=\"noopener\">openssl生成RSA格式，并转为pkcs8格式</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>生成RSA密钥一般使用的Openssl，方法如下：</p>\n<p>在终端输入命令openssl然后敲回车，进入openssl命令输入模式，如下：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/d0eff7b11f3bb040e28e46de5393d9d2.png\" alt=\"1\"></p>\n<p>然后输入一下三行命令：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">genrsa -out rsa_private_key.pem 1024</span><br><span class=\"line\">pkcs8 -topk8 -in rsa_private_key.pem -out pkcs8_rsa_private_key.pem -nocrypt</span><br><span class=\"line\">rsa -in rsa_private_key.pem -pubout -out rsa_public_key.pem</span><br></pre></td></tr></table></figure>\n<p>然后输入exit退出openssl命令输入模式，这样会在当前目录生成三个文件，如下：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/980dc450a7d1f4db0759d42ac882f54a.png\" alt=\"2\"></p>\n<p>其中：</p>\n<ul>\n<li>rsa_private_key.pem为私钥</li>\n<li>rsa_public_key.pem为公钥</li>\n<li>pkcs8_rsa_private_key.pem为PKCS#8编码的私钥</li>\n</ul>\n<p>公钥没有问题，主要是私钥，私钥有两个，两个有什么区别，到底该用哪一个呢？</p>\n<p>主要区别在于：</p>\n<ul>\n<li>rsa_private_key.pem为PKCS#1编码，只包含RSA的密钥信息，是以”—–BEGIN RSA PRIVATE KEY—–”开头，以”—–END RSA PRIVATE KEY—–”结尾，如下图：</li>\n</ul>\n<p><img src=\"http://oldblog.shicishuzhai.com/9927f538bea6e031960a0a908076ccdd.png\" alt=\"3\"></p>\n<ul>\n<li>pkcs8_rsa_private_key.pem为PKCS#8编码，除了包含RSA密钥信息外，还包含一些附加信息，例如version和算法等，是以”—–BEGIN PRIVATE KEY—–”开头，以”—–END PRIVATE KEY—–”结尾的，如下图：</li>\n</ul>\n<p><img src=\"http://oldblog.shicishuzhai.com/b98831c564629c062c9bfcb5f7868625.png\" alt=\"4\"></p>\n<p>Mac默认生成的是PKCS#1编码的私钥，而有的系统生成私钥是PKCS#8编码，具体用哪个这要看你的加密代码里是否对附加信息进行了校验判断，如果进行了校验，则应该使用PKCS#8编码的私钥，否则应该使用PKCS#1编码的私钥。</p>\n<p>我使用的是<a href=\"https://github.com/ideawu/Objective-C-RSA\" target=\"_blank\" rel=\"noopener\">这个第三方库</a>进行加密解密的，里面对附加信息进行了校验，所以应该使用PKCS#8编码的密钥。</p>\n<h2 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h2><p><a href=\"https://github.com/ideawu/Objective-C-RSA\" target=\"_blank\" rel=\"noopener\">Objective-C-RSA</a><br><a href=\"https://github.com/ideawu/Objective-C-RSA/issues/15\" target=\"_blank\" rel=\"noopener\">Objective-C-RSA Issuse #15</a><br><a href=\"http://www.tuicool.com/articles/Rbu6zm\" target=\"_blank\" rel=\"noopener\">openssl生成RSA格式，并转为pkcs8格式</a></p>\n"},{"title":"使用Safair调试JS","date":"2016-08-30T13:46:33.000Z","_content":"\niOS项目中经常会用到Native界面和H5界面互相调用的情况，方法就是使用JavaScriptCore框架直接在原生界面中调用JS代码。如果JS代码较长，调试起来就会比较麻烦，这里介绍一种方法，可以让你轻松调试JS。\n\n首先，打开Safari，打开偏好设置（快捷键Cmd+,），在Advanced中选中\"Show Develop menu in menu bar\"，如下图：\n\n![1](http://oldblog.shicishuzhai.com/500ac2228a67a84dd4c20e73f104a560.png)\n\n这样菜单栏就会出现一个Develop菜单，点击菜单Develop->Simulator->Automatically Show Web Inspector For JSContexts\n\n![2](http://oldblog.shicishuzhai.com/211795a2560cf0bc3973a5d778d96343.png)\n\n然后使用模拟器运行项目，当运行到JS代码时，就会自动启动调试器，如图：\n\n![3](http://oldblog.shicishuzhai.com/19c6bf7d6bce0e9b54f289ccc9025ecc.png)\n\n和XCode一样，你可以打断点，当JS运行到这一句时就会进入断点\n\n![4](http://oldblog.shicishuzhai.com/f6b607a7a949df00b9f2e20f11e7b29a.png)\n\n当进入断点后，还可以打印出相应的局部变量\n\n![5](http://oldblog.shicishuzhai.com/993f4e504f25bc37a79cc1f6ffd1a9ca.png)\n\n以上就是使用Safari调试JS的方法。\n","source":"_posts/2016-08-30-使用Safair调试JS.md","raw":"---\ntitle: 使用Safair调试JS\ncategories: iOS Tips\ntags:\n  - 其他\ndate: 2016-08-30 21:46:33\n---\n\niOS项目中经常会用到Native界面和H5界面互相调用的情况，方法就是使用JavaScriptCore框架直接在原生界面中调用JS代码。如果JS代码较长，调试起来就会比较麻烦，这里介绍一种方法，可以让你轻松调试JS。\n\n首先，打开Safari，打开偏好设置（快捷键Cmd+,），在Advanced中选中\"Show Develop menu in menu bar\"，如下图：\n\n![1](http://oldblog.shicishuzhai.com/500ac2228a67a84dd4c20e73f104a560.png)\n\n这样菜单栏就会出现一个Develop菜单，点击菜单Develop->Simulator->Automatically Show Web Inspector For JSContexts\n\n![2](http://oldblog.shicishuzhai.com/211795a2560cf0bc3973a5d778d96343.png)\n\n然后使用模拟器运行项目，当运行到JS代码时，就会自动启动调试器，如图：\n\n![3](http://oldblog.shicishuzhai.com/19c6bf7d6bce0e9b54f289ccc9025ecc.png)\n\n和XCode一样，你可以打断点，当JS运行到这一句时就会进入断点\n\n![4](http://oldblog.shicishuzhai.com/f6b607a7a949df00b9f2e20f11e7b29a.png)\n\n当进入断点后，还可以打印出相应的局部变量\n\n![5](http://oldblog.shicishuzhai.com/993f4e504f25bc37a79cc1f6ffd1a9ca.png)\n\n以上就是使用Safari调试JS的方法。\n","slug":"使用Safair调试JS","published":1,"updated":"2019-01-13T04:01:04.574Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjutyfmfp0028c4c9ennoc9r8","content":"<p>iOS项目中经常会用到Native界面和H5界面互相调用的情况，方法就是使用JavaScriptCore框架直接在原生界面中调用JS代码。如果JS代码较长，调试起来就会比较麻烦，这里介绍一种方法，可以让你轻松调试JS。</p>\n<p>首先，打开Safari，打开偏好设置（快捷键Cmd+,），在Advanced中选中”Show Develop menu in menu bar”，如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/500ac2228a67a84dd4c20e73f104a560.png\" alt=\"1\"></p>\n<p>这样菜单栏就会出现一个Develop菜单，点击菜单Develop-&gt;Simulator-&gt;Automatically Show Web Inspector For JSContexts</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/211795a2560cf0bc3973a5d778d96343.png\" alt=\"2\"></p>\n<p>然后使用模拟器运行项目，当运行到JS代码时，就会自动启动调试器，如图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/19c6bf7d6bce0e9b54f289ccc9025ecc.png\" alt=\"3\"></p>\n<p>和XCode一样，你可以打断点，当JS运行到这一句时就会进入断点</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/f6b607a7a949df00b9f2e20f11e7b29a.png\" alt=\"4\"></p>\n<p>当进入断点后，还可以打印出相应的局部变量</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/993f4e504f25bc37a79cc1f6ffd1a9ca.png\" alt=\"5\"></p>\n<p>以上就是使用Safari调试JS的方法。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>iOS项目中经常会用到Native界面和H5界面互相调用的情况，方法就是使用JavaScriptCore框架直接在原生界面中调用JS代码。如果JS代码较长，调试起来就会比较麻烦，这里介绍一种方法，可以让你轻松调试JS。</p>\n<p>首先，打开Safari，打开偏好设置（快捷键Cmd+,），在Advanced中选中”Show Develop menu in menu bar”，如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/500ac2228a67a84dd4c20e73f104a560.png\" alt=\"1\"></p>\n<p>这样菜单栏就会出现一个Develop菜单，点击菜单Develop-&gt;Simulator-&gt;Automatically Show Web Inspector For JSContexts</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/211795a2560cf0bc3973a5d778d96343.png\" alt=\"2\"></p>\n<p>然后使用模拟器运行项目，当运行到JS代码时，就会自动启动调试器，如图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/19c6bf7d6bce0e9b54f289ccc9025ecc.png\" alt=\"3\"></p>\n<p>和XCode一样，你可以打断点，当JS运行到这一句时就会进入断点</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/f6b607a7a949df00b9f2e20f11e7b29a.png\" alt=\"4\"></p>\n<p>当进入断点后，还可以打印出相应的局部变量</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/993f4e504f25bc37a79cc1f6ffd1a9ca.png\" alt=\"5\"></p>\n<p>以上就是使用Safari调试JS的方法。</p>\n"},{"title":"使用ownCloud作为OmniFocus的云同步服务器","date":"2016-08-24T14:47:22.000Z","_content":"\n平时一直使用OmniFocus作为自己的时间管理工具，但是由于我使用的是破解版的（正版太贵，买不起啊），同步就变成了一件很麻烦的事。OmniFocus提供了两种同步方式，如下图：\n\n![1](http://oldblog.shicishuzhai.com/901f5c4cb502f3fc557e3c3cfa79ad2f.png)\n\n一种是使用Omni官方的服务器同步，这种方式需要注册Omni官方账号，应该只有正版能用吧，我没有尝试；另一种方式是使用WebDAV进行同步，这里着重介绍第二种方式。\n\n本文主要分为以下几个部分：\n\n1. WebDAV简介\n2. ownCloud简介以及搭建方法\n3. 使用ownCloud作为OmniFocus的同步服务器\n4. ownCloud的一些其他应用\n\n## WebDAV简介\n\n[WebDAV](http://baike.baidu.com/link?url=pXeqnwgtPiYSKdYGX9YjBH_XeAJsH-aRkQqEYPsbkQwf9hlbnF9RSuAHvCMLboSuENx55T8J9Pd27E6ybo7Aba)是一种基于 HTTP 1.1协议的通讯协议，可以实现文件的同步。通俗来讲，我们可以利用WebDAV来实现类似百度云一样的网盘功能。\n\n[这里](http://blog.sina.com.cn/s/blog_4834fe810101fw17.html)有几个支持WebDAV协议的网盘，但是都是国外的，国内据我了解目前只有[坚果云](http://www.jianguoyun.com/s/campaign/cpclanding/main?sch=bdcpc_nutstore_off&bdtj=1)一家支持WebDAV。至于国内的各大网盘为什么都不支持WebDAV，可以看[这里](http://www.zhihu.com/question/21511143)。\n\n最初我也本来打算使用国外的网盘来实现WebDAV，但是担心速度不理想，而且国外网盘的免费空间都很小，所以就放弃了。至于坚果云，我也没有去尝试。\n\n进一步Google，于是就找到了ownCloud。\n\n## ownCloud简介以及搭建方法\n\n[ownCloud](https://owncloud.org/)是一个来自KDE社区开发的免费软件，提供私人的Web服务。当前主要功能包括文件管理（内建文件分享）、音乐、日历、联系人等等，可在PC和服务器上运行。简单来说就是一个基于Php的自建网盘。\n\n下面就跟着我使用ownCloud一步一步搭建自己的私人网盘。\n\n### 准备工作\n\n因为要把ownCloud搭建在服务器上，因此你需要有一个VPS，内存至少128M，越大越好，我这里使用的是[搬运工VPS](https://bandwagonhost.com/clientarea.php?action=products)，如何购买VPS可以看我的[这篇博客](http://liujinlongxa.com/2016/06/11/%E6%89%93%E9%80%A0%E8%87%AA%E5%B7%B1%E7%9A%84%E7%BF%BB%E5%A2%99VPS:%E6%90%AC%E8%BF%90%E5%B7%A5VPS%E8%B4%AD%E4%B9%B0%E4%BD%BF%E7%94%A8%E6%B5%81%E7%A8%8B%E5%85%A8%E8%AE%B0%E5%BD%95/)。\n\n### 1. 安装PHP和MySQL环境\n\n由于ownCloud使用php实现的，所以需要在你服务器上安装PHP和MySQL环境，这个网上有很多教程，也可以参考ownCloud给出的[官方教程](https://doc.owncloud.org/server/9.1/admin_manual/installation/php_54_installation.html)。\n\n### 2. 下载服务器源码\n\n在任一文件夹下输入命令：\n\n```shell\nwget https://download.owncloud.org/community/owncloud-9.1.0.tar.bz2\ntar xvf owncloud-9.1.0.tar.bz2\n```\n\n然后改变owncloud这个文件的权限，命令如下：\n\n```shell\nchmod 777 owncloud\n```\n\n### 3. 添加管理员账号\n\n使用浏览器访问地址http://serveraddress/owncloud/ (serveraddress即你服务器的ip地址)就可以看到如下页面：\n\n![2](http://oldblog.shicishuzhai.com/5de5eb45600b86bae8e2c0cfdaadb319.png)\n\n在这里自定义一个管理员的账号和密码，然后点击FinishSetup，这样一个ownCloud就搭建完成了。\n\n## 使用ownCloud作为OmniFocus的同步服务器\n\nownCloud搭建完成后，就可以把它作为Omni的同步服务器了，具体方法如下：\n\n打开OmniFocus的同步设置页面，选择WebDAV方式同步，然后在Address中填入如下地址：\n\n> http://<serveraddress>/owncloud/remote.php/dav/files/<adminname>\n\n<serveraddress>和<adminname>分别替换为你的服务器地址和刚才填的管理员用户名，如下图：\n\n![3](http://oldblog.shicishuzhai.com/264b1ec833e6078643e9c2f40b2bf7aa.png)\n\n然后点击“Sync Now”进行同步，会提示输入密码，输入刚才添加的管理员密码，然后就可以同步成功了。\n\n使用浏览器访问http://serveraddress/owncloud/ ，就可以看到刚刚同步上去的文件了，如下图：\n\n![4](http://oldblog.shicishuzhai.com/0da7c4ef259b48e8f608540c27091cbd.png)\n\n## ownCloud的一些其他应用\n\nownCloud还提供了多平台的客户端，包括iOS，Android，Mac，Windows等，你可以下载一个Mac客户端，然后设置一个同步文件夹，凡是放在这个文件夹里的文件，都会被自动同步到服务器上。如下图：\n\n![5](http://oldblog.shicishuzhai.com/d7b6c828536bab1e8fa5a69a12332ebf.png)\n\n我把Quiver的笔记数据也同步到了服务器上。\n\n## 结语\n\n其实ownCloud的功能还远不止这些，还有很多功能还待以后慢慢探索。\n\n类似ownCloud的还有一个叫[seafile](https://www.seafile.com/home/)的服务，两者的区别和优劣可以参考[这里](http://www.zhihu.com/question/23929945)。\n\n## 参考资料\n\n[ownCloud官方文档](https://doc.owncloud.org/server/9.1/admin_manual/contents.html)\n[ownCloud关于WebDAV使用的文档](https://doc.owncloud.org/server/9.1/user_manual/files/access_webdav.html)\n[使用OwnCloud创建私有云](http://jjliu.blog.ustc.edu.cn/198/)\n","source":"_posts/2016-08-24-使用ownCloud作为OmniFocus的云同步服务器.md","raw":"---\ntitle: 使用ownCloud作为OmniFocus的云同步服务器\ncategories: 其他\ntags:\n  - 其他\n  - WebDAV\n  - ownCloud\ndate: 2016-08-24 22:47:22\n---\n\n平时一直使用OmniFocus作为自己的时间管理工具，但是由于我使用的是破解版的（正版太贵，买不起啊），同步就变成了一件很麻烦的事。OmniFocus提供了两种同步方式，如下图：\n\n![1](http://oldblog.shicishuzhai.com/901f5c4cb502f3fc557e3c3cfa79ad2f.png)\n\n一种是使用Omni官方的服务器同步，这种方式需要注册Omni官方账号，应该只有正版能用吧，我没有尝试；另一种方式是使用WebDAV进行同步，这里着重介绍第二种方式。\n\n本文主要分为以下几个部分：\n\n1. WebDAV简介\n2. ownCloud简介以及搭建方法\n3. 使用ownCloud作为OmniFocus的同步服务器\n4. ownCloud的一些其他应用\n\n## WebDAV简介\n\n[WebDAV](http://baike.baidu.com/link?url=pXeqnwgtPiYSKdYGX9YjBH_XeAJsH-aRkQqEYPsbkQwf9hlbnF9RSuAHvCMLboSuENx55T8J9Pd27E6ybo7Aba)是一种基于 HTTP 1.1协议的通讯协议，可以实现文件的同步。通俗来讲，我们可以利用WebDAV来实现类似百度云一样的网盘功能。\n\n[这里](http://blog.sina.com.cn/s/blog_4834fe810101fw17.html)有几个支持WebDAV协议的网盘，但是都是国外的，国内据我了解目前只有[坚果云](http://www.jianguoyun.com/s/campaign/cpclanding/main?sch=bdcpc_nutstore_off&bdtj=1)一家支持WebDAV。至于国内的各大网盘为什么都不支持WebDAV，可以看[这里](http://www.zhihu.com/question/21511143)。\n\n最初我也本来打算使用国外的网盘来实现WebDAV，但是担心速度不理想，而且国外网盘的免费空间都很小，所以就放弃了。至于坚果云，我也没有去尝试。\n\n进一步Google，于是就找到了ownCloud。\n\n## ownCloud简介以及搭建方法\n\n[ownCloud](https://owncloud.org/)是一个来自KDE社区开发的免费软件，提供私人的Web服务。当前主要功能包括文件管理（内建文件分享）、音乐、日历、联系人等等，可在PC和服务器上运行。简单来说就是一个基于Php的自建网盘。\n\n下面就跟着我使用ownCloud一步一步搭建自己的私人网盘。\n\n### 准备工作\n\n因为要把ownCloud搭建在服务器上，因此你需要有一个VPS，内存至少128M，越大越好，我这里使用的是[搬运工VPS](https://bandwagonhost.com/clientarea.php?action=products)，如何购买VPS可以看我的[这篇博客](http://liujinlongxa.com/2016/06/11/%E6%89%93%E9%80%A0%E8%87%AA%E5%B7%B1%E7%9A%84%E7%BF%BB%E5%A2%99VPS:%E6%90%AC%E8%BF%90%E5%B7%A5VPS%E8%B4%AD%E4%B9%B0%E4%BD%BF%E7%94%A8%E6%B5%81%E7%A8%8B%E5%85%A8%E8%AE%B0%E5%BD%95/)。\n\n### 1. 安装PHP和MySQL环境\n\n由于ownCloud使用php实现的，所以需要在你服务器上安装PHP和MySQL环境，这个网上有很多教程，也可以参考ownCloud给出的[官方教程](https://doc.owncloud.org/server/9.1/admin_manual/installation/php_54_installation.html)。\n\n### 2. 下载服务器源码\n\n在任一文件夹下输入命令：\n\n```shell\nwget https://download.owncloud.org/community/owncloud-9.1.0.tar.bz2\ntar xvf owncloud-9.1.0.tar.bz2\n```\n\n然后改变owncloud这个文件的权限，命令如下：\n\n```shell\nchmod 777 owncloud\n```\n\n### 3. 添加管理员账号\n\n使用浏览器访问地址http://serveraddress/owncloud/ (serveraddress即你服务器的ip地址)就可以看到如下页面：\n\n![2](http://oldblog.shicishuzhai.com/5de5eb45600b86bae8e2c0cfdaadb319.png)\n\n在这里自定义一个管理员的账号和密码，然后点击FinishSetup，这样一个ownCloud就搭建完成了。\n\n## 使用ownCloud作为OmniFocus的同步服务器\n\nownCloud搭建完成后，就可以把它作为Omni的同步服务器了，具体方法如下：\n\n打开OmniFocus的同步设置页面，选择WebDAV方式同步，然后在Address中填入如下地址：\n\n> http://<serveraddress>/owncloud/remote.php/dav/files/<adminname>\n\n<serveraddress>和<adminname>分别替换为你的服务器地址和刚才填的管理员用户名，如下图：\n\n![3](http://oldblog.shicishuzhai.com/264b1ec833e6078643e9c2f40b2bf7aa.png)\n\n然后点击“Sync Now”进行同步，会提示输入密码，输入刚才添加的管理员密码，然后就可以同步成功了。\n\n使用浏览器访问http://serveraddress/owncloud/ ，就可以看到刚刚同步上去的文件了，如下图：\n\n![4](http://oldblog.shicishuzhai.com/0da7c4ef259b48e8f608540c27091cbd.png)\n\n## ownCloud的一些其他应用\n\nownCloud还提供了多平台的客户端，包括iOS，Android，Mac，Windows等，你可以下载一个Mac客户端，然后设置一个同步文件夹，凡是放在这个文件夹里的文件，都会被自动同步到服务器上。如下图：\n\n![5](http://oldblog.shicishuzhai.com/d7b6c828536bab1e8fa5a69a12332ebf.png)\n\n我把Quiver的笔记数据也同步到了服务器上。\n\n## 结语\n\n其实ownCloud的功能还远不止这些，还有很多功能还待以后慢慢探索。\n\n类似ownCloud的还有一个叫[seafile](https://www.seafile.com/home/)的服务，两者的区别和优劣可以参考[这里](http://www.zhihu.com/question/23929945)。\n\n## 参考资料\n\n[ownCloud官方文档](https://doc.owncloud.org/server/9.1/admin_manual/contents.html)\n[ownCloud关于WebDAV使用的文档](https://doc.owncloud.org/server/9.1/user_manual/files/access_webdav.html)\n[使用OwnCloud创建私有云](http://jjliu.blog.ustc.edu.cn/198/)\n","slug":"使用ownCloud作为OmniFocus的云同步服务器","published":1,"updated":"2019-01-13T04:01:04.540Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjutyfmfq002cc4c9p0ig8cc3","content":"<p>平时一直使用OmniFocus作为自己的时间管理工具，但是由于我使用的是破解版的（正版太贵，买不起啊），同步就变成了一件很麻烦的事。OmniFocus提供了两种同步方式，如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/901f5c4cb502f3fc557e3c3cfa79ad2f.png\" alt=\"1\"></p>\n<p>一种是使用Omni官方的服务器同步，这种方式需要注册Omni官方账号，应该只有正版能用吧，我没有尝试；另一种方式是使用WebDAV进行同步，这里着重介绍第二种方式。</p>\n<p>本文主要分为以下几个部分：</p>\n<ol>\n<li>WebDAV简介</li>\n<li>ownCloud简介以及搭建方法</li>\n<li>使用ownCloud作为OmniFocus的同步服务器</li>\n<li>ownCloud的一些其他应用</li>\n</ol>\n<h2 id=\"WebDAV简介\"><a href=\"#WebDAV简介\" class=\"headerlink\" title=\"WebDAV简介\"></a>WebDAV简介</h2><p><a href=\"http://baike.baidu.com/link?url=pXeqnwgtPiYSKdYGX9YjBH_XeAJsH-aRkQqEYPsbkQwf9hlbnF9RSuAHvCMLboSuENx55T8J9Pd27E6ybo7Aba\" target=\"_blank\" rel=\"noopener\">WebDAV</a>是一种基于 HTTP 1.1协议的通讯协议，可以实现文件的同步。通俗来讲，我们可以利用WebDAV来实现类似百度云一样的网盘功能。</p>\n<p><a href=\"http://blog.sina.com.cn/s/blog_4834fe810101fw17.html\" target=\"_blank\" rel=\"noopener\">这里</a>有几个支持WebDAV协议的网盘，但是都是国外的，国内据我了解目前只有<a href=\"http://www.jianguoyun.com/s/campaign/cpclanding/main?sch=bdcpc_nutstore_off&amp;bdtj=1\" target=\"_blank\" rel=\"noopener\">坚果云</a>一家支持WebDAV。至于国内的各大网盘为什么都不支持WebDAV，可以看<a href=\"http://www.zhihu.com/question/21511143\" target=\"_blank\" rel=\"noopener\">这里</a>。</p>\n<p>最初我也本来打算使用国外的网盘来实现WebDAV，但是担心速度不理想，而且国外网盘的免费空间都很小，所以就放弃了。至于坚果云，我也没有去尝试。</p>\n<p>进一步Google，于是就找到了ownCloud。</p>\n<h2 id=\"ownCloud简介以及搭建方法\"><a href=\"#ownCloud简介以及搭建方法\" class=\"headerlink\" title=\"ownCloud简介以及搭建方法\"></a>ownCloud简介以及搭建方法</h2><p><a href=\"https://owncloud.org/\" target=\"_blank\" rel=\"noopener\">ownCloud</a>是一个来自KDE社区开发的免费软件，提供私人的Web服务。当前主要功能包括文件管理（内建文件分享）、音乐、日历、联系人等等，可在PC和服务器上运行。简单来说就是一个基于Php的自建网盘。</p>\n<p>下面就跟着我使用ownCloud一步一步搭建自己的私人网盘。</p>\n<h3 id=\"准备工作\"><a href=\"#准备工作\" class=\"headerlink\" title=\"准备工作\"></a>准备工作</h3><p>因为要把ownCloud搭建在服务器上，因此你需要有一个VPS，内存至少128M，越大越好，我这里使用的是<a href=\"https://bandwagonhost.com/clientarea.php?action=products\" target=\"_blank\" rel=\"noopener\">搬运工VPS</a>，如何购买VPS可以看我的<a href=\"http://liujinlongxa.com/2016/06/11/%E6%89%93%E9%80%A0%E8%87%AA%E5%B7%B1%E7%9A%84%E7%BF%BB%E5%A2%99VPS:%E6%90%AC%E8%BF%90%E5%B7%A5VPS%E8%B4%AD%E4%B9%B0%E4%BD%BF%E7%94%A8%E6%B5%81%E7%A8%8B%E5%85%A8%E8%AE%B0%E5%BD%95/\">这篇博客</a>。</p>\n<h3 id=\"1-安装PHP和MySQL环境\"><a href=\"#1-安装PHP和MySQL环境\" class=\"headerlink\" title=\"1. 安装PHP和MySQL环境\"></a>1. 安装PHP和MySQL环境</h3><p>由于ownCloud使用php实现的，所以需要在你服务器上安装PHP和MySQL环境，这个网上有很多教程，也可以参考ownCloud给出的<a href=\"https://doc.owncloud.org/server/9.1/admin_manual/installation/php_54_installation.html\" target=\"_blank\" rel=\"noopener\">官方教程</a>。</p>\n<h3 id=\"2-下载服务器源码\"><a href=\"#2-下载服务器源码\" class=\"headerlink\" title=\"2. 下载服务器源码\"></a>2. 下载服务器源码</h3><p>在任一文件夹下输入命令：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://download.owncloud.org/community/owncloud-9.1.0.tar.bz2</span><br><span class=\"line\">tar xvf owncloud-9.1.0.tar.bz2</span><br></pre></td></tr></table></figure>\n<p>然后改变owncloud这个文件的权限，命令如下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chmod 777 owncloud</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-添加管理员账号\"><a href=\"#3-添加管理员账号\" class=\"headerlink\" title=\"3. 添加管理员账号\"></a>3. 添加管理员账号</h3><p>使用浏览器访问地址<a href=\"http://serveraddress/owncloud/\" target=\"_blank\" rel=\"noopener\">http://serveraddress/owncloud/</a> (serveraddress即你服务器的ip地址)就可以看到如下页面：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/5de5eb45600b86bae8e2c0cfdaadb319.png\" alt=\"2\"></p>\n<p>在这里自定义一个管理员的账号和密码，然后点击FinishSetup，这样一个ownCloud就搭建完成了。</p>\n<h2 id=\"使用ownCloud作为OmniFocus的同步服务器\"><a href=\"#使用ownCloud作为OmniFocus的同步服务器\" class=\"headerlink\" title=\"使用ownCloud作为OmniFocus的同步服务器\"></a>使用ownCloud作为OmniFocus的同步服务器</h2><p>ownCloud搭建完成后，就可以把它作为Omni的同步服务器了，具体方法如下：</p>\n<p>打开OmniFocus的同步设置页面，选择WebDAV方式同步，然后在Address中填入如下地址：</p>\n<blockquote>\n<p>http://<serveraddress>/owncloud/remote.php/dav/files/<adminname></adminname></serveraddress></p>\n</blockquote>\n<p><serveraddress>和<adminname>分别替换为你的服务器地址和刚才填的管理员用户名，如下图：</adminname></serveraddress></p>\n<p><img src=\"http://oldblog.shicishuzhai.com/264b1ec833e6078643e9c2f40b2bf7aa.png\" alt=\"3\"></p>\n<p>然后点击“Sync Now”进行同步，会提示输入密码，输入刚才添加的管理员密码，然后就可以同步成功了。</p>\n<p>使用浏览器访问<a href=\"http://serveraddress/owncloud/\" target=\"_blank\" rel=\"noopener\">http://serveraddress/owncloud/</a> ，就可以看到刚刚同步上去的文件了，如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/0da7c4ef259b48e8f608540c27091cbd.png\" alt=\"4\"></p>\n<h2 id=\"ownCloud的一些其他应用\"><a href=\"#ownCloud的一些其他应用\" class=\"headerlink\" title=\"ownCloud的一些其他应用\"></a>ownCloud的一些其他应用</h2><p>ownCloud还提供了多平台的客户端，包括iOS，Android，Mac，Windows等，你可以下载一个Mac客户端，然后设置一个同步文件夹，凡是放在这个文件夹里的文件，都会被自动同步到服务器上。如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/d7b6c828536bab1e8fa5a69a12332ebf.png\" alt=\"5\"></p>\n<p>我把Quiver的笔记数据也同步到了服务器上。</p>\n<h2 id=\"结语\"><a href=\"#结语\" class=\"headerlink\" title=\"结语\"></a>结语</h2><p>其实ownCloud的功能还远不止这些，还有很多功能还待以后慢慢探索。</p>\n<p>类似ownCloud的还有一个叫<a href=\"https://www.seafile.com/home/\" target=\"_blank\" rel=\"noopener\">seafile</a>的服务，两者的区别和优劣可以参考<a href=\"http://www.zhihu.com/question/23929945\" target=\"_blank\" rel=\"noopener\">这里</a>。</p>\n<h2 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h2><p><a href=\"https://doc.owncloud.org/server/9.1/admin_manual/contents.html\" target=\"_blank\" rel=\"noopener\">ownCloud官方文档</a><br><a href=\"https://doc.owncloud.org/server/9.1/user_manual/files/access_webdav.html\" target=\"_blank\" rel=\"noopener\">ownCloud关于WebDAV使用的文档</a><br><a href=\"http://jjliu.blog.ustc.edu.cn/198/\" target=\"_blank\" rel=\"noopener\">使用OwnCloud创建私有云</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>平时一直使用OmniFocus作为自己的时间管理工具，但是由于我使用的是破解版的（正版太贵，买不起啊），同步就变成了一件很麻烦的事。OmniFocus提供了两种同步方式，如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/901f5c4cb502f3fc557e3c3cfa79ad2f.png\" alt=\"1\"></p>\n<p>一种是使用Omni官方的服务器同步，这种方式需要注册Omni官方账号，应该只有正版能用吧，我没有尝试；另一种方式是使用WebDAV进行同步，这里着重介绍第二种方式。</p>\n<p>本文主要分为以下几个部分：</p>\n<ol>\n<li>WebDAV简介</li>\n<li>ownCloud简介以及搭建方法</li>\n<li>使用ownCloud作为OmniFocus的同步服务器</li>\n<li>ownCloud的一些其他应用</li>\n</ol>\n<h2 id=\"WebDAV简介\"><a href=\"#WebDAV简介\" class=\"headerlink\" title=\"WebDAV简介\"></a>WebDAV简介</h2><p><a href=\"http://baike.baidu.com/link?url=pXeqnwgtPiYSKdYGX9YjBH_XeAJsH-aRkQqEYPsbkQwf9hlbnF9RSuAHvCMLboSuENx55T8J9Pd27E6ybo7Aba\" target=\"_blank\" rel=\"noopener\">WebDAV</a>是一种基于 HTTP 1.1协议的通讯协议，可以实现文件的同步。通俗来讲，我们可以利用WebDAV来实现类似百度云一样的网盘功能。</p>\n<p><a href=\"http://blog.sina.com.cn/s/blog_4834fe810101fw17.html\" target=\"_blank\" rel=\"noopener\">这里</a>有几个支持WebDAV协议的网盘，但是都是国外的，国内据我了解目前只有<a href=\"http://www.jianguoyun.com/s/campaign/cpclanding/main?sch=bdcpc_nutstore_off&amp;bdtj=1\" target=\"_blank\" rel=\"noopener\">坚果云</a>一家支持WebDAV。至于国内的各大网盘为什么都不支持WebDAV，可以看<a href=\"http://www.zhihu.com/question/21511143\" target=\"_blank\" rel=\"noopener\">这里</a>。</p>\n<p>最初我也本来打算使用国外的网盘来实现WebDAV，但是担心速度不理想，而且国外网盘的免费空间都很小，所以就放弃了。至于坚果云，我也没有去尝试。</p>\n<p>进一步Google，于是就找到了ownCloud。</p>\n<h2 id=\"ownCloud简介以及搭建方法\"><a href=\"#ownCloud简介以及搭建方法\" class=\"headerlink\" title=\"ownCloud简介以及搭建方法\"></a>ownCloud简介以及搭建方法</h2><p><a href=\"https://owncloud.org/\" target=\"_blank\" rel=\"noopener\">ownCloud</a>是一个来自KDE社区开发的免费软件，提供私人的Web服务。当前主要功能包括文件管理（内建文件分享）、音乐、日历、联系人等等，可在PC和服务器上运行。简单来说就是一个基于Php的自建网盘。</p>\n<p>下面就跟着我使用ownCloud一步一步搭建自己的私人网盘。</p>\n<h3 id=\"准备工作\"><a href=\"#准备工作\" class=\"headerlink\" title=\"准备工作\"></a>准备工作</h3><p>因为要把ownCloud搭建在服务器上，因此你需要有一个VPS，内存至少128M，越大越好，我这里使用的是<a href=\"https://bandwagonhost.com/clientarea.php?action=products\" target=\"_blank\" rel=\"noopener\">搬运工VPS</a>，如何购买VPS可以看我的<a href=\"http://liujinlongxa.com/2016/06/11/%E6%89%93%E9%80%A0%E8%87%AA%E5%B7%B1%E7%9A%84%E7%BF%BB%E5%A2%99VPS:%E6%90%AC%E8%BF%90%E5%B7%A5VPS%E8%B4%AD%E4%B9%B0%E4%BD%BF%E7%94%A8%E6%B5%81%E7%A8%8B%E5%85%A8%E8%AE%B0%E5%BD%95/\">这篇博客</a>。</p>\n<h3 id=\"1-安装PHP和MySQL环境\"><a href=\"#1-安装PHP和MySQL环境\" class=\"headerlink\" title=\"1. 安装PHP和MySQL环境\"></a>1. 安装PHP和MySQL环境</h3><p>由于ownCloud使用php实现的，所以需要在你服务器上安装PHP和MySQL环境，这个网上有很多教程，也可以参考ownCloud给出的<a href=\"https://doc.owncloud.org/server/9.1/admin_manual/installation/php_54_installation.html\" target=\"_blank\" rel=\"noopener\">官方教程</a>。</p>\n<h3 id=\"2-下载服务器源码\"><a href=\"#2-下载服务器源码\" class=\"headerlink\" title=\"2. 下载服务器源码\"></a>2. 下载服务器源码</h3><p>在任一文件夹下输入命令：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://download.owncloud.org/community/owncloud-9.1.0.tar.bz2</span><br><span class=\"line\">tar xvf owncloud-9.1.0.tar.bz2</span><br></pre></td></tr></table></figure>\n<p>然后改变owncloud这个文件的权限，命令如下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chmod 777 owncloud</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-添加管理员账号\"><a href=\"#3-添加管理员账号\" class=\"headerlink\" title=\"3. 添加管理员账号\"></a>3. 添加管理员账号</h3><p>使用浏览器访问地址<a href=\"http://serveraddress/owncloud/\" target=\"_blank\" rel=\"noopener\">http://serveraddress/owncloud/</a> (serveraddress即你服务器的ip地址)就可以看到如下页面：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/5de5eb45600b86bae8e2c0cfdaadb319.png\" alt=\"2\"></p>\n<p>在这里自定义一个管理员的账号和密码，然后点击FinishSetup，这样一个ownCloud就搭建完成了。</p>\n<h2 id=\"使用ownCloud作为OmniFocus的同步服务器\"><a href=\"#使用ownCloud作为OmniFocus的同步服务器\" class=\"headerlink\" title=\"使用ownCloud作为OmniFocus的同步服务器\"></a>使用ownCloud作为OmniFocus的同步服务器</h2><p>ownCloud搭建完成后，就可以把它作为Omni的同步服务器了，具体方法如下：</p>\n<p>打开OmniFocus的同步设置页面，选择WebDAV方式同步，然后在Address中填入如下地址：</p>\n<blockquote>\n<p>http://<serveraddress>/owncloud/remote.php/dav/files/<adminname></adminname></serveraddress></p>\n</blockquote>\n<p><serveraddress>和<adminname>分别替换为你的服务器地址和刚才填的管理员用户名，如下图：</adminname></serveraddress></p>\n<p><img src=\"http://oldblog.shicishuzhai.com/264b1ec833e6078643e9c2f40b2bf7aa.png\" alt=\"3\"></p>\n<p>然后点击“Sync Now”进行同步，会提示输入密码，输入刚才添加的管理员密码，然后就可以同步成功了。</p>\n<p>使用浏览器访问<a href=\"http://serveraddress/owncloud/\" target=\"_blank\" rel=\"noopener\">http://serveraddress/owncloud/</a> ，就可以看到刚刚同步上去的文件了，如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/0da7c4ef259b48e8f608540c27091cbd.png\" alt=\"4\"></p>\n<h2 id=\"ownCloud的一些其他应用\"><a href=\"#ownCloud的一些其他应用\" class=\"headerlink\" title=\"ownCloud的一些其他应用\"></a>ownCloud的一些其他应用</h2><p>ownCloud还提供了多平台的客户端，包括iOS，Android，Mac，Windows等，你可以下载一个Mac客户端，然后设置一个同步文件夹，凡是放在这个文件夹里的文件，都会被自动同步到服务器上。如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/d7b6c828536bab1e8fa5a69a12332ebf.png\" alt=\"5\"></p>\n<p>我把Quiver的笔记数据也同步到了服务器上。</p>\n<h2 id=\"结语\"><a href=\"#结语\" class=\"headerlink\" title=\"结语\"></a>结语</h2><p>其实ownCloud的功能还远不止这些，还有很多功能还待以后慢慢探索。</p>\n<p>类似ownCloud的还有一个叫<a href=\"https://www.seafile.com/home/\" target=\"_blank\" rel=\"noopener\">seafile</a>的服务，两者的区别和优劣可以参考<a href=\"http://www.zhihu.com/question/23929945\" target=\"_blank\" rel=\"noopener\">这里</a>。</p>\n<h2 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h2><p><a href=\"https://doc.owncloud.org/server/9.1/admin_manual/contents.html\" target=\"_blank\" rel=\"noopener\">ownCloud官方文档</a><br><a href=\"https://doc.owncloud.org/server/9.1/user_manual/files/access_webdav.html\" target=\"_blank\" rel=\"noopener\">ownCloud关于WebDAV使用的文档</a><br><a href=\"http://jjliu.blog.ustc.edu.cn/198/\" target=\"_blank\" rel=\"noopener\">使用OwnCloud创建私有云</a></p>\n"},{"title":"做模糊效果时遇到的问题","date":"2016-08-30T14:51:53.000Z","_content":"\n最近在做图片模糊效果时遇到了一个很奇怪的问题，在iPhone6/iPhone6s上显示的模糊效果如下：\n\n![1](http://oldblog.shicishuzhai.com/4661eedc0a33e9c4535d95a005bde5d2.png)\n\n但是在iPhone6 plus和iPhone6s plus上的模糊效果就如下图：\n\n![2](http://oldblog.shicishuzhai.com/e31355553287234ae1b78b6ea88389ac.png)\n\n这明显效果不对，好像没有模糊一样。于是Google一些资料，终于找到了解决方法，解决方法是，在6Plus上不能设置过大的模糊半径，如果模糊半径过大，就会出现上图的效果。这和我使用的\"UIImage+ImageEffects.h\"也有关。\n\n原先设置的模糊半径为52，现在改成了在6Plus和6sPlus上是45，在6和6s上还是52，这样就没问题了。\n\n参考资料：\n\n[applyBlurWithRadius working on iPhone 6, not 6+ (UIImage+ImageEffects)](http://stackoverflow.com/questions/26002970/applyblurwithradius-working-on-iphone-6-not-6-uiimageimageeffects)\n","source":"_posts/2016-08-30-做模糊效果时遇到的问题.md","raw":"---\ntitle: 做模糊效果时遇到的问题\ncategories: iOS Tips\ntags:\n  - 其他\ndate: 2016-08-30 22:51:53\n---\n\n最近在做图片模糊效果时遇到了一个很奇怪的问题，在iPhone6/iPhone6s上显示的模糊效果如下：\n\n![1](http://oldblog.shicishuzhai.com/4661eedc0a33e9c4535d95a005bde5d2.png)\n\n但是在iPhone6 plus和iPhone6s plus上的模糊效果就如下图：\n\n![2](http://oldblog.shicishuzhai.com/e31355553287234ae1b78b6ea88389ac.png)\n\n这明显效果不对，好像没有模糊一样。于是Google一些资料，终于找到了解决方法，解决方法是，在6Plus上不能设置过大的模糊半径，如果模糊半径过大，就会出现上图的效果。这和我使用的\"UIImage+ImageEffects.h\"也有关。\n\n原先设置的模糊半径为52，现在改成了在6Plus和6sPlus上是45，在6和6s上还是52，这样就没问题了。\n\n参考资料：\n\n[applyBlurWithRadius working on iPhone 6, not 6+ (UIImage+ImageEffects)](http://stackoverflow.com/questions/26002970/applyblurwithradius-working-on-iphone-6-not-6-uiimageimageeffects)\n","slug":"做模糊效果时遇到的问题","published":1,"updated":"2019-01-13T04:01:04.529Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjutyfmfr002gc4c9lc9dk245","content":"<p>最近在做图片模糊效果时遇到了一个很奇怪的问题，在iPhone6/iPhone6s上显示的模糊效果如下：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/4661eedc0a33e9c4535d95a005bde5d2.png\" alt=\"1\"></p>\n<p>但是在iPhone6 plus和iPhone6s plus上的模糊效果就如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/e31355553287234ae1b78b6ea88389ac.png\" alt=\"2\"></p>\n<p>这明显效果不对，好像没有模糊一样。于是Google一些资料，终于找到了解决方法，解决方法是，在6Plus上不能设置过大的模糊半径，如果模糊半径过大，就会出现上图的效果。这和我使用的”UIImage+ImageEffects.h”也有关。</p>\n<p>原先设置的模糊半径为52，现在改成了在6Plus和6sPlus上是45，在6和6s上还是52，这样就没问题了。</p>\n<p>参考资料：</p>\n<p><a href=\"http://stackoverflow.com/questions/26002970/applyblurwithradius-working-on-iphone-6-not-6-uiimageimageeffects\" target=\"_blank\" rel=\"noopener\">applyBlurWithRadius working on iPhone 6, not 6+ (UIImage+ImageEffects)</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>最近在做图片模糊效果时遇到了一个很奇怪的问题，在iPhone6/iPhone6s上显示的模糊效果如下：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/4661eedc0a33e9c4535d95a005bde5d2.png\" alt=\"1\"></p>\n<p>但是在iPhone6 plus和iPhone6s plus上的模糊效果就如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/e31355553287234ae1b78b6ea88389ac.png\" alt=\"2\"></p>\n<p>这明显效果不对，好像没有模糊一样。于是Google一些资料，终于找到了解决方法，解决方法是，在6Plus上不能设置过大的模糊半径，如果模糊半径过大，就会出现上图的效果。这和我使用的”UIImage+ImageEffects.h”也有关。</p>\n<p>原先设置的模糊半径为52，现在改成了在6Plus和6sPlus上是45，在6和6s上还是52，这样就没问题了。</p>\n<p>参考资料：</p>\n<p><a href=\"http://stackoverflow.com/questions/26002970/applyblurwithradius-working-on-iphone-6-not-6-uiimageimageeffects\" target=\"_blank\" rel=\"noopener\">applyBlurWithRadius working on iPhone 6, not 6+ (UIImage+ImageEffects)</a></p>\n"},{"title":"iOS多环境配置实践","date":"2016-10-07T02:04:43.000Z","_content":"\n## 前言\n\n在移动客户端开发过程中，服务器一般都会提供多个环境的API接口，例如测试环境(TEST_ENV)，发布环境(RELEASE_ENV)，预发布环境(PRERELEASE_ENV)等，我们客户端在打包的时候需要在不同的阶段打不同环境的包，最简单的做法就是在代码里直接修改URL来切换不同的环境。但是这种做法太Low了，而且也不易于使用脚本自动打包。本文的主要内容就是介绍一种不修改代码达到配置不同环境的方法。\n\n## 明确需求\n\n在开始主要内容之前，先明确一下需求：\n\n1. 服务器有三个环境，测试环境(TEST_ENV)，发布环境(RELEASE_ENV)，预发布环境(PRERELEASE_ENV)，要求要很方便的实现在三个不同环境之间自由切换\n2. 代码中大量使用了DEBUG宏，因此要求每个环境都应该区分DEBUG和RELEASE，即在任一环境下都可能需要打DEBUG包或RELEASE包\n\n为此，我编写了一份测试代码：\n\n```objectievc\n#if TEST_ENV // 测试环境\n#if DEBUG\n    NSLog(@\"hello test env debug\");\n#else\n    NSLog(@\"hello test env release\");\n#endif\n#endif\n\n#if RELEASE_ENV // 发布环境\n#if DEBUG\n    NSLog(@\"hello release env debug\");\n#else\n    NSLog(@\"hello release env release\");\n#endif\n#endif\n\n#if PRERELEASE_ENV // 预发布环境\n#if DEBUG\n    NSLog(@\"hello pre-relase env debug\");\n#else\n    NSLog(@\"hello pre-relase env release\");\n#endif\n#endif\n```\n\n## 具体步骤\n\n### 1. 为每一个环境创建一个Target\n\n创建项目后，项目本身就会有一个Target（如果不了解Target的概念可以看一下[这篇官方文档](https://developer.apple.com/library/content/featuredarticles/XcodeConcepts/Concept-Targets.html)）,我们可以把这个Target就作为某一个环境的Target，这里我们把它作为发布环境的Target，然后还需要创建测试环境和预发布环境的Target，方法如下：\n\n在项目配置界面左侧，选中Target，点击右键，选择\"Duplicate\"，复制一个新的Target，如下图：\n\n![1](http://oldblog.shicishuzhai.com/ec6ceac9d953c320c0cbf0bfe55ee361.png)\n\n然后在弹出的菜单中点击\"Duplicate Only\"\n\n![2](http://oldblog.shicishuzhai.com/463b4e2b32269ab485d9f160315e1d75.png)\n\n这样就创建好了一个新的Target。新的Target的默认名称为\"项目名称 copy\"，即\"Test1007 copy\"，单击新创建的Target，修改Target名称为\"Test1007_Test\"，将这个Target作为测试环境的Target。\n\n![3](http://oldblog.shicishuzhai.com/4e99d383134b80176fedbe7853327b6f.png)\n\n创建完Target后，XCode会自动为这个Target创建一个Scheme，为了方便起见，也将这个Scheme的名称修改为\"Test1007_Test\"，方法是在左上角点击\"Manage Schemes...\"，单机要修改名称的Scheme，即可修改Scheme的名称。\n\n![4](http://oldblog.shicishuzhai.com/32c4abd9100ed10efbebda4f876c5939.png)\n\n同样的方法，在创建一个名为\"Test1007_Prerelease\"的Target作为预发布环境的Target。\n\n![5](http://oldblog.shicishuzhai.com/640b7eebdbb792330544b5211110f278.png)\n\n### 2. 配置环境变量\n\n配置环境变量，就是添加TEST_ENV，RELEASE_ENV和PRERELEASE_ENV这三个宏，这一步在ObjectiveC下和Swift是不一样的，这里会分别讲解\n\n#### ObjectiveC下配置环境变量\n\n在项目配置界面选择发布环境的Target \"Test1007\"，点击Build Settings，找到Preprocessor Macros，在Debug和Release下都添加环境变量\"RELEASE_ENV=1\"，如图：\n\n![6](http://oldblog.shicishuzhai.com/e685c55dc756723ecd8a2d513efca11e.png)\n\n添加完成后结果如图：\n\n![7](http://oldblog.shicishuzhai.com/60989466ad3f7b1b1e272210c2fafe8d.png)\n\n这样就为发布环境添加好了\"RELEASE_ENV\"宏。\n\n同样的方法，分别在Target \"Test1007_Test\"和\"Test1007_Prerelease\"添加TEST_ENV和PRERELEASE_ENV这两个宏。\n\n#### Swift下配置环境变量\n\n在项目配置界面选择发布环境的Target \"Test1007\"，点击Build Settings，找到Other Swift Flags，在Debug和Release下都添加环境变量\"-D RELEASE_ENV\"，如图：\n\n![8](http://oldblog.shicishuzhai.com/d7ec2f7e6073166d15fc64d488b42fcb.png)\n\n添加完成后如图：\n\n![9](http://oldblog.shicishuzhai.com/2697bee36a116092b03257cfca9bf774.png)\n\n同样的方法，分别在Target \"Test1007_Test\"和\"Test1007_Prerelease\"下添加TEST_ENV和PRERELEASE_ENV这两个宏。\n\n这样就完成了环境变量的配置。\n\n### 3. 为不同环境的包配置不同的名称，BundleId和图标\n\n其实到这一步就已经完成了不同环境的配置，要切换环境，只需要切换左上角的Scheme就可以了。为了更好的区分不同环境下的包，可以给每个环境配置不同的App名称，BundleId和App图标，方法如下：\n\n在项目配置界面选中一个Target，通过修改Display Name和Bundle Identifier可以为不同环境的包设置不同的App名称和BundleId。\n\n![10](http://oldblog.shicishuzhai.com/98681390ae672ce58b2a541c3068e4c6.png)\n\n要设置不同的图标，需要在Build Settings里找到\"Asset Calalog App Icon Set Name\"，其默认值是AppIcon，可以为不同Target设置不同的Icon Set Name，然后在Assets.xcassets中添加对应的Image Set即可。\n\n![11](http://oldblog.shicishuzhai.com/a9fa6a0db2bccb6d5945fe5c3f4d8360.png)\n\n## 总结\n\n本文是通过多个Target来实现多环境配置的，其实除了本文介绍的方法，还有其他方法可以实现多环境配置，具体可以参考[这篇文章](http://www.jianshu.com/p/83b6e781eb51)。\n\n有了多环境配置，就可以很方便的实现多环境自动打包，如果在加入持续集成系统（例如jenkins等），就可以非常优雅的打包。这个以后有时间会专门写一篇博客来介绍相关内容。\n\n参考资料：\n[手把手教你给一个iOS app配置多个环境变量](http://www.jianshu.com/p/83b6e781eb51)\n[iOS开发必备--环境变量配置(Debug & Release)](http://www.cocoachina.com/ios/20151023/13869.html)\n[Xcode Project Configuration](http://kevindelord.io/2016/06/08/project-configuration/)\n","source":"_posts/2016-10-07-iOS多环境配置实践.md","raw":"---\ntitle: iOS多环境配置实践\ncategories: iOS开发\ntags:\n  - Target\n  - Scheme\ndate: 2016-10-07 10:04:43\n---\n\n## 前言\n\n在移动客户端开发过程中，服务器一般都会提供多个环境的API接口，例如测试环境(TEST_ENV)，发布环境(RELEASE_ENV)，预发布环境(PRERELEASE_ENV)等，我们客户端在打包的时候需要在不同的阶段打不同环境的包，最简单的做法就是在代码里直接修改URL来切换不同的环境。但是这种做法太Low了，而且也不易于使用脚本自动打包。本文的主要内容就是介绍一种不修改代码达到配置不同环境的方法。\n\n## 明确需求\n\n在开始主要内容之前，先明确一下需求：\n\n1. 服务器有三个环境，测试环境(TEST_ENV)，发布环境(RELEASE_ENV)，预发布环境(PRERELEASE_ENV)，要求要很方便的实现在三个不同环境之间自由切换\n2. 代码中大量使用了DEBUG宏，因此要求每个环境都应该区分DEBUG和RELEASE，即在任一环境下都可能需要打DEBUG包或RELEASE包\n\n为此，我编写了一份测试代码：\n\n```objectievc\n#if TEST_ENV // 测试环境\n#if DEBUG\n    NSLog(@\"hello test env debug\");\n#else\n    NSLog(@\"hello test env release\");\n#endif\n#endif\n\n#if RELEASE_ENV // 发布环境\n#if DEBUG\n    NSLog(@\"hello release env debug\");\n#else\n    NSLog(@\"hello release env release\");\n#endif\n#endif\n\n#if PRERELEASE_ENV // 预发布环境\n#if DEBUG\n    NSLog(@\"hello pre-relase env debug\");\n#else\n    NSLog(@\"hello pre-relase env release\");\n#endif\n#endif\n```\n\n## 具体步骤\n\n### 1. 为每一个环境创建一个Target\n\n创建项目后，项目本身就会有一个Target（如果不了解Target的概念可以看一下[这篇官方文档](https://developer.apple.com/library/content/featuredarticles/XcodeConcepts/Concept-Targets.html)）,我们可以把这个Target就作为某一个环境的Target，这里我们把它作为发布环境的Target，然后还需要创建测试环境和预发布环境的Target，方法如下：\n\n在项目配置界面左侧，选中Target，点击右键，选择\"Duplicate\"，复制一个新的Target，如下图：\n\n![1](http://oldblog.shicishuzhai.com/ec6ceac9d953c320c0cbf0bfe55ee361.png)\n\n然后在弹出的菜单中点击\"Duplicate Only\"\n\n![2](http://oldblog.shicishuzhai.com/463b4e2b32269ab485d9f160315e1d75.png)\n\n这样就创建好了一个新的Target。新的Target的默认名称为\"项目名称 copy\"，即\"Test1007 copy\"，单击新创建的Target，修改Target名称为\"Test1007_Test\"，将这个Target作为测试环境的Target。\n\n![3](http://oldblog.shicishuzhai.com/4e99d383134b80176fedbe7853327b6f.png)\n\n创建完Target后，XCode会自动为这个Target创建一个Scheme，为了方便起见，也将这个Scheme的名称修改为\"Test1007_Test\"，方法是在左上角点击\"Manage Schemes...\"，单机要修改名称的Scheme，即可修改Scheme的名称。\n\n![4](http://oldblog.shicishuzhai.com/32c4abd9100ed10efbebda4f876c5939.png)\n\n同样的方法，在创建一个名为\"Test1007_Prerelease\"的Target作为预发布环境的Target。\n\n![5](http://oldblog.shicishuzhai.com/640b7eebdbb792330544b5211110f278.png)\n\n### 2. 配置环境变量\n\n配置环境变量，就是添加TEST_ENV，RELEASE_ENV和PRERELEASE_ENV这三个宏，这一步在ObjectiveC下和Swift是不一样的，这里会分别讲解\n\n#### ObjectiveC下配置环境变量\n\n在项目配置界面选择发布环境的Target \"Test1007\"，点击Build Settings，找到Preprocessor Macros，在Debug和Release下都添加环境变量\"RELEASE_ENV=1\"，如图：\n\n![6](http://oldblog.shicishuzhai.com/e685c55dc756723ecd8a2d513efca11e.png)\n\n添加完成后结果如图：\n\n![7](http://oldblog.shicishuzhai.com/60989466ad3f7b1b1e272210c2fafe8d.png)\n\n这样就为发布环境添加好了\"RELEASE_ENV\"宏。\n\n同样的方法，分别在Target \"Test1007_Test\"和\"Test1007_Prerelease\"添加TEST_ENV和PRERELEASE_ENV这两个宏。\n\n#### Swift下配置环境变量\n\n在项目配置界面选择发布环境的Target \"Test1007\"，点击Build Settings，找到Other Swift Flags，在Debug和Release下都添加环境变量\"-D RELEASE_ENV\"，如图：\n\n![8](http://oldblog.shicishuzhai.com/d7ec2f7e6073166d15fc64d488b42fcb.png)\n\n添加完成后如图：\n\n![9](http://oldblog.shicishuzhai.com/2697bee36a116092b03257cfca9bf774.png)\n\n同样的方法，分别在Target \"Test1007_Test\"和\"Test1007_Prerelease\"下添加TEST_ENV和PRERELEASE_ENV这两个宏。\n\n这样就完成了环境变量的配置。\n\n### 3. 为不同环境的包配置不同的名称，BundleId和图标\n\n其实到这一步就已经完成了不同环境的配置，要切换环境，只需要切换左上角的Scheme就可以了。为了更好的区分不同环境下的包，可以给每个环境配置不同的App名称，BundleId和App图标，方法如下：\n\n在项目配置界面选中一个Target，通过修改Display Name和Bundle Identifier可以为不同环境的包设置不同的App名称和BundleId。\n\n![10](http://oldblog.shicishuzhai.com/98681390ae672ce58b2a541c3068e4c6.png)\n\n要设置不同的图标，需要在Build Settings里找到\"Asset Calalog App Icon Set Name\"，其默认值是AppIcon，可以为不同Target设置不同的Icon Set Name，然后在Assets.xcassets中添加对应的Image Set即可。\n\n![11](http://oldblog.shicishuzhai.com/a9fa6a0db2bccb6d5945fe5c3f4d8360.png)\n\n## 总结\n\n本文是通过多个Target来实现多环境配置的，其实除了本文介绍的方法，还有其他方法可以实现多环境配置，具体可以参考[这篇文章](http://www.jianshu.com/p/83b6e781eb51)。\n\n有了多环境配置，就可以很方便的实现多环境自动打包，如果在加入持续集成系统（例如jenkins等），就可以非常优雅的打包。这个以后有时间会专门写一篇博客来介绍相关内容。\n\n参考资料：\n[手把手教你给一个iOS app配置多个环境变量](http://www.jianshu.com/p/83b6e781eb51)\n[iOS开发必备--环境变量配置(Debug & Release)](http://www.cocoachina.com/ios/20151023/13869.html)\n[Xcode Project Configuration](http://kevindelord.io/2016/06/08/project-configuration/)\n","slug":"iOS多环境配置实践","published":1,"updated":"2019-01-13T04:01:04.469Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjutyfmfs002jc4c9hai1b6ur","content":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>在移动客户端开发过程中，服务器一般都会提供多个环境的API接口，例如测试环境(TEST_ENV)，发布环境(RELEASE_ENV)，预发布环境(PRERELEASE_ENV)等，我们客户端在打包的时候需要在不同的阶段打不同环境的包，最简单的做法就是在代码里直接修改URL来切换不同的环境。但是这种做法太Low了，而且也不易于使用脚本自动打包。本文的主要内容就是介绍一种不修改代码达到配置不同环境的方法。</p>\n<h2 id=\"明确需求\"><a href=\"#明确需求\" class=\"headerlink\" title=\"明确需求\"></a>明确需求</h2><p>在开始主要内容之前，先明确一下需求：</p>\n<ol>\n<li>服务器有三个环境，测试环境(TEST_ENV)，发布环境(RELEASE_ENV)，预发布环境(PRERELEASE_ENV)，要求要很方便的实现在三个不同环境之间自由切换</li>\n<li>代码中大量使用了DEBUG宏，因此要求每个环境都应该区分DEBUG和RELEASE，即在任一环境下都可能需要打DEBUG包或RELEASE包</li>\n</ol>\n<p>为此，我编写了一份测试代码：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#if TEST_ENV // 测试环境</span><br><span class=\"line\">#if DEBUG</span><br><span class=\"line\">    NSLog(@&quot;hello test env debug&quot;);</span><br><span class=\"line\">#else</span><br><span class=\"line\">    NSLog(@&quot;hello test env release&quot;);</span><br><span class=\"line\">#endif</span><br><span class=\"line\">#endif</span><br><span class=\"line\"></span><br><span class=\"line\">#if RELEASE_ENV // 发布环境</span><br><span class=\"line\">#if DEBUG</span><br><span class=\"line\">    NSLog(@&quot;hello release env debug&quot;);</span><br><span class=\"line\">#else</span><br><span class=\"line\">    NSLog(@&quot;hello release env release&quot;);</span><br><span class=\"line\">#endif</span><br><span class=\"line\">#endif</span><br><span class=\"line\"></span><br><span class=\"line\">#if PRERELEASE_ENV // 预发布环境</span><br><span class=\"line\">#if DEBUG</span><br><span class=\"line\">    NSLog(@&quot;hello pre-relase env debug&quot;);</span><br><span class=\"line\">#else</span><br><span class=\"line\">    NSLog(@&quot;hello pre-relase env release&quot;);</span><br><span class=\"line\">#endif</span><br><span class=\"line\">#endif</span><br></pre></td></tr></table></figure>\n<h2 id=\"具体步骤\"><a href=\"#具体步骤\" class=\"headerlink\" title=\"具体步骤\"></a>具体步骤</h2><h3 id=\"1-为每一个环境创建一个Target\"><a href=\"#1-为每一个环境创建一个Target\" class=\"headerlink\" title=\"1. 为每一个环境创建一个Target\"></a>1. 为每一个环境创建一个Target</h3><p>创建项目后，项目本身就会有一个Target（如果不了解Target的概念可以看一下<a href=\"https://developer.apple.com/library/content/featuredarticles/XcodeConcepts/Concept-Targets.html\" target=\"_blank\" rel=\"noopener\">这篇官方文档</a>）,我们可以把这个Target就作为某一个环境的Target，这里我们把它作为发布环境的Target，然后还需要创建测试环境和预发布环境的Target，方法如下：</p>\n<p>在项目配置界面左侧，选中Target，点击右键，选择”Duplicate”，复制一个新的Target，如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/ec6ceac9d953c320c0cbf0bfe55ee361.png\" alt=\"1\"></p>\n<p>然后在弹出的菜单中点击”Duplicate Only”</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/463b4e2b32269ab485d9f160315e1d75.png\" alt=\"2\"></p>\n<p>这样就创建好了一个新的Target。新的Target的默认名称为”项目名称 copy”，即”Test1007 copy”，单击新创建的Target，修改Target名称为”Test1007_Test”，将这个Target作为测试环境的Target。</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/4e99d383134b80176fedbe7853327b6f.png\" alt=\"3\"></p>\n<p>创建完Target后，XCode会自动为这个Target创建一个Scheme，为了方便起见，也将这个Scheme的名称修改为”Test1007_Test”，方法是在左上角点击”Manage Schemes…”，单机要修改名称的Scheme，即可修改Scheme的名称。</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/32c4abd9100ed10efbebda4f876c5939.png\" alt=\"4\"></p>\n<p>同样的方法，在创建一个名为”Test1007_Prerelease”的Target作为预发布环境的Target。</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/640b7eebdbb792330544b5211110f278.png\" alt=\"5\"></p>\n<h3 id=\"2-配置环境变量\"><a href=\"#2-配置环境变量\" class=\"headerlink\" title=\"2. 配置环境变量\"></a>2. 配置环境变量</h3><p>配置环境变量，就是添加TEST_ENV，RELEASE_ENV和PRERELEASE_ENV这三个宏，这一步在ObjectiveC下和Swift是不一样的，这里会分别讲解</p>\n<h4 id=\"ObjectiveC下配置环境变量\"><a href=\"#ObjectiveC下配置环境变量\" class=\"headerlink\" title=\"ObjectiveC下配置环境变量\"></a>ObjectiveC下配置环境变量</h4><p>在项目配置界面选择发布环境的Target “Test1007”，点击Build Settings，找到Preprocessor Macros，在Debug和Release下都添加环境变量”RELEASE_ENV=1”，如图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/e685c55dc756723ecd8a2d513efca11e.png\" alt=\"6\"></p>\n<p>添加完成后结果如图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/60989466ad3f7b1b1e272210c2fafe8d.png\" alt=\"7\"></p>\n<p>这样就为发布环境添加好了”RELEASE_ENV”宏。</p>\n<p>同样的方法，分别在Target “Test1007_Test”和”Test1007_Prerelease”添加TEST_ENV和PRERELEASE_ENV这两个宏。</p>\n<h4 id=\"Swift下配置环境变量\"><a href=\"#Swift下配置环境变量\" class=\"headerlink\" title=\"Swift下配置环境变量\"></a>Swift下配置环境变量</h4><p>在项目配置界面选择发布环境的Target “Test1007”，点击Build Settings，找到Other Swift Flags，在Debug和Release下都添加环境变量”-D RELEASE_ENV”，如图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/d7ec2f7e6073166d15fc64d488b42fcb.png\" alt=\"8\"></p>\n<p>添加完成后如图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/2697bee36a116092b03257cfca9bf774.png\" alt=\"9\"></p>\n<p>同样的方法，分别在Target “Test1007_Test”和”Test1007_Prerelease”下添加TEST_ENV和PRERELEASE_ENV这两个宏。</p>\n<p>这样就完成了环境变量的配置。</p>\n<h3 id=\"3-为不同环境的包配置不同的名称，BundleId和图标\"><a href=\"#3-为不同环境的包配置不同的名称，BundleId和图标\" class=\"headerlink\" title=\"3. 为不同环境的包配置不同的名称，BundleId和图标\"></a>3. 为不同环境的包配置不同的名称，BundleId和图标</h3><p>其实到这一步就已经完成了不同环境的配置，要切换环境，只需要切换左上角的Scheme就可以了。为了更好的区分不同环境下的包，可以给每个环境配置不同的App名称，BundleId和App图标，方法如下：</p>\n<p>在项目配置界面选中一个Target，通过修改Display Name和Bundle Identifier可以为不同环境的包设置不同的App名称和BundleId。</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/98681390ae672ce58b2a541c3068e4c6.png\" alt=\"10\"></p>\n<p>要设置不同的图标，需要在Build Settings里找到”Asset Calalog App Icon Set Name”，其默认值是AppIcon，可以为不同Target设置不同的Icon Set Name，然后在Assets.xcassets中添加对应的Image Set即可。</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/a9fa6a0db2bccb6d5945fe5c3f4d8360.png\" alt=\"11\"></p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>本文是通过多个Target来实现多环境配置的，其实除了本文介绍的方法，还有其他方法可以实现多环境配置，具体可以参考<a href=\"http://www.jianshu.com/p/83b6e781eb51\" target=\"_blank\" rel=\"noopener\">这篇文章</a>。</p>\n<p>有了多环境配置，就可以很方便的实现多环境自动打包，如果在加入持续集成系统（例如jenkins等），就可以非常优雅的打包。这个以后有时间会专门写一篇博客来介绍相关内容。</p>\n<p>参考资料：<br><a href=\"http://www.jianshu.com/p/83b6e781eb51\" target=\"_blank\" rel=\"noopener\">手把手教你给一个iOS app配置多个环境变量</a><br><a href=\"http://www.cocoachina.com/ios/20151023/13869.html\" target=\"_blank\" rel=\"noopener\">iOS开发必备–环境变量配置(Debug &amp; Release)</a><br><a href=\"http://kevindelord.io/2016/06/08/project-configuration/\" target=\"_blank\" rel=\"noopener\">Xcode Project Configuration</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>在移动客户端开发过程中，服务器一般都会提供多个环境的API接口，例如测试环境(TEST_ENV)，发布环境(RELEASE_ENV)，预发布环境(PRERELEASE_ENV)等，我们客户端在打包的时候需要在不同的阶段打不同环境的包，最简单的做法就是在代码里直接修改URL来切换不同的环境。但是这种做法太Low了，而且也不易于使用脚本自动打包。本文的主要内容就是介绍一种不修改代码达到配置不同环境的方法。</p>\n<h2 id=\"明确需求\"><a href=\"#明确需求\" class=\"headerlink\" title=\"明确需求\"></a>明确需求</h2><p>在开始主要内容之前，先明确一下需求：</p>\n<ol>\n<li>服务器有三个环境，测试环境(TEST_ENV)，发布环境(RELEASE_ENV)，预发布环境(PRERELEASE_ENV)，要求要很方便的实现在三个不同环境之间自由切换</li>\n<li>代码中大量使用了DEBUG宏，因此要求每个环境都应该区分DEBUG和RELEASE，即在任一环境下都可能需要打DEBUG包或RELEASE包</li>\n</ol>\n<p>为此，我编写了一份测试代码：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#if TEST_ENV // 测试环境</span><br><span class=\"line\">#if DEBUG</span><br><span class=\"line\">    NSLog(@&quot;hello test env debug&quot;);</span><br><span class=\"line\">#else</span><br><span class=\"line\">    NSLog(@&quot;hello test env release&quot;);</span><br><span class=\"line\">#endif</span><br><span class=\"line\">#endif</span><br><span class=\"line\"></span><br><span class=\"line\">#if RELEASE_ENV // 发布环境</span><br><span class=\"line\">#if DEBUG</span><br><span class=\"line\">    NSLog(@&quot;hello release env debug&quot;);</span><br><span class=\"line\">#else</span><br><span class=\"line\">    NSLog(@&quot;hello release env release&quot;);</span><br><span class=\"line\">#endif</span><br><span class=\"line\">#endif</span><br><span class=\"line\"></span><br><span class=\"line\">#if PRERELEASE_ENV // 预发布环境</span><br><span class=\"line\">#if DEBUG</span><br><span class=\"line\">    NSLog(@&quot;hello pre-relase env debug&quot;);</span><br><span class=\"line\">#else</span><br><span class=\"line\">    NSLog(@&quot;hello pre-relase env release&quot;);</span><br><span class=\"line\">#endif</span><br><span class=\"line\">#endif</span><br></pre></td></tr></table></figure>\n<h2 id=\"具体步骤\"><a href=\"#具体步骤\" class=\"headerlink\" title=\"具体步骤\"></a>具体步骤</h2><h3 id=\"1-为每一个环境创建一个Target\"><a href=\"#1-为每一个环境创建一个Target\" class=\"headerlink\" title=\"1. 为每一个环境创建一个Target\"></a>1. 为每一个环境创建一个Target</h3><p>创建项目后，项目本身就会有一个Target（如果不了解Target的概念可以看一下<a href=\"https://developer.apple.com/library/content/featuredarticles/XcodeConcepts/Concept-Targets.html\" target=\"_blank\" rel=\"noopener\">这篇官方文档</a>）,我们可以把这个Target就作为某一个环境的Target，这里我们把它作为发布环境的Target，然后还需要创建测试环境和预发布环境的Target，方法如下：</p>\n<p>在项目配置界面左侧，选中Target，点击右键，选择”Duplicate”，复制一个新的Target，如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/ec6ceac9d953c320c0cbf0bfe55ee361.png\" alt=\"1\"></p>\n<p>然后在弹出的菜单中点击”Duplicate Only”</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/463b4e2b32269ab485d9f160315e1d75.png\" alt=\"2\"></p>\n<p>这样就创建好了一个新的Target。新的Target的默认名称为”项目名称 copy”，即”Test1007 copy”，单击新创建的Target，修改Target名称为”Test1007_Test”，将这个Target作为测试环境的Target。</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/4e99d383134b80176fedbe7853327b6f.png\" alt=\"3\"></p>\n<p>创建完Target后，XCode会自动为这个Target创建一个Scheme，为了方便起见，也将这个Scheme的名称修改为”Test1007_Test”，方法是在左上角点击”Manage Schemes…”，单机要修改名称的Scheme，即可修改Scheme的名称。</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/32c4abd9100ed10efbebda4f876c5939.png\" alt=\"4\"></p>\n<p>同样的方法，在创建一个名为”Test1007_Prerelease”的Target作为预发布环境的Target。</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/640b7eebdbb792330544b5211110f278.png\" alt=\"5\"></p>\n<h3 id=\"2-配置环境变量\"><a href=\"#2-配置环境变量\" class=\"headerlink\" title=\"2. 配置环境变量\"></a>2. 配置环境变量</h3><p>配置环境变量，就是添加TEST_ENV，RELEASE_ENV和PRERELEASE_ENV这三个宏，这一步在ObjectiveC下和Swift是不一样的，这里会分别讲解</p>\n<h4 id=\"ObjectiveC下配置环境变量\"><a href=\"#ObjectiveC下配置环境变量\" class=\"headerlink\" title=\"ObjectiveC下配置环境变量\"></a>ObjectiveC下配置环境变量</h4><p>在项目配置界面选择发布环境的Target “Test1007”，点击Build Settings，找到Preprocessor Macros，在Debug和Release下都添加环境变量”RELEASE_ENV=1”，如图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/e685c55dc756723ecd8a2d513efca11e.png\" alt=\"6\"></p>\n<p>添加完成后结果如图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/60989466ad3f7b1b1e272210c2fafe8d.png\" alt=\"7\"></p>\n<p>这样就为发布环境添加好了”RELEASE_ENV”宏。</p>\n<p>同样的方法，分别在Target “Test1007_Test”和”Test1007_Prerelease”添加TEST_ENV和PRERELEASE_ENV这两个宏。</p>\n<h4 id=\"Swift下配置环境变量\"><a href=\"#Swift下配置环境变量\" class=\"headerlink\" title=\"Swift下配置环境变量\"></a>Swift下配置环境变量</h4><p>在项目配置界面选择发布环境的Target “Test1007”，点击Build Settings，找到Other Swift Flags，在Debug和Release下都添加环境变量”-D RELEASE_ENV”，如图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/d7ec2f7e6073166d15fc64d488b42fcb.png\" alt=\"8\"></p>\n<p>添加完成后如图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/2697bee36a116092b03257cfca9bf774.png\" alt=\"9\"></p>\n<p>同样的方法，分别在Target “Test1007_Test”和”Test1007_Prerelease”下添加TEST_ENV和PRERELEASE_ENV这两个宏。</p>\n<p>这样就完成了环境变量的配置。</p>\n<h3 id=\"3-为不同环境的包配置不同的名称，BundleId和图标\"><a href=\"#3-为不同环境的包配置不同的名称，BundleId和图标\" class=\"headerlink\" title=\"3. 为不同环境的包配置不同的名称，BundleId和图标\"></a>3. 为不同环境的包配置不同的名称，BundleId和图标</h3><p>其实到这一步就已经完成了不同环境的配置，要切换环境，只需要切换左上角的Scheme就可以了。为了更好的区分不同环境下的包，可以给每个环境配置不同的App名称，BundleId和App图标，方法如下：</p>\n<p>在项目配置界面选中一个Target，通过修改Display Name和Bundle Identifier可以为不同环境的包设置不同的App名称和BundleId。</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/98681390ae672ce58b2a541c3068e4c6.png\" alt=\"10\"></p>\n<p>要设置不同的图标，需要在Build Settings里找到”Asset Calalog App Icon Set Name”，其默认值是AppIcon，可以为不同Target设置不同的Icon Set Name，然后在Assets.xcassets中添加对应的Image Set即可。</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/a9fa6a0db2bccb6d5945fe5c3f4d8360.png\" alt=\"11\"></p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>本文是通过多个Target来实现多环境配置的，其实除了本文介绍的方法，还有其他方法可以实现多环境配置，具体可以参考<a href=\"http://www.jianshu.com/p/83b6e781eb51\" target=\"_blank\" rel=\"noopener\">这篇文章</a>。</p>\n<p>有了多环境配置，就可以很方便的实现多环境自动打包，如果在加入持续集成系统（例如jenkins等），就可以非常优雅的打包。这个以后有时间会专门写一篇博客来介绍相关内容。</p>\n<p>参考资料：<br><a href=\"http://www.jianshu.com/p/83b6e781eb51\" target=\"_blank\" rel=\"noopener\">手把手教你给一个iOS app配置多个环境变量</a><br><a href=\"http://www.cocoachina.com/ios/20151023/13869.html\" target=\"_blank\" rel=\"noopener\">iOS开发必备–环境变量配置(Debug &amp; Release)</a><br><a href=\"http://kevindelord.io/2016/06/08/project-configuration/\" target=\"_blank\" rel=\"noopener\">Xcode Project Configuration</a></p>\n"},{"title":"使用xUnique遇到了的问题","date":"2016-10-04T14:24:27.000Z","_content":"\nxUnique是一个用来对iOS向的*.xcodeproj文件进行排序的工具，它可以降低*.xcodeproj文件冲突的概率。其实质是一个Git Hook脚本，在提交一个Commit时，如果*.xcodeproj文件有修改，则会对文件进行重新排序。\n\n最近在使用时发现了一个问题，当我执行“pod install”安装第三方库时，在进行提交时会报\"File 'project.pbxproj' is broken. Cannot find PBXProject name.\"，从字面意思看'project.pbxproj'文件损坏，但是进入*.xcodeproj文件夹，双击‘project.pbxproj’，发现是可以打开的，并没有问题。\n\n最后通过查找资料，找到了原因，具体原因是由于在执行‘pod install’后，CocoaPods会重写‘project.pbxproj’文件，并且改变了它的格式，导致xUnique无法正确读取'project.pbxproj'文件。\n\n解决方法是：让xcode重新生成‘project.pbxproj’，具体步骤如下：\n\n1. 先关闭xUnique，然后提交代码。关闭xUnique的方法是打开“<项目仓库根目录>/.git/hooks/pre-commit”文件，注释掉xUnique有关的内容\n2. 做出任意一个可以导致'project.pbxproj'修改的修改，例如修改版本号，创建文件等，这样xcode会重写'project.pbxproj'文件\n3. 打开xUnique，提交代码，这时xUnique就可以识别'project.pbxproj'文件了\n\n参看文档：\n[File 'project.pbxproj' is broken. Cannot find PBXProject name.](https://github.com/truebit/xUnique/issues/34)\n","source":"_posts/2016-10-04-使用xUnique遇到了的问题.md","raw":"---\ntitle: 使用xUnique遇到了的问题\ncategories: iOS Tips\ntags:\n  - 其他\ndate: 2016-10-04 22:24:27\n---\n\nxUnique是一个用来对iOS向的*.xcodeproj文件进行排序的工具，它可以降低*.xcodeproj文件冲突的概率。其实质是一个Git Hook脚本，在提交一个Commit时，如果*.xcodeproj文件有修改，则会对文件进行重新排序。\n\n最近在使用时发现了一个问题，当我执行“pod install”安装第三方库时，在进行提交时会报\"File 'project.pbxproj' is broken. Cannot find PBXProject name.\"，从字面意思看'project.pbxproj'文件损坏，但是进入*.xcodeproj文件夹，双击‘project.pbxproj’，发现是可以打开的，并没有问题。\n\n最后通过查找资料，找到了原因，具体原因是由于在执行‘pod install’后，CocoaPods会重写‘project.pbxproj’文件，并且改变了它的格式，导致xUnique无法正确读取'project.pbxproj'文件。\n\n解决方法是：让xcode重新生成‘project.pbxproj’，具体步骤如下：\n\n1. 先关闭xUnique，然后提交代码。关闭xUnique的方法是打开“<项目仓库根目录>/.git/hooks/pre-commit”文件，注释掉xUnique有关的内容\n2. 做出任意一个可以导致'project.pbxproj'修改的修改，例如修改版本号，创建文件等，这样xcode会重写'project.pbxproj'文件\n3. 打开xUnique，提交代码，这时xUnique就可以识别'project.pbxproj'文件了\n\n参看文档：\n[File 'project.pbxproj' is broken. Cannot find PBXProject name.](https://github.com/truebit/xUnique/issues/34)\n","slug":"使用xUnique遇到了的问题","published":1,"updated":"2017-03-01T06:42:53.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjutyfmfu002mc4c9akzbp170","content":"<p>xUnique是一个用来对iOS向的<em>.xcodeproj文件进行排序的工具，它可以降低</em>.xcodeproj文件冲突的概率。其实质是一个Git Hook脚本，在提交一个Commit时，如果*.xcodeproj文件有修改，则会对文件进行重新排序。</p>\n<p>最近在使用时发现了一个问题，当我执行“pod install”安装第三方库时，在进行提交时会报”File ‘project.pbxproj’ is broken. Cannot find PBXProject name.”，从字面意思看’project.pbxproj’文件损坏，但是进入*.xcodeproj文件夹，双击‘project.pbxproj’，发现是可以打开的，并没有问题。</p>\n<p>最后通过查找资料，找到了原因，具体原因是由于在执行‘pod install’后，CocoaPods会重写‘project.pbxproj’文件，并且改变了它的格式，导致xUnique无法正确读取’project.pbxproj’文件。</p>\n<p>解决方法是：让xcode重新生成‘project.pbxproj’，具体步骤如下：</p>\n<ol>\n<li>先关闭xUnique，然后提交代码。关闭xUnique的方法是打开“&lt;项目仓库根目录&gt;/.git/hooks/pre-commit”文件，注释掉xUnique有关的内容</li>\n<li>做出任意一个可以导致’project.pbxproj’修改的修改，例如修改版本号，创建文件等，这样xcode会重写’project.pbxproj’文件</li>\n<li>打开xUnique，提交代码，这时xUnique就可以识别’project.pbxproj’文件了</li>\n</ol>\n<p>参看文档：<br><a href=\"https://github.com/truebit/xUnique/issues/34\" target=\"_blank\" rel=\"noopener\">File ‘project.pbxproj’ is broken. Cannot find PBXProject name.</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>xUnique是一个用来对iOS向的<em>.xcodeproj文件进行排序的工具，它可以降低</em>.xcodeproj文件冲突的概率。其实质是一个Git Hook脚本，在提交一个Commit时，如果*.xcodeproj文件有修改，则会对文件进行重新排序。</p>\n<p>最近在使用时发现了一个问题，当我执行“pod install”安装第三方库时，在进行提交时会报”File ‘project.pbxproj’ is broken. Cannot find PBXProject name.”，从字面意思看’project.pbxproj’文件损坏，但是进入*.xcodeproj文件夹，双击‘project.pbxproj’，发现是可以打开的，并没有问题。</p>\n<p>最后通过查找资料，找到了原因，具体原因是由于在执行‘pod install’后，CocoaPods会重写‘project.pbxproj’文件，并且改变了它的格式，导致xUnique无法正确读取’project.pbxproj’文件。</p>\n<p>解决方法是：让xcode重新生成‘project.pbxproj’，具体步骤如下：</p>\n<ol>\n<li>先关闭xUnique，然后提交代码。关闭xUnique的方法是打开“&lt;项目仓库根目录&gt;/.git/hooks/pre-commit”文件，注释掉xUnique有关的内容</li>\n<li>做出任意一个可以导致’project.pbxproj’修改的修改，例如修改版本号，创建文件等，这样xcode会重写’project.pbxproj’文件</li>\n<li>打开xUnique，提交代码，这时xUnique就可以识别’project.pbxproj’文件了</li>\n</ol>\n<p>参看文档：<br><a href=\"https://github.com/truebit/xUnique/issues/34\" target=\"_blank\" rel=\"noopener\">File ‘project.pbxproj’ is broken. Cannot find PBXProject name.</a></p>\n"},{"title":"如何获取WebView的UserAgent","date":"2016-10-25T03:46:04.000Z","_content":"\n项目中用到了WebView的UserAgent，可以通过以下方式获取到：\n\n```objectivec\nUIWebView* webView = [[UIWebView alloc] init];\nNSString* secretAgent = [webView stringByEvaluatingJavaScriptFromString:@\"navigator.userAgent\"];\n```\n\n如果是WKWebView，可以通过以下方式获取\n\n```objectivec\nWKWebView *webView = [[WKWebView alloc] init];\n[webView evaluateJavaScript:@\"navigator.userAgent\" completionHandler:^(id _Nullable userAgent, NSError * _Nullable error) {\n    NSLog(@\"userAgent: %@\", userAgent);\n}];\nself.webView = webView; // 注意，一定要对webView进行强引用\n```\n\n获取到的值的为：\n\n```\nMozilla/5.0 (iPhone; CPU iPhone OS 10_0_1 like Mac OS X) AppleWebKit/602.1.50 (KHTML, like Gecko) Mobile/14A403\n```\n","source":"_posts/2016-10-25-如何获取WebView的UserAgent.md","raw":"---\ntitle: 如何获取WebView的UserAgent\ncategories: iOS Tips\ntags:\n  - 其他\ndate: 2016-10-25 11:46:04\n---\n\n项目中用到了WebView的UserAgent，可以通过以下方式获取到：\n\n```objectivec\nUIWebView* webView = [[UIWebView alloc] init];\nNSString* secretAgent = [webView stringByEvaluatingJavaScriptFromString:@\"navigator.userAgent\"];\n```\n\n如果是WKWebView，可以通过以下方式获取\n\n```objectivec\nWKWebView *webView = [[WKWebView alloc] init];\n[webView evaluateJavaScript:@\"navigator.userAgent\" completionHandler:^(id _Nullable userAgent, NSError * _Nullable error) {\n    NSLog(@\"userAgent: %@\", userAgent);\n}];\nself.webView = webView; // 注意，一定要对webView进行强引用\n```\n\n获取到的值的为：\n\n```\nMozilla/5.0 (iPhone; CPU iPhone OS 10_0_1 like Mac OS X) AppleWebKit/602.1.50 (KHTML, like Gecko) Mobile/14A403\n```\n","slug":"如何获取WebView的UserAgent","published":1,"updated":"2017-03-01T06:42:53.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjutyfmfv002qc4c9ilpo5nmr","content":"<p>项目中用到了WebView的UserAgent，可以通过以下方式获取到：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">UIWebView</span>* webView = [[<span class=\"built_in\">UIWebView</span> alloc] init];</span><br><span class=\"line\"><span class=\"built_in\">NSString</span>* secretAgent = [webView stringByEvaluatingJavaScriptFromString:<span class=\"string\">@\"navigator.userAgent\"</span>];</span><br></pre></td></tr></table></figure>\n<p>如果是WKWebView，可以通过以下方式获取</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">WKWebView</span> *webView = [[<span class=\"built_in\">WKWebView</span> alloc] init];</span><br><span class=\"line\">[webView evaluateJavaScript:<span class=\"string\">@\"navigator.userAgent\"</span> completionHandler:^(<span class=\"keyword\">id</span> _Nullable userAgent, <span class=\"built_in\">NSError</span> * _Nullable error) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"userAgent: %@\"</span>, userAgent);</span><br><span class=\"line\">&#125;];</span><br><span class=\"line\"><span class=\"keyword\">self</span>.webView = webView; <span class=\"comment\">// 注意，一定要对webView进行强引用</span></span><br></pre></td></tr></table></figure>\n<p>获取到的值的为：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Mozilla/5.0 (iPhone; CPU iPhone OS 10_0_1 like Mac OS X) AppleWebKit/602.1.50 (KHTML, like Gecko) Mobile/14A403</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<p>项目中用到了WebView的UserAgent，可以通过以下方式获取到：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">UIWebView</span>* webView = [[<span class=\"built_in\">UIWebView</span> alloc] init];</span><br><span class=\"line\"><span class=\"built_in\">NSString</span>* secretAgent = [webView stringByEvaluatingJavaScriptFromString:<span class=\"string\">@\"navigator.userAgent\"</span>];</span><br></pre></td></tr></table></figure>\n<p>如果是WKWebView，可以通过以下方式获取</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">WKWebView</span> *webView = [[<span class=\"built_in\">WKWebView</span> alloc] init];</span><br><span class=\"line\">[webView evaluateJavaScript:<span class=\"string\">@\"navigator.userAgent\"</span> completionHandler:^(<span class=\"keyword\">id</span> _Nullable userAgent, <span class=\"built_in\">NSError</span> * _Nullable error) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"userAgent: %@\"</span>, userAgent);</span><br><span class=\"line\">&#125;];</span><br><span class=\"line\"><span class=\"keyword\">self</span>.webView = webView; <span class=\"comment\">// 注意，一定要对webView进行强引用</span></span><br></pre></td></tr></table></figure>\n<p>获取到的值的为：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Mozilla/5.0 (iPhone; CPU iPhone OS 10_0_1 like Mac OS X) AppleWebKit/602.1.50 (KHTML, like Gecko) Mobile/14A403</span><br></pre></td></tr></table></figure>\n"},{"title":"给多个Target添加CocoaPods","date":"2016-10-26T14:25:04.000Z","_content":"\n### 基本用法\n\n一般我们使用CocoaPods进行依赖管理时，如果项目里只有一个Target，则Podfile文件的格式应该是：\n\n```ruby\ntarget 'ZipApp' do  # ZipApp为Target名称\n  pod 'SSZipArchive'\nend\n```\n\n如果项目中有多个Target，可以定义多个这样的block，如下：\n\n```ruby\ntarget 'ZipApp' do  # ZipApp为Target名称\n  pod 'SSZipArchive'\nend\n\ntarget 'ZipAppTest' do  # ZipAppTest为另一个Target名称\n  pod 'SSZipArchive'\nend\n```\n\n如果多个Target的依赖的库都是一样的，没有必要每一个Target都把所有库都写一遍，可以定义一个函数，写法如下：\n\n```ruby\ndef common_pods\n    pod 'SSZipArchive'\n    pod 'AFNetworking'\n    pod 'JSPatch'\nend\n\ntarget 'ZipApp' do  # ZipApp即使Target名称\n  common_pods\nend\n\ntarget 'ZipAppTest' do\n    common_pods\nend\n```\n\n### 其他的用法\n\n如果多个Target有嵌套关系，即一个Target是另一个Target的父Target，则可以写成以下形式：\n\n```ruby\ntarget 'ZipApp' do\n  pod 'SSZipArchive'\n\n  target 'ZipAppTests' do\n    inherit! :search_paths # 这句话表示子Target继承了父Target包含的pod，即ZipAppTests这个Target里包含了SSZipArchive和Nimble两个pod\n    pod 'Nimble'\n  end\nend\n```\n\n如果一个Workspace里包含了多个Project，并且每一个Project都有不同的Target，则可以使用以下形式定义多个Project的Target：\n\n```ruby\ntarget 'Target1' do\n  project 'Project1'\n  pod 'AFNetworking'\nend\n\ntarget 'Target2' do\n  project 'Project2'\n  pod 'JSPatch'\nend\n```\n","source":"_posts/2016-10-26-给多个Target添加CocoaPods.md","raw":"---\ntitle: 给多个Target添加CocoaPods\ncategories: iOS开发\ntags:\n  - CocoaPods\n  - Target\ndate: 2016-10-26 22:25:04\n---\n\n### 基本用法\n\n一般我们使用CocoaPods进行依赖管理时，如果项目里只有一个Target，则Podfile文件的格式应该是：\n\n```ruby\ntarget 'ZipApp' do  # ZipApp为Target名称\n  pod 'SSZipArchive'\nend\n```\n\n如果项目中有多个Target，可以定义多个这样的block，如下：\n\n```ruby\ntarget 'ZipApp' do  # ZipApp为Target名称\n  pod 'SSZipArchive'\nend\n\ntarget 'ZipAppTest' do  # ZipAppTest为另一个Target名称\n  pod 'SSZipArchive'\nend\n```\n\n如果多个Target的依赖的库都是一样的，没有必要每一个Target都把所有库都写一遍，可以定义一个函数，写法如下：\n\n```ruby\ndef common_pods\n    pod 'SSZipArchive'\n    pod 'AFNetworking'\n    pod 'JSPatch'\nend\n\ntarget 'ZipApp' do  # ZipApp即使Target名称\n  common_pods\nend\n\ntarget 'ZipAppTest' do\n    common_pods\nend\n```\n\n### 其他的用法\n\n如果多个Target有嵌套关系，即一个Target是另一个Target的父Target，则可以写成以下形式：\n\n```ruby\ntarget 'ZipApp' do\n  pod 'SSZipArchive'\n\n  target 'ZipAppTests' do\n    inherit! :search_paths # 这句话表示子Target继承了父Target包含的pod，即ZipAppTests这个Target里包含了SSZipArchive和Nimble两个pod\n    pod 'Nimble'\n  end\nend\n```\n\n如果一个Workspace里包含了多个Project，并且每一个Project都有不同的Target，则可以使用以下形式定义多个Project的Target：\n\n```ruby\ntarget 'Target1' do\n  project 'Project1'\n  pod 'AFNetworking'\nend\n\ntarget 'Target2' do\n  project 'Project2'\n  pod 'JSPatch'\nend\n```\n","slug":"给多个Target添加CocoaPods","published":1,"updated":"2017-03-01T06:42:53.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjutyfmfw002tc4c9i46zimmm","content":"<h3 id=\"基本用法\"><a href=\"#基本用法\" class=\"headerlink\" title=\"基本用法\"></a>基本用法</h3><p>一般我们使用CocoaPods进行依赖管理时，如果项目里只有一个Target，则Podfile文件的格式应该是：</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">target <span class=\"string\">'ZipApp'</span> <span class=\"keyword\">do</span>  <span class=\"comment\"># ZipApp为Target名称</span></span><br><span class=\"line\">  pod <span class=\"string\">'SSZipArchive'</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n<p>如果项目中有多个Target，可以定义多个这样的block，如下：</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">target <span class=\"string\">'ZipApp'</span> <span class=\"keyword\">do</span>  <span class=\"comment\"># ZipApp为Target名称</span></span><br><span class=\"line\">  pod <span class=\"string\">'SSZipArchive'</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">target <span class=\"string\">'ZipAppTest'</span> <span class=\"keyword\">do</span>  <span class=\"comment\"># ZipAppTest为另一个Target名称</span></span><br><span class=\"line\">  pod <span class=\"string\">'SSZipArchive'</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n<p>如果多个Target的依赖的库都是一样的，没有必要每一个Target都把所有库都写一遍，可以定义一个函数，写法如下：</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">common_pods</span></span></span><br><span class=\"line\">    pod <span class=\"string\">'SSZipArchive'</span></span><br><span class=\"line\">    pod <span class=\"string\">'AFNetworking'</span></span><br><span class=\"line\">    pod <span class=\"string\">'JSPatch'</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">target <span class=\"string\">'ZipApp'</span> <span class=\"keyword\">do</span>  <span class=\"comment\"># ZipApp即使Target名称</span></span><br><span class=\"line\">  common_pods</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">target <span class=\"string\">'ZipAppTest'</span> <span class=\"keyword\">do</span></span><br><span class=\"line\">    common_pods</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"其他的用法\"><a href=\"#其他的用法\" class=\"headerlink\" title=\"其他的用法\"></a>其他的用法</h3><p>如果多个Target有嵌套关系，即一个Target是另一个Target的父Target，则可以写成以下形式：</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">target <span class=\"string\">'ZipApp'</span> <span class=\"keyword\">do</span></span><br><span class=\"line\">  pod <span class=\"string\">'SSZipArchive'</span></span><br><span class=\"line\"></span><br><span class=\"line\">  target <span class=\"string\">'ZipAppTests'</span> <span class=\"keyword\">do</span></span><br><span class=\"line\">    inherit! <span class=\"symbol\">:search_paths</span> <span class=\"comment\"># 这句话表示子Target继承了父Target包含的pod，即ZipAppTests这个Target里包含了SSZipArchive和Nimble两个pod</span></span><br><span class=\"line\">    pod <span class=\"string\">'Nimble'</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n<p>如果一个Workspace里包含了多个Project，并且每一个Project都有不同的Target，则可以使用以下形式定义多个Project的Target：</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">target <span class=\"string\">'Target1'</span> <span class=\"keyword\">do</span></span><br><span class=\"line\">  project <span class=\"string\">'Project1'</span></span><br><span class=\"line\">  pod <span class=\"string\">'AFNetworking'</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">target <span class=\"string\">'Target2'</span> <span class=\"keyword\">do</span></span><br><span class=\"line\">  project <span class=\"string\">'Project2'</span></span><br><span class=\"line\">  pod <span class=\"string\">'JSPatch'</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"基本用法\"><a href=\"#基本用法\" class=\"headerlink\" title=\"基本用法\"></a>基本用法</h3><p>一般我们使用CocoaPods进行依赖管理时，如果项目里只有一个Target，则Podfile文件的格式应该是：</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">target <span class=\"string\">'ZipApp'</span> <span class=\"keyword\">do</span>  <span class=\"comment\"># ZipApp为Target名称</span></span><br><span class=\"line\">  pod <span class=\"string\">'SSZipArchive'</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n<p>如果项目中有多个Target，可以定义多个这样的block，如下：</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">target <span class=\"string\">'ZipApp'</span> <span class=\"keyword\">do</span>  <span class=\"comment\"># ZipApp为Target名称</span></span><br><span class=\"line\">  pod <span class=\"string\">'SSZipArchive'</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">target <span class=\"string\">'ZipAppTest'</span> <span class=\"keyword\">do</span>  <span class=\"comment\"># ZipAppTest为另一个Target名称</span></span><br><span class=\"line\">  pod <span class=\"string\">'SSZipArchive'</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n<p>如果多个Target的依赖的库都是一样的，没有必要每一个Target都把所有库都写一遍，可以定义一个函数，写法如下：</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">common_pods</span></span></span><br><span class=\"line\">    pod <span class=\"string\">'SSZipArchive'</span></span><br><span class=\"line\">    pod <span class=\"string\">'AFNetworking'</span></span><br><span class=\"line\">    pod <span class=\"string\">'JSPatch'</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">target <span class=\"string\">'ZipApp'</span> <span class=\"keyword\">do</span>  <span class=\"comment\"># ZipApp即使Target名称</span></span><br><span class=\"line\">  common_pods</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">target <span class=\"string\">'ZipAppTest'</span> <span class=\"keyword\">do</span></span><br><span class=\"line\">    common_pods</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"其他的用法\"><a href=\"#其他的用法\" class=\"headerlink\" title=\"其他的用法\"></a>其他的用法</h3><p>如果多个Target有嵌套关系，即一个Target是另一个Target的父Target，则可以写成以下形式：</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">target <span class=\"string\">'ZipApp'</span> <span class=\"keyword\">do</span></span><br><span class=\"line\">  pod <span class=\"string\">'SSZipArchive'</span></span><br><span class=\"line\"></span><br><span class=\"line\">  target <span class=\"string\">'ZipAppTests'</span> <span class=\"keyword\">do</span></span><br><span class=\"line\">    inherit! <span class=\"symbol\">:search_paths</span> <span class=\"comment\"># 这句话表示子Target继承了父Target包含的pod，即ZipAppTests这个Target里包含了SSZipArchive和Nimble两个pod</span></span><br><span class=\"line\">    pod <span class=\"string\">'Nimble'</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n<p>如果一个Workspace里包含了多个Project，并且每一个Project都有不同的Target，则可以使用以下形式定义多个Project的Target：</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">target <span class=\"string\">'Target1'</span> <span class=\"keyword\">do</span></span><br><span class=\"line\">  project <span class=\"string\">'Project1'</span></span><br><span class=\"line\">  pod <span class=\"string\">'AFNetworking'</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">target <span class=\"string\">'Target2'</span> <span class=\"keyword\">do</span></span><br><span class=\"line\">  project <span class=\"string\">'Project2'</span></span><br><span class=\"line\">  pod <span class=\"string\">'JSPatch'</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n"},{"title":"使用代码删除约束要注意的地方","date":"2016-09-12T15:17:44.000Z","_content":"\n使用代码删除特定约束的正确姿势：\n\n```objectivec\nif (IOS8_OR_LATER) {\n    // iOS8之后删除约束的方法\n    self.authorLabelRightConstraint.active = NO;\n}\nelse {\n    // iOS8之前删除约束的方法\n    [self removeConstraint:self.authorLabelRightConstraint];\n}\n```\n\n注意删除约束的方法在iOS8之前和之后是不一样的。\n","source":"_posts/2016-09-12-使用代码删除约束要注意的地方.md","raw":"---\ntitle: 使用代码删除约束要注意的地方\ncategories: iOS Tips\ntags:\n  - Autolayout\ndate: 2016-09-12 23:17:44\n---\n\n使用代码删除特定约束的正确姿势：\n\n```objectivec\nif (IOS8_OR_LATER) {\n    // iOS8之后删除约束的方法\n    self.authorLabelRightConstraint.active = NO;\n}\nelse {\n    // iOS8之前删除约束的方法\n    [self removeConstraint:self.authorLabelRightConstraint];\n}\n```\n\n注意删除约束的方法在iOS8之前和之后是不一样的。\n","slug":"使用代码删除约束要注意的地方","published":1,"updated":"2017-03-01T06:42:53.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjutyfmfx002xc4c9wticqdvv","content":"<p>使用代码删除特定约束的正确姿势：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (IOS8_OR_LATER) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// iOS8之后删除约束的方法</span></span><br><span class=\"line\">    <span class=\"keyword\">self</span>.authorLabelRightConstraint.active = <span class=\"literal\">NO</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// iOS8之前删除约束的方法</span></span><br><span class=\"line\">    [<span class=\"keyword\">self</span> removeConstraint:<span class=\"keyword\">self</span>.authorLabelRightConstraint];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>注意删除约束的方法在iOS8之前和之后是不一样的。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>使用代码删除特定约束的正确姿势：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (IOS8_OR_LATER) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// iOS8之后删除约束的方法</span></span><br><span class=\"line\">    <span class=\"keyword\">self</span>.authorLabelRightConstraint.active = <span class=\"literal\">NO</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// iOS8之前删除约束的方法</span></span><br><span class=\"line\">    [<span class=\"keyword\">self</span> removeConstraint:<span class=\"keyword\">self</span>.authorLabelRightConstraint];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>注意删除约束的方法在iOS8之前和之后是不一样的。</p>\n"},{"title":"获取本地化的APP版本描述信息","date":"2016-10-09T15:25:15.000Z","_content":"\n在制作APP升级提示框时，需要APP的最新版本信息，苹果提供了\"http://itunes.apple.com/lookup?id=123123\"接口用于查询AppStore上的APP的详细信息，参数id表示的是应用程序的AppId。\n\n如果在iTunesConnect上对应用的版本描述信息做了本地化，上述接口只会返回首选语言的描述信息，如果要返回特定语言的描述信息，还要加上两个参数:\n\n* country: 国家参数，CN表示中国，US表示美国，国家代码可以在[这里](https://zh.wikipedia.org/wiki/ISO_3166-1)找到\n* lang: 语言参数，zh_cn表示中文，zh_tw表示繁体中文，en_us表示美国英国，语言编码可以参考[维基百科](https://zh.wikipedia.org/wiki/%E5%8C%BA%E5%9F%9F%E8%AE%BE%E7%BD%AE)\n\n例如：\n\n* 要获取中文的描述信息，应该调用http://itunes.apple.com/lookup?id=123123&country=CN&lang=zh_cn\n* 要获取繁体中文的描述信息，应该调用http://itunes.apple.com/lookup?id=123123&country=TW&lang=zh_tw\n* 要获取英文的描述信息，应该调用http://itunes.apple.com/lookup?id=123123&country=US&lang=en_us\n\n参考资料：\n\n[语言区域](https://zh.wikipedia.org/wiki/%E5%8C%BA%E5%9F%9F%E8%AE%BE%E7%BD%AE)\n[ISO_3166-1](https://zh.wikipedia.org/wiki/ISO_3166-1)\n[iTunes Affiliate Resources](https://affiliate.itunes.apple.com/resources/documentation/itunes-store-web-service-search-api/)\n[Playing Around With App Store Meta Data](http://blog.hoachuck.biz/blog/2012/07/01/playing-around-with-app-store-meta-data/)\n","source":"_posts/2016-10-09-获取本地化的APP版本描述信息.md","raw":"---\ntitle: 获取本地化的APP版本描述信息\ncategories: iOS Tips\ntags:\n  - 本地化\ndate: 2016-10-09 23:25:15\n---\n\n在制作APP升级提示框时，需要APP的最新版本信息，苹果提供了\"http://itunes.apple.com/lookup?id=123123\"接口用于查询AppStore上的APP的详细信息，参数id表示的是应用程序的AppId。\n\n如果在iTunesConnect上对应用的版本描述信息做了本地化，上述接口只会返回首选语言的描述信息，如果要返回特定语言的描述信息，还要加上两个参数:\n\n* country: 国家参数，CN表示中国，US表示美国，国家代码可以在[这里](https://zh.wikipedia.org/wiki/ISO_3166-1)找到\n* lang: 语言参数，zh_cn表示中文，zh_tw表示繁体中文，en_us表示美国英国，语言编码可以参考[维基百科](https://zh.wikipedia.org/wiki/%E5%8C%BA%E5%9F%9F%E8%AE%BE%E7%BD%AE)\n\n例如：\n\n* 要获取中文的描述信息，应该调用http://itunes.apple.com/lookup?id=123123&country=CN&lang=zh_cn\n* 要获取繁体中文的描述信息，应该调用http://itunes.apple.com/lookup?id=123123&country=TW&lang=zh_tw\n* 要获取英文的描述信息，应该调用http://itunes.apple.com/lookup?id=123123&country=US&lang=en_us\n\n参考资料：\n\n[语言区域](https://zh.wikipedia.org/wiki/%E5%8C%BA%E5%9F%9F%E8%AE%BE%E7%BD%AE)\n[ISO_3166-1](https://zh.wikipedia.org/wiki/ISO_3166-1)\n[iTunes Affiliate Resources](https://affiliate.itunes.apple.com/resources/documentation/itunes-store-web-service-search-api/)\n[Playing Around With App Store Meta Data](http://blog.hoachuck.biz/blog/2012/07/01/playing-around-with-app-store-meta-data/)\n","slug":"获取本地化的APP版本描述信息","published":1,"updated":"2017-03-01T06:42:53.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjutyfmfy0030c4c9pzq4mwi9","content":"<p>在制作APP升级提示框时，需要APP的最新版本信息，苹果提供了”<a href=\"http://itunes.apple.com/lookup?id=123123&quot;接口用于查询AppStore上的APP的详细信息，参数id表示的是应用程序的AppId。\" target=\"_blank\" rel=\"noopener\">http://itunes.apple.com/lookup?id=123123&quot;接口用于查询AppStore上的APP的详细信息，参数id表示的是应用程序的AppId。</a></p>\n<p>如果在iTunesConnect上对应用的版本描述信息做了本地化，上述接口只会返回首选语言的描述信息，如果要返回特定语言的描述信息，还要加上两个参数:</p>\n<ul>\n<li>country: 国家参数，CN表示中国，US表示美国，国家代码可以在<a href=\"https://zh.wikipedia.org/wiki/ISO_3166-1\" target=\"_blank\" rel=\"noopener\">这里</a>找到</li>\n<li>lang: 语言参数，zh_cn表示中文，zh_tw表示繁体中文，en_us表示美国英国，语言编码可以参考<a href=\"https://zh.wikipedia.org/wiki/%E5%8C%BA%E5%9F%9F%E8%AE%BE%E7%BD%AE\" target=\"_blank\" rel=\"noopener\">维基百科</a></li>\n</ul>\n<p>例如：</p>\n<ul>\n<li>要获取中文的描述信息，应该调用<a href=\"http://itunes.apple.com/lookup?id=123123&amp;country=CN&amp;lang=zh_cn\" target=\"_blank\" rel=\"noopener\">http://itunes.apple.com/lookup?id=123123&amp;country=CN&amp;lang=zh_cn</a></li>\n<li>要获取繁体中文的描述信息，应该调用<a href=\"http://itunes.apple.com/lookup?id=123123&amp;country=TW&amp;lang=zh_tw\" target=\"_blank\" rel=\"noopener\">http://itunes.apple.com/lookup?id=123123&amp;country=TW&amp;lang=zh_tw</a></li>\n<li>要获取英文的描述信息，应该调用<a href=\"http://itunes.apple.com/lookup?id=123123&amp;country=US&amp;lang=en_us\" target=\"_blank\" rel=\"noopener\">http://itunes.apple.com/lookup?id=123123&amp;country=US&amp;lang=en_us</a></li>\n</ul>\n<p>参考资料：</p>\n<p><a href=\"https://zh.wikipedia.org/wiki/%E5%8C%BA%E5%9F%9F%E8%AE%BE%E7%BD%AE\" target=\"_blank\" rel=\"noopener\">语言区域</a><br><a href=\"https://zh.wikipedia.org/wiki/ISO_3166-1\" target=\"_blank\" rel=\"noopener\">ISO_3166-1</a><br><a href=\"https://affiliate.itunes.apple.com/resources/documentation/itunes-store-web-service-search-api/\" target=\"_blank\" rel=\"noopener\">iTunes Affiliate Resources</a><br><a href=\"http://blog.hoachuck.biz/blog/2012/07/01/playing-around-with-app-store-meta-data/\" target=\"_blank\" rel=\"noopener\">Playing Around With App Store Meta Data</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>在制作APP升级提示框时，需要APP的最新版本信息，苹果提供了”<a href=\"http://itunes.apple.com/lookup?id=123123&quot;接口用于查询AppStore上的APP的详细信息，参数id表示的是应用程序的AppId。\" target=\"_blank\" rel=\"noopener\">http://itunes.apple.com/lookup?id=123123&quot;接口用于查询AppStore上的APP的详细信息，参数id表示的是应用程序的AppId。</a></p>\n<p>如果在iTunesConnect上对应用的版本描述信息做了本地化，上述接口只会返回首选语言的描述信息，如果要返回特定语言的描述信息，还要加上两个参数:</p>\n<ul>\n<li>country: 国家参数，CN表示中国，US表示美国，国家代码可以在<a href=\"https://zh.wikipedia.org/wiki/ISO_3166-1\" target=\"_blank\" rel=\"noopener\">这里</a>找到</li>\n<li>lang: 语言参数，zh_cn表示中文，zh_tw表示繁体中文，en_us表示美国英国，语言编码可以参考<a href=\"https://zh.wikipedia.org/wiki/%E5%8C%BA%E5%9F%9F%E8%AE%BE%E7%BD%AE\" target=\"_blank\" rel=\"noopener\">维基百科</a></li>\n</ul>\n<p>例如：</p>\n<ul>\n<li>要获取中文的描述信息，应该调用<a href=\"http://itunes.apple.com/lookup?id=123123&amp;country=CN&amp;lang=zh_cn\" target=\"_blank\" rel=\"noopener\">http://itunes.apple.com/lookup?id=123123&amp;country=CN&amp;lang=zh_cn</a></li>\n<li>要获取繁体中文的描述信息，应该调用<a href=\"http://itunes.apple.com/lookup?id=123123&amp;country=TW&amp;lang=zh_tw\" target=\"_blank\" rel=\"noopener\">http://itunes.apple.com/lookup?id=123123&amp;country=TW&amp;lang=zh_tw</a></li>\n<li>要获取英文的描述信息，应该调用<a href=\"http://itunes.apple.com/lookup?id=123123&amp;country=US&amp;lang=en_us\" target=\"_blank\" rel=\"noopener\">http://itunes.apple.com/lookup?id=123123&amp;country=US&amp;lang=en_us</a></li>\n</ul>\n<p>参考资料：</p>\n<p><a href=\"https://zh.wikipedia.org/wiki/%E5%8C%BA%E5%9F%9F%E8%AE%BE%E7%BD%AE\" target=\"_blank\" rel=\"noopener\">语言区域</a><br><a href=\"https://zh.wikipedia.org/wiki/ISO_3166-1\" target=\"_blank\" rel=\"noopener\">ISO_3166-1</a><br><a href=\"https://affiliate.itunes.apple.com/resources/documentation/itunes-store-web-service-search-api/\" target=\"_blank\" rel=\"noopener\">iTunes Affiliate Resources</a><br><a href=\"http://blog.hoachuck.biz/blog/2012/07/01/playing-around-with-app-store-meta-data/\" target=\"_blank\" rel=\"noopener\">Playing Around With App Store Meta Data</a></p>\n"},{"title":"使用nat123实现外网ssh连接内网树莓派设备","date":"2016-11-05T09:56:46.000Z","_content":"\n[树莓派](https://zh.wikipedia.org/zh-cn/%E6%A0%91%E8%8E%93%E6%B4%BE)是一款基于Linux的单板机电脑。最近入手了一块，打算作为Linux服务器来使用。\n\n树莓派自带以太网接口和Wifi模块，可以通过网线或Wifi连接网络。但是由于我家里的网络是电信的光纤网络，用的是电信配的路由器，各个终端都是通过Wifi或网线连到这个路由上，因此各个终端相当于处于局域网，外网无法通过ip直接访问到内网的树莓派设备，这样如果我在树莓派上搭建一个服务器，外网就无法访问。\n\n一般这种问题，只需要在路由器上设置一下[端口映射](http://www.hrtl.com.cn/News_398.aspx)就可通过外网访问内网主机了，但是电信配的这个路由器不支持设置端口映射（吐槽一下，电信自带的路由器简直弱爆了），所有就没办法通过设置路由器的方法解决。\n\n经过一番探索，找了一种可行的方案：[nat123](http://www.nat123.com/)。nat123是一家专业提供端口映射和域名解析的网站，下面我就详细介绍一下如何使用nat123来实现外网访问内网树莓派设备。\n\n## 具体步骤\n\n### 第一步 准备工作\n\n确保在内网环境下可以通过ssh访问树莓派，如何在树莓派上配置ssh，可以参考[这篇文章](http://www.itnose.net/detail/6109563.html)\n\n### 第二步 注册nat123\n\n打开[nat123](http://www.nat123.com/)官网，点击右上角的注册按钮完成注册\n\n### 第三步 在树莓派上安装nat123 Linux版\n\n打开树莓派，按照[这篇文章](http://www.nat123.com/pages_17_600.jsp)的内容安装并启动相关软件。这里注意要根据你树莓派上的操作系统选择不同的安装方式，如果安装的官方操作系统Raspbian，应该选用Debian系统的安装方式。\n\n### 第四步 配置端口映射\n\n登录[nat123](http://www.nat123.com/)，在左侧的用户中心点击“端口映射添加”，如下图：\n\n![1](http://oldblog.shicishuzhai.com/7855931f84f019009241b787d7c35f87.png)\n\n应用类型选择“其他（非网站）”，这里我要实现的是通过ssh访问树莓派，所有不是80端口，具体应该根据自己的需求选择应用类型，可以参考[这篇文章](http://www.nat123.com/Pages_8_570.jsp)。\n\n![2](http://oldblog.shicishuzhai.com/d784b452f4e1a71ef9555fd783b95386.png)\n\n下面解释一下每一项的含义：\n\n* 应用名称：随便起，这里因为是用于ssh连接的，所以起名为ssh\n* 内网端口：内网应用的端口，ssh访问默认端口为22，如果是其他服务，这里的端口号应该填相应服务的端口号，例如，ftp服务默认端口号为21，http服务默认端口80等。\n* 内网地址：即树莓派在内网的ip地址，可以通过`ifconfig`命令查看\n* 外网端口：自动生成，要记住这个端口号，待会链接是要用到\n* 外网域名：自动生成，这就是外网要访问的地址\n\n然后点击“确认保存”，这里需要认证，认证需要收费（30￥），付款完成后，再次点击“确认保存”，就可以保存成功。可以在左侧的“端口映射列表”里查看和修改添加的端口映射。\n\n这样就完成了端口映射的添加。\n\n### 第五步 外网访问\n\n这时就已经可以通过外网访问了，在外网环境下打开终端，输入命令：\n\n```shell\nssh pi@45067491.nat123.net -p 22996\n```\n\n然后输入密码，就可以通过ssh访问树莓派了。这里\"pi\"是你在树莓派里的用户名，-p参数是刚才的端口号。\n\n## 结语\n\n以上就是我使用nat123实现外网访问内网树莓派设备的这个过程。整个过程并不复杂，但是我在进行的过程中还是磕磕绊绊折腾了好久才完全整好，不过这个过程中还是学到了不少的东西。\n\n由于水平有限，如果上文中有不正确的地方，欢迎大家交流指正。\n","source":"_posts/2016-11-05-使用nat123实现外网ssh连接内网树莓派设备.md","raw":"---\ntitle: 使用nat123实现外网ssh连接内网树莓派设备\ncategories: 树莓派\ntags:\n  - 树莓派\n  - SSH\n  - 网络\ndate: 2016-11-05 17:56:46\n---\n\n[树莓派](https://zh.wikipedia.org/zh-cn/%E6%A0%91%E8%8E%93%E6%B4%BE)是一款基于Linux的单板机电脑。最近入手了一块，打算作为Linux服务器来使用。\n\n树莓派自带以太网接口和Wifi模块，可以通过网线或Wifi连接网络。但是由于我家里的网络是电信的光纤网络，用的是电信配的路由器，各个终端都是通过Wifi或网线连到这个路由上，因此各个终端相当于处于局域网，外网无法通过ip直接访问到内网的树莓派设备，这样如果我在树莓派上搭建一个服务器，外网就无法访问。\n\n一般这种问题，只需要在路由器上设置一下[端口映射](http://www.hrtl.com.cn/News_398.aspx)就可通过外网访问内网主机了，但是电信配的这个路由器不支持设置端口映射（吐槽一下，电信自带的路由器简直弱爆了），所有就没办法通过设置路由器的方法解决。\n\n经过一番探索，找了一种可行的方案：[nat123](http://www.nat123.com/)。nat123是一家专业提供端口映射和域名解析的网站，下面我就详细介绍一下如何使用nat123来实现外网访问内网树莓派设备。\n\n## 具体步骤\n\n### 第一步 准备工作\n\n确保在内网环境下可以通过ssh访问树莓派，如何在树莓派上配置ssh，可以参考[这篇文章](http://www.itnose.net/detail/6109563.html)\n\n### 第二步 注册nat123\n\n打开[nat123](http://www.nat123.com/)官网，点击右上角的注册按钮完成注册\n\n### 第三步 在树莓派上安装nat123 Linux版\n\n打开树莓派，按照[这篇文章](http://www.nat123.com/pages_17_600.jsp)的内容安装并启动相关软件。这里注意要根据你树莓派上的操作系统选择不同的安装方式，如果安装的官方操作系统Raspbian，应该选用Debian系统的安装方式。\n\n### 第四步 配置端口映射\n\n登录[nat123](http://www.nat123.com/)，在左侧的用户中心点击“端口映射添加”，如下图：\n\n![1](http://oldblog.shicishuzhai.com/7855931f84f019009241b787d7c35f87.png)\n\n应用类型选择“其他（非网站）”，这里我要实现的是通过ssh访问树莓派，所有不是80端口，具体应该根据自己的需求选择应用类型，可以参考[这篇文章](http://www.nat123.com/Pages_8_570.jsp)。\n\n![2](http://oldblog.shicishuzhai.com/d784b452f4e1a71ef9555fd783b95386.png)\n\n下面解释一下每一项的含义：\n\n* 应用名称：随便起，这里因为是用于ssh连接的，所以起名为ssh\n* 内网端口：内网应用的端口，ssh访问默认端口为22，如果是其他服务，这里的端口号应该填相应服务的端口号，例如，ftp服务默认端口号为21，http服务默认端口80等。\n* 内网地址：即树莓派在内网的ip地址，可以通过`ifconfig`命令查看\n* 外网端口：自动生成，要记住这个端口号，待会链接是要用到\n* 外网域名：自动生成，这就是外网要访问的地址\n\n然后点击“确认保存”，这里需要认证，认证需要收费（30￥），付款完成后，再次点击“确认保存”，就可以保存成功。可以在左侧的“端口映射列表”里查看和修改添加的端口映射。\n\n这样就完成了端口映射的添加。\n\n### 第五步 外网访问\n\n这时就已经可以通过外网访问了，在外网环境下打开终端，输入命令：\n\n```shell\nssh pi@45067491.nat123.net -p 22996\n```\n\n然后输入密码，就可以通过ssh访问树莓派了。这里\"pi\"是你在树莓派里的用户名，-p参数是刚才的端口号。\n\n## 结语\n\n以上就是我使用nat123实现外网访问内网树莓派设备的这个过程。整个过程并不复杂，但是我在进行的过程中还是磕磕绊绊折腾了好久才完全整好，不过这个过程中还是学到了不少的东西。\n\n由于水平有限，如果上文中有不正确的地方，欢迎大家交流指正。\n","slug":"使用nat123实现外网ssh连接内网树莓派设备","published":1,"updated":"2019-01-13T04:01:04.474Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjutyfmfz0034c4c9eqocw9fb","content":"<p><a href=\"https://zh.wikipedia.org/zh-cn/%E6%A0%91%E8%8E%93%E6%B4%BE\" target=\"_blank\" rel=\"noopener\">树莓派</a>是一款基于Linux的单板机电脑。最近入手了一块，打算作为Linux服务器来使用。</p>\n<p>树莓派自带以太网接口和Wifi模块，可以通过网线或Wifi连接网络。但是由于我家里的网络是电信的光纤网络，用的是电信配的路由器，各个终端都是通过Wifi或网线连到这个路由上，因此各个终端相当于处于局域网，外网无法通过ip直接访问到内网的树莓派设备，这样如果我在树莓派上搭建一个服务器，外网就无法访问。</p>\n<p>一般这种问题，只需要在路由器上设置一下<a href=\"http://www.hrtl.com.cn/News_398.aspx\" target=\"_blank\" rel=\"noopener\">端口映射</a>就可通过外网访问内网主机了，但是电信配的这个路由器不支持设置端口映射（吐槽一下，电信自带的路由器简直弱爆了），所有就没办法通过设置路由器的方法解决。</p>\n<p>经过一番探索，找了一种可行的方案：<a href=\"http://www.nat123.com/\" target=\"_blank\" rel=\"noopener\">nat123</a>。nat123是一家专业提供端口映射和域名解析的网站，下面我就详细介绍一下如何使用nat123来实现外网访问内网树莓派设备。</p>\n<h2 id=\"具体步骤\"><a href=\"#具体步骤\" class=\"headerlink\" title=\"具体步骤\"></a>具体步骤</h2><h3 id=\"第一步-准备工作\"><a href=\"#第一步-准备工作\" class=\"headerlink\" title=\"第一步 准备工作\"></a>第一步 准备工作</h3><p>确保在内网环境下可以通过ssh访问树莓派，如何在树莓派上配置ssh，可以参考<a href=\"http://www.itnose.net/detail/6109563.html\" target=\"_blank\" rel=\"noopener\">这篇文章</a></p>\n<h3 id=\"第二步-注册nat123\"><a href=\"#第二步-注册nat123\" class=\"headerlink\" title=\"第二步 注册nat123\"></a>第二步 注册nat123</h3><p>打开<a href=\"http://www.nat123.com/\" target=\"_blank\" rel=\"noopener\">nat123</a>官网，点击右上角的注册按钮完成注册</p>\n<h3 id=\"第三步-在树莓派上安装nat123-Linux版\"><a href=\"#第三步-在树莓派上安装nat123-Linux版\" class=\"headerlink\" title=\"第三步 在树莓派上安装nat123 Linux版\"></a>第三步 在树莓派上安装nat123 Linux版</h3><p>打开树莓派，按照<a href=\"http://www.nat123.com/pages_17_600.jsp\" target=\"_blank\" rel=\"noopener\">这篇文章</a>的内容安装并启动相关软件。这里注意要根据你树莓派上的操作系统选择不同的安装方式，如果安装的官方操作系统Raspbian，应该选用Debian系统的安装方式。</p>\n<h3 id=\"第四步-配置端口映射\"><a href=\"#第四步-配置端口映射\" class=\"headerlink\" title=\"第四步 配置端口映射\"></a>第四步 配置端口映射</h3><p>登录<a href=\"http://www.nat123.com/\" target=\"_blank\" rel=\"noopener\">nat123</a>，在左侧的用户中心点击“端口映射添加”，如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/7855931f84f019009241b787d7c35f87.png\" alt=\"1\"></p>\n<p>应用类型选择“其他（非网站）”，这里我要实现的是通过ssh访问树莓派，所有不是80端口，具体应该根据自己的需求选择应用类型，可以参考<a href=\"http://www.nat123.com/Pages_8_570.jsp\" target=\"_blank\" rel=\"noopener\">这篇文章</a>。</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/d784b452f4e1a71ef9555fd783b95386.png\" alt=\"2\"></p>\n<p>下面解释一下每一项的含义：</p>\n<ul>\n<li>应用名称：随便起，这里因为是用于ssh连接的，所以起名为ssh</li>\n<li>内网端口：内网应用的端口，ssh访问默认端口为22，如果是其他服务，这里的端口号应该填相应服务的端口号，例如，ftp服务默认端口号为21，http服务默认端口80等。</li>\n<li>内网地址：即树莓派在内网的ip地址，可以通过<code>ifconfig</code>命令查看</li>\n<li>外网端口：自动生成，要记住这个端口号，待会链接是要用到</li>\n<li>外网域名：自动生成，这就是外网要访问的地址</li>\n</ul>\n<p>然后点击“确认保存”，这里需要认证，认证需要收费（30￥），付款完成后，再次点击“确认保存”，就可以保存成功。可以在左侧的“端口映射列表”里查看和修改添加的端口映射。</p>\n<p>这样就完成了端口映射的添加。</p>\n<h3 id=\"第五步-外网访问\"><a href=\"#第五步-外网访问\" class=\"headerlink\" title=\"第五步 外网访问\"></a>第五步 外网访问</h3><p>这时就已经可以通过外网访问了，在外网环境下打开终端，输入命令：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh pi@45067491.nat123.net -p 22996</span><br></pre></td></tr></table></figure>\n<p>然后输入密码，就可以通过ssh访问树莓派了。这里”pi”是你在树莓派里的用户名，-p参数是刚才的端口号。</p>\n<h2 id=\"结语\"><a href=\"#结语\" class=\"headerlink\" title=\"结语\"></a>结语</h2><p>以上就是我使用nat123实现外网访问内网树莓派设备的这个过程。整个过程并不复杂，但是我在进行的过程中还是磕磕绊绊折腾了好久才完全整好，不过这个过程中还是学到了不少的东西。</p>\n<p>由于水平有限，如果上文中有不正确的地方，欢迎大家交流指正。</p>\n","site":{"data":{}},"excerpt":"","more":"<p><a href=\"https://zh.wikipedia.org/zh-cn/%E6%A0%91%E8%8E%93%E6%B4%BE\" target=\"_blank\" rel=\"noopener\">树莓派</a>是一款基于Linux的单板机电脑。最近入手了一块，打算作为Linux服务器来使用。</p>\n<p>树莓派自带以太网接口和Wifi模块，可以通过网线或Wifi连接网络。但是由于我家里的网络是电信的光纤网络，用的是电信配的路由器，各个终端都是通过Wifi或网线连到这个路由上，因此各个终端相当于处于局域网，外网无法通过ip直接访问到内网的树莓派设备，这样如果我在树莓派上搭建一个服务器，外网就无法访问。</p>\n<p>一般这种问题，只需要在路由器上设置一下<a href=\"http://www.hrtl.com.cn/News_398.aspx\" target=\"_blank\" rel=\"noopener\">端口映射</a>就可通过外网访问内网主机了，但是电信配的这个路由器不支持设置端口映射（吐槽一下，电信自带的路由器简直弱爆了），所有就没办法通过设置路由器的方法解决。</p>\n<p>经过一番探索，找了一种可行的方案：<a href=\"http://www.nat123.com/\" target=\"_blank\" rel=\"noopener\">nat123</a>。nat123是一家专业提供端口映射和域名解析的网站，下面我就详细介绍一下如何使用nat123来实现外网访问内网树莓派设备。</p>\n<h2 id=\"具体步骤\"><a href=\"#具体步骤\" class=\"headerlink\" title=\"具体步骤\"></a>具体步骤</h2><h3 id=\"第一步-准备工作\"><a href=\"#第一步-准备工作\" class=\"headerlink\" title=\"第一步 准备工作\"></a>第一步 准备工作</h3><p>确保在内网环境下可以通过ssh访问树莓派，如何在树莓派上配置ssh，可以参考<a href=\"http://www.itnose.net/detail/6109563.html\" target=\"_blank\" rel=\"noopener\">这篇文章</a></p>\n<h3 id=\"第二步-注册nat123\"><a href=\"#第二步-注册nat123\" class=\"headerlink\" title=\"第二步 注册nat123\"></a>第二步 注册nat123</h3><p>打开<a href=\"http://www.nat123.com/\" target=\"_blank\" rel=\"noopener\">nat123</a>官网，点击右上角的注册按钮完成注册</p>\n<h3 id=\"第三步-在树莓派上安装nat123-Linux版\"><a href=\"#第三步-在树莓派上安装nat123-Linux版\" class=\"headerlink\" title=\"第三步 在树莓派上安装nat123 Linux版\"></a>第三步 在树莓派上安装nat123 Linux版</h3><p>打开树莓派，按照<a href=\"http://www.nat123.com/pages_17_600.jsp\" target=\"_blank\" rel=\"noopener\">这篇文章</a>的内容安装并启动相关软件。这里注意要根据你树莓派上的操作系统选择不同的安装方式，如果安装的官方操作系统Raspbian，应该选用Debian系统的安装方式。</p>\n<h3 id=\"第四步-配置端口映射\"><a href=\"#第四步-配置端口映射\" class=\"headerlink\" title=\"第四步 配置端口映射\"></a>第四步 配置端口映射</h3><p>登录<a href=\"http://www.nat123.com/\" target=\"_blank\" rel=\"noopener\">nat123</a>，在左侧的用户中心点击“端口映射添加”，如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/7855931f84f019009241b787d7c35f87.png\" alt=\"1\"></p>\n<p>应用类型选择“其他（非网站）”，这里我要实现的是通过ssh访问树莓派，所有不是80端口，具体应该根据自己的需求选择应用类型，可以参考<a href=\"http://www.nat123.com/Pages_8_570.jsp\" target=\"_blank\" rel=\"noopener\">这篇文章</a>。</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/d784b452f4e1a71ef9555fd783b95386.png\" alt=\"2\"></p>\n<p>下面解释一下每一项的含义：</p>\n<ul>\n<li>应用名称：随便起，这里因为是用于ssh连接的，所以起名为ssh</li>\n<li>内网端口：内网应用的端口，ssh访问默认端口为22，如果是其他服务，这里的端口号应该填相应服务的端口号，例如，ftp服务默认端口号为21，http服务默认端口80等。</li>\n<li>内网地址：即树莓派在内网的ip地址，可以通过<code>ifconfig</code>命令查看</li>\n<li>外网端口：自动生成，要记住这个端口号，待会链接是要用到</li>\n<li>外网域名：自动生成，这就是外网要访问的地址</li>\n</ul>\n<p>然后点击“确认保存”，这里需要认证，认证需要收费（30￥），付款完成后，再次点击“确认保存”，就可以保存成功。可以在左侧的“端口映射列表”里查看和修改添加的端口映射。</p>\n<p>这样就完成了端口映射的添加。</p>\n<h3 id=\"第五步-外网访问\"><a href=\"#第五步-外网访问\" class=\"headerlink\" title=\"第五步 外网访问\"></a>第五步 外网访问</h3><p>这时就已经可以通过外网访问了，在外网环境下打开终端，输入命令：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh pi@45067491.nat123.net -p 22996</span><br></pre></td></tr></table></figure>\n<p>然后输入密码，就可以通过ssh访问树莓派了。这里”pi”是你在树莓派里的用户名，-p参数是刚才的端口号。</p>\n<h2 id=\"结语\"><a href=\"#结语\" class=\"headerlink\" title=\"结语\"></a>结语</h2><p>以上就是我使用nat123实现外网访问内网树莓派设备的这个过程。整个过程并不复杂，但是我在进行的过程中还是磕磕绊绊折腾了好久才完全整好，不过这个过程中还是学到了不少的东西。</p>\n<p>由于水平有限，如果上文中有不正确的地方，欢迎大家交流指正。</p>\n"},{"title":"Swift3中的预处理宏","date":"2016-10-28T09:18:57.000Z","_content":"\nSwift中也可以使用预处理宏，只不过和ObjectiveC有点不一样，下面详细说明一下。\n\n* Swift中取消了#define，建议使用全局常量替换宏定义\n* Swift中仍然可以使用`#if, #elseif, #endif`等宏，注意，Swift中是`#elseif`，而在OC中是`#elif`。还有`#if`和`#elseif`后面的判断条件必须是Bool类型的。\n\n```Swift\n#if false\nprint(\"aaaa\")\n#elseif true\nprint(\"bbbb\")\n#else\nprint(\"cccc\")\n#endif\n```\n* Swift中取消了`__FUNCTION__, __FILE__, __LINE__`，分别改为了`#function, #file, #line`\n\n```Swift\nprint(#file)\nprint(#line)\n\nfunc function1() {\n    print(#function)\n}\n```\n","source":"_posts/2016-10-28-Swift3中的预处理宏.md","raw":"---\ntitle: Swift3中的预处理宏\ncategories: Swift\ntags:\n  - Swift\n  - 预处理宏\ndate: 2016-10-28 17:18:57\n---\n\nSwift中也可以使用预处理宏，只不过和ObjectiveC有点不一样，下面详细说明一下。\n\n* Swift中取消了#define，建议使用全局常量替换宏定义\n* Swift中仍然可以使用`#if, #elseif, #endif`等宏，注意，Swift中是`#elseif`，而在OC中是`#elif`。还有`#if`和`#elseif`后面的判断条件必须是Bool类型的。\n\n```Swift\n#if false\nprint(\"aaaa\")\n#elseif true\nprint(\"bbbb\")\n#else\nprint(\"cccc\")\n#endif\n```\n* Swift中取消了`__FUNCTION__, __FILE__, __LINE__`，分别改为了`#function, #file, #line`\n\n```Swift\nprint(#file)\nprint(#line)\n\nfunc function1() {\n    print(#function)\n}\n```\n","slug":"Swift3中的预处理宏","published":1,"updated":"2017-03-01T06:42:53.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjutyfmg00037c4c9f07r3tno","content":"<p>Swift中也可以使用预处理宏，只不过和ObjectiveC有点不一样，下面详细说明一下。</p>\n<ul>\n<li>Swift中取消了#define，建议使用全局常量替换宏定义</li>\n<li>Swift中仍然可以使用<code>#if, #elseif, #endif</code>等宏，注意，Swift中是<code>#elseif</code>，而在OC中是<code>#elif</code>。还有<code>#if</code>和<code>#elseif</code>后面的判断条件必须是Bool类型的。</li>\n</ul>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#<span class=\"keyword\">if</span> <span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">\"aaaa\"</span>)</span><br><span class=\"line\">#elseif <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">\"bbbb\"</span>)</span><br><span class=\"line\">#<span class=\"keyword\">else</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">\"cccc\"</span>)</span><br><span class=\"line\">#endif</span><br></pre></td></tr></table></figure>\n<ul>\n<li>Swift中取消了<code>__FUNCTION__, __FILE__, __LINE__</code>，分别改为了<code>#function, #file, #line</code></li>\n</ul>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">print</span>(#file)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(#line)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">function1</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(#function)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<p>Swift中也可以使用预处理宏，只不过和ObjectiveC有点不一样，下面详细说明一下。</p>\n<ul>\n<li>Swift中取消了#define，建议使用全局常量替换宏定义</li>\n<li>Swift中仍然可以使用<code>#if, #elseif, #endif</code>等宏，注意，Swift中是<code>#elseif</code>，而在OC中是<code>#elif</code>。还有<code>#if</code>和<code>#elseif</code>后面的判断条件必须是Bool类型的。</li>\n</ul>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#<span class=\"keyword\">if</span> <span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">\"aaaa\"</span>)</span><br><span class=\"line\">#elseif <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">\"bbbb\"</span>)</span><br><span class=\"line\">#<span class=\"keyword\">else</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">\"cccc\"</span>)</span><br><span class=\"line\">#endif</span><br></pre></td></tr></table></figure>\n<ul>\n<li>Swift中取消了<code>__FUNCTION__, __FILE__, __LINE__</code>，分别改为了<code>#function, #file, #line</code></li>\n</ul>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">print</span>(#file)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(#line)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">function1</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(#function)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n"},{"title":"iOS10无法获取IDFA的问题","date":"2016-10-18T02:17:44.000Z","_content":"\niOS10上，如果用户开启了“限制广告跟踪”选项（设置->隐私->广告），则在使用`[[[ASIdentifierManager sharedManager] advertisingIdentifier] UUIDString]`方法获取IDFA时会返回全部是0，如下：\n\n![1](http://oldblog.shicishuzhai.com/13bbfe746dacb7c156cac2aaac5b2c0d.png)\n\n有两种解决方案：\n\n第一种方法是通过`isAdvertisingTrackingEnabled`属性判断是否可以返回正确的IDFA，如果返回为NO，则可以提示用户去设置中关闭限制广告跟踪。代码如下：\n\n```objectivec\nNSString *idfa = nil;\nif ([[ASIdentifierManager sharedManager] isAdvertisingTrackingEnabled]) {\n    idfa = [[[ASIdentifierManager sharedManager] advertisingIdentifier] UUIDString];\n}\nelse {\n    // 弹窗提示用户关闭限制广告跟踪\n}\n```\n\n另外一种更好的方法是使用第三方库获取IDFA，这里推荐两个第三方库：[OpenIDFA](https://github.com/ylechelle/OpenIDFA)和[SimulateIDFA](https://github.com/youmi/SimulateIDFA)，个人更推荐SimulateIDFA，因为他的重复率更低。\n","source":"_posts/2016-10-18-iOS10无法获取IDFA的问题.md","raw":"---\ntitle: iOS10无法获取IDFA的问题\ncategories: iOS Tips\ntags:\n  - IDFA\ndate: 2016-10-18 10:17:44\n---\n\niOS10上，如果用户开启了“限制广告跟踪”选项（设置->隐私->广告），则在使用`[[[ASIdentifierManager sharedManager] advertisingIdentifier] UUIDString]`方法获取IDFA时会返回全部是0，如下：\n\n![1](http://oldblog.shicishuzhai.com/13bbfe746dacb7c156cac2aaac5b2c0d.png)\n\n有两种解决方案：\n\n第一种方法是通过`isAdvertisingTrackingEnabled`属性判断是否可以返回正确的IDFA，如果返回为NO，则可以提示用户去设置中关闭限制广告跟踪。代码如下：\n\n```objectivec\nNSString *idfa = nil;\nif ([[ASIdentifierManager sharedManager] isAdvertisingTrackingEnabled]) {\n    idfa = [[[ASIdentifierManager sharedManager] advertisingIdentifier] UUIDString];\n}\nelse {\n    // 弹窗提示用户关闭限制广告跟踪\n}\n```\n\n另外一种更好的方法是使用第三方库获取IDFA，这里推荐两个第三方库：[OpenIDFA](https://github.com/ylechelle/OpenIDFA)和[SimulateIDFA](https://github.com/youmi/SimulateIDFA)，个人更推荐SimulateIDFA，因为他的重复率更低。\n","slug":"iOS10无法获取IDFA的问题","published":1,"updated":"2019-01-13T04:01:04.507Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjutyfmg1003bc4c9gq0r5qmx","content":"<p>iOS10上，如果用户开启了“限制广告跟踪”选项（设置-&gt;隐私-&gt;广告），则在使用<code>[[[ASIdentifierManager sharedManager] advertisingIdentifier] UUIDString]</code>方法获取IDFA时会返回全部是0，如下：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/13bbfe746dacb7c156cac2aaac5b2c0d.png\" alt=\"1\"></p>\n<p>有两种解决方案：</p>\n<p>第一种方法是通过<code>isAdvertisingTrackingEnabled</code>属性判断是否可以返回正确的IDFA，如果返回为NO，则可以提示用户去设置中关闭限制广告跟踪。代码如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">NSString</span> *idfa = <span class=\"literal\">nil</span>;</span><br><span class=\"line\"><span class=\"keyword\">if</span> ([[ASIdentifierManager sharedManager] isAdvertisingTrackingEnabled]) &#123;</span><br><span class=\"line\">    idfa = [[[ASIdentifierManager sharedManager] advertisingIdentifier] UUIDString];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 弹窗提示用户关闭限制广告跟踪</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>另外一种更好的方法是使用第三方库获取IDFA，这里推荐两个第三方库：<a href=\"https://github.com/ylechelle/OpenIDFA\" target=\"_blank\" rel=\"noopener\">OpenIDFA</a>和<a href=\"https://github.com/youmi/SimulateIDFA\" target=\"_blank\" rel=\"noopener\">SimulateIDFA</a>，个人更推荐SimulateIDFA，因为他的重复率更低。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>iOS10上，如果用户开启了“限制广告跟踪”选项（设置-&gt;隐私-&gt;广告），则在使用<code>[[[ASIdentifierManager sharedManager] advertisingIdentifier] UUIDString]</code>方法获取IDFA时会返回全部是0，如下：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/13bbfe746dacb7c156cac2aaac5b2c0d.png\" alt=\"1\"></p>\n<p>有两种解决方案：</p>\n<p>第一种方法是通过<code>isAdvertisingTrackingEnabled</code>属性判断是否可以返回正确的IDFA，如果返回为NO，则可以提示用户去设置中关闭限制广告跟踪。代码如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">NSString</span> *idfa = <span class=\"literal\">nil</span>;</span><br><span class=\"line\"><span class=\"keyword\">if</span> ([[ASIdentifierManager sharedManager] isAdvertisingTrackingEnabled]) &#123;</span><br><span class=\"line\">    idfa = [[[ASIdentifierManager sharedManager] advertisingIdentifier] UUIDString];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 弹窗提示用户关闭限制广告跟踪</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>另外一种更好的方法是使用第三方库获取IDFA，这里推荐两个第三方库：<a href=\"https://github.com/ylechelle/OpenIDFA\" target=\"_blank\" rel=\"noopener\">OpenIDFA</a>和<a href=\"https://github.com/youmi/SimulateIDFA\" target=\"_blank\" rel=\"noopener\">SimulateIDFA</a>，个人更推荐SimulateIDFA，因为他的重复率更低。</p>\n"},{"title":"使用defaults命令获取iOS项目版本号","date":"2016-11-15T01:51:44.000Z","_content":"\ndefaults命令可以用来读取和修改plist文件，因此可以用它来读取iOS项目里的Info.plist文件，具体用法如下：\n\n```shell\ndefaults read <plist文件的绝对路径> <Key>\n```\n\n例如，读取项目的版本号，则名为如下：\n\n```shell\ndefaults read ~/Project/Info.plist CFBundleShortVersionString\n```\n\n这里要注意，**路径一定要是绝对路径，不能是相对路径**。\n\n有了这个命令，我们就可以很方便的在脚本中获取版本号，编写一些更复杂的应用。\n\n其实，获取版本号还可以使用xcode自带的[agvtool](https://developer.apple.com/legacy/library/documentation/Darwin/Reference/ManPages/man1/agvtool.1.html)，但是如果项目中有多个.xcodeproj文件，agvtool就不能正确获取版本号了，暂时还没找到解决方案。\n\n### 参考资料\n\n[Automating Version and Build Numbers Using agvtool](https://developer.apple.com/library/content/qa/qa1827/_index.html)\n[Include Build Number in ipa info command](https://github.com/nomad/shenzhen/issues/160)\n","source":"_posts/2016-11-15-使用defaults命令获取iOS项目版本号.md","raw":"---\ntitle: 使用defaults命令获取iOS项目版本号\ncategories: iOS Tips\ntags:\n  - 其他\ndate: 2016-11-15 09:51:44\n---\n\ndefaults命令可以用来读取和修改plist文件，因此可以用它来读取iOS项目里的Info.plist文件，具体用法如下：\n\n```shell\ndefaults read <plist文件的绝对路径> <Key>\n```\n\n例如，读取项目的版本号，则名为如下：\n\n```shell\ndefaults read ~/Project/Info.plist CFBundleShortVersionString\n```\n\n这里要注意，**路径一定要是绝对路径，不能是相对路径**。\n\n有了这个命令，我们就可以很方便的在脚本中获取版本号，编写一些更复杂的应用。\n\n其实，获取版本号还可以使用xcode自带的[agvtool](https://developer.apple.com/legacy/library/documentation/Darwin/Reference/ManPages/man1/agvtool.1.html)，但是如果项目中有多个.xcodeproj文件，agvtool就不能正确获取版本号了，暂时还没找到解决方案。\n\n### 参考资料\n\n[Automating Version and Build Numbers Using agvtool](https://developer.apple.com/library/content/qa/qa1827/_index.html)\n[Include Build Number in ipa info command](https://github.com/nomad/shenzhen/issues/160)\n","slug":"使用defaults命令获取iOS项目版本号","published":1,"updated":"2017-03-01T06:42:53.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjutyfmg2003ec4c942ec6kum","content":"<p>defaults命令可以用来读取和修改plist文件，因此可以用它来读取iOS项目里的Info.plist文件，具体用法如下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">defaults read &lt;plist文件的绝对路径&gt; &lt;Key&gt;</span><br></pre></td></tr></table></figure>\n<p>例如，读取项目的版本号，则名为如下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">defaults read ~/Project/Info.plist CFBundleShortVersionString</span><br></pre></td></tr></table></figure>\n<p>这里要注意，<strong>路径一定要是绝对路径，不能是相对路径</strong>。</p>\n<p>有了这个命令，我们就可以很方便的在脚本中获取版本号，编写一些更复杂的应用。</p>\n<p>其实，获取版本号还可以使用xcode自带的<a href=\"https://developer.apple.com/legacy/library/documentation/Darwin/Reference/ManPages/man1/agvtool.1.html\" target=\"_blank\" rel=\"noopener\">agvtool</a>，但是如果项目中有多个.xcodeproj文件，agvtool就不能正确获取版本号了，暂时还没找到解决方案。</p>\n<h3 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h3><p><a href=\"https://developer.apple.com/library/content/qa/qa1827/_index.html\" target=\"_blank\" rel=\"noopener\">Automating Version and Build Numbers Using agvtool</a><br><a href=\"https://github.com/nomad/shenzhen/issues/160\" target=\"_blank\" rel=\"noopener\">Include Build Number in ipa info command</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>defaults命令可以用来读取和修改plist文件，因此可以用它来读取iOS项目里的Info.plist文件，具体用法如下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">defaults read &lt;plist文件的绝对路径&gt; &lt;Key&gt;</span><br></pre></td></tr></table></figure>\n<p>例如，读取项目的版本号，则名为如下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">defaults read ~/Project/Info.plist CFBundleShortVersionString</span><br></pre></td></tr></table></figure>\n<p>这里要注意，<strong>路径一定要是绝对路径，不能是相对路径</strong>。</p>\n<p>有了这个命令，我们就可以很方便的在脚本中获取版本号，编写一些更复杂的应用。</p>\n<p>其实，获取版本号还可以使用xcode自带的<a href=\"https://developer.apple.com/legacy/library/documentation/Darwin/Reference/ManPages/man1/agvtool.1.html\" target=\"_blank\" rel=\"noopener\">agvtool</a>，但是如果项目中有多个.xcodeproj文件，agvtool就不能正确获取版本号了，暂时还没找到解决方案。</p>\n<h3 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h3><p><a href=\"https://developer.apple.com/library/content/qa/qa1827/_index.html\" target=\"_blank\" rel=\"noopener\">Automating Version and Build Numbers Using agvtool</a><br><a href=\"https://github.com/nomad/shenzhen/issues/160\" target=\"_blank\" rel=\"noopener\">Include Build Number in ipa info command</a></p>\n"},{"title":"Objective-C中如何忽略warning","date":"2016-11-10T13:05:51.000Z","_content":"\n经常会在有些第三方框架里看到这样的代码：\n\n```objectivec\n#pragma clang diagnostic push\n#pragma clang diagnostic ignored \"-Wgnu\"\n    NSString *pathToBeMatched = nil;\n    if (method && path) {\n        pathToBeMatched = [[[self requestWithMethod:(method ?: @\"GET\") path:path parameters:nil] URL] path];\n    }\n#pragma clang diagnostic pop\n```\n\n这段代码的前两句和最后一句的作用是忽略中间的代码的某种警告（warning），如果我们的代码中有些警告希望被忽略，可以使用这种方法忽略警告。\n\n其中第二句代码的`-Wgnu`是警告类型，可以通过以下方法查看警告类型。\n\n首先Command+b编译代码，然后Command+8来到报告导航栏，选中刚才的那次编译，如下图：\n\n![1](http://oldblog.shicishuzhai.com/ba9ee4f9e59a474670f251598e7978d6.png)\n\n然后在左侧，找到相应的警告详情，点击左边的![2](http://oldblog.shicishuzhai.com/f12763686090a1cec73de963526971be.png)按钮可以打开详情，然后就可以在最底部的警告描述里找到警告的类型，如下图：\n\n![3](http://oldblog.shicishuzhai.com/4d8b40432de09a56e50622b099f002bb.png)\n\n以上就是OC忽略警告的方法。\n","source":"_posts/2016-11-10-Objective-C中如何忽略warning.md","raw":"---\ntitle: Objective-C中如何忽略warning\ncategories: iOS Tips\ntags:\n  - Objective-C\ndate: 2016-11-10 21:05:51\n---\n\n经常会在有些第三方框架里看到这样的代码：\n\n```objectivec\n#pragma clang diagnostic push\n#pragma clang diagnostic ignored \"-Wgnu\"\n    NSString *pathToBeMatched = nil;\n    if (method && path) {\n        pathToBeMatched = [[[self requestWithMethod:(method ?: @\"GET\") path:path parameters:nil] URL] path];\n    }\n#pragma clang diagnostic pop\n```\n\n这段代码的前两句和最后一句的作用是忽略中间的代码的某种警告（warning），如果我们的代码中有些警告希望被忽略，可以使用这种方法忽略警告。\n\n其中第二句代码的`-Wgnu`是警告类型，可以通过以下方法查看警告类型。\n\n首先Command+b编译代码，然后Command+8来到报告导航栏，选中刚才的那次编译，如下图：\n\n![1](http://oldblog.shicishuzhai.com/ba9ee4f9e59a474670f251598e7978d6.png)\n\n然后在左侧，找到相应的警告详情，点击左边的![2](http://oldblog.shicishuzhai.com/f12763686090a1cec73de963526971be.png)按钮可以打开详情，然后就可以在最底部的警告描述里找到警告的类型，如下图：\n\n![3](http://oldblog.shicishuzhai.com/4d8b40432de09a56e50622b099f002bb.png)\n\n以上就是OC忽略警告的方法。\n","slug":"Objective-C中如何忽略warning","published":1,"updated":"2019-01-13T04:01:04.441Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjutyfmg3003hc4c9uffh2d10","content":"<p>经常会在有些第三方框架里看到这样的代码：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#pragma clang diagnostic push</span></span><br><span class=\"line\"><span class=\"meta\">#pragma clang diagnostic ignored <span class=\"meta-string\">\"-Wgnu\"</span></span></span><br><span class=\"line\">    <span class=\"built_in\">NSString</span> *pathToBeMatched = <span class=\"literal\">nil</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (method &amp;&amp; path) &#123;</span><br><span class=\"line\">        pathToBeMatched = [[[<span class=\"keyword\">self</span> requestWithMethod:(method ?: <span class=\"string\">@\"GET\"</span>) path:path parameters:<span class=\"literal\">nil</span>] URL] path];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"><span class=\"meta\">#pragma clang diagnostic pop</span></span><br></pre></td></tr></table></figure>\n<p>这段代码的前两句和最后一句的作用是忽略中间的代码的某种警告（warning），如果我们的代码中有些警告希望被忽略，可以使用这种方法忽略警告。</p>\n<p>其中第二句代码的<code>-Wgnu</code>是警告类型，可以通过以下方法查看警告类型。</p>\n<p>首先Command+b编译代码，然后Command+8来到报告导航栏，选中刚才的那次编译，如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/ba9ee4f9e59a474670f251598e7978d6.png\" alt=\"1\"></p>\n<p>然后在左侧，找到相应的警告详情，点击左边的<img src=\"http://oldblog.shicishuzhai.com/f12763686090a1cec73de963526971be.png\" alt=\"2\">按钮可以打开详情，然后就可以在最底部的警告描述里找到警告的类型，如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/4d8b40432de09a56e50622b099f002bb.png\" alt=\"3\"></p>\n<p>以上就是OC忽略警告的方法。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>经常会在有些第三方框架里看到这样的代码：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#pragma clang diagnostic push</span></span><br><span class=\"line\"><span class=\"meta\">#pragma clang diagnostic ignored <span class=\"meta-string\">\"-Wgnu\"</span></span></span><br><span class=\"line\">    <span class=\"built_in\">NSString</span> *pathToBeMatched = <span class=\"literal\">nil</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (method &amp;&amp; path) &#123;</span><br><span class=\"line\">        pathToBeMatched = [[[<span class=\"keyword\">self</span> requestWithMethod:(method ?: <span class=\"string\">@\"GET\"</span>) path:path parameters:<span class=\"literal\">nil</span>] URL] path];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"><span class=\"meta\">#pragma clang diagnostic pop</span></span><br></pre></td></tr></table></figure>\n<p>这段代码的前两句和最后一句的作用是忽略中间的代码的某种警告（warning），如果我们的代码中有些警告希望被忽略，可以使用这种方法忽略警告。</p>\n<p>其中第二句代码的<code>-Wgnu</code>是警告类型，可以通过以下方法查看警告类型。</p>\n<p>首先Command+b编译代码，然后Command+8来到报告导航栏，选中刚才的那次编译，如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/ba9ee4f9e59a474670f251598e7978d6.png\" alt=\"1\"></p>\n<p>然后在左侧，找到相应的警告详情，点击左边的<img src=\"http://oldblog.shicishuzhai.com/f12763686090a1cec73de963526971be.png\" alt=\"2\">按钮可以打开详情，然后就可以在最底部的警告描述里找到警告的类型，如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/4d8b40432de09a56e50622b099f002bb.png\" alt=\"3\"></p>\n<p>以上就是OC忽略警告的方法。</p>\n"},{"title":"Xcode如何设置在编译前自动运行脚本","date":"2016-11-27T04:45:13.000Z","_content":"\n有时我们可能需要在iOS项目打包前执行一些操作，例如更新资源，修改配置等等，手动修改太麻烦也太Low了，那有没有自动执行的方法呢？\n\n当然有，这里我会列举三种方法，并且着重讲解一下最后一种方法\n\n### 三种方法\n\n* 第一种方法：如果你使用的是脚本进行打包，那么事情就简单了，在执行xcodebuild命令前，执行你想做的操作就可以了。\n* 第二种方法：使用CI平台，最常用的就是jenkins，一般的CI平台都支持在编译前执行脚本。\n* 第三种方法：如果你使用的是Xcode Archive进行打包，那么就要用到下面的方法添加编译前执行的脚本。\n\n### 具体步骤\n\n打开项目配置，选择Build Phases\n\n![1](http://oldblog.shicishuzhai.com/5335ab06bc21202c00fa0014d2df47a3.png)\n\n点击左上角的加号，选择New Run Script Phase\n\n![2](http://oldblog.shicishuzhai.com/63c4d36a01c97b137892fa32fb78a028.png)\n\n这样就可以创建一个新Script Phase，然后在黑色区域写入你的脚本\n\n![3](http://oldblog.shicishuzhai.com/f247183d1bc837e1d67ea5ae04281be5.png)\n\n在脚本中，你可以使用一些环境变量，例如``${SRCROOT}``表示项目的根目录，``${CONFIGURATION}``表示项目的Configuration，更多可以使用的环境变量可以参考[苹果官方文档](https://developer.apple.com/legacy/library/documentation/DeveloperTools/Reference/XcodeBuildSettingRef/0-Introduction/introduction.html#//apple_ref/doc/uid/TP40003931-CH1-SW1)。\n\n最后一步，也是最关键的一步（我在这里卡了半天），选中你创建的Script Phase，然后按住鼠标，把它拖到Compile Source的上面，这样你的脚本才会在代码编译前执行，否则脚本是在代码编译后执行的，如下图：\n\n![4](http://oldblog.shicishuzhai.com/d44a9e7f77e737fce5826e39d74a3d9d.png)\n\n这样在编译时就会自动执行脚本了。上图中的脚本内容是在Release下编译时自动执行一个Python脚本。脚本的输出内容可以在Build Log里找到，如下图：\n\n![5](http://oldblog.shicishuzhai.com/7bef4677d75f71376b834102880f364b.png)\n\n以上就是整个配置过程，希望这篇文章对您有帮助。\n","source":"_posts/2016-11-27-Xcode如何设置在编译前自动运行脚本.md","raw":"---\ntitle: Xcode如何设置在编译前自动运行脚本\ncategories: iOS Tips\ntags:\n  - Xcode\ndate: 2016-11-27 12:45:13\n---\n\n有时我们可能需要在iOS项目打包前执行一些操作，例如更新资源，修改配置等等，手动修改太麻烦也太Low了，那有没有自动执行的方法呢？\n\n当然有，这里我会列举三种方法，并且着重讲解一下最后一种方法\n\n### 三种方法\n\n* 第一种方法：如果你使用的是脚本进行打包，那么事情就简单了，在执行xcodebuild命令前，执行你想做的操作就可以了。\n* 第二种方法：使用CI平台，最常用的就是jenkins，一般的CI平台都支持在编译前执行脚本。\n* 第三种方法：如果你使用的是Xcode Archive进行打包，那么就要用到下面的方法添加编译前执行的脚本。\n\n### 具体步骤\n\n打开项目配置，选择Build Phases\n\n![1](http://oldblog.shicishuzhai.com/5335ab06bc21202c00fa0014d2df47a3.png)\n\n点击左上角的加号，选择New Run Script Phase\n\n![2](http://oldblog.shicishuzhai.com/63c4d36a01c97b137892fa32fb78a028.png)\n\n这样就可以创建一个新Script Phase，然后在黑色区域写入你的脚本\n\n![3](http://oldblog.shicishuzhai.com/f247183d1bc837e1d67ea5ae04281be5.png)\n\n在脚本中，你可以使用一些环境变量，例如``${SRCROOT}``表示项目的根目录，``${CONFIGURATION}``表示项目的Configuration，更多可以使用的环境变量可以参考[苹果官方文档](https://developer.apple.com/legacy/library/documentation/DeveloperTools/Reference/XcodeBuildSettingRef/0-Introduction/introduction.html#//apple_ref/doc/uid/TP40003931-CH1-SW1)。\n\n最后一步，也是最关键的一步（我在这里卡了半天），选中你创建的Script Phase，然后按住鼠标，把它拖到Compile Source的上面，这样你的脚本才会在代码编译前执行，否则脚本是在代码编译后执行的，如下图：\n\n![4](http://oldblog.shicishuzhai.com/d44a9e7f77e737fce5826e39d74a3d9d.png)\n\n这样在编译时就会自动执行脚本了。上图中的脚本内容是在Release下编译时自动执行一个Python脚本。脚本的输出内容可以在Build Log里找到，如下图：\n\n![5](http://oldblog.shicishuzhai.com/7bef4677d75f71376b834102880f364b.png)\n\n以上就是整个配置过程，希望这篇文章对您有帮助。\n","slug":"Xcode如何设置在编译前自动运行脚本","published":1,"updated":"2019-01-13T04:01:04.558Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjutyfmg5003lc4c9bjcsqr6u","content":"<p>有时我们可能需要在iOS项目打包前执行一些操作，例如更新资源，修改配置等等，手动修改太麻烦也太Low了，那有没有自动执行的方法呢？</p>\n<p>当然有，这里我会列举三种方法，并且着重讲解一下最后一种方法</p>\n<h3 id=\"三种方法\"><a href=\"#三种方法\" class=\"headerlink\" title=\"三种方法\"></a>三种方法</h3><ul>\n<li>第一种方法：如果你使用的是脚本进行打包，那么事情就简单了，在执行xcodebuild命令前，执行你想做的操作就可以了。</li>\n<li>第二种方法：使用CI平台，最常用的就是jenkins，一般的CI平台都支持在编译前执行脚本。</li>\n<li>第三种方法：如果你使用的是Xcode Archive进行打包，那么就要用到下面的方法添加编译前执行的脚本。</li>\n</ul>\n<h3 id=\"具体步骤\"><a href=\"#具体步骤\" class=\"headerlink\" title=\"具体步骤\"></a>具体步骤</h3><p>打开项目配置，选择Build Phases</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/5335ab06bc21202c00fa0014d2df47a3.png\" alt=\"1\"></p>\n<p>点击左上角的加号，选择New Run Script Phase</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/63c4d36a01c97b137892fa32fb78a028.png\" alt=\"2\"></p>\n<p>这样就可以创建一个新Script Phase，然后在黑色区域写入你的脚本</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/f247183d1bc837e1d67ea5ae04281be5.png\" alt=\"3\"></p>\n<p>在脚本中，你可以使用一些环境变量，例如<code>${SRCROOT}</code>表示项目的根目录，<code>${CONFIGURATION}</code>表示项目的Configuration，更多可以使用的环境变量可以参考<a href=\"https://developer.apple.com/legacy/library/documentation/DeveloperTools/Reference/XcodeBuildSettingRef/0-Introduction/introduction.html#//apple_ref/doc/uid/TP40003931-CH1-SW1\" target=\"_blank\" rel=\"noopener\">苹果官方文档</a>。</p>\n<p>最后一步，也是最关键的一步（我在这里卡了半天），选中你创建的Script Phase，然后按住鼠标，把它拖到Compile Source的上面，这样你的脚本才会在代码编译前执行，否则脚本是在代码编译后执行的，如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/d44a9e7f77e737fce5826e39d74a3d9d.png\" alt=\"4\"></p>\n<p>这样在编译时就会自动执行脚本了。上图中的脚本内容是在Release下编译时自动执行一个Python脚本。脚本的输出内容可以在Build Log里找到，如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/7bef4677d75f71376b834102880f364b.png\" alt=\"5\"></p>\n<p>以上就是整个配置过程，希望这篇文章对您有帮助。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>有时我们可能需要在iOS项目打包前执行一些操作，例如更新资源，修改配置等等，手动修改太麻烦也太Low了，那有没有自动执行的方法呢？</p>\n<p>当然有，这里我会列举三种方法，并且着重讲解一下最后一种方法</p>\n<h3 id=\"三种方法\"><a href=\"#三种方法\" class=\"headerlink\" title=\"三种方法\"></a>三种方法</h3><ul>\n<li>第一种方法：如果你使用的是脚本进行打包，那么事情就简单了，在执行xcodebuild命令前，执行你想做的操作就可以了。</li>\n<li>第二种方法：使用CI平台，最常用的就是jenkins，一般的CI平台都支持在编译前执行脚本。</li>\n<li>第三种方法：如果你使用的是Xcode Archive进行打包，那么就要用到下面的方法添加编译前执行的脚本。</li>\n</ul>\n<h3 id=\"具体步骤\"><a href=\"#具体步骤\" class=\"headerlink\" title=\"具体步骤\"></a>具体步骤</h3><p>打开项目配置，选择Build Phases</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/5335ab06bc21202c00fa0014d2df47a3.png\" alt=\"1\"></p>\n<p>点击左上角的加号，选择New Run Script Phase</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/63c4d36a01c97b137892fa32fb78a028.png\" alt=\"2\"></p>\n<p>这样就可以创建一个新Script Phase，然后在黑色区域写入你的脚本</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/f247183d1bc837e1d67ea5ae04281be5.png\" alt=\"3\"></p>\n<p>在脚本中，你可以使用一些环境变量，例如<code>${SRCROOT}</code>表示项目的根目录，<code>${CONFIGURATION}</code>表示项目的Configuration，更多可以使用的环境变量可以参考<a href=\"https://developer.apple.com/legacy/library/documentation/DeveloperTools/Reference/XcodeBuildSettingRef/0-Introduction/introduction.html#//apple_ref/doc/uid/TP40003931-CH1-SW1\" target=\"_blank\" rel=\"noopener\">苹果官方文档</a>。</p>\n<p>最后一步，也是最关键的一步（我在这里卡了半天），选中你创建的Script Phase，然后按住鼠标，把它拖到Compile Source的上面，这样你的脚本才会在代码编译前执行，否则脚本是在代码编译后执行的，如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/d44a9e7f77e737fce5826e39d74a3d9d.png\" alt=\"4\"></p>\n<p>这样在编译时就会自动执行脚本了。上图中的脚本内容是在Release下编译时自动执行一个Python脚本。脚本的输出内容可以在Build Log里找到，如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/7bef4677d75f71376b834102880f364b.png\" alt=\"5\"></p>\n<p>以上就是整个配置过程，希望这篇文章对您有帮助。</p>\n"},{"title":"使用NSURLProtocol时要注意的一些问题","date":"2016-12-20T15:34:03.000Z","_content":"\n项目中使用到了NSURLProtocol，用于拦截所有发出的请求并做一些处理。具体用法可以参考[这篇文章](http://nshipster.cn/nsurlprotocol/)，我还专门写了一个[Demo](https://github.com/liujinlongxa/NSURLProtocolDemo)。最近在使用过程中遇到了一些问题，记录如下。\n\n## 拦截到的POST请求的HTTPBody为空\n\n最近由于升级了AFNetworking，在使用NSURLProtocol过程中发现了一个问题，就是在拦截到POST请求后，HTTPBody是空的。以前使用旧版本的AFNetworking时是没有这问题的。分析了一下，新版的AFNetworking使用的是NSURLSession，旧版使用的是NSURLConnection，可能是由于这个原因导致的。网上查了一下，还真有这个问题，具体可以看[这个问题](http://stackoverflow.com/questions/36555018/why-is-the-httpbody-of-a-request-inside-an-nsurlprotocol-subclass-always-nil)以及[这里的讨论](https://bugs.webkit.org/show_bug.cgi?id=137299)。\n\n网上有人提出了一种解决方案，就是不要使用HTTPBody，而使用HTTPBodyStream。具体实现如下：\n\n```objectivec\nNSMutableURLRequest * request = [[NSMutableURLRequest alloc] initWithURL:url];\nrequest.allHTTPHeaderFields = self.request.allHTTPHeaderFields;\nif ([self.request.HTTPMethod isEqualToString:@\"POST\"]) {\n    request.HTTPMethod = @\"POST\";\n    if (!self.request.HTTPBody) {\n        uint8_t d[1024] = {0};\n        NSInputStream *stream = self.request.HTTPBodyStream;\n        NSMutableData *data = [[NSMutableData alloc] init];\n        [stream open];\n\n        while ([stream hasBytesAvailable]) {\n            NSInteger len = [stream read:d maxLength:1024];\n            if (len > 0 && stream.streamError == nil) {\n                [data appendBytes:(void *)d length:len];\n            }\n        }\n        request.HTTPBody = [data copy];\n        [stream close];\n    }\n    else {\n        request.HTTPBody = self.request.HTTPBody;\n    }\n}\n```\n\n通过这个方法就可以获得HTTPBody的内容。\n\n## `+registerClass:`方法只适用于`sharedSession`\n\n另外一个要注意的地方就是，只用在使用`[NSURLSession sharedSession]`时，注册NSURLProtocol才能使用`+registerClass:`方法，否则就需要使用`NSURLSessionConfiguration`来注册NSURLProtocol，代码如下：\n\n```objectivec\nNSURLSessionConfiguration *configuration = [NSURLSessionConfiguration defaultSessionConfiguration];\nconfiguration.protocolClasses = @[[MySessionURLProtocol class]];\nself.session = [NSURLSession sessionWithConfiguration:configuration];\n```\n\n因此，对于新版的AFNetworking，由于它使用的不是`sharedSession`，所以就不能简单的通过类方法`+registerClass:`来注册自定义NSURLProtocol，也必须通过`NSURLSessionConfiguration`来设置。代码如下：\n\n```objectivec\nNSURLSessionConfiguration *configuration = [NSURLSessionConfiguration defaultSessionConfiguration];\nconfiguration.protocolClasses = @[[CustomUrlProtocol class]];\nAFHTTPSessionManager *sessionManager = [[AFHTTPSessionManager alloc] initWithBaseURL:baseUrl sessionConfiguration:configuration];\n[sessionManager GET:url parameters:params progress:^(NSProgress * _Nonnull downloadProgress) {\n    // do somting\n} success:^(NSURLSessionDataTask * _Nonnull task, id  _Nullable responseObject) {\n    // do somting\n} failure:^(NSURLSessionDataTask * _Nullable task, NSError * _Nonnull error) {\n    // do somting\n}];\n```\n\n以上就是使用NSURLProtocol时要注意的两个问题，希望能对大家有所帮助。\n","source":"_posts/2016-12-20-使用NSURLProtocol注意的一些问题.md","raw":"---\ntitle: 使用NSURLProtocol时要注意的一些问题\ncategories: iOS Tips\ntags:\n  - 其他\ndate: 2016-12-20 23:34:03\n---\n\n项目中使用到了NSURLProtocol，用于拦截所有发出的请求并做一些处理。具体用法可以参考[这篇文章](http://nshipster.cn/nsurlprotocol/)，我还专门写了一个[Demo](https://github.com/liujinlongxa/NSURLProtocolDemo)。最近在使用过程中遇到了一些问题，记录如下。\n\n## 拦截到的POST请求的HTTPBody为空\n\n最近由于升级了AFNetworking，在使用NSURLProtocol过程中发现了一个问题，就是在拦截到POST请求后，HTTPBody是空的。以前使用旧版本的AFNetworking时是没有这问题的。分析了一下，新版的AFNetworking使用的是NSURLSession，旧版使用的是NSURLConnection，可能是由于这个原因导致的。网上查了一下，还真有这个问题，具体可以看[这个问题](http://stackoverflow.com/questions/36555018/why-is-the-httpbody-of-a-request-inside-an-nsurlprotocol-subclass-always-nil)以及[这里的讨论](https://bugs.webkit.org/show_bug.cgi?id=137299)。\n\n网上有人提出了一种解决方案，就是不要使用HTTPBody，而使用HTTPBodyStream。具体实现如下：\n\n```objectivec\nNSMutableURLRequest * request = [[NSMutableURLRequest alloc] initWithURL:url];\nrequest.allHTTPHeaderFields = self.request.allHTTPHeaderFields;\nif ([self.request.HTTPMethod isEqualToString:@\"POST\"]) {\n    request.HTTPMethod = @\"POST\";\n    if (!self.request.HTTPBody) {\n        uint8_t d[1024] = {0};\n        NSInputStream *stream = self.request.HTTPBodyStream;\n        NSMutableData *data = [[NSMutableData alloc] init];\n        [stream open];\n\n        while ([stream hasBytesAvailable]) {\n            NSInteger len = [stream read:d maxLength:1024];\n            if (len > 0 && stream.streamError == nil) {\n                [data appendBytes:(void *)d length:len];\n            }\n        }\n        request.HTTPBody = [data copy];\n        [stream close];\n    }\n    else {\n        request.HTTPBody = self.request.HTTPBody;\n    }\n}\n```\n\n通过这个方法就可以获得HTTPBody的内容。\n\n## `+registerClass:`方法只适用于`sharedSession`\n\n另外一个要注意的地方就是，只用在使用`[NSURLSession sharedSession]`时，注册NSURLProtocol才能使用`+registerClass:`方法，否则就需要使用`NSURLSessionConfiguration`来注册NSURLProtocol，代码如下：\n\n```objectivec\nNSURLSessionConfiguration *configuration = [NSURLSessionConfiguration defaultSessionConfiguration];\nconfiguration.protocolClasses = @[[MySessionURLProtocol class]];\nself.session = [NSURLSession sessionWithConfiguration:configuration];\n```\n\n因此，对于新版的AFNetworking，由于它使用的不是`sharedSession`，所以就不能简单的通过类方法`+registerClass:`来注册自定义NSURLProtocol，也必须通过`NSURLSessionConfiguration`来设置。代码如下：\n\n```objectivec\nNSURLSessionConfiguration *configuration = [NSURLSessionConfiguration defaultSessionConfiguration];\nconfiguration.protocolClasses = @[[CustomUrlProtocol class]];\nAFHTTPSessionManager *sessionManager = [[AFHTTPSessionManager alloc] initWithBaseURL:baseUrl sessionConfiguration:configuration];\n[sessionManager GET:url parameters:params progress:^(NSProgress * _Nonnull downloadProgress) {\n    // do somting\n} success:^(NSURLSessionDataTask * _Nonnull task, id  _Nullable responseObject) {\n    // do somting\n} failure:^(NSURLSessionDataTask * _Nullable task, NSError * _Nonnull error) {\n    // do somting\n}];\n```\n\n以上就是使用NSURLProtocol时要注意的两个问题，希望能对大家有所帮助。\n","slug":"使用NSURLProtocol注意的一些问题","published":1,"updated":"2017-03-01T06:42:53.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjutyfmg6003oc4c97pwxfmgi","content":"<p>项目中使用到了NSURLProtocol，用于拦截所有发出的请求并做一些处理。具体用法可以参考<a href=\"http://nshipster.cn/nsurlprotocol/\" target=\"_blank\" rel=\"noopener\">这篇文章</a>，我还专门写了一个<a href=\"https://github.com/liujinlongxa/NSURLProtocolDemo\" target=\"_blank\" rel=\"noopener\">Demo</a>。最近在使用过程中遇到了一些问题，记录如下。</p>\n<h2 id=\"拦截到的POST请求的HTTPBody为空\"><a href=\"#拦截到的POST请求的HTTPBody为空\" class=\"headerlink\" title=\"拦截到的POST请求的HTTPBody为空\"></a>拦截到的POST请求的HTTPBody为空</h2><p>最近由于升级了AFNetworking，在使用NSURLProtocol过程中发现了一个问题，就是在拦截到POST请求后，HTTPBody是空的。以前使用旧版本的AFNetworking时是没有这问题的。分析了一下，新版的AFNetworking使用的是NSURLSession，旧版使用的是NSURLConnection，可能是由于这个原因导致的。网上查了一下，还真有这个问题，具体可以看<a href=\"http://stackoverflow.com/questions/36555018/why-is-the-httpbody-of-a-request-inside-an-nsurlprotocol-subclass-always-nil\" target=\"_blank\" rel=\"noopener\">这个问题</a>以及<a href=\"https://bugs.webkit.org/show_bug.cgi?id=137299\" target=\"_blank\" rel=\"noopener\">这里的讨论</a>。</p>\n<p>网上有人提出了一种解决方案，就是不要使用HTTPBody，而使用HTTPBodyStream。具体实现如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">NSMutableURLRequest</span> * request = [[<span class=\"built_in\">NSMutableURLRequest</span> alloc] initWithURL:url];</span><br><span class=\"line\">request.allHTTPHeaderFields = <span class=\"keyword\">self</span>.request.allHTTPHeaderFields;</span><br><span class=\"line\"><span class=\"keyword\">if</span> ([<span class=\"keyword\">self</span>.request.HTTPMethod isEqualToString:<span class=\"string\">@\"POST\"</span>]) &#123;</span><br><span class=\"line\">    request.HTTPMethod = <span class=\"string\">@\"POST\"</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"keyword\">self</span>.request.HTTPBody) &#123;</span><br><span class=\"line\">        uint8_t d[<span class=\"number\">1024</span>] = &#123;<span class=\"number\">0</span>&#125;;</span><br><span class=\"line\">        <span class=\"built_in\">NSInputStream</span> *stream = <span class=\"keyword\">self</span>.request.HTTPBodyStream;</span><br><span class=\"line\">        <span class=\"built_in\">NSMutableData</span> *data = [[<span class=\"built_in\">NSMutableData</span> alloc] init];</span><br><span class=\"line\">        [stream open];</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">while</span> ([stream hasBytesAvailable]) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSInteger</span> len = [stream read:d maxLength:<span class=\"number\">1024</span>];</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (len &gt; <span class=\"number\">0</span> &amp;&amp; stream.streamError == <span class=\"literal\">nil</span>) &#123;</span><br><span class=\"line\">                [data appendBytes:(<span class=\"keyword\">void</span> *)d length:len];</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        request.HTTPBody = [data <span class=\"keyword\">copy</span>];</span><br><span class=\"line\">        [stream close];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        request.HTTPBody = <span class=\"keyword\">self</span>.request.HTTPBody;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>通过这个方法就可以获得HTTPBody的内容。</p>\n<h2 id=\"registerClass-方法只适用于sharedSession\"><a href=\"#registerClass-方法只适用于sharedSession\" class=\"headerlink\" title=\"+registerClass:方法只适用于sharedSession\"></a><code>+registerClass:</code>方法只适用于<code>sharedSession</code></h2><p>另外一个要注意的地方就是，只用在使用<code>[NSURLSession sharedSession]</code>时，注册NSURLProtocol才能使用<code>+registerClass:</code>方法，否则就需要使用<code>NSURLSessionConfiguration</code>来注册NSURLProtocol，代码如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">NSURLSessionConfiguration</span> *configuration = [<span class=\"built_in\">NSURLSessionConfiguration</span> defaultSessionConfiguration];</span><br><span class=\"line\">configuration.protocolClasses = @[[MySessionURLProtocol <span class=\"keyword\">class</span>]];</span><br><span class=\"line\"><span class=\"keyword\">self</span>.session = [<span class=\"built_in\">NSURLSession</span> sessionWithConfiguration:configuration];</span><br></pre></td></tr></table></figure>\n<p>因此，对于新版的AFNetworking，由于它使用的不是<code>sharedSession</code>，所以就不能简单的通过类方法<code>+registerClass:</code>来注册自定义NSURLProtocol，也必须通过<code>NSURLSessionConfiguration</code>来设置。代码如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">NSURLSessionConfiguration</span> *configuration = [<span class=\"built_in\">NSURLSessionConfiguration</span> defaultSessionConfiguration];</span><br><span class=\"line\">configuration.protocolClasses = @[[CustomUrlProtocol <span class=\"keyword\">class</span>]];</span><br><span class=\"line\">AFHTTPSessionManager *sessionManager = [[AFHTTPSessionManager alloc] initWithBaseURL:baseUrl sessionConfiguration:configuration];</span><br><span class=\"line\">[sessionManager GET:url parameters:params progress:^(<span class=\"built_in\">NSProgress</span> * _Nonnull downloadProgress) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// do somting</span></span><br><span class=\"line\">&#125; success:^(<span class=\"built_in\">NSURLSessionDataTask</span> * _Nonnull task, <span class=\"keyword\">id</span>  _Nullable responseObject) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// do somting</span></span><br><span class=\"line\">&#125; failure:^(<span class=\"built_in\">NSURLSessionDataTask</span> * _Nullable task, <span class=\"built_in\">NSError</span> * _Nonnull error) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// do somting</span></span><br><span class=\"line\">&#125;];</span><br></pre></td></tr></table></figure>\n<p>以上就是使用NSURLProtocol时要注意的两个问题，希望能对大家有所帮助。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>项目中使用到了NSURLProtocol，用于拦截所有发出的请求并做一些处理。具体用法可以参考<a href=\"http://nshipster.cn/nsurlprotocol/\" target=\"_blank\" rel=\"noopener\">这篇文章</a>，我还专门写了一个<a href=\"https://github.com/liujinlongxa/NSURLProtocolDemo\" target=\"_blank\" rel=\"noopener\">Demo</a>。最近在使用过程中遇到了一些问题，记录如下。</p>\n<h2 id=\"拦截到的POST请求的HTTPBody为空\"><a href=\"#拦截到的POST请求的HTTPBody为空\" class=\"headerlink\" title=\"拦截到的POST请求的HTTPBody为空\"></a>拦截到的POST请求的HTTPBody为空</h2><p>最近由于升级了AFNetworking，在使用NSURLProtocol过程中发现了一个问题，就是在拦截到POST请求后，HTTPBody是空的。以前使用旧版本的AFNetworking时是没有这问题的。分析了一下，新版的AFNetworking使用的是NSURLSession，旧版使用的是NSURLConnection，可能是由于这个原因导致的。网上查了一下，还真有这个问题，具体可以看<a href=\"http://stackoverflow.com/questions/36555018/why-is-the-httpbody-of-a-request-inside-an-nsurlprotocol-subclass-always-nil\" target=\"_blank\" rel=\"noopener\">这个问题</a>以及<a href=\"https://bugs.webkit.org/show_bug.cgi?id=137299\" target=\"_blank\" rel=\"noopener\">这里的讨论</a>。</p>\n<p>网上有人提出了一种解决方案，就是不要使用HTTPBody，而使用HTTPBodyStream。具体实现如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">NSMutableURLRequest</span> * request = [[<span class=\"built_in\">NSMutableURLRequest</span> alloc] initWithURL:url];</span><br><span class=\"line\">request.allHTTPHeaderFields = <span class=\"keyword\">self</span>.request.allHTTPHeaderFields;</span><br><span class=\"line\"><span class=\"keyword\">if</span> ([<span class=\"keyword\">self</span>.request.HTTPMethod isEqualToString:<span class=\"string\">@\"POST\"</span>]) &#123;</span><br><span class=\"line\">    request.HTTPMethod = <span class=\"string\">@\"POST\"</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"keyword\">self</span>.request.HTTPBody) &#123;</span><br><span class=\"line\">        uint8_t d[<span class=\"number\">1024</span>] = &#123;<span class=\"number\">0</span>&#125;;</span><br><span class=\"line\">        <span class=\"built_in\">NSInputStream</span> *stream = <span class=\"keyword\">self</span>.request.HTTPBodyStream;</span><br><span class=\"line\">        <span class=\"built_in\">NSMutableData</span> *data = [[<span class=\"built_in\">NSMutableData</span> alloc] init];</span><br><span class=\"line\">        [stream open];</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">while</span> ([stream hasBytesAvailable]) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSInteger</span> len = [stream read:d maxLength:<span class=\"number\">1024</span>];</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (len &gt; <span class=\"number\">0</span> &amp;&amp; stream.streamError == <span class=\"literal\">nil</span>) &#123;</span><br><span class=\"line\">                [data appendBytes:(<span class=\"keyword\">void</span> *)d length:len];</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        request.HTTPBody = [data <span class=\"keyword\">copy</span>];</span><br><span class=\"line\">        [stream close];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        request.HTTPBody = <span class=\"keyword\">self</span>.request.HTTPBody;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>通过这个方法就可以获得HTTPBody的内容。</p>\n<h2 id=\"registerClass-方法只适用于sharedSession\"><a href=\"#registerClass-方法只适用于sharedSession\" class=\"headerlink\" title=\"+registerClass:方法只适用于sharedSession\"></a><code>+registerClass:</code>方法只适用于<code>sharedSession</code></h2><p>另外一个要注意的地方就是，只用在使用<code>[NSURLSession sharedSession]</code>时，注册NSURLProtocol才能使用<code>+registerClass:</code>方法，否则就需要使用<code>NSURLSessionConfiguration</code>来注册NSURLProtocol，代码如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">NSURLSessionConfiguration</span> *configuration = [<span class=\"built_in\">NSURLSessionConfiguration</span> defaultSessionConfiguration];</span><br><span class=\"line\">configuration.protocolClasses = @[[MySessionURLProtocol <span class=\"keyword\">class</span>]];</span><br><span class=\"line\"><span class=\"keyword\">self</span>.session = [<span class=\"built_in\">NSURLSession</span> sessionWithConfiguration:configuration];</span><br></pre></td></tr></table></figure>\n<p>因此，对于新版的AFNetworking，由于它使用的不是<code>sharedSession</code>，所以就不能简单的通过类方法<code>+registerClass:</code>来注册自定义NSURLProtocol，也必须通过<code>NSURLSessionConfiguration</code>来设置。代码如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">NSURLSessionConfiguration</span> *configuration = [<span class=\"built_in\">NSURLSessionConfiguration</span> defaultSessionConfiguration];</span><br><span class=\"line\">configuration.protocolClasses = @[[CustomUrlProtocol <span class=\"keyword\">class</span>]];</span><br><span class=\"line\">AFHTTPSessionManager *sessionManager = [[AFHTTPSessionManager alloc] initWithBaseURL:baseUrl sessionConfiguration:configuration];</span><br><span class=\"line\">[sessionManager GET:url parameters:params progress:^(<span class=\"built_in\">NSProgress</span> * _Nonnull downloadProgress) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// do somting</span></span><br><span class=\"line\">&#125; success:^(<span class=\"built_in\">NSURLSessionDataTask</span> * _Nonnull task, <span class=\"keyword\">id</span>  _Nullable responseObject) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// do somting</span></span><br><span class=\"line\">&#125; failure:^(<span class=\"built_in\">NSURLSessionDataTask</span> * _Nullable task, <span class=\"built_in\">NSError</span> * _Nonnull error) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// do somting</span></span><br><span class=\"line\">&#125;];</span><br></pre></td></tr></table></figure>\n<p>以上就是使用NSURLProtocol时要注意的两个问题，希望能对大家有所帮助。</p>\n"},{"title":"iOS开发适配HTTPS总结","date":"2017-02-07T01:46:33.000Z","_content":"\n年前给公司的项目适配了HTTPS，本来年前就该写这篇博客的，一直拖到现在才写。\n\n本文的主要内容就是对整个适配过程做一个总结。网上有很多详细的教程，具体的适配过程本文就不再赘述了，这里主要总结一下我在适配过程中越到的问题以及一些经验。\n\n## 测试自建证书\n\n适配完成后可以使用自建证书进行测试，关于如何创建自建证书，网上有很多教程，可以自行百度。如果你使用的是AFNetworking框架，使用自建证书也非常简单，首先见证书(abc.cer)导入项目，然后加入代码如下：\n\n```objectivec\nself.sessionManager = [[AFURLSessionManager alloc] initWithSessionConfiguration:[NSURLSessionConfiguration defaultSessionConfiguration]];\n\nAFSecurityPolicy *securityPolicy = [AFSecurityPolicy policyWithPinningMode:AFSSLPinningModeCertificate];\nsecurityPolicy.allowInvalidCertificates = YES;\nsecurityPolicy.validatesDomainName = YES;\n\nNSString *path = [[NSBundle mainBundle] pathForResource:@\"abc.cer\" ofType:nil];\nNSData *certData = [NSData dataWithContentsOfFile:path];\nNSSet *set = [NSSet setWithObjects:certData, nil];\nif (certData) {\n    securityPolicy.pinnedCertificates = set;\n}\nself.sessionManager.securityPolicy = securityPolicy;\n```\n\n当然，正式环境还是需要使用CA机构颁发的证书，使用CA机构颁发的证书不需要导入证书，只需要加入以下代码即可：\n\n```objectivec\nself.sessionManager = [[AFURLSessionManager alloc] initWithSessionConfiguration:[NSURLSessionConfiguration defaultSessionConfiguration]];\n\nAFSecurityPolicy *policy = [AFSecurityPolicy policyWithPinningMode:AFSSLPinningModeNone];\nself.sessionManager.securityPolicy = securityPolicy;\n```\n\n## 配置NSExceptionDomains\n\n项目中一些不能使用HTTPS协议的请求，需要配置NSExceptionDomains。很多第三方服务的请求还没有支持HTTPS，这就需要我们把这些请求添加到NSExceptionDomains中。可以使用Charles抓包看有哪些第三方请求需要添加到NSExceptionDomains中。\n\n另外，为了防止域名劫持，项目中可能会直接使用IP进行请求，我再测试过程中发现，即使不添加NSExceptionDomains，直接使用IP也可以正常请求。\n\n对于WebView里的请求，可以NSAllowsArbitraryLoadsInWebContent字段来声明绕过ATS。\n\n对于多媒体播放请求（使用AVFoundation），可以使用NSAllowsArbitraryLoadsInMedia字段来声明绕过ATS。\n\n## 多环境配置\n\n一般公司服务器都会有多个环境（测试环境，正式环境等），证书一般只配置在正式环境上，这就要求我们在测试环境下需要关闭ATS。如果每次都手动修改Info.plist文件来关闭ATS，不但麻烦，也可能导致配置的信息丢失。一种比较好做法是创建多个Info.plist，根据不同的环境，自动切换使用不同的Info.plist。\n\n如下，创建多个Info.plist\n\n![2](http://oldblog.shicishuzhai.com/0c578284b3e0e8649ec145e1413f3d7a.png)\n\n然后在Build Setting中配置不同的环境使用不同的Info.plist\n\n![3](http://oldblog.shicishuzhai.com/190482fe4f86763e6184834be9cff0bf.png)\n\n这样做有一个不好的地方是如果修改了Info.plist文件，需要同时修改两个。但这也比每次切换环境修改Info.plist要好，因为毕竟修改Info.plist的情况还是比较少的。\n\n以上就是我在适配HTTPS过程中遇到的一些问题，希望对大家有所帮助。\n\n参考资料：\n\n[iOS开发适配HTTPS详细教程](http://www.2cto.com/kf/201611/570823.html)\n[关于iOS10中ATS的问题](https://onevcat.com/2016/06/ios-10-ats/)\n","source":"_posts/2017-02-07-iOS开发适配HTTPS总结.md","raw":"---\ntitle: iOS开发适配HTTPS总结\ncategories: iOS开发\ntags:\n  - HTTPS\ndate: 2017-02-07 09:46:33\n---\n\n年前给公司的项目适配了HTTPS，本来年前就该写这篇博客的，一直拖到现在才写。\n\n本文的主要内容就是对整个适配过程做一个总结。网上有很多详细的教程，具体的适配过程本文就不再赘述了，这里主要总结一下我在适配过程中越到的问题以及一些经验。\n\n## 测试自建证书\n\n适配完成后可以使用自建证书进行测试，关于如何创建自建证书，网上有很多教程，可以自行百度。如果你使用的是AFNetworking框架，使用自建证书也非常简单，首先见证书(abc.cer)导入项目，然后加入代码如下：\n\n```objectivec\nself.sessionManager = [[AFURLSessionManager alloc] initWithSessionConfiguration:[NSURLSessionConfiguration defaultSessionConfiguration]];\n\nAFSecurityPolicy *securityPolicy = [AFSecurityPolicy policyWithPinningMode:AFSSLPinningModeCertificate];\nsecurityPolicy.allowInvalidCertificates = YES;\nsecurityPolicy.validatesDomainName = YES;\n\nNSString *path = [[NSBundle mainBundle] pathForResource:@\"abc.cer\" ofType:nil];\nNSData *certData = [NSData dataWithContentsOfFile:path];\nNSSet *set = [NSSet setWithObjects:certData, nil];\nif (certData) {\n    securityPolicy.pinnedCertificates = set;\n}\nself.sessionManager.securityPolicy = securityPolicy;\n```\n\n当然，正式环境还是需要使用CA机构颁发的证书，使用CA机构颁发的证书不需要导入证书，只需要加入以下代码即可：\n\n```objectivec\nself.sessionManager = [[AFURLSessionManager alloc] initWithSessionConfiguration:[NSURLSessionConfiguration defaultSessionConfiguration]];\n\nAFSecurityPolicy *policy = [AFSecurityPolicy policyWithPinningMode:AFSSLPinningModeNone];\nself.sessionManager.securityPolicy = securityPolicy;\n```\n\n## 配置NSExceptionDomains\n\n项目中一些不能使用HTTPS协议的请求，需要配置NSExceptionDomains。很多第三方服务的请求还没有支持HTTPS，这就需要我们把这些请求添加到NSExceptionDomains中。可以使用Charles抓包看有哪些第三方请求需要添加到NSExceptionDomains中。\n\n另外，为了防止域名劫持，项目中可能会直接使用IP进行请求，我再测试过程中发现，即使不添加NSExceptionDomains，直接使用IP也可以正常请求。\n\n对于WebView里的请求，可以NSAllowsArbitraryLoadsInWebContent字段来声明绕过ATS。\n\n对于多媒体播放请求（使用AVFoundation），可以使用NSAllowsArbitraryLoadsInMedia字段来声明绕过ATS。\n\n## 多环境配置\n\n一般公司服务器都会有多个环境（测试环境，正式环境等），证书一般只配置在正式环境上，这就要求我们在测试环境下需要关闭ATS。如果每次都手动修改Info.plist文件来关闭ATS，不但麻烦，也可能导致配置的信息丢失。一种比较好做法是创建多个Info.plist，根据不同的环境，自动切换使用不同的Info.plist。\n\n如下，创建多个Info.plist\n\n![2](http://oldblog.shicishuzhai.com/0c578284b3e0e8649ec145e1413f3d7a.png)\n\n然后在Build Setting中配置不同的环境使用不同的Info.plist\n\n![3](http://oldblog.shicishuzhai.com/190482fe4f86763e6184834be9cff0bf.png)\n\n这样做有一个不好的地方是如果修改了Info.plist文件，需要同时修改两个。但这也比每次切换环境修改Info.plist要好，因为毕竟修改Info.plist的情况还是比较少的。\n\n以上就是我在适配HTTPS过程中遇到的一些问题，希望对大家有所帮助。\n\n参考资料：\n\n[iOS开发适配HTTPS详细教程](http://www.2cto.com/kf/201611/570823.html)\n[关于iOS10中ATS的问题](https://onevcat.com/2016/06/ios-10-ats/)\n","slug":"iOS开发适配HTTPS总结","published":1,"updated":"2019-01-13T04:00:21.974Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjutyfmg7003rc4c9hbmj0bnm","content":"<p>年前给公司的项目适配了HTTPS，本来年前就该写这篇博客的，一直拖到现在才写。</p>\n<p>本文的主要内容就是对整个适配过程做一个总结。网上有很多详细的教程，具体的适配过程本文就不再赘述了，这里主要总结一下我在适配过程中越到的问题以及一些经验。</p>\n<h2 id=\"测试自建证书\"><a href=\"#测试自建证书\" class=\"headerlink\" title=\"测试自建证书\"></a>测试自建证书</h2><p>适配完成后可以使用自建证书进行测试，关于如何创建自建证书，网上有很多教程，可以自行百度。如果你使用的是AFNetworking框架，使用自建证书也非常简单，首先见证书(abc.cer)导入项目，然后加入代码如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">self</span>.sessionManager = [[AFURLSessionManager alloc] initWithSessionConfiguration:[<span class=\"built_in\">NSURLSessionConfiguration</span> defaultSessionConfiguration]];</span><br><span class=\"line\"></span><br><span class=\"line\">AFSecurityPolicy *securityPolicy = [AFSecurityPolicy policyWithPinningMode:AFSSLPinningModeCertificate];</span><br><span class=\"line\">securityPolicy.allowInvalidCertificates = <span class=\"literal\">YES</span>;</span><br><span class=\"line\">securityPolicy.validatesDomainName = <span class=\"literal\">YES</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">NSString</span> *path = [[<span class=\"built_in\">NSBundle</span> mainBundle] pathForResource:<span class=\"string\">@\"abc.cer\"</span> ofType:<span class=\"literal\">nil</span>];</span><br><span class=\"line\"><span class=\"built_in\">NSData</span> *certData = [<span class=\"built_in\">NSData</span> dataWithContentsOfFile:path];</span><br><span class=\"line\"><span class=\"built_in\">NSSet</span> *set = [<span class=\"built_in\">NSSet</span> setWithObjects:certData, <span class=\"literal\">nil</span>];</span><br><span class=\"line\"><span class=\"keyword\">if</span> (certData) &#123;</span><br><span class=\"line\">    securityPolicy.pinnedCertificates = set;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">self</span>.sessionManager.securityPolicy = securityPolicy;</span><br></pre></td></tr></table></figure>\n<p>当然，正式环境还是需要使用CA机构颁发的证书，使用CA机构颁发的证书不需要导入证书，只需要加入以下代码即可：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">self</span>.sessionManager = [[AFURLSessionManager alloc] initWithSessionConfiguration:[<span class=\"built_in\">NSURLSessionConfiguration</span> defaultSessionConfiguration]];</span><br><span class=\"line\"></span><br><span class=\"line\">AFSecurityPolicy *policy = [AFSecurityPolicy policyWithPinningMode:AFSSLPinningModeNone];</span><br><span class=\"line\"><span class=\"keyword\">self</span>.sessionManager.securityPolicy = securityPolicy;</span><br></pre></td></tr></table></figure>\n<h2 id=\"配置NSExceptionDomains\"><a href=\"#配置NSExceptionDomains\" class=\"headerlink\" title=\"配置NSExceptionDomains\"></a>配置NSExceptionDomains</h2><p>项目中一些不能使用HTTPS协议的请求，需要配置NSExceptionDomains。很多第三方服务的请求还没有支持HTTPS，这就需要我们把这些请求添加到NSExceptionDomains中。可以使用Charles抓包看有哪些第三方请求需要添加到NSExceptionDomains中。</p>\n<p>另外，为了防止域名劫持，项目中可能会直接使用IP进行请求，我再测试过程中发现，即使不添加NSExceptionDomains，直接使用IP也可以正常请求。</p>\n<p>对于WebView里的请求，可以NSAllowsArbitraryLoadsInWebContent字段来声明绕过ATS。</p>\n<p>对于多媒体播放请求（使用AVFoundation），可以使用NSAllowsArbitraryLoadsInMedia字段来声明绕过ATS。</p>\n<h2 id=\"多环境配置\"><a href=\"#多环境配置\" class=\"headerlink\" title=\"多环境配置\"></a>多环境配置</h2><p>一般公司服务器都会有多个环境（测试环境，正式环境等），证书一般只配置在正式环境上，这就要求我们在测试环境下需要关闭ATS。如果每次都手动修改Info.plist文件来关闭ATS，不但麻烦，也可能导致配置的信息丢失。一种比较好做法是创建多个Info.plist，根据不同的环境，自动切换使用不同的Info.plist。</p>\n<p>如下，创建多个Info.plist</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/0c578284b3e0e8649ec145e1413f3d7a.png\" alt=\"2\"></p>\n<p>然后在Build Setting中配置不同的环境使用不同的Info.plist</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/190482fe4f86763e6184834be9cff0bf.png\" alt=\"3\"></p>\n<p>这样做有一个不好的地方是如果修改了Info.plist文件，需要同时修改两个。但这也比每次切换环境修改Info.plist要好，因为毕竟修改Info.plist的情况还是比较少的。</p>\n<p>以上就是我在适配HTTPS过程中遇到的一些问题，希望对大家有所帮助。</p>\n<p>参考资料：</p>\n<p><a href=\"http://www.2cto.com/kf/201611/570823.html\" target=\"_blank\" rel=\"noopener\">iOS开发适配HTTPS详细教程</a><br><a href=\"https://onevcat.com/2016/06/ios-10-ats/\" target=\"_blank\" rel=\"noopener\">关于iOS10中ATS的问题</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>年前给公司的项目适配了HTTPS，本来年前就该写这篇博客的，一直拖到现在才写。</p>\n<p>本文的主要内容就是对整个适配过程做一个总结。网上有很多详细的教程，具体的适配过程本文就不再赘述了，这里主要总结一下我在适配过程中越到的问题以及一些经验。</p>\n<h2 id=\"测试自建证书\"><a href=\"#测试自建证书\" class=\"headerlink\" title=\"测试自建证书\"></a>测试自建证书</h2><p>适配完成后可以使用自建证书进行测试，关于如何创建自建证书，网上有很多教程，可以自行百度。如果你使用的是AFNetworking框架，使用自建证书也非常简单，首先见证书(abc.cer)导入项目，然后加入代码如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">self</span>.sessionManager = [[AFURLSessionManager alloc] initWithSessionConfiguration:[<span class=\"built_in\">NSURLSessionConfiguration</span> defaultSessionConfiguration]];</span><br><span class=\"line\"></span><br><span class=\"line\">AFSecurityPolicy *securityPolicy = [AFSecurityPolicy policyWithPinningMode:AFSSLPinningModeCertificate];</span><br><span class=\"line\">securityPolicy.allowInvalidCertificates = <span class=\"literal\">YES</span>;</span><br><span class=\"line\">securityPolicy.validatesDomainName = <span class=\"literal\">YES</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">NSString</span> *path = [[<span class=\"built_in\">NSBundle</span> mainBundle] pathForResource:<span class=\"string\">@\"abc.cer\"</span> ofType:<span class=\"literal\">nil</span>];</span><br><span class=\"line\"><span class=\"built_in\">NSData</span> *certData = [<span class=\"built_in\">NSData</span> dataWithContentsOfFile:path];</span><br><span class=\"line\"><span class=\"built_in\">NSSet</span> *set = [<span class=\"built_in\">NSSet</span> setWithObjects:certData, <span class=\"literal\">nil</span>];</span><br><span class=\"line\"><span class=\"keyword\">if</span> (certData) &#123;</span><br><span class=\"line\">    securityPolicy.pinnedCertificates = set;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">self</span>.sessionManager.securityPolicy = securityPolicy;</span><br></pre></td></tr></table></figure>\n<p>当然，正式环境还是需要使用CA机构颁发的证书，使用CA机构颁发的证书不需要导入证书，只需要加入以下代码即可：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">self</span>.sessionManager = [[AFURLSessionManager alloc] initWithSessionConfiguration:[<span class=\"built_in\">NSURLSessionConfiguration</span> defaultSessionConfiguration]];</span><br><span class=\"line\"></span><br><span class=\"line\">AFSecurityPolicy *policy = [AFSecurityPolicy policyWithPinningMode:AFSSLPinningModeNone];</span><br><span class=\"line\"><span class=\"keyword\">self</span>.sessionManager.securityPolicy = securityPolicy;</span><br></pre></td></tr></table></figure>\n<h2 id=\"配置NSExceptionDomains\"><a href=\"#配置NSExceptionDomains\" class=\"headerlink\" title=\"配置NSExceptionDomains\"></a>配置NSExceptionDomains</h2><p>项目中一些不能使用HTTPS协议的请求，需要配置NSExceptionDomains。很多第三方服务的请求还没有支持HTTPS，这就需要我们把这些请求添加到NSExceptionDomains中。可以使用Charles抓包看有哪些第三方请求需要添加到NSExceptionDomains中。</p>\n<p>另外，为了防止域名劫持，项目中可能会直接使用IP进行请求，我再测试过程中发现，即使不添加NSExceptionDomains，直接使用IP也可以正常请求。</p>\n<p>对于WebView里的请求，可以NSAllowsArbitraryLoadsInWebContent字段来声明绕过ATS。</p>\n<p>对于多媒体播放请求（使用AVFoundation），可以使用NSAllowsArbitraryLoadsInMedia字段来声明绕过ATS。</p>\n<h2 id=\"多环境配置\"><a href=\"#多环境配置\" class=\"headerlink\" title=\"多环境配置\"></a>多环境配置</h2><p>一般公司服务器都会有多个环境（测试环境，正式环境等），证书一般只配置在正式环境上，这就要求我们在测试环境下需要关闭ATS。如果每次都手动修改Info.plist文件来关闭ATS，不但麻烦，也可能导致配置的信息丢失。一种比较好做法是创建多个Info.plist，根据不同的环境，自动切换使用不同的Info.plist。</p>\n<p>如下，创建多个Info.plist</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/0c578284b3e0e8649ec145e1413f3d7a.png\" alt=\"2\"></p>\n<p>然后在Build Setting中配置不同的环境使用不同的Info.plist</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/190482fe4f86763e6184834be9cff0bf.png\" alt=\"3\"></p>\n<p>这样做有一个不好的地方是如果修改了Info.plist文件，需要同时修改两个。但这也比每次切换环境修改Info.plist要好，因为毕竟修改Info.plist的情况还是比较少的。</p>\n<p>以上就是我在适配HTTPS过程中遇到的一些问题，希望对大家有所帮助。</p>\n<p>参考资料：</p>\n<p><a href=\"http://www.2cto.com/kf/201611/570823.html\" target=\"_blank\" rel=\"noopener\">iOS开发适配HTTPS详细教程</a><br><a href=\"https://onevcat.com/2016/06/ios-10-ats/\" target=\"_blank\" rel=\"noopener\">关于iOS10中ATS的问题</a></p>\n"},{"title":"深入理解git merge和git rebase","date":"2017-03-01T07:08:21.000Z","_content":"\n`git merge`和`git rebase`是我们平时在使用Git过程中用到比较多的两个命令。本文将主要介绍这个两个命令的基本用法以及使用中应该注意的事项。\n\n## git merge\n\n### 不同的合并方式\n\n顾名思义，`git merge`是用来将一个分支的代码合并到另一个分支。如下图，将develop分支上的代码合并到master分支上。\n\n![1](http://oldblog.shicishuzhai.com/dafea7a6a7e2ce161b7b941ad4474186.png)\n\n上图中有一个`Fast-forward`字样，这是Git的一种合并方式。\n\n![2](http://oldblog.shicishuzhai.com/31c51a26b1165b47797425e5d34a04a4.png)\n\n如上图，在master分支的B点时牵出一个develop分支，develop分支又有了3个新的提交1，2，3，而master分支此时没有新的提交，这是如果合并的话，develop分支不用动，master只用把分支的头指针指向develop的最新的一个提交3即可。合并后的结果如下图：\n\n![3](http://oldblog.shicishuzhai.com/44379a35e3a385da59d1d996efd017bb.png)\n\n这个合并方式看似把两个分支合并了，实际上并没有真正进行合并操作，也没有留下合并的操作。默认`git merge`是采用`Fast-forward`方式进行合并的，如果不想采用这种方式，可以在命令后面加入`--no-ff`选项，如下：\n\n![4](http://oldblog.shicishuzhai.com/161174b53c54146aa465eacf41140787.png)\n\n不使用`Fast-forward`的方式进行合并，Git会为合并生成一个新的提交，合并后的结果如下图：\n\n![5](http://oldblog.shicishuzhai.com/091081cb40b5eedbc5dc4ab2c8e4e13e.png)\n\nCommit C即是Git自动生成的合并提交。一般情况下我们在合并代码时都会加上`--no-ff`，这样可以更清晰的看见合并操作。\n\n### 一个不大不小的坑\n\n如下图：\n\n![6](http://oldblog.shicishuzhai.com/e92aed55a7593922b525c2723894b202.png)\n\n 在牵出develop分支后，master分支又有了新的提交C，这时候如果把develop分支合并到master，就不能简单的通过移动master分支头指针来进行了，这时候默认执行的是**recursive**(递归)的策略进行合并的，这种策略下，Git会对两个分支的头结点（C与3）以及他们的共同父节点（B）进行三路合并，这种情况下就可能出现代码冲突。\n\n 而且Git在合并两个分支时，并不会根据Commit的提交时间来判断哪个分支的代码更新，这就可能造成一个隐藏的问题：\n\n 想象一下这种场景，一个团队内分为两个小组分别开发A和B两个功能版本，A版本的开发人员修改了某个文件（假定是file1），B版本的的开发人员发现他也要对file1做同样的修改才能继续开发，于是他对file1做了同样的修改（或者使用cherry-pick把A版本的相应的commit拉过来）。过了一段时间，A版本的开发人员发现他以前对file1的修改有问题，于是又把file1改了回去，而这时候B版本的开发人员并没有做同样的修改。这样，将来A版本和B版本合并到主干分支后，B版本的代码就会覆盖A的修改，于是错误的代码又被合并到了主干分支上。下面就是这个过程的示意图：\n\n![7](http://oldblog.shicishuzhai.com/51b92d9f3934ffa53a1f2c9770a9895f.png)\n\n如图，序号1，2，3表示的是Commit的提交顺序，FeatureA分支在commit 2上把文件内容改为了`bbb111`, FeatureB分支把文件内容改为了`bbb222`，在commit 6上FeatureA有吧内容改回了`AAA`，而B分支没有做同样的修改，当把FeatureA合并到主干时，由于FeatureA相对于共通父节点Commit 1来说没有变化，因此就会使用FeatureB的内容作为最终的内容，而且这种情况下不会报任何冲突。这就极有可能造成错误的代码又被合并到了主干分支上，而且这种问题极难被察觉，就好像莫名其妙的发现代码丢失了一样。\n\n要避免这种情况的发生，只能从流程上来规范git的操作。如果一个修改要应用到多个分支上，应该单独为这个修改建立一个临时分支，修改完成后，每一个需要用到这个修改的分支都合并这个临时分支。将来如果这个临时分支又有了新的提交，依然是每个分支都要合并。这样就可以避免出现上面的情况。\n\n未完待续。\n","source":"_posts/2017-03-01-深入理解git-merge和git-rebase.md","raw":"---\ntitle: 深入理解git merge和git rebase\ncategories: Git\ntags:\n  - Git\ndate: 2017-03-01 15:08:21\n---\n\n`git merge`和`git rebase`是我们平时在使用Git过程中用到比较多的两个命令。本文将主要介绍这个两个命令的基本用法以及使用中应该注意的事项。\n\n## git merge\n\n### 不同的合并方式\n\n顾名思义，`git merge`是用来将一个分支的代码合并到另一个分支。如下图，将develop分支上的代码合并到master分支上。\n\n![1](http://oldblog.shicishuzhai.com/dafea7a6a7e2ce161b7b941ad4474186.png)\n\n上图中有一个`Fast-forward`字样，这是Git的一种合并方式。\n\n![2](http://oldblog.shicishuzhai.com/31c51a26b1165b47797425e5d34a04a4.png)\n\n如上图，在master分支的B点时牵出一个develop分支，develop分支又有了3个新的提交1，2，3，而master分支此时没有新的提交，这是如果合并的话，develop分支不用动，master只用把分支的头指针指向develop的最新的一个提交3即可。合并后的结果如下图：\n\n![3](http://oldblog.shicishuzhai.com/44379a35e3a385da59d1d996efd017bb.png)\n\n这个合并方式看似把两个分支合并了，实际上并没有真正进行合并操作，也没有留下合并的操作。默认`git merge`是采用`Fast-forward`方式进行合并的，如果不想采用这种方式，可以在命令后面加入`--no-ff`选项，如下：\n\n![4](http://oldblog.shicishuzhai.com/161174b53c54146aa465eacf41140787.png)\n\n不使用`Fast-forward`的方式进行合并，Git会为合并生成一个新的提交，合并后的结果如下图：\n\n![5](http://oldblog.shicishuzhai.com/091081cb40b5eedbc5dc4ab2c8e4e13e.png)\n\nCommit C即是Git自动生成的合并提交。一般情况下我们在合并代码时都会加上`--no-ff`，这样可以更清晰的看见合并操作。\n\n### 一个不大不小的坑\n\n如下图：\n\n![6](http://oldblog.shicishuzhai.com/e92aed55a7593922b525c2723894b202.png)\n\n 在牵出develop分支后，master分支又有了新的提交C，这时候如果把develop分支合并到master，就不能简单的通过移动master分支头指针来进行了，这时候默认执行的是**recursive**(递归)的策略进行合并的，这种策略下，Git会对两个分支的头结点（C与3）以及他们的共同父节点（B）进行三路合并，这种情况下就可能出现代码冲突。\n\n 而且Git在合并两个分支时，并不会根据Commit的提交时间来判断哪个分支的代码更新，这就可能造成一个隐藏的问题：\n\n 想象一下这种场景，一个团队内分为两个小组分别开发A和B两个功能版本，A版本的开发人员修改了某个文件（假定是file1），B版本的的开发人员发现他也要对file1做同样的修改才能继续开发，于是他对file1做了同样的修改（或者使用cherry-pick把A版本的相应的commit拉过来）。过了一段时间，A版本的开发人员发现他以前对file1的修改有问题，于是又把file1改了回去，而这时候B版本的开发人员并没有做同样的修改。这样，将来A版本和B版本合并到主干分支后，B版本的代码就会覆盖A的修改，于是错误的代码又被合并到了主干分支上。下面就是这个过程的示意图：\n\n![7](http://oldblog.shicishuzhai.com/51b92d9f3934ffa53a1f2c9770a9895f.png)\n\n如图，序号1，2，3表示的是Commit的提交顺序，FeatureA分支在commit 2上把文件内容改为了`bbb111`, FeatureB分支把文件内容改为了`bbb222`，在commit 6上FeatureA有吧内容改回了`AAA`，而B分支没有做同样的修改，当把FeatureA合并到主干时，由于FeatureA相对于共通父节点Commit 1来说没有变化，因此就会使用FeatureB的内容作为最终的内容，而且这种情况下不会报任何冲突。这就极有可能造成错误的代码又被合并到了主干分支上，而且这种问题极难被察觉，就好像莫名其妙的发现代码丢失了一样。\n\n要避免这种情况的发生，只能从流程上来规范git的操作。如果一个修改要应用到多个分支上，应该单独为这个修改建立一个临时分支，修改完成后，每一个需要用到这个修改的分支都合并这个临时分支。将来如果这个临时分支又有了新的提交，依然是每个分支都要合并。这样就可以避免出现上面的情况。\n\n未完待续。\n","slug":"深入理解git-merge和git-rebase","published":1,"updated":"2019-01-13T04:01:04.507Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjutyfmg8003uc4c9v1hijmxs","content":"<p><code>git merge</code>和<code>git rebase</code>是我们平时在使用Git过程中用到比较多的两个命令。本文将主要介绍这个两个命令的基本用法以及使用中应该注意的事项。</p>\n<h2 id=\"git-merge\"><a href=\"#git-merge\" class=\"headerlink\" title=\"git merge\"></a>git merge</h2><h3 id=\"不同的合并方式\"><a href=\"#不同的合并方式\" class=\"headerlink\" title=\"不同的合并方式\"></a>不同的合并方式</h3><p>顾名思义，<code>git merge</code>是用来将一个分支的代码合并到另一个分支。如下图，将develop分支上的代码合并到master分支上。</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/dafea7a6a7e2ce161b7b941ad4474186.png\" alt=\"1\"></p>\n<p>上图中有一个<code>Fast-forward</code>字样，这是Git的一种合并方式。</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/31c51a26b1165b47797425e5d34a04a4.png\" alt=\"2\"></p>\n<p>如上图，在master分支的B点时牵出一个develop分支，develop分支又有了3个新的提交1，2，3，而master分支此时没有新的提交，这是如果合并的话，develop分支不用动，master只用把分支的头指针指向develop的最新的一个提交3即可。合并后的结果如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/44379a35e3a385da59d1d996efd017bb.png\" alt=\"3\"></p>\n<p>这个合并方式看似把两个分支合并了，实际上并没有真正进行合并操作，也没有留下合并的操作。默认<code>git merge</code>是采用<code>Fast-forward</code>方式进行合并的，如果不想采用这种方式，可以在命令后面加入<code>--no-ff</code>选项，如下：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/161174b53c54146aa465eacf41140787.png\" alt=\"4\"></p>\n<p>不使用<code>Fast-forward</code>的方式进行合并，Git会为合并生成一个新的提交，合并后的结果如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/091081cb40b5eedbc5dc4ab2c8e4e13e.png\" alt=\"5\"></p>\n<p>Commit C即是Git自动生成的合并提交。一般情况下我们在合并代码时都会加上<code>--no-ff</code>，这样可以更清晰的看见合并操作。</p>\n<h3 id=\"一个不大不小的坑\"><a href=\"#一个不大不小的坑\" class=\"headerlink\" title=\"一个不大不小的坑\"></a>一个不大不小的坑</h3><p>如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/e92aed55a7593922b525c2723894b202.png\" alt=\"6\"></p>\n<p> 在牵出develop分支后，master分支又有了新的提交C，这时候如果把develop分支合并到master，就不能简单的通过移动master分支头指针来进行了，这时候默认执行的是<strong>recursive</strong>(递归)的策略进行合并的，这种策略下，Git会对两个分支的头结点（C与3）以及他们的共同父节点（B）进行三路合并，这种情况下就可能出现代码冲突。</p>\n<p> 而且Git在合并两个分支时，并不会根据Commit的提交时间来判断哪个分支的代码更新，这就可能造成一个隐藏的问题：</p>\n<p> 想象一下这种场景，一个团队内分为两个小组分别开发A和B两个功能版本，A版本的开发人员修改了某个文件（假定是file1），B版本的的开发人员发现他也要对file1做同样的修改才能继续开发，于是他对file1做了同样的修改（或者使用cherry-pick把A版本的相应的commit拉过来）。过了一段时间，A版本的开发人员发现他以前对file1的修改有问题，于是又把file1改了回去，而这时候B版本的开发人员并没有做同样的修改。这样，将来A版本和B版本合并到主干分支后，B版本的代码就会覆盖A的修改，于是错误的代码又被合并到了主干分支上。下面就是这个过程的示意图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/51b92d9f3934ffa53a1f2c9770a9895f.png\" alt=\"7\"></p>\n<p>如图，序号1，2，3表示的是Commit的提交顺序，FeatureA分支在commit 2上把文件内容改为了<code>bbb111</code>, FeatureB分支把文件内容改为了<code>bbb222</code>，在commit 6上FeatureA有吧内容改回了<code>AAA</code>，而B分支没有做同样的修改，当把FeatureA合并到主干时，由于FeatureA相对于共通父节点Commit 1来说没有变化，因此就会使用FeatureB的内容作为最终的内容，而且这种情况下不会报任何冲突。这就极有可能造成错误的代码又被合并到了主干分支上，而且这种问题极难被察觉，就好像莫名其妙的发现代码丢失了一样。</p>\n<p>要避免这种情况的发生，只能从流程上来规范git的操作。如果一个修改要应用到多个分支上，应该单独为这个修改建立一个临时分支，修改完成后，每一个需要用到这个修改的分支都合并这个临时分支。将来如果这个临时分支又有了新的提交，依然是每个分支都要合并。这样就可以避免出现上面的情况。</p>\n<p>未完待续。</p>\n","site":{"data":{}},"excerpt":"","more":"<p><code>git merge</code>和<code>git rebase</code>是我们平时在使用Git过程中用到比较多的两个命令。本文将主要介绍这个两个命令的基本用法以及使用中应该注意的事项。</p>\n<h2 id=\"git-merge\"><a href=\"#git-merge\" class=\"headerlink\" title=\"git merge\"></a>git merge</h2><h3 id=\"不同的合并方式\"><a href=\"#不同的合并方式\" class=\"headerlink\" title=\"不同的合并方式\"></a>不同的合并方式</h3><p>顾名思义，<code>git merge</code>是用来将一个分支的代码合并到另一个分支。如下图，将develop分支上的代码合并到master分支上。</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/dafea7a6a7e2ce161b7b941ad4474186.png\" alt=\"1\"></p>\n<p>上图中有一个<code>Fast-forward</code>字样，这是Git的一种合并方式。</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/31c51a26b1165b47797425e5d34a04a4.png\" alt=\"2\"></p>\n<p>如上图，在master分支的B点时牵出一个develop分支，develop分支又有了3个新的提交1，2，3，而master分支此时没有新的提交，这是如果合并的话，develop分支不用动，master只用把分支的头指针指向develop的最新的一个提交3即可。合并后的结果如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/44379a35e3a385da59d1d996efd017bb.png\" alt=\"3\"></p>\n<p>这个合并方式看似把两个分支合并了，实际上并没有真正进行合并操作，也没有留下合并的操作。默认<code>git merge</code>是采用<code>Fast-forward</code>方式进行合并的，如果不想采用这种方式，可以在命令后面加入<code>--no-ff</code>选项，如下：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/161174b53c54146aa465eacf41140787.png\" alt=\"4\"></p>\n<p>不使用<code>Fast-forward</code>的方式进行合并，Git会为合并生成一个新的提交，合并后的结果如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/091081cb40b5eedbc5dc4ab2c8e4e13e.png\" alt=\"5\"></p>\n<p>Commit C即是Git自动生成的合并提交。一般情况下我们在合并代码时都会加上<code>--no-ff</code>，这样可以更清晰的看见合并操作。</p>\n<h3 id=\"一个不大不小的坑\"><a href=\"#一个不大不小的坑\" class=\"headerlink\" title=\"一个不大不小的坑\"></a>一个不大不小的坑</h3><p>如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/e92aed55a7593922b525c2723894b202.png\" alt=\"6\"></p>\n<p> 在牵出develop分支后，master分支又有了新的提交C，这时候如果把develop分支合并到master，就不能简单的通过移动master分支头指针来进行了，这时候默认执行的是<strong>recursive</strong>(递归)的策略进行合并的，这种策略下，Git会对两个分支的头结点（C与3）以及他们的共同父节点（B）进行三路合并，这种情况下就可能出现代码冲突。</p>\n<p> 而且Git在合并两个分支时，并不会根据Commit的提交时间来判断哪个分支的代码更新，这就可能造成一个隐藏的问题：</p>\n<p> 想象一下这种场景，一个团队内分为两个小组分别开发A和B两个功能版本，A版本的开发人员修改了某个文件（假定是file1），B版本的的开发人员发现他也要对file1做同样的修改才能继续开发，于是他对file1做了同样的修改（或者使用cherry-pick把A版本的相应的commit拉过来）。过了一段时间，A版本的开发人员发现他以前对file1的修改有问题，于是又把file1改了回去，而这时候B版本的开发人员并没有做同样的修改。这样，将来A版本和B版本合并到主干分支后，B版本的代码就会覆盖A的修改，于是错误的代码又被合并到了主干分支上。下面就是这个过程的示意图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/51b92d9f3934ffa53a1f2c9770a9895f.png\" alt=\"7\"></p>\n<p>如图，序号1，2，3表示的是Commit的提交顺序，FeatureA分支在commit 2上把文件内容改为了<code>bbb111</code>, FeatureB分支把文件内容改为了<code>bbb222</code>，在commit 6上FeatureA有吧内容改回了<code>AAA</code>，而B分支没有做同样的修改，当把FeatureA合并到主干时，由于FeatureA相对于共通父节点Commit 1来说没有变化，因此就会使用FeatureB的内容作为最终的内容，而且这种情况下不会报任何冲突。这就极有可能造成错误的代码又被合并到了主干分支上，而且这种问题极难被察觉，就好像莫名其妙的发现代码丢失了一样。</p>\n<p>要避免这种情况的发生，只能从流程上来规范git的操作。如果一个修改要应用到多个分支上，应该单独为这个修改建立一个临时分支，修改完成后，每一个需要用到这个修改的分支都合并这个临时分支。将来如果这个临时分支又有了新的提交，依然是每个分支都要合并。这样就可以避免出现上面的情况。</p>\n<p>未完待续。</p>\n"},{"title":"深入理解git merge和git rebase（续）","date":"2017-03-06T01:34:43.000Z","_content":"\n本文接上一篇，主要讲解一下git rebase的用法和使用中注意的事项。\n\n## git rebase\n\n### 基本原理\n\ngit rebase，也叫做变基，也是Git种一种合并代码的手段，与git merge不同的是，rebase是直接将一个分支从他们的共同父节点开始后的所有Commit依次合并到另外一个分支上。如下图：\n\n![1](http://oldblog.shicishuzhai.com/e3bdbc7fff28676ccefdcb16f4d43095.png)\n\n两个分支develop和master，如果通过命令`git merge`将develop分支合并到master分支，Git会将‘C’，‘3’以及两个分支的共同父节点‘B’进行三路合并，合并完成后生成一个新节点，如下图：\n\n![2](http://oldblog.shicishuzhai.com/ce919bb1921ee5c302baafbb0f45785f.png)\n\n如果`git rebase`将develop分支变基到master分支上，Git会将develop分支上的所有commit(1,2,3)依次合并到master，每一次合并都会生成一个新的提交(如下图1',2',3')，合并完成后，如下图：\n\n![3](http://oldblog.shicishuzhai.com/0478f567c5748186a200cd4da8b5ddd8.png)\n\n可以明显的看到，使用`git rebase`，分支线依然保持为一条，分支线看起来也没有那么乱，这也是`git rebase`相对于`git merge`的一个优点，但是另一方面，`git rebase`在合并每一个提交并生成一个新的提交时，会改写原来提交的提交时间（不会改写提交人），而且`git rebase`也没有留下合并的痕迹，可追溯性没那么强。\n\n### 为什么那么多冲突\n\n在使用`git rebase`的过程中经常会遇到这种情况，在执行的`git rebase`操作后，遇到了一个冲突，修改冲突后执行`git rebase --continue`，然后又来一个冲突，冲突一个接一个，而且有时候同一个冲突会出现好几次。\n\n其实，这是由rebase的原理造成的，Git在合并每一个Commit时都会判断是否有冲突，如下图：\n\n![4](http://oldblog.shicishuzhai.com/90ff7dd4f79dddc65656820254dba48b.png)\n\n两个分支develop和master以及他们各自的文件内容，现在要将develop变基到master上，Git会先将develop的第一个commit和master分支的最新提交合并，合并后如下：\n\n![5](http://oldblog.shicishuzhai.com/31c92a8c54e271fb69053a22c984c6dd.png)\n\n会报一个冲突，解决完冲突后，执行`git rebase --continue`，根据冲突不同的解决方案，可能会与不同的结果，如下图：\n\n![6](http://oldblog.shicishuzhai.com/74efc09f8e231d078914a36f5223e289.png)\n\n上图中的两种冲突解决方案，在执行`git rebase --continue`后，依然再会报一个冲突，应为在合并develop的第二个提交时，依然有冲突。下面的解决方案则不会造成再次冲突，因为这种解决方案是完全用develop分支覆盖了master分支，如下图：\n\n![7](http://oldblog.shicishuzhai.com/510fa8570fd012eb1723d6c521eb5cc6.png)\n\n以上就是造成`git rebase`冲突太多的具体原因。\n\n### 有那么点用的rerere\n\n冲突太多怎么办，Git提供了一个辅助工具`git rerere`命令，具体用法可以参考[git rerere](https://git-scm.com/book/zh/v2/Git-%E5%B7%A5%E5%85%B7-Rerere)。rerere命令能够记住解决一个冲突的方法，这样在下一次看到相同冲突时，Git 可以为你自动地解决它。\n\n那么rerere能够避免`git rebase`带来的冲突吗，答案是否定的。因为rerere在判断两个冲突是否为相同冲突是根据冲突体的两部分是否完全一样来进行的，就上面的例子而言，不管是哪种冲突解决方案，第一次和第二次冲突的冲突体都不完全一样，因此rerere都不会自动帮我们修复。\n\n![8](http://oldblog.shicishuzhai.com/b80ef2ec61407d7a737a0997da6c960d.png)\n\n而且，rerere命令也会记住错误的冲突解决方案，下次遇到相同的冲突时会直接应用错误的方案。不过你可以使用`git rerere forget <pathspec>`命令来删除Git记住的冲突解决方案。\n\n说了这么多，那rerere命令到底有什么用呢？\n\n`git rerere`命令为我们提供了一种减少冲突的方案：当你要保证一个长期分支会干净地合并，但是又不想要一串中间的合并提交。 将rerere功能打开后偶尔合并，解决冲突，然后返回到合并前。 如果你持续这样做，那么最终的合并会很容易，因为rerere可以为你自动做所有的事情。`git rerere`也可以将冲突的解决方案共享给项目组的其他成员。\n\n所以说rerere命令还有一点用的，不过他并不能彻底解决冲突多的问题，减少冲突还是需要我们在平时使用时规范git的使用方法，使用统一的git工作流。\n\n## 后记\n\n本来打算写一篇的，但是因为太长了，所以分为两篇来写。由于写的比较仓促，文中如果有什么纰漏，欢迎指出。\n\n参考资料：\n[Pro Git](https://git-scm.com/book/zh/v2)\n[Why do I have to resolve the same conflict over and over?](http://stackoverflow.com/questions/13825079/why-do-i-have-to-resolve-the-same-conflict-over-and-over)\n","source":"_posts/2017-03-06-深入理解git-merge和git-rebase（续）.md","raw":"---\ntitle: 深入理解git merge和git rebase（续）\ncategories: Git\ntags:\n  - Git\ndate: 2017-03-06 09:34:43\n---\n\n本文接上一篇，主要讲解一下git rebase的用法和使用中注意的事项。\n\n## git rebase\n\n### 基本原理\n\ngit rebase，也叫做变基，也是Git种一种合并代码的手段，与git merge不同的是，rebase是直接将一个分支从他们的共同父节点开始后的所有Commit依次合并到另外一个分支上。如下图：\n\n![1](http://oldblog.shicishuzhai.com/e3bdbc7fff28676ccefdcb16f4d43095.png)\n\n两个分支develop和master，如果通过命令`git merge`将develop分支合并到master分支，Git会将‘C’，‘3’以及两个分支的共同父节点‘B’进行三路合并，合并完成后生成一个新节点，如下图：\n\n![2](http://oldblog.shicishuzhai.com/ce919bb1921ee5c302baafbb0f45785f.png)\n\n如果`git rebase`将develop分支变基到master分支上，Git会将develop分支上的所有commit(1,2,3)依次合并到master，每一次合并都会生成一个新的提交(如下图1',2',3')，合并完成后，如下图：\n\n![3](http://oldblog.shicishuzhai.com/0478f567c5748186a200cd4da8b5ddd8.png)\n\n可以明显的看到，使用`git rebase`，分支线依然保持为一条，分支线看起来也没有那么乱，这也是`git rebase`相对于`git merge`的一个优点，但是另一方面，`git rebase`在合并每一个提交并生成一个新的提交时，会改写原来提交的提交时间（不会改写提交人），而且`git rebase`也没有留下合并的痕迹，可追溯性没那么强。\n\n### 为什么那么多冲突\n\n在使用`git rebase`的过程中经常会遇到这种情况，在执行的`git rebase`操作后，遇到了一个冲突，修改冲突后执行`git rebase --continue`，然后又来一个冲突，冲突一个接一个，而且有时候同一个冲突会出现好几次。\n\n其实，这是由rebase的原理造成的，Git在合并每一个Commit时都会判断是否有冲突，如下图：\n\n![4](http://oldblog.shicishuzhai.com/90ff7dd4f79dddc65656820254dba48b.png)\n\n两个分支develop和master以及他们各自的文件内容，现在要将develop变基到master上，Git会先将develop的第一个commit和master分支的最新提交合并，合并后如下：\n\n![5](http://oldblog.shicishuzhai.com/31c92a8c54e271fb69053a22c984c6dd.png)\n\n会报一个冲突，解决完冲突后，执行`git rebase --continue`，根据冲突不同的解决方案，可能会与不同的结果，如下图：\n\n![6](http://oldblog.shicishuzhai.com/74efc09f8e231d078914a36f5223e289.png)\n\n上图中的两种冲突解决方案，在执行`git rebase --continue`后，依然再会报一个冲突，应为在合并develop的第二个提交时，依然有冲突。下面的解决方案则不会造成再次冲突，因为这种解决方案是完全用develop分支覆盖了master分支，如下图：\n\n![7](http://oldblog.shicishuzhai.com/510fa8570fd012eb1723d6c521eb5cc6.png)\n\n以上就是造成`git rebase`冲突太多的具体原因。\n\n### 有那么点用的rerere\n\n冲突太多怎么办，Git提供了一个辅助工具`git rerere`命令，具体用法可以参考[git rerere](https://git-scm.com/book/zh/v2/Git-%E5%B7%A5%E5%85%B7-Rerere)。rerere命令能够记住解决一个冲突的方法，这样在下一次看到相同冲突时，Git 可以为你自动地解决它。\n\n那么rerere能够避免`git rebase`带来的冲突吗，答案是否定的。因为rerere在判断两个冲突是否为相同冲突是根据冲突体的两部分是否完全一样来进行的，就上面的例子而言，不管是哪种冲突解决方案，第一次和第二次冲突的冲突体都不完全一样，因此rerere都不会自动帮我们修复。\n\n![8](http://oldblog.shicishuzhai.com/b80ef2ec61407d7a737a0997da6c960d.png)\n\n而且，rerere命令也会记住错误的冲突解决方案，下次遇到相同的冲突时会直接应用错误的方案。不过你可以使用`git rerere forget <pathspec>`命令来删除Git记住的冲突解决方案。\n\n说了这么多，那rerere命令到底有什么用呢？\n\n`git rerere`命令为我们提供了一种减少冲突的方案：当你要保证一个长期分支会干净地合并，但是又不想要一串中间的合并提交。 将rerere功能打开后偶尔合并，解决冲突，然后返回到合并前。 如果你持续这样做，那么最终的合并会很容易，因为rerere可以为你自动做所有的事情。`git rerere`也可以将冲突的解决方案共享给项目组的其他成员。\n\n所以说rerere命令还有一点用的，不过他并不能彻底解决冲突多的问题，减少冲突还是需要我们在平时使用时规范git的使用方法，使用统一的git工作流。\n\n## 后记\n\n本来打算写一篇的，但是因为太长了，所以分为两篇来写。由于写的比较仓促，文中如果有什么纰漏，欢迎指出。\n\n参考资料：\n[Pro Git](https://git-scm.com/book/zh/v2)\n[Why do I have to resolve the same conflict over and over?](http://stackoverflow.com/questions/13825079/why-do-i-have-to-resolve-the-same-conflict-over-and-over)\n","slug":"深入理解git-merge和git-rebase（续）","published":1,"updated":"2019-01-13T04:01:04.455Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjutyfmg9003xc4c9i5hl92nc","content":"<p>本文接上一篇，主要讲解一下git rebase的用法和使用中注意的事项。</p>\n<h2 id=\"git-rebase\"><a href=\"#git-rebase\" class=\"headerlink\" title=\"git rebase\"></a>git rebase</h2><h3 id=\"基本原理\"><a href=\"#基本原理\" class=\"headerlink\" title=\"基本原理\"></a>基本原理</h3><p>git rebase，也叫做变基，也是Git种一种合并代码的手段，与git merge不同的是，rebase是直接将一个分支从他们的共同父节点开始后的所有Commit依次合并到另外一个分支上。如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/e3bdbc7fff28676ccefdcb16f4d43095.png\" alt=\"1\"></p>\n<p>两个分支develop和master，如果通过命令<code>git merge</code>将develop分支合并到master分支，Git会将‘C’，‘3’以及两个分支的共同父节点‘B’进行三路合并，合并完成后生成一个新节点，如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/ce919bb1921ee5c302baafbb0f45785f.png\" alt=\"2\"></p>\n<p>如果<code>git rebase</code>将develop分支变基到master分支上，Git会将develop分支上的所有commit(1,2,3)依次合并到master，每一次合并都会生成一个新的提交(如下图1’,2’,3’)，合并完成后，如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/0478f567c5748186a200cd4da8b5ddd8.png\" alt=\"3\"></p>\n<p>可以明显的看到，使用<code>git rebase</code>，分支线依然保持为一条，分支线看起来也没有那么乱，这也是<code>git rebase</code>相对于<code>git merge</code>的一个优点，但是另一方面，<code>git rebase</code>在合并每一个提交并生成一个新的提交时，会改写原来提交的提交时间（不会改写提交人），而且<code>git rebase</code>也没有留下合并的痕迹，可追溯性没那么强。</p>\n<h3 id=\"为什么那么多冲突\"><a href=\"#为什么那么多冲突\" class=\"headerlink\" title=\"为什么那么多冲突\"></a>为什么那么多冲突</h3><p>在使用<code>git rebase</code>的过程中经常会遇到这种情况，在执行的<code>git rebase</code>操作后，遇到了一个冲突，修改冲突后执行<code>git rebase --continue</code>，然后又来一个冲突，冲突一个接一个，而且有时候同一个冲突会出现好几次。</p>\n<p>其实，这是由rebase的原理造成的，Git在合并每一个Commit时都会判断是否有冲突，如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/90ff7dd4f79dddc65656820254dba48b.png\" alt=\"4\"></p>\n<p>两个分支develop和master以及他们各自的文件内容，现在要将develop变基到master上，Git会先将develop的第一个commit和master分支的最新提交合并，合并后如下：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/31c92a8c54e271fb69053a22c984c6dd.png\" alt=\"5\"></p>\n<p>会报一个冲突，解决完冲突后，执行<code>git rebase --continue</code>，根据冲突不同的解决方案，可能会与不同的结果，如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/74efc09f8e231d078914a36f5223e289.png\" alt=\"6\"></p>\n<p>上图中的两种冲突解决方案，在执行<code>git rebase --continue</code>后，依然再会报一个冲突，应为在合并develop的第二个提交时，依然有冲突。下面的解决方案则不会造成再次冲突，因为这种解决方案是完全用develop分支覆盖了master分支，如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/510fa8570fd012eb1723d6c521eb5cc6.png\" alt=\"7\"></p>\n<p>以上就是造成<code>git rebase</code>冲突太多的具体原因。</p>\n<h3 id=\"有那么点用的rerere\"><a href=\"#有那么点用的rerere\" class=\"headerlink\" title=\"有那么点用的rerere\"></a>有那么点用的rerere</h3><p>冲突太多怎么办，Git提供了一个辅助工具<code>git rerere</code>命令，具体用法可以参考<a href=\"https://git-scm.com/book/zh/v2/Git-%E5%B7%A5%E5%85%B7-Rerere\" target=\"_blank\" rel=\"noopener\">git rerere</a>。rerere命令能够记住解决一个冲突的方法，这样在下一次看到相同冲突时，Git 可以为你自动地解决它。</p>\n<p>那么rerere能够避免<code>git rebase</code>带来的冲突吗，答案是否定的。因为rerere在判断两个冲突是否为相同冲突是根据冲突体的两部分是否完全一样来进行的，就上面的例子而言，不管是哪种冲突解决方案，第一次和第二次冲突的冲突体都不完全一样，因此rerere都不会自动帮我们修复。</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/b80ef2ec61407d7a737a0997da6c960d.png\" alt=\"8\"></p>\n<p>而且，rerere命令也会记住错误的冲突解决方案，下次遇到相同的冲突时会直接应用错误的方案。不过你可以使用<code>git rerere forget &lt;pathspec&gt;</code>命令来删除Git记住的冲突解决方案。</p>\n<p>说了这么多，那rerere命令到底有什么用呢？</p>\n<p><code>git rerere</code>命令为我们提供了一种减少冲突的方案：当你要保证一个长期分支会干净地合并，但是又不想要一串中间的合并提交。 将rerere功能打开后偶尔合并，解决冲突，然后返回到合并前。 如果你持续这样做，那么最终的合并会很容易，因为rerere可以为你自动做所有的事情。<code>git rerere</code>也可以将冲突的解决方案共享给项目组的其他成员。</p>\n<p>所以说rerere命令还有一点用的，不过他并不能彻底解决冲突多的问题，减少冲突还是需要我们在平时使用时规范git的使用方法，使用统一的git工作流。</p>\n<h2 id=\"后记\"><a href=\"#后记\" class=\"headerlink\" title=\"后记\"></a>后记</h2><p>本来打算写一篇的，但是因为太长了，所以分为两篇来写。由于写的比较仓促，文中如果有什么纰漏，欢迎指出。</p>\n<p>参考资料：<br><a href=\"https://git-scm.com/book/zh/v2\" target=\"_blank\" rel=\"noopener\">Pro Git</a><br><a href=\"http://stackoverflow.com/questions/13825079/why-do-i-have-to-resolve-the-same-conflict-over-and-over\" target=\"_blank\" rel=\"noopener\">Why do I have to resolve the same conflict over and over?</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>本文接上一篇，主要讲解一下git rebase的用法和使用中注意的事项。</p>\n<h2 id=\"git-rebase\"><a href=\"#git-rebase\" class=\"headerlink\" title=\"git rebase\"></a>git rebase</h2><h3 id=\"基本原理\"><a href=\"#基本原理\" class=\"headerlink\" title=\"基本原理\"></a>基本原理</h3><p>git rebase，也叫做变基，也是Git种一种合并代码的手段，与git merge不同的是，rebase是直接将一个分支从他们的共同父节点开始后的所有Commit依次合并到另外一个分支上。如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/e3bdbc7fff28676ccefdcb16f4d43095.png\" alt=\"1\"></p>\n<p>两个分支develop和master，如果通过命令<code>git merge</code>将develop分支合并到master分支，Git会将‘C’，‘3’以及两个分支的共同父节点‘B’进行三路合并，合并完成后生成一个新节点，如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/ce919bb1921ee5c302baafbb0f45785f.png\" alt=\"2\"></p>\n<p>如果<code>git rebase</code>将develop分支变基到master分支上，Git会将develop分支上的所有commit(1,2,3)依次合并到master，每一次合并都会生成一个新的提交(如下图1’,2’,3’)，合并完成后，如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/0478f567c5748186a200cd4da8b5ddd8.png\" alt=\"3\"></p>\n<p>可以明显的看到，使用<code>git rebase</code>，分支线依然保持为一条，分支线看起来也没有那么乱，这也是<code>git rebase</code>相对于<code>git merge</code>的一个优点，但是另一方面，<code>git rebase</code>在合并每一个提交并生成一个新的提交时，会改写原来提交的提交时间（不会改写提交人），而且<code>git rebase</code>也没有留下合并的痕迹，可追溯性没那么强。</p>\n<h3 id=\"为什么那么多冲突\"><a href=\"#为什么那么多冲突\" class=\"headerlink\" title=\"为什么那么多冲突\"></a>为什么那么多冲突</h3><p>在使用<code>git rebase</code>的过程中经常会遇到这种情况，在执行的<code>git rebase</code>操作后，遇到了一个冲突，修改冲突后执行<code>git rebase --continue</code>，然后又来一个冲突，冲突一个接一个，而且有时候同一个冲突会出现好几次。</p>\n<p>其实，这是由rebase的原理造成的，Git在合并每一个Commit时都会判断是否有冲突，如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/90ff7dd4f79dddc65656820254dba48b.png\" alt=\"4\"></p>\n<p>两个分支develop和master以及他们各自的文件内容，现在要将develop变基到master上，Git会先将develop的第一个commit和master分支的最新提交合并，合并后如下：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/31c92a8c54e271fb69053a22c984c6dd.png\" alt=\"5\"></p>\n<p>会报一个冲突，解决完冲突后，执行<code>git rebase --continue</code>，根据冲突不同的解决方案，可能会与不同的结果，如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/74efc09f8e231d078914a36f5223e289.png\" alt=\"6\"></p>\n<p>上图中的两种冲突解决方案，在执行<code>git rebase --continue</code>后，依然再会报一个冲突，应为在合并develop的第二个提交时，依然有冲突。下面的解决方案则不会造成再次冲突，因为这种解决方案是完全用develop分支覆盖了master分支，如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/510fa8570fd012eb1723d6c521eb5cc6.png\" alt=\"7\"></p>\n<p>以上就是造成<code>git rebase</code>冲突太多的具体原因。</p>\n<h3 id=\"有那么点用的rerere\"><a href=\"#有那么点用的rerere\" class=\"headerlink\" title=\"有那么点用的rerere\"></a>有那么点用的rerere</h3><p>冲突太多怎么办，Git提供了一个辅助工具<code>git rerere</code>命令，具体用法可以参考<a href=\"https://git-scm.com/book/zh/v2/Git-%E5%B7%A5%E5%85%B7-Rerere\" target=\"_blank\" rel=\"noopener\">git rerere</a>。rerere命令能够记住解决一个冲突的方法，这样在下一次看到相同冲突时，Git 可以为你自动地解决它。</p>\n<p>那么rerere能够避免<code>git rebase</code>带来的冲突吗，答案是否定的。因为rerere在判断两个冲突是否为相同冲突是根据冲突体的两部分是否完全一样来进行的，就上面的例子而言，不管是哪种冲突解决方案，第一次和第二次冲突的冲突体都不完全一样，因此rerere都不会自动帮我们修复。</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/b80ef2ec61407d7a737a0997da6c960d.png\" alt=\"8\"></p>\n<p>而且，rerere命令也会记住错误的冲突解决方案，下次遇到相同的冲突时会直接应用错误的方案。不过你可以使用<code>git rerere forget &lt;pathspec&gt;</code>命令来删除Git记住的冲突解决方案。</p>\n<p>说了这么多，那rerere命令到底有什么用呢？</p>\n<p><code>git rerere</code>命令为我们提供了一种减少冲突的方案：当你要保证一个长期分支会干净地合并，但是又不想要一串中间的合并提交。 将rerere功能打开后偶尔合并，解决冲突，然后返回到合并前。 如果你持续这样做，那么最终的合并会很容易，因为rerere可以为你自动做所有的事情。<code>git rerere</code>也可以将冲突的解决方案共享给项目组的其他成员。</p>\n<p>所以说rerere命令还有一点用的，不过他并不能彻底解决冲突多的问题，减少冲突还是需要我们在平时使用时规范git的使用方法，使用统一的git工作流。</p>\n<h2 id=\"后记\"><a href=\"#后记\" class=\"headerlink\" title=\"后记\"></a>后记</h2><p>本来打算写一篇的，但是因为太长了，所以分为两篇来写。由于写的比较仓促，文中如果有什么纰漏，欢迎指出。</p>\n<p>参考资料：<br><a href=\"https://git-scm.com/book/zh/v2\" target=\"_blank\" rel=\"noopener\">Pro Git</a><br><a href=\"http://stackoverflow.com/questions/13825079/why-do-i-have-to-resolve-the-same-conflict-over-and-over\" target=\"_blank\" rel=\"noopener\">Why do I have to resolve the same conflict over and over?</a></p>\n"},{"title":"修改模态界面的转场动画","date":"2017-05-27T01:21:38.000Z","_content":"\n模态（Modal）界面弹出动画一般是从下往上推出，如果要修改转场动画，可以设置modalTransitionStyle属性，代码如下：\n\n```objectivec\nViewController *vc = [[ViewController alloc] init];\nvc.modalTransitionStyle = UIModalTransitionStyleFlipHorizontal;\n[self presentViewController:vc animated:YES completion:nil];\n```\n\nmodalTransitionStyle是一个枚举，有以下四个值，分别代表四种不同的转场效果，\n\n```objectivec\nUIModalTransitionStyleCoverVertical = 0,\nUIModalTransitionStyleFlipHorizontal,\nUIModalTransitionStyleCrossDissolve,\nUIModalTransitionStylePartialCurl\n```\n\n如果上面四种效果都不能满足你的需求，还可以使用CATransition进一步定制你的转场动画，代码如下：\n\n```objectivec\nViewController *vc = [[ViewController alloc] init];\nCATransition *transition = [CATransition animation];\ntransition.type = kCATransitionMoveIn;\ntransition.subtype = kCATransitionFromLeft;\ntransition.duration = 3.0;\ntransition.timingFunction = [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionEaseIn];\n[self.view.window.layer addAnimation:transition forKey:@\"tran\"];\n[self presentViewController:vc animated:NO completion:nil];\n```\n\n使用CATransition的type和subtype两个属性可以定制16中转场动画，同时CATransition还可以设置转场持续的时间（duration）以及动画速度控制函数（timingFunction）等属性。注意，一定要把动画加载控制器view的window上。\n\n完成代码，包括present和dismiss\n\n```objectivec\nViewController *vc = [[ViewController alloc] init];\nCATransition *presentTransition = [CATransition animation];\npresentTransition.type = kCATransitionMoveIn;\npresentTransition.subtype = kCATransitionFromLeft;\npresentTransition.duration = 3.0;\npresentTransition.timingFunction = [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionEaseIn];\n[self.view.window.layer addAnimation:presentTransition forKey:@\"presentTransition\"];\n[self presentViewController:vc animated:NO completion:nil];\n\n\nCATransition *dismissTransition = [CATransition animation];\ndismissTransition.type = kCATransitionMoveIn;\ndismissTransition.subtype = kCATransitionFromRight;\ndismissTransition.duration = 3.0;\ndismissTransition.timingFunction = [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionEaseIn];\n[self.view.window.layer addAnimation:dismissTransition forKey:@\"dismissTransition\"];\n[self dismissViewControllerAnimated:NO completion:nil];\n```\n\n如果CATransition的16种转场动画还不能满足你的需求，iOS7之后，可以使用UIViewControllerAnimatedTransitioning协议完全自定义转场动画，还能实现手势控制转动画。具体代码可以参考我写的这个[Demo](https://github.com/liujinlongxa/AnimationTransition)。\n\n以上就是我对模态界面转场动画的一个总结。\n","source":"_posts/2017-05-27-修改模态界面的转场动画.md","raw":"---\ntitle: 修改模态界面的转场动画\ncategories: iOS开发\ntags:\n  - 转场动画\n  - CATransition\ndate: 2017-05-27 09:21:38\n---\n\n模态（Modal）界面弹出动画一般是从下往上推出，如果要修改转场动画，可以设置modalTransitionStyle属性，代码如下：\n\n```objectivec\nViewController *vc = [[ViewController alloc] init];\nvc.modalTransitionStyle = UIModalTransitionStyleFlipHorizontal;\n[self presentViewController:vc animated:YES completion:nil];\n```\n\nmodalTransitionStyle是一个枚举，有以下四个值，分别代表四种不同的转场效果，\n\n```objectivec\nUIModalTransitionStyleCoverVertical = 0,\nUIModalTransitionStyleFlipHorizontal,\nUIModalTransitionStyleCrossDissolve,\nUIModalTransitionStylePartialCurl\n```\n\n如果上面四种效果都不能满足你的需求，还可以使用CATransition进一步定制你的转场动画，代码如下：\n\n```objectivec\nViewController *vc = [[ViewController alloc] init];\nCATransition *transition = [CATransition animation];\ntransition.type = kCATransitionMoveIn;\ntransition.subtype = kCATransitionFromLeft;\ntransition.duration = 3.0;\ntransition.timingFunction = [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionEaseIn];\n[self.view.window.layer addAnimation:transition forKey:@\"tran\"];\n[self presentViewController:vc animated:NO completion:nil];\n```\n\n使用CATransition的type和subtype两个属性可以定制16中转场动画，同时CATransition还可以设置转场持续的时间（duration）以及动画速度控制函数（timingFunction）等属性。注意，一定要把动画加载控制器view的window上。\n\n完成代码，包括present和dismiss\n\n```objectivec\nViewController *vc = [[ViewController alloc] init];\nCATransition *presentTransition = [CATransition animation];\npresentTransition.type = kCATransitionMoveIn;\npresentTransition.subtype = kCATransitionFromLeft;\npresentTransition.duration = 3.0;\npresentTransition.timingFunction = [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionEaseIn];\n[self.view.window.layer addAnimation:presentTransition forKey:@\"presentTransition\"];\n[self presentViewController:vc animated:NO completion:nil];\n\n\nCATransition *dismissTransition = [CATransition animation];\ndismissTransition.type = kCATransitionMoveIn;\ndismissTransition.subtype = kCATransitionFromRight;\ndismissTransition.duration = 3.0;\ndismissTransition.timingFunction = [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionEaseIn];\n[self.view.window.layer addAnimation:dismissTransition forKey:@\"dismissTransition\"];\n[self dismissViewControllerAnimated:NO completion:nil];\n```\n\n如果CATransition的16种转场动画还不能满足你的需求，iOS7之后，可以使用UIViewControllerAnimatedTransitioning协议完全自定义转场动画，还能实现手势控制转动画。具体代码可以参考我写的这个[Demo](https://github.com/liujinlongxa/AnimationTransition)。\n\n以上就是我对模态界面转场动画的一个总结。\n","slug":"修改模态界面的转场动画","published":1,"updated":"2017-05-27T02:14:10.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjutyfmga0040c4c9tzttojhl","content":"<p>模态（Modal）界面弹出动画一般是从下往上推出，如果要修改转场动画，可以设置modalTransitionStyle属性，代码如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ViewController *vc = [[ViewController alloc] init];</span><br><span class=\"line\">vc.modalTransitionStyle = <span class=\"built_in\">UIModalTransitionStyleFlipHorizontal</span>;</span><br><span class=\"line\">[<span class=\"keyword\">self</span> presentViewController:vc animated:<span class=\"literal\">YES</span> completion:<span class=\"literal\">nil</span>];</span><br></pre></td></tr></table></figure>\n<p>modalTransitionStyle是一个枚举，有以下四个值，分别代表四种不同的转场效果，</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">UIModalTransitionStyleCoverVertical</span> = <span class=\"number\">0</span>,</span><br><span class=\"line\"><span class=\"built_in\">UIModalTransitionStyleFlipHorizontal</span>,</span><br><span class=\"line\"><span class=\"built_in\">UIModalTransitionStyleCrossDissolve</span>,</span><br><span class=\"line\"><span class=\"built_in\">UIModalTransitionStylePartialCurl</span></span><br></pre></td></tr></table></figure>\n<p>如果上面四种效果都不能满足你的需求，还可以使用CATransition进一步定制你的转场动画，代码如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ViewController *vc = [[ViewController alloc] init];</span><br><span class=\"line\"><span class=\"built_in\">CATransition</span> *transition = [<span class=\"built_in\">CATransition</span> animation];</span><br><span class=\"line\">transition.type = kCATransitionMoveIn;</span><br><span class=\"line\">transition.subtype = kCATransitionFromLeft;</span><br><span class=\"line\">transition.duration = <span class=\"number\">3.0</span>;</span><br><span class=\"line\">transition.timingFunction = [<span class=\"built_in\">CAMediaTimingFunction</span> functionWithName:kCAMediaTimingFunctionEaseIn];</span><br><span class=\"line\">[<span class=\"keyword\">self</span>.view.window.layer addAnimation:transition forKey:<span class=\"string\">@\"tran\"</span>];</span><br><span class=\"line\">[<span class=\"keyword\">self</span> presentViewController:vc animated:<span class=\"literal\">NO</span> completion:<span class=\"literal\">nil</span>];</span><br></pre></td></tr></table></figure>\n<p>使用CATransition的type和subtype两个属性可以定制16中转场动画，同时CATransition还可以设置转场持续的时间（duration）以及动画速度控制函数（timingFunction）等属性。注意，一定要把动画加载控制器view的window上。</p>\n<p>完成代码，包括present和dismiss</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ViewController *vc = [[ViewController alloc] init];</span><br><span class=\"line\"><span class=\"built_in\">CATransition</span> *presentTransition = [<span class=\"built_in\">CATransition</span> animation];</span><br><span class=\"line\">presentTransition.type = kCATransitionMoveIn;</span><br><span class=\"line\">presentTransition.subtype = kCATransitionFromLeft;</span><br><span class=\"line\">presentTransition.duration = <span class=\"number\">3.0</span>;</span><br><span class=\"line\">presentTransition.timingFunction = [<span class=\"built_in\">CAMediaTimingFunction</span> functionWithName:kCAMediaTimingFunctionEaseIn];</span><br><span class=\"line\">[<span class=\"keyword\">self</span>.view.window.layer addAnimation:presentTransition forKey:<span class=\"string\">@\"presentTransition\"</span>];</span><br><span class=\"line\">[<span class=\"keyword\">self</span> presentViewController:vc animated:<span class=\"literal\">NO</span> completion:<span class=\"literal\">nil</span>];</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">CATransition</span> *dismissTransition = [<span class=\"built_in\">CATransition</span> animation];</span><br><span class=\"line\">dismissTransition.type = kCATransitionMoveIn;</span><br><span class=\"line\">dismissTransition.subtype = kCATransitionFromRight;</span><br><span class=\"line\">dismissTransition.duration = <span class=\"number\">3.0</span>;</span><br><span class=\"line\">dismissTransition.timingFunction = [<span class=\"built_in\">CAMediaTimingFunction</span> functionWithName:kCAMediaTimingFunctionEaseIn];</span><br><span class=\"line\">[<span class=\"keyword\">self</span>.view.window.layer addAnimation:dismissTransition forKey:<span class=\"string\">@\"dismissTransition\"</span>];</span><br><span class=\"line\">[<span class=\"keyword\">self</span> dismissViewControllerAnimated:<span class=\"literal\">NO</span> completion:<span class=\"literal\">nil</span>];</span><br></pre></td></tr></table></figure>\n<p>如果CATransition的16种转场动画还不能满足你的需求，iOS7之后，可以使用UIViewControllerAnimatedTransitioning协议完全自定义转场动画，还能实现手势控制转动画。具体代码可以参考我写的这个<a href=\"https://github.com/liujinlongxa/AnimationTransition\" target=\"_blank\" rel=\"noopener\">Demo</a>。</p>\n<p>以上就是我对模态界面转场动画的一个总结。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>模态（Modal）界面弹出动画一般是从下往上推出，如果要修改转场动画，可以设置modalTransitionStyle属性，代码如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ViewController *vc = [[ViewController alloc] init];</span><br><span class=\"line\">vc.modalTransitionStyle = <span class=\"built_in\">UIModalTransitionStyleFlipHorizontal</span>;</span><br><span class=\"line\">[<span class=\"keyword\">self</span> presentViewController:vc animated:<span class=\"literal\">YES</span> completion:<span class=\"literal\">nil</span>];</span><br></pre></td></tr></table></figure>\n<p>modalTransitionStyle是一个枚举，有以下四个值，分别代表四种不同的转场效果，</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">UIModalTransitionStyleCoverVertical</span> = <span class=\"number\">0</span>,</span><br><span class=\"line\"><span class=\"built_in\">UIModalTransitionStyleFlipHorizontal</span>,</span><br><span class=\"line\"><span class=\"built_in\">UIModalTransitionStyleCrossDissolve</span>,</span><br><span class=\"line\"><span class=\"built_in\">UIModalTransitionStylePartialCurl</span></span><br></pre></td></tr></table></figure>\n<p>如果上面四种效果都不能满足你的需求，还可以使用CATransition进一步定制你的转场动画，代码如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ViewController *vc = [[ViewController alloc] init];</span><br><span class=\"line\"><span class=\"built_in\">CATransition</span> *transition = [<span class=\"built_in\">CATransition</span> animation];</span><br><span class=\"line\">transition.type = kCATransitionMoveIn;</span><br><span class=\"line\">transition.subtype = kCATransitionFromLeft;</span><br><span class=\"line\">transition.duration = <span class=\"number\">3.0</span>;</span><br><span class=\"line\">transition.timingFunction = [<span class=\"built_in\">CAMediaTimingFunction</span> functionWithName:kCAMediaTimingFunctionEaseIn];</span><br><span class=\"line\">[<span class=\"keyword\">self</span>.view.window.layer addAnimation:transition forKey:<span class=\"string\">@\"tran\"</span>];</span><br><span class=\"line\">[<span class=\"keyword\">self</span> presentViewController:vc animated:<span class=\"literal\">NO</span> completion:<span class=\"literal\">nil</span>];</span><br></pre></td></tr></table></figure>\n<p>使用CATransition的type和subtype两个属性可以定制16中转场动画，同时CATransition还可以设置转场持续的时间（duration）以及动画速度控制函数（timingFunction）等属性。注意，一定要把动画加载控制器view的window上。</p>\n<p>完成代码，包括present和dismiss</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ViewController *vc = [[ViewController alloc] init];</span><br><span class=\"line\"><span class=\"built_in\">CATransition</span> *presentTransition = [<span class=\"built_in\">CATransition</span> animation];</span><br><span class=\"line\">presentTransition.type = kCATransitionMoveIn;</span><br><span class=\"line\">presentTransition.subtype = kCATransitionFromLeft;</span><br><span class=\"line\">presentTransition.duration = <span class=\"number\">3.0</span>;</span><br><span class=\"line\">presentTransition.timingFunction = [<span class=\"built_in\">CAMediaTimingFunction</span> functionWithName:kCAMediaTimingFunctionEaseIn];</span><br><span class=\"line\">[<span class=\"keyword\">self</span>.view.window.layer addAnimation:presentTransition forKey:<span class=\"string\">@\"presentTransition\"</span>];</span><br><span class=\"line\">[<span class=\"keyword\">self</span> presentViewController:vc animated:<span class=\"literal\">NO</span> completion:<span class=\"literal\">nil</span>];</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">CATransition</span> *dismissTransition = [<span class=\"built_in\">CATransition</span> animation];</span><br><span class=\"line\">dismissTransition.type = kCATransitionMoveIn;</span><br><span class=\"line\">dismissTransition.subtype = kCATransitionFromRight;</span><br><span class=\"line\">dismissTransition.duration = <span class=\"number\">3.0</span>;</span><br><span class=\"line\">dismissTransition.timingFunction = [<span class=\"built_in\">CAMediaTimingFunction</span> functionWithName:kCAMediaTimingFunctionEaseIn];</span><br><span class=\"line\">[<span class=\"keyword\">self</span>.view.window.layer addAnimation:dismissTransition forKey:<span class=\"string\">@\"dismissTransition\"</span>];</span><br><span class=\"line\">[<span class=\"keyword\">self</span> dismissViewControllerAnimated:<span class=\"literal\">NO</span> completion:<span class=\"literal\">nil</span>];</span><br></pre></td></tr></table></figure>\n<p>如果CATransition的16种转场动画还不能满足你的需求，iOS7之后，可以使用UIViewControllerAnimatedTransitioning协议完全自定义转场动画，还能实现手势控制转动画。具体代码可以参考我写的这个<a href=\"https://github.com/liujinlongxa/AnimationTransition\" target=\"_blank\" rel=\"noopener\">Demo</a>。</p>\n<p>以上就是我对模态界面转场动画的一个总结。</p>\n"},{"title":"通过XCode查看APP的沙盒内容","date":"2017-06-12T03:24:36.000Z","_content":"\n有时我们在开发APP过程中可能需要查看沙盒的内容，对于模拟器来说已经有一个很好用的工具[Simpholders](https://simpholders.com/)，如果是真机该如何查看沙盒的内容呢？\n\n其实XCode已经自带了这个功能，下面就介绍一下通过XCode查看APP沙盒内容的方法。\n\n首先，打开XCode，然后连接真机，依次点击Window->Devices（快捷键Shift+Cmd+2)，出现如下界面，在\"Installed App\"列表里就会出现你调试过的APP，如下图：\n\n![1](http://oldblog.shicishuzhai.com/03a71dd7225206a6f3546fbdb09208b8.png)\n\n然后选中你要查看沙盒的APP，然后点击下发的齿轮按钮，选择\"Download Container...\"\n\n![2](http://oldblog.shicishuzhai.com/16142a7b444769ef7137725fe12203df.png)\n\n然后选择一个文件夹保存下载的文件。下载完成后就会有一个以xcappdata为后缀的文件，然后右键点击\"查看包内容\"就可以看到APP沙盒里的内容了。\n\n以上就是通过XCode查看APP沙盒内容的方法，这个方法只能查看你通过XCode运行安装的APP的沙盒，其他的APP是不能查看的。\n","source":"_posts/2017-06-12-通过XCode查看APP的沙盒内容.md","raw":"---\ntitle: 通过XCode查看APP的沙盒内容\ncategories: iOS Tips\ntags:\n  - 沙盒\ndate: 2017-06-12 11:24:36\n---\n\n有时我们在开发APP过程中可能需要查看沙盒的内容，对于模拟器来说已经有一个很好用的工具[Simpholders](https://simpholders.com/)，如果是真机该如何查看沙盒的内容呢？\n\n其实XCode已经自带了这个功能，下面就介绍一下通过XCode查看APP沙盒内容的方法。\n\n首先，打开XCode，然后连接真机，依次点击Window->Devices（快捷键Shift+Cmd+2)，出现如下界面，在\"Installed App\"列表里就会出现你调试过的APP，如下图：\n\n![1](http://oldblog.shicishuzhai.com/03a71dd7225206a6f3546fbdb09208b8.png)\n\n然后选中你要查看沙盒的APP，然后点击下发的齿轮按钮，选择\"Download Container...\"\n\n![2](http://oldblog.shicishuzhai.com/16142a7b444769ef7137725fe12203df.png)\n\n然后选择一个文件夹保存下载的文件。下载完成后就会有一个以xcappdata为后缀的文件，然后右键点击\"查看包内容\"就可以看到APP沙盒里的内容了。\n\n以上就是通过XCode查看APP沙盒内容的方法，这个方法只能查看你通过XCode运行安装的APP的沙盒，其他的APP是不能查看的。\n","slug":"通过XCode查看APP的沙盒内容","published":1,"updated":"2019-01-13T04:00:19.572Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjutyfmgb0044c4c9bmytalc4","content":"<p>有时我们在开发APP过程中可能需要查看沙盒的内容，对于模拟器来说已经有一个很好用的工具<a href=\"https://simpholders.com/\" target=\"_blank\" rel=\"noopener\">Simpholders</a>，如果是真机该如何查看沙盒的内容呢？</p>\n<p>其实XCode已经自带了这个功能，下面就介绍一下通过XCode查看APP沙盒内容的方法。</p>\n<p>首先，打开XCode，然后连接真机，依次点击Window-&gt;Devices（快捷键Shift+Cmd+2)，出现如下界面，在”Installed App”列表里就会出现你调试过的APP，如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/03a71dd7225206a6f3546fbdb09208b8.png\" alt=\"1\"></p>\n<p>然后选中你要查看沙盒的APP，然后点击下发的齿轮按钮，选择”Download Container…”</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/16142a7b444769ef7137725fe12203df.png\" alt=\"2\"></p>\n<p>然后选择一个文件夹保存下载的文件。下载完成后就会有一个以xcappdata为后缀的文件，然后右键点击”查看包内容”就可以看到APP沙盒里的内容了。</p>\n<p>以上就是通过XCode查看APP沙盒内容的方法，这个方法只能查看你通过XCode运行安装的APP的沙盒，其他的APP是不能查看的。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>有时我们在开发APP过程中可能需要查看沙盒的内容，对于模拟器来说已经有一个很好用的工具<a href=\"https://simpholders.com/\" target=\"_blank\" rel=\"noopener\">Simpholders</a>，如果是真机该如何查看沙盒的内容呢？</p>\n<p>其实XCode已经自带了这个功能，下面就介绍一下通过XCode查看APP沙盒内容的方法。</p>\n<p>首先，打开XCode，然后连接真机，依次点击Window-&gt;Devices（快捷键Shift+Cmd+2)，出现如下界面，在”Installed App”列表里就会出现你调试过的APP，如下图：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/03a71dd7225206a6f3546fbdb09208b8.png\" alt=\"1\"></p>\n<p>然后选中你要查看沙盒的APP，然后点击下发的齿轮按钮，选择”Download Container…”</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/16142a7b444769ef7137725fe12203df.png\" alt=\"2\"></p>\n<p>然后选择一个文件夹保存下载的文件。下载完成后就会有一个以xcappdata为后缀的文件，然后右键点击”查看包内容”就可以看到APP沙盒里的内容了。</p>\n<p>以上就是通过XCode查看APP沙盒内容的方法，这个方法只能查看你通过XCode运行安装的APP的沙盒，其他的APP是不能查看的。</p>\n"},{"title":"如何获取分享h5页面时的缩略图","date":"2017-03-27T08:37:13.000Z","_content":"\n最近产品提了一个需求，在分享应用内h5页面时，不能像以前一样，使用应用的图标作为分享的缩略图，要使用H5页面内的一张图片作为缩略图进行分享。\n\n我调查了一下市面上一些常见应用的做法，基本上可以总结出三种做法：\n\n### 第一种方法：H5页面内指定分享图片地址\n\n比较常见的做法是，在h5页面内定义一个JS的全局变量或者json，指定分享用的图片地址，APP内，通过JavaScriptCore获取全局变量，然后用于分享。\n\n具体这样做的应用有：Keep，哔哩哔哩（部分页面），京东（部分页面）\n\n还有一种是把分享的信息定义在页面头部(head标签里)，QQ音乐就是这样做的。\n\n### 第二种做法：固定分享页面内第一张符合条件的图片\n\n如果H5页面是第三方提供，就不能通过第一种方法去指定分享内容了。这种情况下，大多数应用的做法就是取页面内第一张符合大小的图片作为分享图片。\n\n这里我写了一个JS函数，只要把这个函数注入到H5页面中，APP就可以通过调用这个方法来获取到第一张符合大小的图片。\n\n```js\nfunction getImage(width, height) {\n    var images = document.getElementsByTagName('img');\n    for (var index = 0; index < images.length; index++) {\n        var img = images[index];\n        var imgData = new Image();\n        imgData.src = img.src;\n        if (imgData.width > width && imgData.height > height) {\n            return imgData.src;\n        }\n    }\n}\n```\n\n具体这样做的应用有：微信，今日头条\n\n### 第三种做法：对页面进行截图，使用截图进行分享\n\n有些应用在分享时会对H5页面进行截图，然后把截图作为分享的内容。\n\n具体这样做的应用有：微博，UC浏览器\n\n### 总结\n\n以上就是三种获取H5页面内分享缩略图的三种策略，我们最终选择的是第一种和第二种相结合的方式，如果页面内指定了分享图片，则使用，否则获取页面内第一张符合条件的图片进行分享。\n","source":"_posts/2017-03-27-如何获取分享h5页面时的缩略图.md","raw":"---\ntitle: 如何获取分享h5页面时的缩略图\ncategories: iOS开发\ntags:\n  - 分享\ndate: 2017-03-27 16:37:13\n---\n\n最近产品提了一个需求，在分享应用内h5页面时，不能像以前一样，使用应用的图标作为分享的缩略图，要使用H5页面内的一张图片作为缩略图进行分享。\n\n我调查了一下市面上一些常见应用的做法，基本上可以总结出三种做法：\n\n### 第一种方法：H5页面内指定分享图片地址\n\n比较常见的做法是，在h5页面内定义一个JS的全局变量或者json，指定分享用的图片地址，APP内，通过JavaScriptCore获取全局变量，然后用于分享。\n\n具体这样做的应用有：Keep，哔哩哔哩（部分页面），京东（部分页面）\n\n还有一种是把分享的信息定义在页面头部(head标签里)，QQ音乐就是这样做的。\n\n### 第二种做法：固定分享页面内第一张符合条件的图片\n\n如果H5页面是第三方提供，就不能通过第一种方法去指定分享内容了。这种情况下，大多数应用的做法就是取页面内第一张符合大小的图片作为分享图片。\n\n这里我写了一个JS函数，只要把这个函数注入到H5页面中，APP就可以通过调用这个方法来获取到第一张符合大小的图片。\n\n```js\nfunction getImage(width, height) {\n    var images = document.getElementsByTagName('img');\n    for (var index = 0; index < images.length; index++) {\n        var img = images[index];\n        var imgData = new Image();\n        imgData.src = img.src;\n        if (imgData.width > width && imgData.height > height) {\n            return imgData.src;\n        }\n    }\n}\n```\n\n具体这样做的应用有：微信，今日头条\n\n### 第三种做法：对页面进行截图，使用截图进行分享\n\n有些应用在分享时会对H5页面进行截图，然后把截图作为分享的内容。\n\n具体这样做的应用有：微博，UC浏览器\n\n### 总结\n\n以上就是三种获取H5页面内分享缩略图的三种策略，我们最终选择的是第一种和第二种相结合的方式，如果页面内指定了分享图片，则使用，否则获取页面内第一张符合条件的图片进行分享。\n","slug":"如何获取分享h5页面时的缩略图","published":1,"updated":"2017-03-27T09:04:04.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjutyfmgc0047c4c9tuat9b36","content":"<p>最近产品提了一个需求，在分享应用内h5页面时，不能像以前一样，使用应用的图标作为分享的缩略图，要使用H5页面内的一张图片作为缩略图进行分享。</p>\n<p>我调查了一下市面上一些常见应用的做法，基本上可以总结出三种做法：</p>\n<h3 id=\"第一种方法：H5页面内指定分享图片地址\"><a href=\"#第一种方法：H5页面内指定分享图片地址\" class=\"headerlink\" title=\"第一种方法：H5页面内指定分享图片地址\"></a>第一种方法：H5页面内指定分享图片地址</h3><p>比较常见的做法是，在h5页面内定义一个JS的全局变量或者json，指定分享用的图片地址，APP内，通过JavaScriptCore获取全局变量，然后用于分享。</p>\n<p>具体这样做的应用有：Keep，哔哩哔哩（部分页面），京东（部分页面）</p>\n<p>还有一种是把分享的信息定义在页面头部(head标签里)，QQ音乐就是这样做的。</p>\n<h3 id=\"第二种做法：固定分享页面内第一张符合条件的图片\"><a href=\"#第二种做法：固定分享页面内第一张符合条件的图片\" class=\"headerlink\" title=\"第二种做法：固定分享页面内第一张符合条件的图片\"></a>第二种做法：固定分享页面内第一张符合条件的图片</h3><p>如果H5页面是第三方提供，就不能通过第一种方法去指定分享内容了。这种情况下，大多数应用的做法就是取页面内第一张符合大小的图片作为分享图片。</p>\n<p>这里我写了一个JS函数，只要把这个函数注入到H5页面中，APP就可以通过调用这个方法来获取到第一张符合大小的图片。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getImage</span>(<span class=\"params\">width, height</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> images = <span class=\"built_in\">document</span>.getElementsByTagName(<span class=\"string\">'img'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> index = <span class=\"number\">0</span>; index &lt; images.length; index++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> img = images[index];</span><br><span class=\"line\">        <span class=\"keyword\">var</span> imgData = <span class=\"keyword\">new</span> Image();</span><br><span class=\"line\">        imgData.src = img.src;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (imgData.width &gt; width &amp;&amp; imgData.height &gt; height) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> imgData.src;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>具体这样做的应用有：微信，今日头条</p>\n<h3 id=\"第三种做法：对页面进行截图，使用截图进行分享\"><a href=\"#第三种做法：对页面进行截图，使用截图进行分享\" class=\"headerlink\" title=\"第三种做法：对页面进行截图，使用截图进行分享\"></a>第三种做法：对页面进行截图，使用截图进行分享</h3><p>有些应用在分享时会对H5页面进行截图，然后把截图作为分享的内容。</p>\n<p>具体这样做的应用有：微博，UC浏览器</p>\n<h3 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h3><p>以上就是三种获取H5页面内分享缩略图的三种策略，我们最终选择的是第一种和第二种相结合的方式，如果页面内指定了分享图片，则使用，否则获取页面内第一张符合条件的图片进行分享。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>最近产品提了一个需求，在分享应用内h5页面时，不能像以前一样，使用应用的图标作为分享的缩略图，要使用H5页面内的一张图片作为缩略图进行分享。</p>\n<p>我调查了一下市面上一些常见应用的做法，基本上可以总结出三种做法：</p>\n<h3 id=\"第一种方法：H5页面内指定分享图片地址\"><a href=\"#第一种方法：H5页面内指定分享图片地址\" class=\"headerlink\" title=\"第一种方法：H5页面内指定分享图片地址\"></a>第一种方法：H5页面内指定分享图片地址</h3><p>比较常见的做法是，在h5页面内定义一个JS的全局变量或者json，指定分享用的图片地址，APP内，通过JavaScriptCore获取全局变量，然后用于分享。</p>\n<p>具体这样做的应用有：Keep，哔哩哔哩（部分页面），京东（部分页面）</p>\n<p>还有一种是把分享的信息定义在页面头部(head标签里)，QQ音乐就是这样做的。</p>\n<h3 id=\"第二种做法：固定分享页面内第一张符合条件的图片\"><a href=\"#第二种做法：固定分享页面内第一张符合条件的图片\" class=\"headerlink\" title=\"第二种做法：固定分享页面内第一张符合条件的图片\"></a>第二种做法：固定分享页面内第一张符合条件的图片</h3><p>如果H5页面是第三方提供，就不能通过第一种方法去指定分享内容了。这种情况下，大多数应用的做法就是取页面内第一张符合大小的图片作为分享图片。</p>\n<p>这里我写了一个JS函数，只要把这个函数注入到H5页面中，APP就可以通过调用这个方法来获取到第一张符合大小的图片。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getImage</span>(<span class=\"params\">width, height</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> images = <span class=\"built_in\">document</span>.getElementsByTagName(<span class=\"string\">'img'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> index = <span class=\"number\">0</span>; index &lt; images.length; index++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> img = images[index];</span><br><span class=\"line\">        <span class=\"keyword\">var</span> imgData = <span class=\"keyword\">new</span> Image();</span><br><span class=\"line\">        imgData.src = img.src;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (imgData.width &gt; width &amp;&amp; imgData.height &gt; height) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> imgData.src;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>具体这样做的应用有：微信，今日头条</p>\n<h3 id=\"第三种做法：对页面进行截图，使用截图进行分享\"><a href=\"#第三种做法：对页面进行截图，使用截图进行分享\" class=\"headerlink\" title=\"第三种做法：对页面进行截图，使用截图进行分享\"></a>第三种做法：对页面进行截图，使用截图进行分享</h3><p>有些应用在分享时会对H5页面进行截图，然后把截图作为分享的内容。</p>\n<p>具体这样做的应用有：微博，UC浏览器</p>\n<h3 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h3><p>以上就是三种获取H5页面内分享缩略图的三种策略，我们最终选择的是第一种和第二种相结合的方式，如果页面内指定了分享图片，则使用，否则获取页面内第一张符合条件的图片进行分享。</p>\n"},{"title":"Python学习笔记(2)","date":"2018-09-03T15:03:40.000Z","_content":"\n## 函数\n\n### 函数的特点\n\n- 功能性：一个函数要有明确的功能\n- 隐藏细节：调用者不需要关注函数的细节\n- 函数的目的：减少重复代码\n\n### Python 中函数的定义\n\n```python\ndef funcname(parameter_list):\n    pass\n\n# 与Python内置的max函数重名了，会覆盖内置的max函数\ndef max(a, b):\n    if a > b:\n        return a\n    else:\n        return b\n\n\nprint(max(1, 2))\n\n\ndef func():\n    print('hello world')\n\n\nprint(func())  # None，无返回值则默认返回None\n```\n\n- 参数列表可有可无\n- 函数内可以`return value`，如果没有 return，则默认返回 None\n- 函数必须先定义才能使用\n- 函数名不能与 Python 内置的函数名重名，否则会覆盖内置函数\n\nPython 中关于递归函数：\n\n- Python 默认的递归次数是有限的\n- 可以通过`sys.setrecursionlimit(10000)`方法来修改递归次数\n\n关于 print 函数：\n\n```python\na = b = c = 1\nprint(a, b, c) # 分别打印a, b, c\n```\n\n### Python 中函数可以返回多个值\n\n```python\ndef func(num):\n    a = num * 2\n    b = num * 3\n    return a, b\n\nret = func(10)  # ret是一个元组\nprint(ret)\na, b = func(10)  # 推荐的做法，序列解包，不要使用元组[序号]\nprint(a, b)\n```\n\n### Python 中的序列解包和链式赋值\n\n```python\na, b, c = 1, 2, 3\nd = 1, 2, 3  # a是一个元组\na, b, c = d  # 序列解包\na = b = c = 1 # 链式赋值\n```\n\n### 必须参数和关键字参数\n\n- 必须参数：函数参数列表中定义的，必须传递的参数，如果不传则会编译错误\n- 关键字参数：明确指定参数的值，可以无视参数的顺序\n- 如果参数列表中既有必须参数，又有关键字参数，则关键字参数必须位于必须参数之后\n\n```python\ndef add(num1, num2):\n    return num1 + num2\n\n\nret = add(12, 13)  # 以必须参数的形式调用\nprint(ret)\nret1 = add(num2=13, num1=14)  # 以关键字参数的形式调用\nprint(ret1)\nret2 = add(14, num2=15)  # Ok, 关键字参数可以在必须参数之后\nprint(ret2)\nret3 = add(num1=14, 15)  # error，关键字参数不能在必须参数前\nprint(ret3)\n```\n\n### 默认参数\n\n- 默认参数必须位于参数列表的最后\n- 默认参数既可以使用关键字参数，也可以使用必须参数，也可以不传\n\n```python\ndef add(num1, num2, num3=3, num4=4):\n    return num1 + num2 + num3 + num4\n\n\nprint(add(10, 20, 30, 40))\nprint(add(10, 20, num4=40, num3=30))\nprint(add(10, 20, num4=40))\nprint(add(10, 20, num3=30))\nprint(add(10, 20, 30))\nprint(add(10, 20))\nprint(add(num1=10, num2=20))\nprint(add(num2=20, num1=10))\n```\n\n### 可变参数\n\n- 可变参数，给参数名前加一个星号`*`\n- 传递参数是，可以传一个元组或列表，前面要加一个星号`*`\n- 可变参数之后可以有关键字参数，但不能有必须参数，必须参数必须位于可变参数之前，默认参数也要使用关键字参数的形式进行调用\n- 可以参数也可以什么都不传，相当于传一个空的元组\n\n```python\ndef fun(*param):\n    print(param)\n\n\nfun(1, 2, 3, 4)\na = (1, 2, 3, 4)\nfun(*a)  # *相当于展开元组内的元素\nb = [1, 2, 3, 4]\nfun(*b)  # 同上\n\n\ndef fun1(num1, *param):\n    print(param)\n    print(num1)\n\nfun1(1, 2, 3, 4)  # (2, 3, 4), 1\n\n# 可变参数后有关键字参数\ndef fun1(num1, *param, num2, num3=3):\n    print(param)\n    print(num1)\n    print(num2)\n    print(num3)\n\n\nfun1(1, 2, 3, 4, num2=13) # 1, (2, 3, 4), 13, 3\nfun1(1, 2, 3, 4, num2=13, num3=14) # 1, (2, 3, 4), 13, 14\nfun1(1, num2 = 13, num3 = 14) # 1, (), 13, 14 可变参数为空元组\n```\n\n### 关键字可变参数\n\n- 参数前加两个星号`**`\n- 传递参数时需要传一个字典或使用关键字参数进行调用\n- 可以参数也可以什么都不传，相当于传一个空的字典\n- 关键字可变参数必须位于参数列表的最后\n\n```python\ndef fun(**param):\n    print(param)  # param是一个字典\n    for key, value in param.items():\n        print('key:' + key + ', value: ' + str(value))\n\n\nfun(num1=1, num2=2, num3=3)\na = {'aa': 1, 'bb': 2}\nfun(**a)  # 相当于解包a\nfun()  # {} , 可变参数也可以什么都不传，相当于传一个空字典\n\ndef fun(num1, **param):\n    print(param)  # param是一个字典\n    print(num1)\n\n\na = {'a': 1, 'b': 2}\nfun(1, **a)\n```\n\n### 变量的作用域\n\n```python\nc = 50 # 全局变量\n\n\ndef add(a, b):\n    c = a + b  # c 相当于一个新的局部变量，覆盖了外部的变量\n    print(c)\n\n\nadd(1, 2)  # 3\nprint(c)  # 50\n\nfor i in range(0, 9):\n    a = 12\n    print(i)\nprint(a)  # 循环外部可以引用循环内部的变量，Python没有块级作用域\n```\n\n### global 关键字\n\n```python\ndef fun():\n    global a  # 将a提升为全局作用域，a可以通过import导入其他模块\n    a = 2\n\nfun()\nprint(a) # 2\n\nb = 12 # 全局作用域\ndef fun1(num):\n    global b\n    b = b + num  # 修改全局作用域的变量b\n\nfun1(11)\nprint(b) # 23\n```\n","source":"_posts/2018-09-03-Python学习笔记-2.md","raw":"---\ntitle: Python学习笔记(2)\ncategories: Python\ntags:\n  - Python\ndate: 2018-09-03 23:03:40\n---\n\n## 函数\n\n### 函数的特点\n\n- 功能性：一个函数要有明确的功能\n- 隐藏细节：调用者不需要关注函数的细节\n- 函数的目的：减少重复代码\n\n### Python 中函数的定义\n\n```python\ndef funcname(parameter_list):\n    pass\n\n# 与Python内置的max函数重名了，会覆盖内置的max函数\ndef max(a, b):\n    if a > b:\n        return a\n    else:\n        return b\n\n\nprint(max(1, 2))\n\n\ndef func():\n    print('hello world')\n\n\nprint(func())  # None，无返回值则默认返回None\n```\n\n- 参数列表可有可无\n- 函数内可以`return value`，如果没有 return，则默认返回 None\n- 函数必须先定义才能使用\n- 函数名不能与 Python 内置的函数名重名，否则会覆盖内置函数\n\nPython 中关于递归函数：\n\n- Python 默认的递归次数是有限的\n- 可以通过`sys.setrecursionlimit(10000)`方法来修改递归次数\n\n关于 print 函数：\n\n```python\na = b = c = 1\nprint(a, b, c) # 分别打印a, b, c\n```\n\n### Python 中函数可以返回多个值\n\n```python\ndef func(num):\n    a = num * 2\n    b = num * 3\n    return a, b\n\nret = func(10)  # ret是一个元组\nprint(ret)\na, b = func(10)  # 推荐的做法，序列解包，不要使用元组[序号]\nprint(a, b)\n```\n\n### Python 中的序列解包和链式赋值\n\n```python\na, b, c = 1, 2, 3\nd = 1, 2, 3  # a是一个元组\na, b, c = d  # 序列解包\na = b = c = 1 # 链式赋值\n```\n\n### 必须参数和关键字参数\n\n- 必须参数：函数参数列表中定义的，必须传递的参数，如果不传则会编译错误\n- 关键字参数：明确指定参数的值，可以无视参数的顺序\n- 如果参数列表中既有必须参数，又有关键字参数，则关键字参数必须位于必须参数之后\n\n```python\ndef add(num1, num2):\n    return num1 + num2\n\n\nret = add(12, 13)  # 以必须参数的形式调用\nprint(ret)\nret1 = add(num2=13, num1=14)  # 以关键字参数的形式调用\nprint(ret1)\nret2 = add(14, num2=15)  # Ok, 关键字参数可以在必须参数之后\nprint(ret2)\nret3 = add(num1=14, 15)  # error，关键字参数不能在必须参数前\nprint(ret3)\n```\n\n### 默认参数\n\n- 默认参数必须位于参数列表的最后\n- 默认参数既可以使用关键字参数，也可以使用必须参数，也可以不传\n\n```python\ndef add(num1, num2, num3=3, num4=4):\n    return num1 + num2 + num3 + num4\n\n\nprint(add(10, 20, 30, 40))\nprint(add(10, 20, num4=40, num3=30))\nprint(add(10, 20, num4=40))\nprint(add(10, 20, num3=30))\nprint(add(10, 20, 30))\nprint(add(10, 20))\nprint(add(num1=10, num2=20))\nprint(add(num2=20, num1=10))\n```\n\n### 可变参数\n\n- 可变参数，给参数名前加一个星号`*`\n- 传递参数是，可以传一个元组或列表，前面要加一个星号`*`\n- 可变参数之后可以有关键字参数，但不能有必须参数，必须参数必须位于可变参数之前，默认参数也要使用关键字参数的形式进行调用\n- 可以参数也可以什么都不传，相当于传一个空的元组\n\n```python\ndef fun(*param):\n    print(param)\n\n\nfun(1, 2, 3, 4)\na = (1, 2, 3, 4)\nfun(*a)  # *相当于展开元组内的元素\nb = [1, 2, 3, 4]\nfun(*b)  # 同上\n\n\ndef fun1(num1, *param):\n    print(param)\n    print(num1)\n\nfun1(1, 2, 3, 4)  # (2, 3, 4), 1\n\n# 可变参数后有关键字参数\ndef fun1(num1, *param, num2, num3=3):\n    print(param)\n    print(num1)\n    print(num2)\n    print(num3)\n\n\nfun1(1, 2, 3, 4, num2=13) # 1, (2, 3, 4), 13, 3\nfun1(1, 2, 3, 4, num2=13, num3=14) # 1, (2, 3, 4), 13, 14\nfun1(1, num2 = 13, num3 = 14) # 1, (), 13, 14 可变参数为空元组\n```\n\n### 关键字可变参数\n\n- 参数前加两个星号`**`\n- 传递参数时需要传一个字典或使用关键字参数进行调用\n- 可以参数也可以什么都不传，相当于传一个空的字典\n- 关键字可变参数必须位于参数列表的最后\n\n```python\ndef fun(**param):\n    print(param)  # param是一个字典\n    for key, value in param.items():\n        print('key:' + key + ', value: ' + str(value))\n\n\nfun(num1=1, num2=2, num3=3)\na = {'aa': 1, 'bb': 2}\nfun(**a)  # 相当于解包a\nfun()  # {} , 可变参数也可以什么都不传，相当于传一个空字典\n\ndef fun(num1, **param):\n    print(param)  # param是一个字典\n    print(num1)\n\n\na = {'a': 1, 'b': 2}\nfun(1, **a)\n```\n\n### 变量的作用域\n\n```python\nc = 50 # 全局变量\n\n\ndef add(a, b):\n    c = a + b  # c 相当于一个新的局部变量，覆盖了外部的变量\n    print(c)\n\n\nadd(1, 2)  # 3\nprint(c)  # 50\n\nfor i in range(0, 9):\n    a = 12\n    print(i)\nprint(a)  # 循环外部可以引用循环内部的变量，Python没有块级作用域\n```\n\n### global 关键字\n\n```python\ndef fun():\n    global a  # 将a提升为全局作用域，a可以通过import导入其他模块\n    a = 2\n\nfun()\nprint(a) # 2\n\nb = 12 # 全局作用域\ndef fun1(num):\n    global b\n    b = b + num  # 修改全局作用域的变量b\n\nfun1(11)\nprint(b) # 23\n```\n","slug":"Python学习笔记-2","published":1,"updated":"2018-09-03T16:22:46.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjutyfmgd004bc4c90beqoksv","content":"<h2 id=\"函数\"><a href=\"#函数\" class=\"headerlink\" title=\"函数\"></a>函数</h2><h3 id=\"函数的特点\"><a href=\"#函数的特点\" class=\"headerlink\" title=\"函数的特点\"></a>函数的特点</h3><ul>\n<li>功能性：一个函数要有明确的功能</li>\n<li>隐藏细节：调用者不需要关注函数的细节</li>\n<li>函数的目的：减少重复代码</li>\n</ul>\n<h3 id=\"Python-中函数的定义\"><a href=\"#Python-中函数的定义\" class=\"headerlink\" title=\"Python 中函数的定义\"></a>Python 中函数的定义</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">funcname</span><span class=\"params\">(parameter_list)</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">pass</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 与Python内置的max函数重名了，会覆盖内置的max函数</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">max</span><span class=\"params\">(a, b)</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> a &gt; b:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> a</span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> b</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">print(max(<span class=\"number\">1</span>, <span class=\"number\">2</span>))</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">func</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    print(<span class=\"string\">'hello world'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">print(func())  <span class=\"comment\"># None，无返回值则默认返回None</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>参数列表可有可无</li>\n<li>函数内可以<code>return value</code>，如果没有 return，则默认返回 None</li>\n<li>函数必须先定义才能使用</li>\n<li>函数名不能与 Python 内置的函数名重名，否则会覆盖内置函数</li>\n</ul>\n<p>Python 中关于递归函数：</p>\n<ul>\n<li>Python 默认的递归次数是有限的</li>\n<li>可以通过<code>sys.setrecursionlimit(10000)</code>方法来修改递归次数</li>\n</ul>\n<p>关于 print 函数：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a = b = c = <span class=\"number\">1</span></span><br><span class=\"line\">print(a, b, c) <span class=\"comment\"># 分别打印a, b, c</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"Python-中函数可以返回多个值\"><a href=\"#Python-中函数可以返回多个值\" class=\"headerlink\" title=\"Python 中函数可以返回多个值\"></a>Python 中函数可以返回多个值</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">func</span><span class=\"params\">(num)</span>:</span></span><br><span class=\"line\">    a = num * <span class=\"number\">2</span></span><br><span class=\"line\">    b = num * <span class=\"number\">3</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> a, b</span><br><span class=\"line\"></span><br><span class=\"line\">ret = func(<span class=\"number\">10</span>)  <span class=\"comment\"># ret是一个元组</span></span><br><span class=\"line\">print(ret)</span><br><span class=\"line\">a, b = func(<span class=\"number\">10</span>)  <span class=\"comment\"># 推荐的做法，序列解包，不要使用元组[序号]</span></span><br><span class=\"line\">print(a, b)</span><br></pre></td></tr></table></figure>\n<h3 id=\"Python-中的序列解包和链式赋值\"><a href=\"#Python-中的序列解包和链式赋值\" class=\"headerlink\" title=\"Python 中的序列解包和链式赋值\"></a>Python 中的序列解包和链式赋值</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a, b, c = <span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span></span><br><span class=\"line\">d = <span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>  <span class=\"comment\"># a是一个元组</span></span><br><span class=\"line\">a, b, c = d  <span class=\"comment\"># 序列解包</span></span><br><span class=\"line\">a = b = c = <span class=\"number\">1</span> <span class=\"comment\"># 链式赋值</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"必须参数和关键字参数\"><a href=\"#必须参数和关键字参数\" class=\"headerlink\" title=\"必须参数和关键字参数\"></a>必须参数和关键字参数</h3><ul>\n<li>必须参数：函数参数列表中定义的，必须传递的参数，如果不传则会编译错误</li>\n<li>关键字参数：明确指定参数的值，可以无视参数的顺序</li>\n<li>如果参数列表中既有必须参数，又有关键字参数，则关键字参数必须位于必须参数之后</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">add</span><span class=\"params\">(num1, num2)</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> num1 + num2</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">ret = add(<span class=\"number\">12</span>, <span class=\"number\">13</span>)  <span class=\"comment\"># 以必须参数的形式调用</span></span><br><span class=\"line\">print(ret)</span><br><span class=\"line\">ret1 = add(num2=<span class=\"number\">13</span>, num1=<span class=\"number\">14</span>)  <span class=\"comment\"># 以关键字参数的形式调用</span></span><br><span class=\"line\">print(ret1)</span><br><span class=\"line\">ret2 = add(<span class=\"number\">14</span>, num2=<span class=\"number\">15</span>)  <span class=\"comment\"># Ok, 关键字参数可以在必须参数之后</span></span><br><span class=\"line\">print(ret2)</span><br><span class=\"line\">ret3 = add(num1=<span class=\"number\">14</span>, <span class=\"number\">15</span>)  <span class=\"comment\"># error，关键字参数不能在必须参数前</span></span><br><span class=\"line\">print(ret3)</span><br></pre></td></tr></table></figure>\n<h3 id=\"默认参数\"><a href=\"#默认参数\" class=\"headerlink\" title=\"默认参数\"></a>默认参数</h3><ul>\n<li>默认参数必须位于参数列表的最后</li>\n<li>默认参数既可以使用关键字参数，也可以使用必须参数，也可以不传</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">add</span><span class=\"params\">(num1, num2, num3=<span class=\"number\">3</span>, num4=<span class=\"number\">4</span>)</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> num1 + num2 + num3 + num4</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">print(add(<span class=\"number\">10</span>, <span class=\"number\">20</span>, <span class=\"number\">30</span>, <span class=\"number\">40</span>))</span><br><span class=\"line\">print(add(<span class=\"number\">10</span>, <span class=\"number\">20</span>, num4=<span class=\"number\">40</span>, num3=<span class=\"number\">30</span>))</span><br><span class=\"line\">print(add(<span class=\"number\">10</span>, <span class=\"number\">20</span>, num4=<span class=\"number\">40</span>))</span><br><span class=\"line\">print(add(<span class=\"number\">10</span>, <span class=\"number\">20</span>, num3=<span class=\"number\">30</span>))</span><br><span class=\"line\">print(add(<span class=\"number\">10</span>, <span class=\"number\">20</span>, <span class=\"number\">30</span>))</span><br><span class=\"line\">print(add(<span class=\"number\">10</span>, <span class=\"number\">20</span>))</span><br><span class=\"line\">print(add(num1=<span class=\"number\">10</span>, num2=<span class=\"number\">20</span>))</span><br><span class=\"line\">print(add(num2=<span class=\"number\">20</span>, num1=<span class=\"number\">10</span>))</span><br></pre></td></tr></table></figure>\n<h3 id=\"可变参数\"><a href=\"#可变参数\" class=\"headerlink\" title=\"可变参数\"></a>可变参数</h3><ul>\n<li>可变参数，给参数名前加一个星号<code>*</code></li>\n<li>传递参数是，可以传一个元组或列表，前面要加一个星号<code>*</code></li>\n<li>可变参数之后可以有关键字参数，但不能有必须参数，必须参数必须位于可变参数之前，默认参数也要使用关键字参数的形式进行调用</li>\n<li>可以参数也可以什么都不传，相当于传一个空的元组</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">fun</span><span class=\"params\">(*param)</span>:</span></span><br><span class=\"line\">    print(param)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">fun(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>)</span><br><span class=\"line\">a = (<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>)</span><br><span class=\"line\">fun(*a)  <span class=\"comment\"># *相当于展开元组内的元素</span></span><br><span class=\"line\">b = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>]</span><br><span class=\"line\">fun(*b)  <span class=\"comment\"># 同上</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">fun1</span><span class=\"params\">(num1, *param)</span>:</span></span><br><span class=\"line\">    print(param)</span><br><span class=\"line\">    print(num1)</span><br><span class=\"line\"></span><br><span class=\"line\">fun1(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>)  <span class=\"comment\"># (2, 3, 4), 1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 可变参数后有关键字参数</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">fun1</span><span class=\"params\">(num1, *param, num2, num3=<span class=\"number\">3</span>)</span>:</span></span><br><span class=\"line\">    print(param)</span><br><span class=\"line\">    print(num1)</span><br><span class=\"line\">    print(num2)</span><br><span class=\"line\">    print(num3)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">fun1(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, num2=<span class=\"number\">13</span>) <span class=\"comment\"># 1, (2, 3, 4), 13, 3</span></span><br><span class=\"line\">fun1(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, num2=<span class=\"number\">13</span>, num3=<span class=\"number\">14</span>) <span class=\"comment\"># 1, (2, 3, 4), 13, 14</span></span><br><span class=\"line\">fun1(<span class=\"number\">1</span>, num2 = <span class=\"number\">13</span>, num3 = <span class=\"number\">14</span>) <span class=\"comment\"># 1, (), 13, 14 可变参数为空元组</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"关键字可变参数\"><a href=\"#关键字可变参数\" class=\"headerlink\" title=\"关键字可变参数\"></a>关键字可变参数</h3><ul>\n<li>参数前加两个星号<code>**</code></li>\n<li>传递参数时需要传一个字典或使用关键字参数进行调用</li>\n<li>可以参数也可以什么都不传，相当于传一个空的字典</li>\n<li>关键字可变参数必须位于参数列表的最后</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">fun</span><span class=\"params\">(**param)</span>:</span></span><br><span class=\"line\">    print(param)  <span class=\"comment\"># param是一个字典</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> key, value <span class=\"keyword\">in</span> param.items():</span><br><span class=\"line\">        print(<span class=\"string\">'key:'</span> + key + <span class=\"string\">', value: '</span> + str(value))</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">fun(num1=<span class=\"number\">1</span>, num2=<span class=\"number\">2</span>, num3=<span class=\"number\">3</span>)</span><br><span class=\"line\">a = &#123;<span class=\"string\">'aa'</span>: <span class=\"number\">1</span>, <span class=\"string\">'bb'</span>: <span class=\"number\">2</span>&#125;</span><br><span class=\"line\">fun(**a)  <span class=\"comment\"># 相当于解包a</span></span><br><span class=\"line\">fun()  <span class=\"comment\"># &#123;&#125; , 可变参数也可以什么都不传，相当于传一个空字典</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">fun</span><span class=\"params\">(num1, **param)</span>:</span></span><br><span class=\"line\">    print(param)  <span class=\"comment\"># param是一个字典</span></span><br><span class=\"line\">    print(num1)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">a = &#123;<span class=\"string\">'a'</span>: <span class=\"number\">1</span>, <span class=\"string\">'b'</span>: <span class=\"number\">2</span>&#125;</span><br><span class=\"line\">fun(<span class=\"number\">1</span>, **a)</span><br></pre></td></tr></table></figure>\n<h3 id=\"变量的作用域\"><a href=\"#变量的作用域\" class=\"headerlink\" title=\"变量的作用域\"></a>变量的作用域</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">c = <span class=\"number\">50</span> <span class=\"comment\"># 全局变量</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">add</span><span class=\"params\">(a, b)</span>:</span></span><br><span class=\"line\">    c = a + b  <span class=\"comment\"># c 相当于一个新的局部变量，覆盖了外部的变量</span></span><br><span class=\"line\">    print(c)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">add(<span class=\"number\">1</span>, <span class=\"number\">2</span>)  <span class=\"comment\"># 3</span></span><br><span class=\"line\">print(c)  <span class=\"comment\"># 50</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">0</span>, <span class=\"number\">9</span>):</span><br><span class=\"line\">    a = <span class=\"number\">12</span></span><br><span class=\"line\">    print(i)</span><br><span class=\"line\">print(a)  <span class=\"comment\"># 循环外部可以引用循环内部的变量，Python没有块级作用域</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"global-关键字\"><a href=\"#global-关键字\" class=\"headerlink\" title=\"global 关键字\"></a>global 关键字</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">fun</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">global</span> a  <span class=\"comment\"># 将a提升为全局作用域，a可以通过import导入其他模块</span></span><br><span class=\"line\">    a = <span class=\"number\">2</span></span><br><span class=\"line\"></span><br><span class=\"line\">fun()</span><br><span class=\"line\">print(a) <span class=\"comment\"># 2</span></span><br><span class=\"line\"></span><br><span class=\"line\">b = <span class=\"number\">12</span> <span class=\"comment\"># 全局作用域</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">fun1</span><span class=\"params\">(num)</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">global</span> b</span><br><span class=\"line\">    b = b + num  <span class=\"comment\"># 修改全局作用域的变量b</span></span><br><span class=\"line\"></span><br><span class=\"line\">fun1(<span class=\"number\">11</span>)</span><br><span class=\"line\">print(b) <span class=\"comment\"># 23</span></span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"函数\"><a href=\"#函数\" class=\"headerlink\" title=\"函数\"></a>函数</h2><h3 id=\"函数的特点\"><a href=\"#函数的特点\" class=\"headerlink\" title=\"函数的特点\"></a>函数的特点</h3><ul>\n<li>功能性：一个函数要有明确的功能</li>\n<li>隐藏细节：调用者不需要关注函数的细节</li>\n<li>函数的目的：减少重复代码</li>\n</ul>\n<h3 id=\"Python-中函数的定义\"><a href=\"#Python-中函数的定义\" class=\"headerlink\" title=\"Python 中函数的定义\"></a>Python 中函数的定义</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">funcname</span><span class=\"params\">(parameter_list)</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">pass</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 与Python内置的max函数重名了，会覆盖内置的max函数</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">max</span><span class=\"params\">(a, b)</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> a &gt; b:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> a</span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> b</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">print(max(<span class=\"number\">1</span>, <span class=\"number\">2</span>))</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">func</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    print(<span class=\"string\">'hello world'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">print(func())  <span class=\"comment\"># None，无返回值则默认返回None</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>参数列表可有可无</li>\n<li>函数内可以<code>return value</code>，如果没有 return，则默认返回 None</li>\n<li>函数必须先定义才能使用</li>\n<li>函数名不能与 Python 内置的函数名重名，否则会覆盖内置函数</li>\n</ul>\n<p>Python 中关于递归函数：</p>\n<ul>\n<li>Python 默认的递归次数是有限的</li>\n<li>可以通过<code>sys.setrecursionlimit(10000)</code>方法来修改递归次数</li>\n</ul>\n<p>关于 print 函数：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a = b = c = <span class=\"number\">1</span></span><br><span class=\"line\">print(a, b, c) <span class=\"comment\"># 分别打印a, b, c</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"Python-中函数可以返回多个值\"><a href=\"#Python-中函数可以返回多个值\" class=\"headerlink\" title=\"Python 中函数可以返回多个值\"></a>Python 中函数可以返回多个值</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">func</span><span class=\"params\">(num)</span>:</span></span><br><span class=\"line\">    a = num * <span class=\"number\">2</span></span><br><span class=\"line\">    b = num * <span class=\"number\">3</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> a, b</span><br><span class=\"line\"></span><br><span class=\"line\">ret = func(<span class=\"number\">10</span>)  <span class=\"comment\"># ret是一个元组</span></span><br><span class=\"line\">print(ret)</span><br><span class=\"line\">a, b = func(<span class=\"number\">10</span>)  <span class=\"comment\"># 推荐的做法，序列解包，不要使用元组[序号]</span></span><br><span class=\"line\">print(a, b)</span><br></pre></td></tr></table></figure>\n<h3 id=\"Python-中的序列解包和链式赋值\"><a href=\"#Python-中的序列解包和链式赋值\" class=\"headerlink\" title=\"Python 中的序列解包和链式赋值\"></a>Python 中的序列解包和链式赋值</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a, b, c = <span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span></span><br><span class=\"line\">d = <span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>  <span class=\"comment\"># a是一个元组</span></span><br><span class=\"line\">a, b, c = d  <span class=\"comment\"># 序列解包</span></span><br><span class=\"line\">a = b = c = <span class=\"number\">1</span> <span class=\"comment\"># 链式赋值</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"必须参数和关键字参数\"><a href=\"#必须参数和关键字参数\" class=\"headerlink\" title=\"必须参数和关键字参数\"></a>必须参数和关键字参数</h3><ul>\n<li>必须参数：函数参数列表中定义的，必须传递的参数，如果不传则会编译错误</li>\n<li>关键字参数：明确指定参数的值，可以无视参数的顺序</li>\n<li>如果参数列表中既有必须参数，又有关键字参数，则关键字参数必须位于必须参数之后</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">add</span><span class=\"params\">(num1, num2)</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> num1 + num2</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">ret = add(<span class=\"number\">12</span>, <span class=\"number\">13</span>)  <span class=\"comment\"># 以必须参数的形式调用</span></span><br><span class=\"line\">print(ret)</span><br><span class=\"line\">ret1 = add(num2=<span class=\"number\">13</span>, num1=<span class=\"number\">14</span>)  <span class=\"comment\"># 以关键字参数的形式调用</span></span><br><span class=\"line\">print(ret1)</span><br><span class=\"line\">ret2 = add(<span class=\"number\">14</span>, num2=<span class=\"number\">15</span>)  <span class=\"comment\"># Ok, 关键字参数可以在必须参数之后</span></span><br><span class=\"line\">print(ret2)</span><br><span class=\"line\">ret3 = add(num1=<span class=\"number\">14</span>, <span class=\"number\">15</span>)  <span class=\"comment\"># error，关键字参数不能在必须参数前</span></span><br><span class=\"line\">print(ret3)</span><br></pre></td></tr></table></figure>\n<h3 id=\"默认参数\"><a href=\"#默认参数\" class=\"headerlink\" title=\"默认参数\"></a>默认参数</h3><ul>\n<li>默认参数必须位于参数列表的最后</li>\n<li>默认参数既可以使用关键字参数，也可以使用必须参数，也可以不传</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">add</span><span class=\"params\">(num1, num2, num3=<span class=\"number\">3</span>, num4=<span class=\"number\">4</span>)</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> num1 + num2 + num3 + num4</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">print(add(<span class=\"number\">10</span>, <span class=\"number\">20</span>, <span class=\"number\">30</span>, <span class=\"number\">40</span>))</span><br><span class=\"line\">print(add(<span class=\"number\">10</span>, <span class=\"number\">20</span>, num4=<span class=\"number\">40</span>, num3=<span class=\"number\">30</span>))</span><br><span class=\"line\">print(add(<span class=\"number\">10</span>, <span class=\"number\">20</span>, num4=<span class=\"number\">40</span>))</span><br><span class=\"line\">print(add(<span class=\"number\">10</span>, <span class=\"number\">20</span>, num3=<span class=\"number\">30</span>))</span><br><span class=\"line\">print(add(<span class=\"number\">10</span>, <span class=\"number\">20</span>, <span class=\"number\">30</span>))</span><br><span class=\"line\">print(add(<span class=\"number\">10</span>, <span class=\"number\">20</span>))</span><br><span class=\"line\">print(add(num1=<span class=\"number\">10</span>, num2=<span class=\"number\">20</span>))</span><br><span class=\"line\">print(add(num2=<span class=\"number\">20</span>, num1=<span class=\"number\">10</span>))</span><br></pre></td></tr></table></figure>\n<h3 id=\"可变参数\"><a href=\"#可变参数\" class=\"headerlink\" title=\"可变参数\"></a>可变参数</h3><ul>\n<li>可变参数，给参数名前加一个星号<code>*</code></li>\n<li>传递参数是，可以传一个元组或列表，前面要加一个星号<code>*</code></li>\n<li>可变参数之后可以有关键字参数，但不能有必须参数，必须参数必须位于可变参数之前，默认参数也要使用关键字参数的形式进行调用</li>\n<li>可以参数也可以什么都不传，相当于传一个空的元组</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">fun</span><span class=\"params\">(*param)</span>:</span></span><br><span class=\"line\">    print(param)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">fun(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>)</span><br><span class=\"line\">a = (<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>)</span><br><span class=\"line\">fun(*a)  <span class=\"comment\"># *相当于展开元组内的元素</span></span><br><span class=\"line\">b = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>]</span><br><span class=\"line\">fun(*b)  <span class=\"comment\"># 同上</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">fun1</span><span class=\"params\">(num1, *param)</span>:</span></span><br><span class=\"line\">    print(param)</span><br><span class=\"line\">    print(num1)</span><br><span class=\"line\"></span><br><span class=\"line\">fun1(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>)  <span class=\"comment\"># (2, 3, 4), 1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 可变参数后有关键字参数</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">fun1</span><span class=\"params\">(num1, *param, num2, num3=<span class=\"number\">3</span>)</span>:</span></span><br><span class=\"line\">    print(param)</span><br><span class=\"line\">    print(num1)</span><br><span class=\"line\">    print(num2)</span><br><span class=\"line\">    print(num3)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">fun1(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, num2=<span class=\"number\">13</span>) <span class=\"comment\"># 1, (2, 3, 4), 13, 3</span></span><br><span class=\"line\">fun1(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, num2=<span class=\"number\">13</span>, num3=<span class=\"number\">14</span>) <span class=\"comment\"># 1, (2, 3, 4), 13, 14</span></span><br><span class=\"line\">fun1(<span class=\"number\">1</span>, num2 = <span class=\"number\">13</span>, num3 = <span class=\"number\">14</span>) <span class=\"comment\"># 1, (), 13, 14 可变参数为空元组</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"关键字可变参数\"><a href=\"#关键字可变参数\" class=\"headerlink\" title=\"关键字可变参数\"></a>关键字可变参数</h3><ul>\n<li>参数前加两个星号<code>**</code></li>\n<li>传递参数时需要传一个字典或使用关键字参数进行调用</li>\n<li>可以参数也可以什么都不传，相当于传一个空的字典</li>\n<li>关键字可变参数必须位于参数列表的最后</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">fun</span><span class=\"params\">(**param)</span>:</span></span><br><span class=\"line\">    print(param)  <span class=\"comment\"># param是一个字典</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> key, value <span class=\"keyword\">in</span> param.items():</span><br><span class=\"line\">        print(<span class=\"string\">'key:'</span> + key + <span class=\"string\">', value: '</span> + str(value))</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">fun(num1=<span class=\"number\">1</span>, num2=<span class=\"number\">2</span>, num3=<span class=\"number\">3</span>)</span><br><span class=\"line\">a = &#123;<span class=\"string\">'aa'</span>: <span class=\"number\">1</span>, <span class=\"string\">'bb'</span>: <span class=\"number\">2</span>&#125;</span><br><span class=\"line\">fun(**a)  <span class=\"comment\"># 相当于解包a</span></span><br><span class=\"line\">fun()  <span class=\"comment\"># &#123;&#125; , 可变参数也可以什么都不传，相当于传一个空字典</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">fun</span><span class=\"params\">(num1, **param)</span>:</span></span><br><span class=\"line\">    print(param)  <span class=\"comment\"># param是一个字典</span></span><br><span class=\"line\">    print(num1)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">a = &#123;<span class=\"string\">'a'</span>: <span class=\"number\">1</span>, <span class=\"string\">'b'</span>: <span class=\"number\">2</span>&#125;</span><br><span class=\"line\">fun(<span class=\"number\">1</span>, **a)</span><br></pre></td></tr></table></figure>\n<h3 id=\"变量的作用域\"><a href=\"#变量的作用域\" class=\"headerlink\" title=\"变量的作用域\"></a>变量的作用域</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">c = <span class=\"number\">50</span> <span class=\"comment\"># 全局变量</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">add</span><span class=\"params\">(a, b)</span>:</span></span><br><span class=\"line\">    c = a + b  <span class=\"comment\"># c 相当于一个新的局部变量，覆盖了外部的变量</span></span><br><span class=\"line\">    print(c)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">add(<span class=\"number\">1</span>, <span class=\"number\">2</span>)  <span class=\"comment\"># 3</span></span><br><span class=\"line\">print(c)  <span class=\"comment\"># 50</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">0</span>, <span class=\"number\">9</span>):</span><br><span class=\"line\">    a = <span class=\"number\">12</span></span><br><span class=\"line\">    print(i)</span><br><span class=\"line\">print(a)  <span class=\"comment\"># 循环外部可以引用循环内部的变量，Python没有块级作用域</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"global-关键字\"><a href=\"#global-关键字\" class=\"headerlink\" title=\"global 关键字\"></a>global 关键字</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">fun</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">global</span> a  <span class=\"comment\"># 将a提升为全局作用域，a可以通过import导入其他模块</span></span><br><span class=\"line\">    a = <span class=\"number\">2</span></span><br><span class=\"line\"></span><br><span class=\"line\">fun()</span><br><span class=\"line\">print(a) <span class=\"comment\"># 2</span></span><br><span class=\"line\"></span><br><span class=\"line\">b = <span class=\"number\">12</span> <span class=\"comment\"># 全局作用域</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">fun1</span><span class=\"params\">(num)</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">global</span> b</span><br><span class=\"line\">    b = b + num  <span class=\"comment\"># 修改全局作用域的变量b</span></span><br><span class=\"line\"></span><br><span class=\"line\">fun1(<span class=\"number\">11</span>)</span><br><span class=\"line\">print(b) <span class=\"comment\"># 23</span></span><br></pre></td></tr></table></figure>\n"},{"title":"Python学习笔记(3)","date":"2018-09-04T13:51:05.000Z","_content":"\n## 面向对象\n\n### 类的定义\n\n- 类的命名规则：首字母大写，驼峰表示法\n- 在另一个模块中实用类：`from package.module import Student`\n\n```python\nclass Student():\n\n    def __init__(self, name, age):\n        self.name = name\n        self.age = age\n\n    def print_file(self):\n        print('name:' + self.name)\n        print('age:' + str(self.age))\n\n\ns = Student(\"ljl\", 12)\ns.print_file()\n\nclass Person:\n    def __init__(self, name, age):\n        self.name = name\n        self.age = age\n\n    def __del__(self):\n        print('Persion is reclaimed')\n\n    def wake_up(self, name):\n        print(\"wake up %s\" % name)\n\np = Person(\"Mars\", 30)\nprint(hasattr(p, 'name'))  # 是否有某个属性\nprint(getattr(p, 'name'))  # 获取属性值\nprint(p.name)\nsetattr(p, 'name', 'ljl')  # 设置属性值\nprint(p.name)\ndel(p.name)  # 删除属性\n# print(p.name)  # Error\np.wake_up('ljl')\nPerson.wake_up(p, 'ljl')  # 另一种调用成员方法的方式\np = None\n```\n\n### 方法与函数的区别\n\n- 方法：是一个面向对象的概念，类中的函数应该称为方法\n- 函数：是一个面向过程的概念\n- 数据成员：对象的特征\n\n### 实例化与构造函数\n\n- 实例化时，构造函数是自动调用，不需要显式调用\n- 显式调用构造函数会返回 None\n- Python 中，一个类只能定义一个构造函数\n\n```python\nclass Student():\n\n    def __init__(self, name, age):\n        self.name = name\n        self.age = age\n\n    def print_file(self):\n        print('name:' + self.name)\n        print('age:' + str(self.age))\n\n\ns = Student(\"ljl\", 12)\ns1 = Student(\"lyb\", 13)\ns.print_file()\ns1.print_file()\n```\n\n### 类变量与实例变量\n\n- 类变量属于类的属性，定义在类内，构造方法外\n- 实例变量属于对象的特征，定义在构造方法内\n\n```python\nclass Student():\n\n    # 类变量\n    count = 1\n\n    def __init__(self, name, age):\n        # name和age都是实例变量\n        self.name = name\n        self.age = age\n\n    def print_file(self):\n        print('name:' + self.name)\n        print('age:' + str(self.age))\n        print('Count: ' + str(Student.count))\n\n    def add(self):\n        Student.count += 1\n\n\ns = Student(\"ljl\", 12)\ns1 = Student(\"lyb\", 13)\ns.add()\ns.print_file()\ns1.add()\ns1.print_file()\n```\n\n- 对象的`__dict__`保存着对象的所有变量以及变量的值\n- python 对象查找实例变量的流程\n  - 现在实例变量的列表中查找，如果找到，则直接返回\n  - 如果没有找到，则会在类变量中查找\n  - 如果类变量没有找到，会到父类中找\n\n```python\nclass Student():\n\n    # 类变量\n    name = \"Class Value\"\n\n    def __init__(self):\n        pass\n\n\ns = Student()\nprint(s.name)  # Class Value, Student并没有定义实例变量name，因此会找到类变量name\n```\n\n### self 与实例方法\n\n- 实例方法第一个参数必须是 self，必须显式声明，调用实例方法时不用传入 self\n- self 只是一个名字，也可以使用其他名字，建议使用 self\n- self 代表当前的实例\n\n```python\nclass Person():\n    def __init__(this, name, age):\n        this.name = name\n        this.age = age\n\n\np = Person('ljl', 12)\nprint(p.name)\n```\n\n### 实例方法中访问实例变量与类变量\n\n- 实例方法中访问实例变量：`self.name`\n- 实例方法中访问类变量：`Student.sum`, `self.__class__.sum`\n\n```python\nclass Student():\n\n    # 类变量\n    sum = 0\n\n    def __init__(self, name, age):\n        self.name = name\n        self.age = age\n        # Student.sum = 12\n        self.__class__.sum += 1\n\n\ns = Student('ljl', 12)\nprint(Student.sum)\ns1 = Student('ljl', 12)\nprint(Student.sum)\ns2 = Student('ljl', 12)\nprint(s2.__class__.sum)\n```\n\n### 类方法\n\n- 类方法中可以操作类变量\n\n```python\nclass Student():\n\n    # 类变量\n    sum = 0\n\n    def __init__(self, name, age):\n        self.name = name\n        self.age = age\n        self.__class__.plus_sum()\n\n    @classmethod\n    def plus_sum(cls):\n        cls.sum += 1\n\n\nStudent.plus_sum()\nStudent.plus_sum()\nStudent.plus_sum()\nStudent.plus_sum()\ns = Student(\"ljl\", 12)\nprint(Student.sum)\ns.__class__.plus_sum()\nprint(Student.sum)\n```\n\n### 静态方法\n\n- 第一个参数不需要指定特定的对象\n- 对象和类都可以调用静态方法\n- 静态方法可以访问类变量: `Student.sum1`\n- 静态方法和类方法都不能直接访问实例变量\n- 静态方法相当于普通的方法，与类和实例没有太大关联\n\n```python\nclass Student():\n    sum = 0\n\n    def __init__(self, name=\"ljl\", age=12):\n        self.name = name\n        self.age = age\n        self.__class__.sum += 1\n\n    @staticmethod\n    def hello_world():\n        print(\"hello world\")\n        print(Student.sum)\n\n\ns = Student()\ns.hello_world()\nStudent.hello_world()\n```\n\n### 成员可见性\n\n- 给变量或实例方法名前加双下划线`__name`，则该方法或变量名是私有的\n- 严格来讲，Python 的类是没有私有变量和私有方法，Python 解释器只是把带双下划线的实例变量和实例方法改了一个名字而已，格式：`_Student__name`，`_Student__private_method`\n\n```python\nclass Student():\n\n    # 类变量\n    sum1 = 0\n\n    def __init__(self, name, age):\n        self.__name = name  # 存储时私有变量的名字为_Student__name\n        self.__age = age\n\n    def get_name(self):\n        return self.__name\n\n    def __private_method(self):\n        print(self.__name)\n\n\ns = Student('ljl', 12)\nprint(s.get_name())\n# s.__private_method()  # error\ns.__name = \"lyb\"  # 添加了一个新的实例变量，而不是原来的实例变量，而且新添加的实例变量不是私有的变量\nprint(s.__name)  # OK\nprint(s.get_name())\ns1 = Student('ljl', 13)\nprint(s1.__name)  # error, s1没有新建实例变量__name\nprint(s1._Student__name)  # ok，可以通过这种方法访问私有变量\n```\n\n- 静态方法和类方法也可以是私有的\n\n```python\nclass Student():\n\n    # 类变量\n    sum1 = 0\n\n    def __init__(self, name, age):\n        self.__name = name  # 存储时私有变量的名字为_Student__name\n        self.__age = age\n\n    def get_name(self):\n        return self.__name\n\n    def __private_method(self):\n        print(self.__name)\n\n    @classmethod\n    def __private_class_method(cls):  # 私有类方法\n        print(cls.sum1)\n\n    @staticmethod\n    def __private_static_method():  # 私有静态方法\n        print(\"hello\")\n\n\nStudent.__private_class_method()  # error\ns = Student('ljl', 12)\ns.__private_static_method()  # error\n```\n\n### 继承\n\n- 继承的目的：避免定义重复变量和方法\n- 子类可以继承父类的类变量，实例变量，构造方法，实例方法，类方法\n- 子类可以定义自己特有的实例变量\n- 可以通过类调用示例方法，但必须传入一个实例对象，`Student.method(s)`，虽然可以这样做，但不推荐这样做\n- 在子类的构造函数中可以调用父类的构造函数\n  - `Human.__init__(self, name, age)`\n  - `super(Student, self).__init__(name, age)`推荐使用这种方法\n- super 也可以用在实例方法中\n\n```python\nclass Human():\n    sum = 0\n\n    def __init__(self, name, age):\n        self.name = name\n        self.age = age\n\n    def get_name(self):\n        print(self.name)\n\n    @classmethod\n    def super_class_method(cls):\n        print('super class mthod')\n\n    def do_homework(self):\n        print('do home')\n\n\nclass Student(Human):\n    def __init__(self, school, name, age):\n        self.school = school\n        # Human.__init__(self, name, age)  # 这里不能缺少self\n        super(Student, self).__init__(name, age)\n\n    def do_homework(self):\n        super(Student, self).do_homework()\n        print('do a lot home')\n\n\ns = Student('school', 'ljl', '12')\n\nStudent.super_class_method()\nprint(s.name)\nprint(s.age)\ns.do_homework()\nprint(issubclass(Student, Human)) # 判断Student是否是Human的子类\npritn(isinstance(s, Student)) # True\npritn(isinstance(s, Human)) # True\n```\n","source":"_posts/2018-09-04-Python学习笔记-3.md","raw":"---\ntitle: Python学习笔记(3)\ncategories: Python\ntags:\n  - Python\ndate: 2018-09-04 21:51:05\n---\n\n## 面向对象\n\n### 类的定义\n\n- 类的命名规则：首字母大写，驼峰表示法\n- 在另一个模块中实用类：`from package.module import Student`\n\n```python\nclass Student():\n\n    def __init__(self, name, age):\n        self.name = name\n        self.age = age\n\n    def print_file(self):\n        print('name:' + self.name)\n        print('age:' + str(self.age))\n\n\ns = Student(\"ljl\", 12)\ns.print_file()\n\nclass Person:\n    def __init__(self, name, age):\n        self.name = name\n        self.age = age\n\n    def __del__(self):\n        print('Persion is reclaimed')\n\n    def wake_up(self, name):\n        print(\"wake up %s\" % name)\n\np = Person(\"Mars\", 30)\nprint(hasattr(p, 'name'))  # 是否有某个属性\nprint(getattr(p, 'name'))  # 获取属性值\nprint(p.name)\nsetattr(p, 'name', 'ljl')  # 设置属性值\nprint(p.name)\ndel(p.name)  # 删除属性\n# print(p.name)  # Error\np.wake_up('ljl')\nPerson.wake_up(p, 'ljl')  # 另一种调用成员方法的方式\np = None\n```\n\n### 方法与函数的区别\n\n- 方法：是一个面向对象的概念，类中的函数应该称为方法\n- 函数：是一个面向过程的概念\n- 数据成员：对象的特征\n\n### 实例化与构造函数\n\n- 实例化时，构造函数是自动调用，不需要显式调用\n- 显式调用构造函数会返回 None\n- Python 中，一个类只能定义一个构造函数\n\n```python\nclass Student():\n\n    def __init__(self, name, age):\n        self.name = name\n        self.age = age\n\n    def print_file(self):\n        print('name:' + self.name)\n        print('age:' + str(self.age))\n\n\ns = Student(\"ljl\", 12)\ns1 = Student(\"lyb\", 13)\ns.print_file()\ns1.print_file()\n```\n\n### 类变量与实例变量\n\n- 类变量属于类的属性，定义在类内，构造方法外\n- 实例变量属于对象的特征，定义在构造方法内\n\n```python\nclass Student():\n\n    # 类变量\n    count = 1\n\n    def __init__(self, name, age):\n        # name和age都是实例变量\n        self.name = name\n        self.age = age\n\n    def print_file(self):\n        print('name:' + self.name)\n        print('age:' + str(self.age))\n        print('Count: ' + str(Student.count))\n\n    def add(self):\n        Student.count += 1\n\n\ns = Student(\"ljl\", 12)\ns1 = Student(\"lyb\", 13)\ns.add()\ns.print_file()\ns1.add()\ns1.print_file()\n```\n\n- 对象的`__dict__`保存着对象的所有变量以及变量的值\n- python 对象查找实例变量的流程\n  - 现在实例变量的列表中查找，如果找到，则直接返回\n  - 如果没有找到，则会在类变量中查找\n  - 如果类变量没有找到，会到父类中找\n\n```python\nclass Student():\n\n    # 类变量\n    name = \"Class Value\"\n\n    def __init__(self):\n        pass\n\n\ns = Student()\nprint(s.name)  # Class Value, Student并没有定义实例变量name，因此会找到类变量name\n```\n\n### self 与实例方法\n\n- 实例方法第一个参数必须是 self，必须显式声明，调用实例方法时不用传入 self\n- self 只是一个名字，也可以使用其他名字，建议使用 self\n- self 代表当前的实例\n\n```python\nclass Person():\n    def __init__(this, name, age):\n        this.name = name\n        this.age = age\n\n\np = Person('ljl', 12)\nprint(p.name)\n```\n\n### 实例方法中访问实例变量与类变量\n\n- 实例方法中访问实例变量：`self.name`\n- 实例方法中访问类变量：`Student.sum`, `self.__class__.sum`\n\n```python\nclass Student():\n\n    # 类变量\n    sum = 0\n\n    def __init__(self, name, age):\n        self.name = name\n        self.age = age\n        # Student.sum = 12\n        self.__class__.sum += 1\n\n\ns = Student('ljl', 12)\nprint(Student.sum)\ns1 = Student('ljl', 12)\nprint(Student.sum)\ns2 = Student('ljl', 12)\nprint(s2.__class__.sum)\n```\n\n### 类方法\n\n- 类方法中可以操作类变量\n\n```python\nclass Student():\n\n    # 类变量\n    sum = 0\n\n    def __init__(self, name, age):\n        self.name = name\n        self.age = age\n        self.__class__.plus_sum()\n\n    @classmethod\n    def plus_sum(cls):\n        cls.sum += 1\n\n\nStudent.plus_sum()\nStudent.plus_sum()\nStudent.plus_sum()\nStudent.plus_sum()\ns = Student(\"ljl\", 12)\nprint(Student.sum)\ns.__class__.plus_sum()\nprint(Student.sum)\n```\n\n### 静态方法\n\n- 第一个参数不需要指定特定的对象\n- 对象和类都可以调用静态方法\n- 静态方法可以访问类变量: `Student.sum1`\n- 静态方法和类方法都不能直接访问实例变量\n- 静态方法相当于普通的方法，与类和实例没有太大关联\n\n```python\nclass Student():\n    sum = 0\n\n    def __init__(self, name=\"ljl\", age=12):\n        self.name = name\n        self.age = age\n        self.__class__.sum += 1\n\n    @staticmethod\n    def hello_world():\n        print(\"hello world\")\n        print(Student.sum)\n\n\ns = Student()\ns.hello_world()\nStudent.hello_world()\n```\n\n### 成员可见性\n\n- 给变量或实例方法名前加双下划线`__name`，则该方法或变量名是私有的\n- 严格来讲，Python 的类是没有私有变量和私有方法，Python 解释器只是把带双下划线的实例变量和实例方法改了一个名字而已，格式：`_Student__name`，`_Student__private_method`\n\n```python\nclass Student():\n\n    # 类变量\n    sum1 = 0\n\n    def __init__(self, name, age):\n        self.__name = name  # 存储时私有变量的名字为_Student__name\n        self.__age = age\n\n    def get_name(self):\n        return self.__name\n\n    def __private_method(self):\n        print(self.__name)\n\n\ns = Student('ljl', 12)\nprint(s.get_name())\n# s.__private_method()  # error\ns.__name = \"lyb\"  # 添加了一个新的实例变量，而不是原来的实例变量，而且新添加的实例变量不是私有的变量\nprint(s.__name)  # OK\nprint(s.get_name())\ns1 = Student('ljl', 13)\nprint(s1.__name)  # error, s1没有新建实例变量__name\nprint(s1._Student__name)  # ok，可以通过这种方法访问私有变量\n```\n\n- 静态方法和类方法也可以是私有的\n\n```python\nclass Student():\n\n    # 类变量\n    sum1 = 0\n\n    def __init__(self, name, age):\n        self.__name = name  # 存储时私有变量的名字为_Student__name\n        self.__age = age\n\n    def get_name(self):\n        return self.__name\n\n    def __private_method(self):\n        print(self.__name)\n\n    @classmethod\n    def __private_class_method(cls):  # 私有类方法\n        print(cls.sum1)\n\n    @staticmethod\n    def __private_static_method():  # 私有静态方法\n        print(\"hello\")\n\n\nStudent.__private_class_method()  # error\ns = Student('ljl', 12)\ns.__private_static_method()  # error\n```\n\n### 继承\n\n- 继承的目的：避免定义重复变量和方法\n- 子类可以继承父类的类变量，实例变量，构造方法，实例方法，类方法\n- 子类可以定义自己特有的实例变量\n- 可以通过类调用示例方法，但必须传入一个实例对象，`Student.method(s)`，虽然可以这样做，但不推荐这样做\n- 在子类的构造函数中可以调用父类的构造函数\n  - `Human.__init__(self, name, age)`\n  - `super(Student, self).__init__(name, age)`推荐使用这种方法\n- super 也可以用在实例方法中\n\n```python\nclass Human():\n    sum = 0\n\n    def __init__(self, name, age):\n        self.name = name\n        self.age = age\n\n    def get_name(self):\n        print(self.name)\n\n    @classmethod\n    def super_class_method(cls):\n        print('super class mthod')\n\n    def do_homework(self):\n        print('do home')\n\n\nclass Student(Human):\n    def __init__(self, school, name, age):\n        self.school = school\n        # Human.__init__(self, name, age)  # 这里不能缺少self\n        super(Student, self).__init__(name, age)\n\n    def do_homework(self):\n        super(Student, self).do_homework()\n        print('do a lot home')\n\n\ns = Student('school', 'ljl', '12')\n\nStudent.super_class_method()\nprint(s.name)\nprint(s.age)\ns.do_homework()\nprint(issubclass(Student, Human)) # 判断Student是否是Human的子类\npritn(isinstance(s, Student)) # True\npritn(isinstance(s, Human)) # True\n```\n","slug":"Python学习笔记-3","published":1,"updated":"2018-10-01T03:40:37.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjutyfmge004ec4c97yd9mrm5","content":"<h2 id=\"面向对象\"><a href=\"#面向对象\" class=\"headerlink\" title=\"面向对象\"></a>面向对象</h2><h3 id=\"类的定义\"><a href=\"#类的定义\" class=\"headerlink\" title=\"类的定义\"></a>类的定义</h3><ul>\n<li>类的命名规则：首字母大写，驼峰表示法</li>\n<li>在另一个模块中实用类：<code>from package.module import Student</code></li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Student</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span><span class=\"params\">(self, name, age)</span>:</span></span><br><span class=\"line\">        self.name = name</span><br><span class=\"line\">        self.age = age</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">print_file</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">        print(<span class=\"string\">'name:'</span> + self.name)</span><br><span class=\"line\">        print(<span class=\"string\">'age:'</span> + str(self.age))</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">s = Student(<span class=\"string\">\"ljl\"</span>, <span class=\"number\">12</span>)</span><br><span class=\"line\">s.print_file()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span><span class=\"params\">(self, name, age)</span>:</span></span><br><span class=\"line\">        self.name = name</span><br><span class=\"line\">        self.age = age</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__del__</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">        print(<span class=\"string\">'Persion is reclaimed'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">wake_up</span><span class=\"params\">(self, name)</span>:</span></span><br><span class=\"line\">        print(<span class=\"string\">\"wake up %s\"</span> % name)</span><br><span class=\"line\"></span><br><span class=\"line\">p = Person(<span class=\"string\">\"Mars\"</span>, <span class=\"number\">30</span>)</span><br><span class=\"line\">print(hasattr(p, <span class=\"string\">'name'</span>))  <span class=\"comment\"># 是否有某个属性</span></span><br><span class=\"line\">print(getattr(p, <span class=\"string\">'name'</span>))  <span class=\"comment\"># 获取属性值</span></span><br><span class=\"line\">print(p.name)</span><br><span class=\"line\">setattr(p, <span class=\"string\">'name'</span>, <span class=\"string\">'ljl'</span>)  <span class=\"comment\"># 设置属性值</span></span><br><span class=\"line\">print(p.name)</span><br><span class=\"line\"><span class=\"keyword\">del</span>(p.name)  <span class=\"comment\"># 删除属性</span></span><br><span class=\"line\"><span class=\"comment\"># print(p.name)  # Error</span></span><br><span class=\"line\">p.wake_up(<span class=\"string\">'ljl'</span>)</span><br><span class=\"line\">Person.wake_up(p, <span class=\"string\">'ljl'</span>)  <span class=\"comment\"># 另一种调用成员方法的方式</span></span><br><span class=\"line\">p = <span class=\"keyword\">None</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"方法与函数的区别\"><a href=\"#方法与函数的区别\" class=\"headerlink\" title=\"方法与函数的区别\"></a>方法与函数的区别</h3><ul>\n<li>方法：是一个面向对象的概念，类中的函数应该称为方法</li>\n<li>函数：是一个面向过程的概念</li>\n<li>数据成员：对象的特征</li>\n</ul>\n<h3 id=\"实例化与构造函数\"><a href=\"#实例化与构造函数\" class=\"headerlink\" title=\"实例化与构造函数\"></a>实例化与构造函数</h3><ul>\n<li>实例化时，构造函数是自动调用，不需要显式调用</li>\n<li>显式调用构造函数会返回 None</li>\n<li>Python 中，一个类只能定义一个构造函数</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Student</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span><span class=\"params\">(self, name, age)</span>:</span></span><br><span class=\"line\">        self.name = name</span><br><span class=\"line\">        self.age = age</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">print_file</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">        print(<span class=\"string\">'name:'</span> + self.name)</span><br><span class=\"line\">        print(<span class=\"string\">'age:'</span> + str(self.age))</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">s = Student(<span class=\"string\">\"ljl\"</span>, <span class=\"number\">12</span>)</span><br><span class=\"line\">s1 = Student(<span class=\"string\">\"lyb\"</span>, <span class=\"number\">13</span>)</span><br><span class=\"line\">s.print_file()</span><br><span class=\"line\">s1.print_file()</span><br></pre></td></tr></table></figure>\n<h3 id=\"类变量与实例变量\"><a href=\"#类变量与实例变量\" class=\"headerlink\" title=\"类变量与实例变量\"></a>类变量与实例变量</h3><ul>\n<li>类变量属于类的属性，定义在类内，构造方法外</li>\n<li>实例变量属于对象的特征，定义在构造方法内</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Student</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 类变量</span></span><br><span class=\"line\">    count = <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span><span class=\"params\">(self, name, age)</span>:</span></span><br><span class=\"line\">        <span class=\"comment\"># name和age都是实例变量</span></span><br><span class=\"line\">        self.name = name</span><br><span class=\"line\">        self.age = age</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">print_file</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">        print(<span class=\"string\">'name:'</span> + self.name)</span><br><span class=\"line\">        print(<span class=\"string\">'age:'</span> + str(self.age))</span><br><span class=\"line\">        print(<span class=\"string\">'Count: '</span> + str(Student.count))</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">add</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">        Student.count += <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">s = Student(<span class=\"string\">\"ljl\"</span>, <span class=\"number\">12</span>)</span><br><span class=\"line\">s1 = Student(<span class=\"string\">\"lyb\"</span>, <span class=\"number\">13</span>)</span><br><span class=\"line\">s.add()</span><br><span class=\"line\">s.print_file()</span><br><span class=\"line\">s1.add()</span><br><span class=\"line\">s1.print_file()</span><br></pre></td></tr></table></figure>\n<ul>\n<li>对象的<code>__dict__</code>保存着对象的所有变量以及变量的值</li>\n<li>python 对象查找实例变量的流程<ul>\n<li>现在实例变量的列表中查找，如果找到，则直接返回</li>\n<li>如果没有找到，则会在类变量中查找</li>\n<li>如果类变量没有找到，会到父类中找</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Student</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 类变量</span></span><br><span class=\"line\">    name = <span class=\"string\">\"Class Value\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">        <span class=\"keyword\">pass</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">s = Student()</span><br><span class=\"line\">print(s.name)  <span class=\"comment\"># Class Value, Student并没有定义实例变量name，因此会找到类变量name</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"self-与实例方法\"><a href=\"#self-与实例方法\" class=\"headerlink\" title=\"self 与实例方法\"></a>self 与实例方法</h3><ul>\n<li>实例方法第一个参数必须是 self，必须显式声明，调用实例方法时不用传入 self</li>\n<li>self 只是一个名字，也可以使用其他名字，建议使用 self</li>\n<li>self 代表当前的实例</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span><span class=\"params\">(this, name, age)</span>:</span></span><br><span class=\"line\">        this.name = name</span><br><span class=\"line\">        this.age = age</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">p = Person(<span class=\"string\">'ljl'</span>, <span class=\"number\">12</span>)</span><br><span class=\"line\">print(p.name)</span><br></pre></td></tr></table></figure>\n<h3 id=\"实例方法中访问实例变量与类变量\"><a href=\"#实例方法中访问实例变量与类变量\" class=\"headerlink\" title=\"实例方法中访问实例变量与类变量\"></a>实例方法中访问实例变量与类变量</h3><ul>\n<li>实例方法中访问实例变量：<code>self.name</code></li>\n<li>实例方法中访问类变量：<code>Student.sum</code>, <code>self.__class__.sum</code></li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Student</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 类变量</span></span><br><span class=\"line\">    sum = <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span><span class=\"params\">(self, name, age)</span>:</span></span><br><span class=\"line\">        self.name = name</span><br><span class=\"line\">        self.age = age</span><br><span class=\"line\">        <span class=\"comment\"># Student.sum = 12</span></span><br><span class=\"line\">        self.__class__.sum += <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">s = Student(<span class=\"string\">'ljl'</span>, <span class=\"number\">12</span>)</span><br><span class=\"line\">print(Student.sum)</span><br><span class=\"line\">s1 = Student(<span class=\"string\">'ljl'</span>, <span class=\"number\">12</span>)</span><br><span class=\"line\">print(Student.sum)</span><br><span class=\"line\">s2 = Student(<span class=\"string\">'ljl'</span>, <span class=\"number\">12</span>)</span><br><span class=\"line\">print(s2.__class__.sum)</span><br></pre></td></tr></table></figure>\n<h3 id=\"类方法\"><a href=\"#类方法\" class=\"headerlink\" title=\"类方法\"></a>类方法</h3><ul>\n<li>类方法中可以操作类变量</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Student</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 类变量</span></span><br><span class=\"line\">    sum = <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span><span class=\"params\">(self, name, age)</span>:</span></span><br><span class=\"line\">        self.name = name</span><br><span class=\"line\">        self.age = age</span><br><span class=\"line\">        self.__class__.plus_sum()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">    @classmethod</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">plus_sum</span><span class=\"params\">(cls)</span>:</span></span><br><span class=\"line\">        cls.sum += <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Student.plus_sum()</span><br><span class=\"line\">Student.plus_sum()</span><br><span class=\"line\">Student.plus_sum()</span><br><span class=\"line\">Student.plus_sum()</span><br><span class=\"line\">s = Student(<span class=\"string\">\"ljl\"</span>, <span class=\"number\">12</span>)</span><br><span class=\"line\">print(Student.sum)</span><br><span class=\"line\">s.__class__.plus_sum()</span><br><span class=\"line\">print(Student.sum)</span><br></pre></td></tr></table></figure>\n<h3 id=\"静态方法\"><a href=\"#静态方法\" class=\"headerlink\" title=\"静态方法\"></a>静态方法</h3><ul>\n<li>第一个参数不需要指定特定的对象</li>\n<li>对象和类都可以调用静态方法</li>\n<li>静态方法可以访问类变量: <code>Student.sum1</code></li>\n<li>静态方法和类方法都不能直接访问实例变量</li>\n<li>静态方法相当于普通的方法，与类和实例没有太大关联</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Student</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    sum = <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span><span class=\"params\">(self, name=<span class=\"string\">\"ljl\"</span>, age=<span class=\"number\">12</span>)</span>:</span></span><br><span class=\"line\">        self.name = name</span><br><span class=\"line\">        self.age = age</span><br><span class=\"line\">        self.__class__.sum += <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">    @staticmethod</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">hello_world</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">        print(<span class=\"string\">\"hello world\"</span>)</span><br><span class=\"line\">        print(Student.sum)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">s = Student()</span><br><span class=\"line\">s.hello_world()</span><br><span class=\"line\">Student.hello_world()</span><br></pre></td></tr></table></figure>\n<h3 id=\"成员可见性\"><a href=\"#成员可见性\" class=\"headerlink\" title=\"成员可见性\"></a>成员可见性</h3><ul>\n<li>给变量或实例方法名前加双下划线<code>__name</code>，则该方法或变量名是私有的</li>\n<li>严格来讲，Python 的类是没有私有变量和私有方法，Python 解释器只是把带双下划线的实例变量和实例方法改了一个名字而已，格式：<code>_Student__name</code>，<code>_Student__private_method</code></li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Student</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 类变量</span></span><br><span class=\"line\">    sum1 = <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span><span class=\"params\">(self, name, age)</span>:</span></span><br><span class=\"line\">        self.__name = name  <span class=\"comment\"># 存储时私有变量的名字为_Student__name</span></span><br><span class=\"line\">        self.__age = age</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_name</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> self.__name</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__private_method</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">        print(self.__name)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">s = Student(<span class=\"string\">'ljl'</span>, <span class=\"number\">12</span>)</span><br><span class=\"line\">print(s.get_name())</span><br><span class=\"line\"><span class=\"comment\"># s.__private_method()  # error</span></span><br><span class=\"line\">s.__name = <span class=\"string\">\"lyb\"</span>  <span class=\"comment\"># 添加了一个新的实例变量，而不是原来的实例变量，而且新添加的实例变量不是私有的变量</span></span><br><span class=\"line\">print(s.__name)  <span class=\"comment\"># OK</span></span><br><span class=\"line\">print(s.get_name())</span><br><span class=\"line\">s1 = Student(<span class=\"string\">'ljl'</span>, <span class=\"number\">13</span>)</span><br><span class=\"line\">print(s1.__name)  <span class=\"comment\"># error, s1没有新建实例变量__name</span></span><br><span class=\"line\">print(s1._Student__name)  <span class=\"comment\"># ok，可以通过这种方法访问私有变量</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>静态方法和类方法也可以是私有的</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Student</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 类变量</span></span><br><span class=\"line\">    sum1 = <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span><span class=\"params\">(self, name, age)</span>:</span></span><br><span class=\"line\">        self.__name = name  <span class=\"comment\"># 存储时私有变量的名字为_Student__name</span></span><br><span class=\"line\">        self.__age = age</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_name</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> self.__name</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__private_method</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">        print(self.__name)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">    @classmethod</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__private_class_method</span><span class=\"params\">(cls)</span>:</span>  <span class=\"comment\"># 私有类方法</span></span><br><span class=\"line\">        print(cls.sum1)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">    @staticmethod</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__private_static_method</span><span class=\"params\">()</span>:</span>  <span class=\"comment\"># 私有静态方法</span></span><br><span class=\"line\">        print(<span class=\"string\">\"hello\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Student.__private_class_method()  <span class=\"comment\"># error</span></span><br><span class=\"line\">s = Student(<span class=\"string\">'ljl'</span>, <span class=\"number\">12</span>)</span><br><span class=\"line\">s.__private_static_method()  <span class=\"comment\"># error</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"继承\"><a href=\"#继承\" class=\"headerlink\" title=\"继承\"></a>继承</h3><ul>\n<li>继承的目的：避免定义重复变量和方法</li>\n<li>子类可以继承父类的类变量，实例变量，构造方法，实例方法，类方法</li>\n<li>子类可以定义自己特有的实例变量</li>\n<li>可以通过类调用示例方法，但必须传入一个实例对象，<code>Student.method(s)</code>，虽然可以这样做，但不推荐这样做</li>\n<li>在子类的构造函数中可以调用父类的构造函数<ul>\n<li><code>Human.__init__(self, name, age)</code></li>\n<li><code>super(Student, self).__init__(name, age)</code>推荐使用这种方法</li>\n</ul>\n</li>\n<li>super 也可以用在实例方法中</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Human</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    sum = <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span><span class=\"params\">(self, name, age)</span>:</span></span><br><span class=\"line\">        self.name = name</span><br><span class=\"line\">        self.age = age</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_name</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">        print(self.name)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">    @classmethod</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">super_class_method</span><span class=\"params\">(cls)</span>:</span></span><br><span class=\"line\">        print(<span class=\"string\">'super class mthod'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">do_homework</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">        print(<span class=\"string\">'do home'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Student</span><span class=\"params\">(Human)</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span><span class=\"params\">(self, school, name, age)</span>:</span></span><br><span class=\"line\">        self.school = school</span><br><span class=\"line\">        <span class=\"comment\"># Human.__init__(self, name, age)  # 这里不能缺少self</span></span><br><span class=\"line\">        super(Student, self).__init__(name, age)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">do_homework</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">        super(Student, self).do_homework()</span><br><span class=\"line\">        print(<span class=\"string\">'do a lot home'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">s = Student(<span class=\"string\">'school'</span>, <span class=\"string\">'ljl'</span>, <span class=\"string\">'12'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">Student.super_class_method()</span><br><span class=\"line\">print(s.name)</span><br><span class=\"line\">print(s.age)</span><br><span class=\"line\">s.do_homework()</span><br><span class=\"line\">print(issubclass(Student, Human)) <span class=\"comment\"># 判断Student是否是Human的子类</span></span><br><span class=\"line\">pritn(isinstance(s, Student)) <span class=\"comment\"># True</span></span><br><span class=\"line\">pritn(isinstance(s, Human)) <span class=\"comment\"># True</span></span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"面向对象\"><a href=\"#面向对象\" class=\"headerlink\" title=\"面向对象\"></a>面向对象</h2><h3 id=\"类的定义\"><a href=\"#类的定义\" class=\"headerlink\" title=\"类的定义\"></a>类的定义</h3><ul>\n<li>类的命名规则：首字母大写，驼峰表示法</li>\n<li>在另一个模块中实用类：<code>from package.module import Student</code></li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Student</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span><span class=\"params\">(self, name, age)</span>:</span></span><br><span class=\"line\">        self.name = name</span><br><span class=\"line\">        self.age = age</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">print_file</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">        print(<span class=\"string\">'name:'</span> + self.name)</span><br><span class=\"line\">        print(<span class=\"string\">'age:'</span> + str(self.age))</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">s = Student(<span class=\"string\">\"ljl\"</span>, <span class=\"number\">12</span>)</span><br><span class=\"line\">s.print_file()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span><span class=\"params\">(self, name, age)</span>:</span></span><br><span class=\"line\">        self.name = name</span><br><span class=\"line\">        self.age = age</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__del__</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">        print(<span class=\"string\">'Persion is reclaimed'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">wake_up</span><span class=\"params\">(self, name)</span>:</span></span><br><span class=\"line\">        print(<span class=\"string\">\"wake up %s\"</span> % name)</span><br><span class=\"line\"></span><br><span class=\"line\">p = Person(<span class=\"string\">\"Mars\"</span>, <span class=\"number\">30</span>)</span><br><span class=\"line\">print(hasattr(p, <span class=\"string\">'name'</span>))  <span class=\"comment\"># 是否有某个属性</span></span><br><span class=\"line\">print(getattr(p, <span class=\"string\">'name'</span>))  <span class=\"comment\"># 获取属性值</span></span><br><span class=\"line\">print(p.name)</span><br><span class=\"line\">setattr(p, <span class=\"string\">'name'</span>, <span class=\"string\">'ljl'</span>)  <span class=\"comment\"># 设置属性值</span></span><br><span class=\"line\">print(p.name)</span><br><span class=\"line\"><span class=\"keyword\">del</span>(p.name)  <span class=\"comment\"># 删除属性</span></span><br><span class=\"line\"><span class=\"comment\"># print(p.name)  # Error</span></span><br><span class=\"line\">p.wake_up(<span class=\"string\">'ljl'</span>)</span><br><span class=\"line\">Person.wake_up(p, <span class=\"string\">'ljl'</span>)  <span class=\"comment\"># 另一种调用成员方法的方式</span></span><br><span class=\"line\">p = <span class=\"keyword\">None</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"方法与函数的区别\"><a href=\"#方法与函数的区别\" class=\"headerlink\" title=\"方法与函数的区别\"></a>方法与函数的区别</h3><ul>\n<li>方法：是一个面向对象的概念，类中的函数应该称为方法</li>\n<li>函数：是一个面向过程的概念</li>\n<li>数据成员：对象的特征</li>\n</ul>\n<h3 id=\"实例化与构造函数\"><a href=\"#实例化与构造函数\" class=\"headerlink\" title=\"实例化与构造函数\"></a>实例化与构造函数</h3><ul>\n<li>实例化时，构造函数是自动调用，不需要显式调用</li>\n<li>显式调用构造函数会返回 None</li>\n<li>Python 中，一个类只能定义一个构造函数</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Student</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span><span class=\"params\">(self, name, age)</span>:</span></span><br><span class=\"line\">        self.name = name</span><br><span class=\"line\">        self.age = age</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">print_file</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">        print(<span class=\"string\">'name:'</span> + self.name)</span><br><span class=\"line\">        print(<span class=\"string\">'age:'</span> + str(self.age))</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">s = Student(<span class=\"string\">\"ljl\"</span>, <span class=\"number\">12</span>)</span><br><span class=\"line\">s1 = Student(<span class=\"string\">\"lyb\"</span>, <span class=\"number\">13</span>)</span><br><span class=\"line\">s.print_file()</span><br><span class=\"line\">s1.print_file()</span><br></pre></td></tr></table></figure>\n<h3 id=\"类变量与实例变量\"><a href=\"#类变量与实例变量\" class=\"headerlink\" title=\"类变量与实例变量\"></a>类变量与实例变量</h3><ul>\n<li>类变量属于类的属性，定义在类内，构造方法外</li>\n<li>实例变量属于对象的特征，定义在构造方法内</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Student</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 类变量</span></span><br><span class=\"line\">    count = <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span><span class=\"params\">(self, name, age)</span>:</span></span><br><span class=\"line\">        <span class=\"comment\"># name和age都是实例变量</span></span><br><span class=\"line\">        self.name = name</span><br><span class=\"line\">        self.age = age</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">print_file</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">        print(<span class=\"string\">'name:'</span> + self.name)</span><br><span class=\"line\">        print(<span class=\"string\">'age:'</span> + str(self.age))</span><br><span class=\"line\">        print(<span class=\"string\">'Count: '</span> + str(Student.count))</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">add</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">        Student.count += <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">s = Student(<span class=\"string\">\"ljl\"</span>, <span class=\"number\">12</span>)</span><br><span class=\"line\">s1 = Student(<span class=\"string\">\"lyb\"</span>, <span class=\"number\">13</span>)</span><br><span class=\"line\">s.add()</span><br><span class=\"line\">s.print_file()</span><br><span class=\"line\">s1.add()</span><br><span class=\"line\">s1.print_file()</span><br></pre></td></tr></table></figure>\n<ul>\n<li>对象的<code>__dict__</code>保存着对象的所有变量以及变量的值</li>\n<li>python 对象查找实例变量的流程<ul>\n<li>现在实例变量的列表中查找，如果找到，则直接返回</li>\n<li>如果没有找到，则会在类变量中查找</li>\n<li>如果类变量没有找到，会到父类中找</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Student</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 类变量</span></span><br><span class=\"line\">    name = <span class=\"string\">\"Class Value\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">        <span class=\"keyword\">pass</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">s = Student()</span><br><span class=\"line\">print(s.name)  <span class=\"comment\"># Class Value, Student并没有定义实例变量name，因此会找到类变量name</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"self-与实例方法\"><a href=\"#self-与实例方法\" class=\"headerlink\" title=\"self 与实例方法\"></a>self 与实例方法</h3><ul>\n<li>实例方法第一个参数必须是 self，必须显式声明，调用实例方法时不用传入 self</li>\n<li>self 只是一个名字，也可以使用其他名字，建议使用 self</li>\n<li>self 代表当前的实例</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span><span class=\"params\">(this, name, age)</span>:</span></span><br><span class=\"line\">        this.name = name</span><br><span class=\"line\">        this.age = age</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">p = Person(<span class=\"string\">'ljl'</span>, <span class=\"number\">12</span>)</span><br><span class=\"line\">print(p.name)</span><br></pre></td></tr></table></figure>\n<h3 id=\"实例方法中访问实例变量与类变量\"><a href=\"#实例方法中访问实例变量与类变量\" class=\"headerlink\" title=\"实例方法中访问实例变量与类变量\"></a>实例方法中访问实例变量与类变量</h3><ul>\n<li>实例方法中访问实例变量：<code>self.name</code></li>\n<li>实例方法中访问类变量：<code>Student.sum</code>, <code>self.__class__.sum</code></li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Student</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 类变量</span></span><br><span class=\"line\">    sum = <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span><span class=\"params\">(self, name, age)</span>:</span></span><br><span class=\"line\">        self.name = name</span><br><span class=\"line\">        self.age = age</span><br><span class=\"line\">        <span class=\"comment\"># Student.sum = 12</span></span><br><span class=\"line\">        self.__class__.sum += <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">s = Student(<span class=\"string\">'ljl'</span>, <span class=\"number\">12</span>)</span><br><span class=\"line\">print(Student.sum)</span><br><span class=\"line\">s1 = Student(<span class=\"string\">'ljl'</span>, <span class=\"number\">12</span>)</span><br><span class=\"line\">print(Student.sum)</span><br><span class=\"line\">s2 = Student(<span class=\"string\">'ljl'</span>, <span class=\"number\">12</span>)</span><br><span class=\"line\">print(s2.__class__.sum)</span><br></pre></td></tr></table></figure>\n<h3 id=\"类方法\"><a href=\"#类方法\" class=\"headerlink\" title=\"类方法\"></a>类方法</h3><ul>\n<li>类方法中可以操作类变量</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Student</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 类变量</span></span><br><span class=\"line\">    sum = <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span><span class=\"params\">(self, name, age)</span>:</span></span><br><span class=\"line\">        self.name = name</span><br><span class=\"line\">        self.age = age</span><br><span class=\"line\">        self.__class__.plus_sum()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">    @classmethod</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">plus_sum</span><span class=\"params\">(cls)</span>:</span></span><br><span class=\"line\">        cls.sum += <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Student.plus_sum()</span><br><span class=\"line\">Student.plus_sum()</span><br><span class=\"line\">Student.plus_sum()</span><br><span class=\"line\">Student.plus_sum()</span><br><span class=\"line\">s = Student(<span class=\"string\">\"ljl\"</span>, <span class=\"number\">12</span>)</span><br><span class=\"line\">print(Student.sum)</span><br><span class=\"line\">s.__class__.plus_sum()</span><br><span class=\"line\">print(Student.sum)</span><br></pre></td></tr></table></figure>\n<h3 id=\"静态方法\"><a href=\"#静态方法\" class=\"headerlink\" title=\"静态方法\"></a>静态方法</h3><ul>\n<li>第一个参数不需要指定特定的对象</li>\n<li>对象和类都可以调用静态方法</li>\n<li>静态方法可以访问类变量: <code>Student.sum1</code></li>\n<li>静态方法和类方法都不能直接访问实例变量</li>\n<li>静态方法相当于普通的方法，与类和实例没有太大关联</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Student</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    sum = <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span><span class=\"params\">(self, name=<span class=\"string\">\"ljl\"</span>, age=<span class=\"number\">12</span>)</span>:</span></span><br><span class=\"line\">        self.name = name</span><br><span class=\"line\">        self.age = age</span><br><span class=\"line\">        self.__class__.sum += <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">    @staticmethod</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">hello_world</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">        print(<span class=\"string\">\"hello world\"</span>)</span><br><span class=\"line\">        print(Student.sum)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">s = Student()</span><br><span class=\"line\">s.hello_world()</span><br><span class=\"line\">Student.hello_world()</span><br></pre></td></tr></table></figure>\n<h3 id=\"成员可见性\"><a href=\"#成员可见性\" class=\"headerlink\" title=\"成员可见性\"></a>成员可见性</h3><ul>\n<li>给变量或实例方法名前加双下划线<code>__name</code>，则该方法或变量名是私有的</li>\n<li>严格来讲，Python 的类是没有私有变量和私有方法，Python 解释器只是把带双下划线的实例变量和实例方法改了一个名字而已，格式：<code>_Student__name</code>，<code>_Student__private_method</code></li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Student</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 类变量</span></span><br><span class=\"line\">    sum1 = <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span><span class=\"params\">(self, name, age)</span>:</span></span><br><span class=\"line\">        self.__name = name  <span class=\"comment\"># 存储时私有变量的名字为_Student__name</span></span><br><span class=\"line\">        self.__age = age</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_name</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> self.__name</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__private_method</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">        print(self.__name)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">s = Student(<span class=\"string\">'ljl'</span>, <span class=\"number\">12</span>)</span><br><span class=\"line\">print(s.get_name())</span><br><span class=\"line\"><span class=\"comment\"># s.__private_method()  # error</span></span><br><span class=\"line\">s.__name = <span class=\"string\">\"lyb\"</span>  <span class=\"comment\"># 添加了一个新的实例变量，而不是原来的实例变量，而且新添加的实例变量不是私有的变量</span></span><br><span class=\"line\">print(s.__name)  <span class=\"comment\"># OK</span></span><br><span class=\"line\">print(s.get_name())</span><br><span class=\"line\">s1 = Student(<span class=\"string\">'ljl'</span>, <span class=\"number\">13</span>)</span><br><span class=\"line\">print(s1.__name)  <span class=\"comment\"># error, s1没有新建实例变量__name</span></span><br><span class=\"line\">print(s1._Student__name)  <span class=\"comment\"># ok，可以通过这种方法访问私有变量</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>静态方法和类方法也可以是私有的</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Student</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 类变量</span></span><br><span class=\"line\">    sum1 = <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span><span class=\"params\">(self, name, age)</span>:</span></span><br><span class=\"line\">        self.__name = name  <span class=\"comment\"># 存储时私有变量的名字为_Student__name</span></span><br><span class=\"line\">        self.__age = age</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_name</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> self.__name</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__private_method</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">        print(self.__name)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">    @classmethod</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__private_class_method</span><span class=\"params\">(cls)</span>:</span>  <span class=\"comment\"># 私有类方法</span></span><br><span class=\"line\">        print(cls.sum1)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">    @staticmethod</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__private_static_method</span><span class=\"params\">()</span>:</span>  <span class=\"comment\"># 私有静态方法</span></span><br><span class=\"line\">        print(<span class=\"string\">\"hello\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Student.__private_class_method()  <span class=\"comment\"># error</span></span><br><span class=\"line\">s = Student(<span class=\"string\">'ljl'</span>, <span class=\"number\">12</span>)</span><br><span class=\"line\">s.__private_static_method()  <span class=\"comment\"># error</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"继承\"><a href=\"#继承\" class=\"headerlink\" title=\"继承\"></a>继承</h3><ul>\n<li>继承的目的：避免定义重复变量和方法</li>\n<li>子类可以继承父类的类变量，实例变量，构造方法，实例方法，类方法</li>\n<li>子类可以定义自己特有的实例变量</li>\n<li>可以通过类调用示例方法，但必须传入一个实例对象，<code>Student.method(s)</code>，虽然可以这样做，但不推荐这样做</li>\n<li>在子类的构造函数中可以调用父类的构造函数<ul>\n<li><code>Human.__init__(self, name, age)</code></li>\n<li><code>super(Student, self).__init__(name, age)</code>推荐使用这种方法</li>\n</ul>\n</li>\n<li>super 也可以用在实例方法中</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Human</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    sum = <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span><span class=\"params\">(self, name, age)</span>:</span></span><br><span class=\"line\">        self.name = name</span><br><span class=\"line\">        self.age = age</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_name</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">        print(self.name)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">    @classmethod</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">super_class_method</span><span class=\"params\">(cls)</span>:</span></span><br><span class=\"line\">        print(<span class=\"string\">'super class mthod'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">do_homework</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">        print(<span class=\"string\">'do home'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Student</span><span class=\"params\">(Human)</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span><span class=\"params\">(self, school, name, age)</span>:</span></span><br><span class=\"line\">        self.school = school</span><br><span class=\"line\">        <span class=\"comment\"># Human.__init__(self, name, age)  # 这里不能缺少self</span></span><br><span class=\"line\">        super(Student, self).__init__(name, age)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">do_homework</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">        super(Student, self).do_homework()</span><br><span class=\"line\">        print(<span class=\"string\">'do a lot home'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">s = Student(<span class=\"string\">'school'</span>, <span class=\"string\">'ljl'</span>, <span class=\"string\">'12'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">Student.super_class_method()</span><br><span class=\"line\">print(s.name)</span><br><span class=\"line\">print(s.age)</span><br><span class=\"line\">s.do_homework()</span><br><span class=\"line\">print(issubclass(Student, Human)) <span class=\"comment\"># 判断Student是否是Human的子类</span></span><br><span class=\"line\">pritn(isinstance(s, Student)) <span class=\"comment\"># True</span></span><br><span class=\"line\">pritn(isinstance(s, Human)) <span class=\"comment\"># True</span></span><br></pre></td></tr></table></figure>\n"},{"title":"Python学习笔记(5)","date":"2018-09-26T22:57:59.000Z","_content":"\n## 闭包\n\n### Python 中一切皆对象\n\n- 函数也是对象\n- 可以把一个函数当成另外一个参数，传递到另外的函数里，也可以把一个函数当做另一个函数的返回值\n\n### 什么是闭包\n\n- 闭包：函数 + 上下文（环境变量）\n- 闭包的信息保存在函数的`__closure__`里\n\n```python\ndef curve_pre():\n    a = 25\n\n    # 这个闭包捕获了a\n    def cureve(x):\n        return a * x * x\n    return cureve\n\n\na = 4\nf = curve_pre()\nprint(f(2)) # 100\nprint(f.__closure__[0].cell_contents)  # 25\n```\n\n### 使用闭包注意事项\n\n- 如果没有捕获变量，则**closure**为空\n\n```python\ndef f1():\n    a = 10\n\n    # 此时f2不是一个闭包，因为没有捕获变量\n    def f2():\n        # a 是一个局部变量，不会影响外部的变量\n        a = 20\n        print(a)\n    print(a)\n    f2()\n    print(a)\n    return f2\n\n\nf = f1()  # 10 20 10\nprint(f.__closure__) # None\n```\n\n### 闭包的应用\n\n- 闭包可以封装细节\n\n```python\ndef factory(pos):\n   def go(step):\n       nonlocal pos  # 声明pos不是局部变量\n       new_pos = pos + step\n       pos = new_pos  # pos如果不声明为非局部变量则这一句户报错\n       return new_pos\n   return go\n\n\na = factory(0)\nprint(a(2)) # 2\nprint(a(3)) # 5\nprint(a(5)) # 10\n```\n\n## 函数式编程\n\n### lambda 表达式 (匿名函数）\n\n```python\n# 普通函数\ndef add(x, y):\n   return x + y\nsum = add(1, 2)\nprint(sum)\n\n# lambda表达式\nsum = lambda x, y: x + y\nprint(sum(1, 2))\n```\n\n### 三元表达式\n\n- 条件为真的返回结果 if 条件判断 else 条件为假的返回结果\n- 相当于其他语言的?:表达是\n\n```python\na = 12\nb = 13\n# 如果a大于b则r等于a否则r等于b\nr = a if a > b else b\nprint(r)\n```\n\n### 高阶函数\n\n#### map\n\n```python\ndef fun(a):\n return a * a\na = [1, 2, 3, 4]\nb = map(fun, a)\nprint(list(b))\n\nc = map(lambda value: value * value, a)\nprint(list(c))\n\n# map可以传入多个列表\nl1 = [1, 2, 3, 4]\nl2 = [2, 4, 6, 8]\nr = map(lambda x, y: x + y, l1, l2) # 传入列表的个数与lambda表达式参数的个数一样\nprint(list(r)) # [3, 6, 9, 12]\n```\n\n#### reduce\n\n```python\nfrom functools import reduce\n\nl1 = [1, 2, 3, 4, 5]\n\nr = reduce(lambda x, y: x + y, l1, 0)\nprint(r) # 15\n```\n\n#### filter\n\n```python\nfrom functools import reduce\n\nl1 = [1, 2, 3, 4, 5]\n\nr = filter(lambda x: x % 2 == 0, l1)\nprint(list(r)) # [2, 4]\n```\n","source":"_posts/2018-09-27-Python学习笔记-5.md","raw":"---\ntitle: Python学习笔记(5)\ncategories: Python\ntags:\n  - Python\ndate: 2018-09-27 06:57:59\n---\n\n## 闭包\n\n### Python 中一切皆对象\n\n- 函数也是对象\n- 可以把一个函数当成另外一个参数，传递到另外的函数里，也可以把一个函数当做另一个函数的返回值\n\n### 什么是闭包\n\n- 闭包：函数 + 上下文（环境变量）\n- 闭包的信息保存在函数的`__closure__`里\n\n```python\ndef curve_pre():\n    a = 25\n\n    # 这个闭包捕获了a\n    def cureve(x):\n        return a * x * x\n    return cureve\n\n\na = 4\nf = curve_pre()\nprint(f(2)) # 100\nprint(f.__closure__[0].cell_contents)  # 25\n```\n\n### 使用闭包注意事项\n\n- 如果没有捕获变量，则**closure**为空\n\n```python\ndef f1():\n    a = 10\n\n    # 此时f2不是一个闭包，因为没有捕获变量\n    def f2():\n        # a 是一个局部变量，不会影响外部的变量\n        a = 20\n        print(a)\n    print(a)\n    f2()\n    print(a)\n    return f2\n\n\nf = f1()  # 10 20 10\nprint(f.__closure__) # None\n```\n\n### 闭包的应用\n\n- 闭包可以封装细节\n\n```python\ndef factory(pos):\n   def go(step):\n       nonlocal pos  # 声明pos不是局部变量\n       new_pos = pos + step\n       pos = new_pos  # pos如果不声明为非局部变量则这一句户报错\n       return new_pos\n   return go\n\n\na = factory(0)\nprint(a(2)) # 2\nprint(a(3)) # 5\nprint(a(5)) # 10\n```\n\n## 函数式编程\n\n### lambda 表达式 (匿名函数）\n\n```python\n# 普通函数\ndef add(x, y):\n   return x + y\nsum = add(1, 2)\nprint(sum)\n\n# lambda表达式\nsum = lambda x, y: x + y\nprint(sum(1, 2))\n```\n\n### 三元表达式\n\n- 条件为真的返回结果 if 条件判断 else 条件为假的返回结果\n- 相当于其他语言的?:表达是\n\n```python\na = 12\nb = 13\n# 如果a大于b则r等于a否则r等于b\nr = a if a > b else b\nprint(r)\n```\n\n### 高阶函数\n\n#### map\n\n```python\ndef fun(a):\n return a * a\na = [1, 2, 3, 4]\nb = map(fun, a)\nprint(list(b))\n\nc = map(lambda value: value * value, a)\nprint(list(c))\n\n# map可以传入多个列表\nl1 = [1, 2, 3, 4]\nl2 = [2, 4, 6, 8]\nr = map(lambda x, y: x + y, l1, l2) # 传入列表的个数与lambda表达式参数的个数一样\nprint(list(r)) # [3, 6, 9, 12]\n```\n\n#### reduce\n\n```python\nfrom functools import reduce\n\nl1 = [1, 2, 3, 4, 5]\n\nr = reduce(lambda x, y: x + y, l1, 0)\nprint(r) # 15\n```\n\n#### filter\n\n```python\nfrom functools import reduce\n\nl1 = [1, 2, 3, 4, 5]\n\nr = filter(lambda x: x % 2 == 0, l1)\nprint(list(r)) # [2, 4]\n```\n","slug":"Python学习笔记-5","published":1,"updated":"2018-09-26T23:31:47.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjutyfmgg004ic4c9flzvtq8d","content":"<h2 id=\"闭包\"><a href=\"#闭包\" class=\"headerlink\" title=\"闭包\"></a>闭包</h2><h3 id=\"Python-中一切皆对象\"><a href=\"#Python-中一切皆对象\" class=\"headerlink\" title=\"Python 中一切皆对象\"></a>Python 中一切皆对象</h3><ul>\n<li>函数也是对象</li>\n<li>可以把一个函数当成另外一个参数，传递到另外的函数里，也可以把一个函数当做另一个函数的返回值</li>\n</ul>\n<h3 id=\"什么是闭包\"><a href=\"#什么是闭包\" class=\"headerlink\" title=\"什么是闭包\"></a>什么是闭包</h3><ul>\n<li>闭包：函数 + 上下文（环境变量）</li>\n<li>闭包的信息保存在函数的<code>__closure__</code>里</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">curve_pre</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    a = <span class=\"number\">25</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 这个闭包捕获了a</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">cureve</span><span class=\"params\">(x)</span>:</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> a * x * x</span><br><span class=\"line\">    <span class=\"keyword\">return</span> cureve</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">a = <span class=\"number\">4</span></span><br><span class=\"line\">f = curve_pre()</span><br><span class=\"line\">print(f(<span class=\"number\">2</span>)) <span class=\"comment\"># 100</span></span><br><span class=\"line\">print(f.__closure__[<span class=\"number\">0</span>].cell_contents)  <span class=\"comment\"># 25</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"使用闭包注意事项\"><a href=\"#使用闭包注意事项\" class=\"headerlink\" title=\"使用闭包注意事项\"></a>使用闭包注意事项</h3><ul>\n<li>如果没有捕获变量，则<strong>closure</strong>为空</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">f1</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    a = <span class=\"number\">10</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 此时f2不是一个闭包，因为没有捕获变量</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">f2</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">        <span class=\"comment\"># a 是一个局部变量，不会影响外部的变量</span></span><br><span class=\"line\">        a = <span class=\"number\">20</span></span><br><span class=\"line\">        print(a)</span><br><span class=\"line\">    print(a)</span><br><span class=\"line\">    f2()</span><br><span class=\"line\">    print(a)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> f2</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">f = f1()  <span class=\"comment\"># 10 20 10</span></span><br><span class=\"line\">print(f.__closure__) <span class=\"comment\"># None</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"闭包的应用\"><a href=\"#闭包的应用\" class=\"headerlink\" title=\"闭包的应用\"></a>闭包的应用</h3><ul>\n<li>闭包可以封装细节</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">factory</span><span class=\"params\">(pos)</span>:</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">go</span><span class=\"params\">(step)</span>:</span></span><br><span class=\"line\">       <span class=\"keyword\">nonlocal</span> pos  <span class=\"comment\"># 声明pos不是局部变量</span></span><br><span class=\"line\">       new_pos = pos + step</span><br><span class=\"line\">       pos = new_pos  <span class=\"comment\"># pos如果不声明为非局部变量则这一句户报错</span></span><br><span class=\"line\">       <span class=\"keyword\">return</span> new_pos</span><br><span class=\"line\">   <span class=\"keyword\">return</span> go</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">a = factory(<span class=\"number\">0</span>)</span><br><span class=\"line\">print(a(<span class=\"number\">2</span>)) <span class=\"comment\"># 2</span></span><br><span class=\"line\">print(a(<span class=\"number\">3</span>)) <span class=\"comment\"># 5</span></span><br><span class=\"line\">print(a(<span class=\"number\">5</span>)) <span class=\"comment\"># 10</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"函数式编程\"><a href=\"#函数式编程\" class=\"headerlink\" title=\"函数式编程\"></a>函数式编程</h2><h3 id=\"lambda-表达式-匿名函数）\"><a href=\"#lambda-表达式-匿名函数）\" class=\"headerlink\" title=\"lambda 表达式 (匿名函数）\"></a>lambda 表达式 (匿名函数）</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 普通函数</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">add</span><span class=\"params\">(x, y)</span>:</span></span><br><span class=\"line\">   <span class=\"keyword\">return</span> x + y</span><br><span class=\"line\">sum = add(<span class=\"number\">1</span>, <span class=\"number\">2</span>)</span><br><span class=\"line\">print(sum)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># lambda表达式</span></span><br><span class=\"line\">sum = <span class=\"keyword\">lambda</span> x, y: x + y</span><br><span class=\"line\">print(sum(<span class=\"number\">1</span>, <span class=\"number\">2</span>))</span><br></pre></td></tr></table></figure>\n<h3 id=\"三元表达式\"><a href=\"#三元表达式\" class=\"headerlink\" title=\"三元表达式\"></a>三元表达式</h3><ul>\n<li>条件为真的返回结果 if 条件判断 else 条件为假的返回结果</li>\n<li>相当于其他语言的?:表达是</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a = <span class=\"number\">12</span></span><br><span class=\"line\">b = <span class=\"number\">13</span></span><br><span class=\"line\"><span class=\"comment\"># 如果a大于b则r等于a否则r等于b</span></span><br><span class=\"line\">r = a <span class=\"keyword\">if</span> a &gt; b <span class=\"keyword\">else</span> b</span><br><span class=\"line\">print(r)</span><br></pre></td></tr></table></figure>\n<h3 id=\"高阶函数\"><a href=\"#高阶函数\" class=\"headerlink\" title=\"高阶函数\"></a>高阶函数</h3><h4 id=\"map\"><a href=\"#map\" class=\"headerlink\" title=\"map\"></a>map</h4><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">fun</span><span class=\"params\">(a)</span>:</span></span><br><span class=\"line\"> <span class=\"keyword\">return</span> a * a</span><br><span class=\"line\">a = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>]</span><br><span class=\"line\">b = map(fun, a)</span><br><span class=\"line\">print(list(b))</span><br><span class=\"line\"></span><br><span class=\"line\">c = map(<span class=\"keyword\">lambda</span> value: value * value, a)</span><br><span class=\"line\">print(list(c))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># map可以传入多个列表</span></span><br><span class=\"line\">l1 = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>]</span><br><span class=\"line\">l2 = [<span class=\"number\">2</span>, <span class=\"number\">4</span>, <span class=\"number\">6</span>, <span class=\"number\">8</span>]</span><br><span class=\"line\">r = map(<span class=\"keyword\">lambda</span> x, y: x + y, l1, l2) <span class=\"comment\"># 传入列表的个数与lambda表达式参数的个数一样</span></span><br><span class=\"line\">print(list(r)) <span class=\"comment\"># [3, 6, 9, 12]</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"reduce\"><a href=\"#reduce\" class=\"headerlink\" title=\"reduce\"></a>reduce</h4><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> functools <span class=\"keyword\">import</span> reduce</span><br><span class=\"line\"></span><br><span class=\"line\">l1 = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">r = reduce(<span class=\"keyword\">lambda</span> x, y: x + y, l1, <span class=\"number\">0</span>)</span><br><span class=\"line\">print(r) <span class=\"comment\"># 15</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"filter\"><a href=\"#filter\" class=\"headerlink\" title=\"filter\"></a>filter</h4><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> functools <span class=\"keyword\">import</span> reduce</span><br><span class=\"line\"></span><br><span class=\"line\">l1 = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">r = filter(<span class=\"keyword\">lambda</span> x: x % <span class=\"number\">2</span> == <span class=\"number\">0</span>, l1)</span><br><span class=\"line\">print(list(r)) <span class=\"comment\"># [2, 4]</span></span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"闭包\"><a href=\"#闭包\" class=\"headerlink\" title=\"闭包\"></a>闭包</h2><h3 id=\"Python-中一切皆对象\"><a href=\"#Python-中一切皆对象\" class=\"headerlink\" title=\"Python 中一切皆对象\"></a>Python 中一切皆对象</h3><ul>\n<li>函数也是对象</li>\n<li>可以把一个函数当成另外一个参数，传递到另外的函数里，也可以把一个函数当做另一个函数的返回值</li>\n</ul>\n<h3 id=\"什么是闭包\"><a href=\"#什么是闭包\" class=\"headerlink\" title=\"什么是闭包\"></a>什么是闭包</h3><ul>\n<li>闭包：函数 + 上下文（环境变量）</li>\n<li>闭包的信息保存在函数的<code>__closure__</code>里</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">curve_pre</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    a = <span class=\"number\">25</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 这个闭包捕获了a</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">cureve</span><span class=\"params\">(x)</span>:</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> a * x * x</span><br><span class=\"line\">    <span class=\"keyword\">return</span> cureve</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">a = <span class=\"number\">4</span></span><br><span class=\"line\">f = curve_pre()</span><br><span class=\"line\">print(f(<span class=\"number\">2</span>)) <span class=\"comment\"># 100</span></span><br><span class=\"line\">print(f.__closure__[<span class=\"number\">0</span>].cell_contents)  <span class=\"comment\"># 25</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"使用闭包注意事项\"><a href=\"#使用闭包注意事项\" class=\"headerlink\" title=\"使用闭包注意事项\"></a>使用闭包注意事项</h3><ul>\n<li>如果没有捕获变量，则<strong>closure</strong>为空</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">f1</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    a = <span class=\"number\">10</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 此时f2不是一个闭包，因为没有捕获变量</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">f2</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">        <span class=\"comment\"># a 是一个局部变量，不会影响外部的变量</span></span><br><span class=\"line\">        a = <span class=\"number\">20</span></span><br><span class=\"line\">        print(a)</span><br><span class=\"line\">    print(a)</span><br><span class=\"line\">    f2()</span><br><span class=\"line\">    print(a)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> f2</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">f = f1()  <span class=\"comment\"># 10 20 10</span></span><br><span class=\"line\">print(f.__closure__) <span class=\"comment\"># None</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"闭包的应用\"><a href=\"#闭包的应用\" class=\"headerlink\" title=\"闭包的应用\"></a>闭包的应用</h3><ul>\n<li>闭包可以封装细节</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">factory</span><span class=\"params\">(pos)</span>:</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">go</span><span class=\"params\">(step)</span>:</span></span><br><span class=\"line\">       <span class=\"keyword\">nonlocal</span> pos  <span class=\"comment\"># 声明pos不是局部变量</span></span><br><span class=\"line\">       new_pos = pos + step</span><br><span class=\"line\">       pos = new_pos  <span class=\"comment\"># pos如果不声明为非局部变量则这一句户报错</span></span><br><span class=\"line\">       <span class=\"keyword\">return</span> new_pos</span><br><span class=\"line\">   <span class=\"keyword\">return</span> go</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">a = factory(<span class=\"number\">0</span>)</span><br><span class=\"line\">print(a(<span class=\"number\">2</span>)) <span class=\"comment\"># 2</span></span><br><span class=\"line\">print(a(<span class=\"number\">3</span>)) <span class=\"comment\"># 5</span></span><br><span class=\"line\">print(a(<span class=\"number\">5</span>)) <span class=\"comment\"># 10</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"函数式编程\"><a href=\"#函数式编程\" class=\"headerlink\" title=\"函数式编程\"></a>函数式编程</h2><h3 id=\"lambda-表达式-匿名函数）\"><a href=\"#lambda-表达式-匿名函数）\" class=\"headerlink\" title=\"lambda 表达式 (匿名函数）\"></a>lambda 表达式 (匿名函数）</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 普通函数</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">add</span><span class=\"params\">(x, y)</span>:</span></span><br><span class=\"line\">   <span class=\"keyword\">return</span> x + y</span><br><span class=\"line\">sum = add(<span class=\"number\">1</span>, <span class=\"number\">2</span>)</span><br><span class=\"line\">print(sum)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># lambda表达式</span></span><br><span class=\"line\">sum = <span class=\"keyword\">lambda</span> x, y: x + y</span><br><span class=\"line\">print(sum(<span class=\"number\">1</span>, <span class=\"number\">2</span>))</span><br></pre></td></tr></table></figure>\n<h3 id=\"三元表达式\"><a href=\"#三元表达式\" class=\"headerlink\" title=\"三元表达式\"></a>三元表达式</h3><ul>\n<li>条件为真的返回结果 if 条件判断 else 条件为假的返回结果</li>\n<li>相当于其他语言的?:表达是</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a = <span class=\"number\">12</span></span><br><span class=\"line\">b = <span class=\"number\">13</span></span><br><span class=\"line\"><span class=\"comment\"># 如果a大于b则r等于a否则r等于b</span></span><br><span class=\"line\">r = a <span class=\"keyword\">if</span> a &gt; b <span class=\"keyword\">else</span> b</span><br><span class=\"line\">print(r)</span><br></pre></td></tr></table></figure>\n<h3 id=\"高阶函数\"><a href=\"#高阶函数\" class=\"headerlink\" title=\"高阶函数\"></a>高阶函数</h3><h4 id=\"map\"><a href=\"#map\" class=\"headerlink\" title=\"map\"></a>map</h4><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">fun</span><span class=\"params\">(a)</span>:</span></span><br><span class=\"line\"> <span class=\"keyword\">return</span> a * a</span><br><span class=\"line\">a = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>]</span><br><span class=\"line\">b = map(fun, a)</span><br><span class=\"line\">print(list(b))</span><br><span class=\"line\"></span><br><span class=\"line\">c = map(<span class=\"keyword\">lambda</span> value: value * value, a)</span><br><span class=\"line\">print(list(c))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># map可以传入多个列表</span></span><br><span class=\"line\">l1 = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>]</span><br><span class=\"line\">l2 = [<span class=\"number\">2</span>, <span class=\"number\">4</span>, <span class=\"number\">6</span>, <span class=\"number\">8</span>]</span><br><span class=\"line\">r = map(<span class=\"keyword\">lambda</span> x, y: x + y, l1, l2) <span class=\"comment\"># 传入列表的个数与lambda表达式参数的个数一样</span></span><br><span class=\"line\">print(list(r)) <span class=\"comment\"># [3, 6, 9, 12]</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"reduce\"><a href=\"#reduce\" class=\"headerlink\" title=\"reduce\"></a>reduce</h4><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> functools <span class=\"keyword\">import</span> reduce</span><br><span class=\"line\"></span><br><span class=\"line\">l1 = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">r = reduce(<span class=\"keyword\">lambda</span> x, y: x + y, l1, <span class=\"number\">0</span>)</span><br><span class=\"line\">print(r) <span class=\"comment\"># 15</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"filter\"><a href=\"#filter\" class=\"headerlink\" title=\"filter\"></a>filter</h4><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> functools <span class=\"keyword\">import</span> reduce</span><br><span class=\"line\"></span><br><span class=\"line\">l1 = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">r = filter(<span class=\"keyword\">lambda</span> x: x % <span class=\"number\">2</span> == <span class=\"number\">0</span>, l1)</span><br><span class=\"line\">print(list(r)) <span class=\"comment\"># [2, 4]</span></span><br></pre></td></tr></table></figure>\n"},{"title":"Python学习笔记(4)","date":"2018-09-10T23:13:15.000Z","_content":"\n## 正则表达式\n\n### 正则表达式的定义\n\n- 定义：正则表达式是一个特殊的字符序列，一个字符串是否与我们所设定的这样的字符序列相匹配。\n- 作用：快速检索文本，实现一些替换文本的操作\n- Python 中的正则表达式模块：re\n\n### 元字符和普通字符\n\n- 普通字符：`abc`\n- 元字符：`\\d, \\D, \\f, \\n`等，每种元字符都有不同的含义\n- 正则表达式就是普通字符和元字符组成的\n\n### 字符集\n\n- 中括号中的字符是`或`的关系\n- 取反使用`^`\n- 范围：`[a-z], [a-zA-Z]`\n\n```python\ns = 'abc, acc, adc, aec, afc, ahc'\nr = re.findall('a[^cfC]c', s) # 表示已a开头，c结尾，中间的一个字母不是c,f,C中的任何一个\nprint(r) # ['abc', 'adc', 'aec', 'ahc']\n```\n\n### 概括字符集\n\n- `\\d` 代表数字，相当于`[0-9]`\n- `\\D` 代表非数字，相当于`[^0-9]`\n- `\\w` 代表单词字符，相当于`[0-9a-zA-Z_]`\n- `\\W` 代表非单词字符，相当于`[^0-9a-zA-Z_]`\n- `\\s` 代表空白字符\n- `\\S` 代表非空白字符\n- `.` 代表除换行符的所有字符\n\n### 数量词\n\n- `[a-z]{3,6}` 匹配 3 到 6 次\n\n### 贪婪和非贪婪\n\n- 贪婪：尽可能多的匹配，一直到不满足条件为止\n- 非贪婪：一旦满足条件就停止匹配\n- Python 倾向于贪婪模式\n\n```python\n# 匹配3-6个字母，贪婪模式下，会匹配尽可能多的字母，直到不满足条件，因此会匹配出['python', 'java', 'php']\n# 非贪婪模式下会匹配3个字符，【'pyt', 'hon', 'jav', 'php']\na = 'python 111java678php'\nr = re.findall('[a-z]{3,6}', a) # 贪婪模式\nr = re.findall('[a-z]{3,6}?', a) # 非贪婪模式，加一个问号\n```\n\n### 匹配 0 次，1 次或无限次\n\n- `*`匹配前面的字符 0 次或 n 次\n- `+`匹配前面的字符 1 次或 n 次\n- `?`匹配前面的字符 0 次或 1 次，要与非贪婪模式的问号区分\n\n### 边界匹配符\n\n- `^`首部，`^000`开头三个字符为`000`\n- `$`尾部，`000$`结尾三个字符为`000`\n\n### 组\n\n- 一个括号对应一组，`(Python){3}`，把一个组重复 3 次\n- 组中的每个字符是且的关系\n\n### 匹配模式参数\n\n- 忽略字母大小写: `re.I`\n- `.`表示匹配任意字符: `re.S`\n\n```python\ns = 'abc, acc, adc, aec, afc, ahc, aFc'\nr = re.findall('a[cf]c', s, re.I) # 忽略大小写\nprint(r) # ['acc', 'afc', 'aFc']\n```\n\n### re.sub 正则替换\n\n```python\na = 'python 111java678php'\nr1 = re.sub('\\w{3,6}', \"hhh\", a, 1)  # 最后一个参数1表示替换几个\n\nprint(r1)  # hhh 111java678php\n\n\ndef convert(value):\n    return 'aa' + value.group()  # value.group()为匹配到的字符串\n\n\n# 第二个参数为一个函数，匹配到后会把匹配的结果传给函数执行，并把函数返回的结果作为替换字符串\nr2 = re.sub('\\w{3,6}', convert, a)\nprint(r2)  # aapython 111java678php\n```\n\n### match 与 search 函数\n\n- match 函数：从字符串的首字母开始匹配，如果首字母没有匹配到则返回空\n- search 函数：搜索字符串，知道找到第一个符合要求的字符串\n- match 和 search 只匹配一个结果，findall 会匹配所有符合条件的字符串\n\n### group 分组\n\n- 使用括号进行分组\n\n```python\ns = 'life is short, i use python, i love python'\nr = re.search('life(.*)python(.*)python', s)\nprint(r.group(0)) # `life is short, i use python, i love python` (默认第0个分组为字符串本身)\nprint(r.group(1)) # ` is short, i use`\nprint(r.group(2)) # `, i love`\nprint(r.group(0, 1, 2)) # ('life is short, i use python, i love python', ' is short, i use ', ', i love ')\nprint(r.groups())  # (' is short, i use ', ', i love ') (不会返回完整字符串)\n```\n\n## JSON\n\n### 理解 JSON\n\n- JSON 是一种轻量级的数据格式\n- 字符串是 JSON 的表现形式\n- JSON 字符串：符合 JSON 格式的字符串\n- JSON 对象：Python 中没有 JSON 对象，JS 中有 JSON 对象\n\n### JSON 的特点\n\n- 易于阅读\n- 易于解析\n- 网络传输效率高\n- 跨语言交换数据\n\n### 反序列化\n\n- Python 中会把 JSON 字符串解析成字典或列表\n- Python 中的数据类型对应 JSON 中的数据类型：\n\n![1](http://blog.shicishuzhai.com/a222d6640d76f895c8ce620a3719dc4e.png)\n\n```python\nimport json\n# 这里必须是里面是双引号，外面是单引号，false和true首字符必须小写\ns = '{\"name\": \"ljl\", \"age\": 12, \"flag\": true}'\na = json.loads(s)  # Python中会把JSON字符串解析成字典或列表\nprint(a) # {'name': 'ljl', 'age': 12, 'flag': True}\n```\n\n### 序列化\n\n```python\ns1 = json.dumps(a)\nprint(s1)\n```\n\n## 枚举\n\n### 枚举类型（Python3）\n\n- 枚举也是一个类\n- 枚举在 Python3 中才有，Python2 中没有枚举类\n\n```python\nfrom enum import Enum\n\nclass VIP(Enum):\n    YELLOW = 1\n    GREEN = 2\n    BLACK = 3\n    RED = 4\n\nprint(VIP.YELLOW)  # VIP.YELLOW\nprint(VIP.YELLOW == VIP.GREEN)  # false\n```\n\n### 枚举的优势\n\n- 不可变\n- 值不会重复\n\n```python\nfrom enum import Enum\n\nclass VIP(Enum):\n    YELLOW = 1\n    GREEN = 2\n    BLACK = 3\n    RED = 4\n    # BLACK = 5  # error\n    YELLOW_ALIAS = 1 # YELLOW的别名\n\n\nprint(VIP.YELLOW)  # VIP.YELLOW\nprint(VIP.YELLOW == VIP.GREEN)  # false\nVIP.YELLOW = 3  # error，枚举的值不能改变\n```\n\n### 枚举的操作\n\n```python\nprint(VIP.YELLOW)  # VIP.YELLOW，枚举类型\nprint(VIP.YELLOW.value)  # 1，枚举的值\nprint(VIP.YELLOW.name)  # YELLOW，枚举的名字\n\n# 枚举的遍历，遍历时别名不会遍历\n# VIP.YELLOW\n# VIP.GREEN\n# VIP.BLACK\n# VIP.RED\nfor v in VIP:\n    print(v)\n\n# 遍历枚举的所有值，包括别名\nfor v in VIP.__members__:\n    print(v)\n\n# 枚举的比较\nprint(VIP.YELLOW == VIP.GREEN) # false\nprint(VIP.YELLOW == VIP.YELLOW) # false\nprint(VIP.YELLOW == 1)  # false\n# print(VIP.YELLOW < VIP.GREEN)  # error，枚举不可以进行大小比较\nprint(VIP.YELLOW.value == 1)  # true\nprint(VIP.YELLOW == VIP.YELLOW_ALIAS)  # true\n```\n\n### 枚举的转换\n\n```python\nclass VIP(Enum):\n    YELLOW = 1\n    GREEN = 2\n    BLACK = 3\n    RED = 4\n\n\na = VIP(1)  # a 初始化为VIP.YELLOW\nprint(a) # VIP.YELLOW\nprint(a == VIP.YELLOW)  # true\n```\n","source":"_posts/2018-09-11-Python学习笔记-4.md","raw":"---\ntitle: Python学习笔记(4)\ncategories: Python\ntags:\n  - Python\ndate: 2018-09-11 07:13:15\n---\n\n## 正则表达式\n\n### 正则表达式的定义\n\n- 定义：正则表达式是一个特殊的字符序列，一个字符串是否与我们所设定的这样的字符序列相匹配。\n- 作用：快速检索文本，实现一些替换文本的操作\n- Python 中的正则表达式模块：re\n\n### 元字符和普通字符\n\n- 普通字符：`abc`\n- 元字符：`\\d, \\D, \\f, \\n`等，每种元字符都有不同的含义\n- 正则表达式就是普通字符和元字符组成的\n\n### 字符集\n\n- 中括号中的字符是`或`的关系\n- 取反使用`^`\n- 范围：`[a-z], [a-zA-Z]`\n\n```python\ns = 'abc, acc, adc, aec, afc, ahc'\nr = re.findall('a[^cfC]c', s) # 表示已a开头，c结尾，中间的一个字母不是c,f,C中的任何一个\nprint(r) # ['abc', 'adc', 'aec', 'ahc']\n```\n\n### 概括字符集\n\n- `\\d` 代表数字，相当于`[0-9]`\n- `\\D` 代表非数字，相当于`[^0-9]`\n- `\\w` 代表单词字符，相当于`[0-9a-zA-Z_]`\n- `\\W` 代表非单词字符，相当于`[^0-9a-zA-Z_]`\n- `\\s` 代表空白字符\n- `\\S` 代表非空白字符\n- `.` 代表除换行符的所有字符\n\n### 数量词\n\n- `[a-z]{3,6}` 匹配 3 到 6 次\n\n### 贪婪和非贪婪\n\n- 贪婪：尽可能多的匹配，一直到不满足条件为止\n- 非贪婪：一旦满足条件就停止匹配\n- Python 倾向于贪婪模式\n\n```python\n# 匹配3-6个字母，贪婪模式下，会匹配尽可能多的字母，直到不满足条件，因此会匹配出['python', 'java', 'php']\n# 非贪婪模式下会匹配3个字符，【'pyt', 'hon', 'jav', 'php']\na = 'python 111java678php'\nr = re.findall('[a-z]{3,6}', a) # 贪婪模式\nr = re.findall('[a-z]{3,6}?', a) # 非贪婪模式，加一个问号\n```\n\n### 匹配 0 次，1 次或无限次\n\n- `*`匹配前面的字符 0 次或 n 次\n- `+`匹配前面的字符 1 次或 n 次\n- `?`匹配前面的字符 0 次或 1 次，要与非贪婪模式的问号区分\n\n### 边界匹配符\n\n- `^`首部，`^000`开头三个字符为`000`\n- `$`尾部，`000$`结尾三个字符为`000`\n\n### 组\n\n- 一个括号对应一组，`(Python){3}`，把一个组重复 3 次\n- 组中的每个字符是且的关系\n\n### 匹配模式参数\n\n- 忽略字母大小写: `re.I`\n- `.`表示匹配任意字符: `re.S`\n\n```python\ns = 'abc, acc, adc, aec, afc, ahc, aFc'\nr = re.findall('a[cf]c', s, re.I) # 忽略大小写\nprint(r) # ['acc', 'afc', 'aFc']\n```\n\n### re.sub 正则替换\n\n```python\na = 'python 111java678php'\nr1 = re.sub('\\w{3,6}', \"hhh\", a, 1)  # 最后一个参数1表示替换几个\n\nprint(r1)  # hhh 111java678php\n\n\ndef convert(value):\n    return 'aa' + value.group()  # value.group()为匹配到的字符串\n\n\n# 第二个参数为一个函数，匹配到后会把匹配的结果传给函数执行，并把函数返回的结果作为替换字符串\nr2 = re.sub('\\w{3,6}', convert, a)\nprint(r2)  # aapython 111java678php\n```\n\n### match 与 search 函数\n\n- match 函数：从字符串的首字母开始匹配，如果首字母没有匹配到则返回空\n- search 函数：搜索字符串，知道找到第一个符合要求的字符串\n- match 和 search 只匹配一个结果，findall 会匹配所有符合条件的字符串\n\n### group 分组\n\n- 使用括号进行分组\n\n```python\ns = 'life is short, i use python, i love python'\nr = re.search('life(.*)python(.*)python', s)\nprint(r.group(0)) # `life is short, i use python, i love python` (默认第0个分组为字符串本身)\nprint(r.group(1)) # ` is short, i use`\nprint(r.group(2)) # `, i love`\nprint(r.group(0, 1, 2)) # ('life is short, i use python, i love python', ' is short, i use ', ', i love ')\nprint(r.groups())  # (' is short, i use ', ', i love ') (不会返回完整字符串)\n```\n\n## JSON\n\n### 理解 JSON\n\n- JSON 是一种轻量级的数据格式\n- 字符串是 JSON 的表现形式\n- JSON 字符串：符合 JSON 格式的字符串\n- JSON 对象：Python 中没有 JSON 对象，JS 中有 JSON 对象\n\n### JSON 的特点\n\n- 易于阅读\n- 易于解析\n- 网络传输效率高\n- 跨语言交换数据\n\n### 反序列化\n\n- Python 中会把 JSON 字符串解析成字典或列表\n- Python 中的数据类型对应 JSON 中的数据类型：\n\n![1](http://blog.shicishuzhai.com/a222d6640d76f895c8ce620a3719dc4e.png)\n\n```python\nimport json\n# 这里必须是里面是双引号，外面是单引号，false和true首字符必须小写\ns = '{\"name\": \"ljl\", \"age\": 12, \"flag\": true}'\na = json.loads(s)  # Python中会把JSON字符串解析成字典或列表\nprint(a) # {'name': 'ljl', 'age': 12, 'flag': True}\n```\n\n### 序列化\n\n```python\ns1 = json.dumps(a)\nprint(s1)\n```\n\n## 枚举\n\n### 枚举类型（Python3）\n\n- 枚举也是一个类\n- 枚举在 Python3 中才有，Python2 中没有枚举类\n\n```python\nfrom enum import Enum\n\nclass VIP(Enum):\n    YELLOW = 1\n    GREEN = 2\n    BLACK = 3\n    RED = 4\n\nprint(VIP.YELLOW)  # VIP.YELLOW\nprint(VIP.YELLOW == VIP.GREEN)  # false\n```\n\n### 枚举的优势\n\n- 不可变\n- 值不会重复\n\n```python\nfrom enum import Enum\n\nclass VIP(Enum):\n    YELLOW = 1\n    GREEN = 2\n    BLACK = 3\n    RED = 4\n    # BLACK = 5  # error\n    YELLOW_ALIAS = 1 # YELLOW的别名\n\n\nprint(VIP.YELLOW)  # VIP.YELLOW\nprint(VIP.YELLOW == VIP.GREEN)  # false\nVIP.YELLOW = 3  # error，枚举的值不能改变\n```\n\n### 枚举的操作\n\n```python\nprint(VIP.YELLOW)  # VIP.YELLOW，枚举类型\nprint(VIP.YELLOW.value)  # 1，枚举的值\nprint(VIP.YELLOW.name)  # YELLOW，枚举的名字\n\n# 枚举的遍历，遍历时别名不会遍历\n# VIP.YELLOW\n# VIP.GREEN\n# VIP.BLACK\n# VIP.RED\nfor v in VIP:\n    print(v)\n\n# 遍历枚举的所有值，包括别名\nfor v in VIP.__members__:\n    print(v)\n\n# 枚举的比较\nprint(VIP.YELLOW == VIP.GREEN) # false\nprint(VIP.YELLOW == VIP.YELLOW) # false\nprint(VIP.YELLOW == 1)  # false\n# print(VIP.YELLOW < VIP.GREEN)  # error，枚举不可以进行大小比较\nprint(VIP.YELLOW.value == 1)  # true\nprint(VIP.YELLOW == VIP.YELLOW_ALIAS)  # true\n```\n\n### 枚举的转换\n\n```python\nclass VIP(Enum):\n    YELLOW = 1\n    GREEN = 2\n    BLACK = 3\n    RED = 4\n\n\na = VIP(1)  # a 初始化为VIP.YELLOW\nprint(a) # VIP.YELLOW\nprint(a == VIP.YELLOW)  # true\n```\n","slug":"Python学习笔记-4","published":1,"updated":"2019-01-13T03:53:57.405Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjutyfmgh004mc4c90slzz1zz","content":"<h2 id=\"正则表达式\"><a href=\"#正则表达式\" class=\"headerlink\" title=\"正则表达式\"></a>正则表达式</h2><h3 id=\"正则表达式的定义\"><a href=\"#正则表达式的定义\" class=\"headerlink\" title=\"正则表达式的定义\"></a>正则表达式的定义</h3><ul>\n<li>定义：正则表达式是一个特殊的字符序列，一个字符串是否与我们所设定的这样的字符序列相匹配。</li>\n<li>作用：快速检索文本，实现一些替换文本的操作</li>\n<li>Python 中的正则表达式模块：re</li>\n</ul>\n<h3 id=\"元字符和普通字符\"><a href=\"#元字符和普通字符\" class=\"headerlink\" title=\"元字符和普通字符\"></a>元字符和普通字符</h3><ul>\n<li>普通字符：<code>abc</code></li>\n<li>元字符：<code>\\d, \\D, \\f, \\n</code>等，每种元字符都有不同的含义</li>\n<li>正则表达式就是普通字符和元字符组成的</li>\n</ul>\n<h3 id=\"字符集\"><a href=\"#字符集\" class=\"headerlink\" title=\"字符集\"></a>字符集</h3><ul>\n<li>中括号中的字符是<code>或</code>的关系</li>\n<li>取反使用<code>^</code></li>\n<li>范围：<code>[a-z], [a-zA-Z]</code></li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">s = <span class=\"string\">'abc, acc, adc, aec, afc, ahc'</span></span><br><span class=\"line\">r = re.findall(<span class=\"string\">'a[^cfC]c'</span>, s) <span class=\"comment\"># 表示已a开头，c结尾，中间的一个字母不是c,f,C中的任何一个</span></span><br><span class=\"line\">print(r) <span class=\"comment\"># ['abc', 'adc', 'aec', 'ahc']</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"概括字符集\"><a href=\"#概括字符集\" class=\"headerlink\" title=\"概括字符集\"></a>概括字符集</h3><ul>\n<li><code>\\d</code> 代表数字，相当于<code>[0-9]</code></li>\n<li><code>\\D</code> 代表非数字，相当于<code>[^0-9]</code></li>\n<li><code>\\w</code> 代表单词字符，相当于<code>[0-9a-zA-Z_]</code></li>\n<li><code>\\W</code> 代表非单词字符，相当于<code>[^0-9a-zA-Z_]</code></li>\n<li><code>\\s</code> 代表空白字符</li>\n<li><code>\\S</code> 代表非空白字符</li>\n<li><code>.</code> 代表除换行符的所有字符</li>\n</ul>\n<h3 id=\"数量词\"><a href=\"#数量词\" class=\"headerlink\" title=\"数量词\"></a>数量词</h3><ul>\n<li><code>[a-z]{3,6}</code> 匹配 3 到 6 次</li>\n</ul>\n<h3 id=\"贪婪和非贪婪\"><a href=\"#贪婪和非贪婪\" class=\"headerlink\" title=\"贪婪和非贪婪\"></a>贪婪和非贪婪</h3><ul>\n<li>贪婪：尽可能多的匹配，一直到不满足条件为止</li>\n<li>非贪婪：一旦满足条件就停止匹配</li>\n<li>Python 倾向于贪婪模式</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 匹配3-6个字母，贪婪模式下，会匹配尽可能多的字母，直到不满足条件，因此会匹配出['python', 'java', 'php']</span></span><br><span class=\"line\"><span class=\"comment\"># 非贪婪模式下会匹配3个字符，【'pyt', 'hon', 'jav', 'php']</span></span><br><span class=\"line\">a = <span class=\"string\">'python 111java678php'</span></span><br><span class=\"line\">r = re.findall(<span class=\"string\">'[a-z]&#123;3,6&#125;'</span>, a) <span class=\"comment\"># 贪婪模式</span></span><br><span class=\"line\">r = re.findall(<span class=\"string\">'[a-z]&#123;3,6&#125;?'</span>, a) <span class=\"comment\"># 非贪婪模式，加一个问号</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"匹配-0-次，1-次或无限次\"><a href=\"#匹配-0-次，1-次或无限次\" class=\"headerlink\" title=\"匹配 0 次，1 次或无限次\"></a>匹配 0 次，1 次或无限次</h3><ul>\n<li><code>*</code>匹配前面的字符 0 次或 n 次</li>\n<li><code>+</code>匹配前面的字符 1 次或 n 次</li>\n<li><code>?</code>匹配前面的字符 0 次或 1 次，要与非贪婪模式的问号区分</li>\n</ul>\n<h3 id=\"边界匹配符\"><a href=\"#边界匹配符\" class=\"headerlink\" title=\"边界匹配符\"></a>边界匹配符</h3><ul>\n<li><code>^</code>首部，<code>^000</code>开头三个字符为<code>000</code></li>\n<li><code>$</code>尾部，<code>000$</code>结尾三个字符为<code>000</code></li>\n</ul>\n<h3 id=\"组\"><a href=\"#组\" class=\"headerlink\" title=\"组\"></a>组</h3><ul>\n<li>一个括号对应一组，<code>(Python){3}</code>，把一个组重复 3 次</li>\n<li>组中的每个字符是且的关系</li>\n</ul>\n<h3 id=\"匹配模式参数\"><a href=\"#匹配模式参数\" class=\"headerlink\" title=\"匹配模式参数\"></a>匹配模式参数</h3><ul>\n<li>忽略字母大小写: <code>re.I</code></li>\n<li><code>.</code>表示匹配任意字符: <code>re.S</code></li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">s = <span class=\"string\">'abc, acc, adc, aec, afc, ahc, aFc'</span></span><br><span class=\"line\">r = re.findall(<span class=\"string\">'a[cf]c'</span>, s, re.I) <span class=\"comment\"># 忽略大小写</span></span><br><span class=\"line\">print(r) <span class=\"comment\"># ['acc', 'afc', 'aFc']</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"re-sub-正则替换\"><a href=\"#re-sub-正则替换\" class=\"headerlink\" title=\"re.sub 正则替换\"></a>re.sub 正则替换</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a = <span class=\"string\">'python 111java678php'</span></span><br><span class=\"line\">r1 = re.sub(<span class=\"string\">'\\w&#123;3,6&#125;'</span>, <span class=\"string\">\"hhh\"</span>, a, <span class=\"number\">1</span>)  <span class=\"comment\"># 最后一个参数1表示替换几个</span></span><br><span class=\"line\"></span><br><span class=\"line\">print(r1)  <span class=\"comment\"># hhh 111java678php</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">convert</span><span class=\"params\">(value)</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">'aa'</span> + value.group()  <span class=\"comment\"># value.group()为匹配到的字符串</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 第二个参数为一个函数，匹配到后会把匹配的结果传给函数执行，并把函数返回的结果作为替换字符串</span></span><br><span class=\"line\">r2 = re.sub(<span class=\"string\">'\\w&#123;3,6&#125;'</span>, convert, a)</span><br><span class=\"line\">print(r2)  <span class=\"comment\"># aapython 111java678php</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"match-与-search-函数\"><a href=\"#match-与-search-函数\" class=\"headerlink\" title=\"match 与 search 函数\"></a>match 与 search 函数</h3><ul>\n<li>match 函数：从字符串的首字母开始匹配，如果首字母没有匹配到则返回空</li>\n<li>search 函数：搜索字符串，知道找到第一个符合要求的字符串</li>\n<li>match 和 search 只匹配一个结果，findall 会匹配所有符合条件的字符串</li>\n</ul>\n<h3 id=\"group-分组\"><a href=\"#group-分组\" class=\"headerlink\" title=\"group 分组\"></a>group 分组</h3><ul>\n<li>使用括号进行分组</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">s = <span class=\"string\">'life is short, i use python, i love python'</span></span><br><span class=\"line\">r = re.search(<span class=\"string\">'life(.*)python(.*)python'</span>, s)</span><br><span class=\"line\">print(r.group(<span class=\"number\">0</span>)) <span class=\"comment\"># `life is short, i use python, i love python` (默认第0个分组为字符串本身)</span></span><br><span class=\"line\">print(r.group(<span class=\"number\">1</span>)) <span class=\"comment\"># ` is short, i use`</span></span><br><span class=\"line\">print(r.group(<span class=\"number\">2</span>)) <span class=\"comment\"># `, i love`</span></span><br><span class=\"line\">print(r.group(<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">2</span>)) <span class=\"comment\"># ('life is short, i use python, i love python', ' is short, i use ', ', i love ')</span></span><br><span class=\"line\">print(r.groups())  <span class=\"comment\"># (' is short, i use ', ', i love ') (不会返回完整字符串)</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"JSON\"><a href=\"#JSON\" class=\"headerlink\" title=\"JSON\"></a>JSON</h2><h3 id=\"理解-JSON\"><a href=\"#理解-JSON\" class=\"headerlink\" title=\"理解 JSON\"></a>理解 JSON</h3><ul>\n<li>JSON 是一种轻量级的数据格式</li>\n<li>字符串是 JSON 的表现形式</li>\n<li>JSON 字符串：符合 JSON 格式的字符串</li>\n<li>JSON 对象：Python 中没有 JSON 对象，JS 中有 JSON 对象</li>\n</ul>\n<h3 id=\"JSON-的特点\"><a href=\"#JSON-的特点\" class=\"headerlink\" title=\"JSON 的特点\"></a>JSON 的特点</h3><ul>\n<li>易于阅读</li>\n<li>易于解析</li>\n<li>网络传输效率高</li>\n<li>跨语言交换数据</li>\n</ul>\n<h3 id=\"反序列化\"><a href=\"#反序列化\" class=\"headerlink\" title=\"反序列化\"></a>反序列化</h3><ul>\n<li>Python 中会把 JSON 字符串解析成字典或列表</li>\n<li>Python 中的数据类型对应 JSON 中的数据类型：</li>\n</ul>\n<p><img src=\"http://blog.shicishuzhai.com/a222d6640d76f895c8ce620a3719dc4e.png\" alt=\"1\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> json</span><br><span class=\"line\"><span class=\"comment\"># 这里必须是里面是双引号，外面是单引号，false和true首字符必须小写</span></span><br><span class=\"line\">s = <span class=\"string\">'&#123;\"name\": \"ljl\", \"age\": 12, \"flag\": true&#125;'</span></span><br><span class=\"line\">a = json.loads(s)  <span class=\"comment\"># Python中会把JSON字符串解析成字典或列表</span></span><br><span class=\"line\">print(a) <span class=\"comment\"># &#123;'name': 'ljl', 'age': 12, 'flag': True&#125;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"序列化\"><a href=\"#序列化\" class=\"headerlink\" title=\"序列化\"></a>序列化</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">s1 = json.dumps(a)</span><br><span class=\"line\">print(s1)</span><br></pre></td></tr></table></figure>\n<h2 id=\"枚举\"><a href=\"#枚举\" class=\"headerlink\" title=\"枚举\"></a>枚举</h2><h3 id=\"枚举类型（Python3）\"><a href=\"#枚举类型（Python3）\" class=\"headerlink\" title=\"枚举类型（Python3）\"></a>枚举类型（Python3）</h3><ul>\n<li>枚举也是一个类</li>\n<li>枚举在 Python3 中才有，Python2 中没有枚举类</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> enum <span class=\"keyword\">import</span> Enum</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">VIP</span><span class=\"params\">(Enum)</span>:</span></span><br><span class=\"line\">    YELLOW = <span class=\"number\">1</span></span><br><span class=\"line\">    GREEN = <span class=\"number\">2</span></span><br><span class=\"line\">    BLACK = <span class=\"number\">3</span></span><br><span class=\"line\">    RED = <span class=\"number\">4</span></span><br><span class=\"line\"></span><br><span class=\"line\">print(VIP.YELLOW)  <span class=\"comment\"># VIP.YELLOW</span></span><br><span class=\"line\">print(VIP.YELLOW == VIP.GREEN)  <span class=\"comment\"># false</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"枚举的优势\"><a href=\"#枚举的优势\" class=\"headerlink\" title=\"枚举的优势\"></a>枚举的优势</h3><ul>\n<li>不可变</li>\n<li>值不会重复</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> enum <span class=\"keyword\">import</span> Enum</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">VIP</span><span class=\"params\">(Enum)</span>:</span></span><br><span class=\"line\">    YELLOW = <span class=\"number\">1</span></span><br><span class=\"line\">    GREEN = <span class=\"number\">2</span></span><br><span class=\"line\">    BLACK = <span class=\"number\">3</span></span><br><span class=\"line\">    RED = <span class=\"number\">4</span></span><br><span class=\"line\">    <span class=\"comment\"># BLACK = 5  # error</span></span><br><span class=\"line\">    YELLOW_ALIAS = <span class=\"number\">1</span> <span class=\"comment\"># YELLOW的别名</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">print(VIP.YELLOW)  <span class=\"comment\"># VIP.YELLOW</span></span><br><span class=\"line\">print(VIP.YELLOW == VIP.GREEN)  <span class=\"comment\"># false</span></span><br><span class=\"line\">VIP.YELLOW = <span class=\"number\">3</span>  <span class=\"comment\"># error，枚举的值不能改变</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"枚举的操作\"><a href=\"#枚举的操作\" class=\"headerlink\" title=\"枚举的操作\"></a>枚举的操作</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">print(VIP.YELLOW)  <span class=\"comment\"># VIP.YELLOW，枚举类型</span></span><br><span class=\"line\">print(VIP.YELLOW.value)  <span class=\"comment\"># 1，枚举的值</span></span><br><span class=\"line\">print(VIP.YELLOW.name)  <span class=\"comment\"># YELLOW，枚举的名字</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 枚举的遍历，遍历时别名不会遍历</span></span><br><span class=\"line\"><span class=\"comment\"># VIP.YELLOW</span></span><br><span class=\"line\"><span class=\"comment\"># VIP.GREEN</span></span><br><span class=\"line\"><span class=\"comment\"># VIP.BLACK</span></span><br><span class=\"line\"><span class=\"comment\"># VIP.RED</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> v <span class=\"keyword\">in</span> VIP:</span><br><span class=\"line\">    print(v)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 遍历枚举的所有值，包括别名</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> v <span class=\"keyword\">in</span> VIP.__members__:</span><br><span class=\"line\">    print(v)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 枚举的比较</span></span><br><span class=\"line\">print(VIP.YELLOW == VIP.GREEN) <span class=\"comment\"># false</span></span><br><span class=\"line\">print(VIP.YELLOW == VIP.YELLOW) <span class=\"comment\"># false</span></span><br><span class=\"line\">print(VIP.YELLOW == <span class=\"number\">1</span>)  <span class=\"comment\"># false</span></span><br><span class=\"line\"><span class=\"comment\"># print(VIP.YELLOW &lt; VIP.GREEN)  # error，枚举不可以进行大小比较</span></span><br><span class=\"line\">print(VIP.YELLOW.value == <span class=\"number\">1</span>)  <span class=\"comment\"># true</span></span><br><span class=\"line\">print(VIP.YELLOW == VIP.YELLOW_ALIAS)  <span class=\"comment\"># true</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"枚举的转换\"><a href=\"#枚举的转换\" class=\"headerlink\" title=\"枚举的转换\"></a>枚举的转换</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">VIP</span><span class=\"params\">(Enum)</span>:</span></span><br><span class=\"line\">    YELLOW = <span class=\"number\">1</span></span><br><span class=\"line\">    GREEN = <span class=\"number\">2</span></span><br><span class=\"line\">    BLACK = <span class=\"number\">3</span></span><br><span class=\"line\">    RED = <span class=\"number\">4</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">a = VIP(<span class=\"number\">1</span>)  <span class=\"comment\"># a 初始化为VIP.YELLOW</span></span><br><span class=\"line\">print(a) <span class=\"comment\"># VIP.YELLOW</span></span><br><span class=\"line\">print(a == VIP.YELLOW)  <span class=\"comment\"># true</span></span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"正则表达式\"><a href=\"#正则表达式\" class=\"headerlink\" title=\"正则表达式\"></a>正则表达式</h2><h3 id=\"正则表达式的定义\"><a href=\"#正则表达式的定义\" class=\"headerlink\" title=\"正则表达式的定义\"></a>正则表达式的定义</h3><ul>\n<li>定义：正则表达式是一个特殊的字符序列，一个字符串是否与我们所设定的这样的字符序列相匹配。</li>\n<li>作用：快速检索文本，实现一些替换文本的操作</li>\n<li>Python 中的正则表达式模块：re</li>\n</ul>\n<h3 id=\"元字符和普通字符\"><a href=\"#元字符和普通字符\" class=\"headerlink\" title=\"元字符和普通字符\"></a>元字符和普通字符</h3><ul>\n<li>普通字符：<code>abc</code></li>\n<li>元字符：<code>\\d, \\D, \\f, \\n</code>等，每种元字符都有不同的含义</li>\n<li>正则表达式就是普通字符和元字符组成的</li>\n</ul>\n<h3 id=\"字符集\"><a href=\"#字符集\" class=\"headerlink\" title=\"字符集\"></a>字符集</h3><ul>\n<li>中括号中的字符是<code>或</code>的关系</li>\n<li>取反使用<code>^</code></li>\n<li>范围：<code>[a-z], [a-zA-Z]</code></li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">s = <span class=\"string\">'abc, acc, adc, aec, afc, ahc'</span></span><br><span class=\"line\">r = re.findall(<span class=\"string\">'a[^cfC]c'</span>, s) <span class=\"comment\"># 表示已a开头，c结尾，中间的一个字母不是c,f,C中的任何一个</span></span><br><span class=\"line\">print(r) <span class=\"comment\"># ['abc', 'adc', 'aec', 'ahc']</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"概括字符集\"><a href=\"#概括字符集\" class=\"headerlink\" title=\"概括字符集\"></a>概括字符集</h3><ul>\n<li><code>\\d</code> 代表数字，相当于<code>[0-9]</code></li>\n<li><code>\\D</code> 代表非数字，相当于<code>[^0-9]</code></li>\n<li><code>\\w</code> 代表单词字符，相当于<code>[0-9a-zA-Z_]</code></li>\n<li><code>\\W</code> 代表非单词字符，相当于<code>[^0-9a-zA-Z_]</code></li>\n<li><code>\\s</code> 代表空白字符</li>\n<li><code>\\S</code> 代表非空白字符</li>\n<li><code>.</code> 代表除换行符的所有字符</li>\n</ul>\n<h3 id=\"数量词\"><a href=\"#数量词\" class=\"headerlink\" title=\"数量词\"></a>数量词</h3><ul>\n<li><code>[a-z]{3,6}</code> 匹配 3 到 6 次</li>\n</ul>\n<h3 id=\"贪婪和非贪婪\"><a href=\"#贪婪和非贪婪\" class=\"headerlink\" title=\"贪婪和非贪婪\"></a>贪婪和非贪婪</h3><ul>\n<li>贪婪：尽可能多的匹配，一直到不满足条件为止</li>\n<li>非贪婪：一旦满足条件就停止匹配</li>\n<li>Python 倾向于贪婪模式</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 匹配3-6个字母，贪婪模式下，会匹配尽可能多的字母，直到不满足条件，因此会匹配出['python', 'java', 'php']</span></span><br><span class=\"line\"><span class=\"comment\"># 非贪婪模式下会匹配3个字符，【'pyt', 'hon', 'jav', 'php']</span></span><br><span class=\"line\">a = <span class=\"string\">'python 111java678php'</span></span><br><span class=\"line\">r = re.findall(<span class=\"string\">'[a-z]&#123;3,6&#125;'</span>, a) <span class=\"comment\"># 贪婪模式</span></span><br><span class=\"line\">r = re.findall(<span class=\"string\">'[a-z]&#123;3,6&#125;?'</span>, a) <span class=\"comment\"># 非贪婪模式，加一个问号</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"匹配-0-次，1-次或无限次\"><a href=\"#匹配-0-次，1-次或无限次\" class=\"headerlink\" title=\"匹配 0 次，1 次或无限次\"></a>匹配 0 次，1 次或无限次</h3><ul>\n<li><code>*</code>匹配前面的字符 0 次或 n 次</li>\n<li><code>+</code>匹配前面的字符 1 次或 n 次</li>\n<li><code>?</code>匹配前面的字符 0 次或 1 次，要与非贪婪模式的问号区分</li>\n</ul>\n<h3 id=\"边界匹配符\"><a href=\"#边界匹配符\" class=\"headerlink\" title=\"边界匹配符\"></a>边界匹配符</h3><ul>\n<li><code>^</code>首部，<code>^000</code>开头三个字符为<code>000</code></li>\n<li><code>$</code>尾部，<code>000$</code>结尾三个字符为<code>000</code></li>\n</ul>\n<h3 id=\"组\"><a href=\"#组\" class=\"headerlink\" title=\"组\"></a>组</h3><ul>\n<li>一个括号对应一组，<code>(Python){3}</code>，把一个组重复 3 次</li>\n<li>组中的每个字符是且的关系</li>\n</ul>\n<h3 id=\"匹配模式参数\"><a href=\"#匹配模式参数\" class=\"headerlink\" title=\"匹配模式参数\"></a>匹配模式参数</h3><ul>\n<li>忽略字母大小写: <code>re.I</code></li>\n<li><code>.</code>表示匹配任意字符: <code>re.S</code></li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">s = <span class=\"string\">'abc, acc, adc, aec, afc, ahc, aFc'</span></span><br><span class=\"line\">r = re.findall(<span class=\"string\">'a[cf]c'</span>, s, re.I) <span class=\"comment\"># 忽略大小写</span></span><br><span class=\"line\">print(r) <span class=\"comment\"># ['acc', 'afc', 'aFc']</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"re-sub-正则替换\"><a href=\"#re-sub-正则替换\" class=\"headerlink\" title=\"re.sub 正则替换\"></a>re.sub 正则替换</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a = <span class=\"string\">'python 111java678php'</span></span><br><span class=\"line\">r1 = re.sub(<span class=\"string\">'\\w&#123;3,6&#125;'</span>, <span class=\"string\">\"hhh\"</span>, a, <span class=\"number\">1</span>)  <span class=\"comment\"># 最后一个参数1表示替换几个</span></span><br><span class=\"line\"></span><br><span class=\"line\">print(r1)  <span class=\"comment\"># hhh 111java678php</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">convert</span><span class=\"params\">(value)</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">'aa'</span> + value.group()  <span class=\"comment\"># value.group()为匹配到的字符串</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 第二个参数为一个函数，匹配到后会把匹配的结果传给函数执行，并把函数返回的结果作为替换字符串</span></span><br><span class=\"line\">r2 = re.sub(<span class=\"string\">'\\w&#123;3,6&#125;'</span>, convert, a)</span><br><span class=\"line\">print(r2)  <span class=\"comment\"># aapython 111java678php</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"match-与-search-函数\"><a href=\"#match-与-search-函数\" class=\"headerlink\" title=\"match 与 search 函数\"></a>match 与 search 函数</h3><ul>\n<li>match 函数：从字符串的首字母开始匹配，如果首字母没有匹配到则返回空</li>\n<li>search 函数：搜索字符串，知道找到第一个符合要求的字符串</li>\n<li>match 和 search 只匹配一个结果，findall 会匹配所有符合条件的字符串</li>\n</ul>\n<h3 id=\"group-分组\"><a href=\"#group-分组\" class=\"headerlink\" title=\"group 分组\"></a>group 分组</h3><ul>\n<li>使用括号进行分组</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">s = <span class=\"string\">'life is short, i use python, i love python'</span></span><br><span class=\"line\">r = re.search(<span class=\"string\">'life(.*)python(.*)python'</span>, s)</span><br><span class=\"line\">print(r.group(<span class=\"number\">0</span>)) <span class=\"comment\"># `life is short, i use python, i love python` (默认第0个分组为字符串本身)</span></span><br><span class=\"line\">print(r.group(<span class=\"number\">1</span>)) <span class=\"comment\"># ` is short, i use`</span></span><br><span class=\"line\">print(r.group(<span class=\"number\">2</span>)) <span class=\"comment\"># `, i love`</span></span><br><span class=\"line\">print(r.group(<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">2</span>)) <span class=\"comment\"># ('life is short, i use python, i love python', ' is short, i use ', ', i love ')</span></span><br><span class=\"line\">print(r.groups())  <span class=\"comment\"># (' is short, i use ', ', i love ') (不会返回完整字符串)</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"JSON\"><a href=\"#JSON\" class=\"headerlink\" title=\"JSON\"></a>JSON</h2><h3 id=\"理解-JSON\"><a href=\"#理解-JSON\" class=\"headerlink\" title=\"理解 JSON\"></a>理解 JSON</h3><ul>\n<li>JSON 是一种轻量级的数据格式</li>\n<li>字符串是 JSON 的表现形式</li>\n<li>JSON 字符串：符合 JSON 格式的字符串</li>\n<li>JSON 对象：Python 中没有 JSON 对象，JS 中有 JSON 对象</li>\n</ul>\n<h3 id=\"JSON-的特点\"><a href=\"#JSON-的特点\" class=\"headerlink\" title=\"JSON 的特点\"></a>JSON 的特点</h3><ul>\n<li>易于阅读</li>\n<li>易于解析</li>\n<li>网络传输效率高</li>\n<li>跨语言交换数据</li>\n</ul>\n<h3 id=\"反序列化\"><a href=\"#反序列化\" class=\"headerlink\" title=\"反序列化\"></a>反序列化</h3><ul>\n<li>Python 中会把 JSON 字符串解析成字典或列表</li>\n<li>Python 中的数据类型对应 JSON 中的数据类型：</li>\n</ul>\n<p><img src=\"http://blog.shicishuzhai.com/a222d6640d76f895c8ce620a3719dc4e.png\" alt=\"1\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> json</span><br><span class=\"line\"><span class=\"comment\"># 这里必须是里面是双引号，外面是单引号，false和true首字符必须小写</span></span><br><span class=\"line\">s = <span class=\"string\">'&#123;\"name\": \"ljl\", \"age\": 12, \"flag\": true&#125;'</span></span><br><span class=\"line\">a = json.loads(s)  <span class=\"comment\"># Python中会把JSON字符串解析成字典或列表</span></span><br><span class=\"line\">print(a) <span class=\"comment\"># &#123;'name': 'ljl', 'age': 12, 'flag': True&#125;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"序列化\"><a href=\"#序列化\" class=\"headerlink\" title=\"序列化\"></a>序列化</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">s1 = json.dumps(a)</span><br><span class=\"line\">print(s1)</span><br></pre></td></tr></table></figure>\n<h2 id=\"枚举\"><a href=\"#枚举\" class=\"headerlink\" title=\"枚举\"></a>枚举</h2><h3 id=\"枚举类型（Python3）\"><a href=\"#枚举类型（Python3）\" class=\"headerlink\" title=\"枚举类型（Python3）\"></a>枚举类型（Python3）</h3><ul>\n<li>枚举也是一个类</li>\n<li>枚举在 Python3 中才有，Python2 中没有枚举类</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> enum <span class=\"keyword\">import</span> Enum</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">VIP</span><span class=\"params\">(Enum)</span>:</span></span><br><span class=\"line\">    YELLOW = <span class=\"number\">1</span></span><br><span class=\"line\">    GREEN = <span class=\"number\">2</span></span><br><span class=\"line\">    BLACK = <span class=\"number\">3</span></span><br><span class=\"line\">    RED = <span class=\"number\">4</span></span><br><span class=\"line\"></span><br><span class=\"line\">print(VIP.YELLOW)  <span class=\"comment\"># VIP.YELLOW</span></span><br><span class=\"line\">print(VIP.YELLOW == VIP.GREEN)  <span class=\"comment\"># false</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"枚举的优势\"><a href=\"#枚举的优势\" class=\"headerlink\" title=\"枚举的优势\"></a>枚举的优势</h3><ul>\n<li>不可变</li>\n<li>值不会重复</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> enum <span class=\"keyword\">import</span> Enum</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">VIP</span><span class=\"params\">(Enum)</span>:</span></span><br><span class=\"line\">    YELLOW = <span class=\"number\">1</span></span><br><span class=\"line\">    GREEN = <span class=\"number\">2</span></span><br><span class=\"line\">    BLACK = <span class=\"number\">3</span></span><br><span class=\"line\">    RED = <span class=\"number\">4</span></span><br><span class=\"line\">    <span class=\"comment\"># BLACK = 5  # error</span></span><br><span class=\"line\">    YELLOW_ALIAS = <span class=\"number\">1</span> <span class=\"comment\"># YELLOW的别名</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">print(VIP.YELLOW)  <span class=\"comment\"># VIP.YELLOW</span></span><br><span class=\"line\">print(VIP.YELLOW == VIP.GREEN)  <span class=\"comment\"># false</span></span><br><span class=\"line\">VIP.YELLOW = <span class=\"number\">3</span>  <span class=\"comment\"># error，枚举的值不能改变</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"枚举的操作\"><a href=\"#枚举的操作\" class=\"headerlink\" title=\"枚举的操作\"></a>枚举的操作</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">print(VIP.YELLOW)  <span class=\"comment\"># VIP.YELLOW，枚举类型</span></span><br><span class=\"line\">print(VIP.YELLOW.value)  <span class=\"comment\"># 1，枚举的值</span></span><br><span class=\"line\">print(VIP.YELLOW.name)  <span class=\"comment\"># YELLOW，枚举的名字</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 枚举的遍历，遍历时别名不会遍历</span></span><br><span class=\"line\"><span class=\"comment\"># VIP.YELLOW</span></span><br><span class=\"line\"><span class=\"comment\"># VIP.GREEN</span></span><br><span class=\"line\"><span class=\"comment\"># VIP.BLACK</span></span><br><span class=\"line\"><span class=\"comment\"># VIP.RED</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> v <span class=\"keyword\">in</span> VIP:</span><br><span class=\"line\">    print(v)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 遍历枚举的所有值，包括别名</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> v <span class=\"keyword\">in</span> VIP.__members__:</span><br><span class=\"line\">    print(v)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 枚举的比较</span></span><br><span class=\"line\">print(VIP.YELLOW == VIP.GREEN) <span class=\"comment\"># false</span></span><br><span class=\"line\">print(VIP.YELLOW == VIP.YELLOW) <span class=\"comment\"># false</span></span><br><span class=\"line\">print(VIP.YELLOW == <span class=\"number\">1</span>)  <span class=\"comment\"># false</span></span><br><span class=\"line\"><span class=\"comment\"># print(VIP.YELLOW &lt; VIP.GREEN)  # error，枚举不可以进行大小比较</span></span><br><span class=\"line\">print(VIP.YELLOW.value == <span class=\"number\">1</span>)  <span class=\"comment\"># true</span></span><br><span class=\"line\">print(VIP.YELLOW == VIP.YELLOW_ALIAS)  <span class=\"comment\"># true</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"枚举的转换\"><a href=\"#枚举的转换\" class=\"headerlink\" title=\"枚举的转换\"></a>枚举的转换</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">VIP</span><span class=\"params\">(Enum)</span>:</span></span><br><span class=\"line\">    YELLOW = <span class=\"number\">1</span></span><br><span class=\"line\">    GREEN = <span class=\"number\">2</span></span><br><span class=\"line\">    BLACK = <span class=\"number\">3</span></span><br><span class=\"line\">    RED = <span class=\"number\">4</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">a = VIP(<span class=\"number\">1</span>)  <span class=\"comment\"># a 初始化为VIP.YELLOW</span></span><br><span class=\"line\">print(a) <span class=\"comment\"># VIP.YELLOW</span></span><br><span class=\"line\">print(a == VIP.YELLOW)  <span class=\"comment\"># true</span></span><br></pre></td></tr></table></figure>\n"},{"title":"Python学习笔记(6)","date":"2018-09-27T23:21:25.000Z","_content":"\n## 装饰器\n\n### 原始的装饰器模式\n\n- 下面的实例是在函数 f1 执行前打印一个时间\n\n```python\ndef decorator(func):\n def wrapper():\n   print(time.time())\n   func()\n return wrapper\n\ndef f1():\n print('hello world')\n\ndecorator(f1)()\n```\n\n### Python 中对于装饰器的语法糖\n\n```python\ndef decorator(func):\n def wrapper():\n   print(time.time())\n   func()\n return wrapper\n\n@decorator\ndef f1():\n print('hello world')\n\nf1()\n```\n\n### 带参数的装饰器\n\n```python\ndef decorator(func):\n def wrapper(func_name):\n   print(time.time())\n   func(func_name)\n return wrapper\n\n@decorator\ndef f1(func_name):\n print('hello world' + func_name)\n\nf1(\"ljl\")\n\n# 支持不同参数个数\nimport time\n\ndef decorator(func):\n def wrapper(*args):\n   print(time.time())\n   func(*args)\n return wrapper\n\n@decorator\ndef f1(func_name):\n print('hello world' + func_name)\n\n@decorator\ndef f2():\n print('hello world')\n\nf1(\"ljl\")\nf2()\n\n# 带关键字参数\ndef decorator(func):\n def wrapper(*args, **kw):\n   print(time.time())\n   func(*args, **kw)\n return wrapper\n\n @decorator\ndef f3(func_name, **kw):\n print('hello world' + func_name)\n print(kw)\n\nf1(\"ljl\")\nf2()\nf3(\"ljl\", a = 1, b = 2, c = 'ljl')\n```\n\n- 调用一个函数，如果不知道函数的参数，都可以用`func(*args, **kw)`这种形式调用，因此为了通用，装饰器的内部函数`wrapper`的参数就可以为这种形式\n\n### 装饰器带有参数\n\n- 如果装饰器带有参数，可以再在外面套一层函数\n\n```python\ndef log(text):\n    def decorator(func):\n        def wrapper(*args, **kw):\n            print('%s %s():' % (text, func.__name__))\n            return func(*args, **kw)\n        return wrapper\n    return decorator\n\n@log('execute')\ndef now():\n    print('2015-3-25')\n```\n\n## Python 的其他知识\n\n### 列表推导式\n\n- 列表推导式类似 map 或 filter 函数，是 Python 特有的语法\n\n```python\na = [1, 2, 3, 4, 5, 6, 7, 8]\nret1 = [i * i for i in a]\nprint(ret1) # [1, 4, 9, 16, 25, 36, 49, 64]\nret2 = [i * i for i in a if i >= 5]\nprint(ret2) # [25, 36, 49, 64]\na1 = {1, 2, 3, 4}\nret3 = {i * i for i in a1}\nprint(ret3) # {16, 1, 4, 9}\n\nstudents = {\n 'ljl': 12,\n 'lyb': 20,\n 'aaa': 11\n}\nret4 = [key for key, value in students.items()]\nprint(ret4) # ['ljl', 'lyb', 'aaa']\nret5 = {value: key for key, value in students.items()}\nprint(ret5) # {12: 'ljl', 20: 'lyb', 11: 'aaa'\nret6 = (key for key, value in students.items()) # 得到的是一个generator\n```\n\n### 迭代器与生成器\n\n#### 迭代器\n\n- 可迭代对象，可以被 for-in 遍历的对象，list, set 等\n- 迭代器，是一个对象\n- 迭代器有一次性的特征，只能遍历一次\n- 迭代器一定是一个可迭代对象，但是可迭代对象不一定是迭代器，例如 list 是可迭代对象，但 list 不是迭代器，因为 list 可以重复遍历\n\n```python\n# BookCollection就是一个自定义的可迭代对象\nclass BookCollection:\n def __init__(self):\n   self.data = [\"aaa\", \"bbb\", \"ccc\"]\n   self.cur = 0\n\n def __iter__(self):\n   return self\n\n def __next__(self):\n   if self.cur >= len(self.data):\n     raise StopIteration()\n   r = self.data[self.cur]\n   self.cur += 1\n   return r\n\nbooks = BookCollection()\nfor b in books:\n print(b)\n\nfor b in books:\n print(b)\n\n# 只会打印一次，第二次遍历无效，解决方法：\n# 1. 重新创建一个BookCollection对象\n# 2. copy\n```\n\n解决只能遍历一次的问题\n\n```python\nimport copy\nbooks_copy = copy.copy(books) # 浅复制\nbooks_copy2 = copy.deepcopy(books) # 深复制\n\nfor b in books:\n print(b)\n\nfor b in books_copy:\n print(b)\n\nfor b in books_copy2:\n print(b)\n```\n\n#### 生成器\n\n- 生成器是一个函数，主要是为了解决遍历时内存消耗过大的问题\n\n```python\ndef gen(max):\n  n = 0\n  while n <= max:\n    n += 1\n    yield n # 返回n，每次调用next接着这里执行\n\ng = gen(10000)\nprint(next(g)) # 1\nprint(next(g)) # 2\nprint(next(g)) # 3\nprint(next(g)) # 4\n```\n\n### None\n\n- None 表示空，不等于空字符串，空列表，false，0，如果是从类型还是比较运行算上都不相等\n- None 在作为条件判断时会转为 False\n\n```python\na = []\nb = False\nc = 0\nprint(None == a) # False\nprint(None == b) # False\nprint(None == c) # False\nprint(a is None) # False\nprint(b is None) # False\nprint(c is None) # False\n\n# 判断值为空\nif a:\n  pass\n\nif not a:\n  pass\n```\n\n- 自定义对象参与条件判断与内置的`__len__`与`__bool__`方法有关\n- 不存在`__bool__`时会调用`__len__`来判断对象时 True 还是 False，`__len__`返回 0 或 False，则对象为 False，否则对象为 True\n- 全局 len 函数就是调用对象的`__len__`\n- 如果有`__bool__`方法，则由`__bool__`方法来控制对象时 True 还是 False，`__bool__`只能返回 Bool 类型，`__len__`不再被调用\n\n### 装饰器的副作用\n\n- 添加装饰器后，函数的名字`__name__`会被改变\n\n```python\nimport time\n\ndef decorator(func):\n  def wrapper():\n    print(time.time())\n    func()\n  return wrapper\n\n@decorator\ndef f1():\n  print(f1.__name__)  # wrapper\n\nf1()\n```\n\n解决办法： 使用 wraps\n\n```python\nimport time\nfrom functools import wraps\n\ndef decorator(func):\n  @wraps(func)\n  def wrapper():\n    print(time.time())\n    func()\n  return wrapper\n\n@decorator\ndef f1():\n  print(f1.__name__)  # f1\n\nf1()\n```\n\n## 错误处理\n\n### Python 中的异常\n\n- Exception\n- AttributeError\n- IndexError\n- KeyError\n- NameError\n- SyntaxError\n- TypeError\n- ValueError\n- ZeroDivisionError\n\n### 错误处理\n\n```python\ntry:\n  a = 3 / 0\n  fn()\nexcept ZeroDivisionError:\n  print('Division by zero')\nexcept NameError:\n  print('Invalid Name')\nexcept:\n  printn('Defalut handler')\nelse:\n  # 没有错误时会调用\n  print('No errors')\nfinally:\n  print('Clean up actions')\n```\n","source":"_posts/2018-09-28-Python学习笔记-6.md","raw":"---\ntitle: Python学习笔记(6)\ncategories: Python\ntags:\n  - Python\ndate: 2018-09-28 07:21:25\n---\n\n## 装饰器\n\n### 原始的装饰器模式\n\n- 下面的实例是在函数 f1 执行前打印一个时间\n\n```python\ndef decorator(func):\n def wrapper():\n   print(time.time())\n   func()\n return wrapper\n\ndef f1():\n print('hello world')\n\ndecorator(f1)()\n```\n\n### Python 中对于装饰器的语法糖\n\n```python\ndef decorator(func):\n def wrapper():\n   print(time.time())\n   func()\n return wrapper\n\n@decorator\ndef f1():\n print('hello world')\n\nf1()\n```\n\n### 带参数的装饰器\n\n```python\ndef decorator(func):\n def wrapper(func_name):\n   print(time.time())\n   func(func_name)\n return wrapper\n\n@decorator\ndef f1(func_name):\n print('hello world' + func_name)\n\nf1(\"ljl\")\n\n# 支持不同参数个数\nimport time\n\ndef decorator(func):\n def wrapper(*args):\n   print(time.time())\n   func(*args)\n return wrapper\n\n@decorator\ndef f1(func_name):\n print('hello world' + func_name)\n\n@decorator\ndef f2():\n print('hello world')\n\nf1(\"ljl\")\nf2()\n\n# 带关键字参数\ndef decorator(func):\n def wrapper(*args, **kw):\n   print(time.time())\n   func(*args, **kw)\n return wrapper\n\n @decorator\ndef f3(func_name, **kw):\n print('hello world' + func_name)\n print(kw)\n\nf1(\"ljl\")\nf2()\nf3(\"ljl\", a = 1, b = 2, c = 'ljl')\n```\n\n- 调用一个函数，如果不知道函数的参数，都可以用`func(*args, **kw)`这种形式调用，因此为了通用，装饰器的内部函数`wrapper`的参数就可以为这种形式\n\n### 装饰器带有参数\n\n- 如果装饰器带有参数，可以再在外面套一层函数\n\n```python\ndef log(text):\n    def decorator(func):\n        def wrapper(*args, **kw):\n            print('%s %s():' % (text, func.__name__))\n            return func(*args, **kw)\n        return wrapper\n    return decorator\n\n@log('execute')\ndef now():\n    print('2015-3-25')\n```\n\n## Python 的其他知识\n\n### 列表推导式\n\n- 列表推导式类似 map 或 filter 函数，是 Python 特有的语法\n\n```python\na = [1, 2, 3, 4, 5, 6, 7, 8]\nret1 = [i * i for i in a]\nprint(ret1) # [1, 4, 9, 16, 25, 36, 49, 64]\nret2 = [i * i for i in a if i >= 5]\nprint(ret2) # [25, 36, 49, 64]\na1 = {1, 2, 3, 4}\nret3 = {i * i for i in a1}\nprint(ret3) # {16, 1, 4, 9}\n\nstudents = {\n 'ljl': 12,\n 'lyb': 20,\n 'aaa': 11\n}\nret4 = [key for key, value in students.items()]\nprint(ret4) # ['ljl', 'lyb', 'aaa']\nret5 = {value: key for key, value in students.items()}\nprint(ret5) # {12: 'ljl', 20: 'lyb', 11: 'aaa'\nret6 = (key for key, value in students.items()) # 得到的是一个generator\n```\n\n### 迭代器与生成器\n\n#### 迭代器\n\n- 可迭代对象，可以被 for-in 遍历的对象，list, set 等\n- 迭代器，是一个对象\n- 迭代器有一次性的特征，只能遍历一次\n- 迭代器一定是一个可迭代对象，但是可迭代对象不一定是迭代器，例如 list 是可迭代对象，但 list 不是迭代器，因为 list 可以重复遍历\n\n```python\n# BookCollection就是一个自定义的可迭代对象\nclass BookCollection:\n def __init__(self):\n   self.data = [\"aaa\", \"bbb\", \"ccc\"]\n   self.cur = 0\n\n def __iter__(self):\n   return self\n\n def __next__(self):\n   if self.cur >= len(self.data):\n     raise StopIteration()\n   r = self.data[self.cur]\n   self.cur += 1\n   return r\n\nbooks = BookCollection()\nfor b in books:\n print(b)\n\nfor b in books:\n print(b)\n\n# 只会打印一次，第二次遍历无效，解决方法：\n# 1. 重新创建一个BookCollection对象\n# 2. copy\n```\n\n解决只能遍历一次的问题\n\n```python\nimport copy\nbooks_copy = copy.copy(books) # 浅复制\nbooks_copy2 = copy.deepcopy(books) # 深复制\n\nfor b in books:\n print(b)\n\nfor b in books_copy:\n print(b)\n\nfor b in books_copy2:\n print(b)\n```\n\n#### 生成器\n\n- 生成器是一个函数，主要是为了解决遍历时内存消耗过大的问题\n\n```python\ndef gen(max):\n  n = 0\n  while n <= max:\n    n += 1\n    yield n # 返回n，每次调用next接着这里执行\n\ng = gen(10000)\nprint(next(g)) # 1\nprint(next(g)) # 2\nprint(next(g)) # 3\nprint(next(g)) # 4\n```\n\n### None\n\n- None 表示空，不等于空字符串，空列表，false，0，如果是从类型还是比较运行算上都不相等\n- None 在作为条件判断时会转为 False\n\n```python\na = []\nb = False\nc = 0\nprint(None == a) # False\nprint(None == b) # False\nprint(None == c) # False\nprint(a is None) # False\nprint(b is None) # False\nprint(c is None) # False\n\n# 判断值为空\nif a:\n  pass\n\nif not a:\n  pass\n```\n\n- 自定义对象参与条件判断与内置的`__len__`与`__bool__`方法有关\n- 不存在`__bool__`时会调用`__len__`来判断对象时 True 还是 False，`__len__`返回 0 或 False，则对象为 False，否则对象为 True\n- 全局 len 函数就是调用对象的`__len__`\n- 如果有`__bool__`方法，则由`__bool__`方法来控制对象时 True 还是 False，`__bool__`只能返回 Bool 类型，`__len__`不再被调用\n\n### 装饰器的副作用\n\n- 添加装饰器后，函数的名字`__name__`会被改变\n\n```python\nimport time\n\ndef decorator(func):\n  def wrapper():\n    print(time.time())\n    func()\n  return wrapper\n\n@decorator\ndef f1():\n  print(f1.__name__)  # wrapper\n\nf1()\n```\n\n解决办法： 使用 wraps\n\n```python\nimport time\nfrom functools import wraps\n\ndef decorator(func):\n  @wraps(func)\n  def wrapper():\n    print(time.time())\n    func()\n  return wrapper\n\n@decorator\ndef f1():\n  print(f1.__name__)  # f1\n\nf1()\n```\n\n## 错误处理\n\n### Python 中的异常\n\n- Exception\n- AttributeError\n- IndexError\n- KeyError\n- NameError\n- SyntaxError\n- TypeError\n- ValueError\n- ZeroDivisionError\n\n### 错误处理\n\n```python\ntry:\n  a = 3 / 0\n  fn()\nexcept ZeroDivisionError:\n  print('Division by zero')\nexcept NameError:\n  print('Invalid Name')\nexcept:\n  printn('Defalut handler')\nelse:\n  # 没有错误时会调用\n  print('No errors')\nfinally:\n  print('Clean up actions')\n```\n","slug":"Python学习笔记-6","published":1,"updated":"2018-10-01T02:45:12.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjutyfmgi004oc4c9mqcxyazw","content":"<h2 id=\"装饰器\"><a href=\"#装饰器\" class=\"headerlink\" title=\"装饰器\"></a>装饰器</h2><h3 id=\"原始的装饰器模式\"><a href=\"#原始的装饰器模式\" class=\"headerlink\" title=\"原始的装饰器模式\"></a>原始的装饰器模式</h3><ul>\n<li>下面的实例是在函数 f1 执行前打印一个时间</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">decorator</span><span class=\"params\">(func)</span>:</span></span><br><span class=\"line\"> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">wrapper</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">   print(time.time())</span><br><span class=\"line\">   func()</span><br><span class=\"line\"> <span class=\"keyword\">return</span> wrapper</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">f1</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\"> print(<span class=\"string\">'hello world'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">decorator(f1)()</span><br></pre></td></tr></table></figure>\n<h3 id=\"Python-中对于装饰器的语法糖\"><a href=\"#Python-中对于装饰器的语法糖\" class=\"headerlink\" title=\"Python 中对于装饰器的语法糖\"></a>Python 中对于装饰器的语法糖</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">decorator</span><span class=\"params\">(func)</span>:</span></span><br><span class=\"line\"> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">wrapper</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">   print(time.time())</span><br><span class=\"line\">   func()</span><br><span class=\"line\"> <span class=\"keyword\">return</span> wrapper</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@decorator</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">f1</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\"> print(<span class=\"string\">'hello world'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">f1()</span><br></pre></td></tr></table></figure>\n<h3 id=\"带参数的装饰器\"><a href=\"#带参数的装饰器\" class=\"headerlink\" title=\"带参数的装饰器\"></a>带参数的装饰器</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">decorator</span><span class=\"params\">(func)</span>:</span></span><br><span class=\"line\"> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">wrapper</span><span class=\"params\">(func_name)</span>:</span></span><br><span class=\"line\">   print(time.time())</span><br><span class=\"line\">   func(func_name)</span><br><span class=\"line\"> <span class=\"keyword\">return</span> wrapper</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@decorator</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">f1</span><span class=\"params\">(func_name)</span>:</span></span><br><span class=\"line\"> print(<span class=\"string\">'hello world'</span> + func_name)</span><br><span class=\"line\"></span><br><span class=\"line\">f1(<span class=\"string\">\"ljl\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 支持不同参数个数</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">decorator</span><span class=\"params\">(func)</span>:</span></span><br><span class=\"line\"> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">wrapper</span><span class=\"params\">(*args)</span>:</span></span><br><span class=\"line\">   print(time.time())</span><br><span class=\"line\">   func(*args)</span><br><span class=\"line\"> <span class=\"keyword\">return</span> wrapper</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@decorator</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">f1</span><span class=\"params\">(func_name)</span>:</span></span><br><span class=\"line\"> print(<span class=\"string\">'hello world'</span> + func_name)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@decorator</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">f2</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\"> print(<span class=\"string\">'hello world'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">f1(<span class=\"string\">\"ljl\"</span>)</span><br><span class=\"line\">f2()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 带关键字参数</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">decorator</span><span class=\"params\">(func)</span>:</span></span><br><span class=\"line\"> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">wrapper</span><span class=\"params\">(*args, **kw)</span>:</span></span><br><span class=\"line\">   print(time.time())</span><br><span class=\"line\">   func(*args, **kw)</span><br><span class=\"line\"> <span class=\"keyword\">return</span> wrapper</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\"> @decorator</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">f3</span><span class=\"params\">(func_name, **kw)</span>:</span></span><br><span class=\"line\"> print(<span class=\"string\">'hello world'</span> + func_name)</span><br><span class=\"line\"> print(kw)</span><br><span class=\"line\"></span><br><span class=\"line\">f1(<span class=\"string\">\"ljl\"</span>)</span><br><span class=\"line\">f2()</span><br><span class=\"line\">f3(<span class=\"string\">\"ljl\"</span>, a = <span class=\"number\">1</span>, b = <span class=\"number\">2</span>, c = <span class=\"string\">'ljl'</span>)</span><br></pre></td></tr></table></figure>\n<ul>\n<li>调用一个函数，如果不知道函数的参数，都可以用<code>func(*args, **kw)</code>这种形式调用，因此为了通用，装饰器的内部函数<code>wrapper</code>的参数就可以为这种形式</li>\n</ul>\n<h3 id=\"装饰器带有参数\"><a href=\"#装饰器带有参数\" class=\"headerlink\" title=\"装饰器带有参数\"></a>装饰器带有参数</h3><ul>\n<li>如果装饰器带有参数，可以再在外面套一层函数</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">log</span><span class=\"params\">(text)</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">decorator</span><span class=\"params\">(func)</span>:</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">wrapper</span><span class=\"params\">(*args, **kw)</span>:</span></span><br><span class=\"line\">            print(<span class=\"string\">'%s %s():'</span> % (text, func.__name__))</span><br><span class=\"line\">            <span class=\"keyword\">return</span> func(*args, **kw)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> wrapper</span><br><span class=\"line\">    <span class=\"keyword\">return</span> decorator</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@log('execute')</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">now</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    print(<span class=\"string\">'2015-3-25'</span>)</span><br></pre></td></tr></table></figure>\n<h2 id=\"Python-的其他知识\"><a href=\"#Python-的其他知识\" class=\"headerlink\" title=\"Python 的其他知识\"></a>Python 的其他知识</h2><h3 id=\"列表推导式\"><a href=\"#列表推导式\" class=\"headerlink\" title=\"列表推导式\"></a>列表推导式</h3><ul>\n<li>列表推导式类似 map 或 filter 函数，是 Python 特有的语法</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"number\">6</span>, <span class=\"number\">7</span>, <span class=\"number\">8</span>]</span><br><span class=\"line\">ret1 = [i * i <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> a]</span><br><span class=\"line\">print(ret1) <span class=\"comment\"># [1, 4, 9, 16, 25, 36, 49, 64]</span></span><br><span class=\"line\">ret2 = [i * i <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> a <span class=\"keyword\">if</span> i &gt;= <span class=\"number\">5</span>]</span><br><span class=\"line\">print(ret2) <span class=\"comment\"># [25, 36, 49, 64]</span></span><br><span class=\"line\">a1 = &#123;<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>&#125;</span><br><span class=\"line\">ret3 = &#123;i * i <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> a1&#125;</span><br><span class=\"line\">print(ret3) <span class=\"comment\"># &#123;16, 1, 4, 9&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">students = &#123;</span><br><span class=\"line\"> <span class=\"string\">'ljl'</span>: <span class=\"number\">12</span>,</span><br><span class=\"line\"> <span class=\"string\">'lyb'</span>: <span class=\"number\">20</span>,</span><br><span class=\"line\"> <span class=\"string\">'aaa'</span>: <span class=\"number\">11</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">ret4 = [key <span class=\"keyword\">for</span> key, value <span class=\"keyword\">in</span> students.items()]</span><br><span class=\"line\">print(ret4) <span class=\"comment\"># ['ljl', 'lyb', 'aaa']</span></span><br><span class=\"line\">ret5 = &#123;value: key <span class=\"keyword\">for</span> key, value <span class=\"keyword\">in</span> students.items()&#125;</span><br><span class=\"line\">print(ret5) <span class=\"comment\"># &#123;12: 'ljl', 20: 'lyb', 11: 'aaa'</span></span><br><span class=\"line\">ret6 = (key <span class=\"keyword\">for</span> key, value <span class=\"keyword\">in</span> students.items()) <span class=\"comment\"># 得到的是一个generator</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"迭代器与生成器\"><a href=\"#迭代器与生成器\" class=\"headerlink\" title=\"迭代器与生成器\"></a>迭代器与生成器</h3><h4 id=\"迭代器\"><a href=\"#迭代器\" class=\"headerlink\" title=\"迭代器\"></a>迭代器</h4><ul>\n<li>可迭代对象，可以被 for-in 遍历的对象，list, set 等</li>\n<li>迭代器，是一个对象</li>\n<li>迭代器有一次性的特征，只能遍历一次</li>\n<li>迭代器一定是一个可迭代对象，但是可迭代对象不一定是迭代器，例如 list 是可迭代对象，但 list 不是迭代器，因为 list 可以重复遍历</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># BookCollection就是一个自定义的可迭代对象</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BookCollection</span>:</span></span><br><span class=\"line\"> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">   self.data = [<span class=\"string\">\"aaa\"</span>, <span class=\"string\">\"bbb\"</span>, <span class=\"string\">\"ccc\"</span>]</span><br><span class=\"line\">   self.cur = <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__iter__</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">   <span class=\"keyword\">return</span> self</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__next__</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">   <span class=\"keyword\">if</span> self.cur &gt;= len(self.data):</span><br><span class=\"line\">     <span class=\"keyword\">raise</span> StopIteration()</span><br><span class=\"line\">   r = self.data[self.cur]</span><br><span class=\"line\">   self.cur += <span class=\"number\">1</span></span><br><span class=\"line\">   <span class=\"keyword\">return</span> r</span><br><span class=\"line\"></span><br><span class=\"line\">books = BookCollection()</span><br><span class=\"line\"><span class=\"keyword\">for</span> b <span class=\"keyword\">in</span> books:</span><br><span class=\"line\"> print(b)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> b <span class=\"keyword\">in</span> books:</span><br><span class=\"line\"> print(b)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 只会打印一次，第二次遍历无效，解决方法：</span></span><br><span class=\"line\"><span class=\"comment\"># 1. 重新创建一个BookCollection对象</span></span><br><span class=\"line\"><span class=\"comment\"># 2. copy</span></span><br></pre></td></tr></table></figure>\n<p>解决只能遍历一次的问题</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> copy</span><br><span class=\"line\">books_copy = copy.copy(books) <span class=\"comment\"># 浅复制</span></span><br><span class=\"line\">books_copy2 = copy.deepcopy(books) <span class=\"comment\"># 深复制</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> b <span class=\"keyword\">in</span> books:</span><br><span class=\"line\"> print(b)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> b <span class=\"keyword\">in</span> books_copy:</span><br><span class=\"line\"> print(b)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> b <span class=\"keyword\">in</span> books_copy2:</span><br><span class=\"line\"> print(b)</span><br></pre></td></tr></table></figure>\n<h4 id=\"生成器\"><a href=\"#生成器\" class=\"headerlink\" title=\"生成器\"></a>生成器</h4><ul>\n<li>生成器是一个函数，主要是为了解决遍历时内存消耗过大的问题</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">gen</span><span class=\"params\">(max)</span>:</span></span><br><span class=\"line\">  n = <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"keyword\">while</span> n &lt;= max:</span><br><span class=\"line\">    n += <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">yield</span> n <span class=\"comment\"># 返回n，每次调用next接着这里执行</span></span><br><span class=\"line\"></span><br><span class=\"line\">g = gen(<span class=\"number\">10000</span>)</span><br><span class=\"line\">print(next(g)) <span class=\"comment\"># 1</span></span><br><span class=\"line\">print(next(g)) <span class=\"comment\"># 2</span></span><br><span class=\"line\">print(next(g)) <span class=\"comment\"># 3</span></span><br><span class=\"line\">print(next(g)) <span class=\"comment\"># 4</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"None\"><a href=\"#None\" class=\"headerlink\" title=\"None\"></a>None</h3><ul>\n<li>None 表示空，不等于空字符串，空列表，false，0，如果是从类型还是比较运行算上都不相等</li>\n<li>None 在作为条件判断时会转为 False</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a = []</span><br><span class=\"line\">b = <span class=\"keyword\">False</span></span><br><span class=\"line\">c = <span class=\"number\">0</span></span><br><span class=\"line\">print(<span class=\"keyword\">None</span> == a) <span class=\"comment\"># False</span></span><br><span class=\"line\">print(<span class=\"keyword\">None</span> == b) <span class=\"comment\"># False</span></span><br><span class=\"line\">print(<span class=\"keyword\">None</span> == c) <span class=\"comment\"># False</span></span><br><span class=\"line\">print(a <span class=\"keyword\">is</span> <span class=\"keyword\">None</span>) <span class=\"comment\"># False</span></span><br><span class=\"line\">print(b <span class=\"keyword\">is</span> <span class=\"keyword\">None</span>) <span class=\"comment\"># False</span></span><br><span class=\"line\">print(c <span class=\"keyword\">is</span> <span class=\"keyword\">None</span>) <span class=\"comment\"># False</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 判断值为空</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> a:</span><br><span class=\"line\">  <span class=\"keyword\">pass</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"keyword\">not</span> a:</span><br><span class=\"line\">  <span class=\"keyword\">pass</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>自定义对象参与条件判断与内置的<code>__len__</code>与<code>__bool__</code>方法有关</li>\n<li>不存在<code>__bool__</code>时会调用<code>__len__</code>来判断对象时 True 还是 False，<code>__len__</code>返回 0 或 False，则对象为 False，否则对象为 True</li>\n<li>全局 len 函数就是调用对象的<code>__len__</code></li>\n<li>如果有<code>__bool__</code>方法，则由<code>__bool__</code>方法来控制对象时 True 还是 False，<code>__bool__</code>只能返回 Bool 类型，<code>__len__</code>不再被调用</li>\n</ul>\n<h3 id=\"装饰器的副作用\"><a href=\"#装饰器的副作用\" class=\"headerlink\" title=\"装饰器的副作用\"></a>装饰器的副作用</h3><ul>\n<li>添加装饰器后，函数的名字<code>__name__</code>会被改变</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">decorator</span><span class=\"params\">(func)</span>:</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">wrapper</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    print(time.time())</span><br><span class=\"line\">    func()</span><br><span class=\"line\">  <span class=\"keyword\">return</span> wrapper</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@decorator</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">f1</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">  print(f1.__name__)  <span class=\"comment\"># wrapper</span></span><br><span class=\"line\"></span><br><span class=\"line\">f1()</span><br></pre></td></tr></table></figure>\n<p>解决办法： 使用 wraps</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"><span class=\"keyword\">from</span> functools <span class=\"keyword\">import</span> wraps</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">decorator</span><span class=\"params\">(func)</span>:</span></span><br><span class=\"line\"><span class=\"meta\">  @wraps(func)</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">wrapper</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    print(time.time())</span><br><span class=\"line\">    func()</span><br><span class=\"line\">  <span class=\"keyword\">return</span> wrapper</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@decorator</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">f1</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">  print(f1.__name__)  <span class=\"comment\"># f1</span></span><br><span class=\"line\"></span><br><span class=\"line\">f1()</span><br></pre></td></tr></table></figure>\n<h2 id=\"错误处理\"><a href=\"#错误处理\" class=\"headerlink\" title=\"错误处理\"></a>错误处理</h2><h3 id=\"Python-中的异常\"><a href=\"#Python-中的异常\" class=\"headerlink\" title=\"Python 中的异常\"></a>Python 中的异常</h3><ul>\n<li>Exception</li>\n<li>AttributeError</li>\n<li>IndexError</li>\n<li>KeyError</li>\n<li>NameError</li>\n<li>SyntaxError</li>\n<li>TypeError</li>\n<li>ValueError</li>\n<li>ZeroDivisionError</li>\n</ul>\n<h3 id=\"错误处理-1\"><a href=\"#错误处理-1\" class=\"headerlink\" title=\"错误处理\"></a>错误处理</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">try</span>:</span><br><span class=\"line\">  a = <span class=\"number\">3</span> / <span class=\"number\">0</span></span><br><span class=\"line\">  fn()</span><br><span class=\"line\"><span class=\"keyword\">except</span> ZeroDivisionError:</span><br><span class=\"line\">  print(<span class=\"string\">'Division by zero'</span>)</span><br><span class=\"line\"><span class=\"keyword\">except</span> NameError:</span><br><span class=\"line\">  print(<span class=\"string\">'Invalid Name'</span>)</span><br><span class=\"line\"><span class=\"keyword\">except</span>:</span><br><span class=\"line\">  printn(<span class=\"string\">'Defalut handler'</span>)</span><br><span class=\"line\"><span class=\"keyword\">else</span>:</span><br><span class=\"line\">  <span class=\"comment\"># 没有错误时会调用</span></span><br><span class=\"line\">  print(<span class=\"string\">'No errors'</span>)</span><br><span class=\"line\"><span class=\"keyword\">finally</span>:</span><br><span class=\"line\">  print(<span class=\"string\">'Clean up actions'</span>)</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"装饰器\"><a href=\"#装饰器\" class=\"headerlink\" title=\"装饰器\"></a>装饰器</h2><h3 id=\"原始的装饰器模式\"><a href=\"#原始的装饰器模式\" class=\"headerlink\" title=\"原始的装饰器模式\"></a>原始的装饰器模式</h3><ul>\n<li>下面的实例是在函数 f1 执行前打印一个时间</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">decorator</span><span class=\"params\">(func)</span>:</span></span><br><span class=\"line\"> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">wrapper</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">   print(time.time())</span><br><span class=\"line\">   func()</span><br><span class=\"line\"> <span class=\"keyword\">return</span> wrapper</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">f1</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\"> print(<span class=\"string\">'hello world'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">decorator(f1)()</span><br></pre></td></tr></table></figure>\n<h3 id=\"Python-中对于装饰器的语法糖\"><a href=\"#Python-中对于装饰器的语法糖\" class=\"headerlink\" title=\"Python 中对于装饰器的语法糖\"></a>Python 中对于装饰器的语法糖</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">decorator</span><span class=\"params\">(func)</span>:</span></span><br><span class=\"line\"> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">wrapper</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">   print(time.time())</span><br><span class=\"line\">   func()</span><br><span class=\"line\"> <span class=\"keyword\">return</span> wrapper</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@decorator</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">f1</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\"> print(<span class=\"string\">'hello world'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">f1()</span><br></pre></td></tr></table></figure>\n<h3 id=\"带参数的装饰器\"><a href=\"#带参数的装饰器\" class=\"headerlink\" title=\"带参数的装饰器\"></a>带参数的装饰器</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">decorator</span><span class=\"params\">(func)</span>:</span></span><br><span class=\"line\"> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">wrapper</span><span class=\"params\">(func_name)</span>:</span></span><br><span class=\"line\">   print(time.time())</span><br><span class=\"line\">   func(func_name)</span><br><span class=\"line\"> <span class=\"keyword\">return</span> wrapper</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@decorator</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">f1</span><span class=\"params\">(func_name)</span>:</span></span><br><span class=\"line\"> print(<span class=\"string\">'hello world'</span> + func_name)</span><br><span class=\"line\"></span><br><span class=\"line\">f1(<span class=\"string\">\"ljl\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 支持不同参数个数</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">decorator</span><span class=\"params\">(func)</span>:</span></span><br><span class=\"line\"> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">wrapper</span><span class=\"params\">(*args)</span>:</span></span><br><span class=\"line\">   print(time.time())</span><br><span class=\"line\">   func(*args)</span><br><span class=\"line\"> <span class=\"keyword\">return</span> wrapper</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@decorator</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">f1</span><span class=\"params\">(func_name)</span>:</span></span><br><span class=\"line\"> print(<span class=\"string\">'hello world'</span> + func_name)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@decorator</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">f2</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\"> print(<span class=\"string\">'hello world'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">f1(<span class=\"string\">\"ljl\"</span>)</span><br><span class=\"line\">f2()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 带关键字参数</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">decorator</span><span class=\"params\">(func)</span>:</span></span><br><span class=\"line\"> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">wrapper</span><span class=\"params\">(*args, **kw)</span>:</span></span><br><span class=\"line\">   print(time.time())</span><br><span class=\"line\">   func(*args, **kw)</span><br><span class=\"line\"> <span class=\"keyword\">return</span> wrapper</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\"> @decorator</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">f3</span><span class=\"params\">(func_name, **kw)</span>:</span></span><br><span class=\"line\"> print(<span class=\"string\">'hello world'</span> + func_name)</span><br><span class=\"line\"> print(kw)</span><br><span class=\"line\"></span><br><span class=\"line\">f1(<span class=\"string\">\"ljl\"</span>)</span><br><span class=\"line\">f2()</span><br><span class=\"line\">f3(<span class=\"string\">\"ljl\"</span>, a = <span class=\"number\">1</span>, b = <span class=\"number\">2</span>, c = <span class=\"string\">'ljl'</span>)</span><br></pre></td></tr></table></figure>\n<ul>\n<li>调用一个函数，如果不知道函数的参数，都可以用<code>func(*args, **kw)</code>这种形式调用，因此为了通用，装饰器的内部函数<code>wrapper</code>的参数就可以为这种形式</li>\n</ul>\n<h3 id=\"装饰器带有参数\"><a href=\"#装饰器带有参数\" class=\"headerlink\" title=\"装饰器带有参数\"></a>装饰器带有参数</h3><ul>\n<li>如果装饰器带有参数，可以再在外面套一层函数</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">log</span><span class=\"params\">(text)</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">decorator</span><span class=\"params\">(func)</span>:</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">wrapper</span><span class=\"params\">(*args, **kw)</span>:</span></span><br><span class=\"line\">            print(<span class=\"string\">'%s %s():'</span> % (text, func.__name__))</span><br><span class=\"line\">            <span class=\"keyword\">return</span> func(*args, **kw)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> wrapper</span><br><span class=\"line\">    <span class=\"keyword\">return</span> decorator</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@log('execute')</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">now</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    print(<span class=\"string\">'2015-3-25'</span>)</span><br></pre></td></tr></table></figure>\n<h2 id=\"Python-的其他知识\"><a href=\"#Python-的其他知识\" class=\"headerlink\" title=\"Python 的其他知识\"></a>Python 的其他知识</h2><h3 id=\"列表推导式\"><a href=\"#列表推导式\" class=\"headerlink\" title=\"列表推导式\"></a>列表推导式</h3><ul>\n<li>列表推导式类似 map 或 filter 函数，是 Python 特有的语法</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"number\">6</span>, <span class=\"number\">7</span>, <span class=\"number\">8</span>]</span><br><span class=\"line\">ret1 = [i * i <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> a]</span><br><span class=\"line\">print(ret1) <span class=\"comment\"># [1, 4, 9, 16, 25, 36, 49, 64]</span></span><br><span class=\"line\">ret2 = [i * i <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> a <span class=\"keyword\">if</span> i &gt;= <span class=\"number\">5</span>]</span><br><span class=\"line\">print(ret2) <span class=\"comment\"># [25, 36, 49, 64]</span></span><br><span class=\"line\">a1 = &#123;<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>&#125;</span><br><span class=\"line\">ret3 = &#123;i * i <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> a1&#125;</span><br><span class=\"line\">print(ret3) <span class=\"comment\"># &#123;16, 1, 4, 9&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">students = &#123;</span><br><span class=\"line\"> <span class=\"string\">'ljl'</span>: <span class=\"number\">12</span>,</span><br><span class=\"line\"> <span class=\"string\">'lyb'</span>: <span class=\"number\">20</span>,</span><br><span class=\"line\"> <span class=\"string\">'aaa'</span>: <span class=\"number\">11</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">ret4 = [key <span class=\"keyword\">for</span> key, value <span class=\"keyword\">in</span> students.items()]</span><br><span class=\"line\">print(ret4) <span class=\"comment\"># ['ljl', 'lyb', 'aaa']</span></span><br><span class=\"line\">ret5 = &#123;value: key <span class=\"keyword\">for</span> key, value <span class=\"keyword\">in</span> students.items()&#125;</span><br><span class=\"line\">print(ret5) <span class=\"comment\"># &#123;12: 'ljl', 20: 'lyb', 11: 'aaa'</span></span><br><span class=\"line\">ret6 = (key <span class=\"keyword\">for</span> key, value <span class=\"keyword\">in</span> students.items()) <span class=\"comment\"># 得到的是一个generator</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"迭代器与生成器\"><a href=\"#迭代器与生成器\" class=\"headerlink\" title=\"迭代器与生成器\"></a>迭代器与生成器</h3><h4 id=\"迭代器\"><a href=\"#迭代器\" class=\"headerlink\" title=\"迭代器\"></a>迭代器</h4><ul>\n<li>可迭代对象，可以被 for-in 遍历的对象，list, set 等</li>\n<li>迭代器，是一个对象</li>\n<li>迭代器有一次性的特征，只能遍历一次</li>\n<li>迭代器一定是一个可迭代对象，但是可迭代对象不一定是迭代器，例如 list 是可迭代对象，但 list 不是迭代器，因为 list 可以重复遍历</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># BookCollection就是一个自定义的可迭代对象</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BookCollection</span>:</span></span><br><span class=\"line\"> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">   self.data = [<span class=\"string\">\"aaa\"</span>, <span class=\"string\">\"bbb\"</span>, <span class=\"string\">\"ccc\"</span>]</span><br><span class=\"line\">   self.cur = <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__iter__</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">   <span class=\"keyword\">return</span> self</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__next__</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">   <span class=\"keyword\">if</span> self.cur &gt;= len(self.data):</span><br><span class=\"line\">     <span class=\"keyword\">raise</span> StopIteration()</span><br><span class=\"line\">   r = self.data[self.cur]</span><br><span class=\"line\">   self.cur += <span class=\"number\">1</span></span><br><span class=\"line\">   <span class=\"keyword\">return</span> r</span><br><span class=\"line\"></span><br><span class=\"line\">books = BookCollection()</span><br><span class=\"line\"><span class=\"keyword\">for</span> b <span class=\"keyword\">in</span> books:</span><br><span class=\"line\"> print(b)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> b <span class=\"keyword\">in</span> books:</span><br><span class=\"line\"> print(b)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 只会打印一次，第二次遍历无效，解决方法：</span></span><br><span class=\"line\"><span class=\"comment\"># 1. 重新创建一个BookCollection对象</span></span><br><span class=\"line\"><span class=\"comment\"># 2. copy</span></span><br></pre></td></tr></table></figure>\n<p>解决只能遍历一次的问题</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> copy</span><br><span class=\"line\">books_copy = copy.copy(books) <span class=\"comment\"># 浅复制</span></span><br><span class=\"line\">books_copy2 = copy.deepcopy(books) <span class=\"comment\"># 深复制</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> b <span class=\"keyword\">in</span> books:</span><br><span class=\"line\"> print(b)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> b <span class=\"keyword\">in</span> books_copy:</span><br><span class=\"line\"> print(b)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> b <span class=\"keyword\">in</span> books_copy2:</span><br><span class=\"line\"> print(b)</span><br></pre></td></tr></table></figure>\n<h4 id=\"生成器\"><a href=\"#生成器\" class=\"headerlink\" title=\"生成器\"></a>生成器</h4><ul>\n<li>生成器是一个函数，主要是为了解决遍历时内存消耗过大的问题</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">gen</span><span class=\"params\">(max)</span>:</span></span><br><span class=\"line\">  n = <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"keyword\">while</span> n &lt;= max:</span><br><span class=\"line\">    n += <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">yield</span> n <span class=\"comment\"># 返回n，每次调用next接着这里执行</span></span><br><span class=\"line\"></span><br><span class=\"line\">g = gen(<span class=\"number\">10000</span>)</span><br><span class=\"line\">print(next(g)) <span class=\"comment\"># 1</span></span><br><span class=\"line\">print(next(g)) <span class=\"comment\"># 2</span></span><br><span class=\"line\">print(next(g)) <span class=\"comment\"># 3</span></span><br><span class=\"line\">print(next(g)) <span class=\"comment\"># 4</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"None\"><a href=\"#None\" class=\"headerlink\" title=\"None\"></a>None</h3><ul>\n<li>None 表示空，不等于空字符串，空列表，false，0，如果是从类型还是比较运行算上都不相等</li>\n<li>None 在作为条件判断时会转为 False</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a = []</span><br><span class=\"line\">b = <span class=\"keyword\">False</span></span><br><span class=\"line\">c = <span class=\"number\">0</span></span><br><span class=\"line\">print(<span class=\"keyword\">None</span> == a) <span class=\"comment\"># False</span></span><br><span class=\"line\">print(<span class=\"keyword\">None</span> == b) <span class=\"comment\"># False</span></span><br><span class=\"line\">print(<span class=\"keyword\">None</span> == c) <span class=\"comment\"># False</span></span><br><span class=\"line\">print(a <span class=\"keyword\">is</span> <span class=\"keyword\">None</span>) <span class=\"comment\"># False</span></span><br><span class=\"line\">print(b <span class=\"keyword\">is</span> <span class=\"keyword\">None</span>) <span class=\"comment\"># False</span></span><br><span class=\"line\">print(c <span class=\"keyword\">is</span> <span class=\"keyword\">None</span>) <span class=\"comment\"># False</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 判断值为空</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> a:</span><br><span class=\"line\">  <span class=\"keyword\">pass</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"keyword\">not</span> a:</span><br><span class=\"line\">  <span class=\"keyword\">pass</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>自定义对象参与条件判断与内置的<code>__len__</code>与<code>__bool__</code>方法有关</li>\n<li>不存在<code>__bool__</code>时会调用<code>__len__</code>来判断对象时 True 还是 False，<code>__len__</code>返回 0 或 False，则对象为 False，否则对象为 True</li>\n<li>全局 len 函数就是调用对象的<code>__len__</code></li>\n<li>如果有<code>__bool__</code>方法，则由<code>__bool__</code>方法来控制对象时 True 还是 False，<code>__bool__</code>只能返回 Bool 类型，<code>__len__</code>不再被调用</li>\n</ul>\n<h3 id=\"装饰器的副作用\"><a href=\"#装饰器的副作用\" class=\"headerlink\" title=\"装饰器的副作用\"></a>装饰器的副作用</h3><ul>\n<li>添加装饰器后，函数的名字<code>__name__</code>会被改变</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">decorator</span><span class=\"params\">(func)</span>:</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">wrapper</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    print(time.time())</span><br><span class=\"line\">    func()</span><br><span class=\"line\">  <span class=\"keyword\">return</span> wrapper</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@decorator</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">f1</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">  print(f1.__name__)  <span class=\"comment\"># wrapper</span></span><br><span class=\"line\"></span><br><span class=\"line\">f1()</span><br></pre></td></tr></table></figure>\n<p>解决办法： 使用 wraps</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"><span class=\"keyword\">from</span> functools <span class=\"keyword\">import</span> wraps</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">decorator</span><span class=\"params\">(func)</span>:</span></span><br><span class=\"line\"><span class=\"meta\">  @wraps(func)</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">wrapper</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    print(time.time())</span><br><span class=\"line\">    func()</span><br><span class=\"line\">  <span class=\"keyword\">return</span> wrapper</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@decorator</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">f1</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">  print(f1.__name__)  <span class=\"comment\"># f1</span></span><br><span class=\"line\"></span><br><span class=\"line\">f1()</span><br></pre></td></tr></table></figure>\n<h2 id=\"错误处理\"><a href=\"#错误处理\" class=\"headerlink\" title=\"错误处理\"></a>错误处理</h2><h3 id=\"Python-中的异常\"><a href=\"#Python-中的异常\" class=\"headerlink\" title=\"Python 中的异常\"></a>Python 中的异常</h3><ul>\n<li>Exception</li>\n<li>AttributeError</li>\n<li>IndexError</li>\n<li>KeyError</li>\n<li>NameError</li>\n<li>SyntaxError</li>\n<li>TypeError</li>\n<li>ValueError</li>\n<li>ZeroDivisionError</li>\n</ul>\n<h3 id=\"错误处理-1\"><a href=\"#错误处理-1\" class=\"headerlink\" title=\"错误处理\"></a>错误处理</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">try</span>:</span><br><span class=\"line\">  a = <span class=\"number\">3</span> / <span class=\"number\">0</span></span><br><span class=\"line\">  fn()</span><br><span class=\"line\"><span class=\"keyword\">except</span> ZeroDivisionError:</span><br><span class=\"line\">  print(<span class=\"string\">'Division by zero'</span>)</span><br><span class=\"line\"><span class=\"keyword\">except</span> NameError:</span><br><span class=\"line\">  print(<span class=\"string\">'Invalid Name'</span>)</span><br><span class=\"line\"><span class=\"keyword\">except</span>:</span><br><span class=\"line\">  printn(<span class=\"string\">'Defalut handler'</span>)</span><br><span class=\"line\"><span class=\"keyword\">else</span>:</span><br><span class=\"line\">  <span class=\"comment\"># 没有错误时会调用</span></span><br><span class=\"line\">  print(<span class=\"string\">'No errors'</span>)</span><br><span class=\"line\"><span class=\"keyword\">finally</span>:</span><br><span class=\"line\">  print(<span class=\"string\">'Clean up actions'</span>)</span><br></pre></td></tr></table></figure>\n"},{"title":"日本五日游","date":"2018-09-18T23:01:12.000Z","_content":"\n上周公司组织了去日本旅游（5 天 4 晚），这篇博客主要记录一下我在日本的见闻以及一些感受。\n\n我们是上周五（2018-9-14）早上 9 点出发，到东京成田机场是下午 3 点左右。刚到机场就感受到了很多不一样的东西。\n\n首先是随处可见的自动贩卖机\n\n![1](http://blog.shicishuzhai.com/b99ccb803b24538dcd01dc05ca616590.png)\n\n跟国内不一样的饮料\n\n![2](http://blog.shicishuzhai.com/d08c6167376e49c4b8e291a549ea3a29.png)\n\n到酒店已经是下午 5 点了，刚到酒店把行李一放，我们就迫不及待的要出去逛逛。\n\n先是去吃饭，说了半天，总算用我们蹩脚的文给店员讲明白了我们要吃什么\n\n![3](http://blog.shicishuzhai.com/68a8fdd6bec7b0539e1ae903038bca1e.png)\n\n吃完饭就开始逛，没走多远就遇见了一个 SEGA 的游戏厅，进去感受了一下，很有氛围\n\n![4](http://blog.shicishuzhai.com/35256d5164ea9676134e17f6ef298a13.png)\n\n一楼是各种抓娃娃机，抓什么的都有，模型，手办\n\n![5](http://blog.shicishuzhai.com/bdb9800142238555bdd08f8fc8755914.png)\n\n二楼就是各种游戏机，跟国内的游戏厅不太一样，这些游戏机基本上都是面向成年人的，店内基本上没有小孩子\n\n![6](http://blog.shicishuzhai.com/5f2dd48ab7856767d7c9e67b5ec1b167.png)\n\n还看见了女神异闻录 5，哈哈，P5 天下第一啊！！！\n\n![7](http://blog.shicishuzhai.com/7f1c31a4973d3ba2bd6b64ef62358ffe.png)\n\nFGO\n\n![8](http://blog.shicishuzhai.com/d061a591511653ace668fea9265749fa.png)\n\n游戏厅逛完后，我们就继续沿着街道走，这时天已经渐渐黑了。我们找了一家居酒屋，进去点了几个菜，由于语言不通，闹出了很多笑话，本来我们想每人点一杯酒，结果店员理解成了只点 1 杯酒，另外居酒屋的烤串跟国内的很不一样，没有辣椒和自然，只是有一层甜甜的酱汁，而且拷的肉并不是全熟，我觉得顶多只有 5 分熟，不过口感很不错\n\n![9](http://blog.shicishuzhai.com/0cf084450be445f25e52606874697813.png)\n\n![10](http://blog.shicishuzhai.com/bf007145e5a5a0528e228931711a5f11.png)\n\n之后又去了另外一家人气很旺的居酒屋，不过点的菜我们真的有点吃不惯，酒也喝不惯，总之体验一般。\n\n这就是我们第一天的行程，夜晚的东京（准确说应该是成田市）还是很热闹的。\n\n第二天的行程是迪士尼，总体来说还是玩的很开心的，几个比较刺激好玩的项目都玩了\n\n![11](http://blog.shicishuzhai.com/d5c797e7f29e82f29558b2b43965b27a.png)\n\n![12](http://blog.shicishuzhai.com/fb9d239ac14e33a9da2c3a0f5d686afc.png)\n\n![13](http://blog.shicishuzhai.com/052b813516c4199c460777dc77986976.png)\n\n![14](http://blog.shicishuzhai.com/fa17479496a3a10928b4393eb8b8be92.png)\n\n![15](http://blog.shicishuzhai.com/d37f738a46f1e4333d64e7c615105f5a.png)\n\n晚上回到酒店又出去逛街了，这次又体验了两家居酒屋，这次的体验很不错，尝到了日本拉面，日本清酒，玉子烧等，非常好吃\n\n![16](http://blog.shicishuzhai.com/62252bf6733e53c3e4a66b16e2d1d15b.png)\n\n![17](http://blog.shicishuzhai.com/a53f98243b6ec2b28b94e14d534b9945.png)\n\n吃完了逛了个超市，然后就回酒店了，第二天结束。\n\n第三天我们先是去了一个公园，然后去了人眼八海，下午就直奔富士山。\n\n![18](http://blog.shicishuzhai.com/c76734fa976bc1b1e25de9bd5ec8344a.png)\n\n日本的乡村，街道非常干净。\n\n![19](http://blog.shicishuzhai.com/8c0980caa472b41be9e713c72765797d.png)\n\n中午的午餐，炸鸡排，非常好吃\n\n![20](http://blog.shicishuzhai.com/4948bfe45898f6caf906667f48b7af55.png)\n\n乡村的自助贩卖摊位\n\n![21](http://blog.shicishuzhai.com/a2feb65132d4ea710aad1c78d6567a10.png)\n\n人眼八海，水非常清\n\n![22](http://blog.shicishuzhai.com/dd8b96fbe157842230ce527bc41e7c75.png)\n\n偷拍一个日本小萝莉\n\n![23](http://blog.shicishuzhai.com/b41a8edcc4b19b3cd7797f65d1e1c32c.png)\n\n逛完了人眼八海，我们就直奔富士山，刚到富士山还云雾缭绕，什么也看不清，不一会，云开雾散，远处的富士山非常清晰\n\n![24](http://blog.shicishuzhai.com/be9bc8a93af9181107b88af52167b296.png)\n\n来张自拍，在日本这几天又胖了几斤啊\n\n![25](http://blog.shicishuzhai.com/8790cf6243b43cfbf322361c3abf63ce.png)\n\n看完了富士山我们就直接回酒店了，今天住的酒店是温泉酒店，但说实话温泉真的不怎么样，体验非常差。第三天就这样结束了。\n\n第四天就是购物之旅，早上先去了两家免税店，这个没啥看的，然后去了新宿，在新宿吃了寿喜烧，看了艺伎表演\n\n歌舞伎町一番街\n\n![26](http://blog.shicishuzhai.com/72e933ee6823743a71ef93ac9997ef5c.png)\n\n新宿也是满满的二次元味道\n\n![27](http://blog.shicishuzhai.com/960e62e89527e7c449718732f3b68046.png)\n\n寿喜烧\n\n![28](http://blog.shicishuzhai.com/16a2536e0f096f7a43e3886ec926b1f4.png)\n\n艺伎表演，我们几个一直在讨论表演者到底是个男的还是女的，直到走的时候也没看出来\n\n![29](http://blog.shicishuzhai.com/6e1aab148169e47ccb7dcae42ebba7f2.png)\n\n接着我们就直奔秋叶原，这是本次旅游我最期待的行程\n\nFGO 巨大的宣传画\n\n![30](http://blog.shicishuzhai.com/55eb2fb09f66fcb213e61ff7f53546fc.png)\n\n世嘉的游戏厅\n\n![31](http://blog.shicishuzhai.com/37a0546d5eac2bea9ed64a0bbb6ee3ac.png)\n\n到处的洋溢着二次元的气氛\n\n![32](http://blog.shicishuzhai.com/1e2fa587184bb4fb5ed2c625c1229e11.png)\n\n传说中的女仆咖啡厅，只不过时间有限，没能进去体验一下（其实是钱包有限）\n\n![33](http://blog.shicishuzhai.com/b7461fd51ab08c001ecdf05f7f6a5e2a.png)\n\nCosplay\n\n![34](http://blog.shicishuzhai.com/3cf8cc575a0fe33f5c3c448981eafb2c.png)\n\n秋叶原呆了两个小时，然后又去了银座，说实话，银座对我来说真的没什么逛的，我也没什么东西要买的\n\n街上遇到了一个街头表演，我把仅剩的几个硬币全给了他\n\n![35](http://blog.shicishuzhai.com/ce279b6b8e940b240e01e12d8371553f.png)\n\n银座逛完，吃完饭我们就回酒店了，第四天就结束了。\n\n第五天就是回家。\n\n总结一下这次旅游的感受，日本给我最大的印象就是干净，不管是繁华的大街上还是乡下的小路上，都非常干净，而且他们的垃圾分类真的做的非常好，导游一再提醒我们扔垃圾要分开仍，在国内即使碰到了分类垃圾箱也是随便扔，但这几天旅游却不由自主的做到了垃圾分类。另外一点就是日本的服务员非常热情，不管你是去便利店，商城，大超市，居酒屋还是其他什么地方，服务员见到你第一句都是“欢迎光临”，非常热情。其他的就没什么了，能去到秋叶原也算是圆了我的一个梦想。这次由于时间比较短，很多想去的地方没有去，希望下次有机会还能再去日本好好逛逛。\n","source":"_posts/2018-09-19-日本五日游.md","raw":"---\ntitle: 日本五日游\ncategories: 游记\ntags:\n  - 旅游\n  - 日本\ndate: 2018-09-19 07:01:12\n---\n\n上周公司组织了去日本旅游（5 天 4 晚），这篇博客主要记录一下我在日本的见闻以及一些感受。\n\n我们是上周五（2018-9-14）早上 9 点出发，到东京成田机场是下午 3 点左右。刚到机场就感受到了很多不一样的东西。\n\n首先是随处可见的自动贩卖机\n\n![1](http://blog.shicishuzhai.com/b99ccb803b24538dcd01dc05ca616590.png)\n\n跟国内不一样的饮料\n\n![2](http://blog.shicishuzhai.com/d08c6167376e49c4b8e291a549ea3a29.png)\n\n到酒店已经是下午 5 点了，刚到酒店把行李一放，我们就迫不及待的要出去逛逛。\n\n先是去吃饭，说了半天，总算用我们蹩脚的文给店员讲明白了我们要吃什么\n\n![3](http://blog.shicishuzhai.com/68a8fdd6bec7b0539e1ae903038bca1e.png)\n\n吃完饭就开始逛，没走多远就遇见了一个 SEGA 的游戏厅，进去感受了一下，很有氛围\n\n![4](http://blog.shicishuzhai.com/35256d5164ea9676134e17f6ef298a13.png)\n\n一楼是各种抓娃娃机，抓什么的都有，模型，手办\n\n![5](http://blog.shicishuzhai.com/bdb9800142238555bdd08f8fc8755914.png)\n\n二楼就是各种游戏机，跟国内的游戏厅不太一样，这些游戏机基本上都是面向成年人的，店内基本上没有小孩子\n\n![6](http://blog.shicishuzhai.com/5f2dd48ab7856767d7c9e67b5ec1b167.png)\n\n还看见了女神异闻录 5，哈哈，P5 天下第一啊！！！\n\n![7](http://blog.shicishuzhai.com/7f1c31a4973d3ba2bd6b64ef62358ffe.png)\n\nFGO\n\n![8](http://blog.shicishuzhai.com/d061a591511653ace668fea9265749fa.png)\n\n游戏厅逛完后，我们就继续沿着街道走，这时天已经渐渐黑了。我们找了一家居酒屋，进去点了几个菜，由于语言不通，闹出了很多笑话，本来我们想每人点一杯酒，结果店员理解成了只点 1 杯酒，另外居酒屋的烤串跟国内的很不一样，没有辣椒和自然，只是有一层甜甜的酱汁，而且拷的肉并不是全熟，我觉得顶多只有 5 分熟，不过口感很不错\n\n![9](http://blog.shicishuzhai.com/0cf084450be445f25e52606874697813.png)\n\n![10](http://blog.shicishuzhai.com/bf007145e5a5a0528e228931711a5f11.png)\n\n之后又去了另外一家人气很旺的居酒屋，不过点的菜我们真的有点吃不惯，酒也喝不惯，总之体验一般。\n\n这就是我们第一天的行程，夜晚的东京（准确说应该是成田市）还是很热闹的。\n\n第二天的行程是迪士尼，总体来说还是玩的很开心的，几个比较刺激好玩的项目都玩了\n\n![11](http://blog.shicishuzhai.com/d5c797e7f29e82f29558b2b43965b27a.png)\n\n![12](http://blog.shicishuzhai.com/fb9d239ac14e33a9da2c3a0f5d686afc.png)\n\n![13](http://blog.shicishuzhai.com/052b813516c4199c460777dc77986976.png)\n\n![14](http://blog.shicishuzhai.com/fa17479496a3a10928b4393eb8b8be92.png)\n\n![15](http://blog.shicishuzhai.com/d37f738a46f1e4333d64e7c615105f5a.png)\n\n晚上回到酒店又出去逛街了，这次又体验了两家居酒屋，这次的体验很不错，尝到了日本拉面，日本清酒，玉子烧等，非常好吃\n\n![16](http://blog.shicishuzhai.com/62252bf6733e53c3e4a66b16e2d1d15b.png)\n\n![17](http://blog.shicishuzhai.com/a53f98243b6ec2b28b94e14d534b9945.png)\n\n吃完了逛了个超市，然后就回酒店了，第二天结束。\n\n第三天我们先是去了一个公园，然后去了人眼八海，下午就直奔富士山。\n\n![18](http://blog.shicishuzhai.com/c76734fa976bc1b1e25de9bd5ec8344a.png)\n\n日本的乡村，街道非常干净。\n\n![19](http://blog.shicishuzhai.com/8c0980caa472b41be9e713c72765797d.png)\n\n中午的午餐，炸鸡排，非常好吃\n\n![20](http://blog.shicishuzhai.com/4948bfe45898f6caf906667f48b7af55.png)\n\n乡村的自助贩卖摊位\n\n![21](http://blog.shicishuzhai.com/a2feb65132d4ea710aad1c78d6567a10.png)\n\n人眼八海，水非常清\n\n![22](http://blog.shicishuzhai.com/dd8b96fbe157842230ce527bc41e7c75.png)\n\n偷拍一个日本小萝莉\n\n![23](http://blog.shicishuzhai.com/b41a8edcc4b19b3cd7797f65d1e1c32c.png)\n\n逛完了人眼八海，我们就直奔富士山，刚到富士山还云雾缭绕，什么也看不清，不一会，云开雾散，远处的富士山非常清晰\n\n![24](http://blog.shicishuzhai.com/be9bc8a93af9181107b88af52167b296.png)\n\n来张自拍，在日本这几天又胖了几斤啊\n\n![25](http://blog.shicishuzhai.com/8790cf6243b43cfbf322361c3abf63ce.png)\n\n看完了富士山我们就直接回酒店了，今天住的酒店是温泉酒店，但说实话温泉真的不怎么样，体验非常差。第三天就这样结束了。\n\n第四天就是购物之旅，早上先去了两家免税店，这个没啥看的，然后去了新宿，在新宿吃了寿喜烧，看了艺伎表演\n\n歌舞伎町一番街\n\n![26](http://blog.shicishuzhai.com/72e933ee6823743a71ef93ac9997ef5c.png)\n\n新宿也是满满的二次元味道\n\n![27](http://blog.shicishuzhai.com/960e62e89527e7c449718732f3b68046.png)\n\n寿喜烧\n\n![28](http://blog.shicishuzhai.com/16a2536e0f096f7a43e3886ec926b1f4.png)\n\n艺伎表演，我们几个一直在讨论表演者到底是个男的还是女的，直到走的时候也没看出来\n\n![29](http://blog.shicishuzhai.com/6e1aab148169e47ccb7dcae42ebba7f2.png)\n\n接着我们就直奔秋叶原，这是本次旅游我最期待的行程\n\nFGO 巨大的宣传画\n\n![30](http://blog.shicishuzhai.com/55eb2fb09f66fcb213e61ff7f53546fc.png)\n\n世嘉的游戏厅\n\n![31](http://blog.shicishuzhai.com/37a0546d5eac2bea9ed64a0bbb6ee3ac.png)\n\n到处的洋溢着二次元的气氛\n\n![32](http://blog.shicishuzhai.com/1e2fa587184bb4fb5ed2c625c1229e11.png)\n\n传说中的女仆咖啡厅，只不过时间有限，没能进去体验一下（其实是钱包有限）\n\n![33](http://blog.shicishuzhai.com/b7461fd51ab08c001ecdf05f7f6a5e2a.png)\n\nCosplay\n\n![34](http://blog.shicishuzhai.com/3cf8cc575a0fe33f5c3c448981eafb2c.png)\n\n秋叶原呆了两个小时，然后又去了银座，说实话，银座对我来说真的没什么逛的，我也没什么东西要买的\n\n街上遇到了一个街头表演，我把仅剩的几个硬币全给了他\n\n![35](http://blog.shicishuzhai.com/ce279b6b8e940b240e01e12d8371553f.png)\n\n银座逛完，吃完饭我们就回酒店了，第四天就结束了。\n\n第五天就是回家。\n\n总结一下这次旅游的感受，日本给我最大的印象就是干净，不管是繁华的大街上还是乡下的小路上，都非常干净，而且他们的垃圾分类真的做的非常好，导游一再提醒我们扔垃圾要分开仍，在国内即使碰到了分类垃圾箱也是随便扔，但这几天旅游却不由自主的做到了垃圾分类。另外一点就是日本的服务员非常热情，不管你是去便利店，商城，大超市，居酒屋还是其他什么地方，服务员见到你第一句都是“欢迎光临”，非常热情。其他的就没什么了，能去到秋叶原也算是圆了我的一个梦想。这次由于时间比较短，很多想去的地方没有去，希望下次有机会还能再去日本好好逛逛。\n","slug":"日本五日游","published":1,"updated":"2019-01-13T03:53:57.404Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjutyfmgj004tc4c9mqkh8emb","content":"<p>上周公司组织了去日本旅游（5 天 4 晚），这篇博客主要记录一下我在日本的见闻以及一些感受。</p>\n<p>我们是上周五（2018-9-14）早上 9 点出发，到东京成田机场是下午 3 点左右。刚到机场就感受到了很多不一样的东西。</p>\n<p>首先是随处可见的自动贩卖机</p>\n<p><img src=\"http://blog.shicishuzhai.com/b99ccb803b24538dcd01dc05ca616590.png\" alt=\"1\"></p>\n<p>跟国内不一样的饮料</p>\n<p><img src=\"http://blog.shicishuzhai.com/d08c6167376e49c4b8e291a549ea3a29.png\" alt=\"2\"></p>\n<p>到酒店已经是下午 5 点了，刚到酒店把行李一放，我们就迫不及待的要出去逛逛。</p>\n<p>先是去吃饭，说了半天，总算用我们蹩脚的文给店员讲明白了我们要吃什么</p>\n<p><img src=\"http://blog.shicishuzhai.com/68a8fdd6bec7b0539e1ae903038bca1e.png\" alt=\"3\"></p>\n<p>吃完饭就开始逛，没走多远就遇见了一个 SEGA 的游戏厅，进去感受了一下，很有氛围</p>\n<p><img src=\"http://blog.shicishuzhai.com/35256d5164ea9676134e17f6ef298a13.png\" alt=\"4\"></p>\n<p>一楼是各种抓娃娃机，抓什么的都有，模型，手办</p>\n<p><img src=\"http://blog.shicishuzhai.com/bdb9800142238555bdd08f8fc8755914.png\" alt=\"5\"></p>\n<p>二楼就是各种游戏机，跟国内的游戏厅不太一样，这些游戏机基本上都是面向成年人的，店内基本上没有小孩子</p>\n<p><img src=\"http://blog.shicishuzhai.com/5f2dd48ab7856767d7c9e67b5ec1b167.png\" alt=\"6\"></p>\n<p>还看见了女神异闻录 5，哈哈，P5 天下第一啊！！！</p>\n<p><img src=\"http://blog.shicishuzhai.com/7f1c31a4973d3ba2bd6b64ef62358ffe.png\" alt=\"7\"></p>\n<p>FGO</p>\n<p><img src=\"http://blog.shicishuzhai.com/d061a591511653ace668fea9265749fa.png\" alt=\"8\"></p>\n<p>游戏厅逛完后，我们就继续沿着街道走，这时天已经渐渐黑了。我们找了一家居酒屋，进去点了几个菜，由于语言不通，闹出了很多笑话，本来我们想每人点一杯酒，结果店员理解成了只点 1 杯酒，另外居酒屋的烤串跟国内的很不一样，没有辣椒和自然，只是有一层甜甜的酱汁，而且拷的肉并不是全熟，我觉得顶多只有 5 分熟，不过口感很不错</p>\n<p><img src=\"http://blog.shicishuzhai.com/0cf084450be445f25e52606874697813.png\" alt=\"9\"></p>\n<p><img src=\"http://blog.shicishuzhai.com/bf007145e5a5a0528e228931711a5f11.png\" alt=\"10\"></p>\n<p>之后又去了另外一家人气很旺的居酒屋，不过点的菜我们真的有点吃不惯，酒也喝不惯，总之体验一般。</p>\n<p>这就是我们第一天的行程，夜晚的东京（准确说应该是成田市）还是很热闹的。</p>\n<p>第二天的行程是迪士尼，总体来说还是玩的很开心的，几个比较刺激好玩的项目都玩了</p>\n<p><img src=\"http://blog.shicishuzhai.com/d5c797e7f29e82f29558b2b43965b27a.png\" alt=\"11\"></p>\n<p><img src=\"http://blog.shicishuzhai.com/fb9d239ac14e33a9da2c3a0f5d686afc.png\" alt=\"12\"></p>\n<p><img src=\"http://blog.shicishuzhai.com/052b813516c4199c460777dc77986976.png\" alt=\"13\"></p>\n<p><img src=\"http://blog.shicishuzhai.com/fa17479496a3a10928b4393eb8b8be92.png\" alt=\"14\"></p>\n<p><img src=\"http://blog.shicishuzhai.com/d37f738a46f1e4333d64e7c615105f5a.png\" alt=\"15\"></p>\n<p>晚上回到酒店又出去逛街了，这次又体验了两家居酒屋，这次的体验很不错，尝到了日本拉面，日本清酒，玉子烧等，非常好吃</p>\n<p><img src=\"http://blog.shicishuzhai.com/62252bf6733e53c3e4a66b16e2d1d15b.png\" alt=\"16\"></p>\n<p><img src=\"http://blog.shicishuzhai.com/a53f98243b6ec2b28b94e14d534b9945.png\" alt=\"17\"></p>\n<p>吃完了逛了个超市，然后就回酒店了，第二天结束。</p>\n<p>第三天我们先是去了一个公园，然后去了人眼八海，下午就直奔富士山。</p>\n<p><img src=\"http://blog.shicishuzhai.com/c76734fa976bc1b1e25de9bd5ec8344a.png\" alt=\"18\"></p>\n<p>日本的乡村，街道非常干净。</p>\n<p><img src=\"http://blog.shicishuzhai.com/8c0980caa472b41be9e713c72765797d.png\" alt=\"19\"></p>\n<p>中午的午餐，炸鸡排，非常好吃</p>\n<p><img src=\"http://blog.shicishuzhai.com/4948bfe45898f6caf906667f48b7af55.png\" alt=\"20\"></p>\n<p>乡村的自助贩卖摊位</p>\n<p><img src=\"http://blog.shicishuzhai.com/a2feb65132d4ea710aad1c78d6567a10.png\" alt=\"21\"></p>\n<p>人眼八海，水非常清</p>\n<p><img src=\"http://blog.shicishuzhai.com/dd8b96fbe157842230ce527bc41e7c75.png\" alt=\"22\"></p>\n<p>偷拍一个日本小萝莉</p>\n<p><img src=\"http://blog.shicishuzhai.com/b41a8edcc4b19b3cd7797f65d1e1c32c.png\" alt=\"23\"></p>\n<p>逛完了人眼八海，我们就直奔富士山，刚到富士山还云雾缭绕，什么也看不清，不一会，云开雾散，远处的富士山非常清晰</p>\n<p><img src=\"http://blog.shicishuzhai.com/be9bc8a93af9181107b88af52167b296.png\" alt=\"24\"></p>\n<p>来张自拍，在日本这几天又胖了几斤啊</p>\n<p><img src=\"http://blog.shicishuzhai.com/8790cf6243b43cfbf322361c3abf63ce.png\" alt=\"25\"></p>\n<p>看完了富士山我们就直接回酒店了，今天住的酒店是温泉酒店，但说实话温泉真的不怎么样，体验非常差。第三天就这样结束了。</p>\n<p>第四天就是购物之旅，早上先去了两家免税店，这个没啥看的，然后去了新宿，在新宿吃了寿喜烧，看了艺伎表演</p>\n<p>歌舞伎町一番街</p>\n<p><img src=\"http://blog.shicishuzhai.com/72e933ee6823743a71ef93ac9997ef5c.png\" alt=\"26\"></p>\n<p>新宿也是满满的二次元味道</p>\n<p><img src=\"http://blog.shicishuzhai.com/960e62e89527e7c449718732f3b68046.png\" alt=\"27\"></p>\n<p>寿喜烧</p>\n<p><img src=\"http://blog.shicishuzhai.com/16a2536e0f096f7a43e3886ec926b1f4.png\" alt=\"28\"></p>\n<p>艺伎表演，我们几个一直在讨论表演者到底是个男的还是女的，直到走的时候也没看出来</p>\n<p><img src=\"http://blog.shicishuzhai.com/6e1aab148169e47ccb7dcae42ebba7f2.png\" alt=\"29\"></p>\n<p>接着我们就直奔秋叶原，这是本次旅游我最期待的行程</p>\n<p>FGO 巨大的宣传画</p>\n<p><img src=\"http://blog.shicishuzhai.com/55eb2fb09f66fcb213e61ff7f53546fc.png\" alt=\"30\"></p>\n<p>世嘉的游戏厅</p>\n<p><img src=\"http://blog.shicishuzhai.com/37a0546d5eac2bea9ed64a0bbb6ee3ac.png\" alt=\"31\"></p>\n<p>到处的洋溢着二次元的气氛</p>\n<p><img src=\"http://blog.shicishuzhai.com/1e2fa587184bb4fb5ed2c625c1229e11.png\" alt=\"32\"></p>\n<p>传说中的女仆咖啡厅，只不过时间有限，没能进去体验一下（其实是钱包有限）</p>\n<p><img src=\"http://blog.shicishuzhai.com/b7461fd51ab08c001ecdf05f7f6a5e2a.png\" alt=\"33\"></p>\n<p>Cosplay</p>\n<p><img src=\"http://blog.shicishuzhai.com/3cf8cc575a0fe33f5c3c448981eafb2c.png\" alt=\"34\"></p>\n<p>秋叶原呆了两个小时，然后又去了银座，说实话，银座对我来说真的没什么逛的，我也没什么东西要买的</p>\n<p>街上遇到了一个街头表演，我把仅剩的几个硬币全给了他</p>\n<p><img src=\"http://blog.shicishuzhai.com/ce279b6b8e940b240e01e12d8371553f.png\" alt=\"35\"></p>\n<p>银座逛完，吃完饭我们就回酒店了，第四天就结束了。</p>\n<p>第五天就是回家。</p>\n<p>总结一下这次旅游的感受，日本给我最大的印象就是干净，不管是繁华的大街上还是乡下的小路上，都非常干净，而且他们的垃圾分类真的做的非常好，导游一再提醒我们扔垃圾要分开仍，在国内即使碰到了分类垃圾箱也是随便扔，但这几天旅游却不由自主的做到了垃圾分类。另外一点就是日本的服务员非常热情，不管你是去便利店，商城，大超市，居酒屋还是其他什么地方，服务员见到你第一句都是“欢迎光临”，非常热情。其他的就没什么了，能去到秋叶原也算是圆了我的一个梦想。这次由于时间比较短，很多想去的地方没有去，希望下次有机会还能再去日本好好逛逛。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>上周公司组织了去日本旅游（5 天 4 晚），这篇博客主要记录一下我在日本的见闻以及一些感受。</p>\n<p>我们是上周五（2018-9-14）早上 9 点出发，到东京成田机场是下午 3 点左右。刚到机场就感受到了很多不一样的东西。</p>\n<p>首先是随处可见的自动贩卖机</p>\n<p><img src=\"http://blog.shicishuzhai.com/b99ccb803b24538dcd01dc05ca616590.png\" alt=\"1\"></p>\n<p>跟国内不一样的饮料</p>\n<p><img src=\"http://blog.shicishuzhai.com/d08c6167376e49c4b8e291a549ea3a29.png\" alt=\"2\"></p>\n<p>到酒店已经是下午 5 点了，刚到酒店把行李一放，我们就迫不及待的要出去逛逛。</p>\n<p>先是去吃饭，说了半天，总算用我们蹩脚的文给店员讲明白了我们要吃什么</p>\n<p><img src=\"http://blog.shicishuzhai.com/68a8fdd6bec7b0539e1ae903038bca1e.png\" alt=\"3\"></p>\n<p>吃完饭就开始逛，没走多远就遇见了一个 SEGA 的游戏厅，进去感受了一下，很有氛围</p>\n<p><img src=\"http://blog.shicishuzhai.com/35256d5164ea9676134e17f6ef298a13.png\" alt=\"4\"></p>\n<p>一楼是各种抓娃娃机，抓什么的都有，模型，手办</p>\n<p><img src=\"http://blog.shicishuzhai.com/bdb9800142238555bdd08f8fc8755914.png\" alt=\"5\"></p>\n<p>二楼就是各种游戏机，跟国内的游戏厅不太一样，这些游戏机基本上都是面向成年人的，店内基本上没有小孩子</p>\n<p><img src=\"http://blog.shicishuzhai.com/5f2dd48ab7856767d7c9e67b5ec1b167.png\" alt=\"6\"></p>\n<p>还看见了女神异闻录 5，哈哈，P5 天下第一啊！！！</p>\n<p><img src=\"http://blog.shicishuzhai.com/7f1c31a4973d3ba2bd6b64ef62358ffe.png\" alt=\"7\"></p>\n<p>FGO</p>\n<p><img src=\"http://blog.shicishuzhai.com/d061a591511653ace668fea9265749fa.png\" alt=\"8\"></p>\n<p>游戏厅逛完后，我们就继续沿着街道走，这时天已经渐渐黑了。我们找了一家居酒屋，进去点了几个菜，由于语言不通，闹出了很多笑话，本来我们想每人点一杯酒，结果店员理解成了只点 1 杯酒，另外居酒屋的烤串跟国内的很不一样，没有辣椒和自然，只是有一层甜甜的酱汁，而且拷的肉并不是全熟，我觉得顶多只有 5 分熟，不过口感很不错</p>\n<p><img src=\"http://blog.shicishuzhai.com/0cf084450be445f25e52606874697813.png\" alt=\"9\"></p>\n<p><img src=\"http://blog.shicishuzhai.com/bf007145e5a5a0528e228931711a5f11.png\" alt=\"10\"></p>\n<p>之后又去了另外一家人气很旺的居酒屋，不过点的菜我们真的有点吃不惯，酒也喝不惯，总之体验一般。</p>\n<p>这就是我们第一天的行程，夜晚的东京（准确说应该是成田市）还是很热闹的。</p>\n<p>第二天的行程是迪士尼，总体来说还是玩的很开心的，几个比较刺激好玩的项目都玩了</p>\n<p><img src=\"http://blog.shicishuzhai.com/d5c797e7f29e82f29558b2b43965b27a.png\" alt=\"11\"></p>\n<p><img src=\"http://blog.shicishuzhai.com/fb9d239ac14e33a9da2c3a0f5d686afc.png\" alt=\"12\"></p>\n<p><img src=\"http://blog.shicishuzhai.com/052b813516c4199c460777dc77986976.png\" alt=\"13\"></p>\n<p><img src=\"http://blog.shicishuzhai.com/fa17479496a3a10928b4393eb8b8be92.png\" alt=\"14\"></p>\n<p><img src=\"http://blog.shicishuzhai.com/d37f738a46f1e4333d64e7c615105f5a.png\" alt=\"15\"></p>\n<p>晚上回到酒店又出去逛街了，这次又体验了两家居酒屋，这次的体验很不错，尝到了日本拉面，日本清酒，玉子烧等，非常好吃</p>\n<p><img src=\"http://blog.shicishuzhai.com/62252bf6733e53c3e4a66b16e2d1d15b.png\" alt=\"16\"></p>\n<p><img src=\"http://blog.shicishuzhai.com/a53f98243b6ec2b28b94e14d534b9945.png\" alt=\"17\"></p>\n<p>吃完了逛了个超市，然后就回酒店了，第二天结束。</p>\n<p>第三天我们先是去了一个公园，然后去了人眼八海，下午就直奔富士山。</p>\n<p><img src=\"http://blog.shicishuzhai.com/c76734fa976bc1b1e25de9bd5ec8344a.png\" alt=\"18\"></p>\n<p>日本的乡村，街道非常干净。</p>\n<p><img src=\"http://blog.shicishuzhai.com/8c0980caa472b41be9e713c72765797d.png\" alt=\"19\"></p>\n<p>中午的午餐，炸鸡排，非常好吃</p>\n<p><img src=\"http://blog.shicishuzhai.com/4948bfe45898f6caf906667f48b7af55.png\" alt=\"20\"></p>\n<p>乡村的自助贩卖摊位</p>\n<p><img src=\"http://blog.shicishuzhai.com/a2feb65132d4ea710aad1c78d6567a10.png\" alt=\"21\"></p>\n<p>人眼八海，水非常清</p>\n<p><img src=\"http://blog.shicishuzhai.com/dd8b96fbe157842230ce527bc41e7c75.png\" alt=\"22\"></p>\n<p>偷拍一个日本小萝莉</p>\n<p><img src=\"http://blog.shicishuzhai.com/b41a8edcc4b19b3cd7797f65d1e1c32c.png\" alt=\"23\"></p>\n<p>逛完了人眼八海，我们就直奔富士山，刚到富士山还云雾缭绕，什么也看不清，不一会，云开雾散，远处的富士山非常清晰</p>\n<p><img src=\"http://blog.shicishuzhai.com/be9bc8a93af9181107b88af52167b296.png\" alt=\"24\"></p>\n<p>来张自拍，在日本这几天又胖了几斤啊</p>\n<p><img src=\"http://blog.shicishuzhai.com/8790cf6243b43cfbf322361c3abf63ce.png\" alt=\"25\"></p>\n<p>看完了富士山我们就直接回酒店了，今天住的酒店是温泉酒店，但说实话温泉真的不怎么样，体验非常差。第三天就这样结束了。</p>\n<p>第四天就是购物之旅，早上先去了两家免税店，这个没啥看的，然后去了新宿，在新宿吃了寿喜烧，看了艺伎表演</p>\n<p>歌舞伎町一番街</p>\n<p><img src=\"http://blog.shicishuzhai.com/72e933ee6823743a71ef93ac9997ef5c.png\" alt=\"26\"></p>\n<p>新宿也是满满的二次元味道</p>\n<p><img src=\"http://blog.shicishuzhai.com/960e62e89527e7c449718732f3b68046.png\" alt=\"27\"></p>\n<p>寿喜烧</p>\n<p><img src=\"http://blog.shicishuzhai.com/16a2536e0f096f7a43e3886ec926b1f4.png\" alt=\"28\"></p>\n<p>艺伎表演，我们几个一直在讨论表演者到底是个男的还是女的，直到走的时候也没看出来</p>\n<p><img src=\"http://blog.shicishuzhai.com/6e1aab148169e47ccb7dcae42ebba7f2.png\" alt=\"29\"></p>\n<p>接着我们就直奔秋叶原，这是本次旅游我最期待的行程</p>\n<p>FGO 巨大的宣传画</p>\n<p><img src=\"http://blog.shicishuzhai.com/55eb2fb09f66fcb213e61ff7f53546fc.png\" alt=\"30\"></p>\n<p>世嘉的游戏厅</p>\n<p><img src=\"http://blog.shicishuzhai.com/37a0546d5eac2bea9ed64a0bbb6ee3ac.png\" alt=\"31\"></p>\n<p>到处的洋溢着二次元的气氛</p>\n<p><img src=\"http://blog.shicishuzhai.com/1e2fa587184bb4fb5ed2c625c1229e11.png\" alt=\"32\"></p>\n<p>传说中的女仆咖啡厅，只不过时间有限，没能进去体验一下（其实是钱包有限）</p>\n<p><img src=\"http://blog.shicishuzhai.com/b7461fd51ab08c001ecdf05f7f6a5e2a.png\" alt=\"33\"></p>\n<p>Cosplay</p>\n<p><img src=\"http://blog.shicishuzhai.com/3cf8cc575a0fe33f5c3c448981eafb2c.png\" alt=\"34\"></p>\n<p>秋叶原呆了两个小时，然后又去了银座，说实话，银座对我来说真的没什么逛的，我也没什么东西要买的</p>\n<p>街上遇到了一个街头表演，我把仅剩的几个硬币全给了他</p>\n<p><img src=\"http://blog.shicishuzhai.com/ce279b6b8e940b240e01e12d8371553f.png\" alt=\"35\"></p>\n<p>银座逛完，吃完饭我们就回酒店了，第四天就结束了。</p>\n<p>第五天就是回家。</p>\n<p>总结一下这次旅游的感受，日本给我最大的印象就是干净，不管是繁华的大街上还是乡下的小路上，都非常干净，而且他们的垃圾分类真的做的非常好，导游一再提醒我们扔垃圾要分开仍，在国内即使碰到了分类垃圾箱也是随便扔，但这几天旅游却不由自主的做到了垃圾分类。另外一点就是日本的服务员非常热情，不管你是去便利店，商城，大超市，居酒屋还是其他什么地方，服务员见到你第一句都是“欢迎光临”，非常热情。其他的就没什么了，能去到秋叶原也算是圆了我的一个梦想。这次由于时间比较短，很多想去的地方没有去，希望下次有机会还能再去日本好好逛逛。</p>\n"},{"title":"2018年终总结","date":"2019-01-04T16:03:00.000Z","_content":"\n这几天看到到处都是年终总结的博客，自己也来凑凑热闹。我打算写两篇，第一篇是回顾 2018，第二篇是展望 2019。这是第一篇，主要内容是总结一下自己 2018 年都做了哪些事情，有哪些得失。\n\n## 学习方面\n\n除了 iOS，2018 年自己还确实学了不少东西，下面我大概列举了一下自己 2018 年学的东西：\n\n- HTML/CSS\n- JavaScript\n- Node.js\n- Python/Flask\n- Flutter\n- React/ReactNative\n- 微信小程序开发\n\n虽然学了很多，但是没有太多实践的机会，所有很多东西学的并不是很深入。\n\n另外，这些东西基本都是在 10 月份之前学的，10 月份开始，由于公司新项目启动，自己进入了疯狂加班状态，学习基本处于半停滞状态。10 月份到 12 月份基本没有学习什么新的东西。\n\n另外，由于新项目采用 Swift 语言开发，自己在 Swift 语言上也有了一些经验。\n\n## 工作方面\n\n2018 年已经是我在懒人听书呆的第 4 个年头了，说实话，我当初也没有想到自己能呆这么久。\n\n今年工作上最大的事情就是从 9 月份开始，我作为技术经理，全权负责公司新项目芽芽故事 iOS 端的开发工作。经过团队（3 个人）一起的不懈努力，最终于 12 月中旬，按时完成了开发任务，没有延期。这是我在懒人第一次完整的负责一个 App 的整个开发过程，从最开始的立项，架构设计，技术选型，再到模块划分，人员分配等。这个过程中自己确实得到了很大的锻炼。不光是技术上的，还包括沟通，协调，管理等能力也得到了很大的提升。\n\n## 生活方面\n\n年初定的减肥计划，上半年执行的很好，到 8 月份时最低体重降到了 67kg。不过，经过 10 月，11 月，12 月的加班，又反弹到了 72kg，看来明年还得继续努力啊。\n\n9 月份跟公司一起去日本旅游了一趟，算是了了自己的一桩心愿。\n\n投资方面，股市暴跌，基金赔了将近 1 万块。上半年 P2P 暴雷，虽然自己投的平台没有出事，但还是吓得接连减仓。下半年和朋友合伙投资了一家便利店，最终被合伙人坑了，赔了将近 4 万，加上基金赔的，基本上把自己去年在数字货币上赚的又都赔进去了，只能怪自己阅历太少，不知人心险恶。\n\n## 总结\n\n上面就是我 2018 年的总结，总的来说，2018 年自己的表现并不是很好，年初的很多目标没有完成，留给自己的时间已经不多了，毕竟年龄在那摆着，已经是快奔三的人了。希望自己继续努力加油，在 2019 年能取得更大的进步。\n","source":"_posts/2019-01-05-2018年终总结.md","raw":"---\ntitle: 2018年终总结\ncategories: 其他\ntags:\n  - 其他\ndate: 2019-01-05 00:03:00\n---\n\n这几天看到到处都是年终总结的博客，自己也来凑凑热闹。我打算写两篇，第一篇是回顾 2018，第二篇是展望 2019。这是第一篇，主要内容是总结一下自己 2018 年都做了哪些事情，有哪些得失。\n\n## 学习方面\n\n除了 iOS，2018 年自己还确实学了不少东西，下面我大概列举了一下自己 2018 年学的东西：\n\n- HTML/CSS\n- JavaScript\n- Node.js\n- Python/Flask\n- Flutter\n- React/ReactNative\n- 微信小程序开发\n\n虽然学了很多，但是没有太多实践的机会，所有很多东西学的并不是很深入。\n\n另外，这些东西基本都是在 10 月份之前学的，10 月份开始，由于公司新项目启动，自己进入了疯狂加班状态，学习基本处于半停滞状态。10 月份到 12 月份基本没有学习什么新的东西。\n\n另外，由于新项目采用 Swift 语言开发，自己在 Swift 语言上也有了一些经验。\n\n## 工作方面\n\n2018 年已经是我在懒人听书呆的第 4 个年头了，说实话，我当初也没有想到自己能呆这么久。\n\n今年工作上最大的事情就是从 9 月份开始，我作为技术经理，全权负责公司新项目芽芽故事 iOS 端的开发工作。经过团队（3 个人）一起的不懈努力，最终于 12 月中旬，按时完成了开发任务，没有延期。这是我在懒人第一次完整的负责一个 App 的整个开发过程，从最开始的立项，架构设计，技术选型，再到模块划分，人员分配等。这个过程中自己确实得到了很大的锻炼。不光是技术上的，还包括沟通，协调，管理等能力也得到了很大的提升。\n\n## 生活方面\n\n年初定的减肥计划，上半年执行的很好，到 8 月份时最低体重降到了 67kg。不过，经过 10 月，11 月，12 月的加班，又反弹到了 72kg，看来明年还得继续努力啊。\n\n9 月份跟公司一起去日本旅游了一趟，算是了了自己的一桩心愿。\n\n投资方面，股市暴跌，基金赔了将近 1 万块。上半年 P2P 暴雷，虽然自己投的平台没有出事，但还是吓得接连减仓。下半年和朋友合伙投资了一家便利店，最终被合伙人坑了，赔了将近 4 万，加上基金赔的，基本上把自己去年在数字货币上赚的又都赔进去了，只能怪自己阅历太少，不知人心险恶。\n\n## 总结\n\n上面就是我 2018 年的总结，总的来说，2018 年自己的表现并不是很好，年初的很多目标没有完成，留给自己的时间已经不多了，毕竟年龄在那摆着，已经是快奔三的人了。希望自己继续努力加油，在 2019 年能取得更大的进步。\n","slug":"2018年终总结","published":1,"updated":"2019-01-27T08:43:02.729Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjutyfmgk004wc4c9rv9moviq","content":"<p>这几天看到到处都是年终总结的博客，自己也来凑凑热闹。我打算写两篇，第一篇是回顾 2018，第二篇是展望 2019。这是第一篇，主要内容是总结一下自己 2018 年都做了哪些事情，有哪些得失。</p>\n<h2 id=\"学习方面\"><a href=\"#学习方面\" class=\"headerlink\" title=\"学习方面\"></a>学习方面</h2><p>除了 iOS，2018 年自己还确实学了不少东西，下面我大概列举了一下自己 2018 年学的东西：</p>\n<ul>\n<li>HTML/CSS</li>\n<li>JavaScript</li>\n<li>Node.js</li>\n<li>Python/Flask</li>\n<li>Flutter</li>\n<li>React/ReactNative</li>\n<li>微信小程序开发</li>\n</ul>\n<p>虽然学了很多，但是没有太多实践的机会，所有很多东西学的并不是很深入。</p>\n<p>另外，这些东西基本都是在 10 月份之前学的，10 月份开始，由于公司新项目启动，自己进入了疯狂加班状态，学习基本处于半停滞状态。10 月份到 12 月份基本没有学习什么新的东西。</p>\n<p>另外，由于新项目采用 Swift 语言开发，自己在 Swift 语言上也有了一些经验。</p>\n<h2 id=\"工作方面\"><a href=\"#工作方面\" class=\"headerlink\" title=\"工作方面\"></a>工作方面</h2><p>2018 年已经是我在懒人听书呆的第 4 个年头了，说实话，我当初也没有想到自己能呆这么久。</p>\n<p>今年工作上最大的事情就是从 9 月份开始，我作为技术经理，全权负责公司新项目芽芽故事 iOS 端的开发工作。经过团队（3 个人）一起的不懈努力，最终于 12 月中旬，按时完成了开发任务，没有延期。这是我在懒人第一次完整的负责一个 App 的整个开发过程，从最开始的立项，架构设计，技术选型，再到模块划分，人员分配等。这个过程中自己确实得到了很大的锻炼。不光是技术上的，还包括沟通，协调，管理等能力也得到了很大的提升。</p>\n<h2 id=\"生活方面\"><a href=\"#生活方面\" class=\"headerlink\" title=\"生活方面\"></a>生活方面</h2><p>年初定的减肥计划，上半年执行的很好，到 8 月份时最低体重降到了 67kg。不过，经过 10 月，11 月，12 月的加班，又反弹到了 72kg，看来明年还得继续努力啊。</p>\n<p>9 月份跟公司一起去日本旅游了一趟，算是了了自己的一桩心愿。</p>\n<p>投资方面，股市暴跌，基金赔了将近 1 万块。上半年 P2P 暴雷，虽然自己投的平台没有出事，但还是吓得接连减仓。下半年和朋友合伙投资了一家便利店，最终被合伙人坑了，赔了将近 4 万，加上基金赔的，基本上把自己去年在数字货币上赚的又都赔进去了，只能怪自己阅历太少，不知人心险恶。</p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>上面就是我 2018 年的总结，总的来说，2018 年自己的表现并不是很好，年初的很多目标没有完成，留给自己的时间已经不多了，毕竟年龄在那摆着，已经是快奔三的人了。希望自己继续努力加油，在 2019 年能取得更大的进步。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>这几天看到到处都是年终总结的博客，自己也来凑凑热闹。我打算写两篇，第一篇是回顾 2018，第二篇是展望 2019。这是第一篇，主要内容是总结一下自己 2018 年都做了哪些事情，有哪些得失。</p>\n<h2 id=\"学习方面\"><a href=\"#学习方面\" class=\"headerlink\" title=\"学习方面\"></a>学习方面</h2><p>除了 iOS，2018 年自己还确实学了不少东西，下面我大概列举了一下自己 2018 年学的东西：</p>\n<ul>\n<li>HTML/CSS</li>\n<li>JavaScript</li>\n<li>Node.js</li>\n<li>Python/Flask</li>\n<li>Flutter</li>\n<li>React/ReactNative</li>\n<li>微信小程序开发</li>\n</ul>\n<p>虽然学了很多，但是没有太多实践的机会，所有很多东西学的并不是很深入。</p>\n<p>另外，这些东西基本都是在 10 月份之前学的，10 月份开始，由于公司新项目启动，自己进入了疯狂加班状态，学习基本处于半停滞状态。10 月份到 12 月份基本没有学习什么新的东西。</p>\n<p>另外，由于新项目采用 Swift 语言开发，自己在 Swift 语言上也有了一些经验。</p>\n<h2 id=\"工作方面\"><a href=\"#工作方面\" class=\"headerlink\" title=\"工作方面\"></a>工作方面</h2><p>2018 年已经是我在懒人听书呆的第 4 个年头了，说实话，我当初也没有想到自己能呆这么久。</p>\n<p>今年工作上最大的事情就是从 9 月份开始，我作为技术经理，全权负责公司新项目芽芽故事 iOS 端的开发工作。经过团队（3 个人）一起的不懈努力，最终于 12 月中旬，按时完成了开发任务，没有延期。这是我在懒人第一次完整的负责一个 App 的整个开发过程，从最开始的立项，架构设计，技术选型，再到模块划分，人员分配等。这个过程中自己确实得到了很大的锻炼。不光是技术上的，还包括沟通，协调，管理等能力也得到了很大的提升。</p>\n<h2 id=\"生活方面\"><a href=\"#生活方面\" class=\"headerlink\" title=\"生活方面\"></a>生活方面</h2><p>年初定的减肥计划，上半年执行的很好，到 8 月份时最低体重降到了 67kg。不过，经过 10 月，11 月，12 月的加班，又反弹到了 72kg，看来明年还得继续努力啊。</p>\n<p>9 月份跟公司一起去日本旅游了一趟，算是了了自己的一桩心愿。</p>\n<p>投资方面，股市暴跌，基金赔了将近 1 万块。上半年 P2P 暴雷，虽然自己投的平台没有出事，但还是吓得接连减仓。下半年和朋友合伙投资了一家便利店，最终被合伙人坑了，赔了将近 4 万，加上基金赔的，基本上把自己去年在数字货币上赚的又都赔进去了，只能怪自己阅历太少，不知人心险恶。</p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>上面就是我 2018 年的总结，总的来说，2018 年自己的表现并不是很好，年初的很多目标没有完成，留给自己的时间已经不多了，毕竟年龄在那摆着，已经是快奔三的人了。希望自己继续努力加油，在 2019 年能取得更大的进步。</p>\n"},{"title":"【源码解析】Kingfisher","date":"2019-04-23T14:58:39.000Z","_content":"\n这是一篇关于开源框架[Kingfisher](https://github.com/onevcat/Kingfisher)源码解析的文章。\n\n## 1. `imageView.kf`中`kf`是什么？\n\n`Kingfisher.swift`中定义了`KingfisherCompatible`和`KingfisherCompatibleValue`两个协议，两个协议中都定义了`kf`这个属性，如下：\n\n```swift\nextension KingfisherCompatible {\n    /// Gets a namespace holder for Kingfisher compatible types.\n    public var kf: KingfisherWrapper<Self> {\n        get { return KingfisherWrapper(self) }\n        set { }\n    }\n}\n\nextension KingfisherCompatibleValue {\n    /// Gets a namespace holder for Kingfisher compatible types.\n    public var kf: KingfisherWrapper<Self> {\n        get { return KingfisherWrapper(self) }\n        set { }\n    }\n}\n```\n\n紧接着一个名为`Image`的类实现了`KingfisherCompatible`协议，`Image`在`Kingfisher.swift`的头部有定义，在 iOS 系统中代表`UIImageView`，如下：\n\n```swift\n#if os(macOS)\nimport AppKit\npublic typealias Image = NSImage\npublic typealias View = NSView\npublic typealias Color = NSColor\npublic typealias ImageView = NSImageView\npublic typealias Button = NSButton\n#else\nimport UIKit\npublic typealias Image = UIImage\npublic typealias Color = UIColor\n#if !os(watchOS)\npublic typealias ImageView = UIImageView\npublic typealias View = UIView\npublic typealias Button = UIButton\n#else\nimport WatchKit\n#endif\n#endif\n```\n\n这样就实现了为`UIImageView`添加`kf`属性。`kf`的定义如下：\n\n```swift\npublic var kf: KingfisherWrapper<Self> {\n    get { return KingfisherWrapper(self) }\n    set { }\n}\n```\n\n`KingfisherWrapper`的定义如下：\n\n```swift\npublic struct KingfisherWrapper<Base> {\n    public let base: Base\n    public init(_ base: Base) {\n        self.base = base\n    }\n}\n```\n\n这样，`kf`就有一个代表`imageView`的属性`base`，`pring(imageView.kf.base);`打印出来的就是`imageView`。\n\n`KingfisherCompatible`除了被`ImageView`实现，还被`Image`(UIImage),`Button`(UIButton),`WKInterfaceImage`,`CGImage`,`UIApplication`实现，`KingfisherCompatibleValue`被`Data`,`String`,`CGSize`这三个结构体类型实现。\n\n## 2. `imageView.kf.setImage(with: url, options: optionsInfo)`的调用过程是怎样的\n\n```\nflow\nst=>start: Start\ne=>end: End\n```\n","source":"_posts/2019-04-23-【源码解析】Kingfisher.md","raw":"---\ntitle: 【源码解析】Kingfisher\ncategories: Swift\ntags:\n  - Swift\ndate: 2019-04-23 22:58:39\n---\n\n这是一篇关于开源框架[Kingfisher](https://github.com/onevcat/Kingfisher)源码解析的文章。\n\n## 1. `imageView.kf`中`kf`是什么？\n\n`Kingfisher.swift`中定义了`KingfisherCompatible`和`KingfisherCompatibleValue`两个协议，两个协议中都定义了`kf`这个属性，如下：\n\n```swift\nextension KingfisherCompatible {\n    /// Gets a namespace holder for Kingfisher compatible types.\n    public var kf: KingfisherWrapper<Self> {\n        get { return KingfisherWrapper(self) }\n        set { }\n    }\n}\n\nextension KingfisherCompatibleValue {\n    /// Gets a namespace holder for Kingfisher compatible types.\n    public var kf: KingfisherWrapper<Self> {\n        get { return KingfisherWrapper(self) }\n        set { }\n    }\n}\n```\n\n紧接着一个名为`Image`的类实现了`KingfisherCompatible`协议，`Image`在`Kingfisher.swift`的头部有定义，在 iOS 系统中代表`UIImageView`，如下：\n\n```swift\n#if os(macOS)\nimport AppKit\npublic typealias Image = NSImage\npublic typealias View = NSView\npublic typealias Color = NSColor\npublic typealias ImageView = NSImageView\npublic typealias Button = NSButton\n#else\nimport UIKit\npublic typealias Image = UIImage\npublic typealias Color = UIColor\n#if !os(watchOS)\npublic typealias ImageView = UIImageView\npublic typealias View = UIView\npublic typealias Button = UIButton\n#else\nimport WatchKit\n#endif\n#endif\n```\n\n这样就实现了为`UIImageView`添加`kf`属性。`kf`的定义如下：\n\n```swift\npublic var kf: KingfisherWrapper<Self> {\n    get { return KingfisherWrapper(self) }\n    set { }\n}\n```\n\n`KingfisherWrapper`的定义如下：\n\n```swift\npublic struct KingfisherWrapper<Base> {\n    public let base: Base\n    public init(_ base: Base) {\n        self.base = base\n    }\n}\n```\n\n这样，`kf`就有一个代表`imageView`的属性`base`，`pring(imageView.kf.base);`打印出来的就是`imageView`。\n\n`KingfisherCompatible`除了被`ImageView`实现，还被`Image`(UIImage),`Button`(UIButton),`WKInterfaceImage`,`CGImage`,`UIApplication`实现，`KingfisherCompatibleValue`被`Data`,`String`,`CGSize`这三个结构体类型实现。\n\n## 2. `imageView.kf.setImage(with: url, options: optionsInfo)`的调用过程是怎样的\n\n```\nflow\nst=>start: Start\ne=>end: End\n```\n","slug":"【源码解析】Kingfisher","published":1,"updated":"2019-04-23T15:33:45.490Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjutyfmgm0050c4c9fiizjbdi","content":"<p>这是一篇关于开源框架<a href=\"https://github.com/onevcat/Kingfisher\" target=\"_blank\" rel=\"noopener\">Kingfisher</a>源码解析的文章。</p>\n<h2 id=\"1-imageView-kf中kf是什么？\"><a href=\"#1-imageView-kf中kf是什么？\" class=\"headerlink\" title=\"1. imageView.kf中kf是什么？\"></a>1. <code>imageView.kf</code>中<code>kf</code>是什么？</h2><p><code>Kingfisher.swift</code>中定义了<code>KingfisherCompatible</code>和<code>KingfisherCompatibleValue</code>两个协议，两个协议中都定义了<code>kf</code>这个属性，如下：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">KingfisherCompatible</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/// Gets a namespace holder for Kingfisher compatible types.</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">var</span> kf: <span class=\"type\">KingfisherWrapper</span>&lt;<span class=\"type\">Self</span>&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">get</span> &#123; <span class=\"keyword\">return</span> <span class=\"type\">KingfisherWrapper</span>(<span class=\"keyword\">self</span>) &#125;</span><br><span class=\"line\">        <span class=\"keyword\">set</span> &#123; &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">KingfisherCompatibleValue</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/// Gets a namespace holder for Kingfisher compatible types.</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">var</span> kf: <span class=\"type\">KingfisherWrapper</span>&lt;<span class=\"type\">Self</span>&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">get</span> &#123; <span class=\"keyword\">return</span> <span class=\"type\">KingfisherWrapper</span>(<span class=\"keyword\">self</span>) &#125;</span><br><span class=\"line\">        <span class=\"keyword\">set</span> &#123; &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>紧接着一个名为<code>Image</code>的类实现了<code>KingfisherCompatible</code>协议，<code>Image</code>在<code>Kingfisher.swift</code>的头部有定义，在 iOS 系统中代表<code>UIImageView</code>，如下：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#<span class=\"keyword\">if</span> os(macOS)</span><br><span class=\"line\"><span class=\"keyword\">import</span> AppKit</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">typealias</span> <span class=\"type\">Image</span> = <span class=\"type\">NSImage</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">typealias</span> <span class=\"type\">View</span> = <span class=\"type\">NSView</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">typealias</span> <span class=\"type\">Color</span> = <span class=\"type\">NSColor</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">typealias</span> <span class=\"type\">ImageView</span> = <span class=\"type\">NSImageView</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">typealias</span> <span class=\"type\">Button</span> = <span class=\"type\">NSButton</span></span><br><span class=\"line\">#<span class=\"keyword\">else</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> UIKit</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">typealias</span> <span class=\"type\">Image</span> = <span class=\"type\">UIImage</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">typealias</span> <span class=\"type\">Color</span> = <span class=\"type\">UIColor</span></span><br><span class=\"line\">#<span class=\"keyword\">if</span> !os(watchOS)</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">typealias</span> <span class=\"type\">ImageView</span> = <span class=\"type\">UIImageView</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">typealias</span> <span class=\"type\">View</span> = <span class=\"type\">UIView</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">typealias</span> <span class=\"type\">Button</span> = <span class=\"type\">UIButton</span></span><br><span class=\"line\">#<span class=\"keyword\">else</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> WatchKit</span><br><span class=\"line\">#endif</span><br><span class=\"line\">#endif</span><br></pre></td></tr></table></figure>\n<p>这样就实现了为<code>UIImageView</code>添加<code>kf</code>属性。<code>kf</code>的定义如下：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">var</span> kf: <span class=\"type\">KingfisherWrapper</span>&lt;<span class=\"type\">Self</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">get</span> &#123; <span class=\"keyword\">return</span> <span class=\"type\">KingfisherWrapper</span>(<span class=\"keyword\">self</span>) &#125;</span><br><span class=\"line\">    <span class=\"keyword\">set</span> &#123; &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><code>KingfisherWrapper</code>的定义如下：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">KingfisherWrapper</span>&lt;<span class=\"title\">Base</span>&gt; </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">let</span> base: <span class=\"type\">Base</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">init</span>(<span class=\"number\">_</span> base: <span class=\"type\">Base</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.base = base</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这样，<code>kf</code>就有一个代表<code>imageView</code>的属性<code>base</code>，<code>pring(imageView.kf.base);</code>打印出来的就是<code>imageView</code>。</p>\n<p><code>KingfisherCompatible</code>除了被<code>ImageView</code>实现，还被<code>Image</code>(UIImage),<code>Button</code>(UIButton),<code>WKInterfaceImage</code>,<code>CGImage</code>,<code>UIApplication</code>实现，<code>KingfisherCompatibleValue</code>被<code>Data</code>,<code>String</code>,<code>CGSize</code>这三个结构体类型实现。</p>\n<h2 id=\"2-imageView-kf-setImage-with-url-options-optionsInfo-的调用过程是怎样的\"><a href=\"#2-imageView-kf-setImage-with-url-options-optionsInfo-的调用过程是怎样的\" class=\"headerlink\" title=\"2. imageView.kf.setImage(with: url, options: optionsInfo)的调用过程是怎样的\"></a>2. <code>imageView.kf.setImage(with: url, options: optionsInfo)</code>的调用过程是怎样的</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">flow</span><br><span class=\"line\">st=&gt;start: Start</span><br><span class=\"line\">e=&gt;end: End</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<p>这是一篇关于开源框架<a href=\"https://github.com/onevcat/Kingfisher\" target=\"_blank\" rel=\"noopener\">Kingfisher</a>源码解析的文章。</p>\n<h2 id=\"1-imageView-kf中kf是什么？\"><a href=\"#1-imageView-kf中kf是什么？\" class=\"headerlink\" title=\"1. imageView.kf中kf是什么？\"></a>1. <code>imageView.kf</code>中<code>kf</code>是什么？</h2><p><code>Kingfisher.swift</code>中定义了<code>KingfisherCompatible</code>和<code>KingfisherCompatibleValue</code>两个协议，两个协议中都定义了<code>kf</code>这个属性，如下：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">KingfisherCompatible</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/// Gets a namespace holder for Kingfisher compatible types.</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">var</span> kf: <span class=\"type\">KingfisherWrapper</span>&lt;<span class=\"type\">Self</span>&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">get</span> &#123; <span class=\"keyword\">return</span> <span class=\"type\">KingfisherWrapper</span>(<span class=\"keyword\">self</span>) &#125;</span><br><span class=\"line\">        <span class=\"keyword\">set</span> &#123; &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">KingfisherCompatibleValue</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/// Gets a namespace holder for Kingfisher compatible types.</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">var</span> kf: <span class=\"type\">KingfisherWrapper</span>&lt;<span class=\"type\">Self</span>&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">get</span> &#123; <span class=\"keyword\">return</span> <span class=\"type\">KingfisherWrapper</span>(<span class=\"keyword\">self</span>) &#125;</span><br><span class=\"line\">        <span class=\"keyword\">set</span> &#123; &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>紧接着一个名为<code>Image</code>的类实现了<code>KingfisherCompatible</code>协议，<code>Image</code>在<code>Kingfisher.swift</code>的头部有定义，在 iOS 系统中代表<code>UIImageView</code>，如下：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#<span class=\"keyword\">if</span> os(macOS)</span><br><span class=\"line\"><span class=\"keyword\">import</span> AppKit</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">typealias</span> <span class=\"type\">Image</span> = <span class=\"type\">NSImage</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">typealias</span> <span class=\"type\">View</span> = <span class=\"type\">NSView</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">typealias</span> <span class=\"type\">Color</span> = <span class=\"type\">NSColor</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">typealias</span> <span class=\"type\">ImageView</span> = <span class=\"type\">NSImageView</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">typealias</span> <span class=\"type\">Button</span> = <span class=\"type\">NSButton</span></span><br><span class=\"line\">#<span class=\"keyword\">else</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> UIKit</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">typealias</span> <span class=\"type\">Image</span> = <span class=\"type\">UIImage</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">typealias</span> <span class=\"type\">Color</span> = <span class=\"type\">UIColor</span></span><br><span class=\"line\">#<span class=\"keyword\">if</span> !os(watchOS)</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">typealias</span> <span class=\"type\">ImageView</span> = <span class=\"type\">UIImageView</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">typealias</span> <span class=\"type\">View</span> = <span class=\"type\">UIView</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">typealias</span> <span class=\"type\">Button</span> = <span class=\"type\">UIButton</span></span><br><span class=\"line\">#<span class=\"keyword\">else</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> WatchKit</span><br><span class=\"line\">#endif</span><br><span class=\"line\">#endif</span><br></pre></td></tr></table></figure>\n<p>这样就实现了为<code>UIImageView</code>添加<code>kf</code>属性。<code>kf</code>的定义如下：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">var</span> kf: <span class=\"type\">KingfisherWrapper</span>&lt;<span class=\"type\">Self</span>&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">get</span> &#123; <span class=\"keyword\">return</span> <span class=\"type\">KingfisherWrapper</span>(<span class=\"keyword\">self</span>) &#125;</span><br><span class=\"line\">    <span class=\"keyword\">set</span> &#123; &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><code>KingfisherWrapper</code>的定义如下：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">KingfisherWrapper</span>&lt;<span class=\"title\">Base</span>&gt; </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">let</span> base: <span class=\"type\">Base</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">init</span>(<span class=\"number\">_</span> base: <span class=\"type\">Base</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.base = base</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这样，<code>kf</code>就有一个代表<code>imageView</code>的属性<code>base</code>，<code>pring(imageView.kf.base);</code>打印出来的就是<code>imageView</code>。</p>\n<p><code>KingfisherCompatible</code>除了被<code>ImageView</code>实现，还被<code>Image</code>(UIImage),<code>Button</code>(UIButton),<code>WKInterfaceImage</code>,<code>CGImage</code>,<code>UIApplication</code>实现，<code>KingfisherCompatibleValue</code>被<code>Data</code>,<code>String</code>,<code>CGSize</code>这三个结构体类型实现。</p>\n<h2 id=\"2-imageView-kf-setImage-with-url-options-optionsInfo-的调用过程是怎样的\"><a href=\"#2-imageView-kf-setImage-with-url-options-optionsInfo-的调用过程是怎样的\" class=\"headerlink\" title=\"2. imageView.kf.setImage(with: url, options: optionsInfo)的调用过程是怎样的\"></a>2. <code>imageView.kf.setImage(with: url, options: optionsInfo)</code>的调用过程是怎样的</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">flow</span><br><span class=\"line\">st=&gt;start: Start</span><br><span class=\"line\">e=&gt;end: End</span><br></pre></td></tr></table></figure>\n"},{"title":"Flask项目部署：Nginx + Gunicorn","date":"2019-01-27T08:45:05.000Z","_content":"\n最近在做自己的个人项目诗词书斋，用到了服务器，使用的是自己熟悉的 Flask 框架编写后端接口，写完之后需要部署到阿里云服务器上，本文是我对整个部署流程的一个总结。\n\n### 总体方案\n\n总体方案是 Nginx + Gunicorn，Nginx 负责代理转发，Gunicorn 是一个 WSGI 容器，负责启动应用。我使用的是阿里云 Ubuntu 系统。\n\n### 具体步骤\n\n1. 安装 Nginx\n\n```shell\n# 更新源\nsudo apt-get update\n# 安装nginx\nsudo apt-get install nginx\n# 启动nginx\nsudo /etc/init.d/nginx start\n```\n\n启动之后，在浏览器上输入服务器的外网 IP 就可以看到 Nginx 的界面\n\n2. 配置 Nginx\n\n```shell\n# 删除Nginx默认配置文件\nsudo rm /etc/nginx/sites-enabled/default\n# 创建自己的配置文件\nsudo touch /etc/nginx/sites-available/flask_setting\n# 创建连接\nsudo ln /etc/nginx/sites-available/flask_setting /etc/nginx/sites-enabled/flask_setting\n# 编辑配置文件\nvim /etc/nginx/sites-enabled/flask_setting\n```\n\n配置文件内容：\n\n```\nserver {\n        location / {\n                proxy_pass http://127.0.0.1:8000;\n                proxy_set_header Host $host;\n                proxy_set_header X-Real-IP $remote_addr;\n        }\n}\n```\n\n解释：127.0.0.1:8000 是 flask 应用运行的本地地址，gunicorn 运行应用默认使用 8000 端口。\n\n3. 安装 pipenv\n\npipenv 是 Python 的虚拟运行环境。\n\n```shell\ncurl https://raw.githubusercontent.com/kennethreitz/pipenv/master/get-pipenv.py | python\n```\n\n4. 安装 Gunicorn\n\n进入 flask 项目目录，运行虚拟环境\n\n```shell\npipenv shell\npipenv install # 安装flask等项目需要用到的包\npipenv install gunicorn # 安装gunicorn\n```\n\n5. 配置 Gunicorn\n\n在项目目录下创建`config.py`，填入内容\n\n```python\naccesslog = \"/root/log/access.log\"  # 访问日志文件\nerrorlog = \"/root/log/error.log\"  # 错误日志文件\nloglevel = 'info'\ndaemon = True # 作为守护进程运行\n```\n\n6. 运行\n\n```shell\ngunicorn -c config.py release:app\n```\n\nrelease 是项目入口文件包名，app 为入口文件中的应用名，即 Flask 对象的名称。\n\n### 遇到的问题\n\n上面就是整个部署流程，这过程中遇到的问题有如下几个：\n\n1. Ubuntu 默认的 Python 版本比较低，如果需要高版本的 Python，需要先安装 Python，再创建虚拟环境。\n\n```python\n# 使用Python3.7创建虚拟环境\npipenv --python 3.7\n```\n\n2. 代码使用 Git 部署，之前使用的 GitHub，后来发现阿里云竟然屏蔽了 GitHub😒，代码拉不下啦，没办法，给项目添加了一个 Coding.net 的远程仓库，这样才可以把代码拉下来。\n\n### 总结\n\n以上就是我部署 Flask 项目的整个流程，其实 Python 项目的部署方案有很多种，这只是其中的一种方案。\n","source":"_posts/2019-01-27-Flask项目部署：Nginx-Gunicorn.md","raw":"---\ntitle: Flask项目部署：Nginx + Gunicorn\ncategories: Python\ntags:\n  - Python\n  - Flask\n  - Backend\ndate: 2019-01-27 16:45:05\n---\n\n最近在做自己的个人项目诗词书斋，用到了服务器，使用的是自己熟悉的 Flask 框架编写后端接口，写完之后需要部署到阿里云服务器上，本文是我对整个部署流程的一个总结。\n\n### 总体方案\n\n总体方案是 Nginx + Gunicorn，Nginx 负责代理转发，Gunicorn 是一个 WSGI 容器，负责启动应用。我使用的是阿里云 Ubuntu 系统。\n\n### 具体步骤\n\n1. 安装 Nginx\n\n```shell\n# 更新源\nsudo apt-get update\n# 安装nginx\nsudo apt-get install nginx\n# 启动nginx\nsudo /etc/init.d/nginx start\n```\n\n启动之后，在浏览器上输入服务器的外网 IP 就可以看到 Nginx 的界面\n\n2. 配置 Nginx\n\n```shell\n# 删除Nginx默认配置文件\nsudo rm /etc/nginx/sites-enabled/default\n# 创建自己的配置文件\nsudo touch /etc/nginx/sites-available/flask_setting\n# 创建连接\nsudo ln /etc/nginx/sites-available/flask_setting /etc/nginx/sites-enabled/flask_setting\n# 编辑配置文件\nvim /etc/nginx/sites-enabled/flask_setting\n```\n\n配置文件内容：\n\n```\nserver {\n        location / {\n                proxy_pass http://127.0.0.1:8000;\n                proxy_set_header Host $host;\n                proxy_set_header X-Real-IP $remote_addr;\n        }\n}\n```\n\n解释：127.0.0.1:8000 是 flask 应用运行的本地地址，gunicorn 运行应用默认使用 8000 端口。\n\n3. 安装 pipenv\n\npipenv 是 Python 的虚拟运行环境。\n\n```shell\ncurl https://raw.githubusercontent.com/kennethreitz/pipenv/master/get-pipenv.py | python\n```\n\n4. 安装 Gunicorn\n\n进入 flask 项目目录，运行虚拟环境\n\n```shell\npipenv shell\npipenv install # 安装flask等项目需要用到的包\npipenv install gunicorn # 安装gunicorn\n```\n\n5. 配置 Gunicorn\n\n在项目目录下创建`config.py`，填入内容\n\n```python\naccesslog = \"/root/log/access.log\"  # 访问日志文件\nerrorlog = \"/root/log/error.log\"  # 错误日志文件\nloglevel = 'info'\ndaemon = True # 作为守护进程运行\n```\n\n6. 运行\n\n```shell\ngunicorn -c config.py release:app\n```\n\nrelease 是项目入口文件包名，app 为入口文件中的应用名，即 Flask 对象的名称。\n\n### 遇到的问题\n\n上面就是整个部署流程，这过程中遇到的问题有如下几个：\n\n1. Ubuntu 默认的 Python 版本比较低，如果需要高版本的 Python，需要先安装 Python，再创建虚拟环境。\n\n```python\n# 使用Python3.7创建虚拟环境\npipenv --python 3.7\n```\n\n2. 代码使用 Git 部署，之前使用的 GitHub，后来发现阿里云竟然屏蔽了 GitHub😒，代码拉不下啦，没办法，给项目添加了一个 Coding.net 的远程仓库，这样才可以把代码拉下来。\n\n### 总结\n\n以上就是我部署 Flask 项目的整个流程，其实 Python 项目的部署方案有很多种，这只是其中的一种方案。\n","slug":"Flask项目部署：Nginx-Gunicorn","published":1,"updated":"2019-01-27T09:30:04.339Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjutyfmgo0053c4c9luqd6kxr","content":"<p>最近在做自己的个人项目诗词书斋，用到了服务器，使用的是自己熟悉的 Flask 框架编写后端接口，写完之后需要部署到阿里云服务器上，本文是我对整个部署流程的一个总结。</p>\n<h3 id=\"总体方案\"><a href=\"#总体方案\" class=\"headerlink\" title=\"总体方案\"></a>总体方案</h3><p>总体方案是 Nginx + Gunicorn，Nginx 负责代理转发，Gunicorn 是一个 WSGI 容器，负责启动应用。我使用的是阿里云 Ubuntu 系统。</p>\n<h3 id=\"具体步骤\"><a href=\"#具体步骤\" class=\"headerlink\" title=\"具体步骤\"></a>具体步骤</h3><ol>\n<li>安装 Nginx</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span> 更新源</span><br><span class=\"line\">sudo apt-get update</span><br><span class=\"line\"><span class=\"meta\">#</span> 安装nginx</span><br><span class=\"line\">sudo apt-get install nginx</span><br><span class=\"line\"><span class=\"meta\">#</span> 启动nginx</span><br><span class=\"line\">sudo /etc/init.d/nginx start</span><br></pre></td></tr></table></figure>\n<p>启动之后，在浏览器上输入服务器的外网 IP 就可以看到 Nginx 的界面</p>\n<ol start=\"2\">\n<li>配置 Nginx</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span> 删除Nginx默认配置文件</span><br><span class=\"line\">sudo rm /etc/nginx/sites-enabled/default</span><br><span class=\"line\"><span class=\"meta\">#</span> 创建自己的配置文件</span><br><span class=\"line\">sudo touch /etc/nginx/sites-available/flask_setting</span><br><span class=\"line\"><span class=\"meta\">#</span> 创建连接</span><br><span class=\"line\">sudo ln /etc/nginx/sites-available/flask_setting /etc/nginx/sites-enabled/flask_setting</span><br><span class=\"line\"><span class=\"meta\">#</span> 编辑配置文件</span><br><span class=\"line\">vim /etc/nginx/sites-enabled/flask_setting</span><br></pre></td></tr></table></figure>\n<p>配置文件内容：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server &#123;</span><br><span class=\"line\">        location / &#123;</span><br><span class=\"line\">                proxy_pass http://127.0.0.1:8000;</span><br><span class=\"line\">                proxy_set_header Host $host;</span><br><span class=\"line\">                proxy_set_header X-Real-IP $remote_addr;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>解释：127.0.0.1:8000 是 flask 应用运行的本地地址，gunicorn 运行应用默认使用 8000 端口。</p>\n<ol start=\"3\">\n<li>安装 pipenv</li>\n</ol>\n<p>pipenv 是 Python 的虚拟运行环境。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl https://raw.githubusercontent.com/kennethreitz/pipenv/master/get-pipenv.py | python</span><br></pre></td></tr></table></figure>\n<ol start=\"4\">\n<li>安装 Gunicorn</li>\n</ol>\n<p>进入 flask 项目目录，运行虚拟环境</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pipenv shell</span><br><span class=\"line\">pipenv install # 安装flask等项目需要用到的包</span><br><span class=\"line\">pipenv install gunicorn # 安装gunicorn</span><br></pre></td></tr></table></figure>\n<ol start=\"5\">\n<li>配置 Gunicorn</li>\n</ol>\n<p>在项目目录下创建<code>config.py</code>，填入内容</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">accesslog = <span class=\"string\">\"/root/log/access.log\"</span>  <span class=\"comment\"># 访问日志文件</span></span><br><span class=\"line\">errorlog = <span class=\"string\">\"/root/log/error.log\"</span>  <span class=\"comment\"># 错误日志文件</span></span><br><span class=\"line\">loglevel = <span class=\"string\">'info'</span></span><br><span class=\"line\">daemon = <span class=\"keyword\">True</span> <span class=\"comment\"># 作为守护进程运行</span></span><br></pre></td></tr></table></figure>\n<ol start=\"6\">\n<li>运行</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">gunicorn -c config.py release:app</span><br></pre></td></tr></table></figure>\n<p>release 是项目入口文件包名，app 为入口文件中的应用名，即 Flask 对象的名称。</p>\n<h3 id=\"遇到的问题\"><a href=\"#遇到的问题\" class=\"headerlink\" title=\"遇到的问题\"></a>遇到的问题</h3><p>上面就是整个部署流程，这过程中遇到的问题有如下几个：</p>\n<ol>\n<li>Ubuntu 默认的 Python 版本比较低，如果需要高版本的 Python，需要先安装 Python，再创建虚拟环境。</li>\n</ol>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 使用Python3.7创建虚拟环境</span></span><br><span class=\"line\">pipenv --python <span class=\"number\">3.7</span></span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>代码使用 Git 部署，之前使用的 GitHub，后来发现阿里云竟然屏蔽了 GitHub😒，代码拉不下啦，没办法，给项目添加了一个 Coding.net 的远程仓库，这样才可以把代码拉下来。</li>\n</ol>\n<h3 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h3><p>以上就是我部署 Flask 项目的整个流程，其实 Python 项目的部署方案有很多种，这只是其中的一种方案。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>最近在做自己的个人项目诗词书斋，用到了服务器，使用的是自己熟悉的 Flask 框架编写后端接口，写完之后需要部署到阿里云服务器上，本文是我对整个部署流程的一个总结。</p>\n<h3 id=\"总体方案\"><a href=\"#总体方案\" class=\"headerlink\" title=\"总体方案\"></a>总体方案</h3><p>总体方案是 Nginx + Gunicorn，Nginx 负责代理转发，Gunicorn 是一个 WSGI 容器，负责启动应用。我使用的是阿里云 Ubuntu 系统。</p>\n<h3 id=\"具体步骤\"><a href=\"#具体步骤\" class=\"headerlink\" title=\"具体步骤\"></a>具体步骤</h3><ol>\n<li>安装 Nginx</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span> 更新源</span><br><span class=\"line\">sudo apt-get update</span><br><span class=\"line\"><span class=\"meta\">#</span> 安装nginx</span><br><span class=\"line\">sudo apt-get install nginx</span><br><span class=\"line\"><span class=\"meta\">#</span> 启动nginx</span><br><span class=\"line\">sudo /etc/init.d/nginx start</span><br></pre></td></tr></table></figure>\n<p>启动之后，在浏览器上输入服务器的外网 IP 就可以看到 Nginx 的界面</p>\n<ol start=\"2\">\n<li>配置 Nginx</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span> 删除Nginx默认配置文件</span><br><span class=\"line\">sudo rm /etc/nginx/sites-enabled/default</span><br><span class=\"line\"><span class=\"meta\">#</span> 创建自己的配置文件</span><br><span class=\"line\">sudo touch /etc/nginx/sites-available/flask_setting</span><br><span class=\"line\"><span class=\"meta\">#</span> 创建连接</span><br><span class=\"line\">sudo ln /etc/nginx/sites-available/flask_setting /etc/nginx/sites-enabled/flask_setting</span><br><span class=\"line\"><span class=\"meta\">#</span> 编辑配置文件</span><br><span class=\"line\">vim /etc/nginx/sites-enabled/flask_setting</span><br></pre></td></tr></table></figure>\n<p>配置文件内容：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server &#123;</span><br><span class=\"line\">        location / &#123;</span><br><span class=\"line\">                proxy_pass http://127.0.0.1:8000;</span><br><span class=\"line\">                proxy_set_header Host $host;</span><br><span class=\"line\">                proxy_set_header X-Real-IP $remote_addr;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>解释：127.0.0.1:8000 是 flask 应用运行的本地地址，gunicorn 运行应用默认使用 8000 端口。</p>\n<ol start=\"3\">\n<li>安装 pipenv</li>\n</ol>\n<p>pipenv 是 Python 的虚拟运行环境。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl https://raw.githubusercontent.com/kennethreitz/pipenv/master/get-pipenv.py | python</span><br></pre></td></tr></table></figure>\n<ol start=\"4\">\n<li>安装 Gunicorn</li>\n</ol>\n<p>进入 flask 项目目录，运行虚拟环境</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pipenv shell</span><br><span class=\"line\">pipenv install # 安装flask等项目需要用到的包</span><br><span class=\"line\">pipenv install gunicorn # 安装gunicorn</span><br></pre></td></tr></table></figure>\n<ol start=\"5\">\n<li>配置 Gunicorn</li>\n</ol>\n<p>在项目目录下创建<code>config.py</code>，填入内容</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">accesslog = <span class=\"string\">\"/root/log/access.log\"</span>  <span class=\"comment\"># 访问日志文件</span></span><br><span class=\"line\">errorlog = <span class=\"string\">\"/root/log/error.log\"</span>  <span class=\"comment\"># 错误日志文件</span></span><br><span class=\"line\">loglevel = <span class=\"string\">'info'</span></span><br><span class=\"line\">daemon = <span class=\"keyword\">True</span> <span class=\"comment\"># 作为守护进程运行</span></span><br></pre></td></tr></table></figure>\n<ol start=\"6\">\n<li>运行</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">gunicorn -c config.py release:app</span><br></pre></td></tr></table></figure>\n<p>release 是项目入口文件包名，app 为入口文件中的应用名，即 Flask 对象的名称。</p>\n<h3 id=\"遇到的问题\"><a href=\"#遇到的问题\" class=\"headerlink\" title=\"遇到的问题\"></a>遇到的问题</h3><p>上面就是整个部署流程，这过程中遇到的问题有如下几个：</p>\n<ol>\n<li>Ubuntu 默认的 Python 版本比较低，如果需要高版本的 Python，需要先安装 Python，再创建虚拟环境。</li>\n</ol>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 使用Python3.7创建虚拟环境</span></span><br><span class=\"line\">pipenv --python <span class=\"number\">3.7</span></span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>代码使用 Git 部署，之前使用的 GitHub，后来发现阿里云竟然屏蔽了 GitHub😒，代码拉不下啦，没办法，给项目添加了一个 Coding.net 的远程仓库，这样才可以把代码拉下来。</li>\n</ol>\n<h3 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h3><p>以上就是我部署 Flask 项目的整个流程，其实 Python 项目的部署方案有很多种，这只是其中的一种方案。</p>\n"},{"layout":"post","title":"iOS中的富文本技术(2)CoreText框架","_content":"\n\n## 前言\n前一篇介绍了iOS7新出的TextKit，这一篇打算介绍一下更底层的CoreText框架\n\n## 简介\nCoreText是iOS3.2推出的一套文字排版和渲染框架，可以实现图文混排，富文本显示等效果。CoreText中的几个重要的概念：\n* CTFrameRef：画布，包含多个CTLine\n* CTLineRef：每一行就是一个CTLine\n* CTRunRef：每一行可以分为多个属性相同的小段，每一个小段就是一个CTRun\n如下图展示了这三者的关系：\n\n![这里写图片描述](http://img.blog.csdn.net/20150403235844681)\n\n## 示例\n废话不多说，直接看示例，第一个示例展示了一些常规属性的的设置，效果图如下：\n\n![这里写图片描述](http://img.blog.csdn.net/20150404001114995)\n\n代码如下，这里使用了一个自定义View，然后把要展示的内容绘制在view上，注意代码中使用了很多CoreFoundation框架的类（实际上是结构体），需要使用__bridge进行桥接：\n\n```objectivec\n#import \"DisplayView.h\"\n@import CoreText;\n\nNSString * str4 = @\"asfasfa阿斯顿发生大发撒放大离开家撒旦法按时付款就阿里；双方均asfasdfasfdalkjsflakj阿斯顿发生大发撒旦法asdfasdfaasfdaasa撒旦法；拉斯克奖发了奥斯卡奖罚洛杉矶的法律；看见谁发的阿斯利康就发；了数据库等法律按实际开发；阿里就开始放到了；安家费阿里山科技发达了开始将对方拉开始交电费了卡双方的空间啊发送卡飞机阿里开始就放暑假了罚款就是浪费\";\n\n@interface DisplayView ()\n\n@end\n\n@implementation DisplayView\n\n- (void)drawRect:(CGRect)rect {\n\n    [super drawRect:rect];\n\n    CGContextRef context = UIGraphicsGetCurrentContext();\n\n    //变换坐标\n    CGContextSetTextMatrix(context, CGAffineTransformIdentity);\n    CGContextTranslateCTM(context, 0, self.bounds.size.height);\n    CGContextScaleCTM(context, 1.0, -1.0);\n\n    //设置绘制的路径\n    CGMutablePathRef path = CGPathCreateMutable();\n    CGPathAddRect(path, NULL, self.bounds);\n\n    //创建属性字符串\n    NSMutableAttributedString * attStr = [[NSMutableAttributedString alloc] initWithString:str4];\n\n    //颜色\n    [attStr addAttribute:(__bridge NSString *)kCTForegroundColorAttributeName value:(__bridge id)[UIColor redColor].CGColor range:NSMakeRange(5, 10)];\n\n    //字体\n    UIFont * font = [UIFont systemFontOfSize:25];\n    CTFontRef fontRef = CTFontCreateWithName((__bridge CFStringRef)font.fontName, 25, NULL);\n    [attStr addAttribute:(__bridge NSString *)kCTFontAttributeName value:(__bridge id)fontRef range:NSMakeRange(20, 10)];\n\n    //空心字\n    [attStr addAttribute:(__bridge NSString *)kCTStrokeWidthAttributeName value:@(3) range:NSMakeRange(36, 5)];\n    [attStr addAttribute:(__bridge NSString *)kCTStrokeColorAttributeName value:(__bridge id)[UIColor blueColor].CGColor range:NSMakeRange(37, 10)];\n\n    //下划线\n    [attStr addAttribute:(__bridge NSString *)kCTUnderlineStyleAttributeName value:@(kCTUnderlineStyleSingle | kCTUnderlinePatternDot) range:NSMakeRange(45, 15)];\n\n\n    CTFramesetterRef framesetter = CTFramesetterCreateWithAttributedString((CFAttributedStringRef)attStr);\n    CTFrameRef frame = CTFramesetterCreateFrame(framesetter, CFRangeMake(0, attStr.length), path, NULL);\n\n    //绘制内容\n    CTFrameDraw(frame, context);\n\n    CFRelease(fontRef);\n    CFRelease(frame);\n    CFRelease(path);\n    CFRelease(framesetter);\n\n}\n@end\n```\n\n第二个示例展示了一个带表情符号的文本，效果图如下：\n\n![这里写图片描述](http://img.blog.csdn.net/20150404002937477)\n\n先介绍一下CoreText实现表情混排的原理，在简介中介绍过，一个CTLine代表一行，而一个CTLine又由多个CTRun组成，这里实现表情混排的原理其实就是把CTLine中的某一个CTRun替换成空白字符，然后再根据这个CTRun的具体位置，把图片绘制到这个位置上，下面是具体代码：\n```objectivec\n#import \"ImageDisplayView.h\"\n@import CoreText;\n\nNSString * str5 = @\"asfasfa阿斯顿发生大发撒放大离开家撒旦法按时付款就阿里；双方均asfasdfasfdalkjsflakj阿斯顿发生大发撒旦法asdfasdfaasfdaasa撒旦法；拉斯克奖发了奥斯卡奖罚洛杉矶的法律；看见谁发的阿斯利康就发；了数据库等法律按实际开发；阿里就开始放到了；安家费阿里山科技发达了开始将对方拉开始交电费了卡双方的空间啊发送卡飞机阿里开始就放暑假了罚款就是浪费\";\n\n@interface ImageDisplayView ()\n\n@property (nonatomic, strong) NSAttributedString * attStr;\n\n@end\n\n//回调方法，返回要替换的CTRun的下边缘距离本行文字下边缘的高度\nstatic CGFloat descentCallback(void *ref)\n{\n    return 0;\n}\n\n//回调方法，返回要替换的CTRun的上边缘距离本行文字上边缘的高度\nstatic CGFloat ascentCallback(void *ref)\n{\n    return 30;\n}\n\n//回调方法，返回要替换的CTRun的宽\nstatic CGFloat widthCallback(void *ref)\n{\n    return 30;\n}\n\n@implementation ImageDisplayView\n{\n    CTRunDelegateRef _delegate;\n}\n\n- (instancetype)initWithFrame:(CGRect)frame\n{\n    self = [super initWithFrame:frame];\n    if (self) {\n        NSString * name = @\"010\";\n        unichar objectReplacementChar           = 0xFFFC;//占位字符\n        NSString *objectReplacementString       = [NSString stringWithCharacters:&objectReplacementChar length:1];\n        NSMutableAttributedString *attachText   = [[NSMutableAttributedString alloc]initWithString:objectReplacementString];\n\n        //创建CTRun代理回调\n        CTRunDelegateCallbacks callbacks;\n        callbacks.version       = kCTRunDelegateVersion1;\n        callbacks.getAscent     = ascentCallback;\n        callbacks.getDescent    = descentCallback;\n        callbacks.getWidth      = widthCallback;\n\n        //给属性字符串添加代理回调\n        CTRunDelegateRef delegate = CTRunDelegateCreate(&callbacks, (void *)name);\n        NSDictionary *attr = [NSDictionary dictionaryWithObjectsAndKeys:(__bridge id)delegate,kCTRunDelegateAttributeName, nil];\n        [attachText setAttributes:attr range:NSMakeRange(0, 1)];\n        self.attStr = attachText;\n    }\n    return self;\n}\n\n- (void)drawRect:(CGRect)rect {\n\n    [super drawRect:rect];\n\n    CGContextRef context = UIGraphicsGetCurrentContext();\n\n    //变换坐标\n    CGContextSetTextMatrix(context, CGAffineTransformIdentity);\n    CGContextTranslateCTM(context, 0, self.bounds.size.height);\n    CGContextScaleCTM(context, 1.0, -1.0);\n\n    //设置文本绘制的路径\n    CGMutablePathRef path = CGPathCreateMutable();\n    CGPathAddRect(path, NULL, self.bounds);\n\n    NSMutableAttributedString * attStr = [[NSMutableAttributedString alloc] initWithString:str5];\n    [attStr insertAttributedString:self.attStr atIndex:50];\n\n    CTFramesetterRef framesetter = CTFramesetterCreateWithAttributedString((CFAttributedStringRef)attStr);\n    CTFrameRef frame = CTFramesetterCreateFrame(framesetter, CFRangeMake(0, attStr.length), path, NULL);\n\n    //计算要替换的CTRun的具体位置\n    NSArray * lines = (NSArray *)CTFrameGetLines(frame);\n    NSUInteger lineCount = lines.count;\n    CGPoint lineOrigins[lineCount];\n    CTFrameGetLineOrigins(frame, CFRangeMake(0, 0), lineOrigins);\n    //循环遍历每一个CTLine中的每一个CTRun，找到要替换的那个CTRun，并且计算它的位置\n    for (int i = 0; i < lineCount; i++) {\n        CTLineRef line = (__bridge CTLineRef)lines[i];\n        CFArrayRef runs = CTLineGetGlyphRuns(line);\n        CFIndex runCount = CFArrayGetCount(runs);\n        CGPoint lineOrigin = lineOrigins[i];\n        CGFloat lineAscent;\n        CGFloat lineDescent;\n        CTLineGetTypographicBounds(line, &lineAscent, &lineDescent, NULL);\n        for (CFIndex k = 0; k < runCount; k++)\n        {\n            CTRunRef run = CFArrayGetValueAtIndex(runs, k);\n            NSDictionary *runAttributes = (NSDictionary *)CTRunGetAttributes(run);\n            CTRunDelegateRef delegate = (__bridge CTRunDelegateRef)[runAttributes valueForKey:(id)kCTRunDelegateAttributeName];\n            if (nil == delegate)\n            {\n                continue;\n            }\n\n            CGFloat xOffset = CTLineGetOffsetForStringIndex(line, CTRunGetStringRange(run).location, nil);\n            CGRect rect = CGRectMake(lineOrigin.x + xOffset, lineOrigin.y - lineDescent, 30, 30);\n\n            //绘制图片\n            CGContextDrawImage(context, rect, [UIImage imageNamed:@\"010\"].CGImage);\n        }\n\n    }\n\n    CTFrameDraw(frame, context);\n\n    CFRelease(frame);\n    CFRelease(path);\n    CFRelease(framesetter);\n\n}\n\n@end\n```\n\n## 总结\n\n下面总结一下CoreText的优缺点：\n* 优点：功能强大，支持iOS3.2以后的所有系统\n* 缺点：纯C的接口，使用复杂，需要自己管理内存\n\nCoreText更加详细的介绍推荐大家可以看看唐巧大神的《iOS开发进阶》第十七章的内容。\n","source":"_posts/2015-10-04-iOS中的富文本技术(2)CoreText框架.md","raw":"---\nlayout: post\ntitle: \"iOS中的富文本技术(2)CoreText框架\"\ncategories: \"iOS开发\"\n---\n\n\n## 前言\n前一篇介绍了iOS7新出的TextKit，这一篇打算介绍一下更底层的CoreText框架\n\n## 简介\nCoreText是iOS3.2推出的一套文字排版和渲染框架，可以实现图文混排，富文本显示等效果。CoreText中的几个重要的概念：\n* CTFrameRef：画布，包含多个CTLine\n* CTLineRef：每一行就是一个CTLine\n* CTRunRef：每一行可以分为多个属性相同的小段，每一个小段就是一个CTRun\n如下图展示了这三者的关系：\n\n![这里写图片描述](http://img.blog.csdn.net/20150403235844681)\n\n## 示例\n废话不多说，直接看示例，第一个示例展示了一些常规属性的的设置，效果图如下：\n\n![这里写图片描述](http://img.blog.csdn.net/20150404001114995)\n\n代码如下，这里使用了一个自定义View，然后把要展示的内容绘制在view上，注意代码中使用了很多CoreFoundation框架的类（实际上是结构体），需要使用__bridge进行桥接：\n\n```objectivec\n#import \"DisplayView.h\"\n@import CoreText;\n\nNSString * str4 = @\"asfasfa阿斯顿发生大发撒放大离开家撒旦法按时付款就阿里；双方均asfasdfasfdalkjsflakj阿斯顿发生大发撒旦法asdfasdfaasfdaasa撒旦法；拉斯克奖发了奥斯卡奖罚洛杉矶的法律；看见谁发的阿斯利康就发；了数据库等法律按实际开发；阿里就开始放到了；安家费阿里山科技发达了开始将对方拉开始交电费了卡双方的空间啊发送卡飞机阿里开始就放暑假了罚款就是浪费\";\n\n@interface DisplayView ()\n\n@end\n\n@implementation DisplayView\n\n- (void)drawRect:(CGRect)rect {\n\n    [super drawRect:rect];\n\n    CGContextRef context = UIGraphicsGetCurrentContext();\n\n    //变换坐标\n    CGContextSetTextMatrix(context, CGAffineTransformIdentity);\n    CGContextTranslateCTM(context, 0, self.bounds.size.height);\n    CGContextScaleCTM(context, 1.0, -1.0);\n\n    //设置绘制的路径\n    CGMutablePathRef path = CGPathCreateMutable();\n    CGPathAddRect(path, NULL, self.bounds);\n\n    //创建属性字符串\n    NSMutableAttributedString * attStr = [[NSMutableAttributedString alloc] initWithString:str4];\n\n    //颜色\n    [attStr addAttribute:(__bridge NSString *)kCTForegroundColorAttributeName value:(__bridge id)[UIColor redColor].CGColor range:NSMakeRange(5, 10)];\n\n    //字体\n    UIFont * font = [UIFont systemFontOfSize:25];\n    CTFontRef fontRef = CTFontCreateWithName((__bridge CFStringRef)font.fontName, 25, NULL);\n    [attStr addAttribute:(__bridge NSString *)kCTFontAttributeName value:(__bridge id)fontRef range:NSMakeRange(20, 10)];\n\n    //空心字\n    [attStr addAttribute:(__bridge NSString *)kCTStrokeWidthAttributeName value:@(3) range:NSMakeRange(36, 5)];\n    [attStr addAttribute:(__bridge NSString *)kCTStrokeColorAttributeName value:(__bridge id)[UIColor blueColor].CGColor range:NSMakeRange(37, 10)];\n\n    //下划线\n    [attStr addAttribute:(__bridge NSString *)kCTUnderlineStyleAttributeName value:@(kCTUnderlineStyleSingle | kCTUnderlinePatternDot) range:NSMakeRange(45, 15)];\n\n\n    CTFramesetterRef framesetter = CTFramesetterCreateWithAttributedString((CFAttributedStringRef)attStr);\n    CTFrameRef frame = CTFramesetterCreateFrame(framesetter, CFRangeMake(0, attStr.length), path, NULL);\n\n    //绘制内容\n    CTFrameDraw(frame, context);\n\n    CFRelease(fontRef);\n    CFRelease(frame);\n    CFRelease(path);\n    CFRelease(framesetter);\n\n}\n@end\n```\n\n第二个示例展示了一个带表情符号的文本，效果图如下：\n\n![这里写图片描述](http://img.blog.csdn.net/20150404002937477)\n\n先介绍一下CoreText实现表情混排的原理，在简介中介绍过，一个CTLine代表一行，而一个CTLine又由多个CTRun组成，这里实现表情混排的原理其实就是把CTLine中的某一个CTRun替换成空白字符，然后再根据这个CTRun的具体位置，把图片绘制到这个位置上，下面是具体代码：\n```objectivec\n#import \"ImageDisplayView.h\"\n@import CoreText;\n\nNSString * str5 = @\"asfasfa阿斯顿发生大发撒放大离开家撒旦法按时付款就阿里；双方均asfasdfasfdalkjsflakj阿斯顿发生大发撒旦法asdfasdfaasfdaasa撒旦法；拉斯克奖发了奥斯卡奖罚洛杉矶的法律；看见谁发的阿斯利康就发；了数据库等法律按实际开发；阿里就开始放到了；安家费阿里山科技发达了开始将对方拉开始交电费了卡双方的空间啊发送卡飞机阿里开始就放暑假了罚款就是浪费\";\n\n@interface ImageDisplayView ()\n\n@property (nonatomic, strong) NSAttributedString * attStr;\n\n@end\n\n//回调方法，返回要替换的CTRun的下边缘距离本行文字下边缘的高度\nstatic CGFloat descentCallback(void *ref)\n{\n    return 0;\n}\n\n//回调方法，返回要替换的CTRun的上边缘距离本行文字上边缘的高度\nstatic CGFloat ascentCallback(void *ref)\n{\n    return 30;\n}\n\n//回调方法，返回要替换的CTRun的宽\nstatic CGFloat widthCallback(void *ref)\n{\n    return 30;\n}\n\n@implementation ImageDisplayView\n{\n    CTRunDelegateRef _delegate;\n}\n\n- (instancetype)initWithFrame:(CGRect)frame\n{\n    self = [super initWithFrame:frame];\n    if (self) {\n        NSString * name = @\"010\";\n        unichar objectReplacementChar           = 0xFFFC;//占位字符\n        NSString *objectReplacementString       = [NSString stringWithCharacters:&objectReplacementChar length:1];\n        NSMutableAttributedString *attachText   = [[NSMutableAttributedString alloc]initWithString:objectReplacementString];\n\n        //创建CTRun代理回调\n        CTRunDelegateCallbacks callbacks;\n        callbacks.version       = kCTRunDelegateVersion1;\n        callbacks.getAscent     = ascentCallback;\n        callbacks.getDescent    = descentCallback;\n        callbacks.getWidth      = widthCallback;\n\n        //给属性字符串添加代理回调\n        CTRunDelegateRef delegate = CTRunDelegateCreate(&callbacks, (void *)name);\n        NSDictionary *attr = [NSDictionary dictionaryWithObjectsAndKeys:(__bridge id)delegate,kCTRunDelegateAttributeName, nil];\n        [attachText setAttributes:attr range:NSMakeRange(0, 1)];\n        self.attStr = attachText;\n    }\n    return self;\n}\n\n- (void)drawRect:(CGRect)rect {\n\n    [super drawRect:rect];\n\n    CGContextRef context = UIGraphicsGetCurrentContext();\n\n    //变换坐标\n    CGContextSetTextMatrix(context, CGAffineTransformIdentity);\n    CGContextTranslateCTM(context, 0, self.bounds.size.height);\n    CGContextScaleCTM(context, 1.0, -1.0);\n\n    //设置文本绘制的路径\n    CGMutablePathRef path = CGPathCreateMutable();\n    CGPathAddRect(path, NULL, self.bounds);\n\n    NSMutableAttributedString * attStr = [[NSMutableAttributedString alloc] initWithString:str5];\n    [attStr insertAttributedString:self.attStr atIndex:50];\n\n    CTFramesetterRef framesetter = CTFramesetterCreateWithAttributedString((CFAttributedStringRef)attStr);\n    CTFrameRef frame = CTFramesetterCreateFrame(framesetter, CFRangeMake(0, attStr.length), path, NULL);\n\n    //计算要替换的CTRun的具体位置\n    NSArray * lines = (NSArray *)CTFrameGetLines(frame);\n    NSUInteger lineCount = lines.count;\n    CGPoint lineOrigins[lineCount];\n    CTFrameGetLineOrigins(frame, CFRangeMake(0, 0), lineOrigins);\n    //循环遍历每一个CTLine中的每一个CTRun，找到要替换的那个CTRun，并且计算它的位置\n    for (int i = 0; i < lineCount; i++) {\n        CTLineRef line = (__bridge CTLineRef)lines[i];\n        CFArrayRef runs = CTLineGetGlyphRuns(line);\n        CFIndex runCount = CFArrayGetCount(runs);\n        CGPoint lineOrigin = lineOrigins[i];\n        CGFloat lineAscent;\n        CGFloat lineDescent;\n        CTLineGetTypographicBounds(line, &lineAscent, &lineDescent, NULL);\n        for (CFIndex k = 0; k < runCount; k++)\n        {\n            CTRunRef run = CFArrayGetValueAtIndex(runs, k);\n            NSDictionary *runAttributes = (NSDictionary *)CTRunGetAttributes(run);\n            CTRunDelegateRef delegate = (__bridge CTRunDelegateRef)[runAttributes valueForKey:(id)kCTRunDelegateAttributeName];\n            if (nil == delegate)\n            {\n                continue;\n            }\n\n            CGFloat xOffset = CTLineGetOffsetForStringIndex(line, CTRunGetStringRange(run).location, nil);\n            CGRect rect = CGRectMake(lineOrigin.x + xOffset, lineOrigin.y - lineDescent, 30, 30);\n\n            //绘制图片\n            CGContextDrawImage(context, rect, [UIImage imageNamed:@\"010\"].CGImage);\n        }\n\n    }\n\n    CTFrameDraw(frame, context);\n\n    CFRelease(frame);\n    CFRelease(path);\n    CFRelease(framesetter);\n\n}\n\n@end\n```\n\n## 总结\n\n下面总结一下CoreText的优缺点：\n* 优点：功能强大，支持iOS3.2以后的所有系统\n* 缺点：纯C的接口，使用复杂，需要自己管理内存\n\nCoreText更加详细的介绍推荐大家可以看看唐巧大神的《iOS开发进阶》第十七章的内容。\n","slug":"iOS中的富文本技术(2)CoreText框架","published":1,"date":"2015-10-03T16:00:00.000Z","updated":"2017-03-01T06:42:53.000Z","comments":1,"photos":[],"link":"","_id":"cjutyfmj6006qc4c9r1mfxtr8","content":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>前一篇介绍了iOS7新出的TextKit，这一篇打算介绍一下更底层的CoreText框架</p>\n<h2 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h2><p>CoreText是iOS3.2推出的一套文字排版和渲染框架，可以实现图文混排，富文本显示等效果。CoreText中的几个重要的概念：</p>\n<ul>\n<li>CTFrameRef：画布，包含多个CTLine</li>\n<li>CTLineRef：每一行就是一个CTLine</li>\n<li>CTRunRef：每一行可以分为多个属性相同的小段，每一个小段就是一个CTRun<br>如下图展示了这三者的关系：</li>\n</ul>\n<p><img src=\"http://img.blog.csdn.net/20150403235844681\" alt=\"这里写图片描述\"></p>\n<h2 id=\"示例\"><a href=\"#示例\" class=\"headerlink\" title=\"示例\"></a>示例</h2><p>废话不多说，直接看示例，第一个示例展示了一些常规属性的的设置，效果图如下：</p>\n<p><img src=\"http://img.blog.csdn.net/20150404001114995\" alt=\"这里写图片描述\"></p>\n<p>代码如下，这里使用了一个自定义View，然后把要展示的内容绘制在view上，注意代码中使用了很多CoreFoundation框架的类（实际上是结构体），需要使用__bridge进行桥接：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">\"DisplayView.h\"</span></span></span><br><span class=\"line\"><span class=\"keyword\">@import</span> CoreText;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">NSString</span> * str4 = <span class=\"string\">@\"asfasfa阿斯顿发生大发撒放大离开家撒旦法按时付款就阿里；双方均asfasdfasfdalkjsflakj阿斯顿发生大发撒旦法asdfasdfaasfdaasa撒旦法；拉斯克奖发了奥斯卡奖罚洛杉矶的法律；看见谁发的阿斯利康就发；了数据库等法律按实际开发；阿里就开始放到了；安家费阿里山科技发达了开始将对方拉开始交电费了卡双方的空间啊发送卡飞机阿里开始就放暑假了罚款就是浪费\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">DisplayView</span> ()</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">DisplayView</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)drawRect:(<span class=\"built_in\">CGRect</span>)rect &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    [<span class=\"keyword\">super</span> drawRect:rect];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">CGContextRef</span> context = <span class=\"built_in\">UIGraphicsGetCurrentContext</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//变换坐标</span></span><br><span class=\"line\">    <span class=\"built_in\">CGContextSetTextMatrix</span>(context, <span class=\"built_in\">CGAffineTransformIdentity</span>);</span><br><span class=\"line\">    <span class=\"built_in\">CGContextTranslateCTM</span>(context, <span class=\"number\">0</span>, <span class=\"keyword\">self</span>.bounds.size.height);</span><br><span class=\"line\">    <span class=\"built_in\">CGContextScaleCTM</span>(context, <span class=\"number\">1.0</span>, <span class=\"number\">-1.0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//设置绘制的路径</span></span><br><span class=\"line\">    <span class=\"built_in\">CGMutablePathRef</span> path = <span class=\"built_in\">CGPathCreateMutable</span>();</span><br><span class=\"line\">    <span class=\"built_in\">CGPathAddRect</span>(path, <span class=\"literal\">NULL</span>, <span class=\"keyword\">self</span>.bounds);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//创建属性字符串</span></span><br><span class=\"line\">    <span class=\"built_in\">NSMutableAttributedString</span> * attStr = [[<span class=\"built_in\">NSMutableAttributedString</span> alloc] initWithString:str4];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//颜色</span></span><br><span class=\"line\">    [attStr addAttribute:(__bridge <span class=\"built_in\">NSString</span> *)kCTForegroundColorAttributeName value:(__bridge <span class=\"keyword\">id</span>)[<span class=\"built_in\">UIColor</span> redColor].CGColor range:<span class=\"built_in\">NSMakeRange</span>(<span class=\"number\">5</span>, <span class=\"number\">10</span>)];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//字体</span></span><br><span class=\"line\">    <span class=\"built_in\">UIFont</span> * font = [<span class=\"built_in\">UIFont</span> systemFontOfSize:<span class=\"number\">25</span>];</span><br><span class=\"line\">    <span class=\"built_in\">CTFontRef</span> fontRef = <span class=\"built_in\">CTFontCreateWithName</span>((__bridge <span class=\"built_in\">CFStringRef</span>)font.fontName, <span class=\"number\">25</span>, <span class=\"literal\">NULL</span>);</span><br><span class=\"line\">    [attStr addAttribute:(__bridge <span class=\"built_in\">NSString</span> *)kCTFontAttributeName value:(__bridge <span class=\"keyword\">id</span>)fontRef range:<span class=\"built_in\">NSMakeRange</span>(<span class=\"number\">20</span>, <span class=\"number\">10</span>)];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//空心字</span></span><br><span class=\"line\">    [attStr addAttribute:(__bridge <span class=\"built_in\">NSString</span> *)kCTStrokeWidthAttributeName value:@(<span class=\"number\">3</span>) range:<span class=\"built_in\">NSMakeRange</span>(<span class=\"number\">36</span>, <span class=\"number\">5</span>)];</span><br><span class=\"line\">    [attStr addAttribute:(__bridge <span class=\"built_in\">NSString</span> *)kCTStrokeColorAttributeName value:(__bridge <span class=\"keyword\">id</span>)[<span class=\"built_in\">UIColor</span> blueColor].CGColor range:<span class=\"built_in\">NSMakeRange</span>(<span class=\"number\">37</span>, <span class=\"number\">10</span>)];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//下划线</span></span><br><span class=\"line\">    [attStr addAttribute:(__bridge <span class=\"built_in\">NSString</span> *)kCTUnderlineStyleAttributeName value:@(kCTUnderlineStyleSingle | kCTUnderlinePatternDot) range:<span class=\"built_in\">NSMakeRange</span>(<span class=\"number\">45</span>, <span class=\"number\">15</span>)];</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">CTFramesetterRef</span> framesetter = <span class=\"built_in\">CTFramesetterCreateWithAttributedString</span>((<span class=\"built_in\">CFAttributedStringRef</span>)attStr);</span><br><span class=\"line\">    <span class=\"built_in\">CTFrameRef</span> frame = <span class=\"built_in\">CTFramesetterCreateFrame</span>(framesetter, <span class=\"built_in\">CFRangeMake</span>(<span class=\"number\">0</span>, attStr.length), path, <span class=\"literal\">NULL</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//绘制内容</span></span><br><span class=\"line\">    <span class=\"built_in\">CTFrameDraw</span>(frame, context);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">CFRelease</span>(fontRef);</span><br><span class=\"line\">    <span class=\"built_in\">CFRelease</span>(frame);</span><br><span class=\"line\">    <span class=\"built_in\">CFRelease</span>(path);</span><br><span class=\"line\">    <span class=\"built_in\">CFRelease</span>(framesetter);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure>\n<p>第二个示例展示了一个带表情符号的文本，效果图如下：</p>\n<p><img src=\"http://img.blog.csdn.net/20150404002937477\" alt=\"这里写图片描述\"></p>\n<p>先介绍一下CoreText实现表情混排的原理，在简介中介绍过，一个CTLine代表一行，而一个CTLine又由多个CTRun组成，这里实现表情混排的原理其实就是把CTLine中的某一个CTRun替换成空白字符，然后再根据这个CTRun的具体位置，把图片绘制到这个位置上，下面是具体代码：<br><figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">\"ImageDisplayView.h\"</span></span></span><br><span class=\"line\"><span class=\"keyword\">@import</span> CoreText;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">NSString</span> * str5 = <span class=\"string\">@\"asfasfa阿斯顿发生大发撒放大离开家撒旦法按时付款就阿里；双方均asfasdfasfdalkjsflakj阿斯顿发生大发撒旦法asdfasdfaasfdaasa撒旦法；拉斯克奖发了奥斯卡奖罚洛杉矶的法律；看见谁发的阿斯利康就发；了数据库等法律按实际开发；阿里就开始放到了；安家费阿里山科技发达了开始将对方拉开始交电费了卡双方的空间啊发送卡飞机阿里开始就放暑假了罚款就是浪费\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">ImageDisplayView</span> ()</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@property</span> (<span class=\"keyword\">nonatomic</span>, <span class=\"keyword\">strong</span>) <span class=\"built_in\">NSAttributedString</span> * attStr;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//回调方法，返回要替换的CTRun的下边缘距离本行文字下边缘的高度</span></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"built_in\">CGFloat</span> descentCallback(<span class=\"keyword\">void</span> *ref)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//回调方法，返回要替换的CTRun的上边缘距离本行文字上边缘的高度</span></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"built_in\">CGFloat</span> ascentCallback(<span class=\"keyword\">void</span> *ref)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">30</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//回调方法，返回要替换的CTRun的宽</span></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"built_in\">CGFloat</span> widthCallback(<span class=\"keyword\">void</span> *ref)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">30</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">ImageDisplayView</span></span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"built_in\">CTRunDelegateRef</span> _delegate;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">instancetype</span>)initWithFrame:(<span class=\"built_in\">CGRect</span>)frame</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">self</span> = [<span class=\"keyword\">super</span> initWithFrame:frame];</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">self</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSString</span> * name = <span class=\"string\">@\"010\"</span>;</span><br><span class=\"line\">        <span class=\"keyword\">unichar</span> objectReplacementChar           = <span class=\"number\">0xFFFC</span>;<span class=\"comment\">//占位字符</span></span><br><span class=\"line\">        <span class=\"built_in\">NSString</span> *objectReplacementString       = [<span class=\"built_in\">NSString</span> stringWithCharacters:&amp;objectReplacementChar length:<span class=\"number\">1</span>];</span><br><span class=\"line\">        <span class=\"built_in\">NSMutableAttributedString</span> *attachText   = [[<span class=\"built_in\">NSMutableAttributedString</span> alloc]initWithString:objectReplacementString];</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//创建CTRun代理回调</span></span><br><span class=\"line\">        <span class=\"built_in\">CTRunDelegateCallbacks</span> callbacks;</span><br><span class=\"line\">        callbacks.version       = kCTRunDelegateVersion1;</span><br><span class=\"line\">        callbacks.getAscent     = ascentCallback;</span><br><span class=\"line\">        callbacks.getDescent    = descentCallback;</span><br><span class=\"line\">        callbacks.getWidth      = widthCallback;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//给属性字符串添加代理回调</span></span><br><span class=\"line\">        <span class=\"built_in\">CTRunDelegateRef</span> delegate = <span class=\"built_in\">CTRunDelegateCreate</span>(&amp;callbacks, (<span class=\"keyword\">void</span> *)name);</span><br><span class=\"line\">        <span class=\"built_in\">NSDictionary</span> *attr = [<span class=\"built_in\">NSDictionary</span> dictionaryWithObjectsAndKeys:(__bridge <span class=\"keyword\">id</span>)delegate,kCTRunDelegateAttributeName, <span class=\"literal\">nil</span>];</span><br><span class=\"line\">        [attachText setAttributes:attr range:<span class=\"built_in\">NSMakeRange</span>(<span class=\"number\">0</span>, <span class=\"number\">1</span>)];</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.attStr = attachText;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">self</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)drawRect:(<span class=\"built_in\">CGRect</span>)rect &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    [<span class=\"keyword\">super</span> drawRect:rect];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">CGContextRef</span> context = <span class=\"built_in\">UIGraphicsGetCurrentContext</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//变换坐标</span></span><br><span class=\"line\">    <span class=\"built_in\">CGContextSetTextMatrix</span>(context, <span class=\"built_in\">CGAffineTransformIdentity</span>);</span><br><span class=\"line\">    <span class=\"built_in\">CGContextTranslateCTM</span>(context, <span class=\"number\">0</span>, <span class=\"keyword\">self</span>.bounds.size.height);</span><br><span class=\"line\">    <span class=\"built_in\">CGContextScaleCTM</span>(context, <span class=\"number\">1.0</span>, <span class=\"number\">-1.0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//设置文本绘制的路径</span></span><br><span class=\"line\">    <span class=\"built_in\">CGMutablePathRef</span> path = <span class=\"built_in\">CGPathCreateMutable</span>();</span><br><span class=\"line\">    <span class=\"built_in\">CGPathAddRect</span>(path, <span class=\"literal\">NULL</span>, <span class=\"keyword\">self</span>.bounds);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">NSMutableAttributedString</span> * attStr = [[<span class=\"built_in\">NSMutableAttributedString</span> alloc] initWithString:str5];</span><br><span class=\"line\">    [attStr insertAttributedString:<span class=\"keyword\">self</span>.attStr atIndex:<span class=\"number\">50</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">CTFramesetterRef</span> framesetter = <span class=\"built_in\">CTFramesetterCreateWithAttributedString</span>((<span class=\"built_in\">CFAttributedStringRef</span>)attStr);</span><br><span class=\"line\">    <span class=\"built_in\">CTFrameRef</span> frame = <span class=\"built_in\">CTFramesetterCreateFrame</span>(framesetter, <span class=\"built_in\">CFRangeMake</span>(<span class=\"number\">0</span>, attStr.length), path, <span class=\"literal\">NULL</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//计算要替换的CTRun的具体位置</span></span><br><span class=\"line\">    <span class=\"built_in\">NSArray</span> * lines = (<span class=\"built_in\">NSArray</span> *)<span class=\"built_in\">CTFrameGetLines</span>(frame);</span><br><span class=\"line\">    <span class=\"built_in\">NSUInteger</span> lineCount = lines.count;</span><br><span class=\"line\">    <span class=\"built_in\">CGPoint</span> lineOrigins[lineCount];</span><br><span class=\"line\">    <span class=\"built_in\">CTFrameGetLineOrigins</span>(frame, <span class=\"built_in\">CFRangeMake</span>(<span class=\"number\">0</span>, <span class=\"number\">0</span>), lineOrigins);</span><br><span class=\"line\">    <span class=\"comment\">//循环遍历每一个CTLine中的每一个CTRun，找到要替换的那个CTRun，并且计算它的位置</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; lineCount; i++) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">CTLineRef</span> line = (__bridge <span class=\"built_in\">CTLineRef</span>)lines[i];</span><br><span class=\"line\">        <span class=\"built_in\">CFArrayRef</span> runs = <span class=\"built_in\">CTLineGetGlyphRuns</span>(line);</span><br><span class=\"line\">        <span class=\"built_in\">CFIndex</span> runCount = <span class=\"built_in\">CFArrayGetCount</span>(runs);</span><br><span class=\"line\">        <span class=\"built_in\">CGPoint</span> lineOrigin = lineOrigins[i];</span><br><span class=\"line\">        <span class=\"built_in\">CGFloat</span> lineAscent;</span><br><span class=\"line\">        <span class=\"built_in\">CGFloat</span> lineDescent;</span><br><span class=\"line\">        <span class=\"built_in\">CTLineGetTypographicBounds</span>(line, &amp;lineAscent, &amp;lineDescent, <span class=\"literal\">NULL</span>);</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"built_in\">CFIndex</span> k = <span class=\"number\">0</span>; k &lt; runCount; k++)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"built_in\">CTRunRef</span> run = <span class=\"built_in\">CFArrayGetValueAtIndex</span>(runs, k);</span><br><span class=\"line\">            <span class=\"built_in\">NSDictionary</span> *runAttributes = (<span class=\"built_in\">NSDictionary</span> *)<span class=\"built_in\">CTRunGetAttributes</span>(run);</span><br><span class=\"line\">            <span class=\"built_in\">CTRunDelegateRef</span> delegate = (__bridge <span class=\"built_in\">CTRunDelegateRef</span>)[runAttributes valueForKey:(<span class=\"keyword\">id</span>)kCTRunDelegateAttributeName];</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"literal\">nil</span> == delegate)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"built_in\">CGFloat</span> xOffset = <span class=\"built_in\">CTLineGetOffsetForStringIndex</span>(line, <span class=\"built_in\">CTRunGetStringRange</span>(run).location, <span class=\"literal\">nil</span>);</span><br><span class=\"line\">            <span class=\"built_in\">CGRect</span> rect = <span class=\"built_in\">CGRectMake</span>(lineOrigin.x + xOffset, lineOrigin.y - lineDescent, <span class=\"number\">30</span>, <span class=\"number\">30</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">//绘制图片</span></span><br><span class=\"line\">            <span class=\"built_in\">CGContextDrawImage</span>(context, rect, [<span class=\"built_in\">UIImage</span> imageNamed:<span class=\"string\">@\"010\"</span>].CGImage);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">CTFrameDraw</span>(frame, context);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">CFRelease</span>(frame);</span><br><span class=\"line\">    <span class=\"built_in\">CFRelease</span>(path);</span><br><span class=\"line\">    <span class=\"built_in\">CFRelease</span>(framesetter);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure></p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>下面总结一下CoreText的优缺点：</p>\n<ul>\n<li>优点：功能强大，支持iOS3.2以后的所有系统</li>\n<li>缺点：纯C的接口，使用复杂，需要自己管理内存</li>\n</ul>\n<p>CoreText更加详细的介绍推荐大家可以看看唐巧大神的《iOS开发进阶》第十七章的内容。</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>前一篇介绍了iOS7新出的TextKit，这一篇打算介绍一下更底层的CoreText框架</p>\n<h2 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h2><p>CoreText是iOS3.2推出的一套文字排版和渲染框架，可以实现图文混排，富文本显示等效果。CoreText中的几个重要的概念：</p>\n<ul>\n<li>CTFrameRef：画布，包含多个CTLine</li>\n<li>CTLineRef：每一行就是一个CTLine</li>\n<li>CTRunRef：每一行可以分为多个属性相同的小段，每一个小段就是一个CTRun<br>如下图展示了这三者的关系：</li>\n</ul>\n<p><img src=\"http://img.blog.csdn.net/20150403235844681\" alt=\"这里写图片描述\"></p>\n<h2 id=\"示例\"><a href=\"#示例\" class=\"headerlink\" title=\"示例\"></a>示例</h2><p>废话不多说，直接看示例，第一个示例展示了一些常规属性的的设置，效果图如下：</p>\n<p><img src=\"http://img.blog.csdn.net/20150404001114995\" alt=\"这里写图片描述\"></p>\n<p>代码如下，这里使用了一个自定义View，然后把要展示的内容绘制在view上，注意代码中使用了很多CoreFoundation框架的类（实际上是结构体），需要使用__bridge进行桥接：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">\"DisplayView.h\"</span></span></span><br><span class=\"line\"><span class=\"keyword\">@import</span> CoreText;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">NSString</span> * str4 = <span class=\"string\">@\"asfasfa阿斯顿发生大发撒放大离开家撒旦法按时付款就阿里；双方均asfasdfasfdalkjsflakj阿斯顿发生大发撒旦法asdfasdfaasfdaasa撒旦法；拉斯克奖发了奥斯卡奖罚洛杉矶的法律；看见谁发的阿斯利康就发；了数据库等法律按实际开发；阿里就开始放到了；安家费阿里山科技发达了开始将对方拉开始交电费了卡双方的空间啊发送卡飞机阿里开始就放暑假了罚款就是浪费\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">DisplayView</span> ()</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">DisplayView</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)drawRect:(<span class=\"built_in\">CGRect</span>)rect &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    [<span class=\"keyword\">super</span> drawRect:rect];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">CGContextRef</span> context = <span class=\"built_in\">UIGraphicsGetCurrentContext</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//变换坐标</span></span><br><span class=\"line\">    <span class=\"built_in\">CGContextSetTextMatrix</span>(context, <span class=\"built_in\">CGAffineTransformIdentity</span>);</span><br><span class=\"line\">    <span class=\"built_in\">CGContextTranslateCTM</span>(context, <span class=\"number\">0</span>, <span class=\"keyword\">self</span>.bounds.size.height);</span><br><span class=\"line\">    <span class=\"built_in\">CGContextScaleCTM</span>(context, <span class=\"number\">1.0</span>, <span class=\"number\">-1.0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//设置绘制的路径</span></span><br><span class=\"line\">    <span class=\"built_in\">CGMutablePathRef</span> path = <span class=\"built_in\">CGPathCreateMutable</span>();</span><br><span class=\"line\">    <span class=\"built_in\">CGPathAddRect</span>(path, <span class=\"literal\">NULL</span>, <span class=\"keyword\">self</span>.bounds);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//创建属性字符串</span></span><br><span class=\"line\">    <span class=\"built_in\">NSMutableAttributedString</span> * attStr = [[<span class=\"built_in\">NSMutableAttributedString</span> alloc] initWithString:str4];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//颜色</span></span><br><span class=\"line\">    [attStr addAttribute:(__bridge <span class=\"built_in\">NSString</span> *)kCTForegroundColorAttributeName value:(__bridge <span class=\"keyword\">id</span>)[<span class=\"built_in\">UIColor</span> redColor].CGColor range:<span class=\"built_in\">NSMakeRange</span>(<span class=\"number\">5</span>, <span class=\"number\">10</span>)];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//字体</span></span><br><span class=\"line\">    <span class=\"built_in\">UIFont</span> * font = [<span class=\"built_in\">UIFont</span> systemFontOfSize:<span class=\"number\">25</span>];</span><br><span class=\"line\">    <span class=\"built_in\">CTFontRef</span> fontRef = <span class=\"built_in\">CTFontCreateWithName</span>((__bridge <span class=\"built_in\">CFStringRef</span>)font.fontName, <span class=\"number\">25</span>, <span class=\"literal\">NULL</span>);</span><br><span class=\"line\">    [attStr addAttribute:(__bridge <span class=\"built_in\">NSString</span> *)kCTFontAttributeName value:(__bridge <span class=\"keyword\">id</span>)fontRef range:<span class=\"built_in\">NSMakeRange</span>(<span class=\"number\">20</span>, <span class=\"number\">10</span>)];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//空心字</span></span><br><span class=\"line\">    [attStr addAttribute:(__bridge <span class=\"built_in\">NSString</span> *)kCTStrokeWidthAttributeName value:@(<span class=\"number\">3</span>) range:<span class=\"built_in\">NSMakeRange</span>(<span class=\"number\">36</span>, <span class=\"number\">5</span>)];</span><br><span class=\"line\">    [attStr addAttribute:(__bridge <span class=\"built_in\">NSString</span> *)kCTStrokeColorAttributeName value:(__bridge <span class=\"keyword\">id</span>)[<span class=\"built_in\">UIColor</span> blueColor].CGColor range:<span class=\"built_in\">NSMakeRange</span>(<span class=\"number\">37</span>, <span class=\"number\">10</span>)];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//下划线</span></span><br><span class=\"line\">    [attStr addAttribute:(__bridge <span class=\"built_in\">NSString</span> *)kCTUnderlineStyleAttributeName value:@(kCTUnderlineStyleSingle | kCTUnderlinePatternDot) range:<span class=\"built_in\">NSMakeRange</span>(<span class=\"number\">45</span>, <span class=\"number\">15</span>)];</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">CTFramesetterRef</span> framesetter = <span class=\"built_in\">CTFramesetterCreateWithAttributedString</span>((<span class=\"built_in\">CFAttributedStringRef</span>)attStr);</span><br><span class=\"line\">    <span class=\"built_in\">CTFrameRef</span> frame = <span class=\"built_in\">CTFramesetterCreateFrame</span>(framesetter, <span class=\"built_in\">CFRangeMake</span>(<span class=\"number\">0</span>, attStr.length), path, <span class=\"literal\">NULL</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//绘制内容</span></span><br><span class=\"line\">    <span class=\"built_in\">CTFrameDraw</span>(frame, context);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">CFRelease</span>(fontRef);</span><br><span class=\"line\">    <span class=\"built_in\">CFRelease</span>(frame);</span><br><span class=\"line\">    <span class=\"built_in\">CFRelease</span>(path);</span><br><span class=\"line\">    <span class=\"built_in\">CFRelease</span>(framesetter);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure>\n<p>第二个示例展示了一个带表情符号的文本，效果图如下：</p>\n<p><img src=\"http://img.blog.csdn.net/20150404002937477\" alt=\"这里写图片描述\"></p>\n<p>先介绍一下CoreText实现表情混排的原理，在简介中介绍过，一个CTLine代表一行，而一个CTLine又由多个CTRun组成，这里实现表情混排的原理其实就是把CTLine中的某一个CTRun替换成空白字符，然后再根据这个CTRun的具体位置，把图片绘制到这个位置上，下面是具体代码：<br><figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">\"ImageDisplayView.h\"</span></span></span><br><span class=\"line\"><span class=\"keyword\">@import</span> CoreText;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">NSString</span> * str5 = <span class=\"string\">@\"asfasfa阿斯顿发生大发撒放大离开家撒旦法按时付款就阿里；双方均asfasdfasfdalkjsflakj阿斯顿发生大发撒旦法asdfasdfaasfdaasa撒旦法；拉斯克奖发了奥斯卡奖罚洛杉矶的法律；看见谁发的阿斯利康就发；了数据库等法律按实际开发；阿里就开始放到了；安家费阿里山科技发达了开始将对方拉开始交电费了卡双方的空间啊发送卡飞机阿里开始就放暑假了罚款就是浪费\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">ImageDisplayView</span> ()</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@property</span> (<span class=\"keyword\">nonatomic</span>, <span class=\"keyword\">strong</span>) <span class=\"built_in\">NSAttributedString</span> * attStr;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//回调方法，返回要替换的CTRun的下边缘距离本行文字下边缘的高度</span></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"built_in\">CGFloat</span> descentCallback(<span class=\"keyword\">void</span> *ref)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//回调方法，返回要替换的CTRun的上边缘距离本行文字上边缘的高度</span></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"built_in\">CGFloat</span> ascentCallback(<span class=\"keyword\">void</span> *ref)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">30</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//回调方法，返回要替换的CTRun的宽</span></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"built_in\">CGFloat</span> widthCallback(<span class=\"keyword\">void</span> *ref)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">30</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">ImageDisplayView</span></span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"built_in\">CTRunDelegateRef</span> _delegate;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">instancetype</span>)initWithFrame:(<span class=\"built_in\">CGRect</span>)frame</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">self</span> = [<span class=\"keyword\">super</span> initWithFrame:frame];</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">self</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSString</span> * name = <span class=\"string\">@\"010\"</span>;</span><br><span class=\"line\">        <span class=\"keyword\">unichar</span> objectReplacementChar           = <span class=\"number\">0xFFFC</span>;<span class=\"comment\">//占位字符</span></span><br><span class=\"line\">        <span class=\"built_in\">NSString</span> *objectReplacementString       = [<span class=\"built_in\">NSString</span> stringWithCharacters:&amp;objectReplacementChar length:<span class=\"number\">1</span>];</span><br><span class=\"line\">        <span class=\"built_in\">NSMutableAttributedString</span> *attachText   = [[<span class=\"built_in\">NSMutableAttributedString</span> alloc]initWithString:objectReplacementString];</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//创建CTRun代理回调</span></span><br><span class=\"line\">        <span class=\"built_in\">CTRunDelegateCallbacks</span> callbacks;</span><br><span class=\"line\">        callbacks.version       = kCTRunDelegateVersion1;</span><br><span class=\"line\">        callbacks.getAscent     = ascentCallback;</span><br><span class=\"line\">        callbacks.getDescent    = descentCallback;</span><br><span class=\"line\">        callbacks.getWidth      = widthCallback;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//给属性字符串添加代理回调</span></span><br><span class=\"line\">        <span class=\"built_in\">CTRunDelegateRef</span> delegate = <span class=\"built_in\">CTRunDelegateCreate</span>(&amp;callbacks, (<span class=\"keyword\">void</span> *)name);</span><br><span class=\"line\">        <span class=\"built_in\">NSDictionary</span> *attr = [<span class=\"built_in\">NSDictionary</span> dictionaryWithObjectsAndKeys:(__bridge <span class=\"keyword\">id</span>)delegate,kCTRunDelegateAttributeName, <span class=\"literal\">nil</span>];</span><br><span class=\"line\">        [attachText setAttributes:attr range:<span class=\"built_in\">NSMakeRange</span>(<span class=\"number\">0</span>, <span class=\"number\">1</span>)];</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.attStr = attachText;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">self</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)drawRect:(<span class=\"built_in\">CGRect</span>)rect &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    [<span class=\"keyword\">super</span> drawRect:rect];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">CGContextRef</span> context = <span class=\"built_in\">UIGraphicsGetCurrentContext</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//变换坐标</span></span><br><span class=\"line\">    <span class=\"built_in\">CGContextSetTextMatrix</span>(context, <span class=\"built_in\">CGAffineTransformIdentity</span>);</span><br><span class=\"line\">    <span class=\"built_in\">CGContextTranslateCTM</span>(context, <span class=\"number\">0</span>, <span class=\"keyword\">self</span>.bounds.size.height);</span><br><span class=\"line\">    <span class=\"built_in\">CGContextScaleCTM</span>(context, <span class=\"number\">1.0</span>, <span class=\"number\">-1.0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//设置文本绘制的路径</span></span><br><span class=\"line\">    <span class=\"built_in\">CGMutablePathRef</span> path = <span class=\"built_in\">CGPathCreateMutable</span>();</span><br><span class=\"line\">    <span class=\"built_in\">CGPathAddRect</span>(path, <span class=\"literal\">NULL</span>, <span class=\"keyword\">self</span>.bounds);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">NSMutableAttributedString</span> * attStr = [[<span class=\"built_in\">NSMutableAttributedString</span> alloc] initWithString:str5];</span><br><span class=\"line\">    [attStr insertAttributedString:<span class=\"keyword\">self</span>.attStr atIndex:<span class=\"number\">50</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">CTFramesetterRef</span> framesetter = <span class=\"built_in\">CTFramesetterCreateWithAttributedString</span>((<span class=\"built_in\">CFAttributedStringRef</span>)attStr);</span><br><span class=\"line\">    <span class=\"built_in\">CTFrameRef</span> frame = <span class=\"built_in\">CTFramesetterCreateFrame</span>(framesetter, <span class=\"built_in\">CFRangeMake</span>(<span class=\"number\">0</span>, attStr.length), path, <span class=\"literal\">NULL</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//计算要替换的CTRun的具体位置</span></span><br><span class=\"line\">    <span class=\"built_in\">NSArray</span> * lines = (<span class=\"built_in\">NSArray</span> *)<span class=\"built_in\">CTFrameGetLines</span>(frame);</span><br><span class=\"line\">    <span class=\"built_in\">NSUInteger</span> lineCount = lines.count;</span><br><span class=\"line\">    <span class=\"built_in\">CGPoint</span> lineOrigins[lineCount];</span><br><span class=\"line\">    <span class=\"built_in\">CTFrameGetLineOrigins</span>(frame, <span class=\"built_in\">CFRangeMake</span>(<span class=\"number\">0</span>, <span class=\"number\">0</span>), lineOrigins);</span><br><span class=\"line\">    <span class=\"comment\">//循环遍历每一个CTLine中的每一个CTRun，找到要替换的那个CTRun，并且计算它的位置</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; lineCount; i++) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">CTLineRef</span> line = (__bridge <span class=\"built_in\">CTLineRef</span>)lines[i];</span><br><span class=\"line\">        <span class=\"built_in\">CFArrayRef</span> runs = <span class=\"built_in\">CTLineGetGlyphRuns</span>(line);</span><br><span class=\"line\">        <span class=\"built_in\">CFIndex</span> runCount = <span class=\"built_in\">CFArrayGetCount</span>(runs);</span><br><span class=\"line\">        <span class=\"built_in\">CGPoint</span> lineOrigin = lineOrigins[i];</span><br><span class=\"line\">        <span class=\"built_in\">CGFloat</span> lineAscent;</span><br><span class=\"line\">        <span class=\"built_in\">CGFloat</span> lineDescent;</span><br><span class=\"line\">        <span class=\"built_in\">CTLineGetTypographicBounds</span>(line, &amp;lineAscent, &amp;lineDescent, <span class=\"literal\">NULL</span>);</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"built_in\">CFIndex</span> k = <span class=\"number\">0</span>; k &lt; runCount; k++)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"built_in\">CTRunRef</span> run = <span class=\"built_in\">CFArrayGetValueAtIndex</span>(runs, k);</span><br><span class=\"line\">            <span class=\"built_in\">NSDictionary</span> *runAttributes = (<span class=\"built_in\">NSDictionary</span> *)<span class=\"built_in\">CTRunGetAttributes</span>(run);</span><br><span class=\"line\">            <span class=\"built_in\">CTRunDelegateRef</span> delegate = (__bridge <span class=\"built_in\">CTRunDelegateRef</span>)[runAttributes valueForKey:(<span class=\"keyword\">id</span>)kCTRunDelegateAttributeName];</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"literal\">nil</span> == delegate)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"built_in\">CGFloat</span> xOffset = <span class=\"built_in\">CTLineGetOffsetForStringIndex</span>(line, <span class=\"built_in\">CTRunGetStringRange</span>(run).location, <span class=\"literal\">nil</span>);</span><br><span class=\"line\">            <span class=\"built_in\">CGRect</span> rect = <span class=\"built_in\">CGRectMake</span>(lineOrigin.x + xOffset, lineOrigin.y - lineDescent, <span class=\"number\">30</span>, <span class=\"number\">30</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">//绘制图片</span></span><br><span class=\"line\">            <span class=\"built_in\">CGContextDrawImage</span>(context, rect, [<span class=\"built_in\">UIImage</span> imageNamed:<span class=\"string\">@\"010\"</span>].CGImage);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">CTFrameDraw</span>(frame, context);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">CFRelease</span>(frame);</span><br><span class=\"line\">    <span class=\"built_in\">CFRelease</span>(path);</span><br><span class=\"line\">    <span class=\"built_in\">CFRelease</span>(framesetter);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure></p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>下面总结一下CoreText的优缺点：</p>\n<ul>\n<li>优点：功能强大，支持iOS3.2以后的所有系统</li>\n<li>缺点：纯C的接口，使用复杂，需要自己管理内存</li>\n</ul>\n<p>CoreText更加详细的介绍推荐大家可以看看唐巧大神的《iOS开发进阶》第十七章的内容。</p>\n"},{"layout":"post","title":"《图解HTTP》读书笔记(2)","_content":"\n* toc\n{:toc}\n\n## 第三章 HTTP报文内的HTTP信息\n\n### HTTP报文\n\nHTTP报文分为请求报文和响应报文两种，主要是由报文首部和报文主体两部分组成。\n\n### 编码提升传输速率\n\n为了提升传输速率，HTTP协议通常会对要传输的实体进行压缩，即内容编码。\n内容编码致指明应用在实体内容上的编码格式，并保持实体信息原样压缩。内容编码后的实体由客户端接收并负责解码。常见的编码有：\n\n* gzip (GNU zip)\n* compress (UNIX系统标准压缩)\n* deflate (zlib)\n* identity (不进行编码)\n\n**分块编码** 对于实体数据过大时，通常会把实体数据进行分块传输。分块编码会将实体主体分成多个部分快，客户端在接收到之后自行解码拼接。\n\n### 发送多种数据类型\n\n一个HTTP请求中可能还有文字，图片，视频等多种不同的数据类型，HTTP协议通过多部分对象集合，使得一份报文中可以含有多类型实体。通常实在上传图片或文本时使用。\n\n多部分对象集合包含的对象：\n\n* multipart/form-data : 表单文件上传\n* multipart/byteranges : 状态码为206，响应报文中包含了多个范围的内容\n\n多部分对象集合中的每个部分都含有首部字段，另外，还可以在某个部分中嵌套使用对象集合。\n\n### 获取部分内容的范围请求\n\n执行范围请求，需要在首部加上Range字段，例如\n\n* `Range: bytes=500-1000`，表示只请求500-1000的字节范围的数据。\n* `Range: bytes=1000-`，表示请求1000字节以后的全部数据\n* `Range: bytes=-300, 500-1000`，表示请求0-300和500-1000两部分数据\n\n请求成功，服务器会返回`206 Partial Content`状态码，表示请求部分数据成功，如何数据已经全部请求完成，则返回200\n\n例如：一个资源大小为200 bytes，HTTP请求的Range字段为`Range: bytes=-300`，则一次请求就可以请求到全部数据，因此返回200，不会返回206\n\n范围请求通常用于断点下载等操作。\n\n### 内容协商返回最合适的内容\n\n同一个页面服务器可能存在多份，比如英文页面，中文页面等。服务器会根据请求报文中的某些字段（语言，字符集，编码方式等）作为判断基准，返回最合适的页面。\n\n相关的首部字段有\n\n* Accept\n* Accept-Charset\n* Accept-Encoding\n* Accept-Language\n* Content-Language\n\n## 第四章 返回结果的HTTP状态码\n\n状态码的职责是当客户端发送请求时，描述返回的请求结果。状态码和状态不一致的现象也很常见。\n\n### 2XX OK\n\n* **200 OK** 正常处理，HEAD请求成功，不返回内容实体，状态码也是200\n* **204 No Content** 请求已处理成功，但没有资源返回\n* **206 Partial Content** 请求成功，返回资源的某一部分\n\n### 3XX 重定向\n\n* **301 Moved Permanently** 永久重定向，资源的URI已经更新\n* **302 Found** 临时重定向，URI已经更新，希望本次使用新的URI进行请求\n* **303 See Other** 资源的URI已经更新，请使用GET方法从新的URI获取资源。302和303功能类似，但303明确告诉客户端应该使用GET方法请求另一个URI。实际应用中，当301，302，303状态码返回时，几乎所有的浏览器都会把POST改为GET，\n然后重新请求。\n* **304 Not Modified** 资源已找到，但未符合条件请求。**条件请求** 是指在首部添加`If-Match, If-Modified-Since, If-None-Match,If-Range,-IfUnmodified-Since`\n中的任何一个\n* **307 TemporaryRedirect** 临时重定向。与302有相同的含义。\n\n### 4XX 客户端错误\n\n* **400 Bad Request** 请求报文中存在语法错误，服务器无法理解。\n* **401 Unauthorized** 发送的请求需要通过HTTP认证。当浏览器接受到401时，会弹出认证窗口，让用户填写用户名和密码\n* **403 Forbidden** 不允许访问该资源\n* **404 Not Found** 没有找到请求的资源\n\n### 5XX 服务器错误\n\n* **500 Internal Server Error** 服务器发生错误\n* **503 Service Unavailable** 表示服务器暂时处于超负载或正在停机维护，现在无法处理请求。\n\n## 第五章 与HTTP协作的Web服务器\n\n### 用单台虚拟主机实现多个域名\n\n同一台服务器可以搭建多个Web站点，这是利用了虚拟主机的功能。但是这就会导致多个域名在经过DNS解析后映射到了同一个IP地址。为了确定到底是访问那个域名，\nHTTP请求中，必须在首部的Host字段完整的指定主机名或域名的URI\n\n### 通信数据转发程序：代理，网关，隧道\n\n* **代理**：代理是一种有转发功能的应用程序，他接收由客户端发送的请求并转发给服务器，同时也接收服务器返回的响应并转发给客户端\n    * 代理不会改变请求的URI，会直接发送给前方持有资源的目标服务器，即源服务器。\n    * 在HTTP请求中可以级联多台代理服务器\n    * 代理服务器的用途：\n        * 利用缓存技术减少网络带宽流量\n        * 组织内部针对特定网站的访问控制\n    * 代理的种类\n        * 缓存代理：将源服务器的资源副本保存在代理服务器上，这样当代理再次接到相同的请求是，就不需要从源服务器那里再次获取资源了\n        * 透明代理和非透明代理：不对报文进行加工，成为透明代理，否则成为非透明代理\n* **网关**：转发其他服务器通信数据的服务器\n    * 网关与代理类似，但它可以提供非HTTP服务，即经过网关可以向非HTTP服务器请求数据\n    * 利用网关能提高通信的安全性\n* **隧道**：在相隔甚远的客户端和服务器两者之间进行中转，并保持双方通信连接的应用程序\n    * 隧道可按要求建立起一条与其他服务器的通信线路，届时可以使用SSL等加密手段进行通信。\n    * 隧道的目的是确保通信的安全性\n    * 隧道本身不会解析HTTP请求，不会到HTTP请求进行修改\n\n### 保存资源的缓存\n\n缓存是指资源的副本，利用缓存可以减少对源服务器的访问，从而节省通信流量和通信时间。\n\n缓存服务器是代理服务器的一种，用于实现缓存。除了缓存服务器外，也可以包缓存保存在客户端的浏览器中。缓存都是有有效期的，\n过了有效期就应该重新向源服务器请求最新的资源。\n\n## 第六章 HTTP首部\n\n### HTTP报文首部字段\n\n* 字段结构：`首部字段名:字段值`，例如`Content-Type: text/html`，单个字段也可以有多个只，例如`Keep-Alive: timeout=15, max=10`\n* 如果首部字段重复，即出现两个同名的字段，则有的浏览器处理第一次出现的字段，有的浏览器处理最后一次出现的首部字段，这个在规范中没有明确指出。\n* 4种HTTP首部字段类型\n    * 通用首部字段：请求报文和响应报文都会使用的字段\n    * 请求首部字段：请求报文中使用的首部字段\n    * 响应首部字段：响应报文中使用的首部字段\n    * 实体首部字段：实体部分使用的首部字段\n\n### 通用首部字段\n\n* Cache-Control：指定缓存的工作机制\n* Connection：控制不在转发给代理的首部字段，管理持久链接\n* Date：表明创建HTTP报文的时间\n* Pragma：指定是否允许代理服务器返回缓存资源，这是历史遗留字段，\n* Trailer：说明在报文主体后会记录哪些首部字段，应用于分块传输编码\n* Transfer-Encoding：规定了传输报文主体时采用的编码方式\n* Upgrade：用于检测HTTP协议及其他协议是否可使用更高版本进行通信，该字段仅限于客户端与邻接服务器，因此需要在Connection中指定Upgrade\n* Via：追踪客户端与服务器之间请求和响应的传输路径\n* Warning：告知用于一些与缓存相关的问题的警告\n*\n\n### 请求首部字段\n\n* Accept：通知服务器应该返回的资源类型以及类型的优先级，格式为`type/subtype`，例如`text/html, image/jpeg`\n* Accept-Charset：通知服务器客户端支持的字符集及优先级\n* Accept-Encoding：通知服务器客户端支持的内容编码及优先级\n* Accept-Language：通知服务器客户端支持的语言及优先级\n* Authorization：客户端的认证信息\n* Form：告知服务器客户端的用户的电子邮箱地址，也可把电子邮箱记录在User-Agent中\n* Host：告知服务器资源所处的主机名和端口号\n* If-Match：告知服务器匹配资源所有的实体标记(ETag)，只有资源的ETag与该字段值匹配，服务器才会返回请求，否则返回412\n* If-Modified-Since：指定更新日期，如果在指定的日期之后资源有更新，则服务器处理请求，返回资源，否则返回304\n* If-None-Match：与If-Match相反，只有资源的ETag与该字段值不匹配，服务器才会返回请求，否则返回412\n* If-Range：告知服务器若If-Range的字段值（ETag或时间）和请求资源的ETag值或时间相一致时，作为范围请求处理，否则返回全体资源\n* If-Unmodified-Since：与If-Modified-Since相反，如果在指定的日期之后资源无更新，则服务器处理请求，返回资源，否则返回412\n* Max-Forwards：指定可经过的服务器最大数目，\n* Proxy-Authorization：代理认证信息，与Authorization不同之处在于他是客户端与代理服务器之间的认证，而Authorization是客户端与源服务器之间的认证信息\n* Range：请求资源的范围\n* Referer：告知服务器请求的原始资源的URI\n* TE：告知服务器客户端能够处理的响应的编码方式及优先级\n* User-Agent：告知服务器浏览器的种类和用户名称等信息\n\n### 响应首部字段\n\n* Accept-Range：告知客户端服务器是否能处理范围请求，可以处理则字段值为bytes，反之则为none\n* Age：告知客户端该响应是在多久前创建的，如果是缓存服务器，则必须加上Age字段，告知客户端该资源是多久前从源服务器获取的\n* ETag：告知客户端实体的标识\n    * 强ETag值：无论实体发生多么细微的变化，都会改变ETag的值\n    * 弱ETag值：只有资源发生根本改变，产生差异时才会改变ETag值\n* Location：告知客户端重定向的地址\n* Proxy-Authenticate：告知客户端适用于代理服务器的认证方案\n* Retry-After：告知客户端多久之后再次发送请求，主要配合503响应或3XX响应\n* Server：告知客户端HTTP服务器的应用程序信息\n* Vary：源服务器告知代理服务器，必须具有同Vary指定的字段相同的同的值的请求才能直接返回缓存，否则必须从源服务器上获取资源\n* WWW-Authenticate：告知客户端适用于服务器的认证方案\n\n### 实体首部字段\n\n* Allow：告知客户端服务器能够支持的所有HTTP方法\n* Content-Encoding：告知客户端服务器对实体的主体部分选用的编码方式\n* Content-Language：告知客户端实体主体使用的自然语言\n* Content-Length：告知客户端实体主体的大小（字节）\n* Content-Location：报文主体返回资源对应的URI\n* Content-MD5：报文主体部分的MD5值，用于校验主体部分是否完整\n* Content-Range：告知客户端返回的实体是整个资源的那一部分，格式`500-1000/1000`\n* Content-Type：说明实体内对象的类型\n* Expires：告知客户端或代理服务器资源失效的日期\n* Last-Modified：指明资源最终修改的时间\n\n### 为Cookie服务器的首部字段\n\n* Set-Cookie：告知客户端各种状态信息以及Cookie的设置信息\n* Cookie：告知服务器当前客户端的各种状态信息\n\n### 其他首部字段\n\n* X-Frame-Options：控制网站内容在其他Web网站的Frame标签内显示的问题，可防止点击劫持攻击\n* X-XSS-Protection：控制浏览器XSS防护机制的开关\n* DNT：告知服务器客户端拒绝提供个人信息\n* P3P：让Web网站上的个人隐私变成一种仅供程序可理解的形式\n\n## 第七章 确保Web安全的HTTPS\n\n### HTTP的缺点\n\n* **通信使用明文可能会被窃听**\n    * TCP/IP是可能被窃听的网络\n    * 使用加密处理防止被窃听\n        * 通信加密：对整个通信线路加密，通过SSL或TSL加密HTTP的通信内容，与SSL组合使用的HTTP成为HTTPS（超文本传输安全协议）\n        * 内容加密：对实体内容加密，客户端服务器要有相应的加密和解密机制\n* **不验证通信方的身份就可能遭遇伪装**\n    * 任何人都可能发起请求\n    * 查明对手的证书\n        * SSL不仅提供加密处理，还使用了证书手段，用于确定对方的身份\n        * 证书由值得信任的第三方机构颁发，用于证明服务器和客户端是实际存在的\n* **无法证明报文完整性，可能已遭篡改**\n\n### HTTP+加密+认证+完整性保护=HTTPS\n\n* HTTP加上加密处理和认证以及完整性保护就是HTTPS\n* HTTPS是身披SSL外壳的HTTP\n    * HTTPS并非一种新的协议，只是HTTP通信接口部分用SSL和TLS协议代替而已\n    * SSL是独立于HTTP的协议，所以不光是HTTP协议，其他运行在应用层的协议也可以配合SSL协议使用，SSL是当今世界应用最为广泛的网络安全技术\n* 加密技术\n    * 共享密钥：即加密和解密使用同一个密钥的方式，也称为对称密钥加密\n        * 优点：速度快\n        * 缺点：密钥可能被劫持\n    * 公开密钥：使用两个密钥，公有密钥和私有密钥，公有密钥加密，私有密钥解密，又称为非对称加密\n        * 优点：安全性高，密钥不会被劫持\n        * 缺点：处理速度慢\n* HTTPS采用混合加密机制，即共享密钥和公开密钥混合的方式，一般情况下是使用公开密钥的方式传输共享密钥的密钥，当共享密钥的密钥被安全送达后，就可以\n使用共享密钥来加密普通数据。\n\n### 证明公开密钥正确性的证书\n\n* 问题：如何确保公开密钥中的共有密钥在传输过程中不被篡改\n* 解决方案：使用数字证书确保共有密钥的正确性\n* 基本流程：\n    1. 服务器从数字证书认证机构那里申请公钥证书，公钥证书包含服务器的公开密钥和数字证书认证机构的数字签名。\n    2. 申请到公钥证书之后把这份公钥证书发送给用户\n    3. 用户在拿到公钥证书后使用数字证书认证机构的公开密钥（一般浏览器都会内置常用认证机构的公开密钥）对证书进行验证\n    4. 一旦认证通过就表示公钥证书中的服务器公钥是真实可靠的。\n* 其他的一些概念\n    * EV SSL证书：用来证明服务器是否符合规范，服务器背后的运营企业是否真实存在的证书\n    * 客户端证书：用来证明客户端实际存在的证书\n    * 自签名证书：使用OpenSSL可以构建自己的证书认证机构，自己给自己颁发服务器证书，该证书一般不被浏览器信赖\n\n### HTTPS的安全通信机制\n\n* SSL和TLS：TLS是在SSL基础上开发的协议。\n* HTTPS会比相应的HTTP请求要慢，因为要做加密处理。所以除非敏感信息，否则一般情况下使用HTTP就可以了。\n","source":"_posts/2015-10-06-《图解HTTP》读书笔记(2).md","raw":"---\nlayout: post\ntitle: \"《图解HTTP》读书笔记(2)\"\ncategories: \"读书笔记\"\n---\n\n* toc\n{:toc}\n\n## 第三章 HTTP报文内的HTTP信息\n\n### HTTP报文\n\nHTTP报文分为请求报文和响应报文两种，主要是由报文首部和报文主体两部分组成。\n\n### 编码提升传输速率\n\n为了提升传输速率，HTTP协议通常会对要传输的实体进行压缩，即内容编码。\n内容编码致指明应用在实体内容上的编码格式，并保持实体信息原样压缩。内容编码后的实体由客户端接收并负责解码。常见的编码有：\n\n* gzip (GNU zip)\n* compress (UNIX系统标准压缩)\n* deflate (zlib)\n* identity (不进行编码)\n\n**分块编码** 对于实体数据过大时，通常会把实体数据进行分块传输。分块编码会将实体主体分成多个部分快，客户端在接收到之后自行解码拼接。\n\n### 发送多种数据类型\n\n一个HTTP请求中可能还有文字，图片，视频等多种不同的数据类型，HTTP协议通过多部分对象集合，使得一份报文中可以含有多类型实体。通常实在上传图片或文本时使用。\n\n多部分对象集合包含的对象：\n\n* multipart/form-data : 表单文件上传\n* multipart/byteranges : 状态码为206，响应报文中包含了多个范围的内容\n\n多部分对象集合中的每个部分都含有首部字段，另外，还可以在某个部分中嵌套使用对象集合。\n\n### 获取部分内容的范围请求\n\n执行范围请求，需要在首部加上Range字段，例如\n\n* `Range: bytes=500-1000`，表示只请求500-1000的字节范围的数据。\n* `Range: bytes=1000-`，表示请求1000字节以后的全部数据\n* `Range: bytes=-300, 500-1000`，表示请求0-300和500-1000两部分数据\n\n请求成功，服务器会返回`206 Partial Content`状态码，表示请求部分数据成功，如何数据已经全部请求完成，则返回200\n\n例如：一个资源大小为200 bytes，HTTP请求的Range字段为`Range: bytes=-300`，则一次请求就可以请求到全部数据，因此返回200，不会返回206\n\n范围请求通常用于断点下载等操作。\n\n### 内容协商返回最合适的内容\n\n同一个页面服务器可能存在多份，比如英文页面，中文页面等。服务器会根据请求报文中的某些字段（语言，字符集，编码方式等）作为判断基准，返回最合适的页面。\n\n相关的首部字段有\n\n* Accept\n* Accept-Charset\n* Accept-Encoding\n* Accept-Language\n* Content-Language\n\n## 第四章 返回结果的HTTP状态码\n\n状态码的职责是当客户端发送请求时，描述返回的请求结果。状态码和状态不一致的现象也很常见。\n\n### 2XX OK\n\n* **200 OK** 正常处理，HEAD请求成功，不返回内容实体，状态码也是200\n* **204 No Content** 请求已处理成功，但没有资源返回\n* **206 Partial Content** 请求成功，返回资源的某一部分\n\n### 3XX 重定向\n\n* **301 Moved Permanently** 永久重定向，资源的URI已经更新\n* **302 Found** 临时重定向，URI已经更新，希望本次使用新的URI进行请求\n* **303 See Other** 资源的URI已经更新，请使用GET方法从新的URI获取资源。302和303功能类似，但303明确告诉客户端应该使用GET方法请求另一个URI。实际应用中，当301，302，303状态码返回时，几乎所有的浏览器都会把POST改为GET，\n然后重新请求。\n* **304 Not Modified** 资源已找到，但未符合条件请求。**条件请求** 是指在首部添加`If-Match, If-Modified-Since, If-None-Match,If-Range,-IfUnmodified-Since`\n中的任何一个\n* **307 TemporaryRedirect** 临时重定向。与302有相同的含义。\n\n### 4XX 客户端错误\n\n* **400 Bad Request** 请求报文中存在语法错误，服务器无法理解。\n* **401 Unauthorized** 发送的请求需要通过HTTP认证。当浏览器接受到401时，会弹出认证窗口，让用户填写用户名和密码\n* **403 Forbidden** 不允许访问该资源\n* **404 Not Found** 没有找到请求的资源\n\n### 5XX 服务器错误\n\n* **500 Internal Server Error** 服务器发生错误\n* **503 Service Unavailable** 表示服务器暂时处于超负载或正在停机维护，现在无法处理请求。\n\n## 第五章 与HTTP协作的Web服务器\n\n### 用单台虚拟主机实现多个域名\n\n同一台服务器可以搭建多个Web站点，这是利用了虚拟主机的功能。但是这就会导致多个域名在经过DNS解析后映射到了同一个IP地址。为了确定到底是访问那个域名，\nHTTP请求中，必须在首部的Host字段完整的指定主机名或域名的URI\n\n### 通信数据转发程序：代理，网关，隧道\n\n* **代理**：代理是一种有转发功能的应用程序，他接收由客户端发送的请求并转发给服务器，同时也接收服务器返回的响应并转发给客户端\n    * 代理不会改变请求的URI，会直接发送给前方持有资源的目标服务器，即源服务器。\n    * 在HTTP请求中可以级联多台代理服务器\n    * 代理服务器的用途：\n        * 利用缓存技术减少网络带宽流量\n        * 组织内部针对特定网站的访问控制\n    * 代理的种类\n        * 缓存代理：将源服务器的资源副本保存在代理服务器上，这样当代理再次接到相同的请求是，就不需要从源服务器那里再次获取资源了\n        * 透明代理和非透明代理：不对报文进行加工，成为透明代理，否则成为非透明代理\n* **网关**：转发其他服务器通信数据的服务器\n    * 网关与代理类似，但它可以提供非HTTP服务，即经过网关可以向非HTTP服务器请求数据\n    * 利用网关能提高通信的安全性\n* **隧道**：在相隔甚远的客户端和服务器两者之间进行中转，并保持双方通信连接的应用程序\n    * 隧道可按要求建立起一条与其他服务器的通信线路，届时可以使用SSL等加密手段进行通信。\n    * 隧道的目的是确保通信的安全性\n    * 隧道本身不会解析HTTP请求，不会到HTTP请求进行修改\n\n### 保存资源的缓存\n\n缓存是指资源的副本，利用缓存可以减少对源服务器的访问，从而节省通信流量和通信时间。\n\n缓存服务器是代理服务器的一种，用于实现缓存。除了缓存服务器外，也可以包缓存保存在客户端的浏览器中。缓存都是有有效期的，\n过了有效期就应该重新向源服务器请求最新的资源。\n\n## 第六章 HTTP首部\n\n### HTTP报文首部字段\n\n* 字段结构：`首部字段名:字段值`，例如`Content-Type: text/html`，单个字段也可以有多个只，例如`Keep-Alive: timeout=15, max=10`\n* 如果首部字段重复，即出现两个同名的字段，则有的浏览器处理第一次出现的字段，有的浏览器处理最后一次出现的首部字段，这个在规范中没有明确指出。\n* 4种HTTP首部字段类型\n    * 通用首部字段：请求报文和响应报文都会使用的字段\n    * 请求首部字段：请求报文中使用的首部字段\n    * 响应首部字段：响应报文中使用的首部字段\n    * 实体首部字段：实体部分使用的首部字段\n\n### 通用首部字段\n\n* Cache-Control：指定缓存的工作机制\n* Connection：控制不在转发给代理的首部字段，管理持久链接\n* Date：表明创建HTTP报文的时间\n* Pragma：指定是否允许代理服务器返回缓存资源，这是历史遗留字段，\n* Trailer：说明在报文主体后会记录哪些首部字段，应用于分块传输编码\n* Transfer-Encoding：规定了传输报文主体时采用的编码方式\n* Upgrade：用于检测HTTP协议及其他协议是否可使用更高版本进行通信，该字段仅限于客户端与邻接服务器，因此需要在Connection中指定Upgrade\n* Via：追踪客户端与服务器之间请求和响应的传输路径\n* Warning：告知用于一些与缓存相关的问题的警告\n*\n\n### 请求首部字段\n\n* Accept：通知服务器应该返回的资源类型以及类型的优先级，格式为`type/subtype`，例如`text/html, image/jpeg`\n* Accept-Charset：通知服务器客户端支持的字符集及优先级\n* Accept-Encoding：通知服务器客户端支持的内容编码及优先级\n* Accept-Language：通知服务器客户端支持的语言及优先级\n* Authorization：客户端的认证信息\n* Form：告知服务器客户端的用户的电子邮箱地址，也可把电子邮箱记录在User-Agent中\n* Host：告知服务器资源所处的主机名和端口号\n* If-Match：告知服务器匹配资源所有的实体标记(ETag)，只有资源的ETag与该字段值匹配，服务器才会返回请求，否则返回412\n* If-Modified-Since：指定更新日期，如果在指定的日期之后资源有更新，则服务器处理请求，返回资源，否则返回304\n* If-None-Match：与If-Match相反，只有资源的ETag与该字段值不匹配，服务器才会返回请求，否则返回412\n* If-Range：告知服务器若If-Range的字段值（ETag或时间）和请求资源的ETag值或时间相一致时，作为范围请求处理，否则返回全体资源\n* If-Unmodified-Since：与If-Modified-Since相反，如果在指定的日期之后资源无更新，则服务器处理请求，返回资源，否则返回412\n* Max-Forwards：指定可经过的服务器最大数目，\n* Proxy-Authorization：代理认证信息，与Authorization不同之处在于他是客户端与代理服务器之间的认证，而Authorization是客户端与源服务器之间的认证信息\n* Range：请求资源的范围\n* Referer：告知服务器请求的原始资源的URI\n* TE：告知服务器客户端能够处理的响应的编码方式及优先级\n* User-Agent：告知服务器浏览器的种类和用户名称等信息\n\n### 响应首部字段\n\n* Accept-Range：告知客户端服务器是否能处理范围请求，可以处理则字段值为bytes，反之则为none\n* Age：告知客户端该响应是在多久前创建的，如果是缓存服务器，则必须加上Age字段，告知客户端该资源是多久前从源服务器获取的\n* ETag：告知客户端实体的标识\n    * 强ETag值：无论实体发生多么细微的变化，都会改变ETag的值\n    * 弱ETag值：只有资源发生根本改变，产生差异时才会改变ETag值\n* Location：告知客户端重定向的地址\n* Proxy-Authenticate：告知客户端适用于代理服务器的认证方案\n* Retry-After：告知客户端多久之后再次发送请求，主要配合503响应或3XX响应\n* Server：告知客户端HTTP服务器的应用程序信息\n* Vary：源服务器告知代理服务器，必须具有同Vary指定的字段相同的同的值的请求才能直接返回缓存，否则必须从源服务器上获取资源\n* WWW-Authenticate：告知客户端适用于服务器的认证方案\n\n### 实体首部字段\n\n* Allow：告知客户端服务器能够支持的所有HTTP方法\n* Content-Encoding：告知客户端服务器对实体的主体部分选用的编码方式\n* Content-Language：告知客户端实体主体使用的自然语言\n* Content-Length：告知客户端实体主体的大小（字节）\n* Content-Location：报文主体返回资源对应的URI\n* Content-MD5：报文主体部分的MD5值，用于校验主体部分是否完整\n* Content-Range：告知客户端返回的实体是整个资源的那一部分，格式`500-1000/1000`\n* Content-Type：说明实体内对象的类型\n* Expires：告知客户端或代理服务器资源失效的日期\n* Last-Modified：指明资源最终修改的时间\n\n### 为Cookie服务器的首部字段\n\n* Set-Cookie：告知客户端各种状态信息以及Cookie的设置信息\n* Cookie：告知服务器当前客户端的各种状态信息\n\n### 其他首部字段\n\n* X-Frame-Options：控制网站内容在其他Web网站的Frame标签内显示的问题，可防止点击劫持攻击\n* X-XSS-Protection：控制浏览器XSS防护机制的开关\n* DNT：告知服务器客户端拒绝提供个人信息\n* P3P：让Web网站上的个人隐私变成一种仅供程序可理解的形式\n\n## 第七章 确保Web安全的HTTPS\n\n### HTTP的缺点\n\n* **通信使用明文可能会被窃听**\n    * TCP/IP是可能被窃听的网络\n    * 使用加密处理防止被窃听\n        * 通信加密：对整个通信线路加密，通过SSL或TSL加密HTTP的通信内容，与SSL组合使用的HTTP成为HTTPS（超文本传输安全协议）\n        * 内容加密：对实体内容加密，客户端服务器要有相应的加密和解密机制\n* **不验证通信方的身份就可能遭遇伪装**\n    * 任何人都可能发起请求\n    * 查明对手的证书\n        * SSL不仅提供加密处理，还使用了证书手段，用于确定对方的身份\n        * 证书由值得信任的第三方机构颁发，用于证明服务器和客户端是实际存在的\n* **无法证明报文完整性，可能已遭篡改**\n\n### HTTP+加密+认证+完整性保护=HTTPS\n\n* HTTP加上加密处理和认证以及完整性保护就是HTTPS\n* HTTPS是身披SSL外壳的HTTP\n    * HTTPS并非一种新的协议，只是HTTP通信接口部分用SSL和TLS协议代替而已\n    * SSL是独立于HTTP的协议，所以不光是HTTP协议，其他运行在应用层的协议也可以配合SSL协议使用，SSL是当今世界应用最为广泛的网络安全技术\n* 加密技术\n    * 共享密钥：即加密和解密使用同一个密钥的方式，也称为对称密钥加密\n        * 优点：速度快\n        * 缺点：密钥可能被劫持\n    * 公开密钥：使用两个密钥，公有密钥和私有密钥，公有密钥加密，私有密钥解密，又称为非对称加密\n        * 优点：安全性高，密钥不会被劫持\n        * 缺点：处理速度慢\n* HTTPS采用混合加密机制，即共享密钥和公开密钥混合的方式，一般情况下是使用公开密钥的方式传输共享密钥的密钥，当共享密钥的密钥被安全送达后，就可以\n使用共享密钥来加密普通数据。\n\n### 证明公开密钥正确性的证书\n\n* 问题：如何确保公开密钥中的共有密钥在传输过程中不被篡改\n* 解决方案：使用数字证书确保共有密钥的正确性\n* 基本流程：\n    1. 服务器从数字证书认证机构那里申请公钥证书，公钥证书包含服务器的公开密钥和数字证书认证机构的数字签名。\n    2. 申请到公钥证书之后把这份公钥证书发送给用户\n    3. 用户在拿到公钥证书后使用数字证书认证机构的公开密钥（一般浏览器都会内置常用认证机构的公开密钥）对证书进行验证\n    4. 一旦认证通过就表示公钥证书中的服务器公钥是真实可靠的。\n* 其他的一些概念\n    * EV SSL证书：用来证明服务器是否符合规范，服务器背后的运营企业是否真实存在的证书\n    * 客户端证书：用来证明客户端实际存在的证书\n    * 自签名证书：使用OpenSSL可以构建自己的证书认证机构，自己给自己颁发服务器证书，该证书一般不被浏览器信赖\n\n### HTTPS的安全通信机制\n\n* SSL和TLS：TLS是在SSL基础上开发的协议。\n* HTTPS会比相应的HTTP请求要慢，因为要做加密处理。所以除非敏感信息，否则一般情况下使用HTTP就可以了。\n","slug":"《图解HTTP》读书笔记(2)","published":1,"date":"2015-10-05T16:00:00.000Z","updated":"2017-03-01T06:42:53.000Z","comments":1,"photos":[],"link":"","_id":"cjutyfmj7006sc4c95d0ktiuk","content":"<ul>\n<li>toc<br>{:toc}</li>\n</ul>\n<h2 id=\"第三章-HTTP报文内的HTTP信息\"><a href=\"#第三章-HTTP报文内的HTTP信息\" class=\"headerlink\" title=\"第三章 HTTP报文内的HTTP信息\"></a>第三章 HTTP报文内的HTTP信息</h2><h3 id=\"HTTP报文\"><a href=\"#HTTP报文\" class=\"headerlink\" title=\"HTTP报文\"></a>HTTP报文</h3><p>HTTP报文分为请求报文和响应报文两种，主要是由报文首部和报文主体两部分组成。</p>\n<h3 id=\"编码提升传输速率\"><a href=\"#编码提升传输速率\" class=\"headerlink\" title=\"编码提升传输速率\"></a>编码提升传输速率</h3><p>为了提升传输速率，HTTP协议通常会对要传输的实体进行压缩，即内容编码。<br>内容编码致指明应用在实体内容上的编码格式，并保持实体信息原样压缩。内容编码后的实体由客户端接收并负责解码。常见的编码有：</p>\n<ul>\n<li>gzip (GNU zip)</li>\n<li>compress (UNIX系统标准压缩)</li>\n<li>deflate (zlib)</li>\n<li>identity (不进行编码)</li>\n</ul>\n<p><strong>分块编码</strong> 对于实体数据过大时，通常会把实体数据进行分块传输。分块编码会将实体主体分成多个部分快，客户端在接收到之后自行解码拼接。</p>\n<h3 id=\"发送多种数据类型\"><a href=\"#发送多种数据类型\" class=\"headerlink\" title=\"发送多种数据类型\"></a>发送多种数据类型</h3><p>一个HTTP请求中可能还有文字，图片，视频等多种不同的数据类型，HTTP协议通过多部分对象集合，使得一份报文中可以含有多类型实体。通常实在上传图片或文本时使用。</p>\n<p>多部分对象集合包含的对象：</p>\n<ul>\n<li>multipart/form-data : 表单文件上传</li>\n<li>multipart/byteranges : 状态码为206，响应报文中包含了多个范围的内容</li>\n</ul>\n<p>多部分对象集合中的每个部分都含有首部字段，另外，还可以在某个部分中嵌套使用对象集合。</p>\n<h3 id=\"获取部分内容的范围请求\"><a href=\"#获取部分内容的范围请求\" class=\"headerlink\" title=\"获取部分内容的范围请求\"></a>获取部分内容的范围请求</h3><p>执行范围请求，需要在首部加上Range字段，例如</p>\n<ul>\n<li><code>Range: bytes=500-1000</code>，表示只请求500-1000的字节范围的数据。</li>\n<li><code>Range: bytes=1000-</code>，表示请求1000字节以后的全部数据</li>\n<li><code>Range: bytes=-300, 500-1000</code>，表示请求0-300和500-1000两部分数据</li>\n</ul>\n<p>请求成功，服务器会返回<code>206 Partial Content</code>状态码，表示请求部分数据成功，如何数据已经全部请求完成，则返回200</p>\n<p>例如：一个资源大小为200 bytes，HTTP请求的Range字段为<code>Range: bytes=-300</code>，则一次请求就可以请求到全部数据，因此返回200，不会返回206</p>\n<p>范围请求通常用于断点下载等操作。</p>\n<h3 id=\"内容协商返回最合适的内容\"><a href=\"#内容协商返回最合适的内容\" class=\"headerlink\" title=\"内容协商返回最合适的内容\"></a>内容协商返回最合适的内容</h3><p>同一个页面服务器可能存在多份，比如英文页面，中文页面等。服务器会根据请求报文中的某些字段（语言，字符集，编码方式等）作为判断基准，返回最合适的页面。</p>\n<p>相关的首部字段有</p>\n<ul>\n<li>Accept</li>\n<li>Accept-Charset</li>\n<li>Accept-Encoding</li>\n<li>Accept-Language</li>\n<li>Content-Language</li>\n</ul>\n<h2 id=\"第四章-返回结果的HTTP状态码\"><a href=\"#第四章-返回结果的HTTP状态码\" class=\"headerlink\" title=\"第四章 返回结果的HTTP状态码\"></a>第四章 返回结果的HTTP状态码</h2><p>状态码的职责是当客户端发送请求时，描述返回的请求结果。状态码和状态不一致的现象也很常见。</p>\n<h3 id=\"2XX-OK\"><a href=\"#2XX-OK\" class=\"headerlink\" title=\"2XX OK\"></a>2XX OK</h3><ul>\n<li><strong>200 OK</strong> 正常处理，HEAD请求成功，不返回内容实体，状态码也是200</li>\n<li><strong>204 No Content</strong> 请求已处理成功，但没有资源返回</li>\n<li><strong>206 Partial Content</strong> 请求成功，返回资源的某一部分</li>\n</ul>\n<h3 id=\"3XX-重定向\"><a href=\"#3XX-重定向\" class=\"headerlink\" title=\"3XX 重定向\"></a>3XX 重定向</h3><ul>\n<li><strong>301 Moved Permanently</strong> 永久重定向，资源的URI已经更新</li>\n<li><strong>302 Found</strong> 临时重定向，URI已经更新，希望本次使用新的URI进行请求</li>\n<li><strong>303 See Other</strong> 资源的URI已经更新，请使用GET方法从新的URI获取资源。302和303功能类似，但303明确告诉客户端应该使用GET方法请求另一个URI。实际应用中，当301，302，303状态码返回时，几乎所有的浏览器都会把POST改为GET，<br>然后重新请求。</li>\n<li><strong>304 Not Modified</strong> 资源已找到，但未符合条件请求。<strong>条件请求</strong> 是指在首部添加<code>If-Match, If-Modified-Since, If-None-Match,If-Range,-IfUnmodified-Since</code><br>中的任何一个</li>\n<li><strong>307 TemporaryRedirect</strong> 临时重定向。与302有相同的含义。</li>\n</ul>\n<h3 id=\"4XX-客户端错误\"><a href=\"#4XX-客户端错误\" class=\"headerlink\" title=\"4XX 客户端错误\"></a>4XX 客户端错误</h3><ul>\n<li><strong>400 Bad Request</strong> 请求报文中存在语法错误，服务器无法理解。</li>\n<li><strong>401 Unauthorized</strong> 发送的请求需要通过HTTP认证。当浏览器接受到401时，会弹出认证窗口，让用户填写用户名和密码</li>\n<li><strong>403 Forbidden</strong> 不允许访问该资源</li>\n<li><strong>404 Not Found</strong> 没有找到请求的资源</li>\n</ul>\n<h3 id=\"5XX-服务器错误\"><a href=\"#5XX-服务器错误\" class=\"headerlink\" title=\"5XX 服务器错误\"></a>5XX 服务器错误</h3><ul>\n<li><strong>500 Internal Server Error</strong> 服务器发生错误</li>\n<li><strong>503 Service Unavailable</strong> 表示服务器暂时处于超负载或正在停机维护，现在无法处理请求。</li>\n</ul>\n<h2 id=\"第五章-与HTTP协作的Web服务器\"><a href=\"#第五章-与HTTP协作的Web服务器\" class=\"headerlink\" title=\"第五章 与HTTP协作的Web服务器\"></a>第五章 与HTTP协作的Web服务器</h2><h3 id=\"用单台虚拟主机实现多个域名\"><a href=\"#用单台虚拟主机实现多个域名\" class=\"headerlink\" title=\"用单台虚拟主机实现多个域名\"></a>用单台虚拟主机实现多个域名</h3><p>同一台服务器可以搭建多个Web站点，这是利用了虚拟主机的功能。但是这就会导致多个域名在经过DNS解析后映射到了同一个IP地址。为了确定到底是访问那个域名，<br>HTTP请求中，必须在首部的Host字段完整的指定主机名或域名的URI</p>\n<h3 id=\"通信数据转发程序：代理，网关，隧道\"><a href=\"#通信数据转发程序：代理，网关，隧道\" class=\"headerlink\" title=\"通信数据转发程序：代理，网关，隧道\"></a>通信数据转发程序：代理，网关，隧道</h3><ul>\n<li><strong>代理</strong>：代理是一种有转发功能的应用程序，他接收由客户端发送的请求并转发给服务器，同时也接收服务器返回的响应并转发给客户端<ul>\n<li>代理不会改变请求的URI，会直接发送给前方持有资源的目标服务器，即源服务器。</li>\n<li>在HTTP请求中可以级联多台代理服务器</li>\n<li>代理服务器的用途：<ul>\n<li>利用缓存技术减少网络带宽流量</li>\n<li>组织内部针对特定网站的访问控制</li>\n</ul>\n</li>\n<li>代理的种类<ul>\n<li>缓存代理：将源服务器的资源副本保存在代理服务器上，这样当代理再次接到相同的请求是，就不需要从源服务器那里再次获取资源了</li>\n<li>透明代理和非透明代理：不对报文进行加工，成为透明代理，否则成为非透明代理</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><strong>网关</strong>：转发其他服务器通信数据的服务器<ul>\n<li>网关与代理类似，但它可以提供非HTTP服务，即经过网关可以向非HTTP服务器请求数据</li>\n<li>利用网关能提高通信的安全性</li>\n</ul>\n</li>\n<li><strong>隧道</strong>：在相隔甚远的客户端和服务器两者之间进行中转，并保持双方通信连接的应用程序<ul>\n<li>隧道可按要求建立起一条与其他服务器的通信线路，届时可以使用SSL等加密手段进行通信。</li>\n<li>隧道的目的是确保通信的安全性</li>\n<li>隧道本身不会解析HTTP请求，不会到HTTP请求进行修改</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"保存资源的缓存\"><a href=\"#保存资源的缓存\" class=\"headerlink\" title=\"保存资源的缓存\"></a>保存资源的缓存</h3><p>缓存是指资源的副本，利用缓存可以减少对源服务器的访问，从而节省通信流量和通信时间。</p>\n<p>缓存服务器是代理服务器的一种，用于实现缓存。除了缓存服务器外，也可以包缓存保存在客户端的浏览器中。缓存都是有有效期的，<br>过了有效期就应该重新向源服务器请求最新的资源。</p>\n<h2 id=\"第六章-HTTP首部\"><a href=\"#第六章-HTTP首部\" class=\"headerlink\" title=\"第六章 HTTP首部\"></a>第六章 HTTP首部</h2><h3 id=\"HTTP报文首部字段\"><a href=\"#HTTP报文首部字段\" class=\"headerlink\" title=\"HTTP报文首部字段\"></a>HTTP报文首部字段</h3><ul>\n<li>字段结构：<code>首部字段名:字段值</code>，例如<code>Content-Type: text/html</code>，单个字段也可以有多个只，例如<code>Keep-Alive: timeout=15, max=10</code></li>\n<li>如果首部字段重复，即出现两个同名的字段，则有的浏览器处理第一次出现的字段，有的浏览器处理最后一次出现的首部字段，这个在规范中没有明确指出。</li>\n<li>4种HTTP首部字段类型<ul>\n<li>通用首部字段：请求报文和响应报文都会使用的字段</li>\n<li>请求首部字段：请求报文中使用的首部字段</li>\n<li>响应首部字段：响应报文中使用的首部字段</li>\n<li>实体首部字段：实体部分使用的首部字段</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"通用首部字段\"><a href=\"#通用首部字段\" class=\"headerlink\" title=\"通用首部字段\"></a>通用首部字段</h3><ul>\n<li>Cache-Control：指定缓存的工作机制</li>\n<li>Connection：控制不在转发给代理的首部字段，管理持久链接</li>\n<li>Date：表明创建HTTP报文的时间</li>\n<li>Pragma：指定是否允许代理服务器返回缓存资源，这是历史遗留字段，</li>\n<li>Trailer：说明在报文主体后会记录哪些首部字段，应用于分块传输编码</li>\n<li>Transfer-Encoding：规定了传输报文主体时采用的编码方式</li>\n<li>Upgrade：用于检测HTTP协议及其他协议是否可使用更高版本进行通信，该字段仅限于客户端与邻接服务器，因此需要在Connection中指定Upgrade</li>\n<li>Via：追踪客户端与服务器之间请求和响应的传输路径</li>\n<li>Warning：告知用于一些与缓存相关的问题的警告<br>*</li>\n</ul>\n<h3 id=\"请求首部字段\"><a href=\"#请求首部字段\" class=\"headerlink\" title=\"请求首部字段\"></a>请求首部字段</h3><ul>\n<li>Accept：通知服务器应该返回的资源类型以及类型的优先级，格式为<code>type/subtype</code>，例如<code>text/html, image/jpeg</code></li>\n<li>Accept-Charset：通知服务器客户端支持的字符集及优先级</li>\n<li>Accept-Encoding：通知服务器客户端支持的内容编码及优先级</li>\n<li>Accept-Language：通知服务器客户端支持的语言及优先级</li>\n<li>Authorization：客户端的认证信息</li>\n<li>Form：告知服务器客户端的用户的电子邮箱地址，也可把电子邮箱记录在User-Agent中</li>\n<li>Host：告知服务器资源所处的主机名和端口号</li>\n<li>If-Match：告知服务器匹配资源所有的实体标记(ETag)，只有资源的ETag与该字段值匹配，服务器才会返回请求，否则返回412</li>\n<li>If-Modified-Since：指定更新日期，如果在指定的日期之后资源有更新，则服务器处理请求，返回资源，否则返回304</li>\n<li>If-None-Match：与If-Match相反，只有资源的ETag与该字段值不匹配，服务器才会返回请求，否则返回412</li>\n<li>If-Range：告知服务器若If-Range的字段值（ETag或时间）和请求资源的ETag值或时间相一致时，作为范围请求处理，否则返回全体资源</li>\n<li>If-Unmodified-Since：与If-Modified-Since相反，如果在指定的日期之后资源无更新，则服务器处理请求，返回资源，否则返回412</li>\n<li>Max-Forwards：指定可经过的服务器最大数目，</li>\n<li>Proxy-Authorization：代理认证信息，与Authorization不同之处在于他是客户端与代理服务器之间的认证，而Authorization是客户端与源服务器之间的认证信息</li>\n<li>Range：请求资源的范围</li>\n<li>Referer：告知服务器请求的原始资源的URI</li>\n<li>TE：告知服务器客户端能够处理的响应的编码方式及优先级</li>\n<li>User-Agent：告知服务器浏览器的种类和用户名称等信息</li>\n</ul>\n<h3 id=\"响应首部字段\"><a href=\"#响应首部字段\" class=\"headerlink\" title=\"响应首部字段\"></a>响应首部字段</h3><ul>\n<li>Accept-Range：告知客户端服务器是否能处理范围请求，可以处理则字段值为bytes，反之则为none</li>\n<li>Age：告知客户端该响应是在多久前创建的，如果是缓存服务器，则必须加上Age字段，告知客户端该资源是多久前从源服务器获取的</li>\n<li>ETag：告知客户端实体的标识<ul>\n<li>强ETag值：无论实体发生多么细微的变化，都会改变ETag的值</li>\n<li>弱ETag值：只有资源发生根本改变，产生差异时才会改变ETag值</li>\n</ul>\n</li>\n<li>Location：告知客户端重定向的地址</li>\n<li>Proxy-Authenticate：告知客户端适用于代理服务器的认证方案</li>\n<li>Retry-After：告知客户端多久之后再次发送请求，主要配合503响应或3XX响应</li>\n<li>Server：告知客户端HTTP服务器的应用程序信息</li>\n<li>Vary：源服务器告知代理服务器，必须具有同Vary指定的字段相同的同的值的请求才能直接返回缓存，否则必须从源服务器上获取资源</li>\n<li>WWW-Authenticate：告知客户端适用于服务器的认证方案</li>\n</ul>\n<h3 id=\"实体首部字段\"><a href=\"#实体首部字段\" class=\"headerlink\" title=\"实体首部字段\"></a>实体首部字段</h3><ul>\n<li>Allow：告知客户端服务器能够支持的所有HTTP方法</li>\n<li>Content-Encoding：告知客户端服务器对实体的主体部分选用的编码方式</li>\n<li>Content-Language：告知客户端实体主体使用的自然语言</li>\n<li>Content-Length：告知客户端实体主体的大小（字节）</li>\n<li>Content-Location：报文主体返回资源对应的URI</li>\n<li>Content-MD5：报文主体部分的MD5值，用于校验主体部分是否完整</li>\n<li>Content-Range：告知客户端返回的实体是整个资源的那一部分，格式<code>500-1000/1000</code></li>\n<li>Content-Type：说明实体内对象的类型</li>\n<li>Expires：告知客户端或代理服务器资源失效的日期</li>\n<li>Last-Modified：指明资源最终修改的时间</li>\n</ul>\n<h3 id=\"为Cookie服务器的首部字段\"><a href=\"#为Cookie服务器的首部字段\" class=\"headerlink\" title=\"为Cookie服务器的首部字段\"></a>为Cookie服务器的首部字段</h3><ul>\n<li>Set-Cookie：告知客户端各种状态信息以及Cookie的设置信息</li>\n<li>Cookie：告知服务器当前客户端的各种状态信息</li>\n</ul>\n<h3 id=\"其他首部字段\"><a href=\"#其他首部字段\" class=\"headerlink\" title=\"其他首部字段\"></a>其他首部字段</h3><ul>\n<li>X-Frame-Options：控制网站内容在其他Web网站的Frame标签内显示的问题，可防止点击劫持攻击</li>\n<li>X-XSS-Protection：控制浏览器XSS防护机制的开关</li>\n<li>DNT：告知服务器客户端拒绝提供个人信息</li>\n<li>P3P：让Web网站上的个人隐私变成一种仅供程序可理解的形式</li>\n</ul>\n<h2 id=\"第七章-确保Web安全的HTTPS\"><a href=\"#第七章-确保Web安全的HTTPS\" class=\"headerlink\" title=\"第七章 确保Web安全的HTTPS\"></a>第七章 确保Web安全的HTTPS</h2><h3 id=\"HTTP的缺点\"><a href=\"#HTTP的缺点\" class=\"headerlink\" title=\"HTTP的缺点\"></a>HTTP的缺点</h3><ul>\n<li><strong>通信使用明文可能会被窃听</strong><ul>\n<li>TCP/IP是可能被窃听的网络</li>\n<li>使用加密处理防止被窃听<ul>\n<li>通信加密：对整个通信线路加密，通过SSL或TSL加密HTTP的通信内容，与SSL组合使用的HTTP成为HTTPS（超文本传输安全协议）</li>\n<li>内容加密：对实体内容加密，客户端服务器要有相应的加密和解密机制</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><strong>不验证通信方的身份就可能遭遇伪装</strong><ul>\n<li>任何人都可能发起请求</li>\n<li>查明对手的证书<ul>\n<li>SSL不仅提供加密处理，还使用了证书手段，用于确定对方的身份</li>\n<li>证书由值得信任的第三方机构颁发，用于证明服务器和客户端是实际存在的</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><strong>无法证明报文完整性，可能已遭篡改</strong></li>\n</ul>\n<h3 id=\"HTTP-加密-认证-完整性保护-HTTPS\"><a href=\"#HTTP-加密-认证-完整性保护-HTTPS\" class=\"headerlink\" title=\"HTTP+加密+认证+完整性保护=HTTPS\"></a>HTTP+加密+认证+完整性保护=HTTPS</h3><ul>\n<li>HTTP加上加密处理和认证以及完整性保护就是HTTPS</li>\n<li>HTTPS是身披SSL外壳的HTTP<ul>\n<li>HTTPS并非一种新的协议，只是HTTP通信接口部分用SSL和TLS协议代替而已</li>\n<li>SSL是独立于HTTP的协议，所以不光是HTTP协议，其他运行在应用层的协议也可以配合SSL协议使用，SSL是当今世界应用最为广泛的网络安全技术</li>\n</ul>\n</li>\n<li>加密技术<ul>\n<li>共享密钥：即加密和解密使用同一个密钥的方式，也称为对称密钥加密<ul>\n<li>优点：速度快</li>\n<li>缺点：密钥可能被劫持</li>\n</ul>\n</li>\n<li>公开密钥：使用两个密钥，公有密钥和私有密钥，公有密钥加密，私有密钥解密，又称为非对称加密<ul>\n<li>优点：安全性高，密钥不会被劫持</li>\n<li>缺点：处理速度慢</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>HTTPS采用混合加密机制，即共享密钥和公开密钥混合的方式，一般情况下是使用公开密钥的方式传输共享密钥的密钥，当共享密钥的密钥被安全送达后，就可以<br>使用共享密钥来加密普通数据。</li>\n</ul>\n<h3 id=\"证明公开密钥正确性的证书\"><a href=\"#证明公开密钥正确性的证书\" class=\"headerlink\" title=\"证明公开密钥正确性的证书\"></a>证明公开密钥正确性的证书</h3><ul>\n<li>问题：如何确保公开密钥中的共有密钥在传输过程中不被篡改</li>\n<li>解决方案：使用数字证书确保共有密钥的正确性</li>\n<li>基本流程：<ol>\n<li>服务器从数字证书认证机构那里申请公钥证书，公钥证书包含服务器的公开密钥和数字证书认证机构的数字签名。</li>\n<li>申请到公钥证书之后把这份公钥证书发送给用户</li>\n<li>用户在拿到公钥证书后使用数字证书认证机构的公开密钥（一般浏览器都会内置常用认证机构的公开密钥）对证书进行验证</li>\n<li>一旦认证通过就表示公钥证书中的服务器公钥是真实可靠的。</li>\n</ol>\n</li>\n<li>其他的一些概念<ul>\n<li>EV SSL证书：用来证明服务器是否符合规范，服务器背后的运营企业是否真实存在的证书</li>\n<li>客户端证书：用来证明客户端实际存在的证书</li>\n<li>自签名证书：使用OpenSSL可以构建自己的证书认证机构，自己给自己颁发服务器证书，该证书一般不被浏览器信赖</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"HTTPS的安全通信机制\"><a href=\"#HTTPS的安全通信机制\" class=\"headerlink\" title=\"HTTPS的安全通信机制\"></a>HTTPS的安全通信机制</h3><ul>\n<li>SSL和TLS：TLS是在SSL基础上开发的协议。</li>\n<li>HTTPS会比相应的HTTP请求要慢，因为要做加密处理。所以除非敏感信息，否则一般情况下使用HTTP就可以了。</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<ul>\n<li>toc<br>{:toc}</li>\n</ul>\n<h2 id=\"第三章-HTTP报文内的HTTP信息\"><a href=\"#第三章-HTTP报文内的HTTP信息\" class=\"headerlink\" title=\"第三章 HTTP报文内的HTTP信息\"></a>第三章 HTTP报文内的HTTP信息</h2><h3 id=\"HTTP报文\"><a href=\"#HTTP报文\" class=\"headerlink\" title=\"HTTP报文\"></a>HTTP报文</h3><p>HTTP报文分为请求报文和响应报文两种，主要是由报文首部和报文主体两部分组成。</p>\n<h3 id=\"编码提升传输速率\"><a href=\"#编码提升传输速率\" class=\"headerlink\" title=\"编码提升传输速率\"></a>编码提升传输速率</h3><p>为了提升传输速率，HTTP协议通常会对要传输的实体进行压缩，即内容编码。<br>内容编码致指明应用在实体内容上的编码格式，并保持实体信息原样压缩。内容编码后的实体由客户端接收并负责解码。常见的编码有：</p>\n<ul>\n<li>gzip (GNU zip)</li>\n<li>compress (UNIX系统标准压缩)</li>\n<li>deflate (zlib)</li>\n<li>identity (不进行编码)</li>\n</ul>\n<p><strong>分块编码</strong> 对于实体数据过大时，通常会把实体数据进行分块传输。分块编码会将实体主体分成多个部分快，客户端在接收到之后自行解码拼接。</p>\n<h3 id=\"发送多种数据类型\"><a href=\"#发送多种数据类型\" class=\"headerlink\" title=\"发送多种数据类型\"></a>发送多种数据类型</h3><p>一个HTTP请求中可能还有文字，图片，视频等多种不同的数据类型，HTTP协议通过多部分对象集合，使得一份报文中可以含有多类型实体。通常实在上传图片或文本时使用。</p>\n<p>多部分对象集合包含的对象：</p>\n<ul>\n<li>multipart/form-data : 表单文件上传</li>\n<li>multipart/byteranges : 状态码为206，响应报文中包含了多个范围的内容</li>\n</ul>\n<p>多部分对象集合中的每个部分都含有首部字段，另外，还可以在某个部分中嵌套使用对象集合。</p>\n<h3 id=\"获取部分内容的范围请求\"><a href=\"#获取部分内容的范围请求\" class=\"headerlink\" title=\"获取部分内容的范围请求\"></a>获取部分内容的范围请求</h3><p>执行范围请求，需要在首部加上Range字段，例如</p>\n<ul>\n<li><code>Range: bytes=500-1000</code>，表示只请求500-1000的字节范围的数据。</li>\n<li><code>Range: bytes=1000-</code>，表示请求1000字节以后的全部数据</li>\n<li><code>Range: bytes=-300, 500-1000</code>，表示请求0-300和500-1000两部分数据</li>\n</ul>\n<p>请求成功，服务器会返回<code>206 Partial Content</code>状态码，表示请求部分数据成功，如何数据已经全部请求完成，则返回200</p>\n<p>例如：一个资源大小为200 bytes，HTTP请求的Range字段为<code>Range: bytes=-300</code>，则一次请求就可以请求到全部数据，因此返回200，不会返回206</p>\n<p>范围请求通常用于断点下载等操作。</p>\n<h3 id=\"内容协商返回最合适的内容\"><a href=\"#内容协商返回最合适的内容\" class=\"headerlink\" title=\"内容协商返回最合适的内容\"></a>内容协商返回最合适的内容</h3><p>同一个页面服务器可能存在多份，比如英文页面，中文页面等。服务器会根据请求报文中的某些字段（语言，字符集，编码方式等）作为判断基准，返回最合适的页面。</p>\n<p>相关的首部字段有</p>\n<ul>\n<li>Accept</li>\n<li>Accept-Charset</li>\n<li>Accept-Encoding</li>\n<li>Accept-Language</li>\n<li>Content-Language</li>\n</ul>\n<h2 id=\"第四章-返回结果的HTTP状态码\"><a href=\"#第四章-返回结果的HTTP状态码\" class=\"headerlink\" title=\"第四章 返回结果的HTTP状态码\"></a>第四章 返回结果的HTTP状态码</h2><p>状态码的职责是当客户端发送请求时，描述返回的请求结果。状态码和状态不一致的现象也很常见。</p>\n<h3 id=\"2XX-OK\"><a href=\"#2XX-OK\" class=\"headerlink\" title=\"2XX OK\"></a>2XX OK</h3><ul>\n<li><strong>200 OK</strong> 正常处理，HEAD请求成功，不返回内容实体，状态码也是200</li>\n<li><strong>204 No Content</strong> 请求已处理成功，但没有资源返回</li>\n<li><strong>206 Partial Content</strong> 请求成功，返回资源的某一部分</li>\n</ul>\n<h3 id=\"3XX-重定向\"><a href=\"#3XX-重定向\" class=\"headerlink\" title=\"3XX 重定向\"></a>3XX 重定向</h3><ul>\n<li><strong>301 Moved Permanently</strong> 永久重定向，资源的URI已经更新</li>\n<li><strong>302 Found</strong> 临时重定向，URI已经更新，希望本次使用新的URI进行请求</li>\n<li><strong>303 See Other</strong> 资源的URI已经更新，请使用GET方法从新的URI获取资源。302和303功能类似，但303明确告诉客户端应该使用GET方法请求另一个URI。实际应用中，当301，302，303状态码返回时，几乎所有的浏览器都会把POST改为GET，<br>然后重新请求。</li>\n<li><strong>304 Not Modified</strong> 资源已找到，但未符合条件请求。<strong>条件请求</strong> 是指在首部添加<code>If-Match, If-Modified-Since, If-None-Match,If-Range,-IfUnmodified-Since</code><br>中的任何一个</li>\n<li><strong>307 TemporaryRedirect</strong> 临时重定向。与302有相同的含义。</li>\n</ul>\n<h3 id=\"4XX-客户端错误\"><a href=\"#4XX-客户端错误\" class=\"headerlink\" title=\"4XX 客户端错误\"></a>4XX 客户端错误</h3><ul>\n<li><strong>400 Bad Request</strong> 请求报文中存在语法错误，服务器无法理解。</li>\n<li><strong>401 Unauthorized</strong> 发送的请求需要通过HTTP认证。当浏览器接受到401时，会弹出认证窗口，让用户填写用户名和密码</li>\n<li><strong>403 Forbidden</strong> 不允许访问该资源</li>\n<li><strong>404 Not Found</strong> 没有找到请求的资源</li>\n</ul>\n<h3 id=\"5XX-服务器错误\"><a href=\"#5XX-服务器错误\" class=\"headerlink\" title=\"5XX 服务器错误\"></a>5XX 服务器错误</h3><ul>\n<li><strong>500 Internal Server Error</strong> 服务器发生错误</li>\n<li><strong>503 Service Unavailable</strong> 表示服务器暂时处于超负载或正在停机维护，现在无法处理请求。</li>\n</ul>\n<h2 id=\"第五章-与HTTP协作的Web服务器\"><a href=\"#第五章-与HTTP协作的Web服务器\" class=\"headerlink\" title=\"第五章 与HTTP协作的Web服务器\"></a>第五章 与HTTP协作的Web服务器</h2><h3 id=\"用单台虚拟主机实现多个域名\"><a href=\"#用单台虚拟主机实现多个域名\" class=\"headerlink\" title=\"用单台虚拟主机实现多个域名\"></a>用单台虚拟主机实现多个域名</h3><p>同一台服务器可以搭建多个Web站点，这是利用了虚拟主机的功能。但是这就会导致多个域名在经过DNS解析后映射到了同一个IP地址。为了确定到底是访问那个域名，<br>HTTP请求中，必须在首部的Host字段完整的指定主机名或域名的URI</p>\n<h3 id=\"通信数据转发程序：代理，网关，隧道\"><a href=\"#通信数据转发程序：代理，网关，隧道\" class=\"headerlink\" title=\"通信数据转发程序：代理，网关，隧道\"></a>通信数据转发程序：代理，网关，隧道</h3><ul>\n<li><strong>代理</strong>：代理是一种有转发功能的应用程序，他接收由客户端发送的请求并转发给服务器，同时也接收服务器返回的响应并转发给客户端<ul>\n<li>代理不会改变请求的URI，会直接发送给前方持有资源的目标服务器，即源服务器。</li>\n<li>在HTTP请求中可以级联多台代理服务器</li>\n<li>代理服务器的用途：<ul>\n<li>利用缓存技术减少网络带宽流量</li>\n<li>组织内部针对特定网站的访问控制</li>\n</ul>\n</li>\n<li>代理的种类<ul>\n<li>缓存代理：将源服务器的资源副本保存在代理服务器上，这样当代理再次接到相同的请求是，就不需要从源服务器那里再次获取资源了</li>\n<li>透明代理和非透明代理：不对报文进行加工，成为透明代理，否则成为非透明代理</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><strong>网关</strong>：转发其他服务器通信数据的服务器<ul>\n<li>网关与代理类似，但它可以提供非HTTP服务，即经过网关可以向非HTTP服务器请求数据</li>\n<li>利用网关能提高通信的安全性</li>\n</ul>\n</li>\n<li><strong>隧道</strong>：在相隔甚远的客户端和服务器两者之间进行中转，并保持双方通信连接的应用程序<ul>\n<li>隧道可按要求建立起一条与其他服务器的通信线路，届时可以使用SSL等加密手段进行通信。</li>\n<li>隧道的目的是确保通信的安全性</li>\n<li>隧道本身不会解析HTTP请求，不会到HTTP请求进行修改</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"保存资源的缓存\"><a href=\"#保存资源的缓存\" class=\"headerlink\" title=\"保存资源的缓存\"></a>保存资源的缓存</h3><p>缓存是指资源的副本，利用缓存可以减少对源服务器的访问，从而节省通信流量和通信时间。</p>\n<p>缓存服务器是代理服务器的一种，用于实现缓存。除了缓存服务器外，也可以包缓存保存在客户端的浏览器中。缓存都是有有效期的，<br>过了有效期就应该重新向源服务器请求最新的资源。</p>\n<h2 id=\"第六章-HTTP首部\"><a href=\"#第六章-HTTP首部\" class=\"headerlink\" title=\"第六章 HTTP首部\"></a>第六章 HTTP首部</h2><h3 id=\"HTTP报文首部字段\"><a href=\"#HTTP报文首部字段\" class=\"headerlink\" title=\"HTTP报文首部字段\"></a>HTTP报文首部字段</h3><ul>\n<li>字段结构：<code>首部字段名:字段值</code>，例如<code>Content-Type: text/html</code>，单个字段也可以有多个只，例如<code>Keep-Alive: timeout=15, max=10</code></li>\n<li>如果首部字段重复，即出现两个同名的字段，则有的浏览器处理第一次出现的字段，有的浏览器处理最后一次出现的首部字段，这个在规范中没有明确指出。</li>\n<li>4种HTTP首部字段类型<ul>\n<li>通用首部字段：请求报文和响应报文都会使用的字段</li>\n<li>请求首部字段：请求报文中使用的首部字段</li>\n<li>响应首部字段：响应报文中使用的首部字段</li>\n<li>实体首部字段：实体部分使用的首部字段</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"通用首部字段\"><a href=\"#通用首部字段\" class=\"headerlink\" title=\"通用首部字段\"></a>通用首部字段</h3><ul>\n<li>Cache-Control：指定缓存的工作机制</li>\n<li>Connection：控制不在转发给代理的首部字段，管理持久链接</li>\n<li>Date：表明创建HTTP报文的时间</li>\n<li>Pragma：指定是否允许代理服务器返回缓存资源，这是历史遗留字段，</li>\n<li>Trailer：说明在报文主体后会记录哪些首部字段，应用于分块传输编码</li>\n<li>Transfer-Encoding：规定了传输报文主体时采用的编码方式</li>\n<li>Upgrade：用于检测HTTP协议及其他协议是否可使用更高版本进行通信，该字段仅限于客户端与邻接服务器，因此需要在Connection中指定Upgrade</li>\n<li>Via：追踪客户端与服务器之间请求和响应的传输路径</li>\n<li>Warning：告知用于一些与缓存相关的问题的警告<br>*</li>\n</ul>\n<h3 id=\"请求首部字段\"><a href=\"#请求首部字段\" class=\"headerlink\" title=\"请求首部字段\"></a>请求首部字段</h3><ul>\n<li>Accept：通知服务器应该返回的资源类型以及类型的优先级，格式为<code>type/subtype</code>，例如<code>text/html, image/jpeg</code></li>\n<li>Accept-Charset：通知服务器客户端支持的字符集及优先级</li>\n<li>Accept-Encoding：通知服务器客户端支持的内容编码及优先级</li>\n<li>Accept-Language：通知服务器客户端支持的语言及优先级</li>\n<li>Authorization：客户端的认证信息</li>\n<li>Form：告知服务器客户端的用户的电子邮箱地址，也可把电子邮箱记录在User-Agent中</li>\n<li>Host：告知服务器资源所处的主机名和端口号</li>\n<li>If-Match：告知服务器匹配资源所有的实体标记(ETag)，只有资源的ETag与该字段值匹配，服务器才会返回请求，否则返回412</li>\n<li>If-Modified-Since：指定更新日期，如果在指定的日期之后资源有更新，则服务器处理请求，返回资源，否则返回304</li>\n<li>If-None-Match：与If-Match相反，只有资源的ETag与该字段值不匹配，服务器才会返回请求，否则返回412</li>\n<li>If-Range：告知服务器若If-Range的字段值（ETag或时间）和请求资源的ETag值或时间相一致时，作为范围请求处理，否则返回全体资源</li>\n<li>If-Unmodified-Since：与If-Modified-Since相反，如果在指定的日期之后资源无更新，则服务器处理请求，返回资源，否则返回412</li>\n<li>Max-Forwards：指定可经过的服务器最大数目，</li>\n<li>Proxy-Authorization：代理认证信息，与Authorization不同之处在于他是客户端与代理服务器之间的认证，而Authorization是客户端与源服务器之间的认证信息</li>\n<li>Range：请求资源的范围</li>\n<li>Referer：告知服务器请求的原始资源的URI</li>\n<li>TE：告知服务器客户端能够处理的响应的编码方式及优先级</li>\n<li>User-Agent：告知服务器浏览器的种类和用户名称等信息</li>\n</ul>\n<h3 id=\"响应首部字段\"><a href=\"#响应首部字段\" class=\"headerlink\" title=\"响应首部字段\"></a>响应首部字段</h3><ul>\n<li>Accept-Range：告知客户端服务器是否能处理范围请求，可以处理则字段值为bytes，反之则为none</li>\n<li>Age：告知客户端该响应是在多久前创建的，如果是缓存服务器，则必须加上Age字段，告知客户端该资源是多久前从源服务器获取的</li>\n<li>ETag：告知客户端实体的标识<ul>\n<li>强ETag值：无论实体发生多么细微的变化，都会改变ETag的值</li>\n<li>弱ETag值：只有资源发生根本改变，产生差异时才会改变ETag值</li>\n</ul>\n</li>\n<li>Location：告知客户端重定向的地址</li>\n<li>Proxy-Authenticate：告知客户端适用于代理服务器的认证方案</li>\n<li>Retry-After：告知客户端多久之后再次发送请求，主要配合503响应或3XX响应</li>\n<li>Server：告知客户端HTTP服务器的应用程序信息</li>\n<li>Vary：源服务器告知代理服务器，必须具有同Vary指定的字段相同的同的值的请求才能直接返回缓存，否则必须从源服务器上获取资源</li>\n<li>WWW-Authenticate：告知客户端适用于服务器的认证方案</li>\n</ul>\n<h3 id=\"实体首部字段\"><a href=\"#实体首部字段\" class=\"headerlink\" title=\"实体首部字段\"></a>实体首部字段</h3><ul>\n<li>Allow：告知客户端服务器能够支持的所有HTTP方法</li>\n<li>Content-Encoding：告知客户端服务器对实体的主体部分选用的编码方式</li>\n<li>Content-Language：告知客户端实体主体使用的自然语言</li>\n<li>Content-Length：告知客户端实体主体的大小（字节）</li>\n<li>Content-Location：报文主体返回资源对应的URI</li>\n<li>Content-MD5：报文主体部分的MD5值，用于校验主体部分是否完整</li>\n<li>Content-Range：告知客户端返回的实体是整个资源的那一部分，格式<code>500-1000/1000</code></li>\n<li>Content-Type：说明实体内对象的类型</li>\n<li>Expires：告知客户端或代理服务器资源失效的日期</li>\n<li>Last-Modified：指明资源最终修改的时间</li>\n</ul>\n<h3 id=\"为Cookie服务器的首部字段\"><a href=\"#为Cookie服务器的首部字段\" class=\"headerlink\" title=\"为Cookie服务器的首部字段\"></a>为Cookie服务器的首部字段</h3><ul>\n<li>Set-Cookie：告知客户端各种状态信息以及Cookie的设置信息</li>\n<li>Cookie：告知服务器当前客户端的各种状态信息</li>\n</ul>\n<h3 id=\"其他首部字段\"><a href=\"#其他首部字段\" class=\"headerlink\" title=\"其他首部字段\"></a>其他首部字段</h3><ul>\n<li>X-Frame-Options：控制网站内容在其他Web网站的Frame标签内显示的问题，可防止点击劫持攻击</li>\n<li>X-XSS-Protection：控制浏览器XSS防护机制的开关</li>\n<li>DNT：告知服务器客户端拒绝提供个人信息</li>\n<li>P3P：让Web网站上的个人隐私变成一种仅供程序可理解的形式</li>\n</ul>\n<h2 id=\"第七章-确保Web安全的HTTPS\"><a href=\"#第七章-确保Web安全的HTTPS\" class=\"headerlink\" title=\"第七章 确保Web安全的HTTPS\"></a>第七章 确保Web安全的HTTPS</h2><h3 id=\"HTTP的缺点\"><a href=\"#HTTP的缺点\" class=\"headerlink\" title=\"HTTP的缺点\"></a>HTTP的缺点</h3><ul>\n<li><strong>通信使用明文可能会被窃听</strong><ul>\n<li>TCP/IP是可能被窃听的网络</li>\n<li>使用加密处理防止被窃听<ul>\n<li>通信加密：对整个通信线路加密，通过SSL或TSL加密HTTP的通信内容，与SSL组合使用的HTTP成为HTTPS（超文本传输安全协议）</li>\n<li>内容加密：对实体内容加密，客户端服务器要有相应的加密和解密机制</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><strong>不验证通信方的身份就可能遭遇伪装</strong><ul>\n<li>任何人都可能发起请求</li>\n<li>查明对手的证书<ul>\n<li>SSL不仅提供加密处理，还使用了证书手段，用于确定对方的身份</li>\n<li>证书由值得信任的第三方机构颁发，用于证明服务器和客户端是实际存在的</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><strong>无法证明报文完整性，可能已遭篡改</strong></li>\n</ul>\n<h3 id=\"HTTP-加密-认证-完整性保护-HTTPS\"><a href=\"#HTTP-加密-认证-完整性保护-HTTPS\" class=\"headerlink\" title=\"HTTP+加密+认证+完整性保护=HTTPS\"></a>HTTP+加密+认证+完整性保护=HTTPS</h3><ul>\n<li>HTTP加上加密处理和认证以及完整性保护就是HTTPS</li>\n<li>HTTPS是身披SSL外壳的HTTP<ul>\n<li>HTTPS并非一种新的协议，只是HTTP通信接口部分用SSL和TLS协议代替而已</li>\n<li>SSL是独立于HTTP的协议，所以不光是HTTP协议，其他运行在应用层的协议也可以配合SSL协议使用，SSL是当今世界应用最为广泛的网络安全技术</li>\n</ul>\n</li>\n<li>加密技术<ul>\n<li>共享密钥：即加密和解密使用同一个密钥的方式，也称为对称密钥加密<ul>\n<li>优点：速度快</li>\n<li>缺点：密钥可能被劫持</li>\n</ul>\n</li>\n<li>公开密钥：使用两个密钥，公有密钥和私有密钥，公有密钥加密，私有密钥解密，又称为非对称加密<ul>\n<li>优点：安全性高，密钥不会被劫持</li>\n<li>缺点：处理速度慢</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>HTTPS采用混合加密机制，即共享密钥和公开密钥混合的方式，一般情况下是使用公开密钥的方式传输共享密钥的密钥，当共享密钥的密钥被安全送达后，就可以<br>使用共享密钥来加密普通数据。</li>\n</ul>\n<h3 id=\"证明公开密钥正确性的证书\"><a href=\"#证明公开密钥正确性的证书\" class=\"headerlink\" title=\"证明公开密钥正确性的证书\"></a>证明公开密钥正确性的证书</h3><ul>\n<li>问题：如何确保公开密钥中的共有密钥在传输过程中不被篡改</li>\n<li>解决方案：使用数字证书确保共有密钥的正确性</li>\n<li>基本流程：<ol>\n<li>服务器从数字证书认证机构那里申请公钥证书，公钥证书包含服务器的公开密钥和数字证书认证机构的数字签名。</li>\n<li>申请到公钥证书之后把这份公钥证书发送给用户</li>\n<li>用户在拿到公钥证书后使用数字证书认证机构的公开密钥（一般浏览器都会内置常用认证机构的公开密钥）对证书进行验证</li>\n<li>一旦认证通过就表示公钥证书中的服务器公钥是真实可靠的。</li>\n</ol>\n</li>\n<li>其他的一些概念<ul>\n<li>EV SSL证书：用来证明服务器是否符合规范，服务器背后的运营企业是否真实存在的证书</li>\n<li>客户端证书：用来证明客户端实际存在的证书</li>\n<li>自签名证书：使用OpenSSL可以构建自己的证书认证机构，自己给自己颁发服务器证书，该证书一般不被浏览器信赖</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"HTTPS的安全通信机制\"><a href=\"#HTTPS的安全通信机制\" class=\"headerlink\" title=\"HTTPS的安全通信机制\"></a>HTTPS的安全通信机制</h3><ul>\n<li>SSL和TLS：TLS是在SSL基础上开发的协议。</li>\n<li>HTTPS会比相应的HTTP请求要慢，因为要做加密处理。所以除非敏感信息，否则一般情况下使用HTTP就可以了。</li>\n</ul>\n"},{"layout":"post","title":"RAC学习笔记","_content":"## RAC简介\n\nRAC要解决的问题是传统ios中事件，通知，回调的机制十分的繁琐。\n\n## 常规用法\n\n### target-action\n\n* RAC可以替代一般的target-action操作，例如监测textField的文字的改变，不是用RAC的写法\n\n```objectivec\n- (void)viewDidLoad {\n    [super viewDidLoad];\n\n    UITextField *text = ({\n        UITextField *text = [[UITextField alloc] init];\n        [self.view addSubview:text];\n        [text mas_makeConstraints:^(MASConstraintMaker *make) {\n            make.center.equalTo(self.view);\n            make.size.mas_equalTo(CGSizeMake(200, 40));\n        }];\n        text.backgroundColor = [UIColor redColor];\n        [text addTarget:self action:@selector(textDidChange:) forControlEvents:UIControlEventEditingChanged];\n        text;\n    });\n}\n\n- (void)textDidChange:(UITextField *)sender {\n    NSLog(@\"did change: %@\", sender);\n}\n```\n\n* 使用RAC的写法：\n```objectivec\n- (void)viewDidLoad {\n    [super viewDidLoad];\n\n    UITextField *text = ({\n        UITextField *text = [[UITextField alloc] init];\n        [self.view addSubview:text];\n        [text mas_makeConstraints:^(MASConstraintMaker *make) {\n            make.center.equalTo(self.view);\n            make.size.mas_equalTo(CGSizeMake(200, 40));\n        }];\n        text.backgroundColor = [UIColor redColor];\n\n        [[text rac_signalForControlEvents:UIControlEventEditingChanged] subscribeNext:^(id x) {\n            NSLog(@\"%@\", x);\n        }];\n\n        // 或者\n        //[text.rac_textSignal subscribeNext:^(id x) {\n        //    NSLog(@\"%@\", x);\n        //}];\n\n        text;\n    });\n}\n```\n\n### 手势中使用RAC\n\n* RAC可以替换手势的方法，代码如下\n\n```objectivec\n- (void)viewDidLoad {\n    [super viewDidLoad];\n\n    self.view.userInteractionEnabled = YES;\n    UITapGestureRecognizer *tap = [[UITapGestureRecognizer alloc] init];\n    [[tap rac_gestureSignal] subscribeNext:^(id x) {\n        NSLog(@\"%@\", x);\n    }];\n    [self.view addGestureRecognizer:tap];\n}\n```\n\n### 通知\n\n* RAC可以代替通知，并且RAC的通知不用移出\n\n```objectivec\n- (void)viewDidLoad {\n    [super viewDidLoad];\n    [[[NSNotificationCenter defaultCenter] rac_addObserverForName:UIApplicationDidBecomeActiveNotification object:nil] subscribeNext:^(id x) {\n        NSLog(@\"%@\", x);\n    }];\n}\n```\n\n### 定制器\n\n* RAC可以代替定时器\n\n```objectivec\n- (void)viewDidLoad {\n    [super viewDidLoad];\n\n    // 延迟2秒执行\n    [[RACScheduler mainThreadScheduler] afterDelay:2.0 schedule:^{\n        NSLog(@\"haha\");\n    }];\n\n    // interval为间隔事件，scheduler为在那个线程上执行，leeway为多久之后开始执行。\n    [[RACSignal interval:2.0 onScheduler:[RACScheduler mainThreadScheduler] withLeeway:5.0] subscribeNext:^(NSDate x) {\n        NSLog(@\"%@\", x);\n    }];\n\n}\n```\n\n### 代理\n\n* RAC可以替换代理，但仅限没有返回值的代理\n\n```objectivec\n@interface ViewController ()<UITableViewDelegate>\n@property (nonatomic, strong) UIAlertView *alertView;\n\n@end\n\n@implementation ViewController\n\n- (void)viewDidLoad {\n    [super viewDidLoad];\n\n    self.alertView = [[UIAlertView alloc] initWithTitle:@\"RAC\" message:@\"test\" delegate:self cancelButtonTitle:@\"OK\" otherButtonTitles: nil];\n    [[self rac_signalForSelector:@selector(alertView:clickedButtonAtIndex:) fromProtocol:@protocol(UIAlertViewDelegate)]subscribeNext:^(id x) {\n        NSLog(@\"%@\",x);\n    }];\n    // 或者\n    // [[self.alertView rac_buttonClickedSignal] subscribeNext:^(id x) {\n    //     NSLog(@\"%@\", x);\n    // }];\n\n    [self.alertView show];\n}\n\n@end\n```\n\n### KVO\n\n* RAC可以替换KVO\n\n```objectivec\n@interface ViewController ()\n\n@property (nonatomic, assign) NSInteger index;\n@end\n\n@implementation ViewController\n\n- (void)viewDidLoad {\n    [super viewDidLoad];\n\n    [RACObserve(self, index) subscribeNext:^(id x) {\n        NSLog(@\"%@\", x);\n    }];\n\n}\n\n- (void)touchesBegan:(NSSet<UITouch *> *)touches withEvent:(UIEvent *)event {\n    self.index++;\n}\n\n@end\n```\n\n## 高级用法\n\n### 创建信号\n\n```objectivec\n- (void)viewDidLoad {\n    [super viewDidLoad];\n\n    RACSignal *signal = [RACSignal createSignal:^RACDisposable *(id<RACSubscriber> subscriber) {\n        NSURLRequest *req = [NSURLRequest requestWithURL:[NSURL URLWithString:@\"http://www.baidu.com\"]];\n        [NSURLConnection sendAsynchronousRequest:req queue:[NSOperationQueue mainQueue] completionHandler:^(NSURLResponse * _Nullable response, NSData * _Nullable data, NSError * _Nullable connectionError) {\n            if (connectionError) {\n                // 请求失败\n                [subscriber sendError:connectionError];\n            }\n            else {\n                // 请求成功\n                [subscriber sendNext:data];\n            }\n            [subscriber sendCompleted];\n        }];\n        return [RACDisposable disposableWithBlock:^{\n            // 取消订阅\n            NSLog(@\"cancel\");\n        }];\n    }];\n\n    RACDisposable *disposable = [signal subscribeNext:^(NSData *responseData) {\n        NSLog(@\"%@\", responseData);\n    } error:^(NSError *error) {\n        NSLog(@\"%@\", error);\n    } completed:^{\n        NSLog(@\"completed\");\n    }];\n\n    // 订阅完就取消订阅，这样就不会执行订阅block了\n    [disposable dispose];\n}\n```\n\n### 信号处理\n\n* map:映射\n* filter:过滤\n* delay:延时\n* startWith:在接收到信号前，先接收到一个信号\n\n```objectivec\n- (void)viewDidLoad {\n    [super viewDidLoad];\n\n    UITextField *textField = ({\n        UITextField *view = [[UITextField alloc] init];\n        [self.view addSubview:view];\n        [view mas_makeConstraints:^(MASConstraintMaker *make) {\n            make.center.equalTo(self.view);\n            make.size.mas_equalTo(CGSizeMake(200, 40));\n        }];\n        view.backgroundColor = [UIColor redColor];\n        view;\n    });\n\n    [[[[[[textField rac_textSignal] map:^id(id value) {\n        NSString *str = (NSString *)value;\n        return @([str length]);\n    }] filter:^BOOL(id value) {\n        return [value integerValue] > 3;\n    }] delay:2] startWith:@\"haha\"] subscribeNext:^(id x) {\n        NSLog(@\"%@\", x);\n    }];\n}\n```\n\n* timeout:超时\n\n```objectivec\nRACSignal *signal = [[RACSignal createSignal:^RACDisposable *(id<RACSubscriber> subscriber) {\n\n    [[RACScheduler mainThreadScheduler] afterDelay:1.0 schedule:^{\n        [subscriber sendNext:@\"hello\"];\n        [subscriber sendCompleted];\n    }];\n    return nil;\n\n}] timeout:2.0 onScheduler:[RACScheduler mainThreadScheduler]]; // 如果请求没有在2秒内完成，则请求超时，会调用errorBlock\n\n[signal subscribeNext:^(NSData *responseData) {\n    NSLog(@\"%@\", responseData);\n} error:^(NSError *error) {\n    NSLog(@\"%@\", error);\n} completed:^{\n    NSLog(@\"completed\");\n}];\n```\n\n* take:接收到多次信号，但只处理前几次信号\n* takeLast:只处理最后几次信号\n* skip:忽略几次\n* takeUntilBlock:返回YES可以表示不接收，返回NO表示接收该信号，与filter类似\n* takeWhileBlock:当返回一次YES后，就停止接收所有信号\n\n```objectivec\nRACSignal *signal = [[RACSignal createSignal:^RACDisposable *(id<RACSubscriber> subscriber) {\n\n    [subscriber sendNext:@\"hello1\"];\n    [subscriber sendNext:@\"hello2\"];\n    [subscriber sendNext:@\"hello3\"];\n    [subscriber sendNext:@\"hello4\"];\n    [subscriber sendNext:@\"hello5\"];\n    [subscriber sendCompleted];\n    return nil;\n\n}] takeLast:2];\n\n[signal subscribeNext:^(id value) {\n    NSLog(@\"%@\", value);\n}];\n```\n\n* throttle:节流，可以规定两个信号的间隔时间必须大于某个值\n* distinctUntilChanged:直到订阅的内容发生变化才会处理信号\n* ignore:忽略某些信号值\n\n```objectivec\nUITextField *textField = ({\n    UITextField *view = [[UITextField alloc] init];\n    [self.view addSubview:view];\n    [view mas_makeConstraints:^(MASConstraintMaker *make) {\n        make.center.equalTo(self.view);\n        make.size.mas_equalTo(CGSizeMake(200, 40));\n    }];\n    view.backgroundColor = [UIColor redColor];\n    view;\n});\n\n// 如果文字的改变速度过快，则不处理，两次信号间隔时间必须大于0.3秒\n[[[[[textField rac_textSignal] throttle:0.3] distinctUntilChanged] ignore:@\"\"] subscribeNext:^(id x) {\n    NSLog(@\"%@\", x);\n}];\n```\n\n* flattenMap:订阅的值为一个信号，将该信号转为订阅具体的值\n\n```objectivec\nUITextField *textField = ({\n    UITextField *view = [[UITextField alloc] init];\n    [self.view addSubview:view];\n    [view mas_makeConstraints:^(MASConstraintMaker *make) {\n        make.center.equalTo(self.view);\n        make.size.mas_equalTo(CGSizeMake(200, 40));\n    }];\n    view.backgroundColor = [UIColor redColor];\n    view;\n});\n\n[[[textField.rac_textSignal throttle:0.3] flattenMap:^id(id value) {\n    return [RACSignal createSignal:^RACDisposable *(id<RACSubscriber> subscriber) {\n        [subscriber sendNext:@\"aaa\"];\n        [subscriber sendCompleted];\n        return [RACDisposable disposableWithBlock:^{\n\n        }];\n    }];\n}] subscribeNext:^(id x) {\n    NSLog(@\"%@\", x);\n}];\n```\n\n* repeat:重复发送某个信号\n\n```objectivec\nRACSignal *signal = [[RACSignal createSignal:^RACDisposable *(id<RACSubscriber> subscriber) {\n        [subscriber sendNext:[NSDate date]];\n        [subscriber sendCompleted];\n        return nil;\n    }] repeat];\n\n    [signal subscribeNext:^(id x) {\n        NSLog(@\"%@\", x);\n    }];\n```\n\n* merge:同时订阅两个信号源，无论哪个发出信号，都会执行\n\n```objectivec\nRACSignal *signalA = [RACSignal createSignal:^RACDisposable *(id<RACSubscriber> subscriber) {\n      dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(2.0 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{\n          [subscriber sendNext:@\"1\"];\n          [subscriber sendCompleted];\n      });\n      return nil;\n  }];\n\n  RACSignal *signalB = [RACSignal createSignal:^RACDisposable *(id<RACSubscriber> subscriber) {\n      dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(3.0 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{\n          [subscriber sendNext:@\"2\"];\n          [subscriber sendCompleted];\n      });\n      return nil;\n  }];\n\n  [[signalA merge:signalB] subscribeNext:^(id x) {\n      NSLog(@\"%@\", x);\n  }];\n```\n\n* combineLatest:reduce:这是一个RACSignal的类方法，表示同时聚合多个信号\n\n```objectivec\nRACSignal *signalA = [RACSignal createSignal:^RACDisposable *(id<RACSubscriber> subscriber) {\n        dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(2.0 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{\n            [subscriber sendNext:@\"1\"];\n            [subscriber sendCompleted];\n        });\n        return nil;\n    }];\n\n    RACSignal *signalB = [RACSignal createSignal:^RACDisposable *(id<RACSubscriber> subscriber) {\n        dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(3.0 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{\n            [subscriber sendNext:@\"2\"];\n            [subscriber sendCompleted];\n        });\n        return nil;\n    }];\n\n    [[RACSignal combineLatest:@[signalA, signalB] reduce:^id(NSString *s1, NSString *s2){\n        NSLog(@\"s1=%@, s2=%@\", s1, s2);\n        return [NSString stringWithFormat:@\"%@%@\", s1, s2];\n    }] subscribeNext:^(id x) {\n        NSLog(@\"%@\", x);\n    }];\n```\n\n* concat:先订阅信号A，A执行完成后再订阅信号B\n\n```objectivec\nRACSignal *signalA = [RACSignal createSignal:^RACDisposable *(id<RACSubscriber> subscriber) {\n    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(2.0 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{\n        [subscriber sendNext:@\"1\"];\n        [subscriber sendCompleted];\n    });\n    return nil;\n}];\n\nRACSignal *signalB = [RACSignal createSignal:^RACDisposable *(id<RACSubscriber> subscriber) {\n    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(2.0 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{\n        [subscriber sendNext:@\"2\"];\n        [subscriber sendCompleted];\n    });\n    return nil;\n}];\n\n// 先订阅A，A执行完成后，再执行B，如果A失败了，不会再执行B\n[[signalA concat:signalB] subscribeNext:^(id x) {\n    NSLog(@\"%@\", x);\n}];\n```\n\n* zipWith:两个信号都发出后，再执行，也可以使用combineLatest:\n\n```objectivec\nRACSignal *signalA = [RACSignal createSignal:^RACDisposable *(id<RACSubscriber> subscriber) {\n    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(2.0 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{\n        [subscriber sendNext:@\"1\"];\n        [subscriber sendCompleted];\n    });\n    return nil;\n}];\n\nRACSignal *signalB = [RACSignal createSignal:^RACDisposable *(id<RACSubscriber> subscriber) {\n    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(3.0 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{\n        [subscriber sendNext:@\"2\"];\n        [subscriber sendCompleted];\n    });\n    return nil;\n}];\n\n[[signalA zipWith:signalB] subscribeNext:^(id x) {\n    // x是一个RACTuple，包含了signalA和signalB的值\n    NSLog(@\"%@\", x);\n}];\n```\n\n\n### RAC的坑\n\n* side effect: 一个信号源被多个订阅者订阅，每个订阅者收到的信号可能不一样。解决方法：使用reply\n\n```objectivec\nRACSignal *signalA = [[RACSignal createSignal:^RACDisposable *(id<RACSubscriber> subscriber) {\n    static int i = 0;\n    i++;\n    [subscriber sendNext:@(i)];\n    [subscriber sendCompleted];\n    return nil;\n}] replay];\n\n[signalA subscribeNext:^(id x) {\n    NSLog(@\"%@\", x);\n}];\n\n[signalA subscribeNext:^(id x) {\n    NSLog(@\"%@\", x);\n}];\n```\n","source":"_posts/2015-12-20-RAC学习笔记.md","raw":"---\nlayout: post\ntitle: \"RAC学习笔记\"\ncategories: \"iOS开发\"\n---\n## RAC简介\n\nRAC要解决的问题是传统ios中事件，通知，回调的机制十分的繁琐。\n\n## 常规用法\n\n### target-action\n\n* RAC可以替代一般的target-action操作，例如监测textField的文字的改变，不是用RAC的写法\n\n```objectivec\n- (void)viewDidLoad {\n    [super viewDidLoad];\n\n    UITextField *text = ({\n        UITextField *text = [[UITextField alloc] init];\n        [self.view addSubview:text];\n        [text mas_makeConstraints:^(MASConstraintMaker *make) {\n            make.center.equalTo(self.view);\n            make.size.mas_equalTo(CGSizeMake(200, 40));\n        }];\n        text.backgroundColor = [UIColor redColor];\n        [text addTarget:self action:@selector(textDidChange:) forControlEvents:UIControlEventEditingChanged];\n        text;\n    });\n}\n\n- (void)textDidChange:(UITextField *)sender {\n    NSLog(@\"did change: %@\", sender);\n}\n```\n\n* 使用RAC的写法：\n```objectivec\n- (void)viewDidLoad {\n    [super viewDidLoad];\n\n    UITextField *text = ({\n        UITextField *text = [[UITextField alloc] init];\n        [self.view addSubview:text];\n        [text mas_makeConstraints:^(MASConstraintMaker *make) {\n            make.center.equalTo(self.view);\n            make.size.mas_equalTo(CGSizeMake(200, 40));\n        }];\n        text.backgroundColor = [UIColor redColor];\n\n        [[text rac_signalForControlEvents:UIControlEventEditingChanged] subscribeNext:^(id x) {\n            NSLog(@\"%@\", x);\n        }];\n\n        // 或者\n        //[text.rac_textSignal subscribeNext:^(id x) {\n        //    NSLog(@\"%@\", x);\n        //}];\n\n        text;\n    });\n}\n```\n\n### 手势中使用RAC\n\n* RAC可以替换手势的方法，代码如下\n\n```objectivec\n- (void)viewDidLoad {\n    [super viewDidLoad];\n\n    self.view.userInteractionEnabled = YES;\n    UITapGestureRecognizer *tap = [[UITapGestureRecognizer alloc] init];\n    [[tap rac_gestureSignal] subscribeNext:^(id x) {\n        NSLog(@\"%@\", x);\n    }];\n    [self.view addGestureRecognizer:tap];\n}\n```\n\n### 通知\n\n* RAC可以代替通知，并且RAC的通知不用移出\n\n```objectivec\n- (void)viewDidLoad {\n    [super viewDidLoad];\n    [[[NSNotificationCenter defaultCenter] rac_addObserverForName:UIApplicationDidBecomeActiveNotification object:nil] subscribeNext:^(id x) {\n        NSLog(@\"%@\", x);\n    }];\n}\n```\n\n### 定制器\n\n* RAC可以代替定时器\n\n```objectivec\n- (void)viewDidLoad {\n    [super viewDidLoad];\n\n    // 延迟2秒执行\n    [[RACScheduler mainThreadScheduler] afterDelay:2.0 schedule:^{\n        NSLog(@\"haha\");\n    }];\n\n    // interval为间隔事件，scheduler为在那个线程上执行，leeway为多久之后开始执行。\n    [[RACSignal interval:2.0 onScheduler:[RACScheduler mainThreadScheduler] withLeeway:5.0] subscribeNext:^(NSDate x) {\n        NSLog(@\"%@\", x);\n    }];\n\n}\n```\n\n### 代理\n\n* RAC可以替换代理，但仅限没有返回值的代理\n\n```objectivec\n@interface ViewController ()<UITableViewDelegate>\n@property (nonatomic, strong) UIAlertView *alertView;\n\n@end\n\n@implementation ViewController\n\n- (void)viewDidLoad {\n    [super viewDidLoad];\n\n    self.alertView = [[UIAlertView alloc] initWithTitle:@\"RAC\" message:@\"test\" delegate:self cancelButtonTitle:@\"OK\" otherButtonTitles: nil];\n    [[self rac_signalForSelector:@selector(alertView:clickedButtonAtIndex:) fromProtocol:@protocol(UIAlertViewDelegate)]subscribeNext:^(id x) {\n        NSLog(@\"%@\",x);\n    }];\n    // 或者\n    // [[self.alertView rac_buttonClickedSignal] subscribeNext:^(id x) {\n    //     NSLog(@\"%@\", x);\n    // }];\n\n    [self.alertView show];\n}\n\n@end\n```\n\n### KVO\n\n* RAC可以替换KVO\n\n```objectivec\n@interface ViewController ()\n\n@property (nonatomic, assign) NSInteger index;\n@end\n\n@implementation ViewController\n\n- (void)viewDidLoad {\n    [super viewDidLoad];\n\n    [RACObserve(self, index) subscribeNext:^(id x) {\n        NSLog(@\"%@\", x);\n    }];\n\n}\n\n- (void)touchesBegan:(NSSet<UITouch *> *)touches withEvent:(UIEvent *)event {\n    self.index++;\n}\n\n@end\n```\n\n## 高级用法\n\n### 创建信号\n\n```objectivec\n- (void)viewDidLoad {\n    [super viewDidLoad];\n\n    RACSignal *signal = [RACSignal createSignal:^RACDisposable *(id<RACSubscriber> subscriber) {\n        NSURLRequest *req = [NSURLRequest requestWithURL:[NSURL URLWithString:@\"http://www.baidu.com\"]];\n        [NSURLConnection sendAsynchronousRequest:req queue:[NSOperationQueue mainQueue] completionHandler:^(NSURLResponse * _Nullable response, NSData * _Nullable data, NSError * _Nullable connectionError) {\n            if (connectionError) {\n                // 请求失败\n                [subscriber sendError:connectionError];\n            }\n            else {\n                // 请求成功\n                [subscriber sendNext:data];\n            }\n            [subscriber sendCompleted];\n        }];\n        return [RACDisposable disposableWithBlock:^{\n            // 取消订阅\n            NSLog(@\"cancel\");\n        }];\n    }];\n\n    RACDisposable *disposable = [signal subscribeNext:^(NSData *responseData) {\n        NSLog(@\"%@\", responseData);\n    } error:^(NSError *error) {\n        NSLog(@\"%@\", error);\n    } completed:^{\n        NSLog(@\"completed\");\n    }];\n\n    // 订阅完就取消订阅，这样就不会执行订阅block了\n    [disposable dispose];\n}\n```\n\n### 信号处理\n\n* map:映射\n* filter:过滤\n* delay:延时\n* startWith:在接收到信号前，先接收到一个信号\n\n```objectivec\n- (void)viewDidLoad {\n    [super viewDidLoad];\n\n    UITextField *textField = ({\n        UITextField *view = [[UITextField alloc] init];\n        [self.view addSubview:view];\n        [view mas_makeConstraints:^(MASConstraintMaker *make) {\n            make.center.equalTo(self.view);\n            make.size.mas_equalTo(CGSizeMake(200, 40));\n        }];\n        view.backgroundColor = [UIColor redColor];\n        view;\n    });\n\n    [[[[[[textField rac_textSignal] map:^id(id value) {\n        NSString *str = (NSString *)value;\n        return @([str length]);\n    }] filter:^BOOL(id value) {\n        return [value integerValue] > 3;\n    }] delay:2] startWith:@\"haha\"] subscribeNext:^(id x) {\n        NSLog(@\"%@\", x);\n    }];\n}\n```\n\n* timeout:超时\n\n```objectivec\nRACSignal *signal = [[RACSignal createSignal:^RACDisposable *(id<RACSubscriber> subscriber) {\n\n    [[RACScheduler mainThreadScheduler] afterDelay:1.0 schedule:^{\n        [subscriber sendNext:@\"hello\"];\n        [subscriber sendCompleted];\n    }];\n    return nil;\n\n}] timeout:2.0 onScheduler:[RACScheduler mainThreadScheduler]]; // 如果请求没有在2秒内完成，则请求超时，会调用errorBlock\n\n[signal subscribeNext:^(NSData *responseData) {\n    NSLog(@\"%@\", responseData);\n} error:^(NSError *error) {\n    NSLog(@\"%@\", error);\n} completed:^{\n    NSLog(@\"completed\");\n}];\n```\n\n* take:接收到多次信号，但只处理前几次信号\n* takeLast:只处理最后几次信号\n* skip:忽略几次\n* takeUntilBlock:返回YES可以表示不接收，返回NO表示接收该信号，与filter类似\n* takeWhileBlock:当返回一次YES后，就停止接收所有信号\n\n```objectivec\nRACSignal *signal = [[RACSignal createSignal:^RACDisposable *(id<RACSubscriber> subscriber) {\n\n    [subscriber sendNext:@\"hello1\"];\n    [subscriber sendNext:@\"hello2\"];\n    [subscriber sendNext:@\"hello3\"];\n    [subscriber sendNext:@\"hello4\"];\n    [subscriber sendNext:@\"hello5\"];\n    [subscriber sendCompleted];\n    return nil;\n\n}] takeLast:2];\n\n[signal subscribeNext:^(id value) {\n    NSLog(@\"%@\", value);\n}];\n```\n\n* throttle:节流，可以规定两个信号的间隔时间必须大于某个值\n* distinctUntilChanged:直到订阅的内容发生变化才会处理信号\n* ignore:忽略某些信号值\n\n```objectivec\nUITextField *textField = ({\n    UITextField *view = [[UITextField alloc] init];\n    [self.view addSubview:view];\n    [view mas_makeConstraints:^(MASConstraintMaker *make) {\n        make.center.equalTo(self.view);\n        make.size.mas_equalTo(CGSizeMake(200, 40));\n    }];\n    view.backgroundColor = [UIColor redColor];\n    view;\n});\n\n// 如果文字的改变速度过快，则不处理，两次信号间隔时间必须大于0.3秒\n[[[[[textField rac_textSignal] throttle:0.3] distinctUntilChanged] ignore:@\"\"] subscribeNext:^(id x) {\n    NSLog(@\"%@\", x);\n}];\n```\n\n* flattenMap:订阅的值为一个信号，将该信号转为订阅具体的值\n\n```objectivec\nUITextField *textField = ({\n    UITextField *view = [[UITextField alloc] init];\n    [self.view addSubview:view];\n    [view mas_makeConstraints:^(MASConstraintMaker *make) {\n        make.center.equalTo(self.view);\n        make.size.mas_equalTo(CGSizeMake(200, 40));\n    }];\n    view.backgroundColor = [UIColor redColor];\n    view;\n});\n\n[[[textField.rac_textSignal throttle:0.3] flattenMap:^id(id value) {\n    return [RACSignal createSignal:^RACDisposable *(id<RACSubscriber> subscriber) {\n        [subscriber sendNext:@\"aaa\"];\n        [subscriber sendCompleted];\n        return [RACDisposable disposableWithBlock:^{\n\n        }];\n    }];\n}] subscribeNext:^(id x) {\n    NSLog(@\"%@\", x);\n}];\n```\n\n* repeat:重复发送某个信号\n\n```objectivec\nRACSignal *signal = [[RACSignal createSignal:^RACDisposable *(id<RACSubscriber> subscriber) {\n        [subscriber sendNext:[NSDate date]];\n        [subscriber sendCompleted];\n        return nil;\n    }] repeat];\n\n    [signal subscribeNext:^(id x) {\n        NSLog(@\"%@\", x);\n    }];\n```\n\n* merge:同时订阅两个信号源，无论哪个发出信号，都会执行\n\n```objectivec\nRACSignal *signalA = [RACSignal createSignal:^RACDisposable *(id<RACSubscriber> subscriber) {\n      dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(2.0 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{\n          [subscriber sendNext:@\"1\"];\n          [subscriber sendCompleted];\n      });\n      return nil;\n  }];\n\n  RACSignal *signalB = [RACSignal createSignal:^RACDisposable *(id<RACSubscriber> subscriber) {\n      dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(3.0 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{\n          [subscriber sendNext:@\"2\"];\n          [subscriber sendCompleted];\n      });\n      return nil;\n  }];\n\n  [[signalA merge:signalB] subscribeNext:^(id x) {\n      NSLog(@\"%@\", x);\n  }];\n```\n\n* combineLatest:reduce:这是一个RACSignal的类方法，表示同时聚合多个信号\n\n```objectivec\nRACSignal *signalA = [RACSignal createSignal:^RACDisposable *(id<RACSubscriber> subscriber) {\n        dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(2.0 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{\n            [subscriber sendNext:@\"1\"];\n            [subscriber sendCompleted];\n        });\n        return nil;\n    }];\n\n    RACSignal *signalB = [RACSignal createSignal:^RACDisposable *(id<RACSubscriber> subscriber) {\n        dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(3.0 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{\n            [subscriber sendNext:@\"2\"];\n            [subscriber sendCompleted];\n        });\n        return nil;\n    }];\n\n    [[RACSignal combineLatest:@[signalA, signalB] reduce:^id(NSString *s1, NSString *s2){\n        NSLog(@\"s1=%@, s2=%@\", s1, s2);\n        return [NSString stringWithFormat:@\"%@%@\", s1, s2];\n    }] subscribeNext:^(id x) {\n        NSLog(@\"%@\", x);\n    }];\n```\n\n* concat:先订阅信号A，A执行完成后再订阅信号B\n\n```objectivec\nRACSignal *signalA = [RACSignal createSignal:^RACDisposable *(id<RACSubscriber> subscriber) {\n    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(2.0 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{\n        [subscriber sendNext:@\"1\"];\n        [subscriber sendCompleted];\n    });\n    return nil;\n}];\n\nRACSignal *signalB = [RACSignal createSignal:^RACDisposable *(id<RACSubscriber> subscriber) {\n    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(2.0 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{\n        [subscriber sendNext:@\"2\"];\n        [subscriber sendCompleted];\n    });\n    return nil;\n}];\n\n// 先订阅A，A执行完成后，再执行B，如果A失败了，不会再执行B\n[[signalA concat:signalB] subscribeNext:^(id x) {\n    NSLog(@\"%@\", x);\n}];\n```\n\n* zipWith:两个信号都发出后，再执行，也可以使用combineLatest:\n\n```objectivec\nRACSignal *signalA = [RACSignal createSignal:^RACDisposable *(id<RACSubscriber> subscriber) {\n    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(2.0 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{\n        [subscriber sendNext:@\"1\"];\n        [subscriber sendCompleted];\n    });\n    return nil;\n}];\n\nRACSignal *signalB = [RACSignal createSignal:^RACDisposable *(id<RACSubscriber> subscriber) {\n    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(3.0 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{\n        [subscriber sendNext:@\"2\"];\n        [subscriber sendCompleted];\n    });\n    return nil;\n}];\n\n[[signalA zipWith:signalB] subscribeNext:^(id x) {\n    // x是一个RACTuple，包含了signalA和signalB的值\n    NSLog(@\"%@\", x);\n}];\n```\n\n\n### RAC的坑\n\n* side effect: 一个信号源被多个订阅者订阅，每个订阅者收到的信号可能不一样。解决方法：使用reply\n\n```objectivec\nRACSignal *signalA = [[RACSignal createSignal:^RACDisposable *(id<RACSubscriber> subscriber) {\n    static int i = 0;\n    i++;\n    [subscriber sendNext:@(i)];\n    [subscriber sendCompleted];\n    return nil;\n}] replay];\n\n[signalA subscribeNext:^(id x) {\n    NSLog(@\"%@\", x);\n}];\n\n[signalA subscribeNext:^(id x) {\n    NSLog(@\"%@\", x);\n}];\n```\n","slug":"RAC学习笔记","published":1,"date":"2015-12-19T16:00:00.000Z","updated":"2017-03-01T06:42:53.000Z","comments":1,"photos":[],"link":"","_id":"cjutyfmj8006tc4c9ayofnbp9","content":"<h2 id=\"RAC简介\"><a href=\"#RAC简介\" class=\"headerlink\" title=\"RAC简介\"></a>RAC简介</h2><p>RAC要解决的问题是传统ios中事件，通知，回调的机制十分的繁琐。</p>\n<h2 id=\"常规用法\"><a href=\"#常规用法\" class=\"headerlink\" title=\"常规用法\"></a>常规用法</h2><h3 id=\"target-action\"><a href=\"#target-action\" class=\"headerlink\" title=\"target-action\"></a>target-action</h3><ul>\n<li>RAC可以替代一般的target-action操作，例如监测textField的文字的改变，不是用RAC的写法</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)viewDidLoad &#123;</span><br><span class=\"line\">    [<span class=\"keyword\">super</span> viewDidLoad];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">UITextField</span> *text = (&#123;</span><br><span class=\"line\">        <span class=\"built_in\">UITextField</span> *text = [[<span class=\"built_in\">UITextField</span> alloc] init];</span><br><span class=\"line\">        [<span class=\"keyword\">self</span>.view addSubview:text];</span><br><span class=\"line\">        [text mas_makeConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class=\"line\">            make.center.equalTo(<span class=\"keyword\">self</span>.view);</span><br><span class=\"line\">            make.size.mas_equalTo(<span class=\"built_in\">CGSizeMake</span>(<span class=\"number\">200</span>, <span class=\"number\">40</span>));</span><br><span class=\"line\">        &#125;];</span><br><span class=\"line\">        text.backgroundColor = [<span class=\"built_in\">UIColor</span> redColor];</span><br><span class=\"line\">        [text addTarget:<span class=\"keyword\">self</span> action:<span class=\"keyword\">@selector</span>(textDidChange:) forControlEvents:<span class=\"built_in\">UIControlEventEditingChanged</span>];</span><br><span class=\"line\">        text;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)textDidChange:(<span class=\"built_in\">UITextField</span> *)sender &#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"did change: %@\"</span>, sender);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>使用RAC的写法：<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)viewDidLoad &#123;</span><br><span class=\"line\">    [<span class=\"keyword\">super</span> viewDidLoad];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">UITextField</span> *text = (&#123;</span><br><span class=\"line\">        <span class=\"built_in\">UITextField</span> *text = [[<span class=\"built_in\">UITextField</span> alloc] init];</span><br><span class=\"line\">        [<span class=\"keyword\">self</span>.view addSubview:text];</span><br><span class=\"line\">        [text mas_makeConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class=\"line\">            make.center.equalTo(<span class=\"keyword\">self</span>.view);</span><br><span class=\"line\">            make.size.mas_equalTo(<span class=\"built_in\">CGSizeMake</span>(<span class=\"number\">200</span>, <span class=\"number\">40</span>));</span><br><span class=\"line\">        &#125;];</span><br><span class=\"line\">        text.backgroundColor = [<span class=\"built_in\">UIColor</span> redColor];</span><br><span class=\"line\"></span><br><span class=\"line\">        [[text rac_signalForControlEvents:<span class=\"built_in\">UIControlEventEditingChanged</span>] subscribeNext:^(<span class=\"keyword\">id</span> x) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%@\"</span>, x);</span><br><span class=\"line\">        &#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 或者</span></span><br><span class=\"line\">        <span class=\"comment\">//[text.rac_textSignal subscribeNext:^(id x) &#123;</span></span><br><span class=\"line\">        <span class=\"comment\">//    NSLog(@\"%@\", x);</span></span><br><span class=\"line\">        <span class=\"comment\">//&#125;];</span></span><br><span class=\"line\"></span><br><span class=\"line\">        text;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h3 id=\"手势中使用RAC\"><a href=\"#手势中使用RAC\" class=\"headerlink\" title=\"手势中使用RAC\"></a>手势中使用RAC</h3><ul>\n<li>RAC可以替换手势的方法，代码如下</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)viewDidLoad &#123;</span><br><span class=\"line\">    [<span class=\"keyword\">super</span> viewDidLoad];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">self</span>.view.userInteractionEnabled = <span class=\"literal\">YES</span>;</span><br><span class=\"line\">    <span class=\"built_in\">UITapGestureRecognizer</span> *tap = [[<span class=\"built_in\">UITapGestureRecognizer</span> alloc] init];</span><br><span class=\"line\">    [[tap rac_gestureSignal] subscribeNext:^(<span class=\"keyword\">id</span> x) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%@\"</span>, x);</span><br><span class=\"line\">    &#125;];</span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.view addGestureRecognizer:tap];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"通知\"><a href=\"#通知\" class=\"headerlink\" title=\"通知\"></a>通知</h3><ul>\n<li>RAC可以代替通知，并且RAC的通知不用移出</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)viewDidLoad &#123;</span><br><span class=\"line\">    [<span class=\"keyword\">super</span> viewDidLoad];</span><br><span class=\"line\">    [[[<span class=\"built_in\">NSNotificationCenter</span> defaultCenter] rac_addObserverForName:<span class=\"built_in\">UIApplicationDidBecomeActiveNotification</span> object:<span class=\"literal\">nil</span>] subscribeNext:^(<span class=\"keyword\">id</span> x) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%@\"</span>, x);</span><br><span class=\"line\">    &#125;];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"定制器\"><a href=\"#定制器\" class=\"headerlink\" title=\"定制器\"></a>定制器</h3><ul>\n<li>RAC可以代替定时器</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)viewDidLoad &#123;</span><br><span class=\"line\">    [<span class=\"keyword\">super</span> viewDidLoad];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 延迟2秒执行</span></span><br><span class=\"line\">    [[RACScheduler mainThreadScheduler] afterDelay:<span class=\"number\">2.0</span> schedule:^&#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"haha\"</span>);</span><br><span class=\"line\">    &#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// interval为间隔事件，scheduler为在那个线程上执行，leeway为多久之后开始执行。</span></span><br><span class=\"line\">    [[RACSignal interval:<span class=\"number\">2.0</span> onScheduler:[RACScheduler mainThreadScheduler] withLeeway:<span class=\"number\">5.0</span>] subscribeNext:^(<span class=\"built_in\">NSDate</span> x) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%@\"</span>, x);</span><br><span class=\"line\">    &#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"代理\"><a href=\"#代理\" class=\"headerlink\" title=\"代理\"></a>代理</h3><ul>\n<li>RAC可以替换代理，但仅限没有返回值的代理</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">ViewController</span> ()&lt;<span class=\"title\">UITableViewDelegate</span>&gt;</span></span><br><span class=\"line\"><span class=\"keyword\">@property</span> (<span class=\"keyword\">nonatomic</span>, <span class=\"keyword\">strong</span>) <span class=\"built_in\">UIAlertView</span> *alertView;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">ViewController</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)viewDidLoad &#123;</span><br><span class=\"line\">    [<span class=\"keyword\">super</span> viewDidLoad];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">self</span>.alertView = [[<span class=\"built_in\">UIAlertView</span> alloc] initWithTitle:<span class=\"string\">@\"RAC\"</span> message:<span class=\"string\">@\"test\"</span> delegate:<span class=\"keyword\">self</span> cancelButtonTitle:<span class=\"string\">@\"OK\"</span> otherButtonTitles: <span class=\"literal\">nil</span>];</span><br><span class=\"line\">    [[<span class=\"keyword\">self</span> rac_signalForSelector:<span class=\"keyword\">@selector</span>(alertView:clickedButtonAtIndex:) fromProtocol:<span class=\"class\"><span class=\"keyword\">@protocol</span>(<span class=\"title\">UIAlertViewDelegate</span>)]<span class=\"title\">subscribeNext</span>:^(<span class=\"title\">id</span> <span class=\"title\">x</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%@\"</span>,x);</span><br><span class=\"line\">    &#125;];</span><br><span class=\"line\">    <span class=\"comment\">// 或者</span></span><br><span class=\"line\">    <span class=\"comment\">// [[self.alertView rac_buttonClickedSignal] subscribeNext:^(id x) &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">//     NSLog(@\"%@\", x);</span></span><br><span class=\"line\">    <span class=\"comment\">// &#125;];</span></span><br><span class=\"line\"></span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.alertView show];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"KVO\"><a href=\"#KVO\" class=\"headerlink\" title=\"KVO\"></a>KVO</h3><ul>\n<li>RAC可以替换KVO</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">ViewController</span> ()</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@property</span> (<span class=\"keyword\">nonatomic</span>, <span class=\"keyword\">assign</span>) <span class=\"built_in\">NSInteger</span> index;</span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">ViewController</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)viewDidLoad &#123;</span><br><span class=\"line\">    [<span class=\"keyword\">super</span> viewDidLoad];</span><br><span class=\"line\"></span><br><span class=\"line\">    [RACObserve(<span class=\"keyword\">self</span>, index) subscribeNext:^(<span class=\"keyword\">id</span> x) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%@\"</span>, x);</span><br><span class=\"line\">    &#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)touchesBegan:(<span class=\"built_in\">NSSet</span>&lt;<span class=\"built_in\">UITouch</span> *&gt; *)touches withEvent:(<span class=\"built_in\">UIEvent</span> *)event &#123;</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.index++;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"高级用法\"><a href=\"#高级用法\" class=\"headerlink\" title=\"高级用法\"></a>高级用法</h2><h3 id=\"创建信号\"><a href=\"#创建信号\" class=\"headerlink\" title=\"创建信号\"></a>创建信号</h3><figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)viewDidLoad &#123;</span><br><span class=\"line\">    [<span class=\"keyword\">super</span> viewDidLoad];</span><br><span class=\"line\"></span><br><span class=\"line\">    RACSignal *signal = [RACSignal createSignal:^RACDisposable *(<span class=\"keyword\">id</span>&lt;RACSubscriber&gt; subscriber) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSURLRequest</span> *req = [<span class=\"built_in\">NSURLRequest</span> requestWithURL:[<span class=\"built_in\">NSURL</span> URLWithString:<span class=\"string\">@\"http://www.baidu.com\"</span>]];</span><br><span class=\"line\">        [<span class=\"built_in\">NSURLConnection</span> sendAsynchronousRequest:req queue:[<span class=\"built_in\">NSOperationQueue</span> mainQueue] completionHandler:^(<span class=\"built_in\">NSURLResponse</span> * _Nullable response, <span class=\"built_in\">NSData</span> * _Nullable data, <span class=\"built_in\">NSError</span> * _Nullable connectionError) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (connectionError) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 请求失败</span></span><br><span class=\"line\">                [subscriber sendError:connectionError];</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 请求成功</span></span><br><span class=\"line\">                [subscriber sendNext:data];</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            [subscriber sendCompleted];</span><br><span class=\"line\">        &#125;];</span><br><span class=\"line\">        <span class=\"keyword\">return</span> [RACDisposable disposableWithBlock:^&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 取消订阅</span></span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"cancel\"</span>);</span><br><span class=\"line\">        &#125;];</span><br><span class=\"line\">    &#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">    RACDisposable *disposable = [signal subscribeNext:^(<span class=\"built_in\">NSData</span> *responseData) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%@\"</span>, responseData);</span><br><span class=\"line\">    &#125; error:^(<span class=\"built_in\">NSError</span> *error) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%@\"</span>, error);</span><br><span class=\"line\">    &#125; completed:^&#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"completed\"</span>);</span><br><span class=\"line\">    &#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 订阅完就取消订阅，这样就不会执行订阅block了</span></span><br><span class=\"line\">    [disposable dispose];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"信号处理\"><a href=\"#信号处理\" class=\"headerlink\" title=\"信号处理\"></a>信号处理</h3><ul>\n<li>map:映射</li>\n<li>filter:过滤</li>\n<li>delay:延时</li>\n<li>startWith:在接收到信号前，先接收到一个信号</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)viewDidLoad &#123;</span><br><span class=\"line\">    [<span class=\"keyword\">super</span> viewDidLoad];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">UITextField</span> *textField = (&#123;</span><br><span class=\"line\">        <span class=\"built_in\">UITextField</span> *view = [[<span class=\"built_in\">UITextField</span> alloc] init];</span><br><span class=\"line\">        [<span class=\"keyword\">self</span>.view addSubview:view];</span><br><span class=\"line\">        [view mas_makeConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class=\"line\">            make.center.equalTo(<span class=\"keyword\">self</span>.view);</span><br><span class=\"line\">            make.size.mas_equalTo(<span class=\"built_in\">CGSizeMake</span>(<span class=\"number\">200</span>, <span class=\"number\">40</span>));</span><br><span class=\"line\">        &#125;];</span><br><span class=\"line\">        view.backgroundColor = [<span class=\"built_in\">UIColor</span> redColor];</span><br><span class=\"line\">        view;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    [[[[[[textField rac_textSignal] map:^<span class=\"keyword\">id</span>(<span class=\"keyword\">id</span> value) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSString</span> *str = (<span class=\"built_in\">NSString</span> *)value;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> @([str length]);</span><br><span class=\"line\">    &#125;] filter:^<span class=\"built_in\">BOOL</span>(<span class=\"keyword\">id</span> value) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> [value integerValue] &gt; <span class=\"number\">3</span>;</span><br><span class=\"line\">    &#125;] delay:<span class=\"number\">2</span>] startWith:<span class=\"string\">@\"haha\"</span>] subscribeNext:^(<span class=\"keyword\">id</span> x) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%@\"</span>, x);</span><br><span class=\"line\">    &#125;];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>timeout:超时</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">RACSignal *signal = [[RACSignal createSignal:^RACDisposable *(<span class=\"keyword\">id</span>&lt;RACSubscriber&gt; subscriber) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    [[RACScheduler mainThreadScheduler] afterDelay:<span class=\"number\">1.0</span> schedule:^&#123;</span><br><span class=\"line\">        [subscriber sendNext:<span class=\"string\">@\"hello\"</span>];</span><br><span class=\"line\">        [subscriber sendCompleted];</span><br><span class=\"line\">    &#125;];</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">nil</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;] timeout:<span class=\"number\">2.0</span> onScheduler:[RACScheduler mainThreadScheduler]]; <span class=\"comment\">// 如果请求没有在2秒内完成，则请求超时，会调用errorBlock</span></span><br><span class=\"line\"></span><br><span class=\"line\">[signal subscribeNext:^(<span class=\"built_in\">NSData</span> *responseData) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%@\"</span>, responseData);</span><br><span class=\"line\">&#125; error:^(<span class=\"built_in\">NSError</span> *error) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%@\"</span>, error);</span><br><span class=\"line\">&#125; completed:^&#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"completed\"</span>);</span><br><span class=\"line\">&#125;];</span><br></pre></td></tr></table></figure>\n<ul>\n<li>take:接收到多次信号，但只处理前几次信号</li>\n<li>takeLast:只处理最后几次信号</li>\n<li>skip:忽略几次</li>\n<li>takeUntilBlock:返回YES可以表示不接收，返回NO表示接收该信号，与filter类似</li>\n<li>takeWhileBlock:当返回一次YES后，就停止接收所有信号</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">RACSignal *signal = [[RACSignal createSignal:^RACDisposable *(<span class=\"keyword\">id</span>&lt;RACSubscriber&gt; subscriber) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    [subscriber sendNext:<span class=\"string\">@\"hello1\"</span>];</span><br><span class=\"line\">    [subscriber sendNext:<span class=\"string\">@\"hello2\"</span>];</span><br><span class=\"line\">    [subscriber sendNext:<span class=\"string\">@\"hello3\"</span>];</span><br><span class=\"line\">    [subscriber sendNext:<span class=\"string\">@\"hello4\"</span>];</span><br><span class=\"line\">    [subscriber sendNext:<span class=\"string\">@\"hello5\"</span>];</span><br><span class=\"line\">    [subscriber sendCompleted];</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">nil</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;] takeLast:<span class=\"number\">2</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">[signal subscribeNext:^(<span class=\"keyword\">id</span> value) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%@\"</span>, value);</span><br><span class=\"line\">&#125;];</span><br></pre></td></tr></table></figure>\n<ul>\n<li>throttle:节流，可以规定两个信号的间隔时间必须大于某个值</li>\n<li>distinctUntilChanged:直到订阅的内容发生变化才会处理信号</li>\n<li>ignore:忽略某些信号值</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">UITextField</span> *textField = (&#123;</span><br><span class=\"line\">    <span class=\"built_in\">UITextField</span> *view = [[<span class=\"built_in\">UITextField</span> alloc] init];</span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.view addSubview:view];</span><br><span class=\"line\">    [view mas_makeConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class=\"line\">        make.center.equalTo(<span class=\"keyword\">self</span>.view);</span><br><span class=\"line\">        make.size.mas_equalTo(<span class=\"built_in\">CGSizeMake</span>(<span class=\"number\">200</span>, <span class=\"number\">40</span>));</span><br><span class=\"line\">    &#125;];</span><br><span class=\"line\">    view.backgroundColor = [<span class=\"built_in\">UIColor</span> redColor];</span><br><span class=\"line\">    view;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 如果文字的改变速度过快，则不处理，两次信号间隔时间必须大于0.3秒</span></span><br><span class=\"line\">[[[[[textField rac_textSignal] throttle:<span class=\"number\">0.3</span>] distinctUntilChanged] ignore:<span class=\"string\">@\"\"</span>] subscribeNext:^(<span class=\"keyword\">id</span> x) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%@\"</span>, x);</span><br><span class=\"line\">&#125;];</span><br></pre></td></tr></table></figure>\n<ul>\n<li>flattenMap:订阅的值为一个信号，将该信号转为订阅具体的值</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">UITextField</span> *textField = (&#123;</span><br><span class=\"line\">    <span class=\"built_in\">UITextField</span> *view = [[<span class=\"built_in\">UITextField</span> alloc] init];</span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.view addSubview:view];</span><br><span class=\"line\">    [view mas_makeConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class=\"line\">        make.center.equalTo(<span class=\"keyword\">self</span>.view);</span><br><span class=\"line\">        make.size.mas_equalTo(<span class=\"built_in\">CGSizeMake</span>(<span class=\"number\">200</span>, <span class=\"number\">40</span>));</span><br><span class=\"line\">    &#125;];</span><br><span class=\"line\">    view.backgroundColor = [<span class=\"built_in\">UIColor</span> redColor];</span><br><span class=\"line\">    view;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">[[[textField.rac_textSignal throttle:<span class=\"number\">0.3</span>] flattenMap:^<span class=\"keyword\">id</span>(<span class=\"keyword\">id</span> value) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> [RACSignal createSignal:^RACDisposable *(<span class=\"keyword\">id</span>&lt;RACSubscriber&gt; subscriber) &#123;</span><br><span class=\"line\">        [subscriber sendNext:<span class=\"string\">@\"aaa\"</span>];</span><br><span class=\"line\">        [subscriber sendCompleted];</span><br><span class=\"line\">        <span class=\"keyword\">return</span> [RACDisposable disposableWithBlock:^&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;];</span><br><span class=\"line\">    &#125;];</span><br><span class=\"line\">&#125;] subscribeNext:^(<span class=\"keyword\">id</span> x) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%@\"</span>, x);</span><br><span class=\"line\">&#125;];</span><br></pre></td></tr></table></figure>\n<ul>\n<li>repeat:重复发送某个信号</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">RACSignal *signal = [[RACSignal createSignal:^RACDisposable *(<span class=\"keyword\">id</span>&lt;RACSubscriber&gt; subscriber) &#123;</span><br><span class=\"line\">        [subscriber sendNext:[<span class=\"built_in\">NSDate</span> date]];</span><br><span class=\"line\">        [subscriber sendCompleted];</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">nil</span>;</span><br><span class=\"line\">    &#125;] repeat];</span><br><span class=\"line\"></span><br><span class=\"line\">    [signal subscribeNext:^(<span class=\"keyword\">id</span> x) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%@\"</span>, x);</span><br><span class=\"line\">    &#125;];</span><br></pre></td></tr></table></figure>\n<ul>\n<li>merge:同时订阅两个信号源，无论哪个发出信号，都会执行</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">RACSignal *signalA = [RACSignal createSignal:^RACDisposable *(<span class=\"keyword\">id</span>&lt;RACSubscriber&gt; subscriber) &#123;</span><br><span class=\"line\">      dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class=\"number\">2.0</span> * <span class=\"built_in\">NSEC_PER_SEC</span>)), dispatch_get_main_queue(), ^&#123;</span><br><span class=\"line\">          [subscriber sendNext:<span class=\"string\">@\"1\"</span>];</span><br><span class=\"line\">          [subscriber sendCompleted];</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">nil</span>;</span><br><span class=\"line\">  &#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">  RACSignal *signalB = [RACSignal createSignal:^RACDisposable *(<span class=\"keyword\">id</span>&lt;RACSubscriber&gt; subscriber) &#123;</span><br><span class=\"line\">      dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class=\"number\">3.0</span> * <span class=\"built_in\">NSEC_PER_SEC</span>)), dispatch_get_main_queue(), ^&#123;</span><br><span class=\"line\">          [subscriber sendNext:<span class=\"string\">@\"2\"</span>];</span><br><span class=\"line\">          [subscriber sendCompleted];</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">nil</span>;</span><br><span class=\"line\">  &#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">  [[signalA merge:signalB] subscribeNext:^(<span class=\"keyword\">id</span> x) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%@\"</span>, x);</span><br><span class=\"line\">  &#125;];</span><br></pre></td></tr></table></figure>\n<ul>\n<li>combineLatest:reduce:这是一个RACSignal的类方法，表示同时聚合多个信号</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">RACSignal *signalA = [RACSignal createSignal:^RACDisposable *(<span class=\"keyword\">id</span>&lt;RACSubscriber&gt; subscriber) &#123;</span><br><span class=\"line\">        dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class=\"number\">2.0</span> * <span class=\"built_in\">NSEC_PER_SEC</span>)), dispatch_get_main_queue(), ^&#123;</span><br><span class=\"line\">            [subscriber sendNext:<span class=\"string\">@\"1\"</span>];</span><br><span class=\"line\">            [subscriber sendCompleted];</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">nil</span>;</span><br><span class=\"line\">    &#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">    RACSignal *signalB = [RACSignal createSignal:^RACDisposable *(<span class=\"keyword\">id</span>&lt;RACSubscriber&gt; subscriber) &#123;</span><br><span class=\"line\">        dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class=\"number\">3.0</span> * <span class=\"built_in\">NSEC_PER_SEC</span>)), dispatch_get_main_queue(), ^&#123;</span><br><span class=\"line\">            [subscriber sendNext:<span class=\"string\">@\"2\"</span>];</span><br><span class=\"line\">            [subscriber sendCompleted];</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">nil</span>;</span><br><span class=\"line\">    &#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">    [[RACSignal combineLatest:@[signalA, signalB] reduce:^<span class=\"keyword\">id</span>(<span class=\"built_in\">NSString</span> *s1, <span class=\"built_in\">NSString</span> *s2)&#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"s1=%@, s2=%@\"</span>, s1, s2);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> [<span class=\"built_in\">NSString</span> stringWithFormat:<span class=\"string\">@\"%@%@\"</span>, s1, s2];</span><br><span class=\"line\">    &#125;] subscribeNext:^(<span class=\"keyword\">id</span> x) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%@\"</span>, x);</span><br><span class=\"line\">    &#125;];</span><br></pre></td></tr></table></figure>\n<ul>\n<li>concat:先订阅信号A，A执行完成后再订阅信号B</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">RACSignal *signalA = [RACSignal createSignal:^RACDisposable *(<span class=\"keyword\">id</span>&lt;RACSubscriber&gt; subscriber) &#123;</span><br><span class=\"line\">    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class=\"number\">2.0</span> * <span class=\"built_in\">NSEC_PER_SEC</span>)), dispatch_get_main_queue(), ^&#123;</span><br><span class=\"line\">        [subscriber sendNext:<span class=\"string\">@\"1\"</span>];</span><br><span class=\"line\">        [subscriber sendCompleted];</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">nil</span>;</span><br><span class=\"line\">&#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">RACSignal *signalB = [RACSignal createSignal:^RACDisposable *(<span class=\"keyword\">id</span>&lt;RACSubscriber&gt; subscriber) &#123;</span><br><span class=\"line\">    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class=\"number\">2.0</span> * <span class=\"built_in\">NSEC_PER_SEC</span>)), dispatch_get_main_queue(), ^&#123;</span><br><span class=\"line\">        [subscriber sendNext:<span class=\"string\">@\"2\"</span>];</span><br><span class=\"line\">        [subscriber sendCompleted];</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">nil</span>;</span><br><span class=\"line\">&#125;];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 先订阅A，A执行完成后，再执行B，如果A失败了，不会再执行B</span></span><br><span class=\"line\">[[signalA concat:signalB] subscribeNext:^(<span class=\"keyword\">id</span> x) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%@\"</span>, x);</span><br><span class=\"line\">&#125;];</span><br></pre></td></tr></table></figure>\n<ul>\n<li>zipWith:两个信号都发出后，再执行，也可以使用combineLatest:</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">RACSignal *signalA = [RACSignal createSignal:^RACDisposable *(<span class=\"keyword\">id</span>&lt;RACSubscriber&gt; subscriber) &#123;</span><br><span class=\"line\">    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class=\"number\">2.0</span> * <span class=\"built_in\">NSEC_PER_SEC</span>)), dispatch_get_main_queue(), ^&#123;</span><br><span class=\"line\">        [subscriber sendNext:<span class=\"string\">@\"1\"</span>];</span><br><span class=\"line\">        [subscriber sendCompleted];</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">nil</span>;</span><br><span class=\"line\">&#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">RACSignal *signalB = [RACSignal createSignal:^RACDisposable *(<span class=\"keyword\">id</span>&lt;RACSubscriber&gt; subscriber) &#123;</span><br><span class=\"line\">    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class=\"number\">3.0</span> * <span class=\"built_in\">NSEC_PER_SEC</span>)), dispatch_get_main_queue(), ^&#123;</span><br><span class=\"line\">        [subscriber sendNext:<span class=\"string\">@\"2\"</span>];</span><br><span class=\"line\">        [subscriber sendCompleted];</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">nil</span>;</span><br><span class=\"line\">&#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">[[signalA zipWith:signalB] subscribeNext:^(<span class=\"keyword\">id</span> x) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// x是一个RACTuple，包含了signalA和signalB的值</span></span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%@\"</span>, x);</span><br><span class=\"line\">&#125;];</span><br></pre></td></tr></table></figure>\n<h3 id=\"RAC的坑\"><a href=\"#RAC的坑\" class=\"headerlink\" title=\"RAC的坑\"></a>RAC的坑</h3><ul>\n<li>side effect: 一个信号源被多个订阅者订阅，每个订阅者收到的信号可能不一样。解决方法：使用reply</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">RACSignal *signalA = [[RACSignal createSignal:^RACDisposable *(<span class=\"keyword\">id</span>&lt;RACSubscriber&gt; subscriber) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">int</span> i = <span class=\"number\">0</span>;</span><br><span class=\"line\">    i++;</span><br><span class=\"line\">    [subscriber sendNext:@(i)];</span><br><span class=\"line\">    [subscriber sendCompleted];</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">nil</span>;</span><br><span class=\"line\">&#125;] replay];</span><br><span class=\"line\"></span><br><span class=\"line\">[signalA subscribeNext:^(<span class=\"keyword\">id</span> x) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%@\"</span>, x);</span><br><span class=\"line\">&#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">[signalA subscribeNext:^(<span class=\"keyword\">id</span> x) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%@\"</span>, x);</span><br><span class=\"line\">&#125;];</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"RAC简介\"><a href=\"#RAC简介\" class=\"headerlink\" title=\"RAC简介\"></a>RAC简介</h2><p>RAC要解决的问题是传统ios中事件，通知，回调的机制十分的繁琐。</p>\n<h2 id=\"常规用法\"><a href=\"#常规用法\" class=\"headerlink\" title=\"常规用法\"></a>常规用法</h2><h3 id=\"target-action\"><a href=\"#target-action\" class=\"headerlink\" title=\"target-action\"></a>target-action</h3><ul>\n<li>RAC可以替代一般的target-action操作，例如监测textField的文字的改变，不是用RAC的写法</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)viewDidLoad &#123;</span><br><span class=\"line\">    [<span class=\"keyword\">super</span> viewDidLoad];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">UITextField</span> *text = (&#123;</span><br><span class=\"line\">        <span class=\"built_in\">UITextField</span> *text = [[<span class=\"built_in\">UITextField</span> alloc] init];</span><br><span class=\"line\">        [<span class=\"keyword\">self</span>.view addSubview:text];</span><br><span class=\"line\">        [text mas_makeConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class=\"line\">            make.center.equalTo(<span class=\"keyword\">self</span>.view);</span><br><span class=\"line\">            make.size.mas_equalTo(<span class=\"built_in\">CGSizeMake</span>(<span class=\"number\">200</span>, <span class=\"number\">40</span>));</span><br><span class=\"line\">        &#125;];</span><br><span class=\"line\">        text.backgroundColor = [<span class=\"built_in\">UIColor</span> redColor];</span><br><span class=\"line\">        [text addTarget:<span class=\"keyword\">self</span> action:<span class=\"keyword\">@selector</span>(textDidChange:) forControlEvents:<span class=\"built_in\">UIControlEventEditingChanged</span>];</span><br><span class=\"line\">        text;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)textDidChange:(<span class=\"built_in\">UITextField</span> *)sender &#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"did change: %@\"</span>, sender);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>使用RAC的写法：<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)viewDidLoad &#123;</span><br><span class=\"line\">    [<span class=\"keyword\">super</span> viewDidLoad];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">UITextField</span> *text = (&#123;</span><br><span class=\"line\">        <span class=\"built_in\">UITextField</span> *text = [[<span class=\"built_in\">UITextField</span> alloc] init];</span><br><span class=\"line\">        [<span class=\"keyword\">self</span>.view addSubview:text];</span><br><span class=\"line\">        [text mas_makeConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class=\"line\">            make.center.equalTo(<span class=\"keyword\">self</span>.view);</span><br><span class=\"line\">            make.size.mas_equalTo(<span class=\"built_in\">CGSizeMake</span>(<span class=\"number\">200</span>, <span class=\"number\">40</span>));</span><br><span class=\"line\">        &#125;];</span><br><span class=\"line\">        text.backgroundColor = [<span class=\"built_in\">UIColor</span> redColor];</span><br><span class=\"line\"></span><br><span class=\"line\">        [[text rac_signalForControlEvents:<span class=\"built_in\">UIControlEventEditingChanged</span>] subscribeNext:^(<span class=\"keyword\">id</span> x) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%@\"</span>, x);</span><br><span class=\"line\">        &#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 或者</span></span><br><span class=\"line\">        <span class=\"comment\">//[text.rac_textSignal subscribeNext:^(id x) &#123;</span></span><br><span class=\"line\">        <span class=\"comment\">//    NSLog(@\"%@\", x);</span></span><br><span class=\"line\">        <span class=\"comment\">//&#125;];</span></span><br><span class=\"line\"></span><br><span class=\"line\">        text;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h3 id=\"手势中使用RAC\"><a href=\"#手势中使用RAC\" class=\"headerlink\" title=\"手势中使用RAC\"></a>手势中使用RAC</h3><ul>\n<li>RAC可以替换手势的方法，代码如下</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)viewDidLoad &#123;</span><br><span class=\"line\">    [<span class=\"keyword\">super</span> viewDidLoad];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">self</span>.view.userInteractionEnabled = <span class=\"literal\">YES</span>;</span><br><span class=\"line\">    <span class=\"built_in\">UITapGestureRecognizer</span> *tap = [[<span class=\"built_in\">UITapGestureRecognizer</span> alloc] init];</span><br><span class=\"line\">    [[tap rac_gestureSignal] subscribeNext:^(<span class=\"keyword\">id</span> x) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%@\"</span>, x);</span><br><span class=\"line\">    &#125;];</span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.view addGestureRecognizer:tap];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"通知\"><a href=\"#通知\" class=\"headerlink\" title=\"通知\"></a>通知</h3><ul>\n<li>RAC可以代替通知，并且RAC的通知不用移出</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)viewDidLoad &#123;</span><br><span class=\"line\">    [<span class=\"keyword\">super</span> viewDidLoad];</span><br><span class=\"line\">    [[[<span class=\"built_in\">NSNotificationCenter</span> defaultCenter] rac_addObserverForName:<span class=\"built_in\">UIApplicationDidBecomeActiveNotification</span> object:<span class=\"literal\">nil</span>] subscribeNext:^(<span class=\"keyword\">id</span> x) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%@\"</span>, x);</span><br><span class=\"line\">    &#125;];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"定制器\"><a href=\"#定制器\" class=\"headerlink\" title=\"定制器\"></a>定制器</h3><ul>\n<li>RAC可以代替定时器</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)viewDidLoad &#123;</span><br><span class=\"line\">    [<span class=\"keyword\">super</span> viewDidLoad];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 延迟2秒执行</span></span><br><span class=\"line\">    [[RACScheduler mainThreadScheduler] afterDelay:<span class=\"number\">2.0</span> schedule:^&#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"haha\"</span>);</span><br><span class=\"line\">    &#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// interval为间隔事件，scheduler为在那个线程上执行，leeway为多久之后开始执行。</span></span><br><span class=\"line\">    [[RACSignal interval:<span class=\"number\">2.0</span> onScheduler:[RACScheduler mainThreadScheduler] withLeeway:<span class=\"number\">5.0</span>] subscribeNext:^(<span class=\"built_in\">NSDate</span> x) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%@\"</span>, x);</span><br><span class=\"line\">    &#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"代理\"><a href=\"#代理\" class=\"headerlink\" title=\"代理\"></a>代理</h3><ul>\n<li>RAC可以替换代理，但仅限没有返回值的代理</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">ViewController</span> ()&lt;<span class=\"title\">UITableViewDelegate</span>&gt;</span></span><br><span class=\"line\"><span class=\"keyword\">@property</span> (<span class=\"keyword\">nonatomic</span>, <span class=\"keyword\">strong</span>) <span class=\"built_in\">UIAlertView</span> *alertView;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">ViewController</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)viewDidLoad &#123;</span><br><span class=\"line\">    [<span class=\"keyword\">super</span> viewDidLoad];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">self</span>.alertView = [[<span class=\"built_in\">UIAlertView</span> alloc] initWithTitle:<span class=\"string\">@\"RAC\"</span> message:<span class=\"string\">@\"test\"</span> delegate:<span class=\"keyword\">self</span> cancelButtonTitle:<span class=\"string\">@\"OK\"</span> otherButtonTitles: <span class=\"literal\">nil</span>];</span><br><span class=\"line\">    [[<span class=\"keyword\">self</span> rac_signalForSelector:<span class=\"keyword\">@selector</span>(alertView:clickedButtonAtIndex:) fromProtocol:<span class=\"class\"><span class=\"keyword\">@protocol</span>(<span class=\"title\">UIAlertViewDelegate</span>)]<span class=\"title\">subscribeNext</span>:^(<span class=\"title\">id</span> <span class=\"title\">x</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%@\"</span>,x);</span><br><span class=\"line\">    &#125;];</span><br><span class=\"line\">    <span class=\"comment\">// 或者</span></span><br><span class=\"line\">    <span class=\"comment\">// [[self.alertView rac_buttonClickedSignal] subscribeNext:^(id x) &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">//     NSLog(@\"%@\", x);</span></span><br><span class=\"line\">    <span class=\"comment\">// &#125;];</span></span><br><span class=\"line\"></span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.alertView show];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"KVO\"><a href=\"#KVO\" class=\"headerlink\" title=\"KVO\"></a>KVO</h3><ul>\n<li>RAC可以替换KVO</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">ViewController</span> ()</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@property</span> (<span class=\"keyword\">nonatomic</span>, <span class=\"keyword\">assign</span>) <span class=\"built_in\">NSInteger</span> index;</span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">ViewController</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)viewDidLoad &#123;</span><br><span class=\"line\">    [<span class=\"keyword\">super</span> viewDidLoad];</span><br><span class=\"line\"></span><br><span class=\"line\">    [RACObserve(<span class=\"keyword\">self</span>, index) subscribeNext:^(<span class=\"keyword\">id</span> x) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%@\"</span>, x);</span><br><span class=\"line\">    &#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)touchesBegan:(<span class=\"built_in\">NSSet</span>&lt;<span class=\"built_in\">UITouch</span> *&gt; *)touches withEvent:(<span class=\"built_in\">UIEvent</span> *)event &#123;</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.index++;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"高级用法\"><a href=\"#高级用法\" class=\"headerlink\" title=\"高级用法\"></a>高级用法</h2><h3 id=\"创建信号\"><a href=\"#创建信号\" class=\"headerlink\" title=\"创建信号\"></a>创建信号</h3><figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)viewDidLoad &#123;</span><br><span class=\"line\">    [<span class=\"keyword\">super</span> viewDidLoad];</span><br><span class=\"line\"></span><br><span class=\"line\">    RACSignal *signal = [RACSignal createSignal:^RACDisposable *(<span class=\"keyword\">id</span>&lt;RACSubscriber&gt; subscriber) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSURLRequest</span> *req = [<span class=\"built_in\">NSURLRequest</span> requestWithURL:[<span class=\"built_in\">NSURL</span> URLWithString:<span class=\"string\">@\"http://www.baidu.com\"</span>]];</span><br><span class=\"line\">        [<span class=\"built_in\">NSURLConnection</span> sendAsynchronousRequest:req queue:[<span class=\"built_in\">NSOperationQueue</span> mainQueue] completionHandler:^(<span class=\"built_in\">NSURLResponse</span> * _Nullable response, <span class=\"built_in\">NSData</span> * _Nullable data, <span class=\"built_in\">NSError</span> * _Nullable connectionError) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (connectionError) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 请求失败</span></span><br><span class=\"line\">                [subscriber sendError:connectionError];</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 请求成功</span></span><br><span class=\"line\">                [subscriber sendNext:data];</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            [subscriber sendCompleted];</span><br><span class=\"line\">        &#125;];</span><br><span class=\"line\">        <span class=\"keyword\">return</span> [RACDisposable disposableWithBlock:^&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 取消订阅</span></span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"cancel\"</span>);</span><br><span class=\"line\">        &#125;];</span><br><span class=\"line\">    &#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">    RACDisposable *disposable = [signal subscribeNext:^(<span class=\"built_in\">NSData</span> *responseData) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%@\"</span>, responseData);</span><br><span class=\"line\">    &#125; error:^(<span class=\"built_in\">NSError</span> *error) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%@\"</span>, error);</span><br><span class=\"line\">    &#125; completed:^&#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"completed\"</span>);</span><br><span class=\"line\">    &#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 订阅完就取消订阅，这样就不会执行订阅block了</span></span><br><span class=\"line\">    [disposable dispose];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"信号处理\"><a href=\"#信号处理\" class=\"headerlink\" title=\"信号处理\"></a>信号处理</h3><ul>\n<li>map:映射</li>\n<li>filter:过滤</li>\n<li>delay:延时</li>\n<li>startWith:在接收到信号前，先接收到一个信号</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)viewDidLoad &#123;</span><br><span class=\"line\">    [<span class=\"keyword\">super</span> viewDidLoad];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">UITextField</span> *textField = (&#123;</span><br><span class=\"line\">        <span class=\"built_in\">UITextField</span> *view = [[<span class=\"built_in\">UITextField</span> alloc] init];</span><br><span class=\"line\">        [<span class=\"keyword\">self</span>.view addSubview:view];</span><br><span class=\"line\">        [view mas_makeConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class=\"line\">            make.center.equalTo(<span class=\"keyword\">self</span>.view);</span><br><span class=\"line\">            make.size.mas_equalTo(<span class=\"built_in\">CGSizeMake</span>(<span class=\"number\">200</span>, <span class=\"number\">40</span>));</span><br><span class=\"line\">        &#125;];</span><br><span class=\"line\">        view.backgroundColor = [<span class=\"built_in\">UIColor</span> redColor];</span><br><span class=\"line\">        view;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    [[[[[[textField rac_textSignal] map:^<span class=\"keyword\">id</span>(<span class=\"keyword\">id</span> value) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSString</span> *str = (<span class=\"built_in\">NSString</span> *)value;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> @([str length]);</span><br><span class=\"line\">    &#125;] filter:^<span class=\"built_in\">BOOL</span>(<span class=\"keyword\">id</span> value) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> [value integerValue] &gt; <span class=\"number\">3</span>;</span><br><span class=\"line\">    &#125;] delay:<span class=\"number\">2</span>] startWith:<span class=\"string\">@\"haha\"</span>] subscribeNext:^(<span class=\"keyword\">id</span> x) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%@\"</span>, x);</span><br><span class=\"line\">    &#125;];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>timeout:超时</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">RACSignal *signal = [[RACSignal createSignal:^RACDisposable *(<span class=\"keyword\">id</span>&lt;RACSubscriber&gt; subscriber) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    [[RACScheduler mainThreadScheduler] afterDelay:<span class=\"number\">1.0</span> schedule:^&#123;</span><br><span class=\"line\">        [subscriber sendNext:<span class=\"string\">@\"hello\"</span>];</span><br><span class=\"line\">        [subscriber sendCompleted];</span><br><span class=\"line\">    &#125;];</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">nil</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;] timeout:<span class=\"number\">2.0</span> onScheduler:[RACScheduler mainThreadScheduler]]; <span class=\"comment\">// 如果请求没有在2秒内完成，则请求超时，会调用errorBlock</span></span><br><span class=\"line\"></span><br><span class=\"line\">[signal subscribeNext:^(<span class=\"built_in\">NSData</span> *responseData) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%@\"</span>, responseData);</span><br><span class=\"line\">&#125; error:^(<span class=\"built_in\">NSError</span> *error) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%@\"</span>, error);</span><br><span class=\"line\">&#125; completed:^&#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"completed\"</span>);</span><br><span class=\"line\">&#125;];</span><br></pre></td></tr></table></figure>\n<ul>\n<li>take:接收到多次信号，但只处理前几次信号</li>\n<li>takeLast:只处理最后几次信号</li>\n<li>skip:忽略几次</li>\n<li>takeUntilBlock:返回YES可以表示不接收，返回NO表示接收该信号，与filter类似</li>\n<li>takeWhileBlock:当返回一次YES后，就停止接收所有信号</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">RACSignal *signal = [[RACSignal createSignal:^RACDisposable *(<span class=\"keyword\">id</span>&lt;RACSubscriber&gt; subscriber) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    [subscriber sendNext:<span class=\"string\">@\"hello1\"</span>];</span><br><span class=\"line\">    [subscriber sendNext:<span class=\"string\">@\"hello2\"</span>];</span><br><span class=\"line\">    [subscriber sendNext:<span class=\"string\">@\"hello3\"</span>];</span><br><span class=\"line\">    [subscriber sendNext:<span class=\"string\">@\"hello4\"</span>];</span><br><span class=\"line\">    [subscriber sendNext:<span class=\"string\">@\"hello5\"</span>];</span><br><span class=\"line\">    [subscriber sendCompleted];</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">nil</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;] takeLast:<span class=\"number\">2</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">[signal subscribeNext:^(<span class=\"keyword\">id</span> value) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%@\"</span>, value);</span><br><span class=\"line\">&#125;];</span><br></pre></td></tr></table></figure>\n<ul>\n<li>throttle:节流，可以规定两个信号的间隔时间必须大于某个值</li>\n<li>distinctUntilChanged:直到订阅的内容发生变化才会处理信号</li>\n<li>ignore:忽略某些信号值</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">UITextField</span> *textField = (&#123;</span><br><span class=\"line\">    <span class=\"built_in\">UITextField</span> *view = [[<span class=\"built_in\">UITextField</span> alloc] init];</span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.view addSubview:view];</span><br><span class=\"line\">    [view mas_makeConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class=\"line\">        make.center.equalTo(<span class=\"keyword\">self</span>.view);</span><br><span class=\"line\">        make.size.mas_equalTo(<span class=\"built_in\">CGSizeMake</span>(<span class=\"number\">200</span>, <span class=\"number\">40</span>));</span><br><span class=\"line\">    &#125;];</span><br><span class=\"line\">    view.backgroundColor = [<span class=\"built_in\">UIColor</span> redColor];</span><br><span class=\"line\">    view;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 如果文字的改变速度过快，则不处理，两次信号间隔时间必须大于0.3秒</span></span><br><span class=\"line\">[[[[[textField rac_textSignal] throttle:<span class=\"number\">0.3</span>] distinctUntilChanged] ignore:<span class=\"string\">@\"\"</span>] subscribeNext:^(<span class=\"keyword\">id</span> x) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%@\"</span>, x);</span><br><span class=\"line\">&#125;];</span><br></pre></td></tr></table></figure>\n<ul>\n<li>flattenMap:订阅的值为一个信号，将该信号转为订阅具体的值</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">UITextField</span> *textField = (&#123;</span><br><span class=\"line\">    <span class=\"built_in\">UITextField</span> *view = [[<span class=\"built_in\">UITextField</span> alloc] init];</span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.view addSubview:view];</span><br><span class=\"line\">    [view mas_makeConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class=\"line\">        make.center.equalTo(<span class=\"keyword\">self</span>.view);</span><br><span class=\"line\">        make.size.mas_equalTo(<span class=\"built_in\">CGSizeMake</span>(<span class=\"number\">200</span>, <span class=\"number\">40</span>));</span><br><span class=\"line\">    &#125;];</span><br><span class=\"line\">    view.backgroundColor = [<span class=\"built_in\">UIColor</span> redColor];</span><br><span class=\"line\">    view;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">[[[textField.rac_textSignal throttle:<span class=\"number\">0.3</span>] flattenMap:^<span class=\"keyword\">id</span>(<span class=\"keyword\">id</span> value) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> [RACSignal createSignal:^RACDisposable *(<span class=\"keyword\">id</span>&lt;RACSubscriber&gt; subscriber) &#123;</span><br><span class=\"line\">        [subscriber sendNext:<span class=\"string\">@\"aaa\"</span>];</span><br><span class=\"line\">        [subscriber sendCompleted];</span><br><span class=\"line\">        <span class=\"keyword\">return</span> [RACDisposable disposableWithBlock:^&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;];</span><br><span class=\"line\">    &#125;];</span><br><span class=\"line\">&#125;] subscribeNext:^(<span class=\"keyword\">id</span> x) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%@\"</span>, x);</span><br><span class=\"line\">&#125;];</span><br></pre></td></tr></table></figure>\n<ul>\n<li>repeat:重复发送某个信号</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">RACSignal *signal = [[RACSignal createSignal:^RACDisposable *(<span class=\"keyword\">id</span>&lt;RACSubscriber&gt; subscriber) &#123;</span><br><span class=\"line\">        [subscriber sendNext:[<span class=\"built_in\">NSDate</span> date]];</span><br><span class=\"line\">        [subscriber sendCompleted];</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">nil</span>;</span><br><span class=\"line\">    &#125;] repeat];</span><br><span class=\"line\"></span><br><span class=\"line\">    [signal subscribeNext:^(<span class=\"keyword\">id</span> x) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%@\"</span>, x);</span><br><span class=\"line\">    &#125;];</span><br></pre></td></tr></table></figure>\n<ul>\n<li>merge:同时订阅两个信号源，无论哪个发出信号，都会执行</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">RACSignal *signalA = [RACSignal createSignal:^RACDisposable *(<span class=\"keyword\">id</span>&lt;RACSubscriber&gt; subscriber) &#123;</span><br><span class=\"line\">      dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class=\"number\">2.0</span> * <span class=\"built_in\">NSEC_PER_SEC</span>)), dispatch_get_main_queue(), ^&#123;</span><br><span class=\"line\">          [subscriber sendNext:<span class=\"string\">@\"1\"</span>];</span><br><span class=\"line\">          [subscriber sendCompleted];</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">nil</span>;</span><br><span class=\"line\">  &#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">  RACSignal *signalB = [RACSignal createSignal:^RACDisposable *(<span class=\"keyword\">id</span>&lt;RACSubscriber&gt; subscriber) &#123;</span><br><span class=\"line\">      dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class=\"number\">3.0</span> * <span class=\"built_in\">NSEC_PER_SEC</span>)), dispatch_get_main_queue(), ^&#123;</span><br><span class=\"line\">          [subscriber sendNext:<span class=\"string\">@\"2\"</span>];</span><br><span class=\"line\">          [subscriber sendCompleted];</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">nil</span>;</span><br><span class=\"line\">  &#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">  [[signalA merge:signalB] subscribeNext:^(<span class=\"keyword\">id</span> x) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%@\"</span>, x);</span><br><span class=\"line\">  &#125;];</span><br></pre></td></tr></table></figure>\n<ul>\n<li>combineLatest:reduce:这是一个RACSignal的类方法，表示同时聚合多个信号</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">RACSignal *signalA = [RACSignal createSignal:^RACDisposable *(<span class=\"keyword\">id</span>&lt;RACSubscriber&gt; subscriber) &#123;</span><br><span class=\"line\">        dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class=\"number\">2.0</span> * <span class=\"built_in\">NSEC_PER_SEC</span>)), dispatch_get_main_queue(), ^&#123;</span><br><span class=\"line\">            [subscriber sendNext:<span class=\"string\">@\"1\"</span>];</span><br><span class=\"line\">            [subscriber sendCompleted];</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">nil</span>;</span><br><span class=\"line\">    &#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">    RACSignal *signalB = [RACSignal createSignal:^RACDisposable *(<span class=\"keyword\">id</span>&lt;RACSubscriber&gt; subscriber) &#123;</span><br><span class=\"line\">        dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class=\"number\">3.0</span> * <span class=\"built_in\">NSEC_PER_SEC</span>)), dispatch_get_main_queue(), ^&#123;</span><br><span class=\"line\">            [subscriber sendNext:<span class=\"string\">@\"2\"</span>];</span><br><span class=\"line\">            [subscriber sendCompleted];</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">nil</span>;</span><br><span class=\"line\">    &#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">    [[RACSignal combineLatest:@[signalA, signalB] reduce:^<span class=\"keyword\">id</span>(<span class=\"built_in\">NSString</span> *s1, <span class=\"built_in\">NSString</span> *s2)&#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"s1=%@, s2=%@\"</span>, s1, s2);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> [<span class=\"built_in\">NSString</span> stringWithFormat:<span class=\"string\">@\"%@%@\"</span>, s1, s2];</span><br><span class=\"line\">    &#125;] subscribeNext:^(<span class=\"keyword\">id</span> x) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%@\"</span>, x);</span><br><span class=\"line\">    &#125;];</span><br></pre></td></tr></table></figure>\n<ul>\n<li>concat:先订阅信号A，A执行完成后再订阅信号B</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">RACSignal *signalA = [RACSignal createSignal:^RACDisposable *(<span class=\"keyword\">id</span>&lt;RACSubscriber&gt; subscriber) &#123;</span><br><span class=\"line\">    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class=\"number\">2.0</span> * <span class=\"built_in\">NSEC_PER_SEC</span>)), dispatch_get_main_queue(), ^&#123;</span><br><span class=\"line\">        [subscriber sendNext:<span class=\"string\">@\"1\"</span>];</span><br><span class=\"line\">        [subscriber sendCompleted];</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">nil</span>;</span><br><span class=\"line\">&#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">RACSignal *signalB = [RACSignal createSignal:^RACDisposable *(<span class=\"keyword\">id</span>&lt;RACSubscriber&gt; subscriber) &#123;</span><br><span class=\"line\">    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class=\"number\">2.0</span> * <span class=\"built_in\">NSEC_PER_SEC</span>)), dispatch_get_main_queue(), ^&#123;</span><br><span class=\"line\">        [subscriber sendNext:<span class=\"string\">@\"2\"</span>];</span><br><span class=\"line\">        [subscriber sendCompleted];</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">nil</span>;</span><br><span class=\"line\">&#125;];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 先订阅A，A执行完成后，再执行B，如果A失败了，不会再执行B</span></span><br><span class=\"line\">[[signalA concat:signalB] subscribeNext:^(<span class=\"keyword\">id</span> x) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%@\"</span>, x);</span><br><span class=\"line\">&#125;];</span><br></pre></td></tr></table></figure>\n<ul>\n<li>zipWith:两个信号都发出后，再执行，也可以使用combineLatest:</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">RACSignal *signalA = [RACSignal createSignal:^RACDisposable *(<span class=\"keyword\">id</span>&lt;RACSubscriber&gt; subscriber) &#123;</span><br><span class=\"line\">    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class=\"number\">2.0</span> * <span class=\"built_in\">NSEC_PER_SEC</span>)), dispatch_get_main_queue(), ^&#123;</span><br><span class=\"line\">        [subscriber sendNext:<span class=\"string\">@\"1\"</span>];</span><br><span class=\"line\">        [subscriber sendCompleted];</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">nil</span>;</span><br><span class=\"line\">&#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">RACSignal *signalB = [RACSignal createSignal:^RACDisposable *(<span class=\"keyword\">id</span>&lt;RACSubscriber&gt; subscriber) &#123;</span><br><span class=\"line\">    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class=\"number\">3.0</span> * <span class=\"built_in\">NSEC_PER_SEC</span>)), dispatch_get_main_queue(), ^&#123;</span><br><span class=\"line\">        [subscriber sendNext:<span class=\"string\">@\"2\"</span>];</span><br><span class=\"line\">        [subscriber sendCompleted];</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">nil</span>;</span><br><span class=\"line\">&#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">[[signalA zipWith:signalB] subscribeNext:^(<span class=\"keyword\">id</span> x) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// x是一个RACTuple，包含了signalA和signalB的值</span></span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%@\"</span>, x);</span><br><span class=\"line\">&#125;];</span><br></pre></td></tr></table></figure>\n<h3 id=\"RAC的坑\"><a href=\"#RAC的坑\" class=\"headerlink\" title=\"RAC的坑\"></a>RAC的坑</h3><ul>\n<li>side effect: 一个信号源被多个订阅者订阅，每个订阅者收到的信号可能不一样。解决方法：使用reply</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">RACSignal *signalA = [[RACSignal createSignal:^RACDisposable *(<span class=\"keyword\">id</span>&lt;RACSubscriber&gt; subscriber) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">int</span> i = <span class=\"number\">0</span>;</span><br><span class=\"line\">    i++;</span><br><span class=\"line\">    [subscriber sendNext:@(i)];</span><br><span class=\"line\">    [subscriber sendCompleted];</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">nil</span>;</span><br><span class=\"line\">&#125;] replay];</span><br><span class=\"line\"></span><br><span class=\"line\">[signalA subscribeNext:^(<span class=\"keyword\">id</span> x) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%@\"</span>, x);</span><br><span class=\"line\">&#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">[signalA subscribeNext:^(<span class=\"keyword\">id</span> x) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%@\"</span>, x);</span><br><span class=\"line\">&#125;];</span><br></pre></td></tr></table></figure>\n"},{"layout":"post","title":"2016年5月开发问题记录","_content":"\n这是我最近工作中遇到的问题，做一个简单的记录。\n\n## 设置导航栏透明\n\n项目中有一个界面的导航栏是透明的，效果如下：\n\n![1-1](http://oldblog.shicishuzhai.com/d2b06aad44ccf25b3088bf3268f6de26.png)\n\n我首先想到的是:\n\n```objectivec\nself.navigationController.navigationBar.barTintColor = [UIColor clearColor];\n```\n\n但是设置了没有效果，然后又是一顿Google，找到了如下的解决方案：\n\n```objectivec\n// 设置导航栏背景图为一个透明的空图片\n[self.lmrNavigationBar setBackgroundImage:[UIImage new] forBarMetrics:UIBarMetricsDefault];\n// 设置导航栏的阴影背景图为一个透明的空图片\nself.lmrNavigationBar.shadowImage = [UIImage new];\n// 设置导航栏为半透明\nself.lmrNavigationBar.translucent = YES;\n```\n\n## 设置UIPageControl左对齐\n\nUIPageControl默认是居中对齐的，要设置它左对齐，需要进行在布局是，根据UIPageControl点的个数，计算UIPageControl的中心点X的坐标。代码如下：\n\n```objectivec\n- (void)layoutSubviews {\n    CGSize pageSize = [self.pageControl sizeForNumberOfPages:self.pageControl.numberOfPages];\n    [self.pageControl setCenterX:20 + pageSize.width / 2];\n    [self.pageControl setOriginY:CGRectGetHeight(self.frame) - 14 - CGRectGetHeight(self.pageControl.frame)];\n}\n```\n\n效果如下：\n\n![2-1](http://oldblog.shicishuzhai.com/664bd5d66be86fc7d0327fa63c0b8958.png)\n\n## 设置UILabel的内边距\n\n项目中要实现如下的一个标签（不可点击）：\n\n![3-1](http://oldblog.shicishuzhai.com/dab95307496966b3e7f51b6f8fa22308.png)\n\n一种方案是直接使用UIButton来实现，因为UIButton有titleEdgeInsets属性，可以设置文字的内边距，我这里尝试使用了UILabel来实现，UILabel默认是不可以设置内边距的，但是可以通过自定义Label来实现，实现代码如下：\n\n```objectivec\n#import \"LMRPaddingLabel.h\"\n@implementation LMRPaddingLabel\n\n- (void)drawTextInRect:(CGRect)rect {\n    UIEdgeInsets insets = {2, 2, 2, 2};\n    [super drawTextInRect:UIEdgeInsetsInsetRect(rect, insets)];\n}\n\n- (CGSize)intrinsicContentSize {\n    CGSize size = [super intrinsicContentSize];\n    return CGSizeMake(size.width + 4, size.height + 4);\n}\n\n@end\n```\n\n这样，LMRPaddingLabel就会有2个点的内边距，相关问题可参考：[ios add left padding to uilabel](http://stackoverflow.com/questions/19437579/ios-add-left-padding-to-uilabel)\n\n## 长按手势默认会触发两次\n\n给一个View添加了一个UILongPressGestureRecognizer，长按这个View，默认会触发两次，一次是经过了minimumPressDuration长的时间，另一次是手指离开时，可以通过手势的state属性来区分，代码如下：\n\n```objectivec\n-  (void)handleLongPress:(UILongPressGestureRecognizer*)sender {\n    if (sender.state == UIGestureRecognizerStateEnded) {\n      NSLog(@\"UIGestureRecognizerStateEnded\");\n    //Do Whatever You want on End of Gesture\n     }\n    else if (sender.state == UIGestureRecognizerStateBegan){\n       NSLog(@\"UIGestureRecognizerStateBegan.\");\n   //Do Whatever You want on Began of Gesture\n     }\n  }\n```\n\n相关问题可参考：[UILongPressGestureRecognizer gets called twice when pressing down](http://stackoverflow.com/questions/3319591/uilongpressgesturerecognizer-gets-called-twice-when-pressing-down)\n\n## 使用RAC绑定可重用的Cell\n\n一般来讲，我们会为每一个复杂View创建一个对应的ViewModel，然后使用RAC（ReactiveCocoa）对View与ViewModel进行绑定（Binding），View与ViewModel之间始终是一一对应的，但是在UITableview中就有问题了，由于UITableviewCell的重用机制，实际创建的Cell个数要少于对应的ViewModel的数量，这样如果还是使用RAC进行简单的数据绑定的话，就会出现重复绑定的问题。\n\n解决方案就是在Cell发生重用后，解除Cell与之前的ViewModel的绑定，然后把Cell与新的ViewModel进行绑定。RAC中有一个方法`takeUntil`可以实现在指定信号发出前，一直订阅某一信号，一旦指定信号发出，就不再订阅某一信号，就相当于接触绑定。\n\n实例代码如下：\n\n```objectivec\n\n- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath\n{    \n    UITableViewCell *cell =\n        [tableView dequeueReusableCellWithIdentifier:REUSABLE_CELL_ID];\n\n    UILabel *label = (UILabel *)[cell viewWithTag:VIEW_TAG];\n    Model *someModel = [self getModelFromIndexPath:indexPath];\n\n    //  `takeUntil:` makes the RACObserve() signal complete (and thus breaks the subscription)\n    //  when the cell is recycled.\n\n    RAC(label, text) = [RACObserve(someModel, someKey)\n                            takeUntil:cell.rac_prepareForReuseSignal];\n\n    return cell;\n}\n\n```\n\n这里信号rac_prepareForReuseSignal即为Cell发生重用时发出的信号。\n\n相关问题可参考：[Example of Reactive Cocoa binding for a reusable cell.](https://gist.github.com/bunnyhero/9988574)\n\n## 使用NSURLSession发送同步请求\n\n最近项目中用到了同步请求，使用NSURLConnection发送同步请求非常简单，直接调用NSURLConnection的类方法`+sendSynchronousRequest:`就可以了，不过由于苹果官方不建议使用NSURLConnection，而NSURLSession又没有直接的同步请求的方法，所以就查了一下如何使用NSURLSession发送同步请求，结果如下，可以使用下面的方法发送同步请求：\n\n```objectivec\n#import \"NSURLSession+SynchronousTask.h\"\n\n@implementation NSURLSession (SynchronousTask)\n\n#pragma mark - NSURLSessionDataTask\n\n- (nullable NSData *)sendSynchronousDataTaskWithURL:(nonnull NSURL *)url returningResponse:(NSURLResponse *_Nullable*_Nullable)response error:(NSError *_Nullable*_Nullable)error {\n    return [self sendSynchronousDataTaskWithRequest:[NSURLRequest requestWithURL:url] returningResponse:response error:error];\n}\n\n- (nullable NSData *)sendSynchronousDataTaskWithRequest:(nonnull NSURLRequest *)request returningResponse:(NSURLResponse *_Nullable*_Nullable)response error:(NSError *_Nullable*_Nullable)error {\n    dispatch_semaphore_t semaphore = dispatch_semaphore_create(0);\n    __block NSData *data = nil;\n    [[self dataTaskWithRequest:request completionHandler:^(NSData *taskData, NSURLResponse *taskResponse, NSError *taskError) {\n        data = taskData;\n        if (response) {\n            *response = taskResponse;\n        }\n        if (error) {\n            *error = taskError;\n        }\n        dispatch_semaphore_signal(semaphore);\n    }] resume];\n    dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER);\n\n    return data;\n}\n\n@end\n```\n\n这里使用的GCD的信号量做同步，使用时直接调用NSURLSession的这个分类的方法即可实现同步请求。\n\n## iOS7上自动布局的坑：Assertion failure in -[UITableView layoutSublayersOfLayer:]的错误\n\n最近在开发中遇到了“Assertion failure in -[UITableView layoutSublayersOfLayer:]”错误，而且只在iOS7上出现，iOS8及以上都是正常了，于是一阵Google，发现原来这个iOS7上自动布局的一个坑，造成这个错误主要有两个原因：\n\n1. 在添加UITableviewCell的子视图时，加在了Cell上而不是加在Cell的ContentView上，并且使用自动布局来布局\n2. 给UITableview添加了子视图，并且使用自动布局来布局，即`[tableView addSubview:someView]`\n\n对于第一个问题比较好解决，一般Cell的子视图都是加在Cell的ContentView上的，如果有那个视图没有加在ContentView上，改过来就可以了，只不过找起来可能比较麻烦。\n\n第二个问题就比较麻烦了，有时候我们确实需要给UITableview上加一个子视图，例如，加一个ErrorView或LoadingView等，这是如果使用自动布局设置了这个子视图与Tableview之间的约束，就会出现这个错误。解决方法就是不要使用自动布局，改用Frame的方法去设置子视图的位置，这样就不会报错了。针对iSO7专门做一下适配，如果大于iOS7可以继续使用自动布局。\n\n因为自动布局是在iOS6上才出现的，所以iOS6，包括iOS7上的自动布局都不是很成熟，有很多坑，这就需要我们不多的总结，才能避免再次掉进坑里。\n\n## Masonry不能用来更新XIB上设置的约束\n\n使用XIB加载的视图，如果在XIB上设置了自动布局的约束，在代码中想更新约束，是不能使用Masonry的mas_updateConstraints方法来更新约束的。解决方法就是把要更新的约束通过IBOutlet连接到代码中，然后在代码里更新这个约束，不过这个方法比较麻烦，暂时还没有找到其他更好的方法。\n","source":"_posts/2016-05-08-2016年5月开发问题记录.md","raw":"---\nlayout: post\ntitle: \"2016年5月开发问题记录\"\ncategories: \"iOS Tips\"\n---\n\n这是我最近工作中遇到的问题，做一个简单的记录。\n\n## 设置导航栏透明\n\n项目中有一个界面的导航栏是透明的，效果如下：\n\n![1-1](http://oldblog.shicishuzhai.com/d2b06aad44ccf25b3088bf3268f6de26.png)\n\n我首先想到的是:\n\n```objectivec\nself.navigationController.navigationBar.barTintColor = [UIColor clearColor];\n```\n\n但是设置了没有效果，然后又是一顿Google，找到了如下的解决方案：\n\n```objectivec\n// 设置导航栏背景图为一个透明的空图片\n[self.lmrNavigationBar setBackgroundImage:[UIImage new] forBarMetrics:UIBarMetricsDefault];\n// 设置导航栏的阴影背景图为一个透明的空图片\nself.lmrNavigationBar.shadowImage = [UIImage new];\n// 设置导航栏为半透明\nself.lmrNavigationBar.translucent = YES;\n```\n\n## 设置UIPageControl左对齐\n\nUIPageControl默认是居中对齐的，要设置它左对齐，需要进行在布局是，根据UIPageControl点的个数，计算UIPageControl的中心点X的坐标。代码如下：\n\n```objectivec\n- (void)layoutSubviews {\n    CGSize pageSize = [self.pageControl sizeForNumberOfPages:self.pageControl.numberOfPages];\n    [self.pageControl setCenterX:20 + pageSize.width / 2];\n    [self.pageControl setOriginY:CGRectGetHeight(self.frame) - 14 - CGRectGetHeight(self.pageControl.frame)];\n}\n```\n\n效果如下：\n\n![2-1](http://oldblog.shicishuzhai.com/664bd5d66be86fc7d0327fa63c0b8958.png)\n\n## 设置UILabel的内边距\n\n项目中要实现如下的一个标签（不可点击）：\n\n![3-1](http://oldblog.shicishuzhai.com/dab95307496966b3e7f51b6f8fa22308.png)\n\n一种方案是直接使用UIButton来实现，因为UIButton有titleEdgeInsets属性，可以设置文字的内边距，我这里尝试使用了UILabel来实现，UILabel默认是不可以设置内边距的，但是可以通过自定义Label来实现，实现代码如下：\n\n```objectivec\n#import \"LMRPaddingLabel.h\"\n@implementation LMRPaddingLabel\n\n- (void)drawTextInRect:(CGRect)rect {\n    UIEdgeInsets insets = {2, 2, 2, 2};\n    [super drawTextInRect:UIEdgeInsetsInsetRect(rect, insets)];\n}\n\n- (CGSize)intrinsicContentSize {\n    CGSize size = [super intrinsicContentSize];\n    return CGSizeMake(size.width + 4, size.height + 4);\n}\n\n@end\n```\n\n这样，LMRPaddingLabel就会有2个点的内边距，相关问题可参考：[ios add left padding to uilabel](http://stackoverflow.com/questions/19437579/ios-add-left-padding-to-uilabel)\n\n## 长按手势默认会触发两次\n\n给一个View添加了一个UILongPressGestureRecognizer，长按这个View，默认会触发两次，一次是经过了minimumPressDuration长的时间，另一次是手指离开时，可以通过手势的state属性来区分，代码如下：\n\n```objectivec\n-  (void)handleLongPress:(UILongPressGestureRecognizer*)sender {\n    if (sender.state == UIGestureRecognizerStateEnded) {\n      NSLog(@\"UIGestureRecognizerStateEnded\");\n    //Do Whatever You want on End of Gesture\n     }\n    else if (sender.state == UIGestureRecognizerStateBegan){\n       NSLog(@\"UIGestureRecognizerStateBegan.\");\n   //Do Whatever You want on Began of Gesture\n     }\n  }\n```\n\n相关问题可参考：[UILongPressGestureRecognizer gets called twice when pressing down](http://stackoverflow.com/questions/3319591/uilongpressgesturerecognizer-gets-called-twice-when-pressing-down)\n\n## 使用RAC绑定可重用的Cell\n\n一般来讲，我们会为每一个复杂View创建一个对应的ViewModel，然后使用RAC（ReactiveCocoa）对View与ViewModel进行绑定（Binding），View与ViewModel之间始终是一一对应的，但是在UITableview中就有问题了，由于UITableviewCell的重用机制，实际创建的Cell个数要少于对应的ViewModel的数量，这样如果还是使用RAC进行简单的数据绑定的话，就会出现重复绑定的问题。\n\n解决方案就是在Cell发生重用后，解除Cell与之前的ViewModel的绑定，然后把Cell与新的ViewModel进行绑定。RAC中有一个方法`takeUntil`可以实现在指定信号发出前，一直订阅某一信号，一旦指定信号发出，就不再订阅某一信号，就相当于接触绑定。\n\n实例代码如下：\n\n```objectivec\n\n- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath\n{    \n    UITableViewCell *cell =\n        [tableView dequeueReusableCellWithIdentifier:REUSABLE_CELL_ID];\n\n    UILabel *label = (UILabel *)[cell viewWithTag:VIEW_TAG];\n    Model *someModel = [self getModelFromIndexPath:indexPath];\n\n    //  `takeUntil:` makes the RACObserve() signal complete (and thus breaks the subscription)\n    //  when the cell is recycled.\n\n    RAC(label, text) = [RACObserve(someModel, someKey)\n                            takeUntil:cell.rac_prepareForReuseSignal];\n\n    return cell;\n}\n\n```\n\n这里信号rac_prepareForReuseSignal即为Cell发生重用时发出的信号。\n\n相关问题可参考：[Example of Reactive Cocoa binding for a reusable cell.](https://gist.github.com/bunnyhero/9988574)\n\n## 使用NSURLSession发送同步请求\n\n最近项目中用到了同步请求，使用NSURLConnection发送同步请求非常简单，直接调用NSURLConnection的类方法`+sendSynchronousRequest:`就可以了，不过由于苹果官方不建议使用NSURLConnection，而NSURLSession又没有直接的同步请求的方法，所以就查了一下如何使用NSURLSession发送同步请求，结果如下，可以使用下面的方法发送同步请求：\n\n```objectivec\n#import \"NSURLSession+SynchronousTask.h\"\n\n@implementation NSURLSession (SynchronousTask)\n\n#pragma mark - NSURLSessionDataTask\n\n- (nullable NSData *)sendSynchronousDataTaskWithURL:(nonnull NSURL *)url returningResponse:(NSURLResponse *_Nullable*_Nullable)response error:(NSError *_Nullable*_Nullable)error {\n    return [self sendSynchronousDataTaskWithRequest:[NSURLRequest requestWithURL:url] returningResponse:response error:error];\n}\n\n- (nullable NSData *)sendSynchronousDataTaskWithRequest:(nonnull NSURLRequest *)request returningResponse:(NSURLResponse *_Nullable*_Nullable)response error:(NSError *_Nullable*_Nullable)error {\n    dispatch_semaphore_t semaphore = dispatch_semaphore_create(0);\n    __block NSData *data = nil;\n    [[self dataTaskWithRequest:request completionHandler:^(NSData *taskData, NSURLResponse *taskResponse, NSError *taskError) {\n        data = taskData;\n        if (response) {\n            *response = taskResponse;\n        }\n        if (error) {\n            *error = taskError;\n        }\n        dispatch_semaphore_signal(semaphore);\n    }] resume];\n    dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER);\n\n    return data;\n}\n\n@end\n```\n\n这里使用的GCD的信号量做同步，使用时直接调用NSURLSession的这个分类的方法即可实现同步请求。\n\n## iOS7上自动布局的坑：Assertion failure in -[UITableView layoutSublayersOfLayer:]的错误\n\n最近在开发中遇到了“Assertion failure in -[UITableView layoutSublayersOfLayer:]”错误，而且只在iOS7上出现，iOS8及以上都是正常了，于是一阵Google，发现原来这个iOS7上自动布局的一个坑，造成这个错误主要有两个原因：\n\n1. 在添加UITableviewCell的子视图时，加在了Cell上而不是加在Cell的ContentView上，并且使用自动布局来布局\n2. 给UITableview添加了子视图，并且使用自动布局来布局，即`[tableView addSubview:someView]`\n\n对于第一个问题比较好解决，一般Cell的子视图都是加在Cell的ContentView上的，如果有那个视图没有加在ContentView上，改过来就可以了，只不过找起来可能比较麻烦。\n\n第二个问题就比较麻烦了，有时候我们确实需要给UITableview上加一个子视图，例如，加一个ErrorView或LoadingView等，这是如果使用自动布局设置了这个子视图与Tableview之间的约束，就会出现这个错误。解决方法就是不要使用自动布局，改用Frame的方法去设置子视图的位置，这样就不会报错了。针对iSO7专门做一下适配，如果大于iOS7可以继续使用自动布局。\n\n因为自动布局是在iOS6上才出现的，所以iOS6，包括iOS7上的自动布局都不是很成熟，有很多坑，这就需要我们不多的总结，才能避免再次掉进坑里。\n\n## Masonry不能用来更新XIB上设置的约束\n\n使用XIB加载的视图，如果在XIB上设置了自动布局的约束，在代码中想更新约束，是不能使用Masonry的mas_updateConstraints方法来更新约束的。解决方法就是把要更新的约束通过IBOutlet连接到代码中，然后在代码里更新这个约束，不过这个方法比较麻烦，暂时还没有找到其他更好的方法。\n","slug":"2016年5月开发问题记录","published":1,"date":"2016-05-07T16:00:00.000Z","updated":"2019-01-13T04:01:04.540Z","comments":1,"photos":[],"link":"","_id":"cjutyfmja006uc4c9p1oakngg","content":"<p>这是我最近工作中遇到的问题，做一个简单的记录。</p>\n<h2 id=\"设置导航栏透明\"><a href=\"#设置导航栏透明\" class=\"headerlink\" title=\"设置导航栏透明\"></a>设置导航栏透明</h2><p>项目中有一个界面的导航栏是透明的，效果如下：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/d2b06aad44ccf25b3088bf3268f6de26.png\" alt=\"1-1\"></p>\n<p>我首先想到的是:</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">self</span>.navigationController.navigationBar.barTintColor = [<span class=\"built_in\">UIColor</span> clearColor];</span><br></pre></td></tr></table></figure>\n<p>但是设置了没有效果，然后又是一顿Google，找到了如下的解决方案：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 设置导航栏背景图为一个透明的空图片</span></span><br><span class=\"line\">[<span class=\"keyword\">self</span>.lmrNavigationBar setBackgroundImage:[<span class=\"built_in\">UIImage</span> new] forBarMetrics:<span class=\"built_in\">UIBarMetricsDefault</span>];</span><br><span class=\"line\"><span class=\"comment\">// 设置导航栏的阴影背景图为一个透明的空图片</span></span><br><span class=\"line\"><span class=\"keyword\">self</span>.lmrNavigationBar.shadowImage = [<span class=\"built_in\">UIImage</span> new];</span><br><span class=\"line\"><span class=\"comment\">// 设置导航栏为半透明</span></span><br><span class=\"line\"><span class=\"keyword\">self</span>.lmrNavigationBar.translucent = <span class=\"literal\">YES</span>;</span><br></pre></td></tr></table></figure>\n<h2 id=\"设置UIPageControl左对齐\"><a href=\"#设置UIPageControl左对齐\" class=\"headerlink\" title=\"设置UIPageControl左对齐\"></a>设置UIPageControl左对齐</h2><p>UIPageControl默认是居中对齐的，要设置它左对齐，需要进行在布局是，根据UIPageControl点的个数，计算UIPageControl的中心点X的坐标。代码如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)layoutSubviews &#123;</span><br><span class=\"line\">    <span class=\"built_in\">CGSize</span> pageSize = [<span class=\"keyword\">self</span>.pageControl sizeForNumberOfPages:<span class=\"keyword\">self</span>.pageControl.numberOfPages];</span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.pageControl setCenterX:<span class=\"number\">20</span> + pageSize.width / <span class=\"number\">2</span>];</span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.pageControl setOriginY:<span class=\"built_in\">CGRectGetHeight</span>(<span class=\"keyword\">self</span>.frame) - <span class=\"number\">14</span> - <span class=\"built_in\">CGRectGetHeight</span>(<span class=\"keyword\">self</span>.pageControl.frame)];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>效果如下：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/664bd5d66be86fc7d0327fa63c0b8958.png\" alt=\"2-1\"></p>\n<h2 id=\"设置UILabel的内边距\"><a href=\"#设置UILabel的内边距\" class=\"headerlink\" title=\"设置UILabel的内边距\"></a>设置UILabel的内边距</h2><p>项目中要实现如下的一个标签（不可点击）：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/dab95307496966b3e7f51b6f8fa22308.png\" alt=\"3-1\"></p>\n<p>一种方案是直接使用UIButton来实现，因为UIButton有titleEdgeInsets属性，可以设置文字的内边距，我这里尝试使用了UILabel来实现，UILabel默认是不可以设置内边距的，但是可以通过自定义Label来实现，实现代码如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">\"LMRPaddingLabel.h\"</span></span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">LMRPaddingLabel</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)drawTextInRect:(<span class=\"built_in\">CGRect</span>)rect &#123;</span><br><span class=\"line\">    <span class=\"built_in\">UIEdgeInsets</span> insets = &#123;<span class=\"number\">2</span>, <span class=\"number\">2</span>, <span class=\"number\">2</span>, <span class=\"number\">2</span>&#125;;</span><br><span class=\"line\">    [<span class=\"keyword\">super</span> drawTextInRect:<span class=\"built_in\">UIEdgeInsetsInsetRect</span>(rect, insets)];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"built_in\">CGSize</span>)intrinsicContentSize &#123;</span><br><span class=\"line\">    <span class=\"built_in\">CGSize</span> size = [<span class=\"keyword\">super</span> intrinsicContentSize];</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">CGSizeMake</span>(size.width + <span class=\"number\">4</span>, size.height + <span class=\"number\">4</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure>\n<p>这样，LMRPaddingLabel就会有2个点的内边距，相关问题可参考：<a href=\"http://stackoverflow.com/questions/19437579/ios-add-left-padding-to-uilabel\" target=\"_blank\" rel=\"noopener\">ios add left padding to uilabel</a></p>\n<h2 id=\"长按手势默认会触发两次\"><a href=\"#长按手势默认会触发两次\" class=\"headerlink\" title=\"长按手势默认会触发两次\"></a>长按手势默认会触发两次</h2><p>给一个View添加了一个UILongPressGestureRecognizer，长按这个View，默认会触发两次，一次是经过了minimumPressDuration长的时间，另一次是手指离开时，可以通过手势的state属性来区分，代码如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-  (<span class=\"keyword\">void</span>)handleLongPress:(<span class=\"built_in\">UILongPressGestureRecognizer</span>*)sender &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (sender.state == <span class=\"built_in\">UIGestureRecognizerStateEnded</span>) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"UIGestureRecognizerStateEnded\"</span>);</span><br><span class=\"line\">    <span class=\"comment\">//Do Whatever You want on End of Gesture</span></span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (sender.state == <span class=\"built_in\">UIGestureRecognizerStateBegan</span>)&#123;</span><br><span class=\"line\">       <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"UIGestureRecognizerStateBegan.\"</span>);</span><br><span class=\"line\">   <span class=\"comment\">//Do Whatever You want on Began of Gesture</span></span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n<p>相关问题可参考：<a href=\"http://stackoverflow.com/questions/3319591/uilongpressgesturerecognizer-gets-called-twice-when-pressing-down\" target=\"_blank\" rel=\"noopener\">UILongPressGestureRecognizer gets called twice when pressing down</a></p>\n<h2 id=\"使用RAC绑定可重用的Cell\"><a href=\"#使用RAC绑定可重用的Cell\" class=\"headerlink\" title=\"使用RAC绑定可重用的Cell\"></a>使用RAC绑定可重用的Cell</h2><p>一般来讲，我们会为每一个复杂View创建一个对应的ViewModel，然后使用RAC（ReactiveCocoa）对View与ViewModel进行绑定（Binding），View与ViewModel之间始终是一一对应的，但是在UITableview中就有问题了，由于UITableviewCell的重用机制，实际创建的Cell个数要少于对应的ViewModel的数量，这样如果还是使用RAC进行简单的数据绑定的话，就会出现重复绑定的问题。</p>\n<p>解决方案就是在Cell发生重用后，解除Cell与之前的ViewModel的绑定，然后把Cell与新的ViewModel进行绑定。RAC中有一个方法<code>takeUntil</code>可以实现在指定信号发出前，一直订阅某一信号，一旦指定信号发出，就不再订阅某一信号，就相当于接触绑定。</p>\n<p>实例代码如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"built_in\">UITableViewCell</span> *)tableView:(<span class=\"built_in\">UITableView</span> *)tableView cellForRowAtIndexPath:(<span class=\"built_in\">NSIndexPath</span> *)indexPath</span><br><span class=\"line\">&#123;    </span><br><span class=\"line\">    <span class=\"built_in\">UITableViewCell</span> *cell =</span><br><span class=\"line\">        [tableView dequeueReusableCellWithIdentifier:REUSABLE_CELL_ID];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">UILabel</span> *label = (<span class=\"built_in\">UILabel</span> *)[cell viewWithTag:VIEW_TAG];</span><br><span class=\"line\">    Model *someModel = [<span class=\"keyword\">self</span> getModelFromIndexPath:indexPath];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//  `takeUntil:` makes the RACObserve() signal complete (and thus breaks the subscription)</span></span><br><span class=\"line\">    <span class=\"comment\">//  when the cell is recycled.</span></span><br><span class=\"line\"></span><br><span class=\"line\">    RAC(label, text) = [RACObserve(someModel, someKey)</span><br><span class=\"line\">                            takeUntil:cell.rac_prepareForReuseSignal];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> cell;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这里信号rac_prepareForReuseSignal即为Cell发生重用时发出的信号。</p>\n<p>相关问题可参考：<a href=\"https://gist.github.com/bunnyhero/9988574\" target=\"_blank\" rel=\"noopener\">Example of Reactive Cocoa binding for a reusable cell.</a></p>\n<h2 id=\"使用NSURLSession发送同步请求\"><a href=\"#使用NSURLSession发送同步请求\" class=\"headerlink\" title=\"使用NSURLSession发送同步请求\"></a>使用NSURLSession发送同步请求</h2><p>最近项目中用到了同步请求，使用NSURLConnection发送同步请求非常简单，直接调用NSURLConnection的类方法<code>+sendSynchronousRequest:</code>就可以了，不过由于苹果官方不建议使用NSURLConnection，而NSURLSession又没有直接的同步请求的方法，所以就查了一下如何使用NSURLSession发送同步请求，结果如下，可以使用下面的方法发送同步请求：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">\"NSURLSession+SynchronousTask.h\"</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">NSURLSession</span> (<span class=\"title\">SynchronousTask</span>)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#pragma mark - NSURLSessionDataTask</span></span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">nullable</span> <span class=\"built_in\">NSData</span> *)sendSynchronousDataTaskWithURL:(<span class=\"keyword\">nonnull</span> <span class=\"built_in\">NSURL</span> *)url returningResponse:(<span class=\"built_in\">NSURLResponse</span> *_Nullable*_Nullable)response error:(<span class=\"built_in\">NSError</span> *_Nullable*_Nullable)error &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> [<span class=\"keyword\">self</span> sendSynchronousDataTaskWithRequest:[<span class=\"built_in\">NSURLRequest</span> requestWithURL:url] returningResponse:response error:error];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">nullable</span> <span class=\"built_in\">NSData</span> *)sendSynchronousDataTaskWithRequest:(<span class=\"keyword\">nonnull</span> <span class=\"built_in\">NSURLRequest</span> *)request returningResponse:(<span class=\"built_in\">NSURLResponse</span> *_Nullable*_Nullable)response error:(<span class=\"built_in\">NSError</span> *_Nullable*_Nullable)error &#123;</span><br><span class=\"line\">    dispatch_semaphore_t semaphore = dispatch_semaphore_create(<span class=\"number\">0</span>);</span><br><span class=\"line\">    __block <span class=\"built_in\">NSData</span> *data = <span class=\"literal\">nil</span>;</span><br><span class=\"line\">    [[<span class=\"keyword\">self</span> dataTaskWithRequest:request completionHandler:^(<span class=\"built_in\">NSData</span> *taskData, <span class=\"built_in\">NSURLResponse</span> *taskResponse, <span class=\"built_in\">NSError</span> *taskError) &#123;</span><br><span class=\"line\">        data = taskData;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (response) &#123;</span><br><span class=\"line\">            *response = taskResponse;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (error) &#123;</span><br><span class=\"line\">            *error = taskError;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        dispatch_semaphore_signal(semaphore);</span><br><span class=\"line\">    &#125;] resume];</span><br><span class=\"line\">    dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> data;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure>\n<p>这里使用的GCD的信号量做同步，使用时直接调用NSURLSession的这个分类的方法即可实现同步请求。</p>\n<h2 id=\"iOS7上自动布局的坑：Assertion-failure-in-UITableView-layoutSublayersOfLayer-的错误\"><a href=\"#iOS7上自动布局的坑：Assertion-failure-in-UITableView-layoutSublayersOfLayer-的错误\" class=\"headerlink\" title=\"iOS7上自动布局的坑：Assertion failure in -[UITableView layoutSublayersOfLayer:]的错误\"></a>iOS7上自动布局的坑：Assertion failure in -[UITableView layoutSublayersOfLayer:]的错误</h2><p>最近在开发中遇到了“Assertion failure in -[UITableView layoutSublayersOfLayer:]”错误，而且只在iOS7上出现，iOS8及以上都是正常了，于是一阵Google，发现原来这个iOS7上自动布局的一个坑，造成这个错误主要有两个原因：</p>\n<ol>\n<li>在添加UITableviewCell的子视图时，加在了Cell上而不是加在Cell的ContentView上，并且使用自动布局来布局</li>\n<li>给UITableview添加了子视图，并且使用自动布局来布局，即<code>[tableView addSubview:someView]</code></li>\n</ol>\n<p>对于第一个问题比较好解决，一般Cell的子视图都是加在Cell的ContentView上的，如果有那个视图没有加在ContentView上，改过来就可以了，只不过找起来可能比较麻烦。</p>\n<p>第二个问题就比较麻烦了，有时候我们确实需要给UITableview上加一个子视图，例如，加一个ErrorView或LoadingView等，这是如果使用自动布局设置了这个子视图与Tableview之间的约束，就会出现这个错误。解决方法就是不要使用自动布局，改用Frame的方法去设置子视图的位置，这样就不会报错了。针对iSO7专门做一下适配，如果大于iOS7可以继续使用自动布局。</p>\n<p>因为自动布局是在iOS6上才出现的，所以iOS6，包括iOS7上的自动布局都不是很成熟，有很多坑，这就需要我们不多的总结，才能避免再次掉进坑里。</p>\n<h2 id=\"Masonry不能用来更新XIB上设置的约束\"><a href=\"#Masonry不能用来更新XIB上设置的约束\" class=\"headerlink\" title=\"Masonry不能用来更新XIB上设置的约束\"></a>Masonry不能用来更新XIB上设置的约束</h2><p>使用XIB加载的视图，如果在XIB上设置了自动布局的约束，在代码中想更新约束，是不能使用Masonry的mas_updateConstraints方法来更新约束的。解决方法就是把要更新的约束通过IBOutlet连接到代码中，然后在代码里更新这个约束，不过这个方法比较麻烦，暂时还没有找到其他更好的方法。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>这是我最近工作中遇到的问题，做一个简单的记录。</p>\n<h2 id=\"设置导航栏透明\"><a href=\"#设置导航栏透明\" class=\"headerlink\" title=\"设置导航栏透明\"></a>设置导航栏透明</h2><p>项目中有一个界面的导航栏是透明的，效果如下：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/d2b06aad44ccf25b3088bf3268f6de26.png\" alt=\"1-1\"></p>\n<p>我首先想到的是:</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">self</span>.navigationController.navigationBar.barTintColor = [<span class=\"built_in\">UIColor</span> clearColor];</span><br></pre></td></tr></table></figure>\n<p>但是设置了没有效果，然后又是一顿Google，找到了如下的解决方案：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 设置导航栏背景图为一个透明的空图片</span></span><br><span class=\"line\">[<span class=\"keyword\">self</span>.lmrNavigationBar setBackgroundImage:[<span class=\"built_in\">UIImage</span> new] forBarMetrics:<span class=\"built_in\">UIBarMetricsDefault</span>];</span><br><span class=\"line\"><span class=\"comment\">// 设置导航栏的阴影背景图为一个透明的空图片</span></span><br><span class=\"line\"><span class=\"keyword\">self</span>.lmrNavigationBar.shadowImage = [<span class=\"built_in\">UIImage</span> new];</span><br><span class=\"line\"><span class=\"comment\">// 设置导航栏为半透明</span></span><br><span class=\"line\"><span class=\"keyword\">self</span>.lmrNavigationBar.translucent = <span class=\"literal\">YES</span>;</span><br></pre></td></tr></table></figure>\n<h2 id=\"设置UIPageControl左对齐\"><a href=\"#设置UIPageControl左对齐\" class=\"headerlink\" title=\"设置UIPageControl左对齐\"></a>设置UIPageControl左对齐</h2><p>UIPageControl默认是居中对齐的，要设置它左对齐，需要进行在布局是，根据UIPageControl点的个数，计算UIPageControl的中心点X的坐标。代码如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)layoutSubviews &#123;</span><br><span class=\"line\">    <span class=\"built_in\">CGSize</span> pageSize = [<span class=\"keyword\">self</span>.pageControl sizeForNumberOfPages:<span class=\"keyword\">self</span>.pageControl.numberOfPages];</span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.pageControl setCenterX:<span class=\"number\">20</span> + pageSize.width / <span class=\"number\">2</span>];</span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.pageControl setOriginY:<span class=\"built_in\">CGRectGetHeight</span>(<span class=\"keyword\">self</span>.frame) - <span class=\"number\">14</span> - <span class=\"built_in\">CGRectGetHeight</span>(<span class=\"keyword\">self</span>.pageControl.frame)];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>效果如下：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/664bd5d66be86fc7d0327fa63c0b8958.png\" alt=\"2-1\"></p>\n<h2 id=\"设置UILabel的内边距\"><a href=\"#设置UILabel的内边距\" class=\"headerlink\" title=\"设置UILabel的内边距\"></a>设置UILabel的内边距</h2><p>项目中要实现如下的一个标签（不可点击）：</p>\n<p><img src=\"http://oldblog.shicishuzhai.com/dab95307496966b3e7f51b6f8fa22308.png\" alt=\"3-1\"></p>\n<p>一种方案是直接使用UIButton来实现，因为UIButton有titleEdgeInsets属性，可以设置文字的内边距，我这里尝试使用了UILabel来实现，UILabel默认是不可以设置内边距的，但是可以通过自定义Label来实现，实现代码如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">\"LMRPaddingLabel.h\"</span></span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">LMRPaddingLabel</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)drawTextInRect:(<span class=\"built_in\">CGRect</span>)rect &#123;</span><br><span class=\"line\">    <span class=\"built_in\">UIEdgeInsets</span> insets = &#123;<span class=\"number\">2</span>, <span class=\"number\">2</span>, <span class=\"number\">2</span>, <span class=\"number\">2</span>&#125;;</span><br><span class=\"line\">    [<span class=\"keyword\">super</span> drawTextInRect:<span class=\"built_in\">UIEdgeInsetsInsetRect</span>(rect, insets)];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"built_in\">CGSize</span>)intrinsicContentSize &#123;</span><br><span class=\"line\">    <span class=\"built_in\">CGSize</span> size = [<span class=\"keyword\">super</span> intrinsicContentSize];</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">CGSizeMake</span>(size.width + <span class=\"number\">4</span>, size.height + <span class=\"number\">4</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure>\n<p>这样，LMRPaddingLabel就会有2个点的内边距，相关问题可参考：<a href=\"http://stackoverflow.com/questions/19437579/ios-add-left-padding-to-uilabel\" target=\"_blank\" rel=\"noopener\">ios add left padding to uilabel</a></p>\n<h2 id=\"长按手势默认会触发两次\"><a href=\"#长按手势默认会触发两次\" class=\"headerlink\" title=\"长按手势默认会触发两次\"></a>长按手势默认会触发两次</h2><p>给一个View添加了一个UILongPressGestureRecognizer，长按这个View，默认会触发两次，一次是经过了minimumPressDuration长的时间，另一次是手指离开时，可以通过手势的state属性来区分，代码如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-  (<span class=\"keyword\">void</span>)handleLongPress:(<span class=\"built_in\">UILongPressGestureRecognizer</span>*)sender &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (sender.state == <span class=\"built_in\">UIGestureRecognizerStateEnded</span>) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"UIGestureRecognizerStateEnded\"</span>);</span><br><span class=\"line\">    <span class=\"comment\">//Do Whatever You want on End of Gesture</span></span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (sender.state == <span class=\"built_in\">UIGestureRecognizerStateBegan</span>)&#123;</span><br><span class=\"line\">       <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"UIGestureRecognizerStateBegan.\"</span>);</span><br><span class=\"line\">   <span class=\"comment\">//Do Whatever You want on Began of Gesture</span></span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n<p>相关问题可参考：<a href=\"http://stackoverflow.com/questions/3319591/uilongpressgesturerecognizer-gets-called-twice-when-pressing-down\" target=\"_blank\" rel=\"noopener\">UILongPressGestureRecognizer gets called twice when pressing down</a></p>\n<h2 id=\"使用RAC绑定可重用的Cell\"><a href=\"#使用RAC绑定可重用的Cell\" class=\"headerlink\" title=\"使用RAC绑定可重用的Cell\"></a>使用RAC绑定可重用的Cell</h2><p>一般来讲，我们会为每一个复杂View创建一个对应的ViewModel，然后使用RAC（ReactiveCocoa）对View与ViewModel进行绑定（Binding），View与ViewModel之间始终是一一对应的，但是在UITableview中就有问题了，由于UITableviewCell的重用机制，实际创建的Cell个数要少于对应的ViewModel的数量，这样如果还是使用RAC进行简单的数据绑定的话，就会出现重复绑定的问题。</p>\n<p>解决方案就是在Cell发生重用后，解除Cell与之前的ViewModel的绑定，然后把Cell与新的ViewModel进行绑定。RAC中有一个方法<code>takeUntil</code>可以实现在指定信号发出前，一直订阅某一信号，一旦指定信号发出，就不再订阅某一信号，就相当于接触绑定。</p>\n<p>实例代码如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"built_in\">UITableViewCell</span> *)tableView:(<span class=\"built_in\">UITableView</span> *)tableView cellForRowAtIndexPath:(<span class=\"built_in\">NSIndexPath</span> *)indexPath</span><br><span class=\"line\">&#123;    </span><br><span class=\"line\">    <span class=\"built_in\">UITableViewCell</span> *cell =</span><br><span class=\"line\">        [tableView dequeueReusableCellWithIdentifier:REUSABLE_CELL_ID];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">UILabel</span> *label = (<span class=\"built_in\">UILabel</span> *)[cell viewWithTag:VIEW_TAG];</span><br><span class=\"line\">    Model *someModel = [<span class=\"keyword\">self</span> getModelFromIndexPath:indexPath];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//  `takeUntil:` makes the RACObserve() signal complete (and thus breaks the subscription)</span></span><br><span class=\"line\">    <span class=\"comment\">//  when the cell is recycled.</span></span><br><span class=\"line\"></span><br><span class=\"line\">    RAC(label, text) = [RACObserve(someModel, someKey)</span><br><span class=\"line\">                            takeUntil:cell.rac_prepareForReuseSignal];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> cell;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这里信号rac_prepareForReuseSignal即为Cell发生重用时发出的信号。</p>\n<p>相关问题可参考：<a href=\"https://gist.github.com/bunnyhero/9988574\" target=\"_blank\" rel=\"noopener\">Example of Reactive Cocoa binding for a reusable cell.</a></p>\n<h2 id=\"使用NSURLSession发送同步请求\"><a href=\"#使用NSURLSession发送同步请求\" class=\"headerlink\" title=\"使用NSURLSession发送同步请求\"></a>使用NSURLSession发送同步请求</h2><p>最近项目中用到了同步请求，使用NSURLConnection发送同步请求非常简单，直接调用NSURLConnection的类方法<code>+sendSynchronousRequest:</code>就可以了，不过由于苹果官方不建议使用NSURLConnection，而NSURLSession又没有直接的同步请求的方法，所以就查了一下如何使用NSURLSession发送同步请求，结果如下，可以使用下面的方法发送同步请求：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">\"NSURLSession+SynchronousTask.h\"</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">NSURLSession</span> (<span class=\"title\">SynchronousTask</span>)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#pragma mark - NSURLSessionDataTask</span></span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">nullable</span> <span class=\"built_in\">NSData</span> *)sendSynchronousDataTaskWithURL:(<span class=\"keyword\">nonnull</span> <span class=\"built_in\">NSURL</span> *)url returningResponse:(<span class=\"built_in\">NSURLResponse</span> *_Nullable*_Nullable)response error:(<span class=\"built_in\">NSError</span> *_Nullable*_Nullable)error &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> [<span class=\"keyword\">self</span> sendSynchronousDataTaskWithRequest:[<span class=\"built_in\">NSURLRequest</span> requestWithURL:url] returningResponse:response error:error];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">nullable</span> <span class=\"built_in\">NSData</span> *)sendSynchronousDataTaskWithRequest:(<span class=\"keyword\">nonnull</span> <span class=\"built_in\">NSURLRequest</span> *)request returningResponse:(<span class=\"built_in\">NSURLResponse</span> *_Nullable*_Nullable)response error:(<span class=\"built_in\">NSError</span> *_Nullable*_Nullable)error &#123;</span><br><span class=\"line\">    dispatch_semaphore_t semaphore = dispatch_semaphore_create(<span class=\"number\">0</span>);</span><br><span class=\"line\">    __block <span class=\"built_in\">NSData</span> *data = <span class=\"literal\">nil</span>;</span><br><span class=\"line\">    [[<span class=\"keyword\">self</span> dataTaskWithRequest:request completionHandler:^(<span class=\"built_in\">NSData</span> *taskData, <span class=\"built_in\">NSURLResponse</span> *taskResponse, <span class=\"built_in\">NSError</span> *taskError) &#123;</span><br><span class=\"line\">        data = taskData;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (response) &#123;</span><br><span class=\"line\">            *response = taskResponse;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (error) &#123;</span><br><span class=\"line\">            *error = taskError;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        dispatch_semaphore_signal(semaphore);</span><br><span class=\"line\">    &#125;] resume];</span><br><span class=\"line\">    dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> data;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure>\n<p>这里使用的GCD的信号量做同步，使用时直接调用NSURLSession的这个分类的方法即可实现同步请求。</p>\n<h2 id=\"iOS7上自动布局的坑：Assertion-failure-in-UITableView-layoutSublayersOfLayer-的错误\"><a href=\"#iOS7上自动布局的坑：Assertion-failure-in-UITableView-layoutSublayersOfLayer-的错误\" class=\"headerlink\" title=\"iOS7上自动布局的坑：Assertion failure in -[UITableView layoutSublayersOfLayer:]的错误\"></a>iOS7上自动布局的坑：Assertion failure in -[UITableView layoutSublayersOfLayer:]的错误</h2><p>最近在开发中遇到了“Assertion failure in -[UITableView layoutSublayersOfLayer:]”错误，而且只在iOS7上出现，iOS8及以上都是正常了，于是一阵Google，发现原来这个iOS7上自动布局的一个坑，造成这个错误主要有两个原因：</p>\n<ol>\n<li>在添加UITableviewCell的子视图时，加在了Cell上而不是加在Cell的ContentView上，并且使用自动布局来布局</li>\n<li>给UITableview添加了子视图，并且使用自动布局来布局，即<code>[tableView addSubview:someView]</code></li>\n</ol>\n<p>对于第一个问题比较好解决，一般Cell的子视图都是加在Cell的ContentView上的，如果有那个视图没有加在ContentView上，改过来就可以了，只不过找起来可能比较麻烦。</p>\n<p>第二个问题就比较麻烦了，有时候我们确实需要给UITableview上加一个子视图，例如，加一个ErrorView或LoadingView等，这是如果使用自动布局设置了这个子视图与Tableview之间的约束，就会出现这个错误。解决方法就是不要使用自动布局，改用Frame的方法去设置子视图的位置，这样就不会报错了。针对iSO7专门做一下适配，如果大于iOS7可以继续使用自动布局。</p>\n<p>因为自动布局是在iOS6上才出现的，所以iOS6，包括iOS7上的自动布局都不是很成熟，有很多坑，这就需要我们不多的总结，才能避免再次掉进坑里。</p>\n<h2 id=\"Masonry不能用来更新XIB上设置的约束\"><a href=\"#Masonry不能用来更新XIB上设置的约束\" class=\"headerlink\" title=\"Masonry不能用来更新XIB上设置的约束\"></a>Masonry不能用来更新XIB上设置的约束</h2><p>使用XIB加载的视图，如果在XIB上设置了自动布局的约束，在代码中想更新约束，是不能使用Masonry的mas_updateConstraints方法来更新约束的。解决方法就是把要更新的约束通过IBOutlet连接到代码中，然后在代码里更新这个约束，不过这个方法比较麻烦，暂时还没有找到其他更好的方法。</p>\n"},{"layout":"post","title":"iOS中的多线程编程","_content":"\n## 关于多线程编程\n\n### 什么是多线程\n简单的来说，并发应用程序中一个单独的执行路径，就是一个线程。\n### 相关术语\n* 进程：用于指代一个正在运行的可执行程序，它可以包含多个线程。\n* 任务：用于指代抽象的概念，表示需要执行工作。\n* 线程的同步：同步就是协同步调，按预定的先后次序进行运行。线程的同步即一个线程执行完指定操作后，另个一个线程再执行。\n* 线程的互斥：线程互斥是指某一资源同时只允许一个访问者对其进行访问，具有唯一性和排它性。\n### iOS中的多线程编程\n* pthread（POSIX threads）：一套C语言接口，定义了创建和管理线程的API，非常灵活，可以直接操作线程。\n* NSThread：一套OC接口，需要自己手动管理线程，比GCD和NSOperation更加轻量级。\n* GCD：是iOS4出的一套并发编程的接口，纯C语言接口。以队列为基础。\n* NSOperation：一套面向对象的OC API，不需要手动管理线程。能实现一些GCD实现不了的功能。\n\n## NSThread\n### 基本操作\n#### 线程的创建\n* 类方法创建线程\n```objectivec\n[NSThread detachNewThreadSelector:@selector(threadFun:) toTarget:self withObject:@\"helloworld\"];\n```\n\n* 实例方法创建线程\n```objectivec\nNSThread * th = [[NSThread alloc] initWithTarget:self selector:@selector(threadFun:) object:@\"helloworld\"];\n    [th start];\n```\n\n* 继承NSThread，重写main方法(与NSOperation类似)\n```objectivec\n//MyThread.h\n@interface MyThread : NSThread\n@end\n\n//MyThread.m\n@implementation MyThread\n- (void)main {\n    NSLog(@\"this is MyThread\");\n}\n\n//main.m\n#import <Foundation/Foundation.h>\n#import \"MyThread.h\"\n\nint main(int argc, const char * argv[]) {\n    @autoreleasepool {\n        MyThread * th = [[MyThread alloc] init];\n        [th start];\n        [[NSRunLoop mainRunLoop] run];\n    }\n    return 0;\n}\n@end\n```\n\n* 其他：NSObject中的方法\n```objectivec\n - (void)performSelectorInBackground:(SEL)aSelector withObject:(id)arg;\n```\n\n####线程的基本管理\n* 获取主线程`+ (NSThread *)mainThread`\n* 获取当前线程`+ (NSThread *)currentThread;`\n* 阻塞当前线程`+ (void)sleepUntilDate:(NSDate *)date;`和`+ (void)sleepForTimeInterval:(NSTimeInterval)ti;`\n* 销毁消除当前线程（currentThread）`+ (void)exit;`\n* 取消线程`- (void)cancel;`：将线程的状体置为cancelled，并不会停止线程的执行\n* 线程键的通讯\n```objectivec\n- (void)performSelectorOnMainThread:(SEL)aSelector withObject:(id)arg waitUntilDone:(BOOL)wait;\n- (void)performSelector:(SEL)aSelector onThread:(NSThread *)thr withObject:(id)arg waitUntilDone:(BOOL)wait;\n```\n\n### 线程同步与互斥\n#### 锁\n* @synchronized（obj）对代码段进行加锁，同时只能一个线程访问该代码段\n```objectivec\n@synchronized(self) {\n    i++;\n    NSLog(@\"%ld\", i);\n}\n```\n\n* NSLock：与@synchronized类似\n```objectivec\nNSLock * lock = [[NSLock alloc] init];\nif ([lock tryLock]) {\n    [lock lock];\n    i++;\n    NSLog(@\"%ld\", i);\n    [lock unlock];\n}\n```\n\n* NSConditionLock条件锁：在所的基础上添加了条件，只有满足对应的条件，才能打开相应的锁\n```objectivec\n- (void)startTest {\n    _conLock = [[NSConditionLock alloc] init];\n    [NSThread detachNewThreadSelector:@selector(threadFun:) toTarget:self withObject:@\"top thread\"];\n    for (int i = 0; i < 200; i++) {\n        [NSThread detachNewThreadSelector:@selector(threadFun2:) toTarget:self withObject:@(i)];\n    }\n}\n\n- (void)threadFun:(id)obj {\n\n    [_conLock lock];\n    NSLog(@\"%@\", obj);\n    [NSThread sleepForTimeInterval:1.0f];\n    //加锁，条件为10\n    [_conLock unlockWithCondition:10];\n}\n\n- (void)threadFun2:(id)obj {\n    NSInteger value = [obj integerValue];\n\n    //只有到value等于10时，才能成功加锁，否则阻塞\n    [_conLock lockWhenCondition:value];\n    NSLog(@\"thread%@\", obj);\n    [NSThread sleepForTimeInterval:1.0f];\n    //解锁，并把条件设为value + 3,则下次上锁的条件为13，一次类推13,16,19...\n    [_conLock unlockWithCondition:value + 3];\n}\n```\n\n输出结果：\n\n![这里写图片描述](http://img.blog.csdn.net/20150410103408108)\n\n* NSRecursiveLock递归锁：同一个线程中，递归或多次调用加锁代码段，不会造成死锁\n```objectivec\nj = 0;\n[NSThread detachNewThreadSelector:@selector(threadFun:) toTarget:self withObject:@\"top thread1\"];\n[NSThread detachNewThreadSelector:@selector(threadFun:) toTarget:self withObject:@\"top thread2\"];\n\n- (void)threadFun:(id)obj {\n    [self testWith:obj];\n}\n\n- (void)testWith:(id)obj {\n    [_recLock lock];\n    NSLog(@\"test recursive,thread:%@, lock:%ld\", obj, j++);\n    [NSThread sleepForTimeInterval:1.0f];\n    if (j < 10) {\n        [self testWith:obj];\n    }\n    [_recLock unlock];\n}\n```\n\n输出结果：\n\n![这里写图片描述](http://img.blog.csdn.net/20150410104742410)\n\n* NSDistributedLock分布式锁：用于多个进程之间互斥访问资源，一般用于Mac开发\n\n#### 条件\n使用NSCondition，可以实现多线程的同步，解决类似生产者消费者问题。\n```objectivec\n#import \"testThread.h\"\n\n@implementation testThread\n{\n    NSInteger i;\n    NSCondition * _con;\n    NSMutableArray * _products;\n}\n\n- (void)startTest {\n    _con = [[NSCondition alloc] init];\n    _products = [[NSMutableArray alloc] init];\n    [NSThread detachNewThreadSelector:@selector(threadFun2:) toTarget:self withObject:@\"thread2\"];\n    [NSThread detachNewThreadSelector:@selector(threadFun2:) toTarget:self withObject:@\"thread3\"];\n    [NSThread detachNewThreadSelector:@selector(threadFun1:) toTarget:self withObject:@\"thread1\"];\n}\n\n- (void)threadFun1:(id)obj {\n    while (1) {\n        [NSThread sleepForTimeInterval:2.0f];\n        [_products addObject:@\"apple\"];//生产者创造一个产品\n        NSLog(@\"%@ add one product, product count:%ld\", obj, _products.count);\n        [_con signal];//通知消费者，消费产品\n//        [_con broadcast];\n    }\n}\n\n- (void)threadFun2:(id)obj {\n    while (1) {\n        [_con lock];\n        [_con wait];//等待生产者的通知\n        [_products removeObjectAtIndex:0];//消费者消费一个产品\n        NSLog(@\"%@ remove one product, proudct count:%ld\", obj, _products.count);\n        [_con unlock];\n    }\n}\n\n@end\n```\n\n## GCD\n### 基本用法\n#### 队列\n* 串行队列：同时只能执行一个任务\n\t* 所有任务都在同一个线程中执行，FIFO\n\t* 多个串行队列之间是并行执行的，会占用多个线程\n\t* 创建串行队列：`dispatch_queue_t serialQueue = dispatch_queue_create(\"myQueue\", DISPATCH_QUEUE_SERIAL);`\n\t* `dispatch_get_main_queue();`获取主线程上的一个全局可用的串行队列\n* 并行队列：同时可以执行多个任务\n\t* 多个任务在不同的线程上执行，最大并发数（最多起的线程数）由操作系统根据当前的系统状态决定，不可手动设置（NSOperation可以）\n\t* 创建并行队列：`dispatch_queue_t concurrentQueue = dispatch_queue_create(\"myQueue\", DISPATCH_QUEUE_CONCURRENT);`\n\t* `dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);`获取一个全局可用的并行队列\n#### 任务\n* 同步任务：添加一个任务后，需要等待任务执行完后才能返回\n\t* 无论是串行队列还是并行队列，同步任务都是在主线程上执行的\n\t* 同步任务会阻塞当前线程\n\t* 向主队列中添加同步任务会造成**死锁**，见死锁①\n\t* 向串行队列中添加嵌套的同步任务会造成**死锁**，见死锁②\n```objectivec\n//同步任务\ndispatch_sync(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{\n            [NSThread sleepForTimeInterval:1.0f];\n            //先打印\n            NSLog(@\"thread:%@\", [NSThread currentThread]);\n        });\nNSLog(@\"haha\");//后打印\n\n//死锁①\ndispatch_sync(dispatch_get_main_queue(), ^{\n            [NSThread sleepForTimeInterval:1.0f];\n            NSLog(@\"thread:%@\", [NSThread currentThread]);\n        });        \nNSLog(@\"haha\");//造成死锁，haha永远不会打印\n\n//死锁②\ndispatch_queue_t serialQueue = dispatch_queue_create(\"myQueue\", DISPATCH_QUEUE_SERIAL);\ndispatch_sync(serialQueue, ^{\n            NSLog(@\"thread1:%@\", [NSThread currentThread]);\n            dispatch_sync(serialQueue, ^{\n                NSLog(@\"thread2:%@\", [NSThread currentThread]);//造成死锁，thread2永远不会打印\n            });\n        });\n```\n\n* 异步任务：添加一个任务后不需要等待任务执行完成\n```objectivec\n//异步任务\ndispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{\n            [NSThread sleepForTimeInterval:1.0f];\n            //后打印\n            NSLog(@\"thread:%@\", [NSThread currentThread]);\n        });\nNSLog(@\"haha\");//先打印\n```\n\n### 其他用法\n* dispatch_after：延迟指定的时间后，将任务添加到指定的队列中\n```objectivec\ndispatch_time_t time = dispatch_time(DISPATCH_TIME_NOW, (int64_t)(10.0f * NSEC_PER_SEC));\ndispatch_after(time, dispatch_get_main_queue(), ^{\n    NSLog(@\"haha\");\n});\n```\n\n* dispatch_group：将多个任务或队列归为一组，在这组的所有任务都执行完之后再执行后面的操作\n\t* dispatch_group_async函数：创建一个指定队列中的异步任务，并将其添加到指定组中\n\t* dispatch_group_notify函数：指定组中所有任务都执行完后，会执行该函数所指定的的任务\n\t* dispatch_group_wait函数：阻塞当前线程，等待group中所有任务执行完毕\n```objectivec\n//使用dispatch_group_notify\ndispatch_group_t group = dispatch_group_create();\ndispatch_queue_t concurrentQueue = dispatch_queue_create(\"myQueue\", DISPATCH_QUEUE_CONCURRENT);\ndispatch_group_async(group, concurrentQueue, ^{\n    NSLog(@\"1\");\n    [NSThread sleepForTimeInterval:1.0f];\n});\ndispatch_group_async(group, concurrentQueue, ^{\n    NSLog(@\"2\");\n    [NSThread sleepForTimeInterval:1.0f];\n});\ndispatch_group_async(group, concurrentQueue, ^{\n    NSLog(@\"3\");\n    [NSThread sleepForTimeInterval:1.0f];\n});\ndispatch_group_async(group, concurrentQueue, ^{\n    NSLog(@\"4\");\n    [NSThread sleepForTimeInterval:1.0f];\n});\n\ndispatch_group_notify(group, concurrentQueue, ^{\n    NSLog(@\"5\");//\"1234\"全部打印后，才会打印5\n});\n\n//使用dispatch_group_wait\ndispatch_group_t group = dispatch_group_create();\ndispatch_queue_t concurrentQueue = dispatch_queue_create(\"myQueue\", DISPATCH_QUEUE_CONCURRENT);\ndispatch_group_async(group, concurrentQueue, ^{\n    NSLog(@\"1\");\n    [NSThread sleepForTimeInterval:1.0f];\n});\ndispatch_group_async(group, concurrentQueue, ^{\n    NSLog(@\"2\");\n    [NSThread sleepForTimeInterval:1.0f];\n});\ndispatch_group_async(group, concurrentQueue, ^{\n    NSLog(@\"3\");\n    [NSThread sleepForTimeInterval:1.0f];\n});\ndispatch_group_async(group, concurrentQueue, ^{\n    NSLog(@\"4\");\n    [NSThread sleepForTimeInterval:1.0f];\n});\n\ndispatch_group_wait(group, DISPATCH_TIME_FOREVER);\n\nNSLog(@\"haha\");//\"dispatch_group_wait\"会阻塞线程，所有haha会在\"1234\"之后打印\n```\n\n* diapatch_once：执行一次\n* dispatch_apply：按照指定的次数将指定的Block追加到指定的DispatchQueue中，并等待全部处理执行结束\n```objectivec\ndispatch_apply(10, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(size_t t) {\n    NSLog(@\"%zu\", t);\n    [NSThread sleepForTimeInterval:1.0f];\n});\nNSLog(@\"haha\");//等待dispatch_apply中的所有任务都执行完之后才会带引\"haha\"\n```\n\n* dispatch_suspend / dispatch_resume\n\t* dispatch_suspend：挂起指定的队列\n\t* dispatch_resume：恢复指定的队列\n* Dispatch Semaphore：信号量，用于排他控制\n```objectivec\ndispatch_semaphore_t semaphore = dispatch_semaphore_create(1);\n\nfor (int i = 0; i < 10; i++) {\n    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{\n\n        long result = dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER);\n        //排他，同时只能有一个线程进入这个代码块，相当于锁\n        NSLog(@\"end wait, result:%ld\", result);\n        [NSThread sleepForTimeInterval:1.0f];\n\n        dispatch_semaphore_signal(semaphore);\n    });\n}\n```\n\n## NSOperation\n### 基本用法\n* NSBlockOperation：以Block的形式定义任务\n```objectivec\n@interface testOperation ()\n@property (nonatomic, strong) NSOperationQueue * queue;\n@end\n\n@implementation testOperation\n\n- (void)startTest {\n\n    //创建操作\n    NSOperation * oper1 = [NSBlockOperation blockOperationWithBlock:^{\n        NSLog(@\"test block operation1, current thread:%@\", [NSThread currentThread]);\n        [NSThread sleepForTimeInterval:1.0f];\n    }];\n\n    NSOperation * oper2 = [NSBlockOperation blockOperationWithBlock:^{\n        NSLog(@\"test block operation2, current thread:%@\", [NSThread currentThread]);\n        [NSThread sleepForTimeInterval:1.0f];\n    }];\n\n    NSOperation * oper3 = [NSBlockOperation blockOperationWithBlock:^{\n        NSLog(@\"test block operation3, current thread:%@\", [NSThread currentThread]);\n        [NSThread sleepForTimeInterval:1.0f];\n    }];\n\n    NSOperation * oper4 = [NSBlockOperation blockOperationWithBlock:^{\n        NSLog(@\"test block operation4, current thread:%@\", [NSThread currentThread]);\n        [NSThread sleepForTimeInterval:1.0f];\n    }];\n\n    self.queue = [[NSOperationQueue alloc] init];\n    //将操作加入队列中，操作就会在队列中并发执行，NSOperationQueue默认是并发队列\n    [self.queue addOperation:oper1];\n    [self.queue addOperation:oper2];\n    [self.queue addOperation:oper3];\n    [self.queue addOperation:oper4];\n}\n@end\n```\n\n* NSInvocationOperation\n```objectivec\n@interface testOperation ()\n@property (nonatomic, strong) NSOperationQueue * queue;\n@end\n\n@implementation testOperation\n\n- (void)startTest {\n\n    NSMethodSignature * sig = [[self class] instanceMethodSignatureForSelector:@selector(oper1Fun:andObj2:)];\n    NSInvocation * invo = [NSInvocation invocationWithMethodSignature:sig];\n    [invo setTarget:self];\n    [invo setSelector:@selector(oper1Fun:andObj2:)];\n    NSString * arg1 = @\"haha\";\n    NSString * arg2 = @\"oooo\";\n    [invo setArgument:&arg1 atIndex:2];\n    [invo setArgument:&arg2 atIndex:3];\n    NSOperation * oper1 = [[NSInvocationOperation alloc] initWithInvocation:invo];\n\n    NSOperation * oper2 = [[NSInvocationOperation alloc] initWithTarget:self selector:@selector(oper2Fun) object:nil];\n\n    self.queue = [[NSOperationQueue alloc] init];\n    [self.queue addOperation:oper1];\n    [self.queue addOperation:oper2];\n}\n\n- (void)oper1Fun:(id)obj1 andObj2:(id)obj2 {\n    NSLog(@\"test invocation operation1, current thread:%@, obj1:%@, obj2:%@\", [NSThread currentThread], obj1, obj2);\n    [NSThread sleepForTimeInterval:1.0f];\n}\n\n- (void)oper2Fun {\n    NSLog(@\"test invocation operation2, current thread:%@\", [NSThread currentThread]);\n}\n@end\n```\n\n* 继承NSOperation，重写main方法\n```objectivec\n@interface MyOperation : NSOperation\n@end\n\n@implementation MyOperation\n- (void)main {\n    NSLog(@\"MyOperation, current thread:%@\", [NSThread currentThread]);\n    [NSThread sleepForTimeInterval:1.0f];\n}\n@end\n\n//main.m\nNSOperationQueue * queue = [[NSOperationQueue alloc] init];\n\nMyOperation * op1 = [[MyOperation alloc] init];\nMyOperation * op2 = [[MyOperation alloc] init];\nMyOperation * op3 = [[MyOperation alloc] init];\nMyOperation * op4 = [[MyOperation alloc] init];\nMyOperation * op5 = [[MyOperation alloc] init];\nMyOperation * op6 = [[MyOperation alloc] init];\n\n[queue addOperation:op1];\n[queue addOperation:op2];\n[queue addOperation:op3];\n[queue addOperation:op4];\n[queue addOperation:op5];\n[queue addOperation:op6];\n```\n\n### 其他用法\n* 设置最大并发数\n`self.queue.maxConcurrentOperationCount = 3;`\n* 设置操作之间的依赖关系\n`[oper2 addDependency:oper1];//oper2依赖于oper1，即必须oper1执行完之后才能执行oper2`\n* 手动管理NSOperation\n\t* 运行一个Operation：`- (void)start;`默认的start方法会直接进行一些异常判断，然后直接调用`- (void)main;`\n\t* 取消一个Operation：`- (void)cancel;`调用cancel方法并不会停止操作的执行，这取决于main方法中对cancel的处理。如果在main方法中没有对cancel进行处理，发送cancel消息是没有任何效果的\n```objectivec\n//MyOperation.m\n@implementation MyOperation\n\n- (void)start {\n    [NSThread detachNewThreadSelector:@selector(main) toTarget:self withObject:nil];\n}\n\n- (void)main {\n    NSInteger index = 0;\n    while (1) {\n        NSLog(@\"current thread:%@, index:%ld\", [NSThread currentThread], index++);\n        if (self.isCancelled) {\n            NSLog(@\"cancel\");\n            return;\n        }\n        [NSThread sleepForTimeInterval:1.0f];\n    }\n}\n@end\n\n//main.m\nMyOperation * op1 = [[MyOperation alloc] init];\n[op1 start];\n[NSThread sleepForTimeInterval:3.0f];\n[op1 cancel];\n```\n","source":"_posts/2015-10-04-iOS中的多线程编程.md","raw":"---\nlayout: post\ntitle: \"iOS中的多线程编程\"\ncategories: \"iOS开发\"\n---\n\n## 关于多线程编程\n\n### 什么是多线程\n简单的来说，并发应用程序中一个单独的执行路径，就是一个线程。\n### 相关术语\n* 进程：用于指代一个正在运行的可执行程序，它可以包含多个线程。\n* 任务：用于指代抽象的概念，表示需要执行工作。\n* 线程的同步：同步就是协同步调，按预定的先后次序进行运行。线程的同步即一个线程执行完指定操作后，另个一个线程再执行。\n* 线程的互斥：线程互斥是指某一资源同时只允许一个访问者对其进行访问，具有唯一性和排它性。\n### iOS中的多线程编程\n* pthread（POSIX threads）：一套C语言接口，定义了创建和管理线程的API，非常灵活，可以直接操作线程。\n* NSThread：一套OC接口，需要自己手动管理线程，比GCD和NSOperation更加轻量级。\n* GCD：是iOS4出的一套并发编程的接口，纯C语言接口。以队列为基础。\n* NSOperation：一套面向对象的OC API，不需要手动管理线程。能实现一些GCD实现不了的功能。\n\n## NSThread\n### 基本操作\n#### 线程的创建\n* 类方法创建线程\n```objectivec\n[NSThread detachNewThreadSelector:@selector(threadFun:) toTarget:self withObject:@\"helloworld\"];\n```\n\n* 实例方法创建线程\n```objectivec\nNSThread * th = [[NSThread alloc] initWithTarget:self selector:@selector(threadFun:) object:@\"helloworld\"];\n    [th start];\n```\n\n* 继承NSThread，重写main方法(与NSOperation类似)\n```objectivec\n//MyThread.h\n@interface MyThread : NSThread\n@end\n\n//MyThread.m\n@implementation MyThread\n- (void)main {\n    NSLog(@\"this is MyThread\");\n}\n\n//main.m\n#import <Foundation/Foundation.h>\n#import \"MyThread.h\"\n\nint main(int argc, const char * argv[]) {\n    @autoreleasepool {\n        MyThread * th = [[MyThread alloc] init];\n        [th start];\n        [[NSRunLoop mainRunLoop] run];\n    }\n    return 0;\n}\n@end\n```\n\n* 其他：NSObject中的方法\n```objectivec\n - (void)performSelectorInBackground:(SEL)aSelector withObject:(id)arg;\n```\n\n####线程的基本管理\n* 获取主线程`+ (NSThread *)mainThread`\n* 获取当前线程`+ (NSThread *)currentThread;`\n* 阻塞当前线程`+ (void)sleepUntilDate:(NSDate *)date;`和`+ (void)sleepForTimeInterval:(NSTimeInterval)ti;`\n* 销毁消除当前线程（currentThread）`+ (void)exit;`\n* 取消线程`- (void)cancel;`：将线程的状体置为cancelled，并不会停止线程的执行\n* 线程键的通讯\n```objectivec\n- (void)performSelectorOnMainThread:(SEL)aSelector withObject:(id)arg waitUntilDone:(BOOL)wait;\n- (void)performSelector:(SEL)aSelector onThread:(NSThread *)thr withObject:(id)arg waitUntilDone:(BOOL)wait;\n```\n\n### 线程同步与互斥\n#### 锁\n* @synchronized（obj）对代码段进行加锁，同时只能一个线程访问该代码段\n```objectivec\n@synchronized(self) {\n    i++;\n    NSLog(@\"%ld\", i);\n}\n```\n\n* NSLock：与@synchronized类似\n```objectivec\nNSLock * lock = [[NSLock alloc] init];\nif ([lock tryLock]) {\n    [lock lock];\n    i++;\n    NSLog(@\"%ld\", i);\n    [lock unlock];\n}\n```\n\n* NSConditionLock条件锁：在所的基础上添加了条件，只有满足对应的条件，才能打开相应的锁\n```objectivec\n- (void)startTest {\n    _conLock = [[NSConditionLock alloc] init];\n    [NSThread detachNewThreadSelector:@selector(threadFun:) toTarget:self withObject:@\"top thread\"];\n    for (int i = 0; i < 200; i++) {\n        [NSThread detachNewThreadSelector:@selector(threadFun2:) toTarget:self withObject:@(i)];\n    }\n}\n\n- (void)threadFun:(id)obj {\n\n    [_conLock lock];\n    NSLog(@\"%@\", obj);\n    [NSThread sleepForTimeInterval:1.0f];\n    //加锁，条件为10\n    [_conLock unlockWithCondition:10];\n}\n\n- (void)threadFun2:(id)obj {\n    NSInteger value = [obj integerValue];\n\n    //只有到value等于10时，才能成功加锁，否则阻塞\n    [_conLock lockWhenCondition:value];\n    NSLog(@\"thread%@\", obj);\n    [NSThread sleepForTimeInterval:1.0f];\n    //解锁，并把条件设为value + 3,则下次上锁的条件为13，一次类推13,16,19...\n    [_conLock unlockWithCondition:value + 3];\n}\n```\n\n输出结果：\n\n![这里写图片描述](http://img.blog.csdn.net/20150410103408108)\n\n* NSRecursiveLock递归锁：同一个线程中，递归或多次调用加锁代码段，不会造成死锁\n```objectivec\nj = 0;\n[NSThread detachNewThreadSelector:@selector(threadFun:) toTarget:self withObject:@\"top thread1\"];\n[NSThread detachNewThreadSelector:@selector(threadFun:) toTarget:self withObject:@\"top thread2\"];\n\n- (void)threadFun:(id)obj {\n    [self testWith:obj];\n}\n\n- (void)testWith:(id)obj {\n    [_recLock lock];\n    NSLog(@\"test recursive,thread:%@, lock:%ld\", obj, j++);\n    [NSThread sleepForTimeInterval:1.0f];\n    if (j < 10) {\n        [self testWith:obj];\n    }\n    [_recLock unlock];\n}\n```\n\n输出结果：\n\n![这里写图片描述](http://img.blog.csdn.net/20150410104742410)\n\n* NSDistributedLock分布式锁：用于多个进程之间互斥访问资源，一般用于Mac开发\n\n#### 条件\n使用NSCondition，可以实现多线程的同步，解决类似生产者消费者问题。\n```objectivec\n#import \"testThread.h\"\n\n@implementation testThread\n{\n    NSInteger i;\n    NSCondition * _con;\n    NSMutableArray * _products;\n}\n\n- (void)startTest {\n    _con = [[NSCondition alloc] init];\n    _products = [[NSMutableArray alloc] init];\n    [NSThread detachNewThreadSelector:@selector(threadFun2:) toTarget:self withObject:@\"thread2\"];\n    [NSThread detachNewThreadSelector:@selector(threadFun2:) toTarget:self withObject:@\"thread3\"];\n    [NSThread detachNewThreadSelector:@selector(threadFun1:) toTarget:self withObject:@\"thread1\"];\n}\n\n- (void)threadFun1:(id)obj {\n    while (1) {\n        [NSThread sleepForTimeInterval:2.0f];\n        [_products addObject:@\"apple\"];//生产者创造一个产品\n        NSLog(@\"%@ add one product, product count:%ld\", obj, _products.count);\n        [_con signal];//通知消费者，消费产品\n//        [_con broadcast];\n    }\n}\n\n- (void)threadFun2:(id)obj {\n    while (1) {\n        [_con lock];\n        [_con wait];//等待生产者的通知\n        [_products removeObjectAtIndex:0];//消费者消费一个产品\n        NSLog(@\"%@ remove one product, proudct count:%ld\", obj, _products.count);\n        [_con unlock];\n    }\n}\n\n@end\n```\n\n## GCD\n### 基本用法\n#### 队列\n* 串行队列：同时只能执行一个任务\n\t* 所有任务都在同一个线程中执行，FIFO\n\t* 多个串行队列之间是并行执行的，会占用多个线程\n\t* 创建串行队列：`dispatch_queue_t serialQueue = dispatch_queue_create(\"myQueue\", DISPATCH_QUEUE_SERIAL);`\n\t* `dispatch_get_main_queue();`获取主线程上的一个全局可用的串行队列\n* 并行队列：同时可以执行多个任务\n\t* 多个任务在不同的线程上执行，最大并发数（最多起的线程数）由操作系统根据当前的系统状态决定，不可手动设置（NSOperation可以）\n\t* 创建并行队列：`dispatch_queue_t concurrentQueue = dispatch_queue_create(\"myQueue\", DISPATCH_QUEUE_CONCURRENT);`\n\t* `dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);`获取一个全局可用的并行队列\n#### 任务\n* 同步任务：添加一个任务后，需要等待任务执行完后才能返回\n\t* 无论是串行队列还是并行队列，同步任务都是在主线程上执行的\n\t* 同步任务会阻塞当前线程\n\t* 向主队列中添加同步任务会造成**死锁**，见死锁①\n\t* 向串行队列中添加嵌套的同步任务会造成**死锁**，见死锁②\n```objectivec\n//同步任务\ndispatch_sync(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{\n            [NSThread sleepForTimeInterval:1.0f];\n            //先打印\n            NSLog(@\"thread:%@\", [NSThread currentThread]);\n        });\nNSLog(@\"haha\");//后打印\n\n//死锁①\ndispatch_sync(dispatch_get_main_queue(), ^{\n            [NSThread sleepForTimeInterval:1.0f];\n            NSLog(@\"thread:%@\", [NSThread currentThread]);\n        });        \nNSLog(@\"haha\");//造成死锁，haha永远不会打印\n\n//死锁②\ndispatch_queue_t serialQueue = dispatch_queue_create(\"myQueue\", DISPATCH_QUEUE_SERIAL);\ndispatch_sync(serialQueue, ^{\n            NSLog(@\"thread1:%@\", [NSThread currentThread]);\n            dispatch_sync(serialQueue, ^{\n                NSLog(@\"thread2:%@\", [NSThread currentThread]);//造成死锁，thread2永远不会打印\n            });\n        });\n```\n\n* 异步任务：添加一个任务后不需要等待任务执行完成\n```objectivec\n//异步任务\ndispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{\n            [NSThread sleepForTimeInterval:1.0f];\n            //后打印\n            NSLog(@\"thread:%@\", [NSThread currentThread]);\n        });\nNSLog(@\"haha\");//先打印\n```\n\n### 其他用法\n* dispatch_after：延迟指定的时间后，将任务添加到指定的队列中\n```objectivec\ndispatch_time_t time = dispatch_time(DISPATCH_TIME_NOW, (int64_t)(10.0f * NSEC_PER_SEC));\ndispatch_after(time, dispatch_get_main_queue(), ^{\n    NSLog(@\"haha\");\n});\n```\n\n* dispatch_group：将多个任务或队列归为一组，在这组的所有任务都执行完之后再执行后面的操作\n\t* dispatch_group_async函数：创建一个指定队列中的异步任务，并将其添加到指定组中\n\t* dispatch_group_notify函数：指定组中所有任务都执行完后，会执行该函数所指定的的任务\n\t* dispatch_group_wait函数：阻塞当前线程，等待group中所有任务执行完毕\n```objectivec\n//使用dispatch_group_notify\ndispatch_group_t group = dispatch_group_create();\ndispatch_queue_t concurrentQueue = dispatch_queue_create(\"myQueue\", DISPATCH_QUEUE_CONCURRENT);\ndispatch_group_async(group, concurrentQueue, ^{\n    NSLog(@\"1\");\n    [NSThread sleepForTimeInterval:1.0f];\n});\ndispatch_group_async(group, concurrentQueue, ^{\n    NSLog(@\"2\");\n    [NSThread sleepForTimeInterval:1.0f];\n});\ndispatch_group_async(group, concurrentQueue, ^{\n    NSLog(@\"3\");\n    [NSThread sleepForTimeInterval:1.0f];\n});\ndispatch_group_async(group, concurrentQueue, ^{\n    NSLog(@\"4\");\n    [NSThread sleepForTimeInterval:1.0f];\n});\n\ndispatch_group_notify(group, concurrentQueue, ^{\n    NSLog(@\"5\");//\"1234\"全部打印后，才会打印5\n});\n\n//使用dispatch_group_wait\ndispatch_group_t group = dispatch_group_create();\ndispatch_queue_t concurrentQueue = dispatch_queue_create(\"myQueue\", DISPATCH_QUEUE_CONCURRENT);\ndispatch_group_async(group, concurrentQueue, ^{\n    NSLog(@\"1\");\n    [NSThread sleepForTimeInterval:1.0f];\n});\ndispatch_group_async(group, concurrentQueue, ^{\n    NSLog(@\"2\");\n    [NSThread sleepForTimeInterval:1.0f];\n});\ndispatch_group_async(group, concurrentQueue, ^{\n    NSLog(@\"3\");\n    [NSThread sleepForTimeInterval:1.0f];\n});\ndispatch_group_async(group, concurrentQueue, ^{\n    NSLog(@\"4\");\n    [NSThread sleepForTimeInterval:1.0f];\n});\n\ndispatch_group_wait(group, DISPATCH_TIME_FOREVER);\n\nNSLog(@\"haha\");//\"dispatch_group_wait\"会阻塞线程，所有haha会在\"1234\"之后打印\n```\n\n* diapatch_once：执行一次\n* dispatch_apply：按照指定的次数将指定的Block追加到指定的DispatchQueue中，并等待全部处理执行结束\n```objectivec\ndispatch_apply(10, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(size_t t) {\n    NSLog(@\"%zu\", t);\n    [NSThread sleepForTimeInterval:1.0f];\n});\nNSLog(@\"haha\");//等待dispatch_apply中的所有任务都执行完之后才会带引\"haha\"\n```\n\n* dispatch_suspend / dispatch_resume\n\t* dispatch_suspend：挂起指定的队列\n\t* dispatch_resume：恢复指定的队列\n* Dispatch Semaphore：信号量，用于排他控制\n```objectivec\ndispatch_semaphore_t semaphore = dispatch_semaphore_create(1);\n\nfor (int i = 0; i < 10; i++) {\n    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{\n\n        long result = dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER);\n        //排他，同时只能有一个线程进入这个代码块，相当于锁\n        NSLog(@\"end wait, result:%ld\", result);\n        [NSThread sleepForTimeInterval:1.0f];\n\n        dispatch_semaphore_signal(semaphore);\n    });\n}\n```\n\n## NSOperation\n### 基本用法\n* NSBlockOperation：以Block的形式定义任务\n```objectivec\n@interface testOperation ()\n@property (nonatomic, strong) NSOperationQueue * queue;\n@end\n\n@implementation testOperation\n\n- (void)startTest {\n\n    //创建操作\n    NSOperation * oper1 = [NSBlockOperation blockOperationWithBlock:^{\n        NSLog(@\"test block operation1, current thread:%@\", [NSThread currentThread]);\n        [NSThread sleepForTimeInterval:1.0f];\n    }];\n\n    NSOperation * oper2 = [NSBlockOperation blockOperationWithBlock:^{\n        NSLog(@\"test block operation2, current thread:%@\", [NSThread currentThread]);\n        [NSThread sleepForTimeInterval:1.0f];\n    }];\n\n    NSOperation * oper3 = [NSBlockOperation blockOperationWithBlock:^{\n        NSLog(@\"test block operation3, current thread:%@\", [NSThread currentThread]);\n        [NSThread sleepForTimeInterval:1.0f];\n    }];\n\n    NSOperation * oper4 = [NSBlockOperation blockOperationWithBlock:^{\n        NSLog(@\"test block operation4, current thread:%@\", [NSThread currentThread]);\n        [NSThread sleepForTimeInterval:1.0f];\n    }];\n\n    self.queue = [[NSOperationQueue alloc] init];\n    //将操作加入队列中，操作就会在队列中并发执行，NSOperationQueue默认是并发队列\n    [self.queue addOperation:oper1];\n    [self.queue addOperation:oper2];\n    [self.queue addOperation:oper3];\n    [self.queue addOperation:oper4];\n}\n@end\n```\n\n* NSInvocationOperation\n```objectivec\n@interface testOperation ()\n@property (nonatomic, strong) NSOperationQueue * queue;\n@end\n\n@implementation testOperation\n\n- (void)startTest {\n\n    NSMethodSignature * sig = [[self class] instanceMethodSignatureForSelector:@selector(oper1Fun:andObj2:)];\n    NSInvocation * invo = [NSInvocation invocationWithMethodSignature:sig];\n    [invo setTarget:self];\n    [invo setSelector:@selector(oper1Fun:andObj2:)];\n    NSString * arg1 = @\"haha\";\n    NSString * arg2 = @\"oooo\";\n    [invo setArgument:&arg1 atIndex:2];\n    [invo setArgument:&arg2 atIndex:3];\n    NSOperation * oper1 = [[NSInvocationOperation alloc] initWithInvocation:invo];\n\n    NSOperation * oper2 = [[NSInvocationOperation alloc] initWithTarget:self selector:@selector(oper2Fun) object:nil];\n\n    self.queue = [[NSOperationQueue alloc] init];\n    [self.queue addOperation:oper1];\n    [self.queue addOperation:oper2];\n}\n\n- (void)oper1Fun:(id)obj1 andObj2:(id)obj2 {\n    NSLog(@\"test invocation operation1, current thread:%@, obj1:%@, obj2:%@\", [NSThread currentThread], obj1, obj2);\n    [NSThread sleepForTimeInterval:1.0f];\n}\n\n- (void)oper2Fun {\n    NSLog(@\"test invocation operation2, current thread:%@\", [NSThread currentThread]);\n}\n@end\n```\n\n* 继承NSOperation，重写main方法\n```objectivec\n@interface MyOperation : NSOperation\n@end\n\n@implementation MyOperation\n- (void)main {\n    NSLog(@\"MyOperation, current thread:%@\", [NSThread currentThread]);\n    [NSThread sleepForTimeInterval:1.0f];\n}\n@end\n\n//main.m\nNSOperationQueue * queue = [[NSOperationQueue alloc] init];\n\nMyOperation * op1 = [[MyOperation alloc] init];\nMyOperation * op2 = [[MyOperation alloc] init];\nMyOperation * op3 = [[MyOperation alloc] init];\nMyOperation * op4 = [[MyOperation alloc] init];\nMyOperation * op5 = [[MyOperation alloc] init];\nMyOperation * op6 = [[MyOperation alloc] init];\n\n[queue addOperation:op1];\n[queue addOperation:op2];\n[queue addOperation:op3];\n[queue addOperation:op4];\n[queue addOperation:op5];\n[queue addOperation:op6];\n```\n\n### 其他用法\n* 设置最大并发数\n`self.queue.maxConcurrentOperationCount = 3;`\n* 设置操作之间的依赖关系\n`[oper2 addDependency:oper1];//oper2依赖于oper1，即必须oper1执行完之后才能执行oper2`\n* 手动管理NSOperation\n\t* 运行一个Operation：`- (void)start;`默认的start方法会直接进行一些异常判断，然后直接调用`- (void)main;`\n\t* 取消一个Operation：`- (void)cancel;`调用cancel方法并不会停止操作的执行，这取决于main方法中对cancel的处理。如果在main方法中没有对cancel进行处理，发送cancel消息是没有任何效果的\n```objectivec\n//MyOperation.m\n@implementation MyOperation\n\n- (void)start {\n    [NSThread detachNewThreadSelector:@selector(main) toTarget:self withObject:nil];\n}\n\n- (void)main {\n    NSInteger index = 0;\n    while (1) {\n        NSLog(@\"current thread:%@, index:%ld\", [NSThread currentThread], index++);\n        if (self.isCancelled) {\n            NSLog(@\"cancel\");\n            return;\n        }\n        [NSThread sleepForTimeInterval:1.0f];\n    }\n}\n@end\n\n//main.m\nMyOperation * op1 = [[MyOperation alloc] init];\n[op1 start];\n[NSThread sleepForTimeInterval:3.0f];\n[op1 cancel];\n```\n","slug":"iOS中的多线程编程","published":1,"date":"2015-10-03T16:00:00.000Z","updated":"2017-03-01T06:42:53.000Z","comments":1,"photos":[],"link":"","_id":"cjutyfmjq006zc4c9zupf1mgz","content":"<h2 id=\"关于多线程编程\"><a href=\"#关于多线程编程\" class=\"headerlink\" title=\"关于多线程编程\"></a>关于多线程编程</h2><h3 id=\"什么是多线程\"><a href=\"#什么是多线程\" class=\"headerlink\" title=\"什么是多线程\"></a>什么是多线程</h3><p>简单的来说，并发应用程序中一个单独的执行路径，就是一个线程。</p>\n<h3 id=\"相关术语\"><a href=\"#相关术语\" class=\"headerlink\" title=\"相关术语\"></a>相关术语</h3><ul>\n<li>进程：用于指代一个正在运行的可执行程序，它可以包含多个线程。</li>\n<li>任务：用于指代抽象的概念，表示需要执行工作。</li>\n<li>线程的同步：同步就是协同步调，按预定的先后次序进行运行。线程的同步即一个线程执行完指定操作后，另个一个线程再执行。</li>\n<li>线程的互斥：线程互斥是指某一资源同时只允许一个访问者对其进行访问，具有唯一性和排它性。<h3 id=\"iOS中的多线程编程\"><a href=\"#iOS中的多线程编程\" class=\"headerlink\" title=\"iOS中的多线程编程\"></a>iOS中的多线程编程</h3></li>\n<li>pthread（POSIX threads）：一套C语言接口，定义了创建和管理线程的API，非常灵活，可以直接操作线程。</li>\n<li>NSThread：一套OC接口，需要自己手动管理线程，比GCD和NSOperation更加轻量级。</li>\n<li>GCD：是iOS4出的一套并发编程的接口，纯C语言接口。以队列为基础。</li>\n<li>NSOperation：一套面向对象的OC API，不需要手动管理线程。能实现一些GCD实现不了的功能。</li>\n</ul>\n<h2 id=\"NSThread\"><a href=\"#NSThread\" class=\"headerlink\" title=\"NSThread\"></a>NSThread</h2><h3 id=\"基本操作\"><a href=\"#基本操作\" class=\"headerlink\" title=\"基本操作\"></a>基本操作</h3><h4 id=\"线程的创建\"><a href=\"#线程的创建\" class=\"headerlink\" title=\"线程的创建\"></a>线程的创建</h4><ul>\n<li><p>类方法创建线程</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"built_in\">NSThread</span> detachNewThreadSelector:<span class=\"keyword\">@selector</span>(threadFun:) toTarget:<span class=\"keyword\">self</span> withObject:<span class=\"string\">@\"helloworld\"</span>];</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>实例方法创建线程</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">NSThread</span> * th = [[<span class=\"built_in\">NSThread</span> alloc] initWithTarget:<span class=\"keyword\">self</span> selector:<span class=\"keyword\">@selector</span>(threadFun:) object:<span class=\"string\">@\"helloworld\"</span>];</span><br><span class=\"line\">    [th start];</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>继承NSThread，重写main方法(与NSOperation类似)</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//MyThread.h</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">MyThread</span> : <span class=\"title\">NSThread</span></span></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//MyThread.m</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">MyThread</span></span></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)main &#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"this is MyThread\"</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//main.m</span></span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">\"MyThread.h\"</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">int</span> main(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">const</span> <span class=\"keyword\">char</span> * argv[]) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">@autoreleasepool</span> &#123;</span><br><span class=\"line\">        MyThread * th = [[MyThread alloc] init];</span><br><span class=\"line\">        [th start];</span><br><span class=\"line\">        [[<span class=\"built_in\">NSRunLoop</span> mainRunLoop] run];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>其他：NSObject中的方法</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)performSelectorInBackground:(SEL)aSelector withObject:(<span class=\"keyword\">id</span>)arg;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>####线程的基本管理</p>\n<ul>\n<li>获取主线程<code>+ (NSThread *)mainThread</code></li>\n<li>获取当前线程<code>+ (NSThread *)currentThread;</code></li>\n<li>阻塞当前线程<code>+ (void)sleepUntilDate:(NSDate *)date;</code>和<code>+ (void)sleepForTimeInterval:(NSTimeInterval)ti;</code></li>\n<li>销毁消除当前线程（currentThread）<code>+ (void)exit;</code></li>\n<li>取消线程<code>- (void)cancel;</code>：将线程的状体置为cancelled，并不会停止线程的执行</li>\n<li>线程键的通讯<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)performSelectorOnMainThread:(SEL)aSelector withObject:(<span class=\"keyword\">id</span>)arg waitUntilDone:(<span class=\"built_in\">BOOL</span>)wait;</span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)performSelector:(SEL)aSelector onThread:(<span class=\"built_in\">NSThread</span> *)thr withObject:(<span class=\"keyword\">id</span>)arg waitUntilDone:(<span class=\"built_in\">BOOL</span>)wait;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h3 id=\"线程同步与互斥\"><a href=\"#线程同步与互斥\" class=\"headerlink\" title=\"线程同步与互斥\"></a>线程同步与互斥</h3><h4 id=\"锁\"><a href=\"#锁\" class=\"headerlink\" title=\"锁\"></a>锁</h4><ul>\n<li><p>@synchronized（obj）对代码段进行加锁，同时只能一个线程访问该代码段</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">@synchronized</span>(<span class=\"keyword\">self</span>) &#123;</span><br><span class=\"line\">    i++;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%ld\"</span>, i);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>NSLock：与@synchronized类似</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">NSLock</span> * lock = [[<span class=\"built_in\">NSLock</span> alloc] init];</span><br><span class=\"line\"><span class=\"keyword\">if</span> ([lock tryLock]) &#123;</span><br><span class=\"line\">    [lock lock];</span><br><span class=\"line\">    i++;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%ld\"</span>, i);</span><br><span class=\"line\">    [lock unlock];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>NSConditionLock条件锁：在所的基础上添加了条件，只有满足对应的条件，才能打开相应的锁</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)startTest &#123;</span><br><span class=\"line\">    _conLock = [[<span class=\"built_in\">NSConditionLock</span> alloc] init];</span><br><span class=\"line\">    [<span class=\"built_in\">NSThread</span> detachNewThreadSelector:<span class=\"keyword\">@selector</span>(threadFun:) toTarget:<span class=\"keyword\">self</span> withObject:<span class=\"string\">@\"top thread\"</span>];</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">200</span>; i++) &#123;</span><br><span class=\"line\">        [<span class=\"built_in\">NSThread</span> detachNewThreadSelector:<span class=\"keyword\">@selector</span>(threadFun2:) toTarget:<span class=\"keyword\">self</span> withObject:@(i)];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)threadFun:(<span class=\"keyword\">id</span>)obj &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    [_conLock lock];</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%@\"</span>, obj);</span><br><span class=\"line\">    [<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">1.0</span>f];</span><br><span class=\"line\">    <span class=\"comment\">//加锁，条件为10</span></span><br><span class=\"line\">    [_conLock unlockWithCondition:<span class=\"number\">10</span>];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)threadFun2:(<span class=\"keyword\">id</span>)obj &#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSInteger</span> value = [obj integerValue];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//只有到value等于10时，才能成功加锁，否则阻塞</span></span><br><span class=\"line\">    [_conLock lockWhenCondition:value];</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"thread%@\"</span>, obj);</span><br><span class=\"line\">    [<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">1.0</span>f];</span><br><span class=\"line\">    <span class=\"comment\">//解锁，并把条件设为value + 3,则下次上锁的条件为13，一次类推13,16,19...</span></span><br><span class=\"line\">    [_conLock unlockWithCondition:value + <span class=\"number\">3</span>];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>输出结果：</p>\n<p><img src=\"http://img.blog.csdn.net/20150410103408108\" alt=\"这里写图片描述\"></p>\n<ul>\n<li>NSRecursiveLock递归锁：同一个线程中，递归或多次调用加锁代码段，不会造成死锁<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">j = <span class=\"number\">0</span>;</span><br><span class=\"line\">[<span class=\"built_in\">NSThread</span> detachNewThreadSelector:<span class=\"keyword\">@selector</span>(threadFun:) toTarget:<span class=\"keyword\">self</span> withObject:<span class=\"string\">@\"top thread1\"</span>];</span><br><span class=\"line\">[<span class=\"built_in\">NSThread</span> detachNewThreadSelector:<span class=\"keyword\">@selector</span>(threadFun:) toTarget:<span class=\"keyword\">self</span> withObject:<span class=\"string\">@\"top thread2\"</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)threadFun:(<span class=\"keyword\">id</span>)obj &#123;</span><br><span class=\"line\">    [<span class=\"keyword\">self</span> testWith:obj];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)testWith:(<span class=\"keyword\">id</span>)obj &#123;</span><br><span class=\"line\">    [_recLock lock];</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"test recursive,thread:%@, lock:%ld\"</span>, obj, j++);</span><br><span class=\"line\">    [<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">1.0</span>f];</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (j &lt; <span class=\"number\">10</span>) &#123;</span><br><span class=\"line\">        [<span class=\"keyword\">self</span> testWith:obj];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    [_recLock unlock];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>输出结果：</p>\n<p><img src=\"http://img.blog.csdn.net/20150410104742410\" alt=\"这里写图片描述\"></p>\n<ul>\n<li>NSDistributedLock分布式锁：用于多个进程之间互斥访问资源，一般用于Mac开发</li>\n</ul>\n<h4 id=\"条件\"><a href=\"#条件\" class=\"headerlink\" title=\"条件\"></a>条件</h4><p>使用NSCondition，可以实现多线程的同步，解决类似生产者消费者问题。<br><figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">\"testThread.h\"</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">testThread</span></span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSInteger</span> i;</span><br><span class=\"line\">    <span class=\"built_in\">NSCondition</span> * _con;</span><br><span class=\"line\">    <span class=\"built_in\">NSMutableArray</span> * _products;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)startTest &#123;</span><br><span class=\"line\">    _con = [[<span class=\"built_in\">NSCondition</span> alloc] init];</span><br><span class=\"line\">    _products = [[<span class=\"built_in\">NSMutableArray</span> alloc] init];</span><br><span class=\"line\">    [<span class=\"built_in\">NSThread</span> detachNewThreadSelector:<span class=\"keyword\">@selector</span>(threadFun2:) toTarget:<span class=\"keyword\">self</span> withObject:<span class=\"string\">@\"thread2\"</span>];</span><br><span class=\"line\">    [<span class=\"built_in\">NSThread</span> detachNewThreadSelector:<span class=\"keyword\">@selector</span>(threadFun2:) toTarget:<span class=\"keyword\">self</span> withObject:<span class=\"string\">@\"thread3\"</span>];</span><br><span class=\"line\">    [<span class=\"built_in\">NSThread</span> detachNewThreadSelector:<span class=\"keyword\">@selector</span>(threadFun1:) toTarget:<span class=\"keyword\">self</span> withObject:<span class=\"string\">@\"thread1\"</span>];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)threadFun1:(<span class=\"keyword\">id</span>)obj &#123;</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        [<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">2.0</span>f];</span><br><span class=\"line\">        [_products addObject:<span class=\"string\">@\"apple\"</span>];<span class=\"comment\">//生产者创造一个产品</span></span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%@ add one product, product count:%ld\"</span>, obj, _products.count);</span><br><span class=\"line\">        [_con signal];<span class=\"comment\">//通知消费者，消费产品</span></span><br><span class=\"line\"><span class=\"comment\">//        [_con broadcast];</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)threadFun2:(<span class=\"keyword\">id</span>)obj &#123;</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        [_con lock];</span><br><span class=\"line\">        [_con wait];<span class=\"comment\">//等待生产者的通知</span></span><br><span class=\"line\">        [_products removeObjectAtIndex:<span class=\"number\">0</span>];<span class=\"comment\">//消费者消费一个产品</span></span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%@ remove one product, proudct count:%ld\"</span>, obj, _products.count);</span><br><span class=\"line\">        [_con unlock];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure></p>\n<h2 id=\"GCD\"><a href=\"#GCD\" class=\"headerlink\" title=\"GCD\"></a>GCD</h2><h3 id=\"基本用法\"><a href=\"#基本用法\" class=\"headerlink\" title=\"基本用法\"></a>基本用法</h3><h4 id=\"队列\"><a href=\"#队列\" class=\"headerlink\" title=\"队列\"></a>队列</h4><ul>\n<li>串行队列：同时只能执行一个任务<ul>\n<li>所有任务都在同一个线程中执行，FIFO</li>\n<li>多个串行队列之间是并行执行的，会占用多个线程</li>\n<li>创建串行队列：<code>dispatch_queue_t serialQueue = dispatch_queue_create(&quot;myQueue&quot;, DISPATCH_QUEUE_SERIAL);</code></li>\n<li><code>dispatch_get_main_queue();</code>获取主线程上的一个全局可用的串行队列</li>\n</ul>\n</li>\n<li>并行队列：同时可以执行多个任务<ul>\n<li>多个任务在不同的线程上执行，最大并发数（最多起的线程数）由操作系统根据当前的系统状态决定，不可手动设置（NSOperation可以）</li>\n<li>创建并行队列：<code>dispatch_queue_t concurrentQueue = dispatch_queue_create(&quot;myQueue&quot;, DISPATCH_QUEUE_CONCURRENT);</code></li>\n<li><code>dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);</code>获取一个全局可用的并行队列<h4 id=\"任务\"><a href=\"#任务\" class=\"headerlink\" title=\"任务\"></a>任务</h4></li>\n</ul>\n</li>\n<li><p>同步任务：添加一个任务后，需要等待任务执行完后才能返回</p>\n<ul>\n<li>无论是串行队列还是并行队列，同步任务都是在主线程上执行的</li>\n<li>同步任务会阻塞当前线程</li>\n<li>向主队列中添加同步任务会造成<strong>死锁</strong>，见死锁①</li>\n<li>向串行队列中添加嵌套的同步任务会造成<strong>死锁</strong>，见死锁②<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//同步任务</span></span><br><span class=\"line\"><span class=\"built_in\">dispatch_sync</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class=\"number\">0</span>), ^&#123;</span><br><span class=\"line\">            [<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">1.0</span>f];</span><br><span class=\"line\">            <span class=\"comment\">//先打印</span></span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"thread:%@\"</span>, [<span class=\"built_in\">NSThread</span> currentThread]);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"><span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"haha\"</span>);<span class=\"comment\">//后打印</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//死锁①</span></span><br><span class=\"line\"><span class=\"built_in\">dispatch_sync</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class=\"line\">            [<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">1.0</span>f];</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"thread:%@\"</span>, [<span class=\"built_in\">NSThread</span> currentThread]);</span><br><span class=\"line\">        &#125;);        </span><br><span class=\"line\"><span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"haha\"</span>);<span class=\"comment\">//造成死锁，haha永远不会打印</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//死锁②</span></span><br><span class=\"line\"><span class=\"built_in\">dispatch_queue_t</span> serialQueue = dispatch_queue_create(<span class=\"string\">\"myQueue\"</span>, DISPATCH_QUEUE_SERIAL);</span><br><span class=\"line\"><span class=\"built_in\">dispatch_sync</span>(serialQueue, ^&#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"thread1:%@\"</span>, [<span class=\"built_in\">NSThread</span> currentThread]);</span><br><span class=\"line\">            <span class=\"built_in\">dispatch_sync</span>(serialQueue, ^&#123;</span><br><span class=\"line\">                <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"thread2:%@\"</span>, [<span class=\"built_in\">NSThread</span> currentThread]);<span class=\"comment\">//造成死锁，thread2永远不会打印</span></span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125;);</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n</li>\n<li><p>异步任务：添加一个任务后不需要等待任务执行完成</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//异步任务</span></span><br><span class=\"line\"><span class=\"built_in\">dispatch_async</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class=\"number\">0</span>), ^&#123;</span><br><span class=\"line\">            [<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">1.0</span>f];</span><br><span class=\"line\">            <span class=\"comment\">//后打印</span></span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"thread:%@\"</span>, [<span class=\"built_in\">NSThread</span> currentThread]);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"><span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"haha\"</span>);<span class=\"comment\">//先打印</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h3 id=\"其他用法\"><a href=\"#其他用法\" class=\"headerlink\" title=\"其他用法\"></a>其他用法</h3><ul>\n<li><p>dispatch_after：延迟指定的时间后，将任务添加到指定的队列中</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dispatch_time_t time = dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class=\"number\">10.0</span>f * <span class=\"built_in\">NSEC_PER_SEC</span>));</span><br><span class=\"line\">dispatch_after(time, dispatch_get_main_queue(), ^&#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"haha\"</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>dispatch_group：将多个任务或队列归为一组，在这组的所有任务都执行完之后再执行后面的操作</p>\n<ul>\n<li>dispatch_group_async函数：创建一个指定队列中的异步任务，并将其添加到指定组中</li>\n<li>dispatch_group_notify函数：指定组中所有任务都执行完后，会执行该函数所指定的的任务</li>\n<li>dispatch_group_wait函数：阻塞当前线程，等待group中所有任务执行完毕<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//使用dispatch_group_notify</span></span><br><span class=\"line\">dispatch_group_t group = dispatch_group_create();</span><br><span class=\"line\"><span class=\"built_in\">dispatch_queue_t</span> concurrentQueue = dispatch_queue_create(<span class=\"string\">\"myQueue\"</span>, DISPATCH_QUEUE_CONCURRENT);</span><br><span class=\"line\">dispatch_group_async(group, concurrentQueue, ^&#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"1\"</span>);</span><br><span class=\"line\">    [<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">1.0</span>f];</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">dispatch_group_async(group, concurrentQueue, ^&#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"2\"</span>);</span><br><span class=\"line\">    [<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">1.0</span>f];</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">dispatch_group_async(group, concurrentQueue, ^&#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"3\"</span>);</span><br><span class=\"line\">    [<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">1.0</span>f];</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">dispatch_group_async(group, concurrentQueue, ^&#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"4\"</span>);</span><br><span class=\"line\">    [<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">1.0</span>f];</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">dispatch_group_notify(group, concurrentQueue, ^&#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"5\"</span>);<span class=\"comment\">//\"1234\"全部打印后，才会打印5</span></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//使用dispatch_group_wait</span></span><br><span class=\"line\">dispatch_group_t group = dispatch_group_create();</span><br><span class=\"line\"><span class=\"built_in\">dispatch_queue_t</span> concurrentQueue = dispatch_queue_create(<span class=\"string\">\"myQueue\"</span>, DISPATCH_QUEUE_CONCURRENT);</span><br><span class=\"line\">dispatch_group_async(group, concurrentQueue, ^&#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"1\"</span>);</span><br><span class=\"line\">    [<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">1.0</span>f];</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">dispatch_group_async(group, concurrentQueue, ^&#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"2\"</span>);</span><br><span class=\"line\">    [<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">1.0</span>f];</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">dispatch_group_async(group, concurrentQueue, ^&#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"3\"</span>);</span><br><span class=\"line\">    [<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">1.0</span>f];</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">dispatch_group_async(group, concurrentQueue, ^&#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"4\"</span>);</span><br><span class=\"line\">    [<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">1.0</span>f];</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">dispatch_group_wait(group, DISPATCH_TIME_FOREVER);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"haha\"</span>);<span class=\"comment\">//\"dispatch_group_wait\"会阻塞线程，所有haha会在\"1234\"之后打印</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n</li>\n<li><p>diapatch_once：执行一次</p>\n</li>\n<li><p>dispatch_apply：按照指定的次数将指定的Block追加到指定的DispatchQueue中，并等待全部处理执行结束</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dispatch_apply(<span class=\"number\">10</span>, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class=\"number\">0</span>), ^(size_t t) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%zu\"</span>, t);</span><br><span class=\"line\">    [<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">1.0</span>f];</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"haha\"</span>);<span class=\"comment\">//等待dispatch_apply中的所有任务都执行完之后才会带引\"haha\"</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>dispatch_suspend / dispatch_resume</p>\n<ul>\n<li>dispatch_suspend：挂起指定的队列</li>\n<li>dispatch_resume：恢复指定的队列</li>\n</ul>\n</li>\n<li>Dispatch Semaphore：信号量，用于排他控制<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dispatch_semaphore_t semaphore = dispatch_semaphore_create(<span class=\"number\">1</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">dispatch_async</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class=\"number\">0</span>), ^&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">long</span> result = dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER);</span><br><span class=\"line\">        <span class=\"comment\">//排他，同时只能有一个线程进入这个代码块，相当于锁</span></span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"end wait, result:%ld\"</span>, result);</span><br><span class=\"line\">        [<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">1.0</span>f];</span><br><span class=\"line\"></span><br><span class=\"line\">        dispatch_semaphore_signal(semaphore);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h2 id=\"NSOperation\"><a href=\"#NSOperation\" class=\"headerlink\" title=\"NSOperation\"></a>NSOperation</h2><h3 id=\"基本用法-1\"><a href=\"#基本用法-1\" class=\"headerlink\" title=\"基本用法\"></a>基本用法</h3><ul>\n<li><p>NSBlockOperation：以Block的形式定义任务</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">testOperation</span> ()</span></span><br><span class=\"line\"><span class=\"keyword\">@property</span> (<span class=\"keyword\">nonatomic</span>, <span class=\"keyword\">strong</span>) <span class=\"built_in\">NSOperationQueue</span> * queue;</span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">testOperation</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)startTest &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//创建操作</span></span><br><span class=\"line\">    <span class=\"built_in\">NSOperation</span> * oper1 = [<span class=\"built_in\">NSBlockOperation</span> blockOperationWithBlock:^&#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"test block operation1, current thread:%@\"</span>, [<span class=\"built_in\">NSThread</span> currentThread]);</span><br><span class=\"line\">        [<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">1.0</span>f];</span><br><span class=\"line\">    &#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">NSOperation</span> * oper2 = [<span class=\"built_in\">NSBlockOperation</span> blockOperationWithBlock:^&#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"test block operation2, current thread:%@\"</span>, [<span class=\"built_in\">NSThread</span> currentThread]);</span><br><span class=\"line\">        [<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">1.0</span>f];</span><br><span class=\"line\">    &#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">NSOperation</span> * oper3 = [<span class=\"built_in\">NSBlockOperation</span> blockOperationWithBlock:^&#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"test block operation3, current thread:%@\"</span>, [<span class=\"built_in\">NSThread</span> currentThread]);</span><br><span class=\"line\">        [<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">1.0</span>f];</span><br><span class=\"line\">    &#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">NSOperation</span> * oper4 = [<span class=\"built_in\">NSBlockOperation</span> blockOperationWithBlock:^&#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"test block operation4, current thread:%@\"</span>, [<span class=\"built_in\">NSThread</span> currentThread]);</span><br><span class=\"line\">        [<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">1.0</span>f];</span><br><span class=\"line\">    &#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">self</span>.queue = [[<span class=\"built_in\">NSOperationQueue</span> alloc] init];</span><br><span class=\"line\">    <span class=\"comment\">//将操作加入队列中，操作就会在队列中并发执行，NSOperationQueue默认是并发队列</span></span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.queue addOperation:oper1];</span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.queue addOperation:oper2];</span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.queue addOperation:oper3];</span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.queue addOperation:oper4];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>NSInvocationOperation</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">testOperation</span> ()</span></span><br><span class=\"line\"><span class=\"keyword\">@property</span> (<span class=\"keyword\">nonatomic</span>, <span class=\"keyword\">strong</span>) <span class=\"built_in\">NSOperationQueue</span> * queue;</span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">testOperation</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)startTest &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">NSMethodSignature</span> * sig = [[<span class=\"keyword\">self</span> <span class=\"keyword\">class</span>] instanceMethodSignatureForSelector:<span class=\"keyword\">@selector</span>(oper1Fun:andObj2:)];</span><br><span class=\"line\">    <span class=\"built_in\">NSInvocation</span> * invo = [<span class=\"built_in\">NSInvocation</span> invocationWithMethodSignature:sig];</span><br><span class=\"line\">    [invo setTarget:<span class=\"keyword\">self</span>];</span><br><span class=\"line\">    [invo setSelector:<span class=\"keyword\">@selector</span>(oper1Fun:andObj2:)];</span><br><span class=\"line\">    <span class=\"built_in\">NSString</span> * arg1 = <span class=\"string\">@\"haha\"</span>;</span><br><span class=\"line\">    <span class=\"built_in\">NSString</span> * arg2 = <span class=\"string\">@\"oooo\"</span>;</span><br><span class=\"line\">    [invo setArgument:&amp;arg1 atIndex:<span class=\"number\">2</span>];</span><br><span class=\"line\">    [invo setArgument:&amp;arg2 atIndex:<span class=\"number\">3</span>];</span><br><span class=\"line\">    <span class=\"built_in\">NSOperation</span> * oper1 = [[<span class=\"built_in\">NSInvocationOperation</span> alloc] initWithInvocation:invo];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">NSOperation</span> * oper2 = [[<span class=\"built_in\">NSInvocationOperation</span> alloc] initWithTarget:<span class=\"keyword\">self</span> selector:<span class=\"keyword\">@selector</span>(oper2Fun) object:<span class=\"literal\">nil</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">self</span>.queue = [[<span class=\"built_in\">NSOperationQueue</span> alloc] init];</span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.queue addOperation:oper1];</span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.queue addOperation:oper2];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)oper1Fun:(<span class=\"keyword\">id</span>)obj1 andObj2:(<span class=\"keyword\">id</span>)obj2 &#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"test invocation operation1, current thread:%@, obj1:%@, obj2:%@\"</span>, [<span class=\"built_in\">NSThread</span> currentThread], obj1, obj2);</span><br><span class=\"line\">    [<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">1.0</span>f];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)oper2Fun &#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"test invocation operation2, current thread:%@\"</span>, [<span class=\"built_in\">NSThread</span> currentThread]);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>继承NSOperation，重写main方法</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">MyOperation</span> : <span class=\"title\">NSOperation</span></span></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">MyOperation</span></span></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)main &#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"MyOperation, current thread:%@\"</span>, [<span class=\"built_in\">NSThread</span> currentThread]);</span><br><span class=\"line\">    [<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">1.0</span>f];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//main.m</span></span><br><span class=\"line\"><span class=\"built_in\">NSOperationQueue</span> * queue = [[<span class=\"built_in\">NSOperationQueue</span> alloc] init];</span><br><span class=\"line\"></span><br><span class=\"line\">MyOperation * op1 = [[MyOperation alloc] init];</span><br><span class=\"line\">MyOperation * op2 = [[MyOperation alloc] init];</span><br><span class=\"line\">MyOperation * op3 = [[MyOperation alloc] init];</span><br><span class=\"line\">MyOperation * op4 = [[MyOperation alloc] init];</span><br><span class=\"line\">MyOperation * op5 = [[MyOperation alloc] init];</span><br><span class=\"line\">MyOperation * op6 = [[MyOperation alloc] init];</span><br><span class=\"line\"></span><br><span class=\"line\">[queue addOperation:op1];</span><br><span class=\"line\">[queue addOperation:op2];</span><br><span class=\"line\">[queue addOperation:op3];</span><br><span class=\"line\">[queue addOperation:op4];</span><br><span class=\"line\">[queue addOperation:op5];</span><br><span class=\"line\">[queue addOperation:op6];</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h3 id=\"其他用法-1\"><a href=\"#其他用法-1\" class=\"headerlink\" title=\"其他用法\"></a>其他用法</h3><ul>\n<li>设置最大并发数<br><code>self.queue.maxConcurrentOperationCount = 3;</code></li>\n<li>设置操作之间的依赖关系<br><code>[oper2 addDependency:oper1];//oper2依赖于oper1，即必须oper1执行完之后才能执行oper2</code></li>\n<li>手动管理NSOperation<ul>\n<li>运行一个Operation：<code>- (void)start;</code>默认的start方法会直接进行一些异常判断，然后直接调用<code>- (void)main;</code></li>\n<li>取消一个Operation：<code>- (void)cancel;</code>调用cancel方法并不会停止操作的执行，这取决于main方法中对cancel的处理。如果在main方法中没有对cancel进行处理，发送cancel消息是没有任何效果的<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//MyOperation.m</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">MyOperation</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)start &#123;</span><br><span class=\"line\">    [<span class=\"built_in\">NSThread</span> detachNewThreadSelector:<span class=\"keyword\">@selector</span>(main) toTarget:<span class=\"keyword\">self</span> withObject:<span class=\"literal\">nil</span>];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)main &#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSInteger</span> index = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"current thread:%@, index:%ld\"</span>, [<span class=\"built_in\">NSThread</span> currentThread], index++);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">self</span>.isCancelled) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"cancel\"</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        [<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">1.0</span>f];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//main.m</span></span><br><span class=\"line\">MyOperation * op1 = [[MyOperation alloc] init];</span><br><span class=\"line\">[op1 start];</span><br><span class=\"line\">[<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">3.0</span>f];</span><br><span class=\"line\">[op1 cancel];</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"关于多线程编程\"><a href=\"#关于多线程编程\" class=\"headerlink\" title=\"关于多线程编程\"></a>关于多线程编程</h2><h3 id=\"什么是多线程\"><a href=\"#什么是多线程\" class=\"headerlink\" title=\"什么是多线程\"></a>什么是多线程</h3><p>简单的来说，并发应用程序中一个单独的执行路径，就是一个线程。</p>\n<h3 id=\"相关术语\"><a href=\"#相关术语\" class=\"headerlink\" title=\"相关术语\"></a>相关术语</h3><ul>\n<li>进程：用于指代一个正在运行的可执行程序，它可以包含多个线程。</li>\n<li>任务：用于指代抽象的概念，表示需要执行工作。</li>\n<li>线程的同步：同步就是协同步调，按预定的先后次序进行运行。线程的同步即一个线程执行完指定操作后，另个一个线程再执行。</li>\n<li>线程的互斥：线程互斥是指某一资源同时只允许一个访问者对其进行访问，具有唯一性和排它性。<h3 id=\"iOS中的多线程编程\"><a href=\"#iOS中的多线程编程\" class=\"headerlink\" title=\"iOS中的多线程编程\"></a>iOS中的多线程编程</h3></li>\n<li>pthread（POSIX threads）：一套C语言接口，定义了创建和管理线程的API，非常灵活，可以直接操作线程。</li>\n<li>NSThread：一套OC接口，需要自己手动管理线程，比GCD和NSOperation更加轻量级。</li>\n<li>GCD：是iOS4出的一套并发编程的接口，纯C语言接口。以队列为基础。</li>\n<li>NSOperation：一套面向对象的OC API，不需要手动管理线程。能实现一些GCD实现不了的功能。</li>\n</ul>\n<h2 id=\"NSThread\"><a href=\"#NSThread\" class=\"headerlink\" title=\"NSThread\"></a>NSThread</h2><h3 id=\"基本操作\"><a href=\"#基本操作\" class=\"headerlink\" title=\"基本操作\"></a>基本操作</h3><h4 id=\"线程的创建\"><a href=\"#线程的创建\" class=\"headerlink\" title=\"线程的创建\"></a>线程的创建</h4><ul>\n<li><p>类方法创建线程</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"built_in\">NSThread</span> detachNewThreadSelector:<span class=\"keyword\">@selector</span>(threadFun:) toTarget:<span class=\"keyword\">self</span> withObject:<span class=\"string\">@\"helloworld\"</span>];</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>实例方法创建线程</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">NSThread</span> * th = [[<span class=\"built_in\">NSThread</span> alloc] initWithTarget:<span class=\"keyword\">self</span> selector:<span class=\"keyword\">@selector</span>(threadFun:) object:<span class=\"string\">@\"helloworld\"</span>];</span><br><span class=\"line\">    [th start];</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>继承NSThread，重写main方法(与NSOperation类似)</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//MyThread.h</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">MyThread</span> : <span class=\"title\">NSThread</span></span></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//MyThread.m</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">MyThread</span></span></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)main &#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"this is MyThread\"</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//main.m</span></span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">\"MyThread.h\"</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">int</span> main(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">const</span> <span class=\"keyword\">char</span> * argv[]) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">@autoreleasepool</span> &#123;</span><br><span class=\"line\">        MyThread * th = [[MyThread alloc] init];</span><br><span class=\"line\">        [th start];</span><br><span class=\"line\">        [[<span class=\"built_in\">NSRunLoop</span> mainRunLoop] run];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>其他：NSObject中的方法</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)performSelectorInBackground:(SEL)aSelector withObject:(<span class=\"keyword\">id</span>)arg;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>####线程的基本管理</p>\n<ul>\n<li>获取主线程<code>+ (NSThread *)mainThread</code></li>\n<li>获取当前线程<code>+ (NSThread *)currentThread;</code></li>\n<li>阻塞当前线程<code>+ (void)sleepUntilDate:(NSDate *)date;</code>和<code>+ (void)sleepForTimeInterval:(NSTimeInterval)ti;</code></li>\n<li>销毁消除当前线程（currentThread）<code>+ (void)exit;</code></li>\n<li>取消线程<code>- (void)cancel;</code>：将线程的状体置为cancelled，并不会停止线程的执行</li>\n<li>线程键的通讯<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)performSelectorOnMainThread:(SEL)aSelector withObject:(<span class=\"keyword\">id</span>)arg waitUntilDone:(<span class=\"built_in\">BOOL</span>)wait;</span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)performSelector:(SEL)aSelector onThread:(<span class=\"built_in\">NSThread</span> *)thr withObject:(<span class=\"keyword\">id</span>)arg waitUntilDone:(<span class=\"built_in\">BOOL</span>)wait;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h3 id=\"线程同步与互斥\"><a href=\"#线程同步与互斥\" class=\"headerlink\" title=\"线程同步与互斥\"></a>线程同步与互斥</h3><h4 id=\"锁\"><a href=\"#锁\" class=\"headerlink\" title=\"锁\"></a>锁</h4><ul>\n<li><p>@synchronized（obj）对代码段进行加锁，同时只能一个线程访问该代码段</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">@synchronized</span>(<span class=\"keyword\">self</span>) &#123;</span><br><span class=\"line\">    i++;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%ld\"</span>, i);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>NSLock：与@synchronized类似</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">NSLock</span> * lock = [[<span class=\"built_in\">NSLock</span> alloc] init];</span><br><span class=\"line\"><span class=\"keyword\">if</span> ([lock tryLock]) &#123;</span><br><span class=\"line\">    [lock lock];</span><br><span class=\"line\">    i++;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%ld\"</span>, i);</span><br><span class=\"line\">    [lock unlock];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>NSConditionLock条件锁：在所的基础上添加了条件，只有满足对应的条件，才能打开相应的锁</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)startTest &#123;</span><br><span class=\"line\">    _conLock = [[<span class=\"built_in\">NSConditionLock</span> alloc] init];</span><br><span class=\"line\">    [<span class=\"built_in\">NSThread</span> detachNewThreadSelector:<span class=\"keyword\">@selector</span>(threadFun:) toTarget:<span class=\"keyword\">self</span> withObject:<span class=\"string\">@\"top thread\"</span>];</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">200</span>; i++) &#123;</span><br><span class=\"line\">        [<span class=\"built_in\">NSThread</span> detachNewThreadSelector:<span class=\"keyword\">@selector</span>(threadFun2:) toTarget:<span class=\"keyword\">self</span> withObject:@(i)];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)threadFun:(<span class=\"keyword\">id</span>)obj &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    [_conLock lock];</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%@\"</span>, obj);</span><br><span class=\"line\">    [<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">1.0</span>f];</span><br><span class=\"line\">    <span class=\"comment\">//加锁，条件为10</span></span><br><span class=\"line\">    [_conLock unlockWithCondition:<span class=\"number\">10</span>];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)threadFun2:(<span class=\"keyword\">id</span>)obj &#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSInteger</span> value = [obj integerValue];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//只有到value等于10时，才能成功加锁，否则阻塞</span></span><br><span class=\"line\">    [_conLock lockWhenCondition:value];</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"thread%@\"</span>, obj);</span><br><span class=\"line\">    [<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">1.0</span>f];</span><br><span class=\"line\">    <span class=\"comment\">//解锁，并把条件设为value + 3,则下次上锁的条件为13，一次类推13,16,19...</span></span><br><span class=\"line\">    [_conLock unlockWithCondition:value + <span class=\"number\">3</span>];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>输出结果：</p>\n<p><img src=\"http://img.blog.csdn.net/20150410103408108\" alt=\"这里写图片描述\"></p>\n<ul>\n<li>NSRecursiveLock递归锁：同一个线程中，递归或多次调用加锁代码段，不会造成死锁<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">j = <span class=\"number\">0</span>;</span><br><span class=\"line\">[<span class=\"built_in\">NSThread</span> detachNewThreadSelector:<span class=\"keyword\">@selector</span>(threadFun:) toTarget:<span class=\"keyword\">self</span> withObject:<span class=\"string\">@\"top thread1\"</span>];</span><br><span class=\"line\">[<span class=\"built_in\">NSThread</span> detachNewThreadSelector:<span class=\"keyword\">@selector</span>(threadFun:) toTarget:<span class=\"keyword\">self</span> withObject:<span class=\"string\">@\"top thread2\"</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)threadFun:(<span class=\"keyword\">id</span>)obj &#123;</span><br><span class=\"line\">    [<span class=\"keyword\">self</span> testWith:obj];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)testWith:(<span class=\"keyword\">id</span>)obj &#123;</span><br><span class=\"line\">    [_recLock lock];</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"test recursive,thread:%@, lock:%ld\"</span>, obj, j++);</span><br><span class=\"line\">    [<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">1.0</span>f];</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (j &lt; <span class=\"number\">10</span>) &#123;</span><br><span class=\"line\">        [<span class=\"keyword\">self</span> testWith:obj];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    [_recLock unlock];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>输出结果：</p>\n<p><img src=\"http://img.blog.csdn.net/20150410104742410\" alt=\"这里写图片描述\"></p>\n<ul>\n<li>NSDistributedLock分布式锁：用于多个进程之间互斥访问资源，一般用于Mac开发</li>\n</ul>\n<h4 id=\"条件\"><a href=\"#条件\" class=\"headerlink\" title=\"条件\"></a>条件</h4><p>使用NSCondition，可以实现多线程的同步，解决类似生产者消费者问题。<br><figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">\"testThread.h\"</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">testThread</span></span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSInteger</span> i;</span><br><span class=\"line\">    <span class=\"built_in\">NSCondition</span> * _con;</span><br><span class=\"line\">    <span class=\"built_in\">NSMutableArray</span> * _products;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)startTest &#123;</span><br><span class=\"line\">    _con = [[<span class=\"built_in\">NSCondition</span> alloc] init];</span><br><span class=\"line\">    _products = [[<span class=\"built_in\">NSMutableArray</span> alloc] init];</span><br><span class=\"line\">    [<span class=\"built_in\">NSThread</span> detachNewThreadSelector:<span class=\"keyword\">@selector</span>(threadFun2:) toTarget:<span class=\"keyword\">self</span> withObject:<span class=\"string\">@\"thread2\"</span>];</span><br><span class=\"line\">    [<span class=\"built_in\">NSThread</span> detachNewThreadSelector:<span class=\"keyword\">@selector</span>(threadFun2:) toTarget:<span class=\"keyword\">self</span> withObject:<span class=\"string\">@\"thread3\"</span>];</span><br><span class=\"line\">    [<span class=\"built_in\">NSThread</span> detachNewThreadSelector:<span class=\"keyword\">@selector</span>(threadFun1:) toTarget:<span class=\"keyword\">self</span> withObject:<span class=\"string\">@\"thread1\"</span>];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)threadFun1:(<span class=\"keyword\">id</span>)obj &#123;</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        [<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">2.0</span>f];</span><br><span class=\"line\">        [_products addObject:<span class=\"string\">@\"apple\"</span>];<span class=\"comment\">//生产者创造一个产品</span></span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%@ add one product, product count:%ld\"</span>, obj, _products.count);</span><br><span class=\"line\">        [_con signal];<span class=\"comment\">//通知消费者，消费产品</span></span><br><span class=\"line\"><span class=\"comment\">//        [_con broadcast];</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)threadFun2:(<span class=\"keyword\">id</span>)obj &#123;</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        [_con lock];</span><br><span class=\"line\">        [_con wait];<span class=\"comment\">//等待生产者的通知</span></span><br><span class=\"line\">        [_products removeObjectAtIndex:<span class=\"number\">0</span>];<span class=\"comment\">//消费者消费一个产品</span></span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%@ remove one product, proudct count:%ld\"</span>, obj, _products.count);</span><br><span class=\"line\">        [_con unlock];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure></p>\n<h2 id=\"GCD\"><a href=\"#GCD\" class=\"headerlink\" title=\"GCD\"></a>GCD</h2><h3 id=\"基本用法\"><a href=\"#基本用法\" class=\"headerlink\" title=\"基本用法\"></a>基本用法</h3><h4 id=\"队列\"><a href=\"#队列\" class=\"headerlink\" title=\"队列\"></a>队列</h4><ul>\n<li>串行队列：同时只能执行一个任务<ul>\n<li>所有任务都在同一个线程中执行，FIFO</li>\n<li>多个串行队列之间是并行执行的，会占用多个线程</li>\n<li>创建串行队列：<code>dispatch_queue_t serialQueue = dispatch_queue_create(&quot;myQueue&quot;, DISPATCH_QUEUE_SERIAL);</code></li>\n<li><code>dispatch_get_main_queue();</code>获取主线程上的一个全局可用的串行队列</li>\n</ul>\n</li>\n<li>并行队列：同时可以执行多个任务<ul>\n<li>多个任务在不同的线程上执行，最大并发数（最多起的线程数）由操作系统根据当前的系统状态决定，不可手动设置（NSOperation可以）</li>\n<li>创建并行队列：<code>dispatch_queue_t concurrentQueue = dispatch_queue_create(&quot;myQueue&quot;, DISPATCH_QUEUE_CONCURRENT);</code></li>\n<li><code>dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);</code>获取一个全局可用的并行队列<h4 id=\"任务\"><a href=\"#任务\" class=\"headerlink\" title=\"任务\"></a>任务</h4></li>\n</ul>\n</li>\n<li><p>同步任务：添加一个任务后，需要等待任务执行完后才能返回</p>\n<ul>\n<li>无论是串行队列还是并行队列，同步任务都是在主线程上执行的</li>\n<li>同步任务会阻塞当前线程</li>\n<li>向主队列中添加同步任务会造成<strong>死锁</strong>，见死锁①</li>\n<li>向串行队列中添加嵌套的同步任务会造成<strong>死锁</strong>，见死锁②<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//同步任务</span></span><br><span class=\"line\"><span class=\"built_in\">dispatch_sync</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class=\"number\">0</span>), ^&#123;</span><br><span class=\"line\">            [<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">1.0</span>f];</span><br><span class=\"line\">            <span class=\"comment\">//先打印</span></span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"thread:%@\"</span>, [<span class=\"built_in\">NSThread</span> currentThread]);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"><span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"haha\"</span>);<span class=\"comment\">//后打印</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//死锁①</span></span><br><span class=\"line\"><span class=\"built_in\">dispatch_sync</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class=\"line\">            [<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">1.0</span>f];</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"thread:%@\"</span>, [<span class=\"built_in\">NSThread</span> currentThread]);</span><br><span class=\"line\">        &#125;);        </span><br><span class=\"line\"><span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"haha\"</span>);<span class=\"comment\">//造成死锁，haha永远不会打印</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//死锁②</span></span><br><span class=\"line\"><span class=\"built_in\">dispatch_queue_t</span> serialQueue = dispatch_queue_create(<span class=\"string\">\"myQueue\"</span>, DISPATCH_QUEUE_SERIAL);</span><br><span class=\"line\"><span class=\"built_in\">dispatch_sync</span>(serialQueue, ^&#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"thread1:%@\"</span>, [<span class=\"built_in\">NSThread</span> currentThread]);</span><br><span class=\"line\">            <span class=\"built_in\">dispatch_sync</span>(serialQueue, ^&#123;</span><br><span class=\"line\">                <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"thread2:%@\"</span>, [<span class=\"built_in\">NSThread</span> currentThread]);<span class=\"comment\">//造成死锁，thread2永远不会打印</span></span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125;);</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n</li>\n<li><p>异步任务：添加一个任务后不需要等待任务执行完成</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//异步任务</span></span><br><span class=\"line\"><span class=\"built_in\">dispatch_async</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class=\"number\">0</span>), ^&#123;</span><br><span class=\"line\">            [<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">1.0</span>f];</span><br><span class=\"line\">            <span class=\"comment\">//后打印</span></span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"thread:%@\"</span>, [<span class=\"built_in\">NSThread</span> currentThread]);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"><span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"haha\"</span>);<span class=\"comment\">//先打印</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h3 id=\"其他用法\"><a href=\"#其他用法\" class=\"headerlink\" title=\"其他用法\"></a>其他用法</h3><ul>\n<li><p>dispatch_after：延迟指定的时间后，将任务添加到指定的队列中</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dispatch_time_t time = dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class=\"number\">10.0</span>f * <span class=\"built_in\">NSEC_PER_SEC</span>));</span><br><span class=\"line\">dispatch_after(time, dispatch_get_main_queue(), ^&#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"haha\"</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>dispatch_group：将多个任务或队列归为一组，在这组的所有任务都执行完之后再执行后面的操作</p>\n<ul>\n<li>dispatch_group_async函数：创建一个指定队列中的异步任务，并将其添加到指定组中</li>\n<li>dispatch_group_notify函数：指定组中所有任务都执行完后，会执行该函数所指定的的任务</li>\n<li>dispatch_group_wait函数：阻塞当前线程，等待group中所有任务执行完毕<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//使用dispatch_group_notify</span></span><br><span class=\"line\">dispatch_group_t group = dispatch_group_create();</span><br><span class=\"line\"><span class=\"built_in\">dispatch_queue_t</span> concurrentQueue = dispatch_queue_create(<span class=\"string\">\"myQueue\"</span>, DISPATCH_QUEUE_CONCURRENT);</span><br><span class=\"line\">dispatch_group_async(group, concurrentQueue, ^&#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"1\"</span>);</span><br><span class=\"line\">    [<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">1.0</span>f];</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">dispatch_group_async(group, concurrentQueue, ^&#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"2\"</span>);</span><br><span class=\"line\">    [<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">1.0</span>f];</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">dispatch_group_async(group, concurrentQueue, ^&#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"3\"</span>);</span><br><span class=\"line\">    [<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">1.0</span>f];</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">dispatch_group_async(group, concurrentQueue, ^&#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"4\"</span>);</span><br><span class=\"line\">    [<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">1.0</span>f];</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">dispatch_group_notify(group, concurrentQueue, ^&#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"5\"</span>);<span class=\"comment\">//\"1234\"全部打印后，才会打印5</span></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//使用dispatch_group_wait</span></span><br><span class=\"line\">dispatch_group_t group = dispatch_group_create();</span><br><span class=\"line\"><span class=\"built_in\">dispatch_queue_t</span> concurrentQueue = dispatch_queue_create(<span class=\"string\">\"myQueue\"</span>, DISPATCH_QUEUE_CONCURRENT);</span><br><span class=\"line\">dispatch_group_async(group, concurrentQueue, ^&#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"1\"</span>);</span><br><span class=\"line\">    [<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">1.0</span>f];</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">dispatch_group_async(group, concurrentQueue, ^&#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"2\"</span>);</span><br><span class=\"line\">    [<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">1.0</span>f];</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">dispatch_group_async(group, concurrentQueue, ^&#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"3\"</span>);</span><br><span class=\"line\">    [<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">1.0</span>f];</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">dispatch_group_async(group, concurrentQueue, ^&#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"4\"</span>);</span><br><span class=\"line\">    [<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">1.0</span>f];</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">dispatch_group_wait(group, DISPATCH_TIME_FOREVER);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"haha\"</span>);<span class=\"comment\">//\"dispatch_group_wait\"会阻塞线程，所有haha会在\"1234\"之后打印</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n</li>\n<li><p>diapatch_once：执行一次</p>\n</li>\n<li><p>dispatch_apply：按照指定的次数将指定的Block追加到指定的DispatchQueue中，并等待全部处理执行结束</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dispatch_apply(<span class=\"number\">10</span>, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class=\"number\">0</span>), ^(size_t t) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"%zu\"</span>, t);</span><br><span class=\"line\">    [<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">1.0</span>f];</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"haha\"</span>);<span class=\"comment\">//等待dispatch_apply中的所有任务都执行完之后才会带引\"haha\"</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>dispatch_suspend / dispatch_resume</p>\n<ul>\n<li>dispatch_suspend：挂起指定的队列</li>\n<li>dispatch_resume：恢复指定的队列</li>\n</ul>\n</li>\n<li>Dispatch Semaphore：信号量，用于排他控制<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dispatch_semaphore_t semaphore = dispatch_semaphore_create(<span class=\"number\">1</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">dispatch_async</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class=\"number\">0</span>), ^&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">long</span> result = dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER);</span><br><span class=\"line\">        <span class=\"comment\">//排他，同时只能有一个线程进入这个代码块，相当于锁</span></span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"end wait, result:%ld\"</span>, result);</span><br><span class=\"line\">        [<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">1.0</span>f];</span><br><span class=\"line\"></span><br><span class=\"line\">        dispatch_semaphore_signal(semaphore);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h2 id=\"NSOperation\"><a href=\"#NSOperation\" class=\"headerlink\" title=\"NSOperation\"></a>NSOperation</h2><h3 id=\"基本用法-1\"><a href=\"#基本用法-1\" class=\"headerlink\" title=\"基本用法\"></a>基本用法</h3><ul>\n<li><p>NSBlockOperation：以Block的形式定义任务</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">testOperation</span> ()</span></span><br><span class=\"line\"><span class=\"keyword\">@property</span> (<span class=\"keyword\">nonatomic</span>, <span class=\"keyword\">strong</span>) <span class=\"built_in\">NSOperationQueue</span> * queue;</span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">testOperation</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)startTest &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//创建操作</span></span><br><span class=\"line\">    <span class=\"built_in\">NSOperation</span> * oper1 = [<span class=\"built_in\">NSBlockOperation</span> blockOperationWithBlock:^&#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"test block operation1, current thread:%@\"</span>, [<span class=\"built_in\">NSThread</span> currentThread]);</span><br><span class=\"line\">        [<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">1.0</span>f];</span><br><span class=\"line\">    &#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">NSOperation</span> * oper2 = [<span class=\"built_in\">NSBlockOperation</span> blockOperationWithBlock:^&#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"test block operation2, current thread:%@\"</span>, [<span class=\"built_in\">NSThread</span> currentThread]);</span><br><span class=\"line\">        [<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">1.0</span>f];</span><br><span class=\"line\">    &#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">NSOperation</span> * oper3 = [<span class=\"built_in\">NSBlockOperation</span> blockOperationWithBlock:^&#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"test block operation3, current thread:%@\"</span>, [<span class=\"built_in\">NSThread</span> currentThread]);</span><br><span class=\"line\">        [<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">1.0</span>f];</span><br><span class=\"line\">    &#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">NSOperation</span> * oper4 = [<span class=\"built_in\">NSBlockOperation</span> blockOperationWithBlock:^&#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"test block operation4, current thread:%@\"</span>, [<span class=\"built_in\">NSThread</span> currentThread]);</span><br><span class=\"line\">        [<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">1.0</span>f];</span><br><span class=\"line\">    &#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">self</span>.queue = [[<span class=\"built_in\">NSOperationQueue</span> alloc] init];</span><br><span class=\"line\">    <span class=\"comment\">//将操作加入队列中，操作就会在队列中并发执行，NSOperationQueue默认是并发队列</span></span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.queue addOperation:oper1];</span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.queue addOperation:oper2];</span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.queue addOperation:oper3];</span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.queue addOperation:oper4];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>NSInvocationOperation</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">testOperation</span> ()</span></span><br><span class=\"line\"><span class=\"keyword\">@property</span> (<span class=\"keyword\">nonatomic</span>, <span class=\"keyword\">strong</span>) <span class=\"built_in\">NSOperationQueue</span> * queue;</span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">testOperation</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)startTest &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">NSMethodSignature</span> * sig = [[<span class=\"keyword\">self</span> <span class=\"keyword\">class</span>] instanceMethodSignatureForSelector:<span class=\"keyword\">@selector</span>(oper1Fun:andObj2:)];</span><br><span class=\"line\">    <span class=\"built_in\">NSInvocation</span> * invo = [<span class=\"built_in\">NSInvocation</span> invocationWithMethodSignature:sig];</span><br><span class=\"line\">    [invo setTarget:<span class=\"keyword\">self</span>];</span><br><span class=\"line\">    [invo setSelector:<span class=\"keyword\">@selector</span>(oper1Fun:andObj2:)];</span><br><span class=\"line\">    <span class=\"built_in\">NSString</span> * arg1 = <span class=\"string\">@\"haha\"</span>;</span><br><span class=\"line\">    <span class=\"built_in\">NSString</span> * arg2 = <span class=\"string\">@\"oooo\"</span>;</span><br><span class=\"line\">    [invo setArgument:&amp;arg1 atIndex:<span class=\"number\">2</span>];</span><br><span class=\"line\">    [invo setArgument:&amp;arg2 atIndex:<span class=\"number\">3</span>];</span><br><span class=\"line\">    <span class=\"built_in\">NSOperation</span> * oper1 = [[<span class=\"built_in\">NSInvocationOperation</span> alloc] initWithInvocation:invo];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">NSOperation</span> * oper2 = [[<span class=\"built_in\">NSInvocationOperation</span> alloc] initWithTarget:<span class=\"keyword\">self</span> selector:<span class=\"keyword\">@selector</span>(oper2Fun) object:<span class=\"literal\">nil</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">self</span>.queue = [[<span class=\"built_in\">NSOperationQueue</span> alloc] init];</span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.queue addOperation:oper1];</span><br><span class=\"line\">    [<span class=\"keyword\">self</span>.queue addOperation:oper2];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)oper1Fun:(<span class=\"keyword\">id</span>)obj1 andObj2:(<span class=\"keyword\">id</span>)obj2 &#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"test invocation operation1, current thread:%@, obj1:%@, obj2:%@\"</span>, [<span class=\"built_in\">NSThread</span> currentThread], obj1, obj2);</span><br><span class=\"line\">    [<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">1.0</span>f];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)oper2Fun &#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"test invocation operation2, current thread:%@\"</span>, [<span class=\"built_in\">NSThread</span> currentThread]);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>继承NSOperation，重写main方法</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">MyOperation</span> : <span class=\"title\">NSOperation</span></span></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">MyOperation</span></span></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)main &#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"MyOperation, current thread:%@\"</span>, [<span class=\"built_in\">NSThread</span> currentThread]);</span><br><span class=\"line\">    [<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">1.0</span>f];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//main.m</span></span><br><span class=\"line\"><span class=\"built_in\">NSOperationQueue</span> * queue = [[<span class=\"built_in\">NSOperationQueue</span> alloc] init];</span><br><span class=\"line\"></span><br><span class=\"line\">MyOperation * op1 = [[MyOperation alloc] init];</span><br><span class=\"line\">MyOperation * op2 = [[MyOperation alloc] init];</span><br><span class=\"line\">MyOperation * op3 = [[MyOperation alloc] init];</span><br><span class=\"line\">MyOperation * op4 = [[MyOperation alloc] init];</span><br><span class=\"line\">MyOperation * op5 = [[MyOperation alloc] init];</span><br><span class=\"line\">MyOperation * op6 = [[MyOperation alloc] init];</span><br><span class=\"line\"></span><br><span class=\"line\">[queue addOperation:op1];</span><br><span class=\"line\">[queue addOperation:op2];</span><br><span class=\"line\">[queue addOperation:op3];</span><br><span class=\"line\">[queue addOperation:op4];</span><br><span class=\"line\">[queue addOperation:op5];</span><br><span class=\"line\">[queue addOperation:op6];</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h3 id=\"其他用法-1\"><a href=\"#其他用法-1\" class=\"headerlink\" title=\"其他用法\"></a>其他用法</h3><ul>\n<li>设置最大并发数<br><code>self.queue.maxConcurrentOperationCount = 3;</code></li>\n<li>设置操作之间的依赖关系<br><code>[oper2 addDependency:oper1];//oper2依赖于oper1，即必须oper1执行完之后才能执行oper2</code></li>\n<li>手动管理NSOperation<ul>\n<li>运行一个Operation：<code>- (void)start;</code>默认的start方法会直接进行一些异常判断，然后直接调用<code>- (void)main;</code></li>\n<li>取消一个Operation：<code>- (void)cancel;</code>调用cancel方法并不会停止操作的执行，这取决于main方法中对cancel的处理。如果在main方法中没有对cancel进行处理，发送cancel消息是没有任何效果的<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//MyOperation.m</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">MyOperation</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)start &#123;</span><br><span class=\"line\">    [<span class=\"built_in\">NSThread</span> detachNewThreadSelector:<span class=\"keyword\">@selector</span>(main) toTarget:<span class=\"keyword\">self</span> withObject:<span class=\"literal\">nil</span>];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)main &#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSInteger</span> index = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"current thread:%@, index:%ld\"</span>, [<span class=\"built_in\">NSThread</span> currentThread], index++);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">self</span>.isCancelled) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"cancel\"</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        [<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">1.0</span>f];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//main.m</span></span><br><span class=\"line\">MyOperation * op1 = [[MyOperation alloc] init];</span><br><span class=\"line\">[op1 start];</span><br><span class=\"line\">[<span class=\"built_in\">NSThread</span> sleepForTimeInterval:<span class=\"number\">3.0</span>f];</span><br><span class=\"line\">[op1 cancel];</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n</li>\n</ul>\n"},{"layout":"post","title":"【翻译】MVVM Tutorial with ReactiveCocoa Part 2","_content":"\n原文地址：[MVVM Tutorial with ReactiveCocoa: Part 2/2](https://www.raywenderlich.com/74131/mvvm-tutorial-with-reactivecocoa-part-2)\n\n----\n\nMVVM作为一种UI设计模式，正在成为一种非常流行的MVC模式的替代方案。\n\n在MVVM系列教程的第一部分，你已经了解了ReactiveCocoa是如何将ViewModels和他们各自的的View绑定起来的。\n\n![1](https://cdn5.raywenderlich.com/wp-content/uploads/2014/06/MVVMReactiveCocoa-700x121.png)\n\n下面是你创建的应用，一个搜索Flickr的APP。\n\n![2](https://cdn3.raywenderlich.com/wp-content/uploads/2014/06/FinishedApp-671x500.png)\n\n在 MVVM系列教程的第二部分以及最后一部分，你讲学会如果从应用程序的ViewModel中控制ViewController的导航。\n\n截止目前，你所开发的应用可以通过一个简单的字符串搜索Flickr，如果你需要当前的项目，可以从[这里](http://www.raywenderlich.com/wp-content/uploads/2014/06/FlickrSearchPart1Project1.zip)下载\n\n使用ReactiveCocoa构建的模型层服务提供搜索结果，对应的ViewModel能够简单地打印出响应结果。\n\n现在，是时候完成跳转到搜索结果界面的任务了。\n\n## 实现ViewModel导航\n\n搜索Flickr成功并返回正确的结果后，应用程序应该跳转到一个新的ViewController并显示这些搜索结果。\n\n当前应该程序只有单一的一个ViewModel，即RWTFlickrSearchViewModel类。为了达到预期的效果，你应该再创建一个ViewModel来描述返回的搜索结果视图。\n\n在ViewModel文件夹中一个名为RWTSearchResultsViewModel类，他继承自NSObject。代码如下：\n\n```objectivec\n@import Foundation;\n#import \"RWTViewModelServices.h\"\n#import \"RWTFlickrSearchResults.h\"\n\n@interface RWTSearchResultsViewModel : NSObject\n\n- (instancetype)initWithSearchResults:(RWTFlickrSearchResults *)results services:(id<RWTViewModelServices>)services;\n\n@property (strong, nonatomic) NSString *title;\n@property (strong, nonatomic) NSArray *searchResults;\n\n@end\n```\n\n上面的代码中添加了一些属性用于描述搜索结果视图，并且声明了一个包含一个RWTFlickrSearchResults参数（返回模型层的服务）的构造方法。\n\n打开RWTSearchResultsViewModel.m实现以下代码：\n\n```objectivec\n- (instancetype)initWithSearchResults:(RWTFlickrSearchResults *)results services:(id<RWTViewModelServices>)services {\n  if (self = [super init]) {\n    _title = results.searchString;\n    _searchResults = results.photos;\n  }\n  return self;\n}\n```\n\n这样RWTSearchResultsViewModel就完成了。\n\n回忆第一部分的内容，ViewModel应该在对应的View创建之前就已经创建好了，下面就是要完成各个ViewModel对应了View了。\n\n打开RWTSearchResultsViewController.h文件，导入对应的ViewModel头文件，并且添加一个初始化方法，代码如下：\n\n```objectivec\n#import \"RWTSearchResultsViewModel.h\"\n\n@interface RWTSearchResultsViewController : UIViewController\n\n- (instancetype)initWithViewModel:(RWTSearchResultsViewModel *)viewModel;\n\n@end\n```\n\n打开RWTSearchResultsViewController.m文件，并且在顶部的类扩展中添加一个私有属性，如下：\n\n```objectivec\n@property (strong, nonatomic) RWTSearchResultsViewModel *viewModel;\n```\n\n进一步完成初始化方法的实现，如下：\n\n```objectivec\n- (instancetype)initWithViewModel:(RWTSearchResultsViewModel *)viewModel {\n  if (self = [super init]) {\n    _viewModel = viewModel;\n  }\n  return self;\n}\n```\n\n这一步中，你将关注视图导航是如何工作的。\n\n你的应用程序现在有两个ViewModel，但是这里你将面临一个难题！我该怎么在视图控制器切换的同时也把对应的ViewModel进行切换。\n\nViewModel不能直接持有View的引用，所以，有什么巧妙的方法可以实现这个呢？\n\n答案已经在RWTViewModelServices协议中展现了。它当前被用来获得一个模型层的引用，你将用这个协议来实现ViewModel的切换。\n\n打开RWTViewModelServices.h并且添加如下方法到协议中去。\n\n```objectivec\n- (void)pushViewModel:(id)viewModel;\n```\n\n从概念上讲，ViewModel层驱动着整个App，这一层的逻辑决定着界面上会显示什么，以及界面之间切换的方式和时机。\n\n这个方法允许ViewModel也像UINavigationController那样可以从一个ViewModel以Push的方法切换到另一个ViewModel。\n\n在实现这个协议之前，你应该先是这个方法在ViewModel层可以工作。\n\n打开RWTFlickrSearchViewModel.m文件并导入新添加的ViewModel。\n\n```objectivec\n#import \"RWTSearchResultsViewModel.h\"\n```\n\n在同一文件更新executeSearchSignal方法的实现，代码如下：\n\n```objectivec\n- (RACSignal *)executeSearchSignal {\n  return [[[self.services getFlickrSearchService]\n    flickrSearchSignal:self.searchText]\n    doNext:^(id result) {\n      RWTSearchResultsViewModel *resultsViewModel =\n        [[RWTSearchResultsViewModel alloc] initWithSearchResults:result services:self.services];\n      [self.services pushViewModel:resultsViewModel];\n    }];\n}\n```\n\n上面的代码在搜索信号执行过程中添加了一个doNext操作，在doNext的block中创建了一个新的ViewModel来展示搜索结果，然后通过ViewModel的services的push操作切换到这个新的ViewModel上。\n\n现在，该更新代码，实现这个协议并达到切换ViewModel同时切换ViewController的效果。为了实现这个效果，我们需要在代码中引用导航控制器。\n\n打开RWTViewModelServicesImpl.h并且添加如下初始化方法：\n\n```objectivec\n- (instancetype)initWithNavigationController:(UINavigationController *)navigationController;\n```\n\n打开RWTViewModelServicesImpl.m并且添加下面的头文件：\n\n```objectivec\n#import \"RWTSearchResultsViewController.h\"\n```\n\n然后添加一个私有属性：\n\n```objectivec\n@property (weak, nonatomic) UINavigationController *navigationController;\n```\n\n然后在同一个文件完成方法的实现：\n\n```objectivec\n- (instancetype)initWithNavigationController:(UINavigationController *)navigationController {\n  if (self = [super init]) {\n    _searchService = [RWTFlickrSearchImpl new];\n    _navigationController = navigationController;\n  }\n  return self;\n}\n```\n\n上述代码用来把传过来的导航控制器引用记录下来。\n\n最后，添加一个新的方法：\n\n```objectivec\n- (void)pushViewModel:(id)viewModel {\n  id viewController;\n\n  if ([viewModel isKindOfClass:RWTSearchResultsViewModel.class]) {\n    viewController = [[RWTSearchResultsViewController alloc] initWithViewModel:viewModel];\n  } else {\n    NSLog(@\"an unknown ViewModel was pushed!\");\n  }\n\n  [self.navigationController pushViewController:viewController animated:YES];\n}\n```\n\n上述代码会根据ViewModel的类型来判断该显示那个视图。\n\n一般来说，View和ViewModel是一一对应的关系，但是你一定可以举出反例。\n\n最后一步，打开RWTAppDelegate.m，将createInitialViewController方法中创建RWTViewModelServicesImpl的一行改为如下代码：\n\n```objectivec\nself.viewModelServices = [[RWTViewModelServicesImpl alloc] initWithNavigationController:self.navigationController];\n```\n\n编译并运行程序，输入一个搜索关键字然后点击Go，可以观察到应用程序将切换到一个新的View/ViewModel。\n\n![3](https://cdn4.raywenderlich.com/wp-content/uploads/2014/06/BlankView-281x500.png)\n\n界面是空白的，别着急，待会你将修复这个问题。\n\n现在，可以庆祝一下，你已经实现了一个含有多个ViewModel并且可以通过ViewModel来切换界面的应用程序了。\n\n> 小贴士：John Gossman是一名微软WPF团队的工程师，他创造了MVVM模式。他说测试MVVM的一种方法就是你的应用程序应该脱离UI也可以运行。\n\n> 你的应用程序通过了这个测试。如果你不确信，可以通过单元测试来执行一个搜索或从一个ViewModel切换到另一个ViewModel。\n\n现在，你已经有了一个非常纯净的解决方案，下面要开始绑定UI了。\n\n## 呈现搜索结果列表\n\n搜索结果视图控制器RWTSearchResultsViewController在nib中定义了一个UITableview，下一步就是讲ViewModel中的内容展现在这个列表中。\n\n打开RWTSearchResultsViewController.m，添加一个类扩展，让他实现UITableViewDataSource协议，如下：\n\n```objectivec\n@interface RWTSearchResultsViewController () <UITableViewDataSource>\n```\n\n在同一文件中重写viewDidLoad方法，代码如下：\n\n```objectivec\n- (void)viewDidLoad {\n  [super viewDidLoad];\n\n  [self.searchResultsTable registerClass:UITableViewCell.class\n                  forCellReuseIdentifier:@\"cell\"];\n  self.searchResultsTable.dataSource = self;\n\n  [self bindViewModel];\n}\n```\n\n这些操作会在tableview初始化时执行一次，并绑定ViewModel。请忽略上面的Cell Identifier的硬编码，这个待会会删掉。\n\n然后在同一文件中，添加bindViewModel方法。\n\n```objectivec\n- (void)bindViewModel {\n  self.title = self.viewModel.title;\n}\n```\n\n当前并没有添加太多代码。ViewModel有两个属性，一个是标题，另一个是将要展示在列表中的搜索结果的数组。\n\n因此，你该如何把这些搜索结果绑定到Tableview上呢？\n\nReactiveCocoa可以绑定简单的属性到UIKit上，但是无法处理复杂的Tableview的数据绑定。\n\n不用焦急，还有其他方法。可以使用传统的代理方法实现。\n\n在同一文件中，添加如下两个dataSource的代理方法：\n\n```objectivec\n- (NSInteger)tableView:(UITableView *)tableView\n numberOfRowsInSection:(NSInteger)section {\n  return self.viewModel.searchResults.count;\n}\n\n- (UITableViewCell *)tableView:(UITableView *)tableView\n         cellForRowAtIndexPath:(NSIndexPath *)indexPath {\n  UITableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:@\"cell\"];\n  cell.textLabel.text = [self.viewModel.searchResults[indexPath.row] title];\n  return cell;\n}\n```\n\n第一个方法用来告诉Tableview搜索结果的个数，第二个方法根据ViewModel返回一个相应的Cell。这就够了，不是吗？\n\n编译并运行程序，就可以看到数据了\n\n![4](https://cdn2.raywenderlich.com/wp-content/uploads/2014/06/PopulatedTable-281x500.png)\n\n## 更好的Tableview数据绑定方法\n\n这种绑定Tableview数据的方法的缺点就是很快就会使视图控制器的代码变得很大。手动绑定数据的方法看起来也不是很优雅。\n\n这个问题困扰着我，因此我着手解决这个问题。\n\n从理论上讲，ViewModel的搜索结果数据中的每一项自身也是一个与Cell一一对应的ViewModel。在我的一篇最近的[博客](http://www.scottlogic.com/blog/2014/05/11/reactivecocoa-tableview-binding.html)中，我创建了一个通用的绑定辅助类，叫做CETableViewBindingHelper，这个类允许你使用每一个子ViewModel创建一个视图。这个类可以用来辅助实现datasource协议。\n\n这个CETableViewBindingHelper类的构造方法如下：\n\n```objectivec\n+ (instancetype) bindingHelperForTableView:(UITableView *)tableView\n                              sourceSignal:(RACSignal *)source\n                          selectionCommand:(RACCommand *)selection\n                              templateCell:(UINib *)templateCellNib;\n```\n\n你仅仅只需要创建一个辅助类的引用，就可以用来绑定一个View的数组。这个构造方法的参数如下：\n\n1. 需要加载ViewModel数组的Tableview\n2. 一个source的信号用来监控数据的变化\n3. 一个在选中一个Cell后要执行的命令\n4. cell视图的nib\n\nnib文件定义的Cell必须实现CEReactiveView协议。\n\n项目中已经包含了一个用于展示搜索结果的Cell视图。打开RWTSearchResultsTableViewCell.h导入协议头文件：\n\n```objectivec\n#import \"CEReactiveView.h\"\n```\n\n实现这个协议：\n\n```objectivec\n@interface RWTSearchResultsTableViewCell : UITableViewCell <CEReactiveView>\n```\n\n下一步就是实现协议方法，打开RWTSearchResultsTableViewCell.m，导入如下内容：\n\n```objectivec\n#import <SDWebImage/UIImageView+WebCache.h>\n#import \"RWTFlickrPhoto.h\"\n```\n\n然后添加如下方法：\n\n```objectivec\n- (void)bindViewModel:(id)viewModel {\n  RWTFlickrPhoto *photo = viewModel;\n  self.titleLabel.text = photo.title;\n\n  self.imageThumbnailView.contentMode = UIViewContentModeScaleToFill;\n\n  [self.imageThumbnailView setImageWithURL:photo.url];\n}\n```\n\n现在RWTSearchResultsViewModel的searchResults属性包含了一个RWTFlickrPhoto的引用的数组。\n\n你刚刚添加的bindViewModel方法中用到了SDWebImage框架，这是一个非常有用的用来在后台加载图片的第三方框架。\n\nsetImageWithURL:是SDWebImage添加的一个UIImageView的分类方法。\n\n最后一步是用绑定辅助类去展示列表。\n\n打开RWTSearchResultsViewController.m导入辅助类头文件：\n\n```objectivec\n#import \"CETableViewBindingHelper.h\"\n```\n\n在同一文件中删除UITableDataSource协议以及实现的两个协议方法。\n\n下一步，在类扩展中添加一个如下的属性：\n\n```objectivec\n@property (strong, nonatomic) CETableViewBindingHelper *bindingHelper;\n```\n\n在同一文件中，删除你之前添加的ViewDidload方法中的内容，然后添加如下代码到ViewDidLoad中：\n\n```objectivec\n- (void)viewDidLoad {\n  [super viewDidLoad];\n  [self bindViewModel];\n}\n```\n\n最后，在bindViewModel方法的最后添加如下代码：\n\n```objectivec\nUINib *nib = [UINib nibWithNibName:@\"RWTSearchResultsTableViewCell\" bundle:nil];\n\nself.bindingHelper =\n  [CETableViewBindingHelper bindingHelperForTableView:self.searchResultsTable\n                                         sourceSignal:RACObserve(self.viewModel, searchResults)\n                                     selectionCommand:nil\n                                         templateCell:nib];\n```\n\n上述代码从nib文件中创建了一个UINIb类型的引用，并且创建了一个绑定辅助类的对象。通过观察ViewModel中的searchResults属性来创建一个sourceSignal。\n\n编译并运行，结果如下：\n\n![5](http://www.raywenderlich.com/wp-content/uploads/2014/06/UsingTheBindingHelper.png)\n\n这就是一种更加又要的绑定数组到Tableview的方法。\n\n## 一些UI的个性化\n\n到目前为止，这篇教程始终重点叫的都是如何根据MVVM模式构建你的应用程序。我想你已经忍不住想添加一些个性化的东西了。\n\n自从iOS7发布后，已经过了1年了，[运动设计](http://www.beyondkinetic.com/motion-ui-design-principles)获得了更大的知名度，许多设计人员现在倾向于微妙的动画和流体行为。\n\n这一步中，你将在照片上添加一个微妙的视差滚动效果，棒极了。\n\n打开RWTSearchResultsTableViewCell.h添加如下方法：\n\n```objectivec\n- (void) setParallax:(CGFloat)value;\n```\n\n列表视图的每个Cell将使用这个方法来为每个Cell做视觉偏移。\n\n打开 RWTSearchResultsTableViewCell.m 文件添加如下代码：\n\n```objectivec\n- (void)setParallax:(CGFloat)value {\n  self.imageThumbnailView.transform = CGAffineTransformMakeTranslation(0, value);\n}\n```\n\n打开RWTSearchResultsViewController.m导入如下头文件：\n\n```objectivec\n#import \"RWTSearchResultsTableViewCell.h\"\n```\n\n在同一个文件的类扩展中实现UITableViewDelegate的协议，如下：\n\n```objectivec\n@interface RWTSearchResultsViewController () <UITableViewDataSource, UITableViewDelegate>\n```\n\n你刚刚添加了一个绑定辅助类，并且把他设置为列表视图的代理，是他可以响应列表中行的选中动作。\n\n在bindViewModel方法中设置绑定辅助类的代理：\n\n```objectivec\nself.bindingHelper.delegate = self;\n```\n\n在同一文件中添加scrollViewDidScroll方法的实现，如下：\n\n```objectivec\n- (void)scrollViewDidScroll:(UIScrollView *)scrollView {\n  NSArray *cells = [self.searchResultsTable visibleCells];\n  for (RWTSearchResultsTableViewCell *cell in cells) {\n    CGFloat value = -40 + (cell.frame.origin.y - self.searchResultsTable.contentOffset.y) / 5;\n    [cell setParallax:value];\n  }\n}\n```\n\n每当列表视图滚动时，就会调用这个方法。在这个方法中，遍历所有可见的Cell，然后计算出一个偏移量，然后给每一个Cell设置一个视觉偏移。实际的偏移量将根据每一个Cell在列表视图可见部分的位置而定。\n\n编译并运行程序，就可以看到一个视差效果。\n\n![5](http://www.raywenderlich.com/wp-content/uploads/2014/06/ParallaxAnimation.gif)\n\n回到之前Views和ViewModels的工作。\n\n## 根据评论和点赞数查询\n\n界面上应该在每一张图片的底部右侧显示评论数和点赞数。但是，当前从nib创建的文件仅仅只是显示了一个123的假数据。\n\n在你使用真实数据之前，你需要在模型层添加这个功能。\n\n在Model文件夹中添加一个新的继承自NSObject的类RWTFlickrPhotoMetadata，打开RWTFlickrPhotoMetadata.h添加如下代码：\n\n```objectivec\n@property (nonatomic) NSUInteger favorites;\n@property (nonatomic) NSUInteger comments;\n```\n\n打开 RWTFlickrPhotoMetadata.m实现description方法：\n\n```objectivec\n- (NSString *)description {\n  return [NSString stringWithFormat:@\"metadata: comments=%lU, faves=%lU\",\n          self.comments, self.favorites];\n}\n```\n\n这个方法用于测试新添加的获取第一张照片的元数据的接口返回的数据是否正确。结果将被打印出来。\n\n编译并运行，搜索一些照片，当结果显示时，你将看到如下log将被打印出来。\n\n```objectivec\n2014-06-04 07:27:26.813 RWTFlickrSearch[76828:70b] metadata: comments=120, faves=434\n```\n\n## 取得元数据赋给可见的Cell\n\n你可以将当前的代码扩展成获取所有搜索结果的元数据。\n\n但是，如果结果有100张图片，你就要调用200次API接口，每张图片两次。许多API都有一个调用频率限制，这个操作可能会导致API Key被锁定，最少也是暂时不能用。\n\n其实，你只需要获取到当前在列表视图中显示的几张图片的元数据。因此，你该怎样实现这样的行为呢？你应该已经猜到了，你需要一个可以意识到他是否显示的一个ViewModel。\n\n当前的RWTSearchResultsViewModel对外暴漏了一个展示在视图上的RWTFlickrPhoto数组的接口，这些模型层的对象会被保留给View。为了能够添加一个可见性的概念，你将把这些在ViewModels里的模型对象封装起来。\n\n在ViewModel文件夹中添加一个NSObject的子类RWTSearchResultsItemViewModel，打开头文件，添加如下内容：\n\n```objectivec\n@import Foundation;\n#import \"RWTFlickrPhoto.h\"\n#import \"RWTViewModelServices.h\"\n\n@interface RWTSearchResultsItemViewModel : NSObject\n\n- (instancetype) initWithPhoto:(RWTFlickrPhoto *)photo services:(id<RWTViewModelServices>)services;\n\n@property (nonatomic) BOOL isVisible;\n@property (strong, nonatomic) NSString *title;\n@property (strong, nonatomic) NSURL *url;\n@property (strong, nonatomic) NSNumber *favorites;\n@property (strong, nonatomic) NSNumber *comments;\n\n@end\n```\n\n如你所见，这个ViewModel封装了RWTFlickrPhoto模型对象。\n\n这个ViewModel的属性混合了如下内容：\n\n* 对外的模型属性（title，url）\n* 会动态更新的图像元数据模型（favorites，comments）\n* isVisible用来指示ViewModel是否可见或不可见\n\n打开RWTSearchResultsItemViewModel.m导入如下头文件：\n\n```objectivec\n#import <ReactiveCocoa/ReactiveCocoa.h>\n#import <ReactiveCocoa/RACEXTScope.h>\n#import \"RWTFlickrPhotoMetadata.h\"\n```\n\n然后在类扩展中添加如下私有属性：\n\n```objectivec\n@interface RWTSearchResultsItemViewModel ()\n\n@property (weak, nonatomic) id<RWTViewModelServices> services;\n@property (strong, nonatomic) RWTFlickrPhoto *photo;\n\n@end\n```\n\n在同一文件中实现如下方法：\n\n```objectivec\n- (instancetype)initWithPhoto:(RWTFlickrPhoto *)photo services:(id<RWTViewModelServices>)services {\n  self = [super init];\n  if (self) {\n    _title = photo.title;\n    _url = photo.url;\n    _services = services;\n    _photo = photo;\n\n    [self initialize];\n  }\n  return  self;\n}\n```\n\n然后添加一个initialize方法，注意了，这是关键的地方：\n\n```objectivec\n- (void)initialize {\n  RACSignal *fetchMetadata =\n    [RACObserve(self, isVisible)\n     filter:^BOOL(NSNumber *visible) {\n       return [visible boolValue];\n     }];\n\n  @weakify(self)\n  [fetchMetadata subscribeNext:^(id x) {\n    @strongify(self)\n    [[[self.services getFlickrSearchService] flickrImageMetadata:self.photo.identifier]\n     subscribeNext:^(RWTFlickrPhotoMetadata *x) {\n       self.favorites = @(x.favorites);\n       self.comments = @(x.comments);\n     }];\n  }];\n}\n```\n\n方法的第一部分创建了一个用于监听isVisible属性的信号fetchMetadate，并且根据isVisible的值进行了过滤。结果就是只有当isVisible为true时这个信号才会发出Next Value。\n\n接下来一部分就是订阅这个信号以便开始请求flickrImageMetadata方法。当这个内嵌的信号触发Next时，将更新赞数和评论数。\n\n总的来说，当isVisible为true时，将触发Flickr请求，然后在未来的某个点更新comments和favorites属性。\n\n为了使这个新的ViewModel能够使用，打开RWTSearchResultsViewModel.m导入如下头文件：\n\n```objectivec\n#import <LinqToObjectiveC/NSArray+LinqExtensions.h>\n#import \"RWTSearchResultsItemViewModel.h\"\n```\n\n在初始化方法中，删除当前的代码，然后设置_searchResults如下：\n\n```objectivec\n_searchResults =\n  [results.photos linq_select:^id(RWTFlickrPhoto *photo) {\n    return [[RWTSearchResultsItemViewModel alloc]\n              initWithPhoto:photo services:services];\n  }];\n```\n\n这段代码将每一个模型对象封装成了一个ViewModel。\n\n最后一步就是根据视图设置isVisible属性，使得这些新的属性能够生效。\n\n打开RWTSearchResultsTableViewCell.m添加如下头文件：\n\n```objectivec\n#import \"RWTSearchResultsItemViewModel.h\"\n```\n\n在同一文件中，改变bindViewModel方法的第一行代码，使用新添加的ViewModel。\n\n```objectivec\nRWTSearchResultsItemViewModel *photo = viewModel;\n```\n\n在同一方法中添加如下代码：\n\n```objectivec\n[RACObserve(photo, favorites) subscribeNext:^(NSNumber *x) {\n  self.favouritesLabel.text = [x stringValue];\n  self.favouritesIcon.hidden = (x == nil);\n}];\n\n[RACObserve(photo, comments) subscribeNext:^(NSNumber *x) {\n  self.commentsLabel.text = [x stringValue];\n  self.commentsIcon.hidden = (x == nil);\n}];\n\nphoto.isVisible = YES;\n```\n\n这样当comments和favorites属性发生变化时，对应的lable以及image也会更新。\n\n最后一步，设置ViewModel的isVisible为YES。\n\n## 后记\n\n终于翻译完了，这是我第一次尝试翻译英文技术文章，前后断断续续用了大概两周的时间，真的很累，说实话，最后完全是为了翻译而去翻译的，而不是为了学习技术而去翻译的。不过这个过程中还是学到了不少东西。以后我还会坚持找一些经典的文章拿来翻译，不过不会翻译这么长的文章了，太累了。\n\n水平有限，很多地方翻译的不是很通顺，有些句子不知道怎么翻好，干脆就没有翻译，个中错误，以后有空会慢慢纠正。（2016-5-19）\n","source":"_posts/2016-05-09-MVVMTutorialwithReactiveCocoaPart2(翻译).md","raw":"---\nlayout: post\ntitle: \"【翻译】MVVM Tutorial with ReactiveCocoa Part 2\"\ncategories: \"iOS开发\"\n---\n\n原文地址：[MVVM Tutorial with ReactiveCocoa: Part 2/2](https://www.raywenderlich.com/74131/mvvm-tutorial-with-reactivecocoa-part-2)\n\n----\n\nMVVM作为一种UI设计模式，正在成为一种非常流行的MVC模式的替代方案。\n\n在MVVM系列教程的第一部分，你已经了解了ReactiveCocoa是如何将ViewModels和他们各自的的View绑定起来的。\n\n![1](https://cdn5.raywenderlich.com/wp-content/uploads/2014/06/MVVMReactiveCocoa-700x121.png)\n\n下面是你创建的应用，一个搜索Flickr的APP。\n\n![2](https://cdn3.raywenderlich.com/wp-content/uploads/2014/06/FinishedApp-671x500.png)\n\n在 MVVM系列教程的第二部分以及最后一部分，你讲学会如果从应用程序的ViewModel中控制ViewController的导航。\n\n截止目前，你所开发的应用可以通过一个简单的字符串搜索Flickr，如果你需要当前的项目，可以从[这里](http://www.raywenderlich.com/wp-content/uploads/2014/06/FlickrSearchPart1Project1.zip)下载\n\n使用ReactiveCocoa构建的模型层服务提供搜索结果，对应的ViewModel能够简单地打印出响应结果。\n\n现在，是时候完成跳转到搜索结果界面的任务了。\n\n## 实现ViewModel导航\n\n搜索Flickr成功并返回正确的结果后，应用程序应该跳转到一个新的ViewController并显示这些搜索结果。\n\n当前应该程序只有单一的一个ViewModel，即RWTFlickrSearchViewModel类。为了达到预期的效果，你应该再创建一个ViewModel来描述返回的搜索结果视图。\n\n在ViewModel文件夹中一个名为RWTSearchResultsViewModel类，他继承自NSObject。代码如下：\n\n```objectivec\n@import Foundation;\n#import \"RWTViewModelServices.h\"\n#import \"RWTFlickrSearchResults.h\"\n\n@interface RWTSearchResultsViewModel : NSObject\n\n- (instancetype)initWithSearchResults:(RWTFlickrSearchResults *)results services:(id<RWTViewModelServices>)services;\n\n@property (strong, nonatomic) NSString *title;\n@property (strong, nonatomic) NSArray *searchResults;\n\n@end\n```\n\n上面的代码中添加了一些属性用于描述搜索结果视图，并且声明了一个包含一个RWTFlickrSearchResults参数（返回模型层的服务）的构造方法。\n\n打开RWTSearchResultsViewModel.m实现以下代码：\n\n```objectivec\n- (instancetype)initWithSearchResults:(RWTFlickrSearchResults *)results services:(id<RWTViewModelServices>)services {\n  if (self = [super init]) {\n    _title = results.searchString;\n    _searchResults = results.photos;\n  }\n  return self;\n}\n```\n\n这样RWTSearchResultsViewModel就完成了。\n\n回忆第一部分的内容，ViewModel应该在对应的View创建之前就已经创建好了，下面就是要完成各个ViewModel对应了View了。\n\n打开RWTSearchResultsViewController.h文件，导入对应的ViewModel头文件，并且添加一个初始化方法，代码如下：\n\n```objectivec\n#import \"RWTSearchResultsViewModel.h\"\n\n@interface RWTSearchResultsViewController : UIViewController\n\n- (instancetype)initWithViewModel:(RWTSearchResultsViewModel *)viewModel;\n\n@end\n```\n\n打开RWTSearchResultsViewController.m文件，并且在顶部的类扩展中添加一个私有属性，如下：\n\n```objectivec\n@property (strong, nonatomic) RWTSearchResultsViewModel *viewModel;\n```\n\n进一步完成初始化方法的实现，如下：\n\n```objectivec\n- (instancetype)initWithViewModel:(RWTSearchResultsViewModel *)viewModel {\n  if (self = [super init]) {\n    _viewModel = viewModel;\n  }\n  return self;\n}\n```\n\n这一步中，你将关注视图导航是如何工作的。\n\n你的应用程序现在有两个ViewModel，但是这里你将面临一个难题！我该怎么在视图控制器切换的同时也把对应的ViewModel进行切换。\n\nViewModel不能直接持有View的引用，所以，有什么巧妙的方法可以实现这个呢？\n\n答案已经在RWTViewModelServices协议中展现了。它当前被用来获得一个模型层的引用，你将用这个协议来实现ViewModel的切换。\n\n打开RWTViewModelServices.h并且添加如下方法到协议中去。\n\n```objectivec\n- (void)pushViewModel:(id)viewModel;\n```\n\n从概念上讲，ViewModel层驱动着整个App，这一层的逻辑决定着界面上会显示什么，以及界面之间切换的方式和时机。\n\n这个方法允许ViewModel也像UINavigationController那样可以从一个ViewModel以Push的方法切换到另一个ViewModel。\n\n在实现这个协议之前，你应该先是这个方法在ViewModel层可以工作。\n\n打开RWTFlickrSearchViewModel.m文件并导入新添加的ViewModel。\n\n```objectivec\n#import \"RWTSearchResultsViewModel.h\"\n```\n\n在同一文件更新executeSearchSignal方法的实现，代码如下：\n\n```objectivec\n- (RACSignal *)executeSearchSignal {\n  return [[[self.services getFlickrSearchService]\n    flickrSearchSignal:self.searchText]\n    doNext:^(id result) {\n      RWTSearchResultsViewModel *resultsViewModel =\n        [[RWTSearchResultsViewModel alloc] initWithSearchResults:result services:self.services];\n      [self.services pushViewModel:resultsViewModel];\n    }];\n}\n```\n\n上面的代码在搜索信号执行过程中添加了一个doNext操作，在doNext的block中创建了一个新的ViewModel来展示搜索结果，然后通过ViewModel的services的push操作切换到这个新的ViewModel上。\n\n现在，该更新代码，实现这个协议并达到切换ViewModel同时切换ViewController的效果。为了实现这个效果，我们需要在代码中引用导航控制器。\n\n打开RWTViewModelServicesImpl.h并且添加如下初始化方法：\n\n```objectivec\n- (instancetype)initWithNavigationController:(UINavigationController *)navigationController;\n```\n\n打开RWTViewModelServicesImpl.m并且添加下面的头文件：\n\n```objectivec\n#import \"RWTSearchResultsViewController.h\"\n```\n\n然后添加一个私有属性：\n\n```objectivec\n@property (weak, nonatomic) UINavigationController *navigationController;\n```\n\n然后在同一个文件完成方法的实现：\n\n```objectivec\n- (instancetype)initWithNavigationController:(UINavigationController *)navigationController {\n  if (self = [super init]) {\n    _searchService = [RWTFlickrSearchImpl new];\n    _navigationController = navigationController;\n  }\n  return self;\n}\n```\n\n上述代码用来把传过来的导航控制器引用记录下来。\n\n最后，添加一个新的方法：\n\n```objectivec\n- (void)pushViewModel:(id)viewModel {\n  id viewController;\n\n  if ([viewModel isKindOfClass:RWTSearchResultsViewModel.class]) {\n    viewController = [[RWTSearchResultsViewController alloc] initWithViewModel:viewModel];\n  } else {\n    NSLog(@\"an unknown ViewModel was pushed!\");\n  }\n\n  [self.navigationController pushViewController:viewController animated:YES];\n}\n```\n\n上述代码会根据ViewModel的类型来判断该显示那个视图。\n\n一般来说，View和ViewModel是一一对应的关系，但是你一定可以举出反例。\n\n最后一步，打开RWTAppDelegate.m，将createInitialViewController方法中创建RWTViewModelServicesImpl的一行改为如下代码：\n\n```objectivec\nself.viewModelServices = [[RWTViewModelServicesImpl alloc] initWithNavigationController:self.navigationController];\n```\n\n编译并运行程序，输入一个搜索关键字然后点击Go，可以观察到应用程序将切换到一个新的View/ViewModel。\n\n![3](https://cdn4.raywenderlich.com/wp-content/uploads/2014/06/BlankView-281x500.png)\n\n界面是空白的，别着急，待会你将修复这个问题。\n\n现在，可以庆祝一下，你已经实现了一个含有多个ViewModel并且可以通过ViewModel来切换界面的应用程序了。\n\n> 小贴士：John Gossman是一名微软WPF团队的工程师，他创造了MVVM模式。他说测试MVVM的一种方法就是你的应用程序应该脱离UI也可以运行。\n\n> 你的应用程序通过了这个测试。如果你不确信，可以通过单元测试来执行一个搜索或从一个ViewModel切换到另一个ViewModel。\n\n现在，你已经有了一个非常纯净的解决方案，下面要开始绑定UI了。\n\n## 呈现搜索结果列表\n\n搜索结果视图控制器RWTSearchResultsViewController在nib中定义了一个UITableview，下一步就是讲ViewModel中的内容展现在这个列表中。\n\n打开RWTSearchResultsViewController.m，添加一个类扩展，让他实现UITableViewDataSource协议，如下：\n\n```objectivec\n@interface RWTSearchResultsViewController () <UITableViewDataSource>\n```\n\n在同一文件中重写viewDidLoad方法，代码如下：\n\n```objectivec\n- (void)viewDidLoad {\n  [super viewDidLoad];\n\n  [self.searchResultsTable registerClass:UITableViewCell.class\n                  forCellReuseIdentifier:@\"cell\"];\n  self.searchResultsTable.dataSource = self;\n\n  [self bindViewModel];\n}\n```\n\n这些操作会在tableview初始化时执行一次，并绑定ViewModel。请忽略上面的Cell Identifier的硬编码，这个待会会删掉。\n\n然后在同一文件中，添加bindViewModel方法。\n\n```objectivec\n- (void)bindViewModel {\n  self.title = self.viewModel.title;\n}\n```\n\n当前并没有添加太多代码。ViewModel有两个属性，一个是标题，另一个是将要展示在列表中的搜索结果的数组。\n\n因此，你该如何把这些搜索结果绑定到Tableview上呢？\n\nReactiveCocoa可以绑定简单的属性到UIKit上，但是无法处理复杂的Tableview的数据绑定。\n\n不用焦急，还有其他方法。可以使用传统的代理方法实现。\n\n在同一文件中，添加如下两个dataSource的代理方法：\n\n```objectivec\n- (NSInteger)tableView:(UITableView *)tableView\n numberOfRowsInSection:(NSInteger)section {\n  return self.viewModel.searchResults.count;\n}\n\n- (UITableViewCell *)tableView:(UITableView *)tableView\n         cellForRowAtIndexPath:(NSIndexPath *)indexPath {\n  UITableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:@\"cell\"];\n  cell.textLabel.text = [self.viewModel.searchResults[indexPath.row] title];\n  return cell;\n}\n```\n\n第一个方法用来告诉Tableview搜索结果的个数，第二个方法根据ViewModel返回一个相应的Cell。这就够了，不是吗？\n\n编译并运行程序，就可以看到数据了\n\n![4](https://cdn2.raywenderlich.com/wp-content/uploads/2014/06/PopulatedTable-281x500.png)\n\n## 更好的Tableview数据绑定方法\n\n这种绑定Tableview数据的方法的缺点就是很快就会使视图控制器的代码变得很大。手动绑定数据的方法看起来也不是很优雅。\n\n这个问题困扰着我，因此我着手解决这个问题。\n\n从理论上讲，ViewModel的搜索结果数据中的每一项自身也是一个与Cell一一对应的ViewModel。在我的一篇最近的[博客](http://www.scottlogic.com/blog/2014/05/11/reactivecocoa-tableview-binding.html)中，我创建了一个通用的绑定辅助类，叫做CETableViewBindingHelper，这个类允许你使用每一个子ViewModel创建一个视图。这个类可以用来辅助实现datasource协议。\n\n这个CETableViewBindingHelper类的构造方法如下：\n\n```objectivec\n+ (instancetype) bindingHelperForTableView:(UITableView *)tableView\n                              sourceSignal:(RACSignal *)source\n                          selectionCommand:(RACCommand *)selection\n                              templateCell:(UINib *)templateCellNib;\n```\n\n你仅仅只需要创建一个辅助类的引用，就可以用来绑定一个View的数组。这个构造方法的参数如下：\n\n1. 需要加载ViewModel数组的Tableview\n2. 一个source的信号用来监控数据的变化\n3. 一个在选中一个Cell后要执行的命令\n4. cell视图的nib\n\nnib文件定义的Cell必须实现CEReactiveView协议。\n\n项目中已经包含了一个用于展示搜索结果的Cell视图。打开RWTSearchResultsTableViewCell.h导入协议头文件：\n\n```objectivec\n#import \"CEReactiveView.h\"\n```\n\n实现这个协议：\n\n```objectivec\n@interface RWTSearchResultsTableViewCell : UITableViewCell <CEReactiveView>\n```\n\n下一步就是实现协议方法，打开RWTSearchResultsTableViewCell.m，导入如下内容：\n\n```objectivec\n#import <SDWebImage/UIImageView+WebCache.h>\n#import \"RWTFlickrPhoto.h\"\n```\n\n然后添加如下方法：\n\n```objectivec\n- (void)bindViewModel:(id)viewModel {\n  RWTFlickrPhoto *photo = viewModel;\n  self.titleLabel.text = photo.title;\n\n  self.imageThumbnailView.contentMode = UIViewContentModeScaleToFill;\n\n  [self.imageThumbnailView setImageWithURL:photo.url];\n}\n```\n\n现在RWTSearchResultsViewModel的searchResults属性包含了一个RWTFlickrPhoto的引用的数组。\n\n你刚刚添加的bindViewModel方法中用到了SDWebImage框架，这是一个非常有用的用来在后台加载图片的第三方框架。\n\nsetImageWithURL:是SDWebImage添加的一个UIImageView的分类方法。\n\n最后一步是用绑定辅助类去展示列表。\n\n打开RWTSearchResultsViewController.m导入辅助类头文件：\n\n```objectivec\n#import \"CETableViewBindingHelper.h\"\n```\n\n在同一文件中删除UITableDataSource协议以及实现的两个协议方法。\n\n下一步，在类扩展中添加一个如下的属性：\n\n```objectivec\n@property (strong, nonatomic) CETableViewBindingHelper *bindingHelper;\n```\n\n在同一文件中，删除你之前添加的ViewDidload方法中的内容，然后添加如下代码到ViewDidLoad中：\n\n```objectivec\n- (void)viewDidLoad {\n  [super viewDidLoad];\n  [self bindViewModel];\n}\n```\n\n最后，在bindViewModel方法的最后添加如下代码：\n\n```objectivec\nUINib *nib = [UINib nibWithNibName:@\"RWTSearchResultsTableViewCell\" bundle:nil];\n\nself.bindingHelper =\n  [CETableViewBindingHelper bindingHelperForTableView:self.searchResultsTable\n                                         sourceSignal:RACObserve(self.viewModel, searchResults)\n                                     selectionCommand:nil\n                                         templateCell:nib];\n```\n\n上述代码从nib文件中创建了一个UINIb类型的引用，并且创建了一个绑定辅助类的对象。通过观察ViewModel中的searchResults属性来创建一个sourceSignal。\n\n编译并运行，结果如下：\n\n![5](http://www.raywenderlich.com/wp-content/uploads/2014/06/UsingTheBindingHelper.png)\n\n这就是一种更加又要的绑定数组到Tableview的方法。\n\n## 一些UI的个性化\n\n到目前为止，这篇教程始终重点叫的都是如何根据MVVM模式构建你的应用程序。我想你已经忍不住想添加一些个性化的东西了。\n\n自从iOS7发布后，已经过了1年了，[运动设计](http://www.beyondkinetic.com/motion-ui-design-principles)获得了更大的知名度，许多设计人员现在倾向于微妙的动画和流体行为。\n\n这一步中，你将在照片上添加一个微妙的视差滚动效果，棒极了。\n\n打开RWTSearchResultsTableViewCell.h添加如下方法：\n\n```objectivec\n- (void) setParallax:(CGFloat)value;\n```\n\n列表视图的每个Cell将使用这个方法来为每个Cell做视觉偏移。\n\n打开 RWTSearchResultsTableViewCell.m 文件添加如下代码：\n\n```objectivec\n- (void)setParallax:(CGFloat)value {\n  self.imageThumbnailView.transform = CGAffineTransformMakeTranslation(0, value);\n}\n```\n\n打开RWTSearchResultsViewController.m导入如下头文件：\n\n```objectivec\n#import \"RWTSearchResultsTableViewCell.h\"\n```\n\n在同一个文件的类扩展中实现UITableViewDelegate的协议，如下：\n\n```objectivec\n@interface RWTSearchResultsViewController () <UITableViewDataSource, UITableViewDelegate>\n```\n\n你刚刚添加了一个绑定辅助类，并且把他设置为列表视图的代理，是他可以响应列表中行的选中动作。\n\n在bindViewModel方法中设置绑定辅助类的代理：\n\n```objectivec\nself.bindingHelper.delegate = self;\n```\n\n在同一文件中添加scrollViewDidScroll方法的实现，如下：\n\n```objectivec\n- (void)scrollViewDidScroll:(UIScrollView *)scrollView {\n  NSArray *cells = [self.searchResultsTable visibleCells];\n  for (RWTSearchResultsTableViewCell *cell in cells) {\n    CGFloat value = -40 + (cell.frame.origin.y - self.searchResultsTable.contentOffset.y) / 5;\n    [cell setParallax:value];\n  }\n}\n```\n\n每当列表视图滚动时，就会调用这个方法。在这个方法中，遍历所有可见的Cell，然后计算出一个偏移量，然后给每一个Cell设置一个视觉偏移。实际的偏移量将根据每一个Cell在列表视图可见部分的位置而定。\n\n编译并运行程序，就可以看到一个视差效果。\n\n![5](http://www.raywenderlich.com/wp-content/uploads/2014/06/ParallaxAnimation.gif)\n\n回到之前Views和ViewModels的工作。\n\n## 根据评论和点赞数查询\n\n界面上应该在每一张图片的底部右侧显示评论数和点赞数。但是，当前从nib创建的文件仅仅只是显示了一个123的假数据。\n\n在你使用真实数据之前，你需要在模型层添加这个功能。\n\n在Model文件夹中添加一个新的继承自NSObject的类RWTFlickrPhotoMetadata，打开RWTFlickrPhotoMetadata.h添加如下代码：\n\n```objectivec\n@property (nonatomic) NSUInteger favorites;\n@property (nonatomic) NSUInteger comments;\n```\n\n打开 RWTFlickrPhotoMetadata.m实现description方法：\n\n```objectivec\n- (NSString *)description {\n  return [NSString stringWithFormat:@\"metadata: comments=%lU, faves=%lU\",\n          self.comments, self.favorites];\n}\n```\n\n这个方法用于测试新添加的获取第一张照片的元数据的接口返回的数据是否正确。结果将被打印出来。\n\n编译并运行，搜索一些照片，当结果显示时，你将看到如下log将被打印出来。\n\n```objectivec\n2014-06-04 07:27:26.813 RWTFlickrSearch[76828:70b] metadata: comments=120, faves=434\n```\n\n## 取得元数据赋给可见的Cell\n\n你可以将当前的代码扩展成获取所有搜索结果的元数据。\n\n但是，如果结果有100张图片，你就要调用200次API接口，每张图片两次。许多API都有一个调用频率限制，这个操作可能会导致API Key被锁定，最少也是暂时不能用。\n\n其实，你只需要获取到当前在列表视图中显示的几张图片的元数据。因此，你该怎样实现这样的行为呢？你应该已经猜到了，你需要一个可以意识到他是否显示的一个ViewModel。\n\n当前的RWTSearchResultsViewModel对外暴漏了一个展示在视图上的RWTFlickrPhoto数组的接口，这些模型层的对象会被保留给View。为了能够添加一个可见性的概念，你将把这些在ViewModels里的模型对象封装起来。\n\n在ViewModel文件夹中添加一个NSObject的子类RWTSearchResultsItemViewModel，打开头文件，添加如下内容：\n\n```objectivec\n@import Foundation;\n#import \"RWTFlickrPhoto.h\"\n#import \"RWTViewModelServices.h\"\n\n@interface RWTSearchResultsItemViewModel : NSObject\n\n- (instancetype) initWithPhoto:(RWTFlickrPhoto *)photo services:(id<RWTViewModelServices>)services;\n\n@property (nonatomic) BOOL isVisible;\n@property (strong, nonatomic) NSString *title;\n@property (strong, nonatomic) NSURL *url;\n@property (strong, nonatomic) NSNumber *favorites;\n@property (strong, nonatomic) NSNumber *comments;\n\n@end\n```\n\n如你所见，这个ViewModel封装了RWTFlickrPhoto模型对象。\n\n这个ViewModel的属性混合了如下内容：\n\n* 对外的模型属性（title，url）\n* 会动态更新的图像元数据模型（favorites，comments）\n* isVisible用来指示ViewModel是否可见或不可见\n\n打开RWTSearchResultsItemViewModel.m导入如下头文件：\n\n```objectivec\n#import <ReactiveCocoa/ReactiveCocoa.h>\n#import <ReactiveCocoa/RACEXTScope.h>\n#import \"RWTFlickrPhotoMetadata.h\"\n```\n\n然后在类扩展中添加如下私有属性：\n\n```objectivec\n@interface RWTSearchResultsItemViewModel ()\n\n@property (weak, nonatomic) id<RWTViewModelServices> services;\n@property (strong, nonatomic) RWTFlickrPhoto *photo;\n\n@end\n```\n\n在同一文件中实现如下方法：\n\n```objectivec\n- (instancetype)initWithPhoto:(RWTFlickrPhoto *)photo services:(id<RWTViewModelServices>)services {\n  self = [super init];\n  if (self) {\n    _title = photo.title;\n    _url = photo.url;\n    _services = services;\n    _photo = photo;\n\n    [self initialize];\n  }\n  return  self;\n}\n```\n\n然后添加一个initialize方法，注意了，这是关键的地方：\n\n```objectivec\n- (void)initialize {\n  RACSignal *fetchMetadata =\n    [RACObserve(self, isVisible)\n     filter:^BOOL(NSNumber *visible) {\n       return [visible boolValue];\n     }];\n\n  @weakify(self)\n  [fetchMetadata subscribeNext:^(id x) {\n    @strongify(self)\n    [[[self.services getFlickrSearchService] flickrImageMetadata:self.photo.identifier]\n     subscribeNext:^(RWTFlickrPhotoMetadata *x) {\n       self.favorites = @(x.favorites);\n       self.comments = @(x.comments);\n     }];\n  }];\n}\n```\n\n方法的第一部分创建了一个用于监听isVisible属性的信号fetchMetadate，并且根据isVisible的值进行了过滤。结果就是只有当isVisible为true时这个信号才会发出Next Value。\n\n接下来一部分就是订阅这个信号以便开始请求flickrImageMetadata方法。当这个内嵌的信号触发Next时，将更新赞数和评论数。\n\n总的来说，当isVisible为true时，将触发Flickr请求，然后在未来的某个点更新comments和favorites属性。\n\n为了使这个新的ViewModel能够使用，打开RWTSearchResultsViewModel.m导入如下头文件：\n\n```objectivec\n#import <LinqToObjectiveC/NSArray+LinqExtensions.h>\n#import \"RWTSearchResultsItemViewModel.h\"\n```\n\n在初始化方法中，删除当前的代码，然后设置_searchResults如下：\n\n```objectivec\n_searchResults =\n  [results.photos linq_select:^id(RWTFlickrPhoto *photo) {\n    return [[RWTSearchResultsItemViewModel alloc]\n              initWithPhoto:photo services:services];\n  }];\n```\n\n这段代码将每一个模型对象封装成了一个ViewModel。\n\n最后一步就是根据视图设置isVisible属性，使得这些新的属性能够生效。\n\n打开RWTSearchResultsTableViewCell.m添加如下头文件：\n\n```objectivec\n#import \"RWTSearchResultsItemViewModel.h\"\n```\n\n在同一文件中，改变bindViewModel方法的第一行代码，使用新添加的ViewModel。\n\n```objectivec\nRWTSearchResultsItemViewModel *photo = viewModel;\n```\n\n在同一方法中添加如下代码：\n\n```objectivec\n[RACObserve(photo, favorites) subscribeNext:^(NSNumber *x) {\n  self.favouritesLabel.text = [x stringValue];\n  self.favouritesIcon.hidden = (x == nil);\n}];\n\n[RACObserve(photo, comments) subscribeNext:^(NSNumber *x) {\n  self.commentsLabel.text = [x stringValue];\n  self.commentsIcon.hidden = (x == nil);\n}];\n\nphoto.isVisible = YES;\n```\n\n这样当comments和favorites属性发生变化时，对应的lable以及image也会更新。\n\n最后一步，设置ViewModel的isVisible为YES。\n\n## 后记\n\n终于翻译完了，这是我第一次尝试翻译英文技术文章，前后断断续续用了大概两周的时间，真的很累，说实话，最后完全是为了翻译而去翻译的，而不是为了学习技术而去翻译的。不过这个过程中还是学到了不少东西。以后我还会坚持找一些经典的文章拿来翻译，不过不会翻译这么长的文章了，太累了。\n\n水平有限，很多地方翻译的不是很通顺，有些句子不知道怎么翻好，干脆就没有翻译，个中错误，以后有空会慢慢纠正。（2016-5-19）\n","slug":"MVVMTutorialwithReactiveCocoaPart2(翻译)","published":1,"date":"2016-05-08T16:00:00.000Z","updated":"2017-03-01T06:42:53.000Z","comments":1,"photos":[],"link":"","_id":"cjutyfmjq0070c4c97e9km400","content":"<p>原文地址：<a href=\"https://www.raywenderlich.com/74131/mvvm-tutorial-with-reactivecocoa-part-2\" target=\"_blank\" rel=\"noopener\">MVVM Tutorial with ReactiveCocoa: Part 2/2</a></p>\n<hr>\n<p>MVVM作为一种UI设计模式，正在成为一种非常流行的MVC模式的替代方案。</p>\n<p>在MVVM系列教程的第一部分，你已经了解了ReactiveCocoa是如何将ViewModels和他们各自的的View绑定起来的。</p>\n<p><img src=\"https://cdn5.raywenderlich.com/wp-content/uploads/2014/06/MVVMReactiveCocoa-700x121.png\" alt=\"1\"></p>\n<p>下面是你创建的应用，一个搜索Flickr的APP。</p>\n<p><img src=\"https://cdn3.raywenderlich.com/wp-content/uploads/2014/06/FinishedApp-671x500.png\" alt=\"2\"></p>\n<p>在 MVVM系列教程的第二部分以及最后一部分，你讲学会如果从应用程序的ViewModel中控制ViewController的导航。</p>\n<p>截止目前，你所开发的应用可以通过一个简单的字符串搜索Flickr，如果你需要当前的项目，可以从<a href=\"http://www.raywenderlich.com/wp-content/uploads/2014/06/FlickrSearchPart1Project1.zip\" target=\"_blank\" rel=\"noopener\">这里</a>下载</p>\n<p>使用ReactiveCocoa构建的模型层服务提供搜索结果，对应的ViewModel能够简单地打印出响应结果。</p>\n<p>现在，是时候完成跳转到搜索结果界面的任务了。</p>\n<h2 id=\"实现ViewModel导航\"><a href=\"#实现ViewModel导航\" class=\"headerlink\" title=\"实现ViewModel导航\"></a>实现ViewModel导航</h2><p>搜索Flickr成功并返回正确的结果后，应用程序应该跳转到一个新的ViewController并显示这些搜索结果。</p>\n<p>当前应该程序只有单一的一个ViewModel，即RWTFlickrSearchViewModel类。为了达到预期的效果，你应该再创建一个ViewModel来描述返回的搜索结果视图。</p>\n<p>在ViewModel文件夹中一个名为RWTSearchResultsViewModel类，他继承自NSObject。代码如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">@import</span> Foundation;</span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">\"RWTViewModelServices.h\"</span></span></span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">\"RWTFlickrSearchResults.h\"</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">RWTSearchResultsViewModel</span> : <span class=\"title\">NSObject</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">instancetype</span>)initWithSearchResults:(RWTFlickrSearchResults *)results services:(<span class=\"keyword\">id</span>&lt;RWTViewModelServices&gt;)services;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@property</span> (<span class=\"keyword\">strong</span>, <span class=\"keyword\">nonatomic</span>) <span class=\"built_in\">NSString</span> *title;</span><br><span class=\"line\"><span class=\"keyword\">@property</span> (<span class=\"keyword\">strong</span>, <span class=\"keyword\">nonatomic</span>) <span class=\"built_in\">NSArray</span> *searchResults;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure>\n<p>上面的代码中添加了一些属性用于描述搜索结果视图，并且声明了一个包含一个RWTFlickrSearchResults参数（返回模型层的服务）的构造方法。</p>\n<p>打开RWTSearchResultsViewModel.m实现以下代码：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">instancetype</span>)initWithSearchResults:(RWTFlickrSearchResults *)results services:(<span class=\"keyword\">id</span>&lt;RWTViewModelServices&gt;)services &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">self</span> = [<span class=\"keyword\">super</span> init]) &#123;</span><br><span class=\"line\">    _title = results.searchString;</span><br><span class=\"line\">    _searchResults = results.photos;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">self</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这样RWTSearchResultsViewModel就完成了。</p>\n<p>回忆第一部分的内容，ViewModel应该在对应的View创建之前就已经创建好了，下面就是要完成各个ViewModel对应了View了。</p>\n<p>打开RWTSearchResultsViewController.h文件，导入对应的ViewModel头文件，并且添加一个初始化方法，代码如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">\"RWTSearchResultsViewModel.h\"</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">RWTSearchResultsViewController</span> : <span class=\"title\">UIViewController</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">instancetype</span>)initWithViewModel:(RWTSearchResultsViewModel *)viewModel;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure>\n<p>打开RWTSearchResultsViewController.m文件，并且在顶部的类扩展中添加一个私有属性，如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">@property</span> (<span class=\"keyword\">strong</span>, <span class=\"keyword\">nonatomic</span>) RWTSearchResultsViewModel *viewModel;</span><br></pre></td></tr></table></figure>\n<p>进一步完成初始化方法的实现，如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">instancetype</span>)initWithViewModel:(RWTSearchResultsViewModel *)viewModel &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">self</span> = [<span class=\"keyword\">super</span> init]) &#123;</span><br><span class=\"line\">    _viewModel = viewModel;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">self</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这一步中，你将关注视图导航是如何工作的。</p>\n<p>你的应用程序现在有两个ViewModel，但是这里你将面临一个难题！我该怎么在视图控制器切换的同时也把对应的ViewModel进行切换。</p>\n<p>ViewModel不能直接持有View的引用，所以，有什么巧妙的方法可以实现这个呢？</p>\n<p>答案已经在RWTViewModelServices协议中展现了。它当前被用来获得一个模型层的引用，你将用这个协议来实现ViewModel的切换。</p>\n<p>打开RWTViewModelServices.h并且添加如下方法到协议中去。</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)pushViewModel:(<span class=\"keyword\">id</span>)viewModel;</span><br></pre></td></tr></table></figure>\n<p>从概念上讲，ViewModel层驱动着整个App，这一层的逻辑决定着界面上会显示什么，以及界面之间切换的方式和时机。</p>\n<p>这个方法允许ViewModel也像UINavigationController那样可以从一个ViewModel以Push的方法切换到另一个ViewModel。</p>\n<p>在实现这个协议之前，你应该先是这个方法在ViewModel层可以工作。</p>\n<p>打开RWTFlickrSearchViewModel.m文件并导入新添加的ViewModel。</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">\"RWTSearchResultsViewModel.h\"</span></span></span><br></pre></td></tr></table></figure>\n<p>在同一文件更新executeSearchSignal方法的实现，代码如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (RACSignal *)executeSearchSignal &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> [[[<span class=\"keyword\">self</span>.services getFlickrSearchService]</span><br><span class=\"line\">    flickrSearchSignal:<span class=\"keyword\">self</span>.searchText]</span><br><span class=\"line\">    doNext:^(<span class=\"keyword\">id</span> result) &#123;</span><br><span class=\"line\">      RWTSearchResultsViewModel *resultsViewModel =</span><br><span class=\"line\">        [[RWTSearchResultsViewModel alloc] initWithSearchResults:result services:<span class=\"keyword\">self</span>.services];</span><br><span class=\"line\">      [<span class=\"keyword\">self</span>.services pushViewModel:resultsViewModel];</span><br><span class=\"line\">    &#125;];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>上面的代码在搜索信号执行过程中添加了一个doNext操作，在doNext的block中创建了一个新的ViewModel来展示搜索结果，然后通过ViewModel的services的push操作切换到这个新的ViewModel上。</p>\n<p>现在，该更新代码，实现这个协议并达到切换ViewModel同时切换ViewController的效果。为了实现这个效果，我们需要在代码中引用导航控制器。</p>\n<p>打开RWTViewModelServicesImpl.h并且添加如下初始化方法：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">instancetype</span>)initWithNavigationController:(<span class=\"built_in\">UINavigationController</span> *)navigationController;</span><br></pre></td></tr></table></figure>\n<p>打开RWTViewModelServicesImpl.m并且添加下面的头文件：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">\"RWTSearchResultsViewController.h\"</span></span></span><br></pre></td></tr></table></figure>\n<p>然后添加一个私有属性：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">@property</span> (<span class=\"keyword\">weak</span>, <span class=\"keyword\">nonatomic</span>) <span class=\"built_in\">UINavigationController</span> *navigationController;</span><br></pre></td></tr></table></figure>\n<p>然后在同一个文件完成方法的实现：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">instancetype</span>)initWithNavigationController:(<span class=\"built_in\">UINavigationController</span> *)navigationController &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">self</span> = [<span class=\"keyword\">super</span> init]) &#123;</span><br><span class=\"line\">    _searchService = [RWTFlickrSearchImpl new];</span><br><span class=\"line\">    _navigationController = navigationController;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">self</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>上述代码用来把传过来的导航控制器引用记录下来。</p>\n<p>最后，添加一个新的方法：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)pushViewModel:(<span class=\"keyword\">id</span>)viewModel &#123;</span><br><span class=\"line\">  <span class=\"keyword\">id</span> viewController;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> ([viewModel isKindOfClass:RWTSearchResultsViewModel.class]) &#123;</span><br><span class=\"line\">    viewController = [[RWTSearchResultsViewController alloc] initWithViewModel:viewModel];</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"an unknown ViewModel was pushed!\"</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  [<span class=\"keyword\">self</span>.navigationController pushViewController:viewController animated:<span class=\"literal\">YES</span>];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>上述代码会根据ViewModel的类型来判断该显示那个视图。</p>\n<p>一般来说，View和ViewModel是一一对应的关系，但是你一定可以举出反例。</p>\n<p>最后一步，打开RWTAppDelegate.m，将createInitialViewController方法中创建RWTViewModelServicesImpl的一行改为如下代码：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">self</span>.viewModelServices = [[RWTViewModelServicesImpl alloc] initWithNavigationController:<span class=\"keyword\">self</span>.navigationController];</span><br></pre></td></tr></table></figure>\n<p>编译并运行程序，输入一个搜索关键字然后点击Go，可以观察到应用程序将切换到一个新的View/ViewModel。</p>\n<p><img src=\"https://cdn4.raywenderlich.com/wp-content/uploads/2014/06/BlankView-281x500.png\" alt=\"3\"></p>\n<p>界面是空白的，别着急，待会你将修复这个问题。</p>\n<p>现在，可以庆祝一下，你已经实现了一个含有多个ViewModel并且可以通过ViewModel来切换界面的应用程序了。</p>\n<blockquote>\n<p>小贴士：John Gossman是一名微软WPF团队的工程师，他创造了MVVM模式。他说测试MVVM的一种方法就是你的应用程序应该脱离UI也可以运行。</p>\n</blockquote>\n<blockquote>\n<p>你的应用程序通过了这个测试。如果你不确信，可以通过单元测试来执行一个搜索或从一个ViewModel切换到另一个ViewModel。</p>\n</blockquote>\n<p>现在，你已经有了一个非常纯净的解决方案，下面要开始绑定UI了。</p>\n<h2 id=\"呈现搜索结果列表\"><a href=\"#呈现搜索结果列表\" class=\"headerlink\" title=\"呈现搜索结果列表\"></a>呈现搜索结果列表</h2><p>搜索结果视图控制器RWTSearchResultsViewController在nib中定义了一个UITableview，下一步就是讲ViewModel中的内容展现在这个列表中。</p>\n<p>打开RWTSearchResultsViewController.m，添加一个类扩展，让他实现UITableViewDataSource协议，如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">RWTSearchResultsViewController</span> () &lt;<span class=\"title\">UITableViewDataSource</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>在同一文件中重写viewDidLoad方法，代码如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)viewDidLoad &#123;</span><br><span class=\"line\">  [<span class=\"keyword\">super</span> viewDidLoad];</span><br><span class=\"line\"></span><br><span class=\"line\">  [<span class=\"keyword\">self</span>.searchResultsTable registerClass:<span class=\"built_in\">UITableViewCell</span>.class</span><br><span class=\"line\">                  forCellReuseIdentifier:<span class=\"string\">@\"cell\"</span>];</span><br><span class=\"line\">  <span class=\"keyword\">self</span>.searchResultsTable.dataSource = <span class=\"keyword\">self</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  [<span class=\"keyword\">self</span> bindViewModel];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这些操作会在tableview初始化时执行一次，并绑定ViewModel。请忽略上面的Cell Identifier的硬编码，这个待会会删掉。</p>\n<p>然后在同一文件中，添加bindViewModel方法。</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)bindViewModel &#123;</span><br><span class=\"line\">  <span class=\"keyword\">self</span>.title = <span class=\"keyword\">self</span>.viewModel.title;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>当前并没有添加太多代码。ViewModel有两个属性，一个是标题，另一个是将要展示在列表中的搜索结果的数组。</p>\n<p>因此，你该如何把这些搜索结果绑定到Tableview上呢？</p>\n<p>ReactiveCocoa可以绑定简单的属性到UIKit上，但是无法处理复杂的Tableview的数据绑定。</p>\n<p>不用焦急，还有其他方法。可以使用传统的代理方法实现。</p>\n<p>在同一文件中，添加如下两个dataSource的代理方法：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"built_in\">NSInteger</span>)tableView:(<span class=\"built_in\">UITableView</span> *)tableView</span><br><span class=\"line\"> numberOfRowsInSection:(<span class=\"built_in\">NSInteger</span>)section &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">self</span>.viewModel.searchResults.count;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"built_in\">UITableViewCell</span> *)tableView:(<span class=\"built_in\">UITableView</span> *)tableView</span><br><span class=\"line\">         cellForRowAtIndexPath:(<span class=\"built_in\">NSIndexPath</span> *)indexPath &#123;</span><br><span class=\"line\">  <span class=\"built_in\">UITableViewCell</span> *cell = [tableView dequeueReusableCellWithIdentifier:<span class=\"string\">@\"cell\"</span>];</span><br><span class=\"line\">  cell.textLabel.text = [<span class=\"keyword\">self</span>.viewModel.searchResults[indexPath.row] title];</span><br><span class=\"line\">  <span class=\"keyword\">return</span> cell;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>第一个方法用来告诉Tableview搜索结果的个数，第二个方法根据ViewModel返回一个相应的Cell。这就够了，不是吗？</p>\n<p>编译并运行程序，就可以看到数据了</p>\n<p><img src=\"https://cdn2.raywenderlich.com/wp-content/uploads/2014/06/PopulatedTable-281x500.png\" alt=\"4\"></p>\n<h2 id=\"更好的Tableview数据绑定方法\"><a href=\"#更好的Tableview数据绑定方法\" class=\"headerlink\" title=\"更好的Tableview数据绑定方法\"></a>更好的Tableview数据绑定方法</h2><p>这种绑定Tableview数据的方法的缺点就是很快就会使视图控制器的代码变得很大。手动绑定数据的方法看起来也不是很优雅。</p>\n<p>这个问题困扰着我，因此我着手解决这个问题。</p>\n<p>从理论上讲，ViewModel的搜索结果数据中的每一项自身也是一个与Cell一一对应的ViewModel。在我的一篇最近的<a href=\"http://www.scottlogic.com/blog/2014/05/11/reactivecocoa-tableview-binding.html\" target=\"_blank\" rel=\"noopener\">博客</a>中，我创建了一个通用的绑定辅助类，叫做CETableViewBindingHelper，这个类允许你使用每一个子ViewModel创建一个视图。这个类可以用来辅助实现datasource协议。</p>\n<p>这个CETableViewBindingHelper类的构造方法如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">+ (<span class=\"keyword\">instancetype</span>) bindingHelperForTableView:(<span class=\"built_in\">UITableView</span> *)tableView</span><br><span class=\"line\">                              sourceSignal:(RACSignal *)source</span><br><span class=\"line\">                          selectionCommand:(RACCommand *)selection</span><br><span class=\"line\">                              templateCell:(<span class=\"built_in\">UINib</span> *)templateCellNib;</span><br></pre></td></tr></table></figure>\n<p>你仅仅只需要创建一个辅助类的引用，就可以用来绑定一个View的数组。这个构造方法的参数如下：</p>\n<ol>\n<li>需要加载ViewModel数组的Tableview</li>\n<li>一个source的信号用来监控数据的变化</li>\n<li>一个在选中一个Cell后要执行的命令</li>\n<li>cell视图的nib</li>\n</ol>\n<p>nib文件定义的Cell必须实现CEReactiveView协议。</p>\n<p>项目中已经包含了一个用于展示搜索结果的Cell视图。打开RWTSearchResultsTableViewCell.h导入协议头文件：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">\"CEReactiveView.h\"</span></span></span><br></pre></td></tr></table></figure>\n<p>实现这个协议：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">RWTSearchResultsTableViewCell</span> : <span class=\"title\">UITableViewCell</span> &lt;<span class=\"title\">CEReactiveView</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>下一步就是实现协议方法，打开RWTSearchResultsTableViewCell.m，导入如下内容：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;SDWebImage/UIImageView+WebCache.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">\"RWTFlickrPhoto.h\"</span></span></span><br></pre></td></tr></table></figure>\n<p>然后添加如下方法：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)bindViewModel:(<span class=\"keyword\">id</span>)viewModel &#123;</span><br><span class=\"line\">  RWTFlickrPhoto *photo = viewModel;</span><br><span class=\"line\">  <span class=\"keyword\">self</span>.titleLabel.text = photo.title;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">self</span>.imageThumbnailView.contentMode = <span class=\"built_in\">UIViewContentModeScaleToFill</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  [<span class=\"keyword\">self</span>.imageThumbnailView setImageWithURL:photo.url];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>现在RWTSearchResultsViewModel的searchResults属性包含了一个RWTFlickrPhoto的引用的数组。</p>\n<p>你刚刚添加的bindViewModel方法中用到了SDWebImage框架，这是一个非常有用的用来在后台加载图片的第三方框架。</p>\n<p>setImageWithURL:是SDWebImage添加的一个UIImageView的分类方法。</p>\n<p>最后一步是用绑定辅助类去展示列表。</p>\n<p>打开RWTSearchResultsViewController.m导入辅助类头文件：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">\"CETableViewBindingHelper.h\"</span></span></span><br></pre></td></tr></table></figure>\n<p>在同一文件中删除UITableDataSource协议以及实现的两个协议方法。</p>\n<p>下一步，在类扩展中添加一个如下的属性：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">@property</span> (<span class=\"keyword\">strong</span>, <span class=\"keyword\">nonatomic</span>) CETableViewBindingHelper *bindingHelper;</span><br></pre></td></tr></table></figure>\n<p>在同一文件中，删除你之前添加的ViewDidload方法中的内容，然后添加如下代码到ViewDidLoad中：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)viewDidLoad &#123;</span><br><span class=\"line\">  [<span class=\"keyword\">super</span> viewDidLoad];</span><br><span class=\"line\">  [<span class=\"keyword\">self</span> bindViewModel];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>最后，在bindViewModel方法的最后添加如下代码：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">UINib</span> *nib = [<span class=\"built_in\">UINib</span> nibWithNibName:<span class=\"string\">@\"RWTSearchResultsTableViewCell\"</span> bundle:<span class=\"literal\">nil</span>];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">self</span>.bindingHelper =</span><br><span class=\"line\">  [CETableViewBindingHelper bindingHelperForTableView:<span class=\"keyword\">self</span>.searchResultsTable</span><br><span class=\"line\">                                         sourceSignal:RACObserve(<span class=\"keyword\">self</span>.viewModel, searchResults)</span><br><span class=\"line\">                                     selectionCommand:<span class=\"literal\">nil</span></span><br><span class=\"line\">                                         templateCell:nib];</span><br></pre></td></tr></table></figure>\n<p>上述代码从nib文件中创建了一个UINIb类型的引用，并且创建了一个绑定辅助类的对象。通过观察ViewModel中的searchResults属性来创建一个sourceSignal。</p>\n<p>编译并运行，结果如下：</p>\n<p><img src=\"http://www.raywenderlich.com/wp-content/uploads/2014/06/UsingTheBindingHelper.png\" alt=\"5\"></p>\n<p>这就是一种更加又要的绑定数组到Tableview的方法。</p>\n<h2 id=\"一些UI的个性化\"><a href=\"#一些UI的个性化\" class=\"headerlink\" title=\"一些UI的个性化\"></a>一些UI的个性化</h2><p>到目前为止，这篇教程始终重点叫的都是如何根据MVVM模式构建你的应用程序。我想你已经忍不住想添加一些个性化的东西了。</p>\n<p>自从iOS7发布后，已经过了1年了，<a href=\"http://www.beyondkinetic.com/motion-ui-design-principles\" target=\"_blank\" rel=\"noopener\">运动设计</a>获得了更大的知名度，许多设计人员现在倾向于微妙的动画和流体行为。</p>\n<p>这一步中，你将在照片上添加一个微妙的视差滚动效果，棒极了。</p>\n<p>打开RWTSearchResultsTableViewCell.h添加如下方法：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>) setParallax:(<span class=\"built_in\">CGFloat</span>)value;</span><br></pre></td></tr></table></figure>\n<p>列表视图的每个Cell将使用这个方法来为每个Cell做视觉偏移。</p>\n<p>打开 RWTSearchResultsTableViewCell.m 文件添加如下代码：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)setParallax:(<span class=\"built_in\">CGFloat</span>)value &#123;</span><br><span class=\"line\">  <span class=\"keyword\">self</span>.imageThumbnailView.transform = <span class=\"built_in\">CGAffineTransformMakeTranslation</span>(<span class=\"number\">0</span>, value);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>打开RWTSearchResultsViewController.m导入如下头文件：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">\"RWTSearchResultsTableViewCell.h\"</span></span></span><br></pre></td></tr></table></figure>\n<p>在同一个文件的类扩展中实现UITableViewDelegate的协议，如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">RWTSearchResultsViewController</span> () &lt;<span class=\"title\">UITableViewDataSource</span>, <span class=\"title\">UITableViewDelegate</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>你刚刚添加了一个绑定辅助类，并且把他设置为列表视图的代理，是他可以响应列表中行的选中动作。</p>\n<p>在bindViewModel方法中设置绑定辅助类的代理：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">self</span>.bindingHelper.delegate = <span class=\"keyword\">self</span>;</span><br></pre></td></tr></table></figure>\n<p>在同一文件中添加scrollViewDidScroll方法的实现，如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)scrollViewDidScroll:(<span class=\"built_in\">UIScrollView</span> *)scrollView &#123;</span><br><span class=\"line\">  <span class=\"built_in\">NSArray</span> *cells = [<span class=\"keyword\">self</span>.searchResultsTable visibleCells];</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (RWTSearchResultsTableViewCell *cell <span class=\"keyword\">in</span> cells) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">CGFloat</span> value = <span class=\"number\">-40</span> + (cell.frame.origin.y - <span class=\"keyword\">self</span>.searchResultsTable.contentOffset.y) / <span class=\"number\">5</span>;</span><br><span class=\"line\">    [cell setParallax:value];</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>每当列表视图滚动时，就会调用这个方法。在这个方法中，遍历所有可见的Cell，然后计算出一个偏移量，然后给每一个Cell设置一个视觉偏移。实际的偏移量将根据每一个Cell在列表视图可见部分的位置而定。</p>\n<p>编译并运行程序，就可以看到一个视差效果。</p>\n<p><img src=\"http://www.raywenderlich.com/wp-content/uploads/2014/06/ParallaxAnimation.gif\" alt=\"5\"></p>\n<p>回到之前Views和ViewModels的工作。</p>\n<h2 id=\"根据评论和点赞数查询\"><a href=\"#根据评论和点赞数查询\" class=\"headerlink\" title=\"根据评论和点赞数查询\"></a>根据评论和点赞数查询</h2><p>界面上应该在每一张图片的底部右侧显示评论数和点赞数。但是，当前从nib创建的文件仅仅只是显示了一个123的假数据。</p>\n<p>在你使用真实数据之前，你需要在模型层添加这个功能。</p>\n<p>在Model文件夹中添加一个新的继承自NSObject的类RWTFlickrPhotoMetadata，打开RWTFlickrPhotoMetadata.h添加如下代码：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">@property</span> (<span class=\"keyword\">nonatomic</span>) <span class=\"built_in\">NSUInteger</span> favorites;</span><br><span class=\"line\"><span class=\"keyword\">@property</span> (<span class=\"keyword\">nonatomic</span>) <span class=\"built_in\">NSUInteger</span> comments;</span><br></pre></td></tr></table></figure>\n<p>打开 RWTFlickrPhotoMetadata.m实现description方法：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"built_in\">NSString</span> *)description &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> [<span class=\"built_in\">NSString</span> stringWithFormat:<span class=\"string\">@\"metadata: comments=%lU, faves=%lU\"</span>,</span><br><span class=\"line\">          <span class=\"keyword\">self</span>.comments, <span class=\"keyword\">self</span>.favorites];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这个方法用于测试新添加的获取第一张照片的元数据的接口返回的数据是否正确。结果将被打印出来。</p>\n<p>编译并运行，搜索一些照片，当结果显示时，你将看到如下log将被打印出来。</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">2014</span><span class=\"number\">-06</span><span class=\"number\">-04</span> <span class=\"number\">07</span>:<span class=\"number\">27</span>:<span class=\"number\">26.813</span> RWTFlickrSearch[<span class=\"number\">76828</span>:<span class=\"number\">70</span>b] metadata: comments=<span class=\"number\">120</span>, faves=<span class=\"number\">434</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"取得元数据赋给可见的Cell\"><a href=\"#取得元数据赋给可见的Cell\" class=\"headerlink\" title=\"取得元数据赋给可见的Cell\"></a>取得元数据赋给可见的Cell</h2><p>你可以将当前的代码扩展成获取所有搜索结果的元数据。</p>\n<p>但是，如果结果有100张图片，你就要调用200次API接口，每张图片两次。许多API都有一个调用频率限制，这个操作可能会导致API Key被锁定，最少也是暂时不能用。</p>\n<p>其实，你只需要获取到当前在列表视图中显示的几张图片的元数据。因此，你该怎样实现这样的行为呢？你应该已经猜到了，你需要一个可以意识到他是否显示的一个ViewModel。</p>\n<p>当前的RWTSearchResultsViewModel对外暴漏了一个展示在视图上的RWTFlickrPhoto数组的接口，这些模型层的对象会被保留给View。为了能够添加一个可见性的概念，你将把这些在ViewModels里的模型对象封装起来。</p>\n<p>在ViewModel文件夹中添加一个NSObject的子类RWTSearchResultsItemViewModel，打开头文件，添加如下内容：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">@import</span> Foundation;</span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">\"RWTFlickrPhoto.h\"</span></span></span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">\"RWTViewModelServices.h\"</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">RWTSearchResultsItemViewModel</span> : <span class=\"title\">NSObject</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">instancetype</span>) initWithPhoto:(RWTFlickrPhoto *)photo services:(<span class=\"keyword\">id</span>&lt;RWTViewModelServices&gt;)services;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@property</span> (<span class=\"keyword\">nonatomic</span>) <span class=\"built_in\">BOOL</span> isVisible;</span><br><span class=\"line\"><span class=\"keyword\">@property</span> (<span class=\"keyword\">strong</span>, <span class=\"keyword\">nonatomic</span>) <span class=\"built_in\">NSString</span> *title;</span><br><span class=\"line\"><span class=\"keyword\">@property</span> (<span class=\"keyword\">strong</span>, <span class=\"keyword\">nonatomic</span>) <span class=\"built_in\">NSURL</span> *url;</span><br><span class=\"line\"><span class=\"keyword\">@property</span> (<span class=\"keyword\">strong</span>, <span class=\"keyword\">nonatomic</span>) <span class=\"built_in\">NSNumber</span> *favorites;</span><br><span class=\"line\"><span class=\"keyword\">@property</span> (<span class=\"keyword\">strong</span>, <span class=\"keyword\">nonatomic</span>) <span class=\"built_in\">NSNumber</span> *comments;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure>\n<p>如你所见，这个ViewModel封装了RWTFlickrPhoto模型对象。</p>\n<p>这个ViewModel的属性混合了如下内容：</p>\n<ul>\n<li>对外的模型属性（title，url）</li>\n<li>会动态更新的图像元数据模型（favorites，comments）</li>\n<li>isVisible用来指示ViewModel是否可见或不可见</li>\n</ul>\n<p>打开RWTSearchResultsItemViewModel.m导入如下头文件：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;ReactiveCocoa/ReactiveCocoa.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;ReactiveCocoa/RACEXTScope.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">\"RWTFlickrPhotoMetadata.h\"</span></span></span><br></pre></td></tr></table></figure>\n<p>然后在类扩展中添加如下私有属性：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">RWTSearchResultsItemViewModel</span> ()</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@property</span> (<span class=\"keyword\">weak</span>, <span class=\"keyword\">nonatomic</span>) <span class=\"keyword\">id</span>&lt;RWTViewModelServices&gt; services;</span><br><span class=\"line\"><span class=\"keyword\">@property</span> (<span class=\"keyword\">strong</span>, <span class=\"keyword\">nonatomic</span>) RWTFlickrPhoto *photo;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure>\n<p>在同一文件中实现如下方法：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">instancetype</span>)initWithPhoto:(RWTFlickrPhoto *)photo services:(<span class=\"keyword\">id</span>&lt;RWTViewModelServices&gt;)services &#123;</span><br><span class=\"line\">  <span class=\"keyword\">self</span> = [<span class=\"keyword\">super</span> init];</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">self</span>) &#123;</span><br><span class=\"line\">    _title = photo.title;</span><br><span class=\"line\">    _url = photo.url;</span><br><span class=\"line\">    _services = services;</span><br><span class=\"line\">    _photo = photo;</span><br><span class=\"line\"></span><br><span class=\"line\">    [<span class=\"keyword\">self</span> initialize];</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span>  <span class=\"keyword\">self</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>然后添加一个initialize方法，注意了，这是关键的地方：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)initialize &#123;</span><br><span class=\"line\">  RACSignal *fetchMetadata =</span><br><span class=\"line\">    [RACObserve(<span class=\"keyword\">self</span>, isVisible)</span><br><span class=\"line\">     filter:^<span class=\"built_in\">BOOL</span>(<span class=\"built_in\">NSNumber</span> *visible) &#123;</span><br><span class=\"line\">       <span class=\"keyword\">return</span> [visible boolValue];</span><br><span class=\"line\">     &#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">  @weakify(<span class=\"keyword\">self</span>)</span><br><span class=\"line\">  [fetchMetadata subscribeNext:^(<span class=\"keyword\">id</span> x) &#123;</span><br><span class=\"line\">    @strongify(<span class=\"keyword\">self</span>)</span><br><span class=\"line\">    [[[<span class=\"keyword\">self</span>.services getFlickrSearchService] flickrImageMetadata:<span class=\"keyword\">self</span>.photo.identifier]</span><br><span class=\"line\">     subscribeNext:^(RWTFlickrPhotoMetadata *x) &#123;</span><br><span class=\"line\">       <span class=\"keyword\">self</span>.favorites = @(x.favorites);</span><br><span class=\"line\">       <span class=\"keyword\">self</span>.comments = @(x.comments);</span><br><span class=\"line\">     &#125;];</span><br><span class=\"line\">  &#125;];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>方法的第一部分创建了一个用于监听isVisible属性的信号fetchMetadate，并且根据isVisible的值进行了过滤。结果就是只有当isVisible为true时这个信号才会发出Next Value。</p>\n<p>接下来一部分就是订阅这个信号以便开始请求flickrImageMetadata方法。当这个内嵌的信号触发Next时，将更新赞数和评论数。</p>\n<p>总的来说，当isVisible为true时，将触发Flickr请求，然后在未来的某个点更新comments和favorites属性。</p>\n<p>为了使这个新的ViewModel能够使用，打开RWTSearchResultsViewModel.m导入如下头文件：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;LinqToObjectiveC/NSArray+LinqExtensions.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">\"RWTSearchResultsItemViewModel.h\"</span></span></span><br></pre></td></tr></table></figure>\n<p>在初始化方法中，删除当前的代码，然后设置_searchResults如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">_searchResults =</span><br><span class=\"line\">  [results.photos linq_select:^<span class=\"keyword\">id</span>(RWTFlickrPhoto *photo) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> [[RWTSearchResultsItemViewModel alloc]</span><br><span class=\"line\">              initWithPhoto:photo services:services];</span><br><span class=\"line\">  &#125;];</span><br></pre></td></tr></table></figure>\n<p>这段代码将每一个模型对象封装成了一个ViewModel。</p>\n<p>最后一步就是根据视图设置isVisible属性，使得这些新的属性能够生效。</p>\n<p>打开RWTSearchResultsTableViewCell.m添加如下头文件：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">\"RWTSearchResultsItemViewModel.h\"</span></span></span><br></pre></td></tr></table></figure>\n<p>在同一文件中，改变bindViewModel方法的第一行代码，使用新添加的ViewModel。</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">RWTSearchResultsItemViewModel *photo = viewModel;</span><br></pre></td></tr></table></figure>\n<p>在同一方法中添加如下代码：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[RACObserve(photo, favorites) subscribeNext:^(<span class=\"built_in\">NSNumber</span> *x) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">self</span>.favouritesLabel.text = [x stringValue];</span><br><span class=\"line\">  <span class=\"keyword\">self</span>.favouritesIcon.hidden = (x == <span class=\"literal\">nil</span>);</span><br><span class=\"line\">&#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">[RACObserve(photo, comments) subscribeNext:^(<span class=\"built_in\">NSNumber</span> *x) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">self</span>.commentsLabel.text = [x stringValue];</span><br><span class=\"line\">  <span class=\"keyword\">self</span>.commentsIcon.hidden = (x == <span class=\"literal\">nil</span>);</span><br><span class=\"line\">&#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">photo.isVisible = <span class=\"literal\">YES</span>;</span><br></pre></td></tr></table></figure>\n<p>这样当comments和favorites属性发生变化时，对应的lable以及image也会更新。</p>\n<p>最后一步，设置ViewModel的isVisible为YES。</p>\n<h2 id=\"后记\"><a href=\"#后记\" class=\"headerlink\" title=\"后记\"></a>后记</h2><p>终于翻译完了，这是我第一次尝试翻译英文技术文章，前后断断续续用了大概两周的时间，真的很累，说实话，最后完全是为了翻译而去翻译的，而不是为了学习技术而去翻译的。不过这个过程中还是学到了不少东西。以后我还会坚持找一些经典的文章拿来翻译，不过不会翻译这么长的文章了，太累了。</p>\n<p>水平有限，很多地方翻译的不是很通顺，有些句子不知道怎么翻好，干脆就没有翻译，个中错误，以后有空会慢慢纠正。（2016-5-19）</p>\n","site":{"data":{}},"excerpt":"","more":"<p>原文地址：<a href=\"https://www.raywenderlich.com/74131/mvvm-tutorial-with-reactivecocoa-part-2\" target=\"_blank\" rel=\"noopener\">MVVM Tutorial with ReactiveCocoa: Part 2/2</a></p>\n<hr>\n<p>MVVM作为一种UI设计模式，正在成为一种非常流行的MVC模式的替代方案。</p>\n<p>在MVVM系列教程的第一部分，你已经了解了ReactiveCocoa是如何将ViewModels和他们各自的的View绑定起来的。</p>\n<p><img src=\"https://cdn5.raywenderlich.com/wp-content/uploads/2014/06/MVVMReactiveCocoa-700x121.png\" alt=\"1\"></p>\n<p>下面是你创建的应用，一个搜索Flickr的APP。</p>\n<p><img src=\"https://cdn3.raywenderlich.com/wp-content/uploads/2014/06/FinishedApp-671x500.png\" alt=\"2\"></p>\n<p>在 MVVM系列教程的第二部分以及最后一部分，你讲学会如果从应用程序的ViewModel中控制ViewController的导航。</p>\n<p>截止目前，你所开发的应用可以通过一个简单的字符串搜索Flickr，如果你需要当前的项目，可以从<a href=\"http://www.raywenderlich.com/wp-content/uploads/2014/06/FlickrSearchPart1Project1.zip\" target=\"_blank\" rel=\"noopener\">这里</a>下载</p>\n<p>使用ReactiveCocoa构建的模型层服务提供搜索结果，对应的ViewModel能够简单地打印出响应结果。</p>\n<p>现在，是时候完成跳转到搜索结果界面的任务了。</p>\n<h2 id=\"实现ViewModel导航\"><a href=\"#实现ViewModel导航\" class=\"headerlink\" title=\"实现ViewModel导航\"></a>实现ViewModel导航</h2><p>搜索Flickr成功并返回正确的结果后，应用程序应该跳转到一个新的ViewController并显示这些搜索结果。</p>\n<p>当前应该程序只有单一的一个ViewModel，即RWTFlickrSearchViewModel类。为了达到预期的效果，你应该再创建一个ViewModel来描述返回的搜索结果视图。</p>\n<p>在ViewModel文件夹中一个名为RWTSearchResultsViewModel类，他继承自NSObject。代码如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">@import</span> Foundation;</span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">\"RWTViewModelServices.h\"</span></span></span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">\"RWTFlickrSearchResults.h\"</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">RWTSearchResultsViewModel</span> : <span class=\"title\">NSObject</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">instancetype</span>)initWithSearchResults:(RWTFlickrSearchResults *)results services:(<span class=\"keyword\">id</span>&lt;RWTViewModelServices&gt;)services;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@property</span> (<span class=\"keyword\">strong</span>, <span class=\"keyword\">nonatomic</span>) <span class=\"built_in\">NSString</span> *title;</span><br><span class=\"line\"><span class=\"keyword\">@property</span> (<span class=\"keyword\">strong</span>, <span class=\"keyword\">nonatomic</span>) <span class=\"built_in\">NSArray</span> *searchResults;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure>\n<p>上面的代码中添加了一些属性用于描述搜索结果视图，并且声明了一个包含一个RWTFlickrSearchResults参数（返回模型层的服务）的构造方法。</p>\n<p>打开RWTSearchResultsViewModel.m实现以下代码：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">instancetype</span>)initWithSearchResults:(RWTFlickrSearchResults *)results services:(<span class=\"keyword\">id</span>&lt;RWTViewModelServices&gt;)services &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">self</span> = [<span class=\"keyword\">super</span> init]) &#123;</span><br><span class=\"line\">    _title = results.searchString;</span><br><span class=\"line\">    _searchResults = results.photos;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">self</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这样RWTSearchResultsViewModel就完成了。</p>\n<p>回忆第一部分的内容，ViewModel应该在对应的View创建之前就已经创建好了，下面就是要完成各个ViewModel对应了View了。</p>\n<p>打开RWTSearchResultsViewController.h文件，导入对应的ViewModel头文件，并且添加一个初始化方法，代码如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">\"RWTSearchResultsViewModel.h\"</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">RWTSearchResultsViewController</span> : <span class=\"title\">UIViewController</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">instancetype</span>)initWithViewModel:(RWTSearchResultsViewModel *)viewModel;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure>\n<p>打开RWTSearchResultsViewController.m文件，并且在顶部的类扩展中添加一个私有属性，如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">@property</span> (<span class=\"keyword\">strong</span>, <span class=\"keyword\">nonatomic</span>) RWTSearchResultsViewModel *viewModel;</span><br></pre></td></tr></table></figure>\n<p>进一步完成初始化方法的实现，如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">instancetype</span>)initWithViewModel:(RWTSearchResultsViewModel *)viewModel &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">self</span> = [<span class=\"keyword\">super</span> init]) &#123;</span><br><span class=\"line\">    _viewModel = viewModel;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">self</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这一步中，你将关注视图导航是如何工作的。</p>\n<p>你的应用程序现在有两个ViewModel，但是这里你将面临一个难题！我该怎么在视图控制器切换的同时也把对应的ViewModel进行切换。</p>\n<p>ViewModel不能直接持有View的引用，所以，有什么巧妙的方法可以实现这个呢？</p>\n<p>答案已经在RWTViewModelServices协议中展现了。它当前被用来获得一个模型层的引用，你将用这个协议来实现ViewModel的切换。</p>\n<p>打开RWTViewModelServices.h并且添加如下方法到协议中去。</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)pushViewModel:(<span class=\"keyword\">id</span>)viewModel;</span><br></pre></td></tr></table></figure>\n<p>从概念上讲，ViewModel层驱动着整个App，这一层的逻辑决定着界面上会显示什么，以及界面之间切换的方式和时机。</p>\n<p>这个方法允许ViewModel也像UINavigationController那样可以从一个ViewModel以Push的方法切换到另一个ViewModel。</p>\n<p>在实现这个协议之前，你应该先是这个方法在ViewModel层可以工作。</p>\n<p>打开RWTFlickrSearchViewModel.m文件并导入新添加的ViewModel。</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">\"RWTSearchResultsViewModel.h\"</span></span></span><br></pre></td></tr></table></figure>\n<p>在同一文件更新executeSearchSignal方法的实现，代码如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (RACSignal *)executeSearchSignal &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> [[[<span class=\"keyword\">self</span>.services getFlickrSearchService]</span><br><span class=\"line\">    flickrSearchSignal:<span class=\"keyword\">self</span>.searchText]</span><br><span class=\"line\">    doNext:^(<span class=\"keyword\">id</span> result) &#123;</span><br><span class=\"line\">      RWTSearchResultsViewModel *resultsViewModel =</span><br><span class=\"line\">        [[RWTSearchResultsViewModel alloc] initWithSearchResults:result services:<span class=\"keyword\">self</span>.services];</span><br><span class=\"line\">      [<span class=\"keyword\">self</span>.services pushViewModel:resultsViewModel];</span><br><span class=\"line\">    &#125;];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>上面的代码在搜索信号执行过程中添加了一个doNext操作，在doNext的block中创建了一个新的ViewModel来展示搜索结果，然后通过ViewModel的services的push操作切换到这个新的ViewModel上。</p>\n<p>现在，该更新代码，实现这个协议并达到切换ViewModel同时切换ViewController的效果。为了实现这个效果，我们需要在代码中引用导航控制器。</p>\n<p>打开RWTViewModelServicesImpl.h并且添加如下初始化方法：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">instancetype</span>)initWithNavigationController:(<span class=\"built_in\">UINavigationController</span> *)navigationController;</span><br></pre></td></tr></table></figure>\n<p>打开RWTViewModelServicesImpl.m并且添加下面的头文件：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">\"RWTSearchResultsViewController.h\"</span></span></span><br></pre></td></tr></table></figure>\n<p>然后添加一个私有属性：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">@property</span> (<span class=\"keyword\">weak</span>, <span class=\"keyword\">nonatomic</span>) <span class=\"built_in\">UINavigationController</span> *navigationController;</span><br></pre></td></tr></table></figure>\n<p>然后在同一个文件完成方法的实现：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">instancetype</span>)initWithNavigationController:(<span class=\"built_in\">UINavigationController</span> *)navigationController &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">self</span> = [<span class=\"keyword\">super</span> init]) &#123;</span><br><span class=\"line\">    _searchService = [RWTFlickrSearchImpl new];</span><br><span class=\"line\">    _navigationController = navigationController;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">self</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>上述代码用来把传过来的导航控制器引用记录下来。</p>\n<p>最后，添加一个新的方法：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)pushViewModel:(<span class=\"keyword\">id</span>)viewModel &#123;</span><br><span class=\"line\">  <span class=\"keyword\">id</span> viewController;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> ([viewModel isKindOfClass:RWTSearchResultsViewModel.class]) &#123;</span><br><span class=\"line\">    viewController = [[RWTSearchResultsViewController alloc] initWithViewModel:viewModel];</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"an unknown ViewModel was pushed!\"</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  [<span class=\"keyword\">self</span>.navigationController pushViewController:viewController animated:<span class=\"literal\">YES</span>];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>上述代码会根据ViewModel的类型来判断该显示那个视图。</p>\n<p>一般来说，View和ViewModel是一一对应的关系，但是你一定可以举出反例。</p>\n<p>最后一步，打开RWTAppDelegate.m，将createInitialViewController方法中创建RWTViewModelServicesImpl的一行改为如下代码：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">self</span>.viewModelServices = [[RWTViewModelServicesImpl alloc] initWithNavigationController:<span class=\"keyword\">self</span>.navigationController];</span><br></pre></td></tr></table></figure>\n<p>编译并运行程序，输入一个搜索关键字然后点击Go，可以观察到应用程序将切换到一个新的View/ViewModel。</p>\n<p><img src=\"https://cdn4.raywenderlich.com/wp-content/uploads/2014/06/BlankView-281x500.png\" alt=\"3\"></p>\n<p>界面是空白的，别着急，待会你将修复这个问题。</p>\n<p>现在，可以庆祝一下，你已经实现了一个含有多个ViewModel并且可以通过ViewModel来切换界面的应用程序了。</p>\n<blockquote>\n<p>小贴士：John Gossman是一名微软WPF团队的工程师，他创造了MVVM模式。他说测试MVVM的一种方法就是你的应用程序应该脱离UI也可以运行。</p>\n</blockquote>\n<blockquote>\n<p>你的应用程序通过了这个测试。如果你不确信，可以通过单元测试来执行一个搜索或从一个ViewModel切换到另一个ViewModel。</p>\n</blockquote>\n<p>现在，你已经有了一个非常纯净的解决方案，下面要开始绑定UI了。</p>\n<h2 id=\"呈现搜索结果列表\"><a href=\"#呈现搜索结果列表\" class=\"headerlink\" title=\"呈现搜索结果列表\"></a>呈现搜索结果列表</h2><p>搜索结果视图控制器RWTSearchResultsViewController在nib中定义了一个UITableview，下一步就是讲ViewModel中的内容展现在这个列表中。</p>\n<p>打开RWTSearchResultsViewController.m，添加一个类扩展，让他实现UITableViewDataSource协议，如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">RWTSearchResultsViewController</span> () &lt;<span class=\"title\">UITableViewDataSource</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>在同一文件中重写viewDidLoad方法，代码如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)viewDidLoad &#123;</span><br><span class=\"line\">  [<span class=\"keyword\">super</span> viewDidLoad];</span><br><span class=\"line\"></span><br><span class=\"line\">  [<span class=\"keyword\">self</span>.searchResultsTable registerClass:<span class=\"built_in\">UITableViewCell</span>.class</span><br><span class=\"line\">                  forCellReuseIdentifier:<span class=\"string\">@\"cell\"</span>];</span><br><span class=\"line\">  <span class=\"keyword\">self</span>.searchResultsTable.dataSource = <span class=\"keyword\">self</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  [<span class=\"keyword\">self</span> bindViewModel];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这些操作会在tableview初始化时执行一次，并绑定ViewModel。请忽略上面的Cell Identifier的硬编码，这个待会会删掉。</p>\n<p>然后在同一文件中，添加bindViewModel方法。</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)bindViewModel &#123;</span><br><span class=\"line\">  <span class=\"keyword\">self</span>.title = <span class=\"keyword\">self</span>.viewModel.title;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>当前并没有添加太多代码。ViewModel有两个属性，一个是标题，另一个是将要展示在列表中的搜索结果的数组。</p>\n<p>因此，你该如何把这些搜索结果绑定到Tableview上呢？</p>\n<p>ReactiveCocoa可以绑定简单的属性到UIKit上，但是无法处理复杂的Tableview的数据绑定。</p>\n<p>不用焦急，还有其他方法。可以使用传统的代理方法实现。</p>\n<p>在同一文件中，添加如下两个dataSource的代理方法：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"built_in\">NSInteger</span>)tableView:(<span class=\"built_in\">UITableView</span> *)tableView</span><br><span class=\"line\"> numberOfRowsInSection:(<span class=\"built_in\">NSInteger</span>)section &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">self</span>.viewModel.searchResults.count;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"built_in\">UITableViewCell</span> *)tableView:(<span class=\"built_in\">UITableView</span> *)tableView</span><br><span class=\"line\">         cellForRowAtIndexPath:(<span class=\"built_in\">NSIndexPath</span> *)indexPath &#123;</span><br><span class=\"line\">  <span class=\"built_in\">UITableViewCell</span> *cell = [tableView dequeueReusableCellWithIdentifier:<span class=\"string\">@\"cell\"</span>];</span><br><span class=\"line\">  cell.textLabel.text = [<span class=\"keyword\">self</span>.viewModel.searchResults[indexPath.row] title];</span><br><span class=\"line\">  <span class=\"keyword\">return</span> cell;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>第一个方法用来告诉Tableview搜索结果的个数，第二个方法根据ViewModel返回一个相应的Cell。这就够了，不是吗？</p>\n<p>编译并运行程序，就可以看到数据了</p>\n<p><img src=\"https://cdn2.raywenderlich.com/wp-content/uploads/2014/06/PopulatedTable-281x500.png\" alt=\"4\"></p>\n<h2 id=\"更好的Tableview数据绑定方法\"><a href=\"#更好的Tableview数据绑定方法\" class=\"headerlink\" title=\"更好的Tableview数据绑定方法\"></a>更好的Tableview数据绑定方法</h2><p>这种绑定Tableview数据的方法的缺点就是很快就会使视图控制器的代码变得很大。手动绑定数据的方法看起来也不是很优雅。</p>\n<p>这个问题困扰着我，因此我着手解决这个问题。</p>\n<p>从理论上讲，ViewModel的搜索结果数据中的每一项自身也是一个与Cell一一对应的ViewModel。在我的一篇最近的<a href=\"http://www.scottlogic.com/blog/2014/05/11/reactivecocoa-tableview-binding.html\" target=\"_blank\" rel=\"noopener\">博客</a>中，我创建了一个通用的绑定辅助类，叫做CETableViewBindingHelper，这个类允许你使用每一个子ViewModel创建一个视图。这个类可以用来辅助实现datasource协议。</p>\n<p>这个CETableViewBindingHelper类的构造方法如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">+ (<span class=\"keyword\">instancetype</span>) bindingHelperForTableView:(<span class=\"built_in\">UITableView</span> *)tableView</span><br><span class=\"line\">                              sourceSignal:(RACSignal *)source</span><br><span class=\"line\">                          selectionCommand:(RACCommand *)selection</span><br><span class=\"line\">                              templateCell:(<span class=\"built_in\">UINib</span> *)templateCellNib;</span><br></pre></td></tr></table></figure>\n<p>你仅仅只需要创建一个辅助类的引用，就可以用来绑定一个View的数组。这个构造方法的参数如下：</p>\n<ol>\n<li>需要加载ViewModel数组的Tableview</li>\n<li>一个source的信号用来监控数据的变化</li>\n<li>一个在选中一个Cell后要执行的命令</li>\n<li>cell视图的nib</li>\n</ol>\n<p>nib文件定义的Cell必须实现CEReactiveView协议。</p>\n<p>项目中已经包含了一个用于展示搜索结果的Cell视图。打开RWTSearchResultsTableViewCell.h导入协议头文件：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">\"CEReactiveView.h\"</span></span></span><br></pre></td></tr></table></figure>\n<p>实现这个协议：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">RWTSearchResultsTableViewCell</span> : <span class=\"title\">UITableViewCell</span> &lt;<span class=\"title\">CEReactiveView</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>下一步就是实现协议方法，打开RWTSearchResultsTableViewCell.m，导入如下内容：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;SDWebImage/UIImageView+WebCache.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">\"RWTFlickrPhoto.h\"</span></span></span><br></pre></td></tr></table></figure>\n<p>然后添加如下方法：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)bindViewModel:(<span class=\"keyword\">id</span>)viewModel &#123;</span><br><span class=\"line\">  RWTFlickrPhoto *photo = viewModel;</span><br><span class=\"line\">  <span class=\"keyword\">self</span>.titleLabel.text = photo.title;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">self</span>.imageThumbnailView.contentMode = <span class=\"built_in\">UIViewContentModeScaleToFill</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  [<span class=\"keyword\">self</span>.imageThumbnailView setImageWithURL:photo.url];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>现在RWTSearchResultsViewModel的searchResults属性包含了一个RWTFlickrPhoto的引用的数组。</p>\n<p>你刚刚添加的bindViewModel方法中用到了SDWebImage框架，这是一个非常有用的用来在后台加载图片的第三方框架。</p>\n<p>setImageWithURL:是SDWebImage添加的一个UIImageView的分类方法。</p>\n<p>最后一步是用绑定辅助类去展示列表。</p>\n<p>打开RWTSearchResultsViewController.m导入辅助类头文件：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">\"CETableViewBindingHelper.h\"</span></span></span><br></pre></td></tr></table></figure>\n<p>在同一文件中删除UITableDataSource协议以及实现的两个协议方法。</p>\n<p>下一步，在类扩展中添加一个如下的属性：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">@property</span> (<span class=\"keyword\">strong</span>, <span class=\"keyword\">nonatomic</span>) CETableViewBindingHelper *bindingHelper;</span><br></pre></td></tr></table></figure>\n<p>在同一文件中，删除你之前添加的ViewDidload方法中的内容，然后添加如下代码到ViewDidLoad中：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)viewDidLoad &#123;</span><br><span class=\"line\">  [<span class=\"keyword\">super</span> viewDidLoad];</span><br><span class=\"line\">  [<span class=\"keyword\">self</span> bindViewModel];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>最后，在bindViewModel方法的最后添加如下代码：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">UINib</span> *nib = [<span class=\"built_in\">UINib</span> nibWithNibName:<span class=\"string\">@\"RWTSearchResultsTableViewCell\"</span> bundle:<span class=\"literal\">nil</span>];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">self</span>.bindingHelper =</span><br><span class=\"line\">  [CETableViewBindingHelper bindingHelperForTableView:<span class=\"keyword\">self</span>.searchResultsTable</span><br><span class=\"line\">                                         sourceSignal:RACObserve(<span class=\"keyword\">self</span>.viewModel, searchResults)</span><br><span class=\"line\">                                     selectionCommand:<span class=\"literal\">nil</span></span><br><span class=\"line\">                                         templateCell:nib];</span><br></pre></td></tr></table></figure>\n<p>上述代码从nib文件中创建了一个UINIb类型的引用，并且创建了一个绑定辅助类的对象。通过观察ViewModel中的searchResults属性来创建一个sourceSignal。</p>\n<p>编译并运行，结果如下：</p>\n<p><img src=\"http://www.raywenderlich.com/wp-content/uploads/2014/06/UsingTheBindingHelper.png\" alt=\"5\"></p>\n<p>这就是一种更加又要的绑定数组到Tableview的方法。</p>\n<h2 id=\"一些UI的个性化\"><a href=\"#一些UI的个性化\" class=\"headerlink\" title=\"一些UI的个性化\"></a>一些UI的个性化</h2><p>到目前为止，这篇教程始终重点叫的都是如何根据MVVM模式构建你的应用程序。我想你已经忍不住想添加一些个性化的东西了。</p>\n<p>自从iOS7发布后，已经过了1年了，<a href=\"http://www.beyondkinetic.com/motion-ui-design-principles\" target=\"_blank\" rel=\"noopener\">运动设计</a>获得了更大的知名度，许多设计人员现在倾向于微妙的动画和流体行为。</p>\n<p>这一步中，你将在照片上添加一个微妙的视差滚动效果，棒极了。</p>\n<p>打开RWTSearchResultsTableViewCell.h添加如下方法：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>) setParallax:(<span class=\"built_in\">CGFloat</span>)value;</span><br></pre></td></tr></table></figure>\n<p>列表视图的每个Cell将使用这个方法来为每个Cell做视觉偏移。</p>\n<p>打开 RWTSearchResultsTableViewCell.m 文件添加如下代码：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)setParallax:(<span class=\"built_in\">CGFloat</span>)value &#123;</span><br><span class=\"line\">  <span class=\"keyword\">self</span>.imageThumbnailView.transform = <span class=\"built_in\">CGAffineTransformMakeTranslation</span>(<span class=\"number\">0</span>, value);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>打开RWTSearchResultsViewController.m导入如下头文件：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">\"RWTSearchResultsTableViewCell.h\"</span></span></span><br></pre></td></tr></table></figure>\n<p>在同一个文件的类扩展中实现UITableViewDelegate的协议，如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">RWTSearchResultsViewController</span> () &lt;<span class=\"title\">UITableViewDataSource</span>, <span class=\"title\">UITableViewDelegate</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>你刚刚添加了一个绑定辅助类，并且把他设置为列表视图的代理，是他可以响应列表中行的选中动作。</p>\n<p>在bindViewModel方法中设置绑定辅助类的代理：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">self</span>.bindingHelper.delegate = <span class=\"keyword\">self</span>;</span><br></pre></td></tr></table></figure>\n<p>在同一文件中添加scrollViewDidScroll方法的实现，如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)scrollViewDidScroll:(<span class=\"built_in\">UIScrollView</span> *)scrollView &#123;</span><br><span class=\"line\">  <span class=\"built_in\">NSArray</span> *cells = [<span class=\"keyword\">self</span>.searchResultsTable visibleCells];</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (RWTSearchResultsTableViewCell *cell <span class=\"keyword\">in</span> cells) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">CGFloat</span> value = <span class=\"number\">-40</span> + (cell.frame.origin.y - <span class=\"keyword\">self</span>.searchResultsTable.contentOffset.y) / <span class=\"number\">5</span>;</span><br><span class=\"line\">    [cell setParallax:value];</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>每当列表视图滚动时，就会调用这个方法。在这个方法中，遍历所有可见的Cell，然后计算出一个偏移量，然后给每一个Cell设置一个视觉偏移。实际的偏移量将根据每一个Cell在列表视图可见部分的位置而定。</p>\n<p>编译并运行程序，就可以看到一个视差效果。</p>\n<p><img src=\"http://www.raywenderlich.com/wp-content/uploads/2014/06/ParallaxAnimation.gif\" alt=\"5\"></p>\n<p>回到之前Views和ViewModels的工作。</p>\n<h2 id=\"根据评论和点赞数查询\"><a href=\"#根据评论和点赞数查询\" class=\"headerlink\" title=\"根据评论和点赞数查询\"></a>根据评论和点赞数查询</h2><p>界面上应该在每一张图片的底部右侧显示评论数和点赞数。但是，当前从nib创建的文件仅仅只是显示了一个123的假数据。</p>\n<p>在你使用真实数据之前，你需要在模型层添加这个功能。</p>\n<p>在Model文件夹中添加一个新的继承自NSObject的类RWTFlickrPhotoMetadata，打开RWTFlickrPhotoMetadata.h添加如下代码：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">@property</span> (<span class=\"keyword\">nonatomic</span>) <span class=\"built_in\">NSUInteger</span> favorites;</span><br><span class=\"line\"><span class=\"keyword\">@property</span> (<span class=\"keyword\">nonatomic</span>) <span class=\"built_in\">NSUInteger</span> comments;</span><br></pre></td></tr></table></figure>\n<p>打开 RWTFlickrPhotoMetadata.m实现description方法：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"built_in\">NSString</span> *)description &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> [<span class=\"built_in\">NSString</span> stringWithFormat:<span class=\"string\">@\"metadata: comments=%lU, faves=%lU\"</span>,</span><br><span class=\"line\">          <span class=\"keyword\">self</span>.comments, <span class=\"keyword\">self</span>.favorites];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这个方法用于测试新添加的获取第一张照片的元数据的接口返回的数据是否正确。结果将被打印出来。</p>\n<p>编译并运行，搜索一些照片，当结果显示时，你将看到如下log将被打印出来。</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">2014</span><span class=\"number\">-06</span><span class=\"number\">-04</span> <span class=\"number\">07</span>:<span class=\"number\">27</span>:<span class=\"number\">26.813</span> RWTFlickrSearch[<span class=\"number\">76828</span>:<span class=\"number\">70</span>b] metadata: comments=<span class=\"number\">120</span>, faves=<span class=\"number\">434</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"取得元数据赋给可见的Cell\"><a href=\"#取得元数据赋给可见的Cell\" class=\"headerlink\" title=\"取得元数据赋给可见的Cell\"></a>取得元数据赋给可见的Cell</h2><p>你可以将当前的代码扩展成获取所有搜索结果的元数据。</p>\n<p>但是，如果结果有100张图片，你就要调用200次API接口，每张图片两次。许多API都有一个调用频率限制，这个操作可能会导致API Key被锁定，最少也是暂时不能用。</p>\n<p>其实，你只需要获取到当前在列表视图中显示的几张图片的元数据。因此，你该怎样实现这样的行为呢？你应该已经猜到了，你需要一个可以意识到他是否显示的一个ViewModel。</p>\n<p>当前的RWTSearchResultsViewModel对外暴漏了一个展示在视图上的RWTFlickrPhoto数组的接口，这些模型层的对象会被保留给View。为了能够添加一个可见性的概念，你将把这些在ViewModels里的模型对象封装起来。</p>\n<p>在ViewModel文件夹中添加一个NSObject的子类RWTSearchResultsItemViewModel，打开头文件，添加如下内容：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">@import</span> Foundation;</span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">\"RWTFlickrPhoto.h\"</span></span></span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">\"RWTViewModelServices.h\"</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">RWTSearchResultsItemViewModel</span> : <span class=\"title\">NSObject</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">instancetype</span>) initWithPhoto:(RWTFlickrPhoto *)photo services:(<span class=\"keyword\">id</span>&lt;RWTViewModelServices&gt;)services;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@property</span> (<span class=\"keyword\">nonatomic</span>) <span class=\"built_in\">BOOL</span> isVisible;</span><br><span class=\"line\"><span class=\"keyword\">@property</span> (<span class=\"keyword\">strong</span>, <span class=\"keyword\">nonatomic</span>) <span class=\"built_in\">NSString</span> *title;</span><br><span class=\"line\"><span class=\"keyword\">@property</span> (<span class=\"keyword\">strong</span>, <span class=\"keyword\">nonatomic</span>) <span class=\"built_in\">NSURL</span> *url;</span><br><span class=\"line\"><span class=\"keyword\">@property</span> (<span class=\"keyword\">strong</span>, <span class=\"keyword\">nonatomic</span>) <span class=\"built_in\">NSNumber</span> *favorites;</span><br><span class=\"line\"><span class=\"keyword\">@property</span> (<span class=\"keyword\">strong</span>, <span class=\"keyword\">nonatomic</span>) <span class=\"built_in\">NSNumber</span> *comments;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure>\n<p>如你所见，这个ViewModel封装了RWTFlickrPhoto模型对象。</p>\n<p>这个ViewModel的属性混合了如下内容：</p>\n<ul>\n<li>对外的模型属性（title，url）</li>\n<li>会动态更新的图像元数据模型（favorites，comments）</li>\n<li>isVisible用来指示ViewModel是否可见或不可见</li>\n</ul>\n<p>打开RWTSearchResultsItemViewModel.m导入如下头文件：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;ReactiveCocoa/ReactiveCocoa.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;ReactiveCocoa/RACEXTScope.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">\"RWTFlickrPhotoMetadata.h\"</span></span></span><br></pre></td></tr></table></figure>\n<p>然后在类扩展中添加如下私有属性：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">RWTSearchResultsItemViewModel</span> ()</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@property</span> (<span class=\"keyword\">weak</span>, <span class=\"keyword\">nonatomic</span>) <span class=\"keyword\">id</span>&lt;RWTViewModelServices&gt; services;</span><br><span class=\"line\"><span class=\"keyword\">@property</span> (<span class=\"keyword\">strong</span>, <span class=\"keyword\">nonatomic</span>) RWTFlickrPhoto *photo;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure>\n<p>在同一文件中实现如下方法：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">instancetype</span>)initWithPhoto:(RWTFlickrPhoto *)photo services:(<span class=\"keyword\">id</span>&lt;RWTViewModelServices&gt;)services &#123;</span><br><span class=\"line\">  <span class=\"keyword\">self</span> = [<span class=\"keyword\">super</span> init];</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">self</span>) &#123;</span><br><span class=\"line\">    _title = photo.title;</span><br><span class=\"line\">    _url = photo.url;</span><br><span class=\"line\">    _services = services;</span><br><span class=\"line\">    _photo = photo;</span><br><span class=\"line\"></span><br><span class=\"line\">    [<span class=\"keyword\">self</span> initialize];</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span>  <span class=\"keyword\">self</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>然后添加一个initialize方法，注意了，这是关键的地方：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)initialize &#123;</span><br><span class=\"line\">  RACSignal *fetchMetadata =</span><br><span class=\"line\">    [RACObserve(<span class=\"keyword\">self</span>, isVisible)</span><br><span class=\"line\">     filter:^<span class=\"built_in\">BOOL</span>(<span class=\"built_in\">NSNumber</span> *visible) &#123;</span><br><span class=\"line\">       <span class=\"keyword\">return</span> [visible boolValue];</span><br><span class=\"line\">     &#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">  @weakify(<span class=\"keyword\">self</span>)</span><br><span class=\"line\">  [fetchMetadata subscribeNext:^(<span class=\"keyword\">id</span> x) &#123;</span><br><span class=\"line\">    @strongify(<span class=\"keyword\">self</span>)</span><br><span class=\"line\">    [[[<span class=\"keyword\">self</span>.services getFlickrSearchService] flickrImageMetadata:<span class=\"keyword\">self</span>.photo.identifier]</span><br><span class=\"line\">     subscribeNext:^(RWTFlickrPhotoMetadata *x) &#123;</span><br><span class=\"line\">       <span class=\"keyword\">self</span>.favorites = @(x.favorites);</span><br><span class=\"line\">       <span class=\"keyword\">self</span>.comments = @(x.comments);</span><br><span class=\"line\">     &#125;];</span><br><span class=\"line\">  &#125;];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>方法的第一部分创建了一个用于监听isVisible属性的信号fetchMetadate，并且根据isVisible的值进行了过滤。结果就是只有当isVisible为true时这个信号才会发出Next Value。</p>\n<p>接下来一部分就是订阅这个信号以便开始请求flickrImageMetadata方法。当这个内嵌的信号触发Next时，将更新赞数和评论数。</p>\n<p>总的来说，当isVisible为true时，将触发Flickr请求，然后在未来的某个点更新comments和favorites属性。</p>\n<p>为了使这个新的ViewModel能够使用，打开RWTSearchResultsViewModel.m导入如下头文件：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;LinqToObjectiveC/NSArray+LinqExtensions.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">\"RWTSearchResultsItemViewModel.h\"</span></span></span><br></pre></td></tr></table></figure>\n<p>在初始化方法中，删除当前的代码，然后设置_searchResults如下：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">_searchResults =</span><br><span class=\"line\">  [results.photos linq_select:^<span class=\"keyword\">id</span>(RWTFlickrPhoto *photo) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> [[RWTSearchResultsItemViewModel alloc]</span><br><span class=\"line\">              initWithPhoto:photo services:services];</span><br><span class=\"line\">  &#125;];</span><br></pre></td></tr></table></figure>\n<p>这段代码将每一个模型对象封装成了一个ViewModel。</p>\n<p>最后一步就是根据视图设置isVisible属性，使得这些新的属性能够生效。</p>\n<p>打开RWTSearchResultsTableViewCell.m添加如下头文件：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">\"RWTSearchResultsItemViewModel.h\"</span></span></span><br></pre></td></tr></table></figure>\n<p>在同一文件中，改变bindViewModel方法的第一行代码，使用新添加的ViewModel。</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">RWTSearchResultsItemViewModel *photo = viewModel;</span><br></pre></td></tr></table></figure>\n<p>在同一方法中添加如下代码：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[RACObserve(photo, favorites) subscribeNext:^(<span class=\"built_in\">NSNumber</span> *x) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">self</span>.favouritesLabel.text = [x stringValue];</span><br><span class=\"line\">  <span class=\"keyword\">self</span>.favouritesIcon.hidden = (x == <span class=\"literal\">nil</span>);</span><br><span class=\"line\">&#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">[RACObserve(photo, comments) subscribeNext:^(<span class=\"built_in\">NSNumber</span> *x) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">self</span>.commentsLabel.text = [x stringValue];</span><br><span class=\"line\">  <span class=\"keyword\">self</span>.commentsIcon.hidden = (x == <span class=\"literal\">nil</span>);</span><br><span class=\"line\">&#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">photo.isVisible = <span class=\"literal\">YES</span>;</span><br></pre></td></tr></table></figure>\n<p>这样当comments和favorites属性发生变化时，对应的lable以及image也会更新。</p>\n<p>最后一步，设置ViewModel的isVisible为YES。</p>\n<h2 id=\"后记\"><a href=\"#后记\" class=\"headerlink\" title=\"后记\"></a>后记</h2><p>终于翻译完了，这是我第一次尝试翻译英文技术文章，前后断断续续用了大概两周的时间，真的很累，说实话，最后完全是为了翻译而去翻译的，而不是为了学习技术而去翻译的。不过这个过程中还是学到了不少东西。以后我还会坚持找一些经典的文章拿来翻译，不过不会翻译这么长的文章了，太累了。</p>\n<p>水平有限，很多地方翻译的不是很通顺，有些句子不知道怎么翻好，干脆就没有翻译，个中错误，以后有空会慢慢纠正。（2016-5-19）</p>\n"},{"title":"Python学习笔记(1)","date":"2018-09-01T00:26:31.000Z","_content":"\n## 数据类型\n\n### 除，整除\n\n与其他语言不通，`/`是除法，得到的 float 类型，要得到整型需要用`//`\n\n```python\ntype(2/2) # float\ntype(2//2) # int\n1//2 # 0\n1/2 # 0.5\n```\n\n### 二进制，八进制，十六进制\n\n```python\n0b10 # 2进制\n0o10 # 8进制\n0x10 # 16进制\n# 将一个数转为二进制\nbin(12)\n# 将一个数转为10进制\nint(0x12)\n# 将一个数转为16进制\nhex(12131)\n# 将一个数转为8进制\noct(0x1231)\n```\n\n### 布尔类型\n\n布尔类型有两个值，`True`与`False`\n\n- 对于整数来说，非 0 可以转为`True`，0 可以转为`False`\n- 对于字符串来说，空字符串可以转为`False`，其他字符串可以转为`True`\n- 对于列表和元组等序列来说，空序列可以转为`False`，序列中有元素可以转为`True`\n- 对集合和字典来说，空字典，空集合可以转为`False`，字典或序列中有元素可以转为`True`\n- None 也可以转为`False`\n\n```python\nnum1 = 1\nif num1:\n    print('YES')  # YES\nelse:\n    print('NO')\n\nnum2 = 0\nif num2:\n    print('YES')\nelse:\n    print('NO')  # NO\n\nlist1 = []\nlist2 = [1, 2, 3]\nif list1:\n    print('YES')\nelse:\n    print('NO')  # NO\n\nif list2:\n    print('YES')  # YES\nelse:\n    print('NO')\n\ndict1 = {}\ndict2 = {1: 'A', 2: 'B'}\nif dict1:\n    print('YES')\nelse:\n    print('NO')  # NO\n\nif dict2:\n    print('YES')  # YES\nelse:\n    print('NO')\n```\n\n### 单引号和双引号\n\n- 单引号：单引号可以包含双引号，例如：`'My name is \"ljl\"'`\n- 双引号：双引号也可以包含单引号，例如：`\"Let's go\"`\n\n### 多行文本\n\n多行文本可以用三个双引号表示，也可以用三个单引号表示，例如：\n\n```python\n'''\nHello!\nMy name is Liuijinlong.\nWhat is your name?\n'''\n\n\"\"\"\nHello!\nMy name is Liuijinlong.\nWhat is your name?\n\"\"\"\n```\n\n- 要显示字符串的格式要使用`print`函数\n- idle 会把字符串中的格式变为转义字符，如下：\n\n![1](http://blog.shicishuzhai.com/094e3ce9743b9dafadb426041996058b.png)\n\n### 原始字符\n\n在字符串前加一个 r，字符串中的转义字符不会被解析\n\n```python\nprint(r'aaa \\n aaa') # aaa \\n aaa\n```\n\n### 字符串的操作\n\n```python\ns1 = \"Hello\"\ns2 = \"World\"\n\n# 拼接\ns = s1 + s2\nprint(s)  # HelloWorld\n\n# 截取，切片操作\nprint(s[2])  # l\nprint(s[2: 5])  # llo\nprint(s[2: -3])  # lloWo\n\nprint(s1 * 2)  # 重复字符串：HelloHello\nprint(len(s1))  # 字符串长度：5\nprint(s1.count('l'))  # l在字符串中出现的次数\nprint(s1.find('ell'))  # 查找字符串，返回第一次出现的位置，返回-1表示未找到\nprint(s1.index('ell'))  # 返回首次出现的位置，与find方法类似，如果未找到会返回错误\nprint(s1.endswith('lo'))  # 是否以lo结尾\nprint(s1.startswith('he'))  # 是否以he开头\nprint(s1.isalnum())  # 返回是否至少有一个字符并且都是是字母或数字\nprint(s1.isalpha())  # 返回是否至少有一个字符并且都是字母\nprint(s1.isdigit())  # 返回是否至少有一个字符并且都是数字\nprint(s1.islower())  # 返回是否至少有一个字符并且都是小写字母\nprint(s1.isupper())  # 返回是否至少有一个字符并且都是大写字母\nprint(' '.join([s1, s2]))  # 合并s1, s2，已空格分割\nprint((s1 + ' ' + s2).split(' '))  # 按指定分隔符分割字符串\nprint(s1.title())  # 返回首字母大写的字符串\nprint(s1.strip()) # 去掉s1前后的空格\n```\n\n### 模板字符串\n\n```python\nname = \"Liujinlong\"\nprint(\"My name is %s\" % name)\npi = 3.14\nprint(\"Pi is %.2f\" % pi)\n\nstr1 = \"Hello\"\nstr2 = \"World\"\nprint(\"%s %s\" % (str1, str2))\n\nmsg = {\"action\": str1, \"name\": str2}\nprint(\"%(action)s %(name)s\" % msg)\nprint(\"{0} {1}\".format(str1, str2))\nprint(\"{action} {name}\".format(**msg)) # 双星号相当于解包字典\n```\n\n## Python 中的列表\n\n### 列表的定义\n\n- 列表中元素的类型是任意的\n\n```python\na = [1, 2, 3]\nb = [1, \"ljl\", [1, 2, 3], True]\nc = list()\n```\n\n### 列表的操作\n\n```python\nl1 = [1, 2, 3, 4]\nl2 = ['a', 'b', 'c']\n\nprint(l1 + l2)  # 合并\nprint(l1 * 2)  # 重复\nprint(l1[2])  # 获取\nprint(l1[2: 4])  # 切片操作\nl1.append(3)  # 添加元素\nprint(l1.count(3))  # 列表中某个元素的个数\nprint(len(l1))  # 列表长度\nprint(l1.index(3))  # 某个元素在列表中的位置，未找到返回错误\nl1.extend(l2)  # 将l2的所有元素添加到l1中\nprint(l1)\nl1.insert(11, 2)  # 在指定位置添加元素\nprint(l1)\nl1.pop()  # 删除列表末尾元素\nprint(l1)\nl1.remove('a')  # 删除指定元素\nprint(l1)\nl1.reverse()  # 逆序列表\nprint(l1)\nl1 = [3, 1, 4, 5, 8, 2]\nl1.sort()  # 列表排序\nprint(l1)\n\na = [1, 2, 3]\na.append(4)\nprint(a) # 1, 2, 3, 4\na.extend([5]) # 1, 2, 3, 4, 5\nprint(a)\na.append([6, 7]) # [1, 2, 3, 4, 5, [6, 7]]\nprint(a)\na.extend([8, 9]) # [1, 2, 3, 4, 5, [6, 7], 8, 9]\nprint(a)\n\n# extend会自动把要添加的列表逐一添加到原列表模块，append是将元素直接添加到列表末尾\n\nvalue = a.pop()  # 删除列表中最后一个元素并返回这个元素\nprint(value)\nprint(a)\na.remove(3)  # 删除列表中值为3的元素\nprint(a)\ndel(a[0:3]) # 删除a中第0到3位置上的元素\nprint(a)\n```\n\n### 元组\n\n- 列表与元组的区别\n  - 列表时可变的，元组不可变\n  - 元组可以作为字典的 key，但是列表不行\n\n```python\n(1, 2, 3, True)\n(1, 2, 3)[1]\n(1, 2, 3, 4)[0:3] # 得到一个元素\n(1, 2, 3) + (3, 3, 3) # (1, 2, 3, 3, 3, 3)\n(1, 2, 3) * 3 # (1, 2, 3, 1, 2, 3, 1, 2, 3)\ntype((1)) # int，这是因为内层括被解析成了数学运算的括号\ntype((1,)) # tuple\nmin((1, 2, 3))  # 最小值\nmax((1, 2, 3))  # 最大值\n(,) # 空元组\n```\n\n### 序列的总结\n\n- str list tuple 都属于序列\n- 每个元素都会分配一个序号\n- 都支持切片操作\n- 支持包含操作：\n\n```python\nprint('or' in 'Hello world')  # True\nprint(1 in [1, 2, 3])  # True\nprint('a' not in ('a', 'c', 12))  # False\n```\n\n- 长度：`len([1, 2, 3])`\n- 最大最小：`max([1, 2, 3]), min([1, 2, 3])`\n\n### 集合\n\n- 集合 Set 的特点\n  - 元素是无序的\n  - 元素是不重复的\n\n```python\n{1, 2, 3, 4, 5}\nlen({1, 2, 3}) # 3\n1 in {1, 2, 3} # True\n1 not in {1, 2, 3} # True\n{1, 2, 3, 4, 5} - {3, 4} # 求两个集合的差集\n{1, 2, 3, 4, 5} & {3, 4} # 求两个集合的交集\n{1, 2, 3, 4, 5} | {3, 4} # 求两个集合的并集\nset() # 空集合\n```\n\n### 字典\n\n- Key 不能重复\n- Key 必须是不可变的类型\n  - 列表是可变的，所以不能作为字典的 key\n  - int，元组，bool 都是不可变的\n\n```python\nempty = {}  # 空字典\nuser = {\"name\": \"ljl\", \"age\":12}\nprint(user[\"name\"])\nuser[\"school\"] = \"tyut\"\nuser.update({\"address\": \"shenzhen\"})\ndel(user[\"address\"])  # 删除某个key\nprint(user)\nuser.clear()  # 清空\nprint(user)\nprint(user.keys())  # 所有key\nprint(user.values())  # 所有value\nprint('address' in user)  # 是否包含某个key\n```\n\n## 变量和运算符\n\n### 变量的定义\n\n- Python 中的变量就是一个值的别名\n- 原则：变量名要有意义\n\n### 变量命名规则\n\n- 变量名的首字符不能是数字\n- 只能包含字母，数字，下划线\n- 系统的关键字不能用作变量名，非系统保留关键字，但是标准库函数的，也不要使用，例如：type\n- 变量区分大小写\n\n### 值类型和引用类型\n\n- 值类型：int, str, tuple\n- 引用类型：list, set, dict\n- `id()`: 显示变量内存地址\n\n### list 与 tuple\n\n- list 是可改变的\n- tuple 是不可改变的\n- 使用原则：能用元组尽量用元组，因为元组不可改变，更为安全\n\n```python\na = [1, 2, 3]\na[0] = 11 # OK\nb = (1, 2, 3)\nb[0] = 11 # error\n```\n\n### 运算符号\n\n- 数学运算符：`+-*/`\n- 整除：`//`\n- 余数：`%`\n- 乘方：`**` 例如，`2**2 = 4`\n- 赋值运算符：`=, +=, -=, *=, /=, %=, **=, //=`\n- 比较运算符：`==, !=, >=, >, <=, <`\n  - 字符串，bool 都可以比较，字符串转为 ascii 码进行比较，bool 则是 True 转为 1，False 转为 0\n  - 比较返回一个 bool 值\n  - 列表，元组都可以比较，比较的规则是一个一个元素进行比较，直到比较出结果\n- 逻辑运算符：`and, or, not`\n  - 非 Bool 类型也可以进行逻辑运算，规则是将非 Bool 类型先转为 Bool 类型再进行计算\n  - int, float 转为 bool，0 为 False，非 0 为 True\n  - 字符串转为 bool，空字符串为 False，非空字符串为 True\n  - 列表转为 bool，空列表为 False，非空列表为 True\n  - 元组，set，dict 与列表一样\n  - 举例：\n    - `2 and 1 # 1`\n    - `1 and 2 # 2`\n    - `1 or 2 # 1`\n    - `0 or 1 # 1`\n    - 返回的值符合就近原则，例如`2 and 1`，更具左边的元素 2 无法判断出结果，读取 1 后，可以判断出结构，所有返回 1，`1 or 2`根据左边的元素 1 就直接可以判断出表达式的值，所以直接返回 1\n- 成员运算符：`in, not in`\n  - 一个元素是否在另外的一组元素中\n  - 返回 bool 类型\n  - 可以作用于：列表，字符串，元组，set，dict\n  - 字典判断的是 key\n- 身份运算符：is, not is\n  - 比较的是两个变量的内存地址是否相等\n  - 对象的三个特征：值，类型，身份\n  - 判断类型 type(a): `type(a) == int`\n  - 推荐使用 isinstance()方法进行类型判断，例如：`isinstance(a, int), isinstance(a, (int, float, str))`\n- 位运算符：&, |, ^, ~, <<, >>\n\n特殊的地方：\n\n- Python 没有自增，自减操作\n\n## 分支，循环，条件，枚举\n\n### 什么是表达式\n\n- 表达式是运算符和操作数所构成的序列\n\n### 表达式优先级\n\n- and 的优先级大于 or，not > and > or\n- 解析表达式的顺序：\n  - 相同优先级从左向右，左结合\n  - 使用括号改变优先级\n  - 赋值运算符是右结合\n\n### 流程控制语句\n\n- if, if-else\n- pass 空语句\n- while 语句， while-else（循环退出时，执行 else）\n- for: 遍历集合，序列，字典，for-else(遍历完成，执行 else)\n- break：跳出循环，从 break 退出循环，不会执行 else 语句\n- continue: 跳过本次循环\n- range 函数，第一个参数为起始位置，第二个参数为序列元素个数，第三个参数为步长\n\n```python\na = 1\nwhile a < 10:\n    print(a)\n    a += 1\nelse:\n    print('Over')\n\nfor x in range(0, 10):\n    print(x)\n\nfor i in range(0, 10):\n    print(i)\n    if i == 8:\n        break\nelse:\n    print('Over')  # Over不会打印，因为循环break了\n\nnum = 10\nif 5 < num < 20:  # 可以使用这种判断条件\n  print(\"hello\")\n```\n\n### Comprehension\n\n```python\n# List Comprehension\nnumbers = [i for i in range(0, 10)]  # [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]\nprint(numbers)\nnumbers = [i for i in range(0, 10) if i % 2 == 0]  # [0, 2, 4, 6, 8]\nprint(numbers)\nstrings = [['1', '2', '3'], ['4', '5', '6'], ['7', '8', '9']]\nfaltten = [int(i) for item in strings for i in item]\nprint(faltten) # [1, 2, 3, 4, 5, 6, 7, 8, 9]\nxSamples = [2, 5, 8]\nySamples = [2, 6, 8]\npoints = [(x, y) for x in xSamples for y in ySamples if x != y]\nprint(points) # [(2, 6), (2, 8), (5, 2), (5, 6), (5, 8), (8, 2), (8, 6)]\n\n# Set Comprehension\nnumbers = {i for i in range(0, 10)}\nprint(numbers)  # {0, 1, 2, 3, 4, 5, 6, 7, 8, 9}\n\n# Dictionary Comprehension\ndicts = {i: str(i) for i in range(0, 10)}\nprint(dicts)  # {0: '0', 1: '1', 2: '2', 3: '3', 4: '4', 5: '5', 6: '6', 7: '7', 8: '8', 9: '9'}\n```\n\n## 包，模块，类，函数与变量\n\n### 包\n\n- 一个文件夹就是一个包，包名就是文件名\n- 子包：文件夹里还有一个文件夹\n- 文件夹里必须有一个`__init__.py`文件\n\n### 模块\n\n- 一个文件就是一个模块，模块名就是文件名\n- 不同包的相同模块在引用是使用：`包名.模块名`\n- `__init__.py`文件也是一个模块\n\n### 导入另外一个模块\n\n导入一个模块有两种方法，import 和 from-import\n\n#### import 导入\n\n- 语法：`import package1`\n- import 导入的是一个模块，使用模块里的变量名时需要带上模块名，例如`package1.a`\n- 可以使用 as 关键字给模块起一个别名\n\n```python\nimport test\nprint(test.a)\n\nimport package.modual as p1\nprint(p1.a)\n```\n\n#### from-import 导入\n\n- 语法：`from module import a`\n- from-input 可以直接导入变量，例如`from package.module import a`\n- from-input 可以导入模块`from package import module`\n- 使用*引入所有变量：`from test import *`\n- 指定使用\\*时模块可导出的变量：使用内置变量`__all__`\n- 引入多个变量：`from test import a, b, c`\n\n```python\nfrom test import a\nprint(a)\n\nfrom test import *\nprint(a)\nprint(b)\nprint(c)\n\n__all__ = ['a', 'c'] # 指定使用*导入是，只导入a和c两个变量\na = 2\nb = 3\nc = 4\n\nfrom test import *\nprint(a)\nprint(c)\nprint(b) # ERROR\n\nfrom test import b\nprint(b) # OK\n\n\n# 导入多个变量换行\nfrom test import a, b, c, d,\\\ne, f, g\nfrom test import (a, b, c, d,\ne, f, g)\n```\n\n### `__input__.py`文件\n\n- 导入包或者包内的某个模块时，`__init__.py`会被自动执行，可以做一些初始化的工作\n- `__init__.py` 的应用场景：\n  - 决定哪些模块可以被导出\n  - 批量导入某些模块，在使用包是不需要再次导入\n  - 做一些包的初始化工作\n\n```python\n# __init__.py 包名：t\n__all__ = ['module1', 'module3'] # 只有module1和module2两个模块可以被导出\n\n# 批量导入\nimport sys\nimport datetime\nimport io\n\n# other.py\nimport t\nprint(t.sys.path)\n```\n\n### 包和模块的几个常见问题\n\n- 包和模块是不会重复导入的\n- 避免循环导入，即 A 模块导入 B 模块，B 模块又导入 A 模块，这样编译器会报错\n- 导入模块时就会执行模块里的代码，但只会执行一次\n\n### 模块里的变量\n\n可以使用 dir()可以打印出模块里的所有变量，`dic(module)`打印模块中所有的变量\n\n- `__name__`: 模块的完整名称，包括包名`package.module`\n- `__package__`: 模块所属的包名\n- `__file__`: 模块文件的完整路径\n- `__doc__`: 模块的注释\n\n```python\n# module1\n'''\nThis is doc\n'''\nprint(__name__)\nprint(__file__)\nprint(__package__)\nprint(__doc__)\n\n# 结果\n#package.module\n#/Users/liujinlong/Documents/Study/Python/package/module.py\n#package\n#\n#This is doc\n#\n```\n\n如果一个模块被当成应用程序执行的入口(直接通过`pyton xxx.py`执行)，则上面的几个变量就会变。\n\n- `__name__`变为`__main__`\n- `__package__`为空\n- `__file__`为是执行路径与模块文件名的相对路径，与执行路径有关\n\n```python\nprint(\"__name__ :\" + (__name__ or \"None\"))\nprint(\"__package__:\" + (__package__ or \"None\"))\nprint('__doc__:' + __doc__)\nprint('__file__: ' + __file__)\n\n# 结果：\n#__name__ :__main__\n#__package__:None\n#__doc__:\n#this is doc\n#\n#__file__: test2.py\n```\n\n### `__name__`的应用\n\n```python\nif __name__ == '__main__':\n  pass\n```\n\n上面的语句是标明的 Python 文件既可以作为模块，也可以作为 app 的入口文件\n\n### 相对导入和绝对导入\n\n- 顶级包和入口文件有关，入口文件所在的文件夹并不是顶级包\n- 绝对导入：从顶级包开始导入 `import package1.package2.module`或`from package1.package2 import module1`\n- 相对导入：`from .m3 import *`，相对导入只能用于`from-import`\n  - 入口文件不能用相对导入，因为`__main__`这个模块是不存在的，除非使用`python -m`\n  - .当前文件夹\n  - ..上一层文件夹\n  - ...上上层文件夹\n- 注意事项：与入口文件同级目录下不要再有其他模块\n\n示例，如下图目录结构：\n\n![2](http://blog.shicishuzhai.com/fb3913861d028acf0475d26ce685031e.png)\n\n要在`main.py`中引入其他模块，不能使用相对导入，只能使用绝对导入：\n\n```python\n# main.py\nimport package1.module1_1\nimport package1.package1_1.module1_1_1 as m1_1_1\nfrom package2.package2_1 import module2_1_1\n\nm1_1_1.test() # test是定义在module1_1_1中的一个方法\n```\n\n在`module1_1_2.py`中导入其他模块可以使用相对导入\n\n```python\nfrom . import module1_1_1\nfrom ..module1_1 import test1_1\nfrom ..package1_2 import module1_2_1\nimport package2.package2_1.module2_1_1 as m211  # 这里只能用绝对导入\n\ntest1_1()  # test1_1是module1_1.py里的一个方法\nmodule1_2_1.test1_2_1()  # test1_2_1是module1_2_1.py里的一个方法\nm211.test2_1_1()  # test2_1_1是module2_1_1.py里的一个方法\n```\n\n上面要注意的一点是，`package1`中的模块引用`package2`中的模块时，只能用绝对导入，因为`package1`和`package2`都是和入口文件`main.py`同级的\n\n未完待续！\n","source":"_posts/2018-09-01-Python学习笔记-1.md","raw":"---\ntitle: Python学习笔记(1)\ncategories: Python\ntags:\n  - Python\ndate: 2018-09-01 08:26:31\n---\n\n## 数据类型\n\n### 除，整除\n\n与其他语言不通，`/`是除法，得到的 float 类型，要得到整型需要用`//`\n\n```python\ntype(2/2) # float\ntype(2//2) # int\n1//2 # 0\n1/2 # 0.5\n```\n\n### 二进制，八进制，十六进制\n\n```python\n0b10 # 2进制\n0o10 # 8进制\n0x10 # 16进制\n# 将一个数转为二进制\nbin(12)\n# 将一个数转为10进制\nint(0x12)\n# 将一个数转为16进制\nhex(12131)\n# 将一个数转为8进制\noct(0x1231)\n```\n\n### 布尔类型\n\n布尔类型有两个值，`True`与`False`\n\n- 对于整数来说，非 0 可以转为`True`，0 可以转为`False`\n- 对于字符串来说，空字符串可以转为`False`，其他字符串可以转为`True`\n- 对于列表和元组等序列来说，空序列可以转为`False`，序列中有元素可以转为`True`\n- 对集合和字典来说，空字典，空集合可以转为`False`，字典或序列中有元素可以转为`True`\n- None 也可以转为`False`\n\n```python\nnum1 = 1\nif num1:\n    print('YES')  # YES\nelse:\n    print('NO')\n\nnum2 = 0\nif num2:\n    print('YES')\nelse:\n    print('NO')  # NO\n\nlist1 = []\nlist2 = [1, 2, 3]\nif list1:\n    print('YES')\nelse:\n    print('NO')  # NO\n\nif list2:\n    print('YES')  # YES\nelse:\n    print('NO')\n\ndict1 = {}\ndict2 = {1: 'A', 2: 'B'}\nif dict1:\n    print('YES')\nelse:\n    print('NO')  # NO\n\nif dict2:\n    print('YES')  # YES\nelse:\n    print('NO')\n```\n\n### 单引号和双引号\n\n- 单引号：单引号可以包含双引号，例如：`'My name is \"ljl\"'`\n- 双引号：双引号也可以包含单引号，例如：`\"Let's go\"`\n\n### 多行文本\n\n多行文本可以用三个双引号表示，也可以用三个单引号表示，例如：\n\n```python\n'''\nHello!\nMy name is Liuijinlong.\nWhat is your name?\n'''\n\n\"\"\"\nHello!\nMy name is Liuijinlong.\nWhat is your name?\n\"\"\"\n```\n\n- 要显示字符串的格式要使用`print`函数\n- idle 会把字符串中的格式变为转义字符，如下：\n\n![1](http://blog.shicishuzhai.com/094e3ce9743b9dafadb426041996058b.png)\n\n### 原始字符\n\n在字符串前加一个 r，字符串中的转义字符不会被解析\n\n```python\nprint(r'aaa \\n aaa') # aaa \\n aaa\n```\n\n### 字符串的操作\n\n```python\ns1 = \"Hello\"\ns2 = \"World\"\n\n# 拼接\ns = s1 + s2\nprint(s)  # HelloWorld\n\n# 截取，切片操作\nprint(s[2])  # l\nprint(s[2: 5])  # llo\nprint(s[2: -3])  # lloWo\n\nprint(s1 * 2)  # 重复字符串：HelloHello\nprint(len(s1))  # 字符串长度：5\nprint(s1.count('l'))  # l在字符串中出现的次数\nprint(s1.find('ell'))  # 查找字符串，返回第一次出现的位置，返回-1表示未找到\nprint(s1.index('ell'))  # 返回首次出现的位置，与find方法类似，如果未找到会返回错误\nprint(s1.endswith('lo'))  # 是否以lo结尾\nprint(s1.startswith('he'))  # 是否以he开头\nprint(s1.isalnum())  # 返回是否至少有一个字符并且都是是字母或数字\nprint(s1.isalpha())  # 返回是否至少有一个字符并且都是字母\nprint(s1.isdigit())  # 返回是否至少有一个字符并且都是数字\nprint(s1.islower())  # 返回是否至少有一个字符并且都是小写字母\nprint(s1.isupper())  # 返回是否至少有一个字符并且都是大写字母\nprint(' '.join([s1, s2]))  # 合并s1, s2，已空格分割\nprint((s1 + ' ' + s2).split(' '))  # 按指定分隔符分割字符串\nprint(s1.title())  # 返回首字母大写的字符串\nprint(s1.strip()) # 去掉s1前后的空格\n```\n\n### 模板字符串\n\n```python\nname = \"Liujinlong\"\nprint(\"My name is %s\" % name)\npi = 3.14\nprint(\"Pi is %.2f\" % pi)\n\nstr1 = \"Hello\"\nstr2 = \"World\"\nprint(\"%s %s\" % (str1, str2))\n\nmsg = {\"action\": str1, \"name\": str2}\nprint(\"%(action)s %(name)s\" % msg)\nprint(\"{0} {1}\".format(str1, str2))\nprint(\"{action} {name}\".format(**msg)) # 双星号相当于解包字典\n```\n\n## Python 中的列表\n\n### 列表的定义\n\n- 列表中元素的类型是任意的\n\n```python\na = [1, 2, 3]\nb = [1, \"ljl\", [1, 2, 3], True]\nc = list()\n```\n\n### 列表的操作\n\n```python\nl1 = [1, 2, 3, 4]\nl2 = ['a', 'b', 'c']\n\nprint(l1 + l2)  # 合并\nprint(l1 * 2)  # 重复\nprint(l1[2])  # 获取\nprint(l1[2: 4])  # 切片操作\nl1.append(3)  # 添加元素\nprint(l1.count(3))  # 列表中某个元素的个数\nprint(len(l1))  # 列表长度\nprint(l1.index(3))  # 某个元素在列表中的位置，未找到返回错误\nl1.extend(l2)  # 将l2的所有元素添加到l1中\nprint(l1)\nl1.insert(11, 2)  # 在指定位置添加元素\nprint(l1)\nl1.pop()  # 删除列表末尾元素\nprint(l1)\nl1.remove('a')  # 删除指定元素\nprint(l1)\nl1.reverse()  # 逆序列表\nprint(l1)\nl1 = [3, 1, 4, 5, 8, 2]\nl1.sort()  # 列表排序\nprint(l1)\n\na = [1, 2, 3]\na.append(4)\nprint(a) # 1, 2, 3, 4\na.extend([5]) # 1, 2, 3, 4, 5\nprint(a)\na.append([6, 7]) # [1, 2, 3, 4, 5, [6, 7]]\nprint(a)\na.extend([8, 9]) # [1, 2, 3, 4, 5, [6, 7], 8, 9]\nprint(a)\n\n# extend会自动把要添加的列表逐一添加到原列表模块，append是将元素直接添加到列表末尾\n\nvalue = a.pop()  # 删除列表中最后一个元素并返回这个元素\nprint(value)\nprint(a)\na.remove(3)  # 删除列表中值为3的元素\nprint(a)\ndel(a[0:3]) # 删除a中第0到3位置上的元素\nprint(a)\n```\n\n### 元组\n\n- 列表与元组的区别\n  - 列表时可变的，元组不可变\n  - 元组可以作为字典的 key，但是列表不行\n\n```python\n(1, 2, 3, True)\n(1, 2, 3)[1]\n(1, 2, 3, 4)[0:3] # 得到一个元素\n(1, 2, 3) + (3, 3, 3) # (1, 2, 3, 3, 3, 3)\n(1, 2, 3) * 3 # (1, 2, 3, 1, 2, 3, 1, 2, 3)\ntype((1)) # int，这是因为内层括被解析成了数学运算的括号\ntype((1,)) # tuple\nmin((1, 2, 3))  # 最小值\nmax((1, 2, 3))  # 最大值\n(,) # 空元组\n```\n\n### 序列的总结\n\n- str list tuple 都属于序列\n- 每个元素都会分配一个序号\n- 都支持切片操作\n- 支持包含操作：\n\n```python\nprint('or' in 'Hello world')  # True\nprint(1 in [1, 2, 3])  # True\nprint('a' not in ('a', 'c', 12))  # False\n```\n\n- 长度：`len([1, 2, 3])`\n- 最大最小：`max([1, 2, 3]), min([1, 2, 3])`\n\n### 集合\n\n- 集合 Set 的特点\n  - 元素是无序的\n  - 元素是不重复的\n\n```python\n{1, 2, 3, 4, 5}\nlen({1, 2, 3}) # 3\n1 in {1, 2, 3} # True\n1 not in {1, 2, 3} # True\n{1, 2, 3, 4, 5} - {3, 4} # 求两个集合的差集\n{1, 2, 3, 4, 5} & {3, 4} # 求两个集合的交集\n{1, 2, 3, 4, 5} | {3, 4} # 求两个集合的并集\nset() # 空集合\n```\n\n### 字典\n\n- Key 不能重复\n- Key 必须是不可变的类型\n  - 列表是可变的，所以不能作为字典的 key\n  - int，元组，bool 都是不可变的\n\n```python\nempty = {}  # 空字典\nuser = {\"name\": \"ljl\", \"age\":12}\nprint(user[\"name\"])\nuser[\"school\"] = \"tyut\"\nuser.update({\"address\": \"shenzhen\"})\ndel(user[\"address\"])  # 删除某个key\nprint(user)\nuser.clear()  # 清空\nprint(user)\nprint(user.keys())  # 所有key\nprint(user.values())  # 所有value\nprint('address' in user)  # 是否包含某个key\n```\n\n## 变量和运算符\n\n### 变量的定义\n\n- Python 中的变量就是一个值的别名\n- 原则：变量名要有意义\n\n### 变量命名规则\n\n- 变量名的首字符不能是数字\n- 只能包含字母，数字，下划线\n- 系统的关键字不能用作变量名，非系统保留关键字，但是标准库函数的，也不要使用，例如：type\n- 变量区分大小写\n\n### 值类型和引用类型\n\n- 值类型：int, str, tuple\n- 引用类型：list, set, dict\n- `id()`: 显示变量内存地址\n\n### list 与 tuple\n\n- list 是可改变的\n- tuple 是不可改变的\n- 使用原则：能用元组尽量用元组，因为元组不可改变，更为安全\n\n```python\na = [1, 2, 3]\na[0] = 11 # OK\nb = (1, 2, 3)\nb[0] = 11 # error\n```\n\n### 运算符号\n\n- 数学运算符：`+-*/`\n- 整除：`//`\n- 余数：`%`\n- 乘方：`**` 例如，`2**2 = 4`\n- 赋值运算符：`=, +=, -=, *=, /=, %=, **=, //=`\n- 比较运算符：`==, !=, >=, >, <=, <`\n  - 字符串，bool 都可以比较，字符串转为 ascii 码进行比较，bool 则是 True 转为 1，False 转为 0\n  - 比较返回一个 bool 值\n  - 列表，元组都可以比较，比较的规则是一个一个元素进行比较，直到比较出结果\n- 逻辑运算符：`and, or, not`\n  - 非 Bool 类型也可以进行逻辑运算，规则是将非 Bool 类型先转为 Bool 类型再进行计算\n  - int, float 转为 bool，0 为 False，非 0 为 True\n  - 字符串转为 bool，空字符串为 False，非空字符串为 True\n  - 列表转为 bool，空列表为 False，非空列表为 True\n  - 元组，set，dict 与列表一样\n  - 举例：\n    - `2 and 1 # 1`\n    - `1 and 2 # 2`\n    - `1 or 2 # 1`\n    - `0 or 1 # 1`\n    - 返回的值符合就近原则，例如`2 and 1`，更具左边的元素 2 无法判断出结果，读取 1 后，可以判断出结构，所有返回 1，`1 or 2`根据左边的元素 1 就直接可以判断出表达式的值，所以直接返回 1\n- 成员运算符：`in, not in`\n  - 一个元素是否在另外的一组元素中\n  - 返回 bool 类型\n  - 可以作用于：列表，字符串，元组，set，dict\n  - 字典判断的是 key\n- 身份运算符：is, not is\n  - 比较的是两个变量的内存地址是否相等\n  - 对象的三个特征：值，类型，身份\n  - 判断类型 type(a): `type(a) == int`\n  - 推荐使用 isinstance()方法进行类型判断，例如：`isinstance(a, int), isinstance(a, (int, float, str))`\n- 位运算符：&, |, ^, ~, <<, >>\n\n特殊的地方：\n\n- Python 没有自增，自减操作\n\n## 分支，循环，条件，枚举\n\n### 什么是表达式\n\n- 表达式是运算符和操作数所构成的序列\n\n### 表达式优先级\n\n- and 的优先级大于 or，not > and > or\n- 解析表达式的顺序：\n  - 相同优先级从左向右，左结合\n  - 使用括号改变优先级\n  - 赋值运算符是右结合\n\n### 流程控制语句\n\n- if, if-else\n- pass 空语句\n- while 语句， while-else（循环退出时，执行 else）\n- for: 遍历集合，序列，字典，for-else(遍历完成，执行 else)\n- break：跳出循环，从 break 退出循环，不会执行 else 语句\n- continue: 跳过本次循环\n- range 函数，第一个参数为起始位置，第二个参数为序列元素个数，第三个参数为步长\n\n```python\na = 1\nwhile a < 10:\n    print(a)\n    a += 1\nelse:\n    print('Over')\n\nfor x in range(0, 10):\n    print(x)\n\nfor i in range(0, 10):\n    print(i)\n    if i == 8:\n        break\nelse:\n    print('Over')  # Over不会打印，因为循环break了\n\nnum = 10\nif 5 < num < 20:  # 可以使用这种判断条件\n  print(\"hello\")\n```\n\n### Comprehension\n\n```python\n# List Comprehension\nnumbers = [i for i in range(0, 10)]  # [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]\nprint(numbers)\nnumbers = [i for i in range(0, 10) if i % 2 == 0]  # [0, 2, 4, 6, 8]\nprint(numbers)\nstrings = [['1', '2', '3'], ['4', '5', '6'], ['7', '8', '9']]\nfaltten = [int(i) for item in strings for i in item]\nprint(faltten) # [1, 2, 3, 4, 5, 6, 7, 8, 9]\nxSamples = [2, 5, 8]\nySamples = [2, 6, 8]\npoints = [(x, y) for x in xSamples for y in ySamples if x != y]\nprint(points) # [(2, 6), (2, 8), (5, 2), (5, 6), (5, 8), (8, 2), (8, 6)]\n\n# Set Comprehension\nnumbers = {i for i in range(0, 10)}\nprint(numbers)  # {0, 1, 2, 3, 4, 5, 6, 7, 8, 9}\n\n# Dictionary Comprehension\ndicts = {i: str(i) for i in range(0, 10)}\nprint(dicts)  # {0: '0', 1: '1', 2: '2', 3: '3', 4: '4', 5: '5', 6: '6', 7: '7', 8: '8', 9: '9'}\n```\n\n## 包，模块，类，函数与变量\n\n### 包\n\n- 一个文件夹就是一个包，包名就是文件名\n- 子包：文件夹里还有一个文件夹\n- 文件夹里必须有一个`__init__.py`文件\n\n### 模块\n\n- 一个文件就是一个模块，模块名就是文件名\n- 不同包的相同模块在引用是使用：`包名.模块名`\n- `__init__.py`文件也是一个模块\n\n### 导入另外一个模块\n\n导入一个模块有两种方法，import 和 from-import\n\n#### import 导入\n\n- 语法：`import package1`\n- import 导入的是一个模块，使用模块里的变量名时需要带上模块名，例如`package1.a`\n- 可以使用 as 关键字给模块起一个别名\n\n```python\nimport test\nprint(test.a)\n\nimport package.modual as p1\nprint(p1.a)\n```\n\n#### from-import 导入\n\n- 语法：`from module import a`\n- from-input 可以直接导入变量，例如`from package.module import a`\n- from-input 可以导入模块`from package import module`\n- 使用*引入所有变量：`from test import *`\n- 指定使用\\*时模块可导出的变量：使用内置变量`__all__`\n- 引入多个变量：`from test import a, b, c`\n\n```python\nfrom test import a\nprint(a)\n\nfrom test import *\nprint(a)\nprint(b)\nprint(c)\n\n__all__ = ['a', 'c'] # 指定使用*导入是，只导入a和c两个变量\na = 2\nb = 3\nc = 4\n\nfrom test import *\nprint(a)\nprint(c)\nprint(b) # ERROR\n\nfrom test import b\nprint(b) # OK\n\n\n# 导入多个变量换行\nfrom test import a, b, c, d,\\\ne, f, g\nfrom test import (a, b, c, d,\ne, f, g)\n```\n\n### `__input__.py`文件\n\n- 导入包或者包内的某个模块时，`__init__.py`会被自动执行，可以做一些初始化的工作\n- `__init__.py` 的应用场景：\n  - 决定哪些模块可以被导出\n  - 批量导入某些模块，在使用包是不需要再次导入\n  - 做一些包的初始化工作\n\n```python\n# __init__.py 包名：t\n__all__ = ['module1', 'module3'] # 只有module1和module2两个模块可以被导出\n\n# 批量导入\nimport sys\nimport datetime\nimport io\n\n# other.py\nimport t\nprint(t.sys.path)\n```\n\n### 包和模块的几个常见问题\n\n- 包和模块是不会重复导入的\n- 避免循环导入，即 A 模块导入 B 模块，B 模块又导入 A 模块，这样编译器会报错\n- 导入模块时就会执行模块里的代码，但只会执行一次\n\n### 模块里的变量\n\n可以使用 dir()可以打印出模块里的所有变量，`dic(module)`打印模块中所有的变量\n\n- `__name__`: 模块的完整名称，包括包名`package.module`\n- `__package__`: 模块所属的包名\n- `__file__`: 模块文件的完整路径\n- `__doc__`: 模块的注释\n\n```python\n# module1\n'''\nThis is doc\n'''\nprint(__name__)\nprint(__file__)\nprint(__package__)\nprint(__doc__)\n\n# 结果\n#package.module\n#/Users/liujinlong/Documents/Study/Python/package/module.py\n#package\n#\n#This is doc\n#\n```\n\n如果一个模块被当成应用程序执行的入口(直接通过`pyton xxx.py`执行)，则上面的几个变量就会变。\n\n- `__name__`变为`__main__`\n- `__package__`为空\n- `__file__`为是执行路径与模块文件名的相对路径，与执行路径有关\n\n```python\nprint(\"__name__ :\" + (__name__ or \"None\"))\nprint(\"__package__:\" + (__package__ or \"None\"))\nprint('__doc__:' + __doc__)\nprint('__file__: ' + __file__)\n\n# 结果：\n#__name__ :__main__\n#__package__:None\n#__doc__:\n#this is doc\n#\n#__file__: test2.py\n```\n\n### `__name__`的应用\n\n```python\nif __name__ == '__main__':\n  pass\n```\n\n上面的语句是标明的 Python 文件既可以作为模块，也可以作为 app 的入口文件\n\n### 相对导入和绝对导入\n\n- 顶级包和入口文件有关，入口文件所在的文件夹并不是顶级包\n- 绝对导入：从顶级包开始导入 `import package1.package2.module`或`from package1.package2 import module1`\n- 相对导入：`from .m3 import *`，相对导入只能用于`from-import`\n  - 入口文件不能用相对导入，因为`__main__`这个模块是不存在的，除非使用`python -m`\n  - .当前文件夹\n  - ..上一层文件夹\n  - ...上上层文件夹\n- 注意事项：与入口文件同级目录下不要再有其他模块\n\n示例，如下图目录结构：\n\n![2](http://blog.shicishuzhai.com/fb3913861d028acf0475d26ce685031e.png)\n\n要在`main.py`中引入其他模块，不能使用相对导入，只能使用绝对导入：\n\n```python\n# main.py\nimport package1.module1_1\nimport package1.package1_1.module1_1_1 as m1_1_1\nfrom package2.package2_1 import module2_1_1\n\nm1_1_1.test() # test是定义在module1_1_1中的一个方法\n```\n\n在`module1_1_2.py`中导入其他模块可以使用相对导入\n\n```python\nfrom . import module1_1_1\nfrom ..module1_1 import test1_1\nfrom ..package1_2 import module1_2_1\nimport package2.package2_1.module2_1_1 as m211  # 这里只能用绝对导入\n\ntest1_1()  # test1_1是module1_1.py里的一个方法\nmodule1_2_1.test1_2_1()  # test1_2_1是module1_2_1.py里的一个方法\nm211.test2_1_1()  # test2_1_1是module2_1_1.py里的一个方法\n```\n\n上面要注意的一点是，`package1`中的模块引用`package2`中的模块时，只能用绝对导入，因为`package1`和`package2`都是和入口文件`main.py`同级的\n\n未完待续！\n","slug":"Python学习笔记-1","published":1,"updated":"2019-01-13T03:53:57.404Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjutyfmjr0071c4c9ee0yf0oq","content":"<h2 id=\"数据类型\"><a href=\"#数据类型\" class=\"headerlink\" title=\"数据类型\"></a>数据类型</h2><h3 id=\"除，整除\"><a href=\"#除，整除\" class=\"headerlink\" title=\"除，整除\"></a>除，整除</h3><p>与其他语言不通，<code>/</code>是除法，得到的 float 类型，要得到整型需要用<code>//</code></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">type(<span class=\"number\">2</span>/<span class=\"number\">2</span>) <span class=\"comment\"># float</span></span><br><span class=\"line\">type(<span class=\"number\">2</span>//<span class=\"number\">2</span>) <span class=\"comment\"># int</span></span><br><span class=\"line\"><span class=\"number\">1</span>//<span class=\"number\">2</span> <span class=\"comment\"># 0</span></span><br><span class=\"line\"><span class=\"number\">1</span>/<span class=\"number\">2</span> <span class=\"comment\"># 0.5</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"二进制，八进制，十六进制\"><a href=\"#二进制，八进制，十六进制\" class=\"headerlink\" title=\"二进制，八进制，十六进制\"></a>二进制，八进制，十六进制</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">0b10</span> <span class=\"comment\"># 2进制</span></span><br><span class=\"line\"><span class=\"number\">0o10</span> <span class=\"comment\"># 8进制</span></span><br><span class=\"line\"><span class=\"number\">0x10</span> <span class=\"comment\"># 16进制</span></span><br><span class=\"line\"><span class=\"comment\"># 将一个数转为二进制</span></span><br><span class=\"line\">bin(<span class=\"number\">12</span>)</span><br><span class=\"line\"><span class=\"comment\"># 将一个数转为10进制</span></span><br><span class=\"line\">int(<span class=\"number\">0x12</span>)</span><br><span class=\"line\"><span class=\"comment\"># 将一个数转为16进制</span></span><br><span class=\"line\">hex(<span class=\"number\">12131</span>)</span><br><span class=\"line\"><span class=\"comment\"># 将一个数转为8进制</span></span><br><span class=\"line\">oct(<span class=\"number\">0x1231</span>)</span><br></pre></td></tr></table></figure>\n<h3 id=\"布尔类型\"><a href=\"#布尔类型\" class=\"headerlink\" title=\"布尔类型\"></a>布尔类型</h3><p>布尔类型有两个值，<code>True</code>与<code>False</code></p>\n<ul>\n<li>对于整数来说，非 0 可以转为<code>True</code>，0 可以转为<code>False</code></li>\n<li>对于字符串来说，空字符串可以转为<code>False</code>，其他字符串可以转为<code>True</code></li>\n<li>对于列表和元组等序列来说，空序列可以转为<code>False</code>，序列中有元素可以转为<code>True</code></li>\n<li>对集合和字典来说，空字典，空集合可以转为<code>False</code>，字典或序列中有元素可以转为<code>True</code></li>\n<li>None 也可以转为<code>False</code></li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">num1 = <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> num1:</span><br><span class=\"line\">    print(<span class=\"string\">'YES'</span>)  <span class=\"comment\"># YES</span></span><br><span class=\"line\"><span class=\"keyword\">else</span>:</span><br><span class=\"line\">    print(<span class=\"string\">'NO'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">num2 = <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> num2:</span><br><span class=\"line\">    print(<span class=\"string\">'YES'</span>)</span><br><span class=\"line\"><span class=\"keyword\">else</span>:</span><br><span class=\"line\">    print(<span class=\"string\">'NO'</span>)  <span class=\"comment\"># NO</span></span><br><span class=\"line\"></span><br><span class=\"line\">list1 = []</span><br><span class=\"line\">list2 = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>]</span><br><span class=\"line\"><span class=\"keyword\">if</span> list1:</span><br><span class=\"line\">    print(<span class=\"string\">'YES'</span>)</span><br><span class=\"line\"><span class=\"keyword\">else</span>:</span><br><span class=\"line\">    print(<span class=\"string\">'NO'</span>)  <span class=\"comment\"># NO</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> list2:</span><br><span class=\"line\">    print(<span class=\"string\">'YES'</span>)  <span class=\"comment\"># YES</span></span><br><span class=\"line\"><span class=\"keyword\">else</span>:</span><br><span class=\"line\">    print(<span class=\"string\">'NO'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">dict1 = &#123;&#125;</span><br><span class=\"line\">dict2 = &#123;<span class=\"number\">1</span>: <span class=\"string\">'A'</span>, <span class=\"number\">2</span>: <span class=\"string\">'B'</span>&#125;</span><br><span class=\"line\"><span class=\"keyword\">if</span> dict1:</span><br><span class=\"line\">    print(<span class=\"string\">'YES'</span>)</span><br><span class=\"line\"><span class=\"keyword\">else</span>:</span><br><span class=\"line\">    print(<span class=\"string\">'NO'</span>)  <span class=\"comment\"># NO</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> dict2:</span><br><span class=\"line\">    print(<span class=\"string\">'YES'</span>)  <span class=\"comment\"># YES</span></span><br><span class=\"line\"><span class=\"keyword\">else</span>:</span><br><span class=\"line\">    print(<span class=\"string\">'NO'</span>)</span><br></pre></td></tr></table></figure>\n<h3 id=\"单引号和双引号\"><a href=\"#单引号和双引号\" class=\"headerlink\" title=\"单引号和双引号\"></a>单引号和双引号</h3><ul>\n<li>单引号：单引号可以包含双引号，例如：<code>&#39;My name is &quot;ljl&quot;&#39;</code></li>\n<li>双引号：双引号也可以包含单引号，例如：<code>&quot;Let&#39;s go&quot;</code></li>\n</ul>\n<h3 id=\"多行文本\"><a href=\"#多行文本\" class=\"headerlink\" title=\"多行文本\"></a>多行文本</h3><p>多行文本可以用三个双引号表示，也可以用三个单引号表示，例如：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">'''</span></span><br><span class=\"line\"><span class=\"string\">Hello!</span></span><br><span class=\"line\"><span class=\"string\">My name is Liuijinlong.</span></span><br><span class=\"line\"><span class=\"string\">What is your name?</span></span><br><span class=\"line\"><span class=\"string\">'''</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">\"\"\"</span></span><br><span class=\"line\"><span class=\"string\">Hello!</span></span><br><span class=\"line\"><span class=\"string\">My name is Liuijinlong.</span></span><br><span class=\"line\"><span class=\"string\">What is your name?</span></span><br><span class=\"line\"><span class=\"string\">\"\"\"</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>要显示字符串的格式要使用<code>print</code>函数</li>\n<li>idle 会把字符串中的格式变为转义字符，如下：</li>\n</ul>\n<p><img src=\"http://blog.shicishuzhai.com/094e3ce9743b9dafadb426041996058b.png\" alt=\"1\"></p>\n<h3 id=\"原始字符\"><a href=\"#原始字符\" class=\"headerlink\" title=\"原始字符\"></a>原始字符</h3><p>在字符串前加一个 r，字符串中的转义字符不会被解析</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">print(<span class=\"string\">r'aaa \\n aaa'</span>) <span class=\"comment\"># aaa \\n aaa</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"字符串的操作\"><a href=\"#字符串的操作\" class=\"headerlink\" title=\"字符串的操作\"></a>字符串的操作</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">s1 = <span class=\"string\">\"Hello\"</span></span><br><span class=\"line\">s2 = <span class=\"string\">\"World\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 拼接</span></span><br><span class=\"line\">s = s1 + s2</span><br><span class=\"line\">print(s)  <span class=\"comment\"># HelloWorld</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 截取，切片操作</span></span><br><span class=\"line\">print(s[<span class=\"number\">2</span>])  <span class=\"comment\"># l</span></span><br><span class=\"line\">print(s[<span class=\"number\">2</span>: <span class=\"number\">5</span>])  <span class=\"comment\"># llo</span></span><br><span class=\"line\">print(s[<span class=\"number\">2</span>: <span class=\"number\">-3</span>])  <span class=\"comment\"># lloWo</span></span><br><span class=\"line\"></span><br><span class=\"line\">print(s1 * <span class=\"number\">2</span>)  <span class=\"comment\"># 重复字符串：HelloHello</span></span><br><span class=\"line\">print(len(s1))  <span class=\"comment\"># 字符串长度：5</span></span><br><span class=\"line\">print(s1.count(<span class=\"string\">'l'</span>))  <span class=\"comment\"># l在字符串中出现的次数</span></span><br><span class=\"line\">print(s1.find(<span class=\"string\">'ell'</span>))  <span class=\"comment\"># 查找字符串，返回第一次出现的位置，返回-1表示未找到</span></span><br><span class=\"line\">print(s1.index(<span class=\"string\">'ell'</span>))  <span class=\"comment\"># 返回首次出现的位置，与find方法类似，如果未找到会返回错误</span></span><br><span class=\"line\">print(s1.endswith(<span class=\"string\">'lo'</span>))  <span class=\"comment\"># 是否以lo结尾</span></span><br><span class=\"line\">print(s1.startswith(<span class=\"string\">'he'</span>))  <span class=\"comment\"># 是否以he开头</span></span><br><span class=\"line\">print(s1.isalnum())  <span class=\"comment\"># 返回是否至少有一个字符并且都是是字母或数字</span></span><br><span class=\"line\">print(s1.isalpha())  <span class=\"comment\"># 返回是否至少有一个字符并且都是字母</span></span><br><span class=\"line\">print(s1.isdigit())  <span class=\"comment\"># 返回是否至少有一个字符并且都是数字</span></span><br><span class=\"line\">print(s1.islower())  <span class=\"comment\"># 返回是否至少有一个字符并且都是小写字母</span></span><br><span class=\"line\">print(s1.isupper())  <span class=\"comment\"># 返回是否至少有一个字符并且都是大写字母</span></span><br><span class=\"line\">print(<span class=\"string\">' '</span>.join([s1, s2]))  <span class=\"comment\"># 合并s1, s2，已空格分割</span></span><br><span class=\"line\">print((s1 + <span class=\"string\">' '</span> + s2).split(<span class=\"string\">' '</span>))  <span class=\"comment\"># 按指定分隔符分割字符串</span></span><br><span class=\"line\">print(s1.title())  <span class=\"comment\"># 返回首字母大写的字符串</span></span><br><span class=\"line\">print(s1.strip()) <span class=\"comment\"># 去掉s1前后的空格</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"模板字符串\"><a href=\"#模板字符串\" class=\"headerlink\" title=\"模板字符串\"></a>模板字符串</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">name = <span class=\"string\">\"Liujinlong\"</span></span><br><span class=\"line\">print(<span class=\"string\">\"My name is %s\"</span> % name)</span><br><span class=\"line\">pi = <span class=\"number\">3.14</span></span><br><span class=\"line\">print(<span class=\"string\">\"Pi is %.2f\"</span> % pi)</span><br><span class=\"line\"></span><br><span class=\"line\">str1 = <span class=\"string\">\"Hello\"</span></span><br><span class=\"line\">str2 = <span class=\"string\">\"World\"</span></span><br><span class=\"line\">print(<span class=\"string\">\"%s %s\"</span> % (str1, str2))</span><br><span class=\"line\"></span><br><span class=\"line\">msg = &#123;<span class=\"string\">\"action\"</span>: str1, <span class=\"string\">\"name\"</span>: str2&#125;</span><br><span class=\"line\">print(<span class=\"string\">\"%(action)s %(name)s\"</span> % msg)</span><br><span class=\"line\">print(<span class=\"string\">\"&#123;0&#125; &#123;1&#125;\"</span>.format(str1, str2))</span><br><span class=\"line\">print(<span class=\"string\">\"&#123;action&#125; &#123;name&#125;\"</span>.format(**msg)) <span class=\"comment\"># 双星号相当于解包字典</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"Python-中的列表\"><a href=\"#Python-中的列表\" class=\"headerlink\" title=\"Python 中的列表\"></a>Python 中的列表</h2><h3 id=\"列表的定义\"><a href=\"#列表的定义\" class=\"headerlink\" title=\"列表的定义\"></a>列表的定义</h3><ul>\n<li>列表中元素的类型是任意的</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>]</span><br><span class=\"line\">b = [<span class=\"number\">1</span>, <span class=\"string\">\"ljl\"</span>, [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>], <span class=\"keyword\">True</span>]</span><br><span class=\"line\">c = list()</span><br></pre></td></tr></table></figure>\n<h3 id=\"列表的操作\"><a href=\"#列表的操作\" class=\"headerlink\" title=\"列表的操作\"></a>列表的操作</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">l1 = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>]</span><br><span class=\"line\">l2 = [<span class=\"string\">'a'</span>, <span class=\"string\">'b'</span>, <span class=\"string\">'c'</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">print(l1 + l2)  <span class=\"comment\"># 合并</span></span><br><span class=\"line\">print(l1 * <span class=\"number\">2</span>)  <span class=\"comment\"># 重复</span></span><br><span class=\"line\">print(l1[<span class=\"number\">2</span>])  <span class=\"comment\"># 获取</span></span><br><span class=\"line\">print(l1[<span class=\"number\">2</span>: <span class=\"number\">4</span>])  <span class=\"comment\"># 切片操作</span></span><br><span class=\"line\">l1.append(<span class=\"number\">3</span>)  <span class=\"comment\"># 添加元素</span></span><br><span class=\"line\">print(l1.count(<span class=\"number\">3</span>))  <span class=\"comment\"># 列表中某个元素的个数</span></span><br><span class=\"line\">print(len(l1))  <span class=\"comment\"># 列表长度</span></span><br><span class=\"line\">print(l1.index(<span class=\"number\">3</span>))  <span class=\"comment\"># 某个元素在列表中的位置，未找到返回错误</span></span><br><span class=\"line\">l1.extend(l2)  <span class=\"comment\"># 将l2的所有元素添加到l1中</span></span><br><span class=\"line\">print(l1)</span><br><span class=\"line\">l1.insert(<span class=\"number\">11</span>, <span class=\"number\">2</span>)  <span class=\"comment\"># 在指定位置添加元素</span></span><br><span class=\"line\">print(l1)</span><br><span class=\"line\">l1.pop()  <span class=\"comment\"># 删除列表末尾元素</span></span><br><span class=\"line\">print(l1)</span><br><span class=\"line\">l1.remove(<span class=\"string\">'a'</span>)  <span class=\"comment\"># 删除指定元素</span></span><br><span class=\"line\">print(l1)</span><br><span class=\"line\">l1.reverse()  <span class=\"comment\"># 逆序列表</span></span><br><span class=\"line\">print(l1)</span><br><span class=\"line\">l1 = [<span class=\"number\">3</span>, <span class=\"number\">1</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"number\">8</span>, <span class=\"number\">2</span>]</span><br><span class=\"line\">l1.sort()  <span class=\"comment\"># 列表排序</span></span><br><span class=\"line\">print(l1)</span><br><span class=\"line\"></span><br><span class=\"line\">a = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>]</span><br><span class=\"line\">a.append(<span class=\"number\">4</span>)</span><br><span class=\"line\">print(a) <span class=\"comment\"># 1, 2, 3, 4</span></span><br><span class=\"line\">a.extend([<span class=\"number\">5</span>]) <span class=\"comment\"># 1, 2, 3, 4, 5</span></span><br><span class=\"line\">print(a)</span><br><span class=\"line\">a.append([<span class=\"number\">6</span>, <span class=\"number\">7</span>]) <span class=\"comment\"># [1, 2, 3, 4, 5, [6, 7]]</span></span><br><span class=\"line\">print(a)</span><br><span class=\"line\">a.extend([<span class=\"number\">8</span>, <span class=\"number\">9</span>]) <span class=\"comment\"># [1, 2, 3, 4, 5, [6, 7], 8, 9]</span></span><br><span class=\"line\">print(a)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># extend会自动把要添加的列表逐一添加到原列表模块，append是将元素直接添加到列表末尾</span></span><br><span class=\"line\"></span><br><span class=\"line\">value = a.pop()  <span class=\"comment\"># 删除列表中最后一个元素并返回这个元素</span></span><br><span class=\"line\">print(value)</span><br><span class=\"line\">print(a)</span><br><span class=\"line\">a.remove(<span class=\"number\">3</span>)  <span class=\"comment\"># 删除列表中值为3的元素</span></span><br><span class=\"line\">print(a)</span><br><span class=\"line\"><span class=\"keyword\">del</span>(a[<span class=\"number\">0</span>:<span class=\"number\">3</span>]) <span class=\"comment\"># 删除a中第0到3位置上的元素</span></span><br><span class=\"line\">print(a)</span><br></pre></td></tr></table></figure>\n<h3 id=\"元组\"><a href=\"#元组\" class=\"headerlink\" title=\"元组\"></a>元组</h3><ul>\n<li>列表与元组的区别<ul>\n<li>列表时可变的，元组不可变</li>\n<li>元组可以作为字典的 key，但是列表不行</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"keyword\">True</span>)</span><br><span class=\"line\">(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>)[<span class=\"number\">1</span>]</span><br><span class=\"line\">(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>)[<span class=\"number\">0</span>:<span class=\"number\">3</span>] <span class=\"comment\"># 得到一个元素</span></span><br><span class=\"line\">(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>) + (<span class=\"number\">3</span>, <span class=\"number\">3</span>, <span class=\"number\">3</span>) <span class=\"comment\"># (1, 2, 3, 3, 3, 3)</span></span><br><span class=\"line\">(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>) * <span class=\"number\">3</span> <span class=\"comment\"># (1, 2, 3, 1, 2, 3, 1, 2, 3)</span></span><br><span class=\"line\">type((<span class=\"number\">1</span>)) <span class=\"comment\"># int，这是因为内层括被解析成了数学运算的括号</span></span><br><span class=\"line\">type((<span class=\"number\">1</span>,)) <span class=\"comment\"># tuple</span></span><br><span class=\"line\">min((<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>))  <span class=\"comment\"># 最小值</span></span><br><span class=\"line\">max((<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>))  <span class=\"comment\"># 最大值</span></span><br><span class=\"line\">(,) <span class=\"comment\"># 空元组</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"序列的总结\"><a href=\"#序列的总结\" class=\"headerlink\" title=\"序列的总结\"></a>序列的总结</h3><ul>\n<li>str list tuple 都属于序列</li>\n<li>每个元素都会分配一个序号</li>\n<li>都支持切片操作</li>\n<li>支持包含操作：</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">print(<span class=\"string\">'or'</span> <span class=\"keyword\">in</span> <span class=\"string\">'Hello world'</span>)  <span class=\"comment\"># True</span></span><br><span class=\"line\">print(<span class=\"number\">1</span> <span class=\"keyword\">in</span> [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>])  <span class=\"comment\"># True</span></span><br><span class=\"line\">print(<span class=\"string\">'a'</span> <span class=\"keyword\">not</span> <span class=\"keyword\">in</span> (<span class=\"string\">'a'</span>, <span class=\"string\">'c'</span>, <span class=\"number\">12</span>))  <span class=\"comment\"># False</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>长度：<code>len([1, 2, 3])</code></li>\n<li>最大最小：<code>max([1, 2, 3]), min([1, 2, 3])</code></li>\n</ul>\n<h3 id=\"集合\"><a href=\"#集合\" class=\"headerlink\" title=\"集合\"></a>集合</h3><ul>\n<li>集合 Set 的特点<ul>\n<li>元素是无序的</li>\n<li>元素是不重复的</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>&#125;</span><br><span class=\"line\">len(&#123;<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>&#125;) <span class=\"comment\"># 3</span></span><br><span class=\"line\"><span class=\"number\">1</span> <span class=\"keyword\">in</span> &#123;<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>&#125; <span class=\"comment\"># True</span></span><br><span class=\"line\"><span class=\"number\">1</span> <span class=\"keyword\">not</span> <span class=\"keyword\">in</span> &#123;<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>&#125; <span class=\"comment\"># True</span></span><br><span class=\"line\">&#123;<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>&#125; - &#123;<span class=\"number\">3</span>, <span class=\"number\">4</span>&#125; <span class=\"comment\"># 求两个集合的差集</span></span><br><span class=\"line\">&#123;<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>&#125; &amp; &#123;<span class=\"number\">3</span>, <span class=\"number\">4</span>&#125; <span class=\"comment\"># 求两个集合的交集</span></span><br><span class=\"line\">&#123;<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>&#125; | &#123;<span class=\"number\">3</span>, <span class=\"number\">4</span>&#125; <span class=\"comment\"># 求两个集合的并集</span></span><br><span class=\"line\">set() <span class=\"comment\"># 空集合</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"字典\"><a href=\"#字典\" class=\"headerlink\" title=\"字典\"></a>字典</h3><ul>\n<li>Key 不能重复</li>\n<li>Key 必须是不可变的类型<ul>\n<li>列表是可变的，所以不能作为字典的 key</li>\n<li>int，元组，bool 都是不可变的</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">empty = &#123;&#125;  <span class=\"comment\"># 空字典</span></span><br><span class=\"line\">user = &#123;<span class=\"string\">\"name\"</span>: <span class=\"string\">\"ljl\"</span>, <span class=\"string\">\"age\"</span>:<span class=\"number\">12</span>&#125;</span><br><span class=\"line\">print(user[<span class=\"string\">\"name\"</span>])</span><br><span class=\"line\">user[<span class=\"string\">\"school\"</span>] = <span class=\"string\">\"tyut\"</span></span><br><span class=\"line\">user.update(&#123;<span class=\"string\">\"address\"</span>: <span class=\"string\">\"shenzhen\"</span>&#125;)</span><br><span class=\"line\"><span class=\"keyword\">del</span>(user[<span class=\"string\">\"address\"</span>])  <span class=\"comment\"># 删除某个key</span></span><br><span class=\"line\">print(user)</span><br><span class=\"line\">user.clear()  <span class=\"comment\"># 清空</span></span><br><span class=\"line\">print(user)</span><br><span class=\"line\">print(user.keys())  <span class=\"comment\"># 所有key</span></span><br><span class=\"line\">print(user.values())  <span class=\"comment\"># 所有value</span></span><br><span class=\"line\">print(<span class=\"string\">'address'</span> <span class=\"keyword\">in</span> user)  <span class=\"comment\"># 是否包含某个key</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"变量和运算符\"><a href=\"#变量和运算符\" class=\"headerlink\" title=\"变量和运算符\"></a>变量和运算符</h2><h3 id=\"变量的定义\"><a href=\"#变量的定义\" class=\"headerlink\" title=\"变量的定义\"></a>变量的定义</h3><ul>\n<li>Python 中的变量就是一个值的别名</li>\n<li>原则：变量名要有意义</li>\n</ul>\n<h3 id=\"变量命名规则\"><a href=\"#变量命名规则\" class=\"headerlink\" title=\"变量命名规则\"></a>变量命名规则</h3><ul>\n<li>变量名的首字符不能是数字</li>\n<li>只能包含字母，数字，下划线</li>\n<li>系统的关键字不能用作变量名，非系统保留关键字，但是标准库函数的，也不要使用，例如：type</li>\n<li>变量区分大小写</li>\n</ul>\n<h3 id=\"值类型和引用类型\"><a href=\"#值类型和引用类型\" class=\"headerlink\" title=\"值类型和引用类型\"></a>值类型和引用类型</h3><ul>\n<li>值类型：int, str, tuple</li>\n<li>引用类型：list, set, dict</li>\n<li><code>id()</code>: 显示变量内存地址</li>\n</ul>\n<h3 id=\"list-与-tuple\"><a href=\"#list-与-tuple\" class=\"headerlink\" title=\"list 与 tuple\"></a>list 与 tuple</h3><ul>\n<li>list 是可改变的</li>\n<li>tuple 是不可改变的</li>\n<li>使用原则：能用元组尽量用元组，因为元组不可改变，更为安全</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>]</span><br><span class=\"line\">a[<span class=\"number\">0</span>] = <span class=\"number\">11</span> <span class=\"comment\"># OK</span></span><br><span class=\"line\">b = (<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>)</span><br><span class=\"line\">b[<span class=\"number\">0</span>] = <span class=\"number\">11</span> <span class=\"comment\"># error</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"运算符号\"><a href=\"#运算符号\" class=\"headerlink\" title=\"运算符号\"></a>运算符号</h3><ul>\n<li>数学运算符：<code>+-*/</code></li>\n<li>整除：<code>//</code></li>\n<li>余数：<code>%</code></li>\n<li>乘方：<code>**</code> 例如，<code>2**2 = 4</code></li>\n<li>赋值运算符：<code>=, +=, -=, *=, /=, %=, **=, //=</code></li>\n<li>比较运算符：<code>==, !=, &gt;=, &gt;, &lt;=, &lt;</code><ul>\n<li>字符串，bool 都可以比较，字符串转为 ascii 码进行比较，bool 则是 True 转为 1，False 转为 0</li>\n<li>比较返回一个 bool 值</li>\n<li>列表，元组都可以比较，比较的规则是一个一个元素进行比较，直到比较出结果</li>\n</ul>\n</li>\n<li>逻辑运算符：<code>and, or, not</code><ul>\n<li>非 Bool 类型也可以进行逻辑运算，规则是将非 Bool 类型先转为 Bool 类型再进行计算</li>\n<li>int, float 转为 bool，0 为 False，非 0 为 True</li>\n<li>字符串转为 bool，空字符串为 False，非空字符串为 True</li>\n<li>列表转为 bool，空列表为 False，非空列表为 True</li>\n<li>元组，set，dict 与列表一样</li>\n<li>举例：<ul>\n<li><code>2 and 1 # 1</code></li>\n<li><code>1 and 2 # 2</code></li>\n<li><code>1 or 2 # 1</code></li>\n<li><code>0 or 1 # 1</code></li>\n<li>返回的值符合就近原则，例如<code>2 and 1</code>，更具左边的元素 2 无法判断出结果，读取 1 后，可以判断出结构，所有返回 1，<code>1 or 2</code>根据左边的元素 1 就直接可以判断出表达式的值，所以直接返回 1</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>成员运算符：<code>in, not in</code><ul>\n<li>一个元素是否在另外的一组元素中</li>\n<li>返回 bool 类型</li>\n<li>可以作用于：列表，字符串，元组，set，dict</li>\n<li>字典判断的是 key</li>\n</ul>\n</li>\n<li>身份运算符：is, not is<ul>\n<li>比较的是两个变量的内存地址是否相等</li>\n<li>对象的三个特征：值，类型，身份</li>\n<li>判断类型 type(a): <code>type(a) == int</code></li>\n<li>推荐使用 isinstance()方法进行类型判断，例如：<code>isinstance(a, int), isinstance(a, (int, float, str))</code></li>\n</ul>\n</li>\n<li>位运算符：&amp;, |, ^, ~, &lt;&lt;, &gt;&gt;</li>\n</ul>\n<p>特殊的地方：</p>\n<ul>\n<li>Python 没有自增，自减操作</li>\n</ul>\n<h2 id=\"分支，循环，条件，枚举\"><a href=\"#分支，循环，条件，枚举\" class=\"headerlink\" title=\"分支，循环，条件，枚举\"></a>分支，循环，条件，枚举</h2><h3 id=\"什么是表达式\"><a href=\"#什么是表达式\" class=\"headerlink\" title=\"什么是表达式\"></a>什么是表达式</h3><ul>\n<li>表达式是运算符和操作数所构成的序列</li>\n</ul>\n<h3 id=\"表达式优先级\"><a href=\"#表达式优先级\" class=\"headerlink\" title=\"表达式优先级\"></a>表达式优先级</h3><ul>\n<li>and 的优先级大于 or，not &gt; and &gt; or</li>\n<li>解析表达式的顺序：<ul>\n<li>相同优先级从左向右，左结合</li>\n<li>使用括号改变优先级</li>\n<li>赋值运算符是右结合</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"流程控制语句\"><a href=\"#流程控制语句\" class=\"headerlink\" title=\"流程控制语句\"></a>流程控制语句</h3><ul>\n<li>if, if-else</li>\n<li>pass 空语句</li>\n<li>while 语句， while-else（循环退出时，执行 else）</li>\n<li>for: 遍历集合，序列，字典，for-else(遍历完成，执行 else)</li>\n<li>break：跳出循环，从 break 退出循环，不会执行 else 语句</li>\n<li>continue: 跳过本次循环</li>\n<li>range 函数，第一个参数为起始位置，第二个参数为序列元素个数，第三个参数为步长</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a = <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"keyword\">while</span> a &lt; <span class=\"number\">10</span>:</span><br><span class=\"line\">    print(a)</span><br><span class=\"line\">    a += <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"keyword\">else</span>:</span><br><span class=\"line\">    print(<span class=\"string\">'Over'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> range(<span class=\"number\">0</span>, <span class=\"number\">10</span>):</span><br><span class=\"line\">    print(x)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">0</span>, <span class=\"number\">10</span>):</span><br><span class=\"line\">    print(i)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> i == <span class=\"number\">8</span>:</span><br><span class=\"line\">        <span class=\"keyword\">break</span></span><br><span class=\"line\"><span class=\"keyword\">else</span>:</span><br><span class=\"line\">    print(<span class=\"string\">'Over'</span>)  <span class=\"comment\"># Over不会打印，因为循环break了</span></span><br><span class=\"line\"></span><br><span class=\"line\">num = <span class=\"number\">10</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"number\">5</span> &lt; num &lt; <span class=\"number\">20</span>:  <span class=\"comment\"># 可以使用这种判断条件</span></span><br><span class=\"line\">  print(<span class=\"string\">\"hello\"</span>)</span><br></pre></td></tr></table></figure>\n<h3 id=\"Comprehension\"><a href=\"#Comprehension\" class=\"headerlink\" title=\"Comprehension\"></a>Comprehension</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># List Comprehension</span></span><br><span class=\"line\">numbers = [i <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">0</span>, <span class=\"number\">10</span>)]  <span class=\"comment\"># [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]</span></span><br><span class=\"line\">print(numbers)</span><br><span class=\"line\">numbers = [i <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">0</span>, <span class=\"number\">10</span>) <span class=\"keyword\">if</span> i % <span class=\"number\">2</span> == <span class=\"number\">0</span>]  <span class=\"comment\"># [0, 2, 4, 6, 8]</span></span><br><span class=\"line\">print(numbers)</span><br><span class=\"line\">strings = [[<span class=\"string\">'1'</span>, <span class=\"string\">'2'</span>, <span class=\"string\">'3'</span>], [<span class=\"string\">'4'</span>, <span class=\"string\">'5'</span>, <span class=\"string\">'6'</span>], [<span class=\"string\">'7'</span>, <span class=\"string\">'8'</span>, <span class=\"string\">'9'</span>]]</span><br><span class=\"line\">faltten = [int(i) <span class=\"keyword\">for</span> item <span class=\"keyword\">in</span> strings <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> item]</span><br><span class=\"line\">print(faltten) <span class=\"comment\"># [1, 2, 3, 4, 5, 6, 7, 8, 9]</span></span><br><span class=\"line\">xSamples = [<span class=\"number\">2</span>, <span class=\"number\">5</span>, <span class=\"number\">8</span>]</span><br><span class=\"line\">ySamples = [<span class=\"number\">2</span>, <span class=\"number\">6</span>, <span class=\"number\">8</span>]</span><br><span class=\"line\">points = [(x, y) <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> xSamples <span class=\"keyword\">for</span> y <span class=\"keyword\">in</span> ySamples <span class=\"keyword\">if</span> x != y]</span><br><span class=\"line\">print(points) <span class=\"comment\"># [(2, 6), (2, 8), (5, 2), (5, 6), (5, 8), (8, 2), (8, 6)]</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Set Comprehension</span></span><br><span class=\"line\">numbers = &#123;i <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">0</span>, <span class=\"number\">10</span>)&#125;</span><br><span class=\"line\">print(numbers)  <span class=\"comment\"># &#123;0, 1, 2, 3, 4, 5, 6, 7, 8, 9&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Dictionary Comprehension</span></span><br><span class=\"line\">dicts = &#123;i: str(i) <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">0</span>, <span class=\"number\">10</span>)&#125;</span><br><span class=\"line\">print(dicts)  <span class=\"comment\"># &#123;0: '0', 1: '1', 2: '2', 3: '3', 4: '4', 5: '5', 6: '6', 7: '7', 8: '8', 9: '9'&#125;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"包，模块，类，函数与变量\"><a href=\"#包，模块，类，函数与变量\" class=\"headerlink\" title=\"包，模块，类，函数与变量\"></a>包，模块，类，函数与变量</h2><h3 id=\"包\"><a href=\"#包\" class=\"headerlink\" title=\"包\"></a>包</h3><ul>\n<li>一个文件夹就是一个包，包名就是文件名</li>\n<li>子包：文件夹里还有一个文件夹</li>\n<li>文件夹里必须有一个<code>__init__.py</code>文件</li>\n</ul>\n<h3 id=\"模块\"><a href=\"#模块\" class=\"headerlink\" title=\"模块\"></a>模块</h3><ul>\n<li>一个文件就是一个模块，模块名就是文件名</li>\n<li>不同包的相同模块在引用是使用：<code>包名.模块名</code></li>\n<li><code>__init__.py</code>文件也是一个模块</li>\n</ul>\n<h3 id=\"导入另外一个模块\"><a href=\"#导入另外一个模块\" class=\"headerlink\" title=\"导入另外一个模块\"></a>导入另外一个模块</h3><p>导入一个模块有两种方法，import 和 from-import</p>\n<h4 id=\"import-导入\"><a href=\"#import-导入\" class=\"headerlink\" title=\"import 导入\"></a>import 导入</h4><ul>\n<li>语法：<code>import package1</code></li>\n<li>import 导入的是一个模块，使用模块里的变量名时需要带上模块名，例如<code>package1.a</code></li>\n<li>可以使用 as 关键字给模块起一个别名</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> test</span><br><span class=\"line\">print(test.a)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> package.modual <span class=\"keyword\">as</span> p1</span><br><span class=\"line\">print(p1.a)</span><br></pre></td></tr></table></figure>\n<h4 id=\"from-import-导入\"><a href=\"#from-import-导入\" class=\"headerlink\" title=\"from-import 导入\"></a>from-import 导入</h4><ul>\n<li>语法：<code>from module import a</code></li>\n<li>from-input 可以直接导入变量，例如<code>from package.module import a</code></li>\n<li>from-input 可以导入模块<code>from package import module</code></li>\n<li>使用<em>引入所有变量：`from test import </em>`</li>\n<li>指定使用*时模块可导出的变量：使用内置变量<code>__all__</code></li>\n<li>引入多个变量：<code>from test import a, b, c</code></li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> test <span class=\"keyword\">import</span> a</span><br><span class=\"line\">print(a)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> test <span class=\"keyword\">import</span> *</span><br><span class=\"line\">print(a)</span><br><span class=\"line\">print(b)</span><br><span class=\"line\">print(c)</span><br><span class=\"line\"></span><br><span class=\"line\">__all__ = [<span class=\"string\">'a'</span>, <span class=\"string\">'c'</span>] <span class=\"comment\"># 指定使用*导入是，只导入a和c两个变量</span></span><br><span class=\"line\">a = <span class=\"number\">2</span></span><br><span class=\"line\">b = <span class=\"number\">3</span></span><br><span class=\"line\">c = <span class=\"number\">4</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> test <span class=\"keyword\">import</span> *</span><br><span class=\"line\">print(a)</span><br><span class=\"line\">print(c)</span><br><span class=\"line\">print(b) <span class=\"comment\"># ERROR</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> test <span class=\"keyword\">import</span> b</span><br><span class=\"line\">print(b) <span class=\"comment\"># OK</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 导入多个变量换行</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> test <span class=\"keyword\">import</span> a, b, c, d,\\</span><br><span class=\"line\">e, f, g</span><br><span class=\"line\"><span class=\"keyword\">from</span> test <span class=\"keyword\">import</span> (a, b, c, d,</span><br><span class=\"line\">e, f, g)</span><br></pre></td></tr></table></figure>\n<h3 id=\"input-py文件\"><a href=\"#input-py文件\" class=\"headerlink\" title=\"__input__.py文件\"></a><code>__input__.py</code>文件</h3><ul>\n<li>导入包或者包内的某个模块时，<code>__init__.py</code>会被自动执行，可以做一些初始化的工作</li>\n<li><code>__init__.py</code> 的应用场景：<ul>\n<li>决定哪些模块可以被导出</li>\n<li>批量导入某些模块，在使用包是不需要再次导入</li>\n<li>做一些包的初始化工作</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># __init__.py 包名：t</span></span><br><span class=\"line\">__all__ = [<span class=\"string\">'module1'</span>, <span class=\"string\">'module3'</span>] <span class=\"comment\"># 只有module1和module2两个模块可以被导出</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 批量导入</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> sys</span><br><span class=\"line\"><span class=\"keyword\">import</span> datetime</span><br><span class=\"line\"><span class=\"keyword\">import</span> io</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># other.py</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> t</span><br><span class=\"line\">print(t.sys.path)</span><br></pre></td></tr></table></figure>\n<h3 id=\"包和模块的几个常见问题\"><a href=\"#包和模块的几个常见问题\" class=\"headerlink\" title=\"包和模块的几个常见问题\"></a>包和模块的几个常见问题</h3><ul>\n<li>包和模块是不会重复导入的</li>\n<li>避免循环导入，即 A 模块导入 B 模块，B 模块又导入 A 模块，这样编译器会报错</li>\n<li>导入模块时就会执行模块里的代码，但只会执行一次</li>\n</ul>\n<h3 id=\"模块里的变量\"><a href=\"#模块里的变量\" class=\"headerlink\" title=\"模块里的变量\"></a>模块里的变量</h3><p>可以使用 dir()可以打印出模块里的所有变量，<code>dic(module)</code>打印模块中所有的变量</p>\n<ul>\n<li><code>__name__</code>: 模块的完整名称，包括包名<code>package.module</code></li>\n<li><code>__package__</code>: 模块所属的包名</li>\n<li><code>__file__</code>: 模块文件的完整路径</li>\n<li><code>__doc__</code>: 模块的注释</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># module1</span></span><br><span class=\"line\"><span class=\"string\">'''</span></span><br><span class=\"line\"><span class=\"string\">This is doc</span></span><br><span class=\"line\"><span class=\"string\">'''</span></span><br><span class=\"line\">print(__name__)</span><br><span class=\"line\">print(__file__)</span><br><span class=\"line\">print(__package__)</span><br><span class=\"line\">print(__doc__)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 结果</span></span><br><span class=\"line\"><span class=\"comment\">#package.module</span></span><br><span class=\"line\"><span class=\"comment\">#/Users/liujinlong/Documents/Study/Python/package/module.py</span></span><br><span class=\"line\"><span class=\"comment\">#package</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#This is doc</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br></pre></td></tr></table></figure>\n<p>如果一个模块被当成应用程序执行的入口(直接通过<code>pyton xxx.py</code>执行)，则上面的几个变量就会变。</p>\n<ul>\n<li><code>__name__</code>变为<code>__main__</code></li>\n<li><code>__package__</code>为空</li>\n<li><code>__file__</code>为是执行路径与模块文件名的相对路径，与执行路径有关</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">print(<span class=\"string\">\"__name__ :\"</span> + (__name__ <span class=\"keyword\">or</span> <span class=\"string\">\"None\"</span>))</span><br><span class=\"line\">print(<span class=\"string\">\"__package__:\"</span> + (__package__ <span class=\"keyword\">or</span> <span class=\"string\">\"None\"</span>))</span><br><span class=\"line\">print(<span class=\"string\">'__doc__:'</span> + __doc__)</span><br><span class=\"line\">print(<span class=\"string\">'__file__: '</span> + __file__)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 结果：</span></span><br><span class=\"line\"><span class=\"comment\">#__name__ :__main__</span></span><br><span class=\"line\"><span class=\"comment\">#__package__:None</span></span><br><span class=\"line\"><span class=\"comment\">#__doc__:</span></span><br><span class=\"line\"><span class=\"comment\">#this is doc</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#__file__: test2.py</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"name-的应用\"><a href=\"#name-的应用\" class=\"headerlink\" title=\"__name__的应用\"></a><code>__name__</code>的应用</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">'__main__'</span>:</span><br><span class=\"line\">  <span class=\"keyword\">pass</span></span><br></pre></td></tr></table></figure>\n<p>上面的语句是标明的 Python 文件既可以作为模块，也可以作为 app 的入口文件</p>\n<h3 id=\"相对导入和绝对导入\"><a href=\"#相对导入和绝对导入\" class=\"headerlink\" title=\"相对导入和绝对导入\"></a>相对导入和绝对导入</h3><ul>\n<li>顶级包和入口文件有关，入口文件所在的文件夹并不是顶级包</li>\n<li>绝对导入：从顶级包开始导入 <code>import package1.package2.module</code>或<code>from package1.package2 import module1</code></li>\n<li>相对导入：<code>from .m3 import *</code>，相对导入只能用于<code>from-import</code><ul>\n<li>入口文件不能用相对导入，因为<code>__main__</code>这个模块是不存在的，除非使用<code>python -m</code></li>\n<li>.当前文件夹</li>\n<li>..上一层文件夹</li>\n<li>…上上层文件夹</li>\n</ul>\n</li>\n<li>注意事项：与入口文件同级目录下不要再有其他模块</li>\n</ul>\n<p>示例，如下图目录结构：</p>\n<p><img src=\"http://blog.shicishuzhai.com/fb3913861d028acf0475d26ce685031e.png\" alt=\"2\"></p>\n<p>要在<code>main.py</code>中引入其他模块，不能使用相对导入，只能使用绝对导入：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># main.py</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> package1.module1_1</span><br><span class=\"line\"><span class=\"keyword\">import</span> package1.package1_1.module1_1_1 <span class=\"keyword\">as</span> m1_1_1</span><br><span class=\"line\"><span class=\"keyword\">from</span> package2.package2_1 <span class=\"keyword\">import</span> module2_1_1</span><br><span class=\"line\"></span><br><span class=\"line\">m1_1_1.test() <span class=\"comment\"># test是定义在module1_1_1中的一个方法</span></span><br></pre></td></tr></table></figure>\n<p>在<code>module1_1_2.py</code>中导入其他模块可以使用相对导入</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> . <span class=\"keyword\">import</span> module1_1_1</span><br><span class=\"line\"><span class=\"keyword\">from</span> ..module1_1 <span class=\"keyword\">import</span> test1_1</span><br><span class=\"line\"><span class=\"keyword\">from</span> ..package1_2 <span class=\"keyword\">import</span> module1_2_1</span><br><span class=\"line\"><span class=\"keyword\">import</span> package2.package2_1.module2_1_1 <span class=\"keyword\">as</span> m211  <span class=\"comment\"># 这里只能用绝对导入</span></span><br><span class=\"line\"></span><br><span class=\"line\">test1_1()  <span class=\"comment\"># test1_1是module1_1.py里的一个方法</span></span><br><span class=\"line\">module1_2_1.test1_2_1()  <span class=\"comment\"># test1_2_1是module1_2_1.py里的一个方法</span></span><br><span class=\"line\">m211.test2_1_1()  <span class=\"comment\"># test2_1_1是module2_1_1.py里的一个方法</span></span><br></pre></td></tr></table></figure>\n<p>上面要注意的一点是，<code>package1</code>中的模块引用<code>package2</code>中的模块时，只能用绝对导入，因为<code>package1</code>和<code>package2</code>都是和入口文件<code>main.py</code>同级的</p>\n<p>未完待续！</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"数据类型\"><a href=\"#数据类型\" class=\"headerlink\" title=\"数据类型\"></a>数据类型</h2><h3 id=\"除，整除\"><a href=\"#除，整除\" class=\"headerlink\" title=\"除，整除\"></a>除，整除</h3><p>与其他语言不通，<code>/</code>是除法，得到的 float 类型，要得到整型需要用<code>//</code></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">type(<span class=\"number\">2</span>/<span class=\"number\">2</span>) <span class=\"comment\"># float</span></span><br><span class=\"line\">type(<span class=\"number\">2</span>//<span class=\"number\">2</span>) <span class=\"comment\"># int</span></span><br><span class=\"line\"><span class=\"number\">1</span>//<span class=\"number\">2</span> <span class=\"comment\"># 0</span></span><br><span class=\"line\"><span class=\"number\">1</span>/<span class=\"number\">2</span> <span class=\"comment\"># 0.5</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"二进制，八进制，十六进制\"><a href=\"#二进制，八进制，十六进制\" class=\"headerlink\" title=\"二进制，八进制，十六进制\"></a>二进制，八进制，十六进制</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">0b10</span> <span class=\"comment\"># 2进制</span></span><br><span class=\"line\"><span class=\"number\">0o10</span> <span class=\"comment\"># 8进制</span></span><br><span class=\"line\"><span class=\"number\">0x10</span> <span class=\"comment\"># 16进制</span></span><br><span class=\"line\"><span class=\"comment\"># 将一个数转为二进制</span></span><br><span class=\"line\">bin(<span class=\"number\">12</span>)</span><br><span class=\"line\"><span class=\"comment\"># 将一个数转为10进制</span></span><br><span class=\"line\">int(<span class=\"number\">0x12</span>)</span><br><span class=\"line\"><span class=\"comment\"># 将一个数转为16进制</span></span><br><span class=\"line\">hex(<span class=\"number\">12131</span>)</span><br><span class=\"line\"><span class=\"comment\"># 将一个数转为8进制</span></span><br><span class=\"line\">oct(<span class=\"number\">0x1231</span>)</span><br></pre></td></tr></table></figure>\n<h3 id=\"布尔类型\"><a href=\"#布尔类型\" class=\"headerlink\" title=\"布尔类型\"></a>布尔类型</h3><p>布尔类型有两个值，<code>True</code>与<code>False</code></p>\n<ul>\n<li>对于整数来说，非 0 可以转为<code>True</code>，0 可以转为<code>False</code></li>\n<li>对于字符串来说，空字符串可以转为<code>False</code>，其他字符串可以转为<code>True</code></li>\n<li>对于列表和元组等序列来说，空序列可以转为<code>False</code>，序列中有元素可以转为<code>True</code></li>\n<li>对集合和字典来说，空字典，空集合可以转为<code>False</code>，字典或序列中有元素可以转为<code>True</code></li>\n<li>None 也可以转为<code>False</code></li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">num1 = <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> num1:</span><br><span class=\"line\">    print(<span class=\"string\">'YES'</span>)  <span class=\"comment\"># YES</span></span><br><span class=\"line\"><span class=\"keyword\">else</span>:</span><br><span class=\"line\">    print(<span class=\"string\">'NO'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">num2 = <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> num2:</span><br><span class=\"line\">    print(<span class=\"string\">'YES'</span>)</span><br><span class=\"line\"><span class=\"keyword\">else</span>:</span><br><span class=\"line\">    print(<span class=\"string\">'NO'</span>)  <span class=\"comment\"># NO</span></span><br><span class=\"line\"></span><br><span class=\"line\">list1 = []</span><br><span class=\"line\">list2 = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>]</span><br><span class=\"line\"><span class=\"keyword\">if</span> list1:</span><br><span class=\"line\">    print(<span class=\"string\">'YES'</span>)</span><br><span class=\"line\"><span class=\"keyword\">else</span>:</span><br><span class=\"line\">    print(<span class=\"string\">'NO'</span>)  <span class=\"comment\"># NO</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> list2:</span><br><span class=\"line\">    print(<span class=\"string\">'YES'</span>)  <span class=\"comment\"># YES</span></span><br><span class=\"line\"><span class=\"keyword\">else</span>:</span><br><span class=\"line\">    print(<span class=\"string\">'NO'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">dict1 = &#123;&#125;</span><br><span class=\"line\">dict2 = &#123;<span class=\"number\">1</span>: <span class=\"string\">'A'</span>, <span class=\"number\">2</span>: <span class=\"string\">'B'</span>&#125;</span><br><span class=\"line\"><span class=\"keyword\">if</span> dict1:</span><br><span class=\"line\">    print(<span class=\"string\">'YES'</span>)</span><br><span class=\"line\"><span class=\"keyword\">else</span>:</span><br><span class=\"line\">    print(<span class=\"string\">'NO'</span>)  <span class=\"comment\"># NO</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> dict2:</span><br><span class=\"line\">    print(<span class=\"string\">'YES'</span>)  <span class=\"comment\"># YES</span></span><br><span class=\"line\"><span class=\"keyword\">else</span>:</span><br><span class=\"line\">    print(<span class=\"string\">'NO'</span>)</span><br></pre></td></tr></table></figure>\n<h3 id=\"单引号和双引号\"><a href=\"#单引号和双引号\" class=\"headerlink\" title=\"单引号和双引号\"></a>单引号和双引号</h3><ul>\n<li>单引号：单引号可以包含双引号，例如：<code>&#39;My name is &quot;ljl&quot;&#39;</code></li>\n<li>双引号：双引号也可以包含单引号，例如：<code>&quot;Let&#39;s go&quot;</code></li>\n</ul>\n<h3 id=\"多行文本\"><a href=\"#多行文本\" class=\"headerlink\" title=\"多行文本\"></a>多行文本</h3><p>多行文本可以用三个双引号表示，也可以用三个单引号表示，例如：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">'''</span></span><br><span class=\"line\"><span class=\"string\">Hello!</span></span><br><span class=\"line\"><span class=\"string\">My name is Liuijinlong.</span></span><br><span class=\"line\"><span class=\"string\">What is your name?</span></span><br><span class=\"line\"><span class=\"string\">'''</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">\"\"\"</span></span><br><span class=\"line\"><span class=\"string\">Hello!</span></span><br><span class=\"line\"><span class=\"string\">My name is Liuijinlong.</span></span><br><span class=\"line\"><span class=\"string\">What is your name?</span></span><br><span class=\"line\"><span class=\"string\">\"\"\"</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>要显示字符串的格式要使用<code>print</code>函数</li>\n<li>idle 会把字符串中的格式变为转义字符，如下：</li>\n</ul>\n<p><img src=\"http://blog.shicishuzhai.com/094e3ce9743b9dafadb426041996058b.png\" alt=\"1\"></p>\n<h3 id=\"原始字符\"><a href=\"#原始字符\" class=\"headerlink\" title=\"原始字符\"></a>原始字符</h3><p>在字符串前加一个 r，字符串中的转义字符不会被解析</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">print(<span class=\"string\">r'aaa \\n aaa'</span>) <span class=\"comment\"># aaa \\n aaa</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"字符串的操作\"><a href=\"#字符串的操作\" class=\"headerlink\" title=\"字符串的操作\"></a>字符串的操作</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">s1 = <span class=\"string\">\"Hello\"</span></span><br><span class=\"line\">s2 = <span class=\"string\">\"World\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 拼接</span></span><br><span class=\"line\">s = s1 + s2</span><br><span class=\"line\">print(s)  <span class=\"comment\"># HelloWorld</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 截取，切片操作</span></span><br><span class=\"line\">print(s[<span class=\"number\">2</span>])  <span class=\"comment\"># l</span></span><br><span class=\"line\">print(s[<span class=\"number\">2</span>: <span class=\"number\">5</span>])  <span class=\"comment\"># llo</span></span><br><span class=\"line\">print(s[<span class=\"number\">2</span>: <span class=\"number\">-3</span>])  <span class=\"comment\"># lloWo</span></span><br><span class=\"line\"></span><br><span class=\"line\">print(s1 * <span class=\"number\">2</span>)  <span class=\"comment\"># 重复字符串：HelloHello</span></span><br><span class=\"line\">print(len(s1))  <span class=\"comment\"># 字符串长度：5</span></span><br><span class=\"line\">print(s1.count(<span class=\"string\">'l'</span>))  <span class=\"comment\"># l在字符串中出现的次数</span></span><br><span class=\"line\">print(s1.find(<span class=\"string\">'ell'</span>))  <span class=\"comment\"># 查找字符串，返回第一次出现的位置，返回-1表示未找到</span></span><br><span class=\"line\">print(s1.index(<span class=\"string\">'ell'</span>))  <span class=\"comment\"># 返回首次出现的位置，与find方法类似，如果未找到会返回错误</span></span><br><span class=\"line\">print(s1.endswith(<span class=\"string\">'lo'</span>))  <span class=\"comment\"># 是否以lo结尾</span></span><br><span class=\"line\">print(s1.startswith(<span class=\"string\">'he'</span>))  <span class=\"comment\"># 是否以he开头</span></span><br><span class=\"line\">print(s1.isalnum())  <span class=\"comment\"># 返回是否至少有一个字符并且都是是字母或数字</span></span><br><span class=\"line\">print(s1.isalpha())  <span class=\"comment\"># 返回是否至少有一个字符并且都是字母</span></span><br><span class=\"line\">print(s1.isdigit())  <span class=\"comment\"># 返回是否至少有一个字符并且都是数字</span></span><br><span class=\"line\">print(s1.islower())  <span class=\"comment\"># 返回是否至少有一个字符并且都是小写字母</span></span><br><span class=\"line\">print(s1.isupper())  <span class=\"comment\"># 返回是否至少有一个字符并且都是大写字母</span></span><br><span class=\"line\">print(<span class=\"string\">' '</span>.join([s1, s2]))  <span class=\"comment\"># 合并s1, s2，已空格分割</span></span><br><span class=\"line\">print((s1 + <span class=\"string\">' '</span> + s2).split(<span class=\"string\">' '</span>))  <span class=\"comment\"># 按指定分隔符分割字符串</span></span><br><span class=\"line\">print(s1.title())  <span class=\"comment\"># 返回首字母大写的字符串</span></span><br><span class=\"line\">print(s1.strip()) <span class=\"comment\"># 去掉s1前后的空格</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"模板字符串\"><a href=\"#模板字符串\" class=\"headerlink\" title=\"模板字符串\"></a>模板字符串</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">name = <span class=\"string\">\"Liujinlong\"</span></span><br><span class=\"line\">print(<span class=\"string\">\"My name is %s\"</span> % name)</span><br><span class=\"line\">pi = <span class=\"number\">3.14</span></span><br><span class=\"line\">print(<span class=\"string\">\"Pi is %.2f\"</span> % pi)</span><br><span class=\"line\"></span><br><span class=\"line\">str1 = <span class=\"string\">\"Hello\"</span></span><br><span class=\"line\">str2 = <span class=\"string\">\"World\"</span></span><br><span class=\"line\">print(<span class=\"string\">\"%s %s\"</span> % (str1, str2))</span><br><span class=\"line\"></span><br><span class=\"line\">msg = &#123;<span class=\"string\">\"action\"</span>: str1, <span class=\"string\">\"name\"</span>: str2&#125;</span><br><span class=\"line\">print(<span class=\"string\">\"%(action)s %(name)s\"</span> % msg)</span><br><span class=\"line\">print(<span class=\"string\">\"&#123;0&#125; &#123;1&#125;\"</span>.format(str1, str2))</span><br><span class=\"line\">print(<span class=\"string\">\"&#123;action&#125; &#123;name&#125;\"</span>.format(**msg)) <span class=\"comment\"># 双星号相当于解包字典</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"Python-中的列表\"><a href=\"#Python-中的列表\" class=\"headerlink\" title=\"Python 中的列表\"></a>Python 中的列表</h2><h3 id=\"列表的定义\"><a href=\"#列表的定义\" class=\"headerlink\" title=\"列表的定义\"></a>列表的定义</h3><ul>\n<li>列表中元素的类型是任意的</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>]</span><br><span class=\"line\">b = [<span class=\"number\">1</span>, <span class=\"string\">\"ljl\"</span>, [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>], <span class=\"keyword\">True</span>]</span><br><span class=\"line\">c = list()</span><br></pre></td></tr></table></figure>\n<h3 id=\"列表的操作\"><a href=\"#列表的操作\" class=\"headerlink\" title=\"列表的操作\"></a>列表的操作</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">l1 = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>]</span><br><span class=\"line\">l2 = [<span class=\"string\">'a'</span>, <span class=\"string\">'b'</span>, <span class=\"string\">'c'</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">print(l1 + l2)  <span class=\"comment\"># 合并</span></span><br><span class=\"line\">print(l1 * <span class=\"number\">2</span>)  <span class=\"comment\"># 重复</span></span><br><span class=\"line\">print(l1[<span class=\"number\">2</span>])  <span class=\"comment\"># 获取</span></span><br><span class=\"line\">print(l1[<span class=\"number\">2</span>: <span class=\"number\">4</span>])  <span class=\"comment\"># 切片操作</span></span><br><span class=\"line\">l1.append(<span class=\"number\">3</span>)  <span class=\"comment\"># 添加元素</span></span><br><span class=\"line\">print(l1.count(<span class=\"number\">3</span>))  <span class=\"comment\"># 列表中某个元素的个数</span></span><br><span class=\"line\">print(len(l1))  <span class=\"comment\"># 列表长度</span></span><br><span class=\"line\">print(l1.index(<span class=\"number\">3</span>))  <span class=\"comment\"># 某个元素在列表中的位置，未找到返回错误</span></span><br><span class=\"line\">l1.extend(l2)  <span class=\"comment\"># 将l2的所有元素添加到l1中</span></span><br><span class=\"line\">print(l1)</span><br><span class=\"line\">l1.insert(<span class=\"number\">11</span>, <span class=\"number\">2</span>)  <span class=\"comment\"># 在指定位置添加元素</span></span><br><span class=\"line\">print(l1)</span><br><span class=\"line\">l1.pop()  <span class=\"comment\"># 删除列表末尾元素</span></span><br><span class=\"line\">print(l1)</span><br><span class=\"line\">l1.remove(<span class=\"string\">'a'</span>)  <span class=\"comment\"># 删除指定元素</span></span><br><span class=\"line\">print(l1)</span><br><span class=\"line\">l1.reverse()  <span class=\"comment\"># 逆序列表</span></span><br><span class=\"line\">print(l1)</span><br><span class=\"line\">l1 = [<span class=\"number\">3</span>, <span class=\"number\">1</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"number\">8</span>, <span class=\"number\">2</span>]</span><br><span class=\"line\">l1.sort()  <span class=\"comment\"># 列表排序</span></span><br><span class=\"line\">print(l1)</span><br><span class=\"line\"></span><br><span class=\"line\">a = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>]</span><br><span class=\"line\">a.append(<span class=\"number\">4</span>)</span><br><span class=\"line\">print(a) <span class=\"comment\"># 1, 2, 3, 4</span></span><br><span class=\"line\">a.extend([<span class=\"number\">5</span>]) <span class=\"comment\"># 1, 2, 3, 4, 5</span></span><br><span class=\"line\">print(a)</span><br><span class=\"line\">a.append([<span class=\"number\">6</span>, <span class=\"number\">7</span>]) <span class=\"comment\"># [1, 2, 3, 4, 5, [6, 7]]</span></span><br><span class=\"line\">print(a)</span><br><span class=\"line\">a.extend([<span class=\"number\">8</span>, <span class=\"number\">9</span>]) <span class=\"comment\"># [1, 2, 3, 4, 5, [6, 7], 8, 9]</span></span><br><span class=\"line\">print(a)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># extend会自动把要添加的列表逐一添加到原列表模块，append是将元素直接添加到列表末尾</span></span><br><span class=\"line\"></span><br><span class=\"line\">value = a.pop()  <span class=\"comment\"># 删除列表中最后一个元素并返回这个元素</span></span><br><span class=\"line\">print(value)</span><br><span class=\"line\">print(a)</span><br><span class=\"line\">a.remove(<span class=\"number\">3</span>)  <span class=\"comment\"># 删除列表中值为3的元素</span></span><br><span class=\"line\">print(a)</span><br><span class=\"line\"><span class=\"keyword\">del</span>(a[<span class=\"number\">0</span>:<span class=\"number\">3</span>]) <span class=\"comment\"># 删除a中第0到3位置上的元素</span></span><br><span class=\"line\">print(a)</span><br></pre></td></tr></table></figure>\n<h3 id=\"元组\"><a href=\"#元组\" class=\"headerlink\" title=\"元组\"></a>元组</h3><ul>\n<li>列表与元组的区别<ul>\n<li>列表时可变的，元组不可变</li>\n<li>元组可以作为字典的 key，但是列表不行</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"keyword\">True</span>)</span><br><span class=\"line\">(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>)[<span class=\"number\">1</span>]</span><br><span class=\"line\">(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>)[<span class=\"number\">0</span>:<span class=\"number\">3</span>] <span class=\"comment\"># 得到一个元素</span></span><br><span class=\"line\">(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>) + (<span class=\"number\">3</span>, <span class=\"number\">3</span>, <span class=\"number\">3</span>) <span class=\"comment\"># (1, 2, 3, 3, 3, 3)</span></span><br><span class=\"line\">(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>) * <span class=\"number\">3</span> <span class=\"comment\"># (1, 2, 3, 1, 2, 3, 1, 2, 3)</span></span><br><span class=\"line\">type((<span class=\"number\">1</span>)) <span class=\"comment\"># int，这是因为内层括被解析成了数学运算的括号</span></span><br><span class=\"line\">type((<span class=\"number\">1</span>,)) <span class=\"comment\"># tuple</span></span><br><span class=\"line\">min((<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>))  <span class=\"comment\"># 最小值</span></span><br><span class=\"line\">max((<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>))  <span class=\"comment\"># 最大值</span></span><br><span class=\"line\">(,) <span class=\"comment\"># 空元组</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"序列的总结\"><a href=\"#序列的总结\" class=\"headerlink\" title=\"序列的总结\"></a>序列的总结</h3><ul>\n<li>str list tuple 都属于序列</li>\n<li>每个元素都会分配一个序号</li>\n<li>都支持切片操作</li>\n<li>支持包含操作：</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">print(<span class=\"string\">'or'</span> <span class=\"keyword\">in</span> <span class=\"string\">'Hello world'</span>)  <span class=\"comment\"># True</span></span><br><span class=\"line\">print(<span class=\"number\">1</span> <span class=\"keyword\">in</span> [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>])  <span class=\"comment\"># True</span></span><br><span class=\"line\">print(<span class=\"string\">'a'</span> <span class=\"keyword\">not</span> <span class=\"keyword\">in</span> (<span class=\"string\">'a'</span>, <span class=\"string\">'c'</span>, <span class=\"number\">12</span>))  <span class=\"comment\"># False</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>长度：<code>len([1, 2, 3])</code></li>\n<li>最大最小：<code>max([1, 2, 3]), min([1, 2, 3])</code></li>\n</ul>\n<h3 id=\"集合\"><a href=\"#集合\" class=\"headerlink\" title=\"集合\"></a>集合</h3><ul>\n<li>集合 Set 的特点<ul>\n<li>元素是无序的</li>\n<li>元素是不重复的</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>&#125;</span><br><span class=\"line\">len(&#123;<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>&#125;) <span class=\"comment\"># 3</span></span><br><span class=\"line\"><span class=\"number\">1</span> <span class=\"keyword\">in</span> &#123;<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>&#125; <span class=\"comment\"># True</span></span><br><span class=\"line\"><span class=\"number\">1</span> <span class=\"keyword\">not</span> <span class=\"keyword\">in</span> &#123;<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>&#125; <span class=\"comment\"># True</span></span><br><span class=\"line\">&#123;<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>&#125; - &#123;<span class=\"number\">3</span>, <span class=\"number\">4</span>&#125; <span class=\"comment\"># 求两个集合的差集</span></span><br><span class=\"line\">&#123;<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>&#125; &amp; &#123;<span class=\"number\">3</span>, <span class=\"number\">4</span>&#125; <span class=\"comment\"># 求两个集合的交集</span></span><br><span class=\"line\">&#123;<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>&#125; | &#123;<span class=\"number\">3</span>, <span class=\"number\">4</span>&#125; <span class=\"comment\"># 求两个集合的并集</span></span><br><span class=\"line\">set() <span class=\"comment\"># 空集合</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"字典\"><a href=\"#字典\" class=\"headerlink\" title=\"字典\"></a>字典</h3><ul>\n<li>Key 不能重复</li>\n<li>Key 必须是不可变的类型<ul>\n<li>列表是可变的，所以不能作为字典的 key</li>\n<li>int，元组，bool 都是不可变的</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">empty = &#123;&#125;  <span class=\"comment\"># 空字典</span></span><br><span class=\"line\">user = &#123;<span class=\"string\">\"name\"</span>: <span class=\"string\">\"ljl\"</span>, <span class=\"string\">\"age\"</span>:<span class=\"number\">12</span>&#125;</span><br><span class=\"line\">print(user[<span class=\"string\">\"name\"</span>])</span><br><span class=\"line\">user[<span class=\"string\">\"school\"</span>] = <span class=\"string\">\"tyut\"</span></span><br><span class=\"line\">user.update(&#123;<span class=\"string\">\"address\"</span>: <span class=\"string\">\"shenzhen\"</span>&#125;)</span><br><span class=\"line\"><span class=\"keyword\">del</span>(user[<span class=\"string\">\"address\"</span>])  <span class=\"comment\"># 删除某个key</span></span><br><span class=\"line\">print(user)</span><br><span class=\"line\">user.clear()  <span class=\"comment\"># 清空</span></span><br><span class=\"line\">print(user)</span><br><span class=\"line\">print(user.keys())  <span class=\"comment\"># 所有key</span></span><br><span class=\"line\">print(user.values())  <span class=\"comment\"># 所有value</span></span><br><span class=\"line\">print(<span class=\"string\">'address'</span> <span class=\"keyword\">in</span> user)  <span class=\"comment\"># 是否包含某个key</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"变量和运算符\"><a href=\"#变量和运算符\" class=\"headerlink\" title=\"变量和运算符\"></a>变量和运算符</h2><h3 id=\"变量的定义\"><a href=\"#变量的定义\" class=\"headerlink\" title=\"变量的定义\"></a>变量的定义</h3><ul>\n<li>Python 中的变量就是一个值的别名</li>\n<li>原则：变量名要有意义</li>\n</ul>\n<h3 id=\"变量命名规则\"><a href=\"#变量命名规则\" class=\"headerlink\" title=\"变量命名规则\"></a>变量命名规则</h3><ul>\n<li>变量名的首字符不能是数字</li>\n<li>只能包含字母，数字，下划线</li>\n<li>系统的关键字不能用作变量名，非系统保留关键字，但是标准库函数的，也不要使用，例如：type</li>\n<li>变量区分大小写</li>\n</ul>\n<h3 id=\"值类型和引用类型\"><a href=\"#值类型和引用类型\" class=\"headerlink\" title=\"值类型和引用类型\"></a>值类型和引用类型</h3><ul>\n<li>值类型：int, str, tuple</li>\n<li>引用类型：list, set, dict</li>\n<li><code>id()</code>: 显示变量内存地址</li>\n</ul>\n<h3 id=\"list-与-tuple\"><a href=\"#list-与-tuple\" class=\"headerlink\" title=\"list 与 tuple\"></a>list 与 tuple</h3><ul>\n<li>list 是可改变的</li>\n<li>tuple 是不可改变的</li>\n<li>使用原则：能用元组尽量用元组，因为元组不可改变，更为安全</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>]</span><br><span class=\"line\">a[<span class=\"number\">0</span>] = <span class=\"number\">11</span> <span class=\"comment\"># OK</span></span><br><span class=\"line\">b = (<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>)</span><br><span class=\"line\">b[<span class=\"number\">0</span>] = <span class=\"number\">11</span> <span class=\"comment\"># error</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"运算符号\"><a href=\"#运算符号\" class=\"headerlink\" title=\"运算符号\"></a>运算符号</h3><ul>\n<li>数学运算符：<code>+-*/</code></li>\n<li>整除：<code>//</code></li>\n<li>余数：<code>%</code></li>\n<li>乘方：<code>**</code> 例如，<code>2**2 = 4</code></li>\n<li>赋值运算符：<code>=, +=, -=, *=, /=, %=, **=, //=</code></li>\n<li>比较运算符：<code>==, !=, &gt;=, &gt;, &lt;=, &lt;</code><ul>\n<li>字符串，bool 都可以比较，字符串转为 ascii 码进行比较，bool 则是 True 转为 1，False 转为 0</li>\n<li>比较返回一个 bool 值</li>\n<li>列表，元组都可以比较，比较的规则是一个一个元素进行比较，直到比较出结果</li>\n</ul>\n</li>\n<li>逻辑运算符：<code>and, or, not</code><ul>\n<li>非 Bool 类型也可以进行逻辑运算，规则是将非 Bool 类型先转为 Bool 类型再进行计算</li>\n<li>int, float 转为 bool，0 为 False，非 0 为 True</li>\n<li>字符串转为 bool，空字符串为 False，非空字符串为 True</li>\n<li>列表转为 bool，空列表为 False，非空列表为 True</li>\n<li>元组，set，dict 与列表一样</li>\n<li>举例：<ul>\n<li><code>2 and 1 # 1</code></li>\n<li><code>1 and 2 # 2</code></li>\n<li><code>1 or 2 # 1</code></li>\n<li><code>0 or 1 # 1</code></li>\n<li>返回的值符合就近原则，例如<code>2 and 1</code>，更具左边的元素 2 无法判断出结果，读取 1 后，可以判断出结构，所有返回 1，<code>1 or 2</code>根据左边的元素 1 就直接可以判断出表达式的值，所以直接返回 1</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>成员运算符：<code>in, not in</code><ul>\n<li>一个元素是否在另外的一组元素中</li>\n<li>返回 bool 类型</li>\n<li>可以作用于：列表，字符串，元组，set，dict</li>\n<li>字典判断的是 key</li>\n</ul>\n</li>\n<li>身份运算符：is, not is<ul>\n<li>比较的是两个变量的内存地址是否相等</li>\n<li>对象的三个特征：值，类型，身份</li>\n<li>判断类型 type(a): <code>type(a) == int</code></li>\n<li>推荐使用 isinstance()方法进行类型判断，例如：<code>isinstance(a, int), isinstance(a, (int, float, str))</code></li>\n</ul>\n</li>\n<li>位运算符：&amp;, |, ^, ~, &lt;&lt;, &gt;&gt;</li>\n</ul>\n<p>特殊的地方：</p>\n<ul>\n<li>Python 没有自增，自减操作</li>\n</ul>\n<h2 id=\"分支，循环，条件，枚举\"><a href=\"#分支，循环，条件，枚举\" class=\"headerlink\" title=\"分支，循环，条件，枚举\"></a>分支，循环，条件，枚举</h2><h3 id=\"什么是表达式\"><a href=\"#什么是表达式\" class=\"headerlink\" title=\"什么是表达式\"></a>什么是表达式</h3><ul>\n<li>表达式是运算符和操作数所构成的序列</li>\n</ul>\n<h3 id=\"表达式优先级\"><a href=\"#表达式优先级\" class=\"headerlink\" title=\"表达式优先级\"></a>表达式优先级</h3><ul>\n<li>and 的优先级大于 or，not &gt; and &gt; or</li>\n<li>解析表达式的顺序：<ul>\n<li>相同优先级从左向右，左结合</li>\n<li>使用括号改变优先级</li>\n<li>赋值运算符是右结合</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"流程控制语句\"><a href=\"#流程控制语句\" class=\"headerlink\" title=\"流程控制语句\"></a>流程控制语句</h3><ul>\n<li>if, if-else</li>\n<li>pass 空语句</li>\n<li>while 语句， while-else（循环退出时，执行 else）</li>\n<li>for: 遍历集合，序列，字典，for-else(遍历完成，执行 else)</li>\n<li>break：跳出循环，从 break 退出循环，不会执行 else 语句</li>\n<li>continue: 跳过本次循环</li>\n<li>range 函数，第一个参数为起始位置，第二个参数为序列元素个数，第三个参数为步长</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a = <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"keyword\">while</span> a &lt; <span class=\"number\">10</span>:</span><br><span class=\"line\">    print(a)</span><br><span class=\"line\">    a += <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"keyword\">else</span>:</span><br><span class=\"line\">    print(<span class=\"string\">'Over'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> range(<span class=\"number\">0</span>, <span class=\"number\">10</span>):</span><br><span class=\"line\">    print(x)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">0</span>, <span class=\"number\">10</span>):</span><br><span class=\"line\">    print(i)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> i == <span class=\"number\">8</span>:</span><br><span class=\"line\">        <span class=\"keyword\">break</span></span><br><span class=\"line\"><span class=\"keyword\">else</span>:</span><br><span class=\"line\">    print(<span class=\"string\">'Over'</span>)  <span class=\"comment\"># Over不会打印，因为循环break了</span></span><br><span class=\"line\"></span><br><span class=\"line\">num = <span class=\"number\">10</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"number\">5</span> &lt; num &lt; <span class=\"number\">20</span>:  <span class=\"comment\"># 可以使用这种判断条件</span></span><br><span class=\"line\">  print(<span class=\"string\">\"hello\"</span>)</span><br></pre></td></tr></table></figure>\n<h3 id=\"Comprehension\"><a href=\"#Comprehension\" class=\"headerlink\" title=\"Comprehension\"></a>Comprehension</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># List Comprehension</span></span><br><span class=\"line\">numbers = [i <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">0</span>, <span class=\"number\">10</span>)]  <span class=\"comment\"># [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]</span></span><br><span class=\"line\">print(numbers)</span><br><span class=\"line\">numbers = [i <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">0</span>, <span class=\"number\">10</span>) <span class=\"keyword\">if</span> i % <span class=\"number\">2</span> == <span class=\"number\">0</span>]  <span class=\"comment\"># [0, 2, 4, 6, 8]</span></span><br><span class=\"line\">print(numbers)</span><br><span class=\"line\">strings = [[<span class=\"string\">'1'</span>, <span class=\"string\">'2'</span>, <span class=\"string\">'3'</span>], [<span class=\"string\">'4'</span>, <span class=\"string\">'5'</span>, <span class=\"string\">'6'</span>], [<span class=\"string\">'7'</span>, <span class=\"string\">'8'</span>, <span class=\"string\">'9'</span>]]</span><br><span class=\"line\">faltten = [int(i) <span class=\"keyword\">for</span> item <span class=\"keyword\">in</span> strings <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> item]</span><br><span class=\"line\">print(faltten) <span class=\"comment\"># [1, 2, 3, 4, 5, 6, 7, 8, 9]</span></span><br><span class=\"line\">xSamples = [<span class=\"number\">2</span>, <span class=\"number\">5</span>, <span class=\"number\">8</span>]</span><br><span class=\"line\">ySamples = [<span class=\"number\">2</span>, <span class=\"number\">6</span>, <span class=\"number\">8</span>]</span><br><span class=\"line\">points = [(x, y) <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> xSamples <span class=\"keyword\">for</span> y <span class=\"keyword\">in</span> ySamples <span class=\"keyword\">if</span> x != y]</span><br><span class=\"line\">print(points) <span class=\"comment\"># [(2, 6), (2, 8), (5, 2), (5, 6), (5, 8), (8, 2), (8, 6)]</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Set Comprehension</span></span><br><span class=\"line\">numbers = &#123;i <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">0</span>, <span class=\"number\">10</span>)&#125;</span><br><span class=\"line\">print(numbers)  <span class=\"comment\"># &#123;0, 1, 2, 3, 4, 5, 6, 7, 8, 9&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Dictionary Comprehension</span></span><br><span class=\"line\">dicts = &#123;i: str(i) <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">0</span>, <span class=\"number\">10</span>)&#125;</span><br><span class=\"line\">print(dicts)  <span class=\"comment\"># &#123;0: '0', 1: '1', 2: '2', 3: '3', 4: '4', 5: '5', 6: '6', 7: '7', 8: '8', 9: '9'&#125;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"包，模块，类，函数与变量\"><a href=\"#包，模块，类，函数与变量\" class=\"headerlink\" title=\"包，模块，类，函数与变量\"></a>包，模块，类，函数与变量</h2><h3 id=\"包\"><a href=\"#包\" class=\"headerlink\" title=\"包\"></a>包</h3><ul>\n<li>一个文件夹就是一个包，包名就是文件名</li>\n<li>子包：文件夹里还有一个文件夹</li>\n<li>文件夹里必须有一个<code>__init__.py</code>文件</li>\n</ul>\n<h3 id=\"模块\"><a href=\"#模块\" class=\"headerlink\" title=\"模块\"></a>模块</h3><ul>\n<li>一个文件就是一个模块，模块名就是文件名</li>\n<li>不同包的相同模块在引用是使用：<code>包名.模块名</code></li>\n<li><code>__init__.py</code>文件也是一个模块</li>\n</ul>\n<h3 id=\"导入另外一个模块\"><a href=\"#导入另外一个模块\" class=\"headerlink\" title=\"导入另外一个模块\"></a>导入另外一个模块</h3><p>导入一个模块有两种方法，import 和 from-import</p>\n<h4 id=\"import-导入\"><a href=\"#import-导入\" class=\"headerlink\" title=\"import 导入\"></a>import 导入</h4><ul>\n<li>语法：<code>import package1</code></li>\n<li>import 导入的是一个模块，使用模块里的变量名时需要带上模块名，例如<code>package1.a</code></li>\n<li>可以使用 as 关键字给模块起一个别名</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> test</span><br><span class=\"line\">print(test.a)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> package.modual <span class=\"keyword\">as</span> p1</span><br><span class=\"line\">print(p1.a)</span><br></pre></td></tr></table></figure>\n<h4 id=\"from-import-导入\"><a href=\"#from-import-导入\" class=\"headerlink\" title=\"from-import 导入\"></a>from-import 导入</h4><ul>\n<li>语法：<code>from module import a</code></li>\n<li>from-input 可以直接导入变量，例如<code>from package.module import a</code></li>\n<li>from-input 可以导入模块<code>from package import module</code></li>\n<li>使用<em>引入所有变量：`from test import </em>`</li>\n<li>指定使用*时模块可导出的变量：使用内置变量<code>__all__</code></li>\n<li>引入多个变量：<code>from test import a, b, c</code></li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> test <span class=\"keyword\">import</span> a</span><br><span class=\"line\">print(a)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> test <span class=\"keyword\">import</span> *</span><br><span class=\"line\">print(a)</span><br><span class=\"line\">print(b)</span><br><span class=\"line\">print(c)</span><br><span class=\"line\"></span><br><span class=\"line\">__all__ = [<span class=\"string\">'a'</span>, <span class=\"string\">'c'</span>] <span class=\"comment\"># 指定使用*导入是，只导入a和c两个变量</span></span><br><span class=\"line\">a = <span class=\"number\">2</span></span><br><span class=\"line\">b = <span class=\"number\">3</span></span><br><span class=\"line\">c = <span class=\"number\">4</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> test <span class=\"keyword\">import</span> *</span><br><span class=\"line\">print(a)</span><br><span class=\"line\">print(c)</span><br><span class=\"line\">print(b) <span class=\"comment\"># ERROR</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> test <span class=\"keyword\">import</span> b</span><br><span class=\"line\">print(b) <span class=\"comment\"># OK</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 导入多个变量换行</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> test <span class=\"keyword\">import</span> a, b, c, d,\\</span><br><span class=\"line\">e, f, g</span><br><span class=\"line\"><span class=\"keyword\">from</span> test <span class=\"keyword\">import</span> (a, b, c, d,</span><br><span class=\"line\">e, f, g)</span><br></pre></td></tr></table></figure>\n<h3 id=\"input-py文件\"><a href=\"#input-py文件\" class=\"headerlink\" title=\"__input__.py文件\"></a><code>__input__.py</code>文件</h3><ul>\n<li>导入包或者包内的某个模块时，<code>__init__.py</code>会被自动执行，可以做一些初始化的工作</li>\n<li><code>__init__.py</code> 的应用场景：<ul>\n<li>决定哪些模块可以被导出</li>\n<li>批量导入某些模块，在使用包是不需要再次导入</li>\n<li>做一些包的初始化工作</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># __init__.py 包名：t</span></span><br><span class=\"line\">__all__ = [<span class=\"string\">'module1'</span>, <span class=\"string\">'module3'</span>] <span class=\"comment\"># 只有module1和module2两个模块可以被导出</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 批量导入</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> sys</span><br><span class=\"line\"><span class=\"keyword\">import</span> datetime</span><br><span class=\"line\"><span class=\"keyword\">import</span> io</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># other.py</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> t</span><br><span class=\"line\">print(t.sys.path)</span><br></pre></td></tr></table></figure>\n<h3 id=\"包和模块的几个常见问题\"><a href=\"#包和模块的几个常见问题\" class=\"headerlink\" title=\"包和模块的几个常见问题\"></a>包和模块的几个常见问题</h3><ul>\n<li>包和模块是不会重复导入的</li>\n<li>避免循环导入，即 A 模块导入 B 模块，B 模块又导入 A 模块，这样编译器会报错</li>\n<li>导入模块时就会执行模块里的代码，但只会执行一次</li>\n</ul>\n<h3 id=\"模块里的变量\"><a href=\"#模块里的变量\" class=\"headerlink\" title=\"模块里的变量\"></a>模块里的变量</h3><p>可以使用 dir()可以打印出模块里的所有变量，<code>dic(module)</code>打印模块中所有的变量</p>\n<ul>\n<li><code>__name__</code>: 模块的完整名称，包括包名<code>package.module</code></li>\n<li><code>__package__</code>: 模块所属的包名</li>\n<li><code>__file__</code>: 模块文件的完整路径</li>\n<li><code>__doc__</code>: 模块的注释</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># module1</span></span><br><span class=\"line\"><span class=\"string\">'''</span></span><br><span class=\"line\"><span class=\"string\">This is doc</span></span><br><span class=\"line\"><span class=\"string\">'''</span></span><br><span class=\"line\">print(__name__)</span><br><span class=\"line\">print(__file__)</span><br><span class=\"line\">print(__package__)</span><br><span class=\"line\">print(__doc__)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 结果</span></span><br><span class=\"line\"><span class=\"comment\">#package.module</span></span><br><span class=\"line\"><span class=\"comment\">#/Users/liujinlong/Documents/Study/Python/package/module.py</span></span><br><span class=\"line\"><span class=\"comment\">#package</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#This is doc</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br></pre></td></tr></table></figure>\n<p>如果一个模块被当成应用程序执行的入口(直接通过<code>pyton xxx.py</code>执行)，则上面的几个变量就会变。</p>\n<ul>\n<li><code>__name__</code>变为<code>__main__</code></li>\n<li><code>__package__</code>为空</li>\n<li><code>__file__</code>为是执行路径与模块文件名的相对路径，与执行路径有关</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">print(<span class=\"string\">\"__name__ :\"</span> + (__name__ <span class=\"keyword\">or</span> <span class=\"string\">\"None\"</span>))</span><br><span class=\"line\">print(<span class=\"string\">\"__package__:\"</span> + (__package__ <span class=\"keyword\">or</span> <span class=\"string\">\"None\"</span>))</span><br><span class=\"line\">print(<span class=\"string\">'__doc__:'</span> + __doc__)</span><br><span class=\"line\">print(<span class=\"string\">'__file__: '</span> + __file__)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 结果：</span></span><br><span class=\"line\"><span class=\"comment\">#__name__ :__main__</span></span><br><span class=\"line\"><span class=\"comment\">#__package__:None</span></span><br><span class=\"line\"><span class=\"comment\">#__doc__:</span></span><br><span class=\"line\"><span class=\"comment\">#this is doc</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#__file__: test2.py</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"name-的应用\"><a href=\"#name-的应用\" class=\"headerlink\" title=\"__name__的应用\"></a><code>__name__</code>的应用</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">'__main__'</span>:</span><br><span class=\"line\">  <span class=\"keyword\">pass</span></span><br></pre></td></tr></table></figure>\n<p>上面的语句是标明的 Python 文件既可以作为模块，也可以作为 app 的入口文件</p>\n<h3 id=\"相对导入和绝对导入\"><a href=\"#相对导入和绝对导入\" class=\"headerlink\" title=\"相对导入和绝对导入\"></a>相对导入和绝对导入</h3><ul>\n<li>顶级包和入口文件有关，入口文件所在的文件夹并不是顶级包</li>\n<li>绝对导入：从顶级包开始导入 <code>import package1.package2.module</code>或<code>from package1.package2 import module1</code></li>\n<li>相对导入：<code>from .m3 import *</code>，相对导入只能用于<code>from-import</code><ul>\n<li>入口文件不能用相对导入，因为<code>__main__</code>这个模块是不存在的，除非使用<code>python -m</code></li>\n<li>.当前文件夹</li>\n<li>..上一层文件夹</li>\n<li>…上上层文件夹</li>\n</ul>\n</li>\n<li>注意事项：与入口文件同级目录下不要再有其他模块</li>\n</ul>\n<p>示例，如下图目录结构：</p>\n<p><img src=\"http://blog.shicishuzhai.com/fb3913861d028acf0475d26ce685031e.png\" alt=\"2\"></p>\n<p>要在<code>main.py</code>中引入其他模块，不能使用相对导入，只能使用绝对导入：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># main.py</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> package1.module1_1</span><br><span class=\"line\"><span class=\"keyword\">import</span> package1.package1_1.module1_1_1 <span class=\"keyword\">as</span> m1_1_1</span><br><span class=\"line\"><span class=\"keyword\">from</span> package2.package2_1 <span class=\"keyword\">import</span> module2_1_1</span><br><span class=\"line\"></span><br><span class=\"line\">m1_1_1.test() <span class=\"comment\"># test是定义在module1_1_1中的一个方法</span></span><br></pre></td></tr></table></figure>\n<p>在<code>module1_1_2.py</code>中导入其他模块可以使用相对导入</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> . <span class=\"keyword\">import</span> module1_1_1</span><br><span class=\"line\"><span class=\"keyword\">from</span> ..module1_1 <span class=\"keyword\">import</span> test1_1</span><br><span class=\"line\"><span class=\"keyword\">from</span> ..package1_2 <span class=\"keyword\">import</span> module1_2_1</span><br><span class=\"line\"><span class=\"keyword\">import</span> package2.package2_1.module2_1_1 <span class=\"keyword\">as</span> m211  <span class=\"comment\"># 这里只能用绝对导入</span></span><br><span class=\"line\"></span><br><span class=\"line\">test1_1()  <span class=\"comment\"># test1_1是module1_1.py里的一个方法</span></span><br><span class=\"line\">module1_2_1.test1_2_1()  <span class=\"comment\"># test1_2_1是module1_2_1.py里的一个方法</span></span><br><span class=\"line\">m211.test2_1_1()  <span class=\"comment\"># test2_1_1是module2_1_1.py里的一个方法</span></span><br></pre></td></tr></table></figure>\n<p>上面要注意的一点是，<code>package1</code>中的模块引用<code>package2</code>中的模块时，只能用绝对导入，因为<code>package1</code>和<code>package2</code>都是和入口文件<code>main.py</code>同级的</p>\n<p>未完待续！</p>\n"}],"PostAsset":[],"PostCategory":[{"post_id":"cjutyfmes0006c4c9gprxuxq8","category_id":"cjutyfmeq0003c4c9ywxcqxa7","_id":"cjutyfmew000cc4c95en79wg3"},{"post_id":"cjutyfmek0000c4c9jfg1itqv","category_id":"cjutyfmeq0003c4c9ywxcqxa7","_id":"cjutyfmez000fc4c92j5hp5t1"},{"post_id":"cjutyfmet0007c4c9i77i90sz","category_id":"cjutyfmeq0003c4c9ywxcqxa7","_id":"cjutyfmf1000ic4c9xw8ggnp5"},{"post_id":"cjutyfmev000ac4c9ouo02ybj","category_id":"cjutyfmeq0003c4c9ywxcqxa7","_id":"cjutyfmf2000mc4c91t1z6uns"},{"post_id":"cjutyfmeo0002c4c9veybclmd","category_id":"cjutyfmeu0008c4c9cf3zuwnk","_id":"cjutyfmf3000oc4c9oxh25mn8"},{"post_id":"cjutyfmev000bc4c9emmaykbs","category_id":"cjutyfmeu0008c4c9cf3zuwnk","_id":"cjutyfmf4000rc4c9yrqn0s0x"},{"post_id":"cjutyfmer0005c4c94wriq8gr","category_id":"cjutyfmeq0003c4c9ywxcqxa7","_id":"cjutyfmf5000tc4c9y4ld2ur0"},{"post_id":"cjutyfmf1000lc4c9oudsitqs","category_id":"cjutyfmeq0003c4c9ywxcqxa7","_id":"cjutyfmf6000vc4c9qtpuxq4q"},{"post_id":"cjutyfmf3000nc4c9gfltksp2","category_id":"cjutyfmeq0003c4c9ywxcqxa7","_id":"cjutyfmf7000xc4c96a34z7vf"},{"post_id":"cjutyfmex000ec4c9st4o2ib4","category_id":"cjutyfmf1000kc4c9qfb255f4","_id":"cjutyfmf8000zc4c9lki6zugb"},{"post_id":"cjutyfmf3000pc4c9gja2x439","category_id":"cjutyfmeq0003c4c9ywxcqxa7","_id":"cjutyfmf80011c4c9ybaaxgke"},{"post_id":"cjutyfmf5000sc4c9wbm2ztyt","category_id":"cjutyfmf1000kc4c9qfb255f4","_id":"cjutyfmf90013c4c992j0t1gx"},{"post_id":"cjutyfmf0000hc4c9zqghro5w","category_id":"cjutyfmf1000kc4c9qfb255f4","_id":"cjutyfmfa0015c4c99nbs4my9"},{"post_id":"cjutyfmf5000uc4c99gitklmd","category_id":"cjutyfmf1000kc4c9qfb255f4","_id":"cjutyfmfb0017c4c90ug1rb6g"},{"post_id":"cjutyfmf6000wc4c9ki5hbqlv","category_id":"cjutyfmeq0003c4c9ywxcqxa7","_id":"cjutyfmfc001ac4c9qt1j4zhc"},{"post_id":"cjutyfmf7000yc4c9urgy5w7u","category_id":"cjutyfmf1000kc4c9qfb255f4","_id":"cjutyfmfd001cc4c95p1cohno"},{"post_id":"cjutyfmf80010c4c9bt2kvitg","category_id":"cjutyfmf1000kc4c9qfb255f4","_id":"cjutyfmfe001ec4c9u0y6gee0"},{"post_id":"cjutyfmf90012c4c97jes5zen","category_id":"cjutyfmeq0003c4c9ywxcqxa7","_id":"cjutyfmff001gc4c99870iycl"},{"post_id":"cjutyfmfa0016c4c9j4mfu2kl","category_id":"cjutyfmf1000kc4c9qfb255f4","_id":"cjutyfmfg001jc4c9ps6y1h8h"},{"post_id":"cjutyfmfb0019c4c9574r5lst","category_id":"cjutyfmeu0008c4c9cf3zuwnk","_id":"cjutyfmfh001lc4c9iquy309r"},{"post_id":"cjutyfmfc001bc4c9zw40q5tg","category_id":"cjutyfmeq0003c4c9ywxcqxa7","_id":"cjutyfmfi001oc4c94cnb5yqg"},{"post_id":"cjutyfmfa0014c4c9ennwcxn5","category_id":"cjutyfmfb0018c4c9rxjpkjfn","_id":"cjutyfmfj001rc4c9tck1whyd"},{"post_id":"cjutyfmfd001dc4c9r7gf2u0g","category_id":"cjutyfmfb0018c4c9rxjpkjfn","_id":"cjutyfmfk001tc4c9vmezbs9x"},{"post_id":"cjutyfmfe001fc4c9p5o1r2x8","category_id":"cjutyfmfb0018c4c9rxjpkjfn","_id":"cjutyfmfl001xc4c98alq6g33"},{"post_id":"cjutyfmff001ic4c9l9dwzjlp","category_id":"cjutyfmfb0018c4c9rxjpkjfn","_id":"cjutyfmfm001zc4c9qeklrj3l"},{"post_id":"cjutyfmfg001kc4c9h1tg6387","category_id":"cjutyfmeu0008c4c9cf3zuwnk","_id":"cjutyfmfn0024c4c9f5mihzvy"},{"post_id":"cjutyfmfh001mc4c9fjsj9stq","category_id":"cjutyfmeu0008c4c9cf3zuwnk","_id":"cjutyfmfo0026c4c9y7zqk3fk"},{"post_id":"cjutyfmfi001qc4c91nq7vexy","category_id":"cjutyfmfb0018c4c9rxjpkjfn","_id":"cjutyfmfq002ac4c95kkjyd1g"},{"post_id":"cjutyfmfj001sc4c9iv7tct8v","category_id":"cjutyfmfb0018c4c9rxjpkjfn","_id":"cjutyfmfr002dc4c96m0i1n6o"},{"post_id":"cjutyfmfn0022c4c968dsrker","category_id":"cjutyfmeq0003c4c9ywxcqxa7","_id":"cjutyfmfs002hc4c94qz743ys"},{"post_id":"cjutyfmfo0025c4c9abtj4eo8","category_id":"cjutyfmeu0008c4c9cf3zuwnk","_id":"cjutyfmft002kc4c9z8j9eg81"},{"post_id":"cjutyfmfk001vc4c9jky7vyrm","category_id":"cjutyfmfn0021c4c9fq17djik","_id":"cjutyfmfv002oc4c9831ub945"},{"post_id":"cjutyfmfp0028c4c9ennoc9r8","category_id":"cjutyfmfb0018c4c9rxjpkjfn","_id":"cjutyfmfv002rc4c97bhfod5n"},{"post_id":"cjutyfmfq002cc4c9p0ig8cc3","category_id":"cjutyfmeu0008c4c9cf3zuwnk","_id":"cjutyfmfw002uc4c93nyemfmp"},{"post_id":"cjutyfmfl001yc4c98a7mwq8c","category_id":"cjutyfmfn0021c4c9fq17djik","_id":"cjutyfmfy002yc4c9k8adrszt"},{"post_id":"cjutyfmfr002gc4c9lc9dk245","category_id":"cjutyfmfb0018c4c9rxjpkjfn","_id":"cjutyfmfz0031c4c9ssxtz8oa"},{"post_id":"cjutyfmfs002jc4c9hai1b6ur","category_id":"cjutyfmeq0003c4c9ywxcqxa7","_id":"cjutyfmg00035c4c96gi0i4rw"},{"post_id":"cjutyfmfu002mc4c9akzbp170","category_id":"cjutyfmfb0018c4c9rxjpkjfn","_id":"cjutyfmg10038c4c9znimm2f9"},{"post_id":"cjutyfmfv002qc4c9ilpo5nmr","category_id":"cjutyfmfb0018c4c9rxjpkjfn","_id":"cjutyfmg2003cc4c9h3gk5fz7"},{"post_id":"cjutyfmfw002tc4c9i46zimmm","category_id":"cjutyfmeq0003c4c9ywxcqxa7","_id":"cjutyfmg3003fc4c9njdavwp6"},{"post_id":"cjutyfmfx002xc4c9wticqdvv","category_id":"cjutyfmfb0018c4c9rxjpkjfn","_id":"cjutyfmg4003jc4c9z9fzkeey"},{"post_id":"cjutyfmfy0030c4c9pzq4mwi9","category_id":"cjutyfmfb0018c4c9rxjpkjfn","_id":"cjutyfmg5003mc4c9h2mfp924"},{"post_id":"cjutyfmg1003bc4c9gq0r5qmx","category_id":"cjutyfmfb0018c4c9rxjpkjfn","_id":"cjutyfmg7003qc4c9t5t0fkj6"},{"post_id":"cjutyfmg2003ec4c942ec6kum","category_id":"cjutyfmfb0018c4c9rxjpkjfn","_id":"cjutyfmg7003sc4c9cver2v3o"},{"post_id":"cjutyfmfz0034c4c9eqocw9fb","category_id":"cjutyfmg1003ac4c9wu0f5lhq","_id":"cjutyfmg8003vc4c9zn6uhnxu"},{"post_id":"cjutyfmg3003hc4c9uffh2d10","category_id":"cjutyfmfb0018c4c9rxjpkjfn","_id":"cjutyfmg9003zc4c9sdad2s86"},{"post_id":"cjutyfmg5003lc4c9bjcsqr6u","category_id":"cjutyfmfb0018c4c9rxjpkjfn","_id":"cjutyfmgb0042c4c96suitr78"},{"post_id":"cjutyfmg00037c4c9f07r3tno","category_id":"cjutyfmg4003ic4c94wb4sphz","_id":"cjutyfmgc0046c4c96fpswhjo"},{"post_id":"cjutyfmg6003oc4c97pwxfmgi","category_id":"cjutyfmfb0018c4c9rxjpkjfn","_id":"cjutyfmgd0049c4c9kuw8fre2"},{"post_id":"cjutyfmg7003rc4c9hbmj0bnm","category_id":"cjutyfmeq0003c4c9ywxcqxa7","_id":"cjutyfmge004dc4c958ptlpxv"},{"post_id":"cjutyfmg8003uc4c9v1hijmxs","category_id":"cjutyfmfn0021c4c9fq17djik","_id":"cjutyfmgf004gc4c913xwgwom"},{"post_id":"cjutyfmg9003xc4c9i5hl92nc","category_id":"cjutyfmfn0021c4c9fq17djik","_id":"cjutyfmgg004lc4c9lscsjdmn"},{"post_id":"cjutyfmga0040c4c9tzttojhl","category_id":"cjutyfmeq0003c4c9ywxcqxa7","_id":"cjutyfmgh004nc4c9ngtsloeo"},{"post_id":"cjutyfmgb0044c4c9bmytalc4","category_id":"cjutyfmfb0018c4c9rxjpkjfn","_id":"cjutyfmgj004rc4c9w6q5hyxb"},{"post_id":"cjutyfmgc0047c4c9tuat9b36","category_id":"cjutyfmeq0003c4c9ywxcqxa7","_id":"cjutyfmgk004uc4c9vtm22q4c"},{"post_id":"cjutyfmgh004mc4c90slzz1zz","category_id":"cjutyfmgf004hc4c952ujaym6","_id":"cjutyfmgl004yc4c91pml9281"},{"post_id":"cjutyfmgd004bc4c90beqoksv","category_id":"cjutyfmgf004hc4c952ujaym6","_id":"cjutyfmgn0052c4c9f6npv4vw"},{"post_id":"cjutyfmgi004oc4c9mqcxyazw","category_id":"cjutyfmgf004hc4c952ujaym6","_id":"cjutyfmgo0056c4c9kpi1tk79"},{"post_id":"cjutyfmge004ec4c97yd9mrm5","category_id":"cjutyfmgf004hc4c952ujaym6","_id":"cjutyfmgp0058c4c9rxewh0mb"},{"post_id":"cjutyfmgk004wc4c9rv9moviq","category_id":"cjutyfmeu0008c4c9cf3zuwnk","_id":"cjutyfmgp005ac4c97mn50idp"},{"post_id":"cjutyfmgm0050c4c9fiizjbdi","category_id":"cjutyfmg4003ic4c94wb4sphz","_id":"cjutyfmgq005cc4c9o19nh24h"},{"post_id":"cjutyfmgg004ic4c9flzvtq8d","category_id":"cjutyfmgf004hc4c952ujaym6","_id":"cjutyfmgq005dc4c9lncag2be"},{"post_id":"cjutyfmgo0053c4c9luqd6kxr","category_id":"cjutyfmgf004hc4c952ujaym6","_id":"cjutyfmgq005fc4c9fnrx6k0w"},{"post_id":"cjutyfmgj004tc4c9mqkh8emb","category_id":"cjutyfmgo0054c4c930c4s4ck","_id":"cjutyfmgq005gc4c92jsjsc0g"},{"post_id":"cjutyfmj6006qc4c9r1mfxtr8","category_id":"cjutyfmeq0003c4c9ywxcqxa7","_id":"cjutyfmja006vc4c9gl65benx"},{"post_id":"cjutyfmj7006sc4c95d0ktiuk","category_id":"cjutyfmf1000kc4c9qfb255f4","_id":"cjutyfmja006wc4c9acpfvoh1"},{"post_id":"cjutyfmj8006tc4c9ayofnbp9","category_id":"cjutyfmeq0003c4c9ywxcqxa7","_id":"cjutyfmjb006xc4c9izuqtamf"},{"post_id":"cjutyfmja006uc4c9p1oakngg","category_id":"cjutyfmfb0018c4c9rxjpkjfn","_id":"cjutyfmjb006yc4c9jih2ee2z"},{"post_id":"cjutyfmjq006zc4c9zupf1mgz","category_id":"cjutyfmeq0003c4c9ywxcqxa7","_id":"cjutyfmjr0072c4c9gqc6r1do"},{"post_id":"cjutyfmjq0070c4c97e9km400","category_id":"cjutyfmeq0003c4c9ywxcqxa7","_id":"cjutyfmjs0074c4c9nrrjpl6c"},{"post_id":"cjutyfmjr0071c4c9ee0yf0oq","category_id":"cjutyfmgf004hc4c952ujaym6","_id":"cjutyfmjs0075c4c93naeznd0"}],"PostTag":[{"post_id":"cjutyfmek0000c4c9jfg1itqv","tag_id":"cjutyfmer0004c4c9eyc7edtv","_id":"cjutyfmez000gc4c92wnsy234"},{"post_id":"cjutyfmek0000c4c9jfg1itqv","tag_id":"cjutyfmeu0009c4c9d193v2ki","_id":"cjutyfmf1000jc4c905nigemt"},{"post_id":"cjutyfmfd001dc4c9r7gf2u0g","tag_id":"cjutyfmff001hc4c9bgxovodh","_id":"cjutyfmfi001pc4c90qflje6x"},{"post_id":"cjutyfmfe001fc4c9p5o1r2x8","tag_id":"cjutyfmfi001nc4c90imnc5cr","_id":"cjutyfmfl001wc4c9n0o2y9mc"},{"post_id":"cjutyfmff001ic4c9l9dwzjlp","tag_id":"cjutyfmff001hc4c9bgxovodh","_id":"cjutyfmfn0023c4c95eo7ahqd"},{"post_id":"cjutyfmfg001kc4c9h1tg6387","tag_id":"cjutyfmfm0020c4c9exkb1afw","_id":"cjutyfmfq002bc4c9yqk6k1qo"},{"post_id":"cjutyfmfp0028c4c9ennoc9r8","tag_id":"cjutyfmff001hc4c9bgxovodh","_id":"cjutyfmfr002ec4c9zz2ik4io"},{"post_id":"cjutyfmfi001qc4c91nq7vexy","tag_id":"cjutyfmfi001nc4c90imnc5cr","_id":"cjutyfmfs002ic4c9okpuczst"},{"post_id":"cjutyfmfi001qc4c91nq7vexy","tag_id":"cjutyfmfp0027c4c9n347wz7i","_id":"cjutyfmfu002lc4c97lktesbb"},{"post_id":"cjutyfmfr002gc4c9lc9dk245","tag_id":"cjutyfmff001hc4c9bgxovodh","_id":"cjutyfmfv002pc4c9b5lcufmb"},{"post_id":"cjutyfmfj001sc4c9iv7tct8v","tag_id":"cjutyfmfr002fc4c9cgdes8v7","_id":"cjutyfmfw002sc4c96qldb5dm"},{"post_id":"cjutyfmfu002mc4c9akzbp170","tag_id":"cjutyfmff001hc4c9bgxovodh","_id":"cjutyfmfx002wc4c92f38nw98"},{"post_id":"cjutyfmfv002qc4c9ilpo5nmr","tag_id":"cjutyfmff001hc4c9bgxovodh","_id":"cjutyfmfy002zc4c9dkl0flbl"},{"post_id":"cjutyfmfk001vc4c9jky7vyrm","tag_id":"cjutyfmfu002nc4c9d5qatmq4","_id":"cjutyfmfz0033c4c9af6ght5k"},{"post_id":"cjutyfmfl001yc4c98a7mwq8c","tag_id":"cjutyfmfu002nc4c9d5qatmq4","_id":"cjutyfmg00036c4c998pimifa"},{"post_id":"cjutyfmfn0022c4c968dsrker","tag_id":"cjutyfmfz0032c4c9cw4l3gl3","_id":"cjutyfmg2003dc4c93u7gldaj"},{"post_id":"cjutyfmfo0025c4c9abtj4eo8","tag_id":"cjutyfmg10039c4c9tihgk8pc","_id":"cjutyfmg4003kc4c9y44i2rhz"},{"post_id":"cjutyfmg2003ec4c942ec6kum","tag_id":"cjutyfmff001hc4c9bgxovodh","_id":"cjutyfmg6003nc4c9reqkx697"},{"post_id":"cjutyfmg6003oc4c97pwxfmgi","tag_id":"cjutyfmff001hc4c9bgxovodh","_id":"cjutyfmg8003tc4c9dkv4yeeg"},{"post_id":"cjutyfmfq002cc4c9p0ig8cc3","tag_id":"cjutyfmff001hc4c9bgxovodh","_id":"cjutyfmg9003yc4c9h26f3tj6"},{"post_id":"cjutyfmfq002cc4c9p0ig8cc3","tag_id":"cjutyfmg3003gc4c9byk6uze6","_id":"cjutyfmgb0041c4c9uodfj2v5"},{"post_id":"cjutyfmfq002cc4c9p0ig8cc3","tag_id":"cjutyfmg6003pc4c9bnpi0k1j","_id":"cjutyfmgc0045c4c9vmsdtabg"},{"post_id":"cjutyfmg8003uc4c9v1hijmxs","tag_id":"cjutyfmfu002nc4c9d5qatmq4","_id":"cjutyfmgd0048c4c978ohudrg"},{"post_id":"cjutyfmg9003xc4c9i5hl92nc","tag_id":"cjutyfmfu002nc4c9d5qatmq4","_id":"cjutyfmge004cc4c96bl6vgma"},{"post_id":"cjutyfmfs002jc4c9hai1b6ur","tag_id":"cjutyfmg8003wc4c9uroapw1h","_id":"cjutyfmgf004fc4c9zmcan391"},{"post_id":"cjutyfmfs002jc4c9hai1b6ur","tag_id":"cjutyfmgb0043c4c9j77vyppp","_id":"cjutyfmgg004kc4c9d92e3vi8"},{"post_id":"cjutyfmfw002tc4c9i46zimmm","tag_id":"cjutyfmgd004ac4c9971ugo0p","_id":"cjutyfmgj004sc4c952didb9h"},{"post_id":"cjutyfmfw002tc4c9i46zimmm","tag_id":"cjutyfmg8003wc4c9uroapw1h","_id":"cjutyfmgk004vc4c94lwp006c"},{"post_id":"cjutyfmfx002xc4c9wticqdvv","tag_id":"cjutyfmgj004qc4c97mwgcuqc","_id":"cjutyfmgn0051c4c9h6ba57c4"},{"post_id":"cjutyfmgk004wc4c9rv9moviq","tag_id":"cjutyfmff001hc4c9bgxovodh","_id":"cjutyfmgo0055c4c9uoxkzcie"},{"post_id":"cjutyfmfy0030c4c9pzq4mwi9","tag_id":"cjutyfmgl004zc4c9biu4hikw","_id":"cjutyfmgp0059c4c9plobdw1s"},{"post_id":"cjutyfmfz0034c4c9eqocw9fb","tag_id":"cjutyfmgp0057c4c98y49zoy4","_id":"cjutyfmgq005ic4c9d436enjf"},{"post_id":"cjutyfmfz0034c4c9eqocw9fb","tag_id":"cjutyfmgp005bc4c9535ldn2i","_id":"cjutyfmgq005jc4c9gaush9qm"},{"post_id":"cjutyfmfz0034c4c9eqocw9fb","tag_id":"cjutyfmgq005ec4c9v3635qfe","_id":"cjutyfmgr005lc4c9e8ja1rhl"},{"post_id":"cjutyfmg00037c4c9f07r3tno","tag_id":"cjutyfmgq005hc4c9uestlbp1","_id":"cjutyfmgr005nc4c9zwh0hnx8"},{"post_id":"cjutyfmg00037c4c9f07r3tno","tag_id":"cjutyfmgq005kc4c9opn4wzwj","_id":"cjutyfmgr005oc4c97e7qgm5k"},{"post_id":"cjutyfmg1003bc4c9gq0r5qmx","tag_id":"cjutyfmgr005mc4c9yihif92y","_id":"cjutyfmgr005qc4c9xxm7eskf"},{"post_id":"cjutyfmg3003hc4c9uffh2d10","tag_id":"cjutyfmgr005pc4c9wmscvl9y","_id":"cjutyfmgs005sc4c9tutw8tyq"},{"post_id":"cjutyfmg5003lc4c9bjcsqr6u","tag_id":"cjutyfmgr005rc4c9irruyr7h","_id":"cjutyfmgw005uc4c90ncvu9lm"},{"post_id":"cjutyfmg7003rc4c9hbmj0bnm","tag_id":"cjutyfmgv005tc4c9no5j8ix2","_id":"cjutyfmgw005wc4c9eu6okxo0"},{"post_id":"cjutyfmga0040c4c9tzttojhl","tag_id":"cjutyfmgw005vc4c94o0n7s2i","_id":"cjutyfmgw005zc4c95i3x0oti"},{"post_id":"cjutyfmga0040c4c9tzttojhl","tag_id":"cjutyfmgw005xc4c9nx1095wk","_id":"cjutyfmgw0060c4c92o67qe7l"},{"post_id":"cjutyfmgb0044c4c9bmytalc4","tag_id":"cjutyfmgw005yc4c9kd9v9edl","_id":"cjutyfmgx0062c4c9bdg2hvg4"},{"post_id":"cjutyfmgc0047c4c9tuat9b36","tag_id":"cjutyfmgw0061c4c96df60j4p","_id":"cjutyfmgx0064c4c9l1vtyikl"},{"post_id":"cjutyfmgd004bc4c90beqoksv","tag_id":"cjutyfmgx0063c4c947ou0z9x","_id":"cjutyfmgx0066c4c988sj46mq"},{"post_id":"cjutyfmge004ec4c97yd9mrm5","tag_id":"cjutyfmgx0063c4c947ou0z9x","_id":"cjutyfmgy0068c4c9zay0bzzl"},{"post_id":"cjutyfmgg004ic4c9flzvtq8d","tag_id":"cjutyfmgx0063c4c947ou0z9x","_id":"cjutyfmgy006ac4c9fk6cnsy2"},{"post_id":"cjutyfmgh004mc4c90slzz1zz","tag_id":"cjutyfmgx0063c4c947ou0z9x","_id":"cjutyfmgz006cc4c9diowgaqy"},{"post_id":"cjutyfmgi004oc4c9mqcxyazw","tag_id":"cjutyfmgx0063c4c947ou0z9x","_id":"cjutyfmgz006ec4c9q12l8i8q"},{"post_id":"cjutyfmgj004tc4c9mqkh8emb","tag_id":"cjutyfmgz006dc4c9399maxjn","_id":"cjutyfmh0006hc4c94joot9ev"},{"post_id":"cjutyfmgj004tc4c9mqkh8emb","tag_id":"cjutyfmgz006fc4c95vr43k4j","_id":"cjutyfmh0006ic4c97mlpqcuc"},{"post_id":"cjutyfmgm0050c4c9fiizjbdi","tag_id":"cjutyfmgq005hc4c9uestlbp1","_id":"cjutyfmh0006kc4c9nx9x0guj"},{"post_id":"cjutyfmgo0053c4c9luqd6kxr","tag_id":"cjutyfmgx0063c4c947ou0z9x","_id":"cjutyfmh1006nc4c98s0iccmd"},{"post_id":"cjutyfmgo0053c4c9luqd6kxr","tag_id":"cjutyfmh0006lc4c99cct235z","_id":"cjutyfmh1006oc4c92jx87zb8"},{"post_id":"cjutyfmgo0053c4c9luqd6kxr","tag_id":"cjutyfmh0006mc4c9mdv49ch3","_id":"cjutyfmh1006pc4c93draam4y"},{"post_id":"cjutyfmjr0071c4c9ee0yf0oq","tag_id":"cjutyfmgx0063c4c947ou0z9x","_id":"cjutyfmjs0073c4c90fjdwg86"}],"Tag":[{"name":"iOS开发","_id":"cjutyfmer0004c4c9eyc7edtv"},{"name":"Emoji表情","_id":"cjutyfmeu0009c4c9d193v2ki"},{"name":"其他","_id":"cjutyfmff001hc4c9bgxovodh"},{"name":"UILabel","_id":"cjutyfmfi001nc4c90imnc5cr"},{"name":"Hexo","_id":"cjutyfmfm0020c4c9exkb1afw"},{"name":"NSAttributedString","_id":"cjutyfmfp0027c4c9n347wz7i"},{"name":"UIButton","_id":"cjutyfmfr002fc4c9cgdes8v7"},{"name":"Git","_id":"cjutyfmfu002nc4c9d5qatmq4"},{"name":"CoreAnimation","_id":"cjutyfmfz0032c4c9cw4l3gl3"},{"name":"加密解密","_id":"cjutyfmg10039c4c9tihgk8pc"},{"name":"WebDAV","_id":"cjutyfmg3003gc4c9byk6uze6"},{"name":"ownCloud","_id":"cjutyfmg6003pc4c9bnpi0k1j"},{"name":"Target","_id":"cjutyfmg8003wc4c9uroapw1h"},{"name":"Scheme","_id":"cjutyfmgb0043c4c9j77vyppp"},{"name":"CocoaPods","_id":"cjutyfmgd004ac4c9971ugo0p"},{"name":"Autolayout","_id":"cjutyfmgj004qc4c97mwgcuqc"},{"name":"本地化","_id":"cjutyfmgl004zc4c9biu4hikw"},{"name":"树莓派","_id":"cjutyfmgp0057c4c98y49zoy4"},{"name":"SSH","_id":"cjutyfmgp005bc4c9535ldn2i"},{"name":"网络","_id":"cjutyfmgq005ec4c9v3635qfe"},{"name":"Swift","_id":"cjutyfmgq005hc4c9uestlbp1"},{"name":"预处理宏","_id":"cjutyfmgq005kc4c9opn4wzwj"},{"name":"IDFA","_id":"cjutyfmgr005mc4c9yihif92y"},{"name":"Objective-C","_id":"cjutyfmgr005pc4c9wmscvl9y"},{"name":"Xcode","_id":"cjutyfmgr005rc4c9irruyr7h"},{"name":"HTTPS","_id":"cjutyfmgv005tc4c9no5j8ix2"},{"name":"转场动画","_id":"cjutyfmgw005vc4c94o0n7s2i"},{"name":"CATransition","_id":"cjutyfmgw005xc4c9nx1095wk"},{"name":"沙盒","_id":"cjutyfmgw005yc4c9kd9v9edl"},{"name":"分享","_id":"cjutyfmgw0061c4c96df60j4p"},{"name":"Python","_id":"cjutyfmgx0063c4c947ou0z9x"},{"name":"旅游","_id":"cjutyfmgz006dc4c9399maxjn"},{"name":"日本","_id":"cjutyfmgz006fc4c95vr43k4j"},{"name":"Flask","_id":"cjutyfmh0006lc4c99cct235z"},{"name":"Backend","_id":"cjutyfmh0006mc4c9mdv49ch3"}]}}